!function(){var Ht="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function O(r){var n,e=r.default;return"function"==typeof e?(n=function(){return e.apply(this,arguments)}).prototype=e.prototype:n={},Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(r).forEach(function(e){var t=Object.getOwnPropertyDescriptor(r,e);Object.defineProperty(n,e,t.get?t:{enumerable:!0,get:function(){return r[e]}})}),n}var Qs,e={exports:{}},e=(Qs=e,function(){var z={version:"3.5.17"},A=[].slice,f=function(e){return A.call(e)},D=this.document;function B(e){return e&&(e.ownerDocument||e.document||e).documentElement}function N(e){return e&&(e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView)}if(D)try{f(D.documentElement.childNodes)[0].nodeType}catch(e){f=function(e){for(var t=e.length,r=new Array(t);t--;)r[t]=e[t];return r}}if(Date.now||(Date.now=function(){return+new Date}),D)try{D.createElement("DIV").style.setProperty("opacity",0,"")}catch(e){var t=this.Element.prototype,j=t.setAttribute,U=t.setAttributeNS,r=this.CSSStyleDeclaration.prototype,V=r.setProperty;t.setAttribute=function(e,t){j.call(this,e,t+"")},t.setAttributeNS=function(e,t,r){U.call(this,e,t,r+"")},r.setProperty=function(e,t,r){V.call(this,e,t+"",r)}}function G(e,t){return e<t?-1:t<e?1:t<=e?0:NaN}function W(e){return null===e?NaN:+e}function Z(e){return!isNaN(e)}function e(o){return{left:function(e,t,r,n){for(arguments.length<3&&(r=0),arguments.length<4&&(n=e.length);r<n;){var i=r+n>>>1;o(e[i],t)<0?r=1+i:n=i}return r},right:function(e,t,r,n){for(arguments.length<3&&(r=0),arguments.length<4&&(n=e.length);r<n;){var i=r+n>>>1;0<o(e[i],t)?n=i:r=1+i}return r}}}z.ascending=G,z.descending=function(e,t){return t<e?-1:e<t?1:e<=t?0:NaN},z.min=function(e,t){var r,n,i=-1,o=e.length;if(1===arguments.length){for(;++i<o;)if(null!=(n=e[i])&&n<=n){r=n;break}for(;++i<o;)null!=(n=e[i])&&n<r&&(r=n)}else{for(;++i<o;)if(null!=(n=t.call(e,e[i],i))&&n<=n){r=n;break}for(;++i<o;)null!=(n=t.call(e,e[i],i))&&n<r&&(r=n)}return r},z.max=function(e,t){var r,n,i=-1,o=e.length;if(1===arguments.length){for(;++i<o;)if(null!=(n=e[i])&&n<=n){r=n;break}for(;++i<o;)null!=(n=e[i])&&r<n&&(r=n)}else{for(;++i<o;)if(null!=(n=t.call(e,e[i],i))&&n<=n){r=n;break}for(;++i<o;)null!=(n=t.call(e,e[i],i))&&r<n&&(r=n)}return r},z.extent=function(e,t){var r,n,i,o=-1,a=e.length;if(1===arguments.length){for(;++o<a;)if(null!=(n=e[o])&&n<=n){r=i=n;break}for(;++o<a;)null!=(n=e[o])&&(n<r&&(r=n),i<n&&(i=n))}else{for(;++o<a;)if(null!=(n=t.call(e,e[o],o))&&n<=n){r=i=n;break}for(;++o<a;)null!=(n=t.call(e,e[o],o))&&(n<r&&(r=n),i<n&&(i=n))}return[r,i]},z.sum=function(e,t){var r,n=0,i=e.length,o=-1;if(1===arguments.length)for(;++o<i;)Z(r=+e[o])&&(n+=r);else for(;++o<i;)Z(r=+t.call(e,e[o],o))&&(n+=r);return n},z.mean=function(e,t){var r,n=0,i=e.length,o=-1,a=i;if(1===arguments.length)for(;++o<i;)Z(r=W(e[o]))?n+=r:--a;else for(;++o<i;)Z(r=W(t.call(e,e[o],o)))?n+=r:--a;if(a)return n/a},z.quantile=function(e,t){var t=(e.length-1)*t+1,r=Math.floor(t),n=+e[r-1],t=t-r;return t?n+t*(e[r]-n):n},z.median=function(e,t){var r,n=[],i=e.length,o=-1;if(1===arguments.length)for(;++o<i;)Z(r=W(e[o]))&&n.push(r);else for(;++o<i;)Z(r=W(t.call(e,e[o],o)))&&n.push(r);if(n.length)return z.quantile(n.sort(G),.5)},z.variance=function(e,t){var r,n,i=e.length,o=0,a=0,s=-1,l=0;if(1===arguments.length)for(;++s<i;)Z(r=W(e[s]))&&(a+=(n=r-o)*(r-(o+=n/++l)));else for(;++s<i;)Z(r=W(t.call(e,e[s],s)))&&(a+=(n=r-o)*(r-(o+=n/++l)));if(1<l)return a/(l-1)},z.deviation=function(){var e=z.variance.apply(this,arguments);return e&&Math.sqrt(e)};t=e(G);function q(e){return e.length}z.bisectLeft=t.left,z.bisect=z.bisectRight=t.right,z.bisector=function(r){return e(1===r.length?function(e,t){return G(r(e),t)}:r)},z.shuffle=function(e,t,r){(o=arguments.length)<3&&(r=e.length,o<2&&(t=0));for(var n,i,o=r-t;o;)i=Math.random()*o--|0,n=e[o+t],e[o+t]=e[i+t],e[i+t]=n;return e},z.permute=function(e,t){for(var r=t.length,n=new Array(r);r--;)n[r]=e[t[r]];return n},z.pairs=function(e){for(var t=0,r=e.length-1,n=e[0],i=new Array(r<0?0:r);t<r;)i[t]=[n,n=e[++t]];return i},z.transpose=function(e){if(!(i=e.length))return[];for(var t=-1,r=z.min(e,q),n=new Array(r);++t<r;)for(var i,o=-1,a=n[t]=new Array(i);++o<i;)a[o]=e[o][t];return n},z.zip=function(){return z.transpose(arguments)},z.keys=function(e){var t,r=[];for(t in e)r.push(t);return r},z.values=function(e){var t,r=[];for(t in e)r.push(e[t]);return r},z.entries=function(e){var t,r=[];for(t in e)r.push({key:t,value:e[t]});return r},z.merge=function(e){for(var t,r,n,i=e.length,o=-1,a=0;++o<i;)a+=e[o].length;for(r=new Array(a);0<=--i;)for(t=(n=e[i]).length;0<=--t;)r[--a]=n[t];return r};var L=Math.abs;function H(e,t){for(var r in t)Object.defineProperty(e.prototype,r,{value:t[r],enumerable:!1})}function $(){this._=Object.create(null)}z.range=function(e,t,r){if(arguments.length<3&&(r=1,arguments.length<2&&(t=e,e=0)),(t-e)/r==1/0)throw new Error("infinite range");var n,i=[],o=function(e){var t=1;for(;e*t%1;)t*=10;return t}(L(r)),a=-1;if(e*=o,t*=o,(r*=o)<0)for(;(n=e+r*++a)>t;)i.push(n/o);else for(;(n=e+r*++a)<t;)i.push(n/o);return i},z.map=function(e,t){var r=new $;if(e instanceof $)e.forEach(function(e,t){r.set(e,t)});else if(Array.isArray(e)){var n,i=-1,o=e.length;if(1===arguments.length)for(;++i<o;)r.set(i,e[i]);else for(;++i<o;)r.set(t.call(e,n=e[i],i),n)}else for(var a in e)r.set(a,e[a]);return r};var X="__proto__",Y="\0";function J(e){return(e+="")===X||e[0]===Y?Y+e:e}function K(e){return(e+="")[0]===Y?e.slice(1):e}function Q(e){return J(e)in this._}function ee(e){return(e=J(e))in this._&&delete this._[e]}function te(){var e,t=[];for(e in this._)t.push(K(e));return t}function re(){var e,t=0;for(e in this._)++t;return t}function ne(){for(var e in this._)return!1;return!0}function ie(){this._=Object.create(null)}function I(e){return e}function oe(e,t){if(t in e)return t;t=t.charAt(0).toUpperCase()+t.slice(1);for(var r=0,n=ae.length;r<n;++r){var i=ae[r]+t;if(i in e)return i}}H($,{has:Q,get:function(e){return this._[J(e)]},set:function(e,t){return this._[J(e)]=t},remove:ee,keys:te,values:function(){var e,t=[];for(e in this._)t.push(this._[e]);return t},entries:function(){var e,t=[];for(e in this._)t.push({key:K(e),value:this._[e]});return t},size:re,empty:ne,forEach:function(e){for(var t in this._)e.call(this,K(t),this._[t])}}),z.nest=function(){var h,f,d={},p=[],t=[];function m(r,e,n){if(n>=p.length)return f?f.call(d,e):h?e.sort(h):e;for(var t,i,o,a,s=-1,l=e.length,u=p[n++],c=new $;++s<l;)(a=c.get(t=u(i=e[s])))?a.push(i):c.set(t,[i]);return o=r?(i=r(),function(e,t){i.set(e,m(r,t,n))}):(i={},function(e,t){i[e]=m(r,t,n)}),c.forEach(o),i}return d.map=function(e,t){return m(t,e,0)},d.entries=function(e){return function r(e,n){var i,o;return n>=p.length?e:(i=[],o=t[n++],e.forEach(function(e,t){i.push({key:e,values:r(t,n)})}),o?i.sort(function(e,t){return o(e.key,t.key)}):i)}(m(z.map,e,0),0)},d.key=function(e){return p.push(e),d},d.sortKeys=function(e){return t[p.length-1]=e,d},d.sortValues=function(e){return h=e,d},d.rollup=function(e){return f=e,d},d},z.set=function(e){var t=new ie;if(e)for(var r=0,n=e.length;r<n;++r)t.add(e[r]);return t},H(ie,{has:Q,add:function(e){return this._[J(e+="")]=!0,e},remove:ee,values:te,size:re,empty:ne,forEach:function(e){for(var t in this._)e.call(this,K(t))}}),z.behavior={},z.rebind=function(e,t){for(var r,n=1,i=arguments.length;++n<i;)e[r=arguments[n]]=function(t,r,n){return function(){var e=n.apply(r,arguments);return e===r?t:e}}(e,t,t[r]);return e};var ae=["webkit","ms","moz","Moz","o","O"];function l(){}function se(){}function le(i){var o=[],n=new $;function e(){for(var e,t=o,r=-1,n=t.length;++r<n;)(e=t[r].on)&&e.apply(this,arguments);return i}return e.on=function(e,t){var r=n.get(e);return arguments.length<2?r&&r.on:(r&&(r.on=null,o=o.slice(0,r=o.indexOf(r)).concat(o.slice(r+1)),n.remove(e)),t&&o.push(n.set(e,{on:t})),i)},e}function ue(){z.event.preventDefault()}function ce(){for(var e,t=z.event;e=t.sourceEvent;)t=e;return t}function he(i){for(var o=new se,e=0,t=arguments.length;++e<t;)o[arguments[e]]=le(o);return o.of=function(r,n){return function(e){try{var t=e.sourceEvent=z.event;e.target=i,z.event=e,o[e.type].apply(r,n)}finally{z.event=t}}},o}z.dispatch=function(){for(var e=new se,t=-1,r=arguments.length;++t<r;)e[arguments[t]]=le(e);return e},se.prototype.on=function(e,t){var r=e.indexOf("."),n="";if(0<=r&&(n=e.slice(r+1),e=e.slice(0,r)),e)return arguments.length<2?this[e].on(n):this[e].on(n,t);if(2===arguments.length){if(null==t)for(e in this)this.hasOwnProperty(e)&&this[e].on(n,null);return this}},z.event=null,z.requote=function(e){return e.replace(fe,"\\$&")};var fe=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,de={}.__proto__?function(e,t){e.__proto__=t}:function(e,t){for(var r in t)e[r]=t[r]};function pe(e){return de(e,n),e}var me=function(e,t){return t.querySelector(e)},ge=function(e,t){return t.querySelectorAll(e)},ye=function(e,t){var r=e.matches||e[oe(e,"matchesSelector")];return(ye=function(e,t){return r.call(e,t)})(e,t)},n=("function"==typeof Sizzle&&(me=function(e,t){return Sizzle(e,t)[0]||null},ye=(ge=Sizzle).matchesSelector),z.selection=function(){return z.select(D.documentElement)},z.selection.prototype=[]);function ve(e){return"function"==typeof e?e:function(){return me(e,this)}}function _e(e){return"function"==typeof e?e:function(){return ge(e,this)}}n.select=function(e){var t,r,n,i,o=[];e=ve(e);for(var a=-1,s=this.length;++a<s;){o.push(t=[]),t.parentNode=(n=this[a]).parentNode;for(var l=-1,u=n.length;++l<u;)(i=n[l])?(t.push(r=e.call(i,i.__data__,l,a)),r&&"__data__"in i&&(r.__data__=i.__data__)):t.push(null)}return pe(o)},n.selectAll=function(e){var t,r,n=[];e=_e(e);for(var i=-1,o=this.length;++i<o;)for(var a=this[i],s=-1,l=a.length;++s<l;)(r=a[s])&&(n.push(t=f(e.call(r,r.__data__,s,i))),t.parentNode=r);return pe(n)};var xe="http://www.w3.org/1999/xhtml",be={svg:"http://www.w3.org/2000/svg",xhtml:xe,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function we(t,r){return t=z.ns.qualify(t),null==r?t.local?function(){this.removeAttributeNS(t.space,t.local)}:function(){this.removeAttribute(t)}:"function"==typeof r?t.local?function(){var e=r.apply(this,arguments);null==e?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,e)}:function(){var e=r.apply(this,arguments);null==e?this.removeAttribute(t):this.setAttribute(t,e)}:t.local?function(){this.setAttributeNS(t.space,t.local,r)}:function(){this.setAttribute(t,r)}}function Ee(e){return e.trim().replace(/\s+/g," ")}function Te(e){return new RegExp("(?:^|\\s+)"+z.requote(e)+"(?:\\s+|$)","g")}function Se(e){return(e+"").trim().split(/^|\s+/)}function Me(r,n){var i=(r=Se(r).map(ke)).length;return"function"==typeof n?function(){for(var e=-1,t=n.apply(this,arguments);++e<i;)r[e](this,t)}:function(){for(var e=-1;++e<i;)r[e](this,n)}}function ke(n){var i=Te(n);return function(e,t){if(r=e.classList)return t?r.add(n):r.remove(n);var r=e.getAttribute("class")||"";t?(i.lastIndex=0,i.test(r)||e.setAttribute("class",Ee(r+" "+n))):e.setAttribute("class",Ee(r.replace(i," ")))}}function Ce(t,r,n){return null==r?function(){this.style.removeProperty(t)}:"function"==typeof r?function(){var e=r.apply(this,arguments);null==e?this.style.removeProperty(t):this.style.setProperty(t,e,n)}:function(){this.style.setProperty(t,r,n)}}function Ae(t,r){return null==r?function(){delete this[t]}:"function"==typeof r?function(){var e=r.apply(this,arguments);null==e?delete this[t]:this[t]=e}:function(){this[t]=r}}function Ie(r){return"function"==typeof r?r:(r=z.ns.qualify(r)).local?function(){return this.ownerDocument.createElementNS(r.space,r.local)}:function(){var e=this.ownerDocument,t=this.namespaceURI;return t===xe&&e.documentElement.namespaceURI===xe?e.createElement(r):e.createElementNS(t,r)}}function Le(){var e=this.parentNode;e&&e.removeChild(this)}function Pe(e){return{__data__:e}}function ze(e){return function(){return ye(this,e)}}function De(e,t){for(var r=0,n=e.length;r<n;r++)for(var i,o=e[r],a=0,s=o.length;a<s;a++)(i=o[a])&&t(i,a,r);return e}function Oe(e){return de(e,Re),e}z.ns={prefix:be,qualify:function(e){var t=e.indexOf(":"),r=e;return 0<=t&&"xmlns"!==(r=e.slice(0,t))&&(e=e.slice(t+1)),be.hasOwnProperty(r)?{space:be[r],local:e}:e}},n.attr=function(e,t){if(arguments.length<2){var r;if("string"==typeof e)return r=this.node(),(e=z.ns.qualify(e)).local?r.getAttributeNS(e.space,e.local):r.getAttribute(e);for(t in e)this.each(we(t,e[t]));return this}return this.each(we(e,t))},n.classed=function(e,t){if(arguments.length<2){if("string"==typeof e){var r=this.node(),n=(e=Se(e)).length,i=-1;if(t=r.classList){for(;++i<n;)if(!t.contains(e[i]))return!1}else for(t=r.getAttribute("class");++i<n;)if(!Te(e[i]).test(t))return!1;return!0}for(t in e)this.each(Me(t,e[t]));return this}return this.each(Me(e,t))},n.style=function(e,t,r){var n=arguments.length;if(n<3){if("string"!=typeof e){for(r in n<2&&(t=""),e)this.each(Ce(r,e[r],t));return this}if(n<2)return N(n=this.node()).getComputedStyle(n,null).getPropertyValue(e);r=""}return this.each(Ce(e,t,r))},n.property=function(e,t){if(arguments.length<2){if("string"==typeof e)return this.node()[e];for(t in e)this.each(Ae(t,e[t]));return this}return this.each(Ae(e,t))},n.text=function(t){return arguments.length?this.each("function"==typeof t?function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}:null==t?function(){this.textContent=""}:function(){this.textContent=t}):this.node().textContent},n.html=function(t){return arguments.length?this.each("function"==typeof t?function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}:null==t?function(){this.innerHTML=""}:function(){this.innerHTML=t}):this.node().innerHTML},n.append=function(e){return e=Ie(e),this.select(function(){return this.appendChild(e.apply(this,arguments))})},n.insert=function(e,t){return e=Ie(e),t=ve(t),this.select(function(){return this.insertBefore(e.apply(this,arguments),t.apply(this,arguments)||null)})},n.remove=function(){return this.each(Le)},n.data=function(e,p){var t,r,n=-1,i=this.length;if(!arguments.length){for(e=new Array(i=(t=this[0]).length);++n<i;)(r=t[n])&&(e[n]=r.__data__);return e}function o(e,t){var r,n,i=e.length,o=t.length,a=Math.min(i,o),s=new Array(o),l=new Array(o),u=new Array(i);if(p){for(var c,h=new $,f=new Array(i),d=-1;++d<i;)(r=e[d])&&(h.has(c=p.call(r,r.__data__,d))?u[d]=r:h.set(c,r),f[d]=c);for(d=-1;++d<o;)(r=h.get(c=p.call(t,n=t[d],d)))?!0!==r&&((s[d]=r).__data__=n):l[d]=Pe(n),h.set(c,!0);for(d=-1;++d<i;)d in f&&!0!==h.get(f[d])&&(u[d]=e[d])}else{for(d=-1;++d<a;)r=e[d],n=t[d],r?(r.__data__=n,s[d]=r):l[d]=Pe(n);for(;d<o;++d)l[d]=Pe(t[d]);for(;d<i;++d)u[d]=e[d]}l.update=s,l.parentNode=s.parentNode=u.parentNode=e.parentNode,m.push(l),g.push(s),y.push(u)}var m=Oe([]),g=pe([]),y=pe([]);if("function"==typeof e)for(;++n<i;)o(t=this[n],e.call(t,t.parentNode.__data__,n));else for(;++n<i;)o(t=this[n],e);return g.enter=function(){return m},g.exit=function(){return y},g},n.datum=function(e){return arguments.length?this.property("__data__",e):this.property("__data__")},n.filter=function(e){var t,r,n,i=[];"function"!=typeof e&&(e=ze(e));for(var o=0,a=this.length;o<a;o++){i.push(t=[]),t.parentNode=(r=this[o]).parentNode;for(var s=0,l=r.length;s<l;s++)(n=r[s])&&e.call(n,n.__data__,s,o)&&t.push(n)}return pe(i)},n.order=function(){for(var e=-1,t=this.length;++e<t;)for(var r,n=this[e],i=n.length-1,o=n[i];0<=--i;)(r=n[i])&&(o&&o!==r.nextSibling&&o.parentNode.insertBefore(r,o),o=r);return this},n.sort=function(e){e=function(r){arguments.length||(r=G);return function(e,t){return e&&t?r(e.__data__,t.__data__):!e-!t}}.apply(this,arguments);for(var t=-1,r=this.length;++t<r;)this[t].sort(e);return this.order()},n.each=function(n){return De(this,function(e,t,r){n.call(e,e.__data__,t,r)})},n.call=function(e){var t=f(arguments);return e.apply(t[0]=this,t),this},n.empty=function(){return!this.node()},n.node=function(){for(var e=0,t=this.length;e<t;e++)for(var r=this[e],n=0,i=r.length;n<i;n++){var o=r[n];if(o)return o}return null},n.size=function(){var e=0;return De(this,function(){++e}),e};var Re=[];function Fe(i,t,r){var n="__on"+i,e=i.indexOf("."),o=Ne,a=(0<e&&(i=i.slice(0,e)),Be.get(i));function s(){var e=this[n];e&&(this.removeEventListener(i,e,e.$),delete this[n])}return a&&(i=a,o=je),e?t?function(){var e=o(t,f(arguments));s.call(this),this.addEventListener(i,this[n]=e,e.$=r),e._=t}:s:t?l:function(){var e,t,r,n=new RegExp("^__on([^.]+)"+z.requote(i)+"$");for(t in this)(e=t.match(n))&&(r=this[t],this.removeEventListener(e[1],r,r.$),delete this[t])}}z.selection.enter=Oe,(z.selection.enter.prototype=Re).append=n.append,Re.empty=n.empty,Re.node=n.node,Re.call=n.call,Re.size=n.size,Re.select=function(e){for(var t,r,n,i,o,a=[],s=-1,l=this.length;++s<l;){n=(i=this[s]).update,a.push(t=[]),t.parentNode=i.parentNode;for(var u=-1,c=i.length;++u<c;)(o=i[u])?(t.push(n[u]=r=e.call(i.parentNode,o.__data__,u,s)),r.__data__=o.__data__):t.push(null)}return pe(a)},Re.insert=function(e,t){var a,s,l;return arguments.length<2&&(a=this,t=function(e,t,r){var n,i=a[r].update,o=i.length;for(r!=l&&(l=r,s=0),s<=t&&(s=t+1);!(n=i[s])&&++s<o;);return n}),n.insert.call(this,e,t)},z.select=function(e){var t;return"string"==typeof e?(t=[me(e,D)]).parentNode=D.documentElement:(t=[e]).parentNode=B(e),pe([t])},z.selectAll=function(e){var t;return"string"==typeof e?(t=f(ge(e,D))).parentNode=D.documentElement:(t=f(e)).parentNode=null,pe([t])},n.on=function(e,t,r){var n=arguments.length;if(n<3){if("string"!=typeof e){for(r in n<2&&(t=!1),e)this.each(Fe(r,e[r],t));return this}if(n<2)return(n=this.node()["__on"+e])&&n._;r=!1}return this.each(Fe(e,t,r))};var Be=z.map({mouseenter:"mouseover",mouseleave:"mouseout"});function Ne(r,n){return function(e){var t=z.event;z.event=e,n[0]=this.__data__;try{r.apply(this,n)}finally{z.event=t}}}function je(e,t){var r=Ne(e,t);return function(e){var t=e.relatedTarget;t&&(t===this||8&t.compareDocumentPosition(this))||r.call(this,e)}}D&&Be.forEach(function(e){"on"+e in D&&Be.remove(e)});var Ue,Ve=0;function Ge(e){var r,n,i=".dragsuppress-"+ ++Ve,o="click"+i,a=z.select(N(e)).on("touchmove"+i,ue).on("dragstart"+i,ue).on("selectstart"+i,ue);return(Ue=null==Ue?!("onselectstart"in e)&&oe(e.style,"userSelect"):Ue)&&(r=B(e).style,n=r[Ue],r[Ue]="none"),function(e){var t;a.on(i,null),Ue&&(r[Ue]=n),e&&(t=function(){a.on(o,null)},a.on(o,function(){ue(),t()},!0),setTimeout(t,0))}}z.mouse=function(e){return Ze(e,ce())};var We=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;function Ze(e,t){t.changedTouches&&(t=t.changedTouches[0]);var r,n,i=e.ownerSVGElement||e;return i.createSVGPoint?(r=i.createSVGPoint(),We<0&&(((n=N(e)).scrollX||n.scrollY)&&(n=(i=z.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important"))[0][0].getScreenCTM(),We=!(n.f||n.e),i.remove())),We?(r.x=t.pageX,r.y=t.pageY):(r.x=t.clientX,r.y=t.clientY),[(r=r.matrixTransform(e.getScreenCTM().inverse())).x,r.y]):(n=e.getBoundingClientRect(),[t.clientX-n.left-e.clientLeft,t.clientY-n.top-e.clientTop])}function qe(){return z.event.changedTouches[0].identifier}z.touch=function(e,t,r){if(arguments.length<3&&(r=t,t=ce().changedTouches),t)for(var n,i=0,o=t.length;i<o;++i)if((n=t[i]).identifier===r)return Ze(e,n)},z.behavior.drag=function(){var m=he(r,"drag","dragstart","dragend"),g=null,e=n(l,z.mouse,N,"mousemove","mouseup"),t=n(qe,z.touch,I,"touchmove","touchend");function r(){this.on("mousedown.drag",e).on("touchstart.drag",t)}function n(c,h,f,d,p){return function(){var n,e=z.event.target.correspondingElement||z.event.target,i=this.parentNode,o=m.of(this,arguments),a=0,s=c(),t=".drag"+(null==s?"":"-"+s),r=z.select(f(e)).on(d+t,function(){var e,t,r=h(i,s);r&&(e=r[0]-u[0],t=r[1]-u[1],a|=e|t,o({type:"drag",x:(u=r)[0]+n[0],y:r[1]+n[1],dx:e,dy:t}))}).on(p+t,function(){h(i,s)&&(r.on(d+t,null).on(p+t,null),l(a),o({type:"dragend"}))}),l=Ge(e),u=h(i,s);n=g?[(n=g.apply(this,arguments)).x-u[0],n.y-u[1]]:[0,0],o({type:"dragstart"})}}return r.origin=function(e){return arguments.length?(g=e,r):g},z.rebind(r,m,"on")},z.touches=function(r,e){return(e=arguments.length<2?ce().touches:e)?f(e).map(function(e){var t=Ze(r,e);return t.identifier=e.identifier,t}):[]};var P=1e-6,He=P*P,O=Math.PI,S=2*O,$e=S-P,R=O/2,T=O/180,M=180/O;function Xe(e){return 0<e?1:e<0?-1:0}function Ye(e,t,r){return(t[0]-e[0])*(r[1]-e[1])-(t[1]-e[1])*(r[0]-e[0])}function Je(e){return 1<e?0:e<-1?O:Math.acos(e)}function Ke(e){return 1<e?R:e<-1?-R:Math.asin(e)}function Qe(e){return((e=Math.exp(e))+1/e)/2}function et(e){return(e=Math.sin(e/2))*e}var tt,rt,nt=Math.SQRT2,it=(z.interpolateZoom=function(e,t){var n,i,o,a=e[0],s=e[1],l=e[2],e=t[0],r=t[1],t=t[2],u=e-a,c=r-s,e=u*u+c*c;return(t=e<He?(o=Math.log(t/l)/nt,function(e){return[a+e*u,s+e*c,l*Math.exp(nt*e*o)]}):(n=Math.sqrt(e),r=(t*t-l*l+4*e)/(2*l*2*n),e=(t*t-l*l-4*e)/(2*t*2*n),i=Math.log(Math.sqrt(r*r+1)-r),o=(Math.log(Math.sqrt(e*e+1)-e)-i)/nt,function(e){var e=e*o,t=Qe(i),r=l/(2*n)*(t*(r=nt*e+i,((r=Math.exp(2*r))-1)/(r+1))-(r=i,((r=Math.exp(i))-1/r)/2));return[a+r*u,s+r*c,l*t/Qe(nt*e+i)]})).duration=1e3*o,t},z.behavior.zoom=function(){var t,s,r,n,v,i,o,a,l,_={x:0,y:0,k:1},u=[960,500],c=it,h=250,f=0,x="mousedown.zoom",d="mousemove.zoom",p="mouseup.zoom",b="touchstart.zoom",w=he(m,"zoomstart","zoom","zoomend");function m(e){e.on(x,I).on(rt+".zoom",y).on("dblclick.zoom",P).on(b,L)}function E(e){return[(e[0]-_.x)/_.k,(e[1]-_.y)/_.k]}function T(e){_.k=Math.max(c[0],Math.min(c[1],e))}function S(e,t){var r;t=[(r=t)[0]*_.k+_.x,r[1]*_.k+_.y],_.x+=e[0]-t[0],_.y+=e[1]-t[1]}function M(e,t,r,n){e.__chart__={x:_.x,y:_.y,k:_.k},T(Math.pow(2,n)),S(s=t,r),e=z.select(e),(e=0<h?e.transition().duration(h):e).call(m.event)}function g(){o&&o.domain(i.range().map(function(e){return(e-_.x)/_.k}).map(i.invert)),l&&l.domain(a.range().map(function(e){return(e-_.y)/_.k}).map(a.invert))}function k(e){f++||e({type:"zoomstart"})}function C(e){g(),e({type:"zoom",scale:_.k,translate:[_.x,_.y]})}function A(e){--f||(e({type:"zoomend"}),s=null)}function I(){var e=this,t=w.of(e,arguments),r=0,n=z.select(N(e)).on(d,function(){r=1,S(z.mouse(e),i),C(t)}).on(p,function(){n.on(d,null).on(p,null),o(r),A(t)}),i=E(z.mouse(e)),o=Ge(e);Ss.call(e),k(t)}function L(){var l,u=this,c=w.of(u,arguments),h={},f=0,i=".zoom-"+z.event.changedTouches[0].identifier,a="touchmove"+i,s="touchend"+i,d=[],o=z.select(u),p=Ge(u);function m(){var e=z.touches(u);return l=_.k,e.forEach(function(e){e.identifier in h&&(h[e.identifier]=E(e))}),e}function e(){for(var e=z.event.target,t=(z.select(e).on(a,g).on(s,y),d.push(e),z.event.changedTouches),r=0,n=t.length;r<n;++r)h[t[r].identifier]=null;var i,e=m(),o=Date.now();1===e.length?(o-v<500&&(i=e[0],M(u,i,h[i.identifier],Math.floor(Math.log(_.k)/Math.LN2)+1),ue()),v=o):1<e.length&&(i=e[0],o=e[1],e=i[0]-o[0],i=i[1]-o[1],f=e*e+i*i)}function g(){var e,t,r=z.touches(u);Ss.call(u);for(var n,i,o,a=0,s=r.length;a<s;++a,t=null)if(e=r[a],t=h[e.identifier]){if(o)break;i=e,o=t}t&&(n=(n=e[0]-i[0])*n+(n=e[1]-i[1])*n,n=f&&Math.sqrt(n/f),i=[(i[0]+e[0])/2,(i[1]+e[1])/2],o=[(o[0]+t[0])/2,(o[1]+t[1])/2],T(n*l)),v=null,S(i,o),C(c)}function y(){if(z.event.touches.length){for(var e,t=z.event.changedTouches,r=0,n=t.length;r<n;++r)delete h[t[r].identifier];for(e in h)return void m()}z.selectAll(d).on(i,null),o.on(x,I).on(b,L),p(),A(c)}e(),k(c),o.on(x,null).on(b,e)}function y(){var e=w.of(this,arguments);n?clearTimeout(n):(Ss.call(this),t=E(s=r||z.mouse(this)),k(e)),n=setTimeout(function(){n=null,A(e)},50),ue(),T(Math.pow(2,.002*tt())*_.k),S(s,t),C(e)}function P(){var e=z.mouse(this),t=Math.log(_.k)/Math.LN2;M(this,e,E(e),z.event.shiftKey?Math.ceil(t)-1:Math.floor(t)+1)}return rt=rt||("onwheel"in D?(tt=function(){return-z.event.deltaY*(z.event.deltaMode?120:1)},"wheel"):"onmousewheel"in D?(tt=function(){return z.event.wheelDelta},"mousewheel"):(tt=function(){return-z.event.detail},"MozMousePixelScroll")),m.event=function(e){e.each(function(){var a=w.of(this,arguments),t=_;Cs?z.select(this).transition().each("start.zoom",function(){_=this.__chart__||{x:0,y:0,k:1},k(a)}).tween("zoom:zoom",function(){var r=u[0],e=u[1],n=s?s[0]:r/2,i=s?s[1]:e/2,o=z.interpolateZoom([(n-_.x)/_.k,(i-_.y)/_.k,r/_.k],[(n-t.x)/t.k,(i-t.y)/t.k,r/t.k]);return function(e){var e=o(e),t=r/e[2];this.__chart__=_={x:n-e[0]*t,y:i-e[1]*t,k:t},C(a)}}).each("interrupt.zoom",function(){A(a)}).each("end.zoom",function(){A(a)}):(this.__chart__=_,k(a),C(a),A(a))})},m.translate=function(e){return arguments.length?(_={x:+e[0],y:+e[1],k:_.k},g(),m):[_.x,_.y]},m.scale=function(e){return arguments.length?(_={x:_.x,y:_.y,k:null},T(+e),g(),m):_.k},m.scaleExtent=function(e){return arguments.length?(c=null==e?it:[+e[0],+e[1]],m):c},m.center=function(e){return arguments.length?(r=e&&[+e[0],+e[1]],m):r},m.size=function(e){return arguments.length?(u=e&&[+e[0],+e[1]],m):u},m.duration=function(e){return arguments.length?(h=+e,m):h},m.x=function(e){return arguments.length?(i=(o=e).copy(),_={x:0,y:0,k:1},m):o},m.y=function(e){return arguments.length?(a=(l=e).copy(),_={x:0,y:0,k:1},m):l},z.rebind(m,w,"on")},[0,1/0]);function ot(){}function at(e,t,r){return this instanceof at?(this.h=+e,this.s=+t,void(this.l=+r)):arguments.length<2?e instanceof at?new at(e.h,e.s,e.l):bt(""+e,wt,at):new at(e,t,r)}(z.color=ot).prototype.toString=function(){return this.rgb()+""};r=(z.hsl=at).prototype=new ot;function st(e,t,r){var n,i;function o(e){return Math.round(255*(360<(e=e)?e-=360:e<0&&(e+=360),e<60?n+(i-n)*e/60:e<180?i:e<240?n+(i-n)*(240-e)/60:n))}return e=isNaN(e)?0:(e%=360)<0?e+360:e,t=isNaN(t)||t<0?0:1<t?1:t,n=2*(r=r<0?0:1<r?1:r)-(i=r<=.5?r*(1+t):r+t-r*t),new a(o(e+120),o(e),o(e-120))}function i(e,t,r){return this instanceof i?(this.h=+e,this.c=+t,void(this.l=+r)):arguments.length<2?e instanceof i?new i(e.h,e.c,e.l):pt((e instanceof o?e:e=Et((e=z.rgb(e)).r,e.g,e.b)).l,e.a,e.b):new i(e,t,r)}r.brighter=function(e){return e=Math.pow(.7,arguments.length?e:1),new at(this.h,this.s,this.l/e)},r.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),new at(this.h,this.s,e*this.l)},r.rgb=function(){return st(this.h,this.s,this.l)};t=(z.hcl=i).prototype=new ot;function lt(e,t,r){return isNaN(e)&&(e=0),isNaN(t)&&(t=0),new o(r,Math.cos(e*=T)*t,Math.sin(e)*t)}function o(e,t,r){return this instanceof o?(this.l=+e,this.a=+t,void(this.b=+r)):arguments.length<2?e instanceof o?new o(e.l,e.a,e.b):e instanceof i?lt(e.h,e.c,e.l):Et((e=a(e)).r,e.g,e.b):new o(e,t,r)}t.brighter=function(e){return new i(this.h,this.c,Math.min(100,this.l+ut*(arguments.length?e:1)))},t.darker=function(e){return new i(this.h,this.c,Math.max(0,this.l-ut*(arguments.length?e:1)))},t.rgb=function(){return lt(this.h,this.c,this.l).rgb()},z.lab=o;var ut=18,ct=.95047,ht=1,ft=1.08883,r=o.prototype=new ot;function dt(e,t,r){e=(e+16)/116,r=e-r/200;return new a(yt(3.2404542*(t=mt(e+t/500)*ct)-1.5371385*(e=mt(e)*ht)-.4985314*(r=mt(r)*ft)),yt(-.969266*t+1.8760108*e+.041556*r),yt(.0556434*t-.2040259*e+1.0572252*r))}function pt(e,t,r){return 0<e?new i(Math.atan2(r,t)*M,Math.sqrt(t*t+r*r),e):new i(NaN,NaN,e)}function mt(e){return.206893034<e?e*e*e:(e-4/29)/7.787037}function gt(e){return.008856<e?Math.pow(e,1/3):7.787037*e+4/29}function yt(e){return Math.round(255*(e<=.00304?12.92*e:1.055*Math.pow(e,1/2.4)-.055))}function a(e,t,r){return this instanceof a?(this.r=~~e,this.g=~~t,void(this.b=~~r)):arguments.length<2?e instanceof a?new a(e.r,e.g,e.b):bt(""+e,a,st):new a(e,t,r)}function vt(e){return new a(e>>16,e>>8&255,255&e)}function _t(e){return vt(e)+""}r.brighter=function(e){return new o(Math.min(100,this.l+ut*(arguments.length?e:1)),this.a,this.b)},r.darker=function(e){return new o(Math.max(0,this.l-ut*(arguments.length?e:1)),this.a,this.b)},r.rgb=function(){return dt(this.l,this.a,this.b)};t=(z.rgb=a).prototype=new ot;function xt(e){return e<16?"0"+Math.max(0,e).toString(16):Math.min(255,e).toString(16)}function bt(e,t,r){var n,i=0,o=0,a=0,s=/([a-z]+)\((.*)\)/.exec(e=e.toLowerCase());if(s)switch(n=s[2].split(","),s[1]){case"hsl":return r(parseFloat(n[0]),parseFloat(n[1])/100,parseFloat(n[2])/100);case"rgb":return t(St(n[0]),St(n[1]),St(n[2]))}return(s=Mt.get(e))?t(s.r,s.g,s.b):(null==e||"#"!==e.charAt(0)||isNaN(s=parseInt(e.slice(1),16))||(4===e.length?(i=(3840&s)>>4,i|=i>>4,o=240&s,o|=o>>4,a=15&s,a|=a<<4):7===e.length&&(i=(16711680&s)>>16,o=(65280&s)>>8,a=255&s)),t(i,o,a))}function wt(e,t,r){var n,i,o=Math.min(e/=255,t/=255,r/=255),a=Math.max(e,t,r),s=a-o,l=(a+o)/2;return s?(i=l<.5?s/(a+o):s/(2-a-o),n=e==a?(t-r)/s+(t<r?6:0):t==a?(r-e)/s+2:(e-t)/s+4,n*=60):(n=NaN,i=0<l&&l<1?0:n),new at(n,i,l)}function Et(e,t,r){var n=gt((.4124564*(e=Tt(e))+.3575761*(t=Tt(t))+.1804375*(r=Tt(r)))/ct),i=gt((.2126729*e+.7151522*t+.072175*r)/ht);return o(116*i-16,500*(n-i),200*(i-gt((.0193339*e+.119192*t+.9503041*r)/ft)))}function Tt(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function St(e){var t=parseFloat(e);return"%"===e.charAt(e.length-1)?Math.round(2.55*t):t}t.brighter=function(e){e=Math.pow(.7,arguments.length?e:1);var t=this.r,r=this.g,n=this.b;return t||r||n?(t&&t<30&&(t=30),r&&r<30&&(r=30),n&&n<30&&(n=30),new a(Math.min(255,t/e),Math.min(255,r/e),Math.min(255,n/e))):new a(30,30,30)},t.darker=function(e){return new a((e=Math.pow(.7,arguments.length?e:1))*this.r,e*this.g,e*this.b)},t.hsl=function(){return wt(this.r,this.g,this.b)},t.toString=function(){return"#"+xt(this.r)+xt(this.g)+xt(this.b)};var Mt=z.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});function F(e){return"function"==typeof e?e:function(){return e}}function kt(n){return function(e,t,r){return 2===arguments.length&&"function"==typeof t&&(r=t,t=null),Ct(e,t,n,r)}}function Ct(i,o,a,e){var r,s={},l=z.dispatch("beforesend","progress","load","error"),u={},c=new XMLHttpRequest,h=null;function t(){var e,t,r,n=c.status;if(!n&&((r=(t=c).responseType)&&"text"!==r?t.response:t.responseText)||200<=n&&n<300||304===n){try{e=a.call(s,c)}catch(e){return void l.error.call(s,e)}l.load.call(s,e)}else l.error.call(s,c)}return"onload"in(c=!this.XDomainRequest||"withCredentials"in c||!/^(http(s)?:)?\/\//.test(i)?c:new XDomainRequest)?c.onload=c.onerror=t:c.onreadystatechange=function(){3<c.readyState&&t()},c.onprogress=function(e){var t=z.event;z.event=e;try{l.progress.call(s,c)}finally{z.event=t}},s.header=function(e,t){return e=(e+"").toLowerCase(),arguments.length<2?u[e]:(null==t?delete u[e]:u[e]=t+"",s)},s.mimeType=function(e){return arguments.length?(o=null==e?null:e+"",s):o},s.responseType=function(e){return arguments.length?(h=e,s):h},s.response=function(e){return a=e,s},["get","post"].forEach(function(e){s[e]=function(){return s.send.apply(s,[e].concat(f(arguments)))}}),s.send=function(e,t,r){if(2===arguments.length&&"function"==typeof t&&(r=t,t=null),c.open(e,i,!0),null==o||"accept"in u||(u.accept=o+",*/*"),c.setRequestHeader)for(var n in u)c.setRequestHeader(n,u[n]);return null!=o&&c.overrideMimeType&&c.overrideMimeType(o),null!=h&&(c.responseType=h),null!=r&&s.on("error",r).on("load",function(e){r(null,e)}),l.beforesend.call(s,c),c.send(null==t?null:t),s},s.abort=function(){return c.abort(),s},z.rebind(s,l,"on"),null==e?s:s.get(1===(r=e).length?function(e,t){r(null==e?t:null)}:r)}Mt.forEach(function(e,t){Mt.set(e,vt(t))}),z.functor=F,z.xhr=kt(I),z.dsv=function(i,o){var t=new RegExp('["'+i+"\n]"),f=i.charCodeAt(0);function a(e,t,r){arguments.length<3&&(r=t,t=null);var n=Ct(e,o,null==t?s:l(t),r);return n.row=function(e){return arguments.length?n.response(null==(t=e)?s:l(e)):t},n}function s(e){return a.parse(e.responseText)}function l(t){return function(e){return a.parse(e.responseText,t)}}function r(e){return e.map(u).join(i)}function u(e){return t.test(e)?'"'+e.replace(/\"/g,'""')+'"':e}return a.parse=function(e,n){var i;return a.parseRows(e,function(e,t){if(i)return i(e,t-1);var r=new Function("d","return {"+e.map(function(e,t){return JSON.stringify(e)+": d["+t+"]"}).join(",")+"}");i=n?function(e,t){return n(r(e),t)}:r})},a.parseRows=function(i,e){var t,o,a={},s={},r=[],l=i.length,u=0,n=0;function c(){if(l<=u)return s;if(o)return o=!1,a;var e=u;if(34===i.charCodeAt(e)){for(var t=e;t++<l;)if(34===i.charCodeAt(t)){if(34!==i.charCodeAt(t+1))break;++t}return u=t+2,13===(r=i.charCodeAt(t+1))?(o=!0,10===i.charCodeAt(t+2)&&++u):10===r&&(o=!0),i.slice(e+1,t).replace(/""/g,'"')}for(;u<l;){var r,n=1;if(10===(r=i.charCodeAt(u++)))o=!0;else if(13===r)o=!0,10===i.charCodeAt(u)&&(++u,++n);else if(r!==f)continue;return i.slice(e,u-n)}return i.slice(e)}for(;(t=c())!==s;){for(var h=[];t!==a&&t!==s;)h.push(t),t=c();e&&null==(h=e(h,n++))||r.push(h)}return r},a.format=function(e){var r,n;return Array.isArray(e[0])?a.formatRows(e):(r=new ie,n=[],e.forEach(function(e){for(var t in e)r.has(t)||n.push(r.add(t))}),[n.map(u).join(i)].concat(e.map(function(t){return n.map(function(e){return u(t[e])}).join(i)})).join("\n"))},a.formatRows=function(e){return e.map(r).join("\n")},a},z.csv=z.dsv(",","text/csv"),z.tsv=z.dsv("\t","text/tab-separated-values");var At,It,Lt,Pt,zt=this[oe(this,"requestAnimationFrame")]||function(e){setTimeout(e,17)};function Dt(e,t,r){var n=arguments.length;n<2&&(t=0);n={c:e,t:(r=n<3?Date.now():r)+t,n:null};return It?It.n=n:At=n,It=n,Lt||(Pt=clearTimeout(Pt),Lt=1,zt(Ot)),n}function Ot(){var e=Rt(),e=Ft()-e;24<e?(isFinite(e)&&(clearTimeout(Pt),Pt=setTimeout(Ot,e)),Lt=0):(Lt=1,zt(Ot))}function Rt(){for(var e=Date.now(),t=At;t;)e>=t.t&&t.c(e-t.t)&&(t.c=null),t=t.n;return e}function Ft(){for(var e,t=At,r=1/0;t;)t=t.c?(t.t<r&&(r=t.t),(e=t).n):e?e.n=t.n:At=t.n;return It=e,r}function Bt(e,t){return t-(e?Math.ceil(Math.log(e)/Math.LN10):1)}z.timer=function(){Dt.apply(this,arguments)},z.timer.flush=function(){Rt(),Ft()},z.round=function(e,t){return t?Math.round(e*(t=Math.pow(10,t)))/t:Math.round(e)};var Nt=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(function(e,t){var r=Math.pow(10,3*L(8-t));return{scale:8<t?function(e){return e/r}:function(e){return e*r},symbol:e}});z.formatPrefix=function(e,t){var r=0;return(e=+e)&&(e<0&&(e*=-1),t&&(e=z.round(e,Bt(e,t))),r=1+Math.floor(1e-12+Math.log(e)/Math.LN10),r=Math.max(-24,Math.min(24,3*Math.floor((r-1)/3)))),Nt[8+r/3]};var jt=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,Ut=z.map({b:function(e){return e.toString(2)},c:function(e){return String.fromCharCode(e)},o:function(e){return e.toString(8)},x:function(e){return e.toString(16)},X:function(e){return e.toString(16).toUpperCase()},g:function(e,t){return e.toPrecision(t)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},r:function(e,t){return(e=z.round(e,Bt(e,t))).toFixed(Math.max(0,Math.min(20,Bt(e*(1+1e-15),t))))}});function Vt(e){return e+""}var w=z.time={},E=Date;function Gt(){this._=new Date(1<arguments.length?Date.UTC.apply(this,arguments):arguments[0])}Gt.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){Wt.setUTCDate.apply(this._,arguments)},setDay:function(){Wt.setUTCDay.apply(this._,arguments)},setFullYear:function(){Wt.setUTCFullYear.apply(this._,arguments)},setHours:function(){Wt.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){Wt.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){Wt.setUTCMinutes.apply(this._,arguments)},setMonth:function(){Wt.setUTCMonth.apply(this._,arguments)},setSeconds:function(){Wt.setUTCSeconds.apply(this._,arguments)},setTime:function(){Wt.setTime.apply(this._,arguments)}};var Wt=Date.prototype;function Zt(n,o,a){function e(e){var t=n(e),r=i(t,1);return e-t<r-e?t:r}function s(e){return o(e=n(new E(e-1)),1),e}function i(e,t){return o(e=new E(+e),t),e}function l(e,t,r){var n=s(e),i=[];if(1<r)for(;n<t;)a(n)%r||i.push(new Date(+n)),o(n,1);else for(;n<t;)i.push(new Date(+n)),o(n,1);return i}(n.floor=n).round=e,n.ceil=s,n.offset=i,n.range=l;var t=n.utc=qt(n);return(t.floor=t).round=qt(e),t.ceil=qt(s),t.offset=qt(i),t.range=function(e,t,r){try{var n=new(E=Gt);return n._=e,l(n,t,r)}finally{E=Date}},n}function qt(n){return function(e,t){try{var r=new(E=Gt);return r._=e,n(r,t)._}finally{E=Date}}}function Ht(e){var t=e.dateTime,r=e.date,n=e.time,i=e.periods,o=e.days,a=e.shortDays,s=e.months,l=e.shortMonths;function u(s){var l=s.length;function e(e){for(var t,r,n,i=[],o=-1,a=0;++o<l;)37===s.charCodeAt(o)&&(i.push(s.slice(a,o)),null!=(r=$t[t=s.charAt(++o)])&&(t=s.charAt(++o)),(n=x[t])&&(t=n(e,null==r?"e"===t?" ":"0":r)),i.push(t),a=o+1);return i.push(s.slice(a,o)),i.join("")}return e.parse=function(e){var t={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null};if(c(t,s,e,0)!=e.length)return null;"p"in t&&(t.H=t.H%12+12*t.p);var e=null!=t.Z&&E!==Gt,r=new(e?Gt:E);return"j"in t?r.setFullYear(t.y,0,t.j):"W"in t||"U"in t?("w"in t||(t.w="W"in t?1:0),r.setFullYear(t.y,0,1),r.setFullYear(t.y,0,"W"in t?(t.w+6)%7+7*t.W-(r.getDay()+5)%7:t.w+7*t.U-(r.getDay()+6)%7)):r.setFullYear(t.y,t.m,t.d),r.setHours(t.H+(t.Z/100|0),t.M+t.Z%100,t.S,t.L),e?r._:r},e.toString=function(){return s},e}function c(e,t,r,n){for(var i,o,a=0,s=t.length,l=r.length;a<s;){if(l<=n)return-1;if(37===(i=t.charCodeAt(a++))){if(o=t.charAt(a++),!(o=b[o in $t?t.charAt(a++):o])||(n=o(e,r,n))<0)return-1}else if(i!=r.charCodeAt(n++))return-1}return n}u.multi=(u.utc=function(e){var r=u(e);function t(e){try{var t=new(E=Gt);return t._=e,r(t)}finally{E=Date}}return t.parse=function(e){try{E=Gt;var t=r.parse(e);return t&&t._}finally{E=Date}},t.toString=r.toString,t}).multi=dr;var h=z.map(),f=Yt(o),d=Jt(o),p=Yt(a),m=Jt(a),g=Yt(s),y=Jt(s),v=Yt(l),_=Jt(l),x=(i.forEach(function(e,t){h.set(e.toLowerCase(),t)}),{a:function(e){return a[e.getDay()]},A:function(e){return o[e.getDay()]},b:function(e){return l[e.getMonth()]},B:function(e){return s[e.getMonth()]},c:u(t),d:function(e,t){return k(e.getDate(),t,2)},e:function(e,t){return k(e.getDate(),t,2)},H:function(e,t){return k(e.getHours(),t,2)},I:function(e,t){return k(e.getHours()%12||12,t,2)},j:function(e,t){return k(1+w.dayOfYear(e),t,3)},L:function(e,t){return k(e.getMilliseconds(),t,3)},m:function(e,t){return k(e.getMonth()+1,t,2)},M:function(e,t){return k(e.getMinutes(),t,2)},p:function(e){return i[+(12<=e.getHours())]},S:function(e,t){return k(e.getSeconds(),t,2)},U:function(e,t){return k(w.sundayOfYear(e),t,2)},w:function(e){return e.getDay()},W:function(e,t){return k(w.mondayOfYear(e),t,2)},x:u(r),X:u(n),y:function(e,t){return k(e.getFullYear()%100,t,2)},Y:function(e,t){return k(e.getFullYear()%1e4,t,4)},Z:hr,"%":function(){return"%"}}),b={a:function(e,t,r){p.lastIndex=0;t=p.exec(t.slice(r));return t?(e.w=m.get(t[0].toLowerCase()),r+t[0].length):-1},A:function(e,t,r){f.lastIndex=0;t=f.exec(t.slice(r));return t?(e.w=d.get(t[0].toLowerCase()),r+t[0].length):-1},b:function(e,t,r){v.lastIndex=0;t=v.exec(t.slice(r));return t?(e.m=_.get(t[0].toLowerCase()),r+t[0].length):-1},B:function(e,t,r){g.lastIndex=0;t=g.exec(t.slice(r));return t?(e.m=y.get(t[0].toLowerCase()),r+t[0].length):-1},c:function(e,t,r){return c(e,x.c.toString(),t,r)},d:or,e:or,H:sr,I:sr,j:ar,L:cr,m:ir,M:lr,p:function(e,t,r){t=h.get(t.slice(r,r+=2).toLowerCase());return null==t?-1:(e.p=t,r)},S:ur,U:Qt,w:Kt,W:er,x:function(e,t,r){return c(e,x.x.toString(),t,r)},X:function(e,t,r){return c(e,x.X.toString(),t,r)},y:rr,Y:tr,Z:nr,"%":fr};return u}w.year=Zt(function(e){return(e=w.day(e)).setMonth(0,1),e},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e){return e.getFullYear()}),w.years=w.year.range,w.years.utc=w.year.utc.range,w.day=Zt(function(e){var t=new E(2e3,0);return t.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),t},function(e,t){e.setDate(e.getDate()+t)},function(e){return e.getDate()-1}),w.days=w.day.range,w.days.utc=w.day.utc.range,w.dayOfYear=function(e){var t=w.year(e);return Math.floor((e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(e,r){r=7-r;var t=w[e]=Zt(function(e){return(e=w.day(e)).setDate(e.getDate()-(e.getDay()+r)%7),e},function(e,t){e.setDate(e.getDate()+7*Math.floor(t))},function(e){var t=w.year(e).getDay();return Math.floor((w.dayOfYear(e)+(t+r)%7)/7)-(t!==r)});w[e+"s"]=t.range,w[e+"s"].utc=t.utc.range,w[e+"OfYear"]=function(e){var t=w.year(e).getDay();return Math.floor((w.dayOfYear(e)+(t+r)%7)/7)}}),w.week=w.sunday,w.weeks=w.sunday.range,w.weeks.utc=w.sunday.utc.range,w.weekOfYear=w.sundayOfYear;var $t={"-":"",_:" ",0:"0"},s=/^\s*\d+/,Xt=/^%/;function k(e,t,r){var n=e<0?"-":"",e=(n?-e:e)+"",i=e.length;return n+(i<r?new Array(r-i+1).join(t)+e:e)}function Yt(e){return new RegExp("^(?:"+e.map(z.requote).join("|")+")","i")}function Jt(e){for(var t=new $,r=-1,n=e.length;++r<n;)t.set(e[r].toLowerCase(),r);return t}function Kt(e,t,r){s.lastIndex=0;t=s.exec(t.slice(r,r+1));return t?(e.w=+t[0],r+t[0].length):-1}function Qt(e,t,r){s.lastIndex=0;t=s.exec(t.slice(r));return t?(e.U=+t[0],r+t[0].length):-1}function er(e,t,r){s.lastIndex=0;t=s.exec(t.slice(r));return t?(e.W=+t[0],r+t[0].length):-1}function tr(e,t,r){s.lastIndex=0;t=s.exec(t.slice(r,r+4));return t?(e.y=+t[0],r+t[0].length):-1}function rr(e,t,r){s.lastIndex=0;t=s.exec(t.slice(r,r+2));return t?(e.y=(e=+t[0])+(68<e?1900:2e3),r+t[0].length):-1}function nr(e,t,r){return/^[+-]\d{4}$/.test(t=t.slice(r,r+5))?(e.Z=-t,r+5):-1}function ir(e,t,r){s.lastIndex=0;t=s.exec(t.slice(r,r+2));return t?(e.m=t[0]-1,r+t[0].length):-1}function or(e,t,r){s.lastIndex=0;t=s.exec(t.slice(r,r+2));return t?(e.d=+t[0],r+t[0].length):-1}function ar(e,t,r){s.lastIndex=0;t=s.exec(t.slice(r,r+3));return t?(e.j=+t[0],r+t[0].length):-1}function sr(e,t,r){s.lastIndex=0;t=s.exec(t.slice(r,r+2));return t?(e.H=+t[0],r+t[0].length):-1}function lr(e,t,r){s.lastIndex=0;t=s.exec(t.slice(r,r+2));return t?(e.M=+t[0],r+t[0].length):-1}function ur(e,t,r){s.lastIndex=0;t=s.exec(t.slice(r,r+2));return t?(e.S=+t[0],r+t[0].length):-1}function cr(e,t,r){s.lastIndex=0;t=s.exec(t.slice(r,r+3));return t?(e.L=+t[0],r+t[0].length):-1}function hr(e){var e=e.getTimezoneOffset(),t=0<e?"-":"+",r=L(e)/60|0,e=L(e)%60;return t+k(r,"0",2)+k(e,"0",2)}function fr(e,t,r){Xt.lastIndex=0;t=Xt.exec(t.slice(r,r+1));return t?r+t[0].length:-1}function dr(n){for(var e=n.length,t=-1;++t<e;)n[t][0]=this(n[t][0]);return function(e){for(var t=0,r=n[t];!r[1](e);)r=n[++t];return r[0](e)}}z.locale=function(e){return{numberFormat:(b=e.decimal,s=e.thousands,l=e.grouping,r=e.currency,w=l&&s?function(e,t){for(var r=e.length,n=[],i=0,o=l[0],a=0;0<r&&0<o&&(t<a+o+1&&(o=Math.max(1,t-a)),n.push(e.substring(r-=o,r+o)),!((a+=o+1)>t));)o=l[i=(i+1)%l.length];return n.reverse().join(s)}:I,function(e){var e=jt.exec(e),s=e[1]||" ",l=e[2]||">",u=e[3]||"-",t=e[4]||"",c=e[5],h=+e[6],f=e[7],d=e[8],p=e[9],m=1,g="",y="",v=!1,_=!0,d=d&&+d.substring(1);switch((c||"0"===s&&"="===l)&&(c=s="0",l="="),p){case"n":f=!0,p="g";break;case"%":m=100,y="%",p="f";break;case"p":m=100,y="%",p="r";break;case"b":case"o":case"x":case"X":"#"===t&&(g="0"+p.toLowerCase());case"c":_=!1;case"d":v=!0,d=0;break;case"s":m=-1,p="r"}"$"===t&&(g=r[0],y=r[1]),"r"!=p||d||(p="g"),null!=d&&("g"==p?d=Math.max(1,Math.min(21,d)):"e"!=p&&"f"!=p||(d=Math.max(0,Math.min(20,d))));var p=Ut.get(p)||Vt,x=c&&f;return function(e){var t,r,n,i,o,a=y;return v&&e%1?"":(t=e<0||0===e&&1/e<0?(e=-e,"-"):"-"===u?"":u,m<0?(e=(i=z.formatPrefix(e,d)).scale(e),a=i.symbol+y):e*=m,n=(i=(e=p(e,d)).lastIndexOf("."))<0?(n=_?e.lastIndexOf("e"):-1)<0?(r=e,""):(r=e.substring(0,n),e.substring(n)):(r=e.substring(0,i),b+e.substring(i+1)),!c&&f&&(r=w(r,1/0)),o=(i=g.length+r.length+n.length+(x?0:t.length))<h?new Array(i=h-i+1).join(s):"",x&&(r=w(o+r,o.length?h-n.length:1/0)),t+=g,e=r+n,("<"===l?t+e+o:">"===l?o+t+e:"^"===l?o.substring(0,i>>=1)+t+e+o.substring(i):t+(x?e:o+e))+a)}}),timeFormat:Ht(e)};var b,s,l,r,w};r=z.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function pr(){}z.format=r.numberFormat,z.geo={},pr.prototype={s:0,t:0,add:function(e){gr(e,this.t,mr),gr(mr.s,this.s,this),this.s?this.t+=mr.t:this.s=mr.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var mr=new pr;function gr(e,t,r){var n=r.s=e+t,i=n-e;r.t=e-(n-i)+(t-i)}function yr(e,t){e&&_r.hasOwnProperty(e.type)&&_r[e.type](e,t)}z.geo.stream=function(e,t){e&&vr.hasOwnProperty(e.type)?vr[e.type](e,t):yr(e,t)};var vr={Feature:function(e,t){yr(e.geometry,t)},FeatureCollection:function(e,t){for(var r=e.features,n=-1,i=r.length;++n<i;)yr(r[n].geometry,t)}},_r={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)e=r[n],t.point(e[0],e[1],e[2])},LineString:function(e,t){xr(e.coordinates,t,0)},MultiLineString:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)xr(r[n],t,0)},Polygon:function(e,t){br(e.coordinates,t)},MultiPolygon:function(e,t){for(var r=e.coordinates,n=-1,i=r.length;++n<i;)br(r[n],t)},GeometryCollection:function(e,t){for(var r=e.geometries,n=-1,i=r.length;++n<i;)yr(r[n],t)}};function xr(e,t,r){var n,i=-1,o=e.length-r;for(t.lineStart();++i<o;)n=e[i],t.point(n[0],n[1],n[2]);t.lineEnd()}function br(e,t){var r=-1,n=e.length;for(t.polygonStart();++r<n;)xr(e[r],t,1);t.polygonEnd()}z.geo.area=function(e){return wr=0,z.geo.stream(e,g),wr};var wr,u,c,h,d,Er,Tr,Sr,Mr,kr,Cr,Ar,p,Ir,Lr,Pr,zr,Dr,Or,Rr,m,Fr,Br,Nr,jr=new pr,g={sphere:function(){wr+=4*O},point:l,lineStart:l,lineEnd:l,polygonStart:function(){jr.reset(),g.lineStart=Ur},polygonEnd:function(){var e=2*jr;wr+=e<0?4*O+e:e,g.lineStart=g.lineEnd=g.point=l}};function Ur(){var r,n,s,l,u;function i(e,t){t=t*T/2+O/4;var r=(e*=T)-s,n=0<=r?1:-1,r=n*r,i=Math.cos(t),t=Math.sin(t),o=u*t,a=l*i+o*Math.cos(r),o=o*n*Math.sin(r);jr.add(Math.atan2(o,a)),s=e,l=i,u=t}g.point=function(e,t){g.point=i,s=(r=e)*T,l=Math.cos(t=(n=t)*T/2+O/4),u=Math.sin(t)},g.lineEnd=function(){i(r,n)}}function Vr(e){var t=e[0],e=e[1],r=Math.cos(e);return[r*Math.cos(t),r*Math.sin(t),Math.sin(e)]}function Gr(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Wr(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Zr(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function qr(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Hr(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function $r(e){return[Math.atan2(e[1],e[0]),Ke(e[2])]}function Xr(e,t){return L(e[0]-t[0])<P&&L(e[1]-t[1])<P}function Yr(e,t){Cr.push(Ar=[u=e,h=e]),t<c&&(c=t),d<t&&(d=t)}function Jr(e,t){var r,n,i,o,a,s=Vr([e*T,t*T]);Mr?(r=Wr(Mr,s),Hr(r=Wr([r[1],-r[0],0],r)),r=$r(r),o=e-Er,i=r[0]*M*(n=0<o?1:-1),(o=180<L(o))^(n*Er<i&&i<n*e)?(a=r[1]*M,d<a&&(d=a)):o^(n*Er<(i=(360+i)%360-180)&&i<n*e)?(a=-r[1]*M)<c&&(c=a):(t<c&&(c=t),d<t&&(d=t)),o?e<Er?y(u,e)>y(u,h)&&(h=e):y(e,h)>y(u,h)&&(u=e):u<=h?(e<u&&(u=e),h<e&&(h=e)):Er<e?y(u,e)>y(u,h)&&(h=e):y(e,h)>y(u,h)&&(u=e)):Yr(e,t),Mr=s,Er=e}function Kr(){p.point=Jr}function Qr(){Ar[0]=u,Ar[1]=h,p.point=Yr,Mr=null}function en(e,t){var r;Mr?kr+=180<L(r=e-Er)?r+(0<r?360:-360):r:(Tr=e,Sr=t),g.point(e,t),Jr(e,t)}function tn(){g.lineStart()}function rn(){en(Tr,Sr),g.lineEnd(),L(kr)>P&&(u=-(h=180)),Ar[0]=u,Ar[1]=h,Mr=null}function y(e,t){return(t-=e)<0?t+360:t}function nn(e,t){return e[0]-t[0]}function on(e,t){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}z.geo.bounds=(p={point:Yr,lineStart:Kr,lineEnd:Qr,polygonStart:function(){p.point=en,p.lineStart=tn,p.lineEnd=rn,kr=0,g.polygonStart()},polygonEnd:function(){g.polygonEnd(),p.point=Yr,p.lineStart=Kr,p.lineEnd=Qr,jr<0?(u=-(h=180),c=-(d=90)):P<kr?d=90:kr<-P&&(c=-90),Ar[0]=u,Ar[1]=h}},function(e){if(d=h=-(u=c=1/0),Cr=[],z.geo.stream(e,p),i=Cr.length){Cr.sort(nn);for(var t=1,r=[s=Cr[0]];t<i;++t)on((o=Cr[t])[0],s)||on(o[1],s)?(y(s[0],o[1])>y(s[0],s[1])&&(s[1]=o[1]),y(o[0],s[1])>y(s[0],s[1])&&(s[0]=o[0])):r.push(s=o);for(var n,i,o,a=-1/0,t=0,s=r[i=r.length-1];t<=i;s=o,++t)(n=y(s[1],(o=r[t])[0]))>a&&(a=n,u=o[0],h=s[1])}return Cr=Ar=null,u===1/0||c===1/0?[[NaN,NaN],[NaN,NaN]]:[[u,c],[h,d]]}),z.geo.centroid=function(e){Ir=Lr=Pr=zr=Dr=Or=Rr=m=Fr=Br=Nr=0,z.geo.stream(e,v);var e=Fr,t=Br,r=Nr,n=e*e+t*t+r*r;return n<He&&(e=Or,t=Rr,r=m,Lr<P&&(e=Pr,t=zr,r=Dr),(n=e*e+t*t+r*r)<He)?[NaN,NaN]:[Math.atan2(t,e)*M,Ke(r/Math.sqrt(n))*M]};var v={sphere:l,point:an,lineStart:ln,lineEnd:un,polygonStart:function(){v.lineStart=cn},polygonEnd:function(){v.lineStart=ln}};function an(e,t){e*=T;var r=Math.cos(t*=T);sn(r*Math.cos(e),r*Math.sin(e),Math.sin(t))}function sn(e,t,r){Pr+=(e-Pr)/++Ir,zr+=(t-zr)/Ir,Dr+=(r-Dr)/Ir}function ln(){var i,o,a;function n(e,t){e*=T;var r=Math.cos(t*=T),n=r*Math.cos(e),r=r*Math.sin(e),e=Math.sin(t),t=Math.atan2(Math.sqrt((t=o*e-a*r)*t+(t=a*n-i*e)*t+(t=i*r-o*n)*t),i*n+o*r+a*e);Lr+=t,Or+=t*(i+(i=n)),Rr+=t*(o+(o=r)),m+=t*(a+(a=e)),sn(i,o,a)}v.point=function(e,t){e*=T;var r=Math.cos(t*=T);i=r*Math.cos(e),o=r*Math.sin(e),a=Math.sin(t),v.point=n,sn(i,o,a)}}function un(){v.point=an}function cn(){var n,i,u,c,h;function o(e,t){e*=T;var r=Math.cos(t*=T),n=r*Math.cos(e),r=r*Math.sin(e),e=Math.sin(t),t=c*e-h*r,i=h*n-u*e,o=u*r-c*n,a=Math.sqrt(t*t+i*i+o*o),s=u*n+c*r+h*e,l=a&&-Je(s)/a,a=Math.atan2(a,s);Fr+=l*t,Br+=l*i,Nr+=l*o,Lr+=a,Or+=a*(u+(u=n)),Rr+=a*(c+(c=r)),m+=a*(h+(h=e)),sn(u,c,h)}v.point=function(e,t){n=e,i=t,v.point=o,e*=T;var r=Math.cos(t*=T);u=r*Math.cos(e),c=r*Math.sin(e),h=Math.sin(t),sn(u,c,h)},v.lineEnd=function(){o(n,i),v.lineEnd=un,v.point=an}}function hn(r,n){function e(e,t){return e=r(e,t),n(e[0],e[1])}return r.invert&&n.invert&&(e.invert=function(e,t){return(e=n.invert(e,t))&&r.invert(e[0],e[1])}),e}function fn(){return!0}function dn(e,t,r,n,s){var l=[],u=[];if(e.forEach(function(e){if(!((t=e.length-1)<=0)){var t,r=e[0],n=e[t];if(Xr(r,n)){s.lineStart();for(var i=0;i<t;++i)s.point((r=e[i])[0],r[1]);s.lineEnd()}else{var o=new mn(r,e,null,!0),a=new mn(r,null,o,!1);o.o=a,l.push(o),u.push(a),o=new mn(n,e,null,!1),a=new mn(n,null,o,!0),o.o=a,l.push(o),u.push(a)}}}),u.sort(t),pn(l),pn(u),l.length){for(var i=0,o=r,a=u.length;i<a;++i)u[i].e=o=!o;for(var c,h=l[0];;){for(var f=h,d=!0;f.v;)if((f=f.n)===h)return;p=f.z,s.lineStart();do{if(f.v=f.o.v=!0,f.e){if(d)for(i=0,a=p.length;i<a;++i)s.point((c=p[i])[0],c[1]);else n(f.x,f.n.x,1,s);f=f.n}else{if(d)for(var p,i=(p=f.p.z).length-1;0<=i;--i)s.point((c=p[i])[0],c[1]);else n(f.x,f.p.x,-1,s);f=f.p}}while(p=(f=f.o).z,d=!d,!f.v);s.lineEnd()}}}function pn(e){if(t=e.length){for(var t,r,n=0,i=e[0];++n<t;)i.n=r=e[n],r.p=i,i=r;i.n=r=e[0],r.p=i}}function mn(e,t,r,n){this.x=e,this.z=t,this.o=r,this.e=n,this.v=!1,this.n=this.p=null}function gn(v,_,x,b){return function(n,a){var s,r=_(a),t=n.invert(b[0],b[1]),i={point:o,lineStart:l,lineEnd:u,polygonStart:function(){i.point=m,i.lineStart=g,i.lineEnd=y,s=[],c=[]},polygonEnd:function(){i.point=o,i.lineStart=l,i.lineEnd=u,s=z.merge(s);var e=function(e,t){var r=e[0],n=e[1],i=[Math.sin(r),-Math.cos(r),0],o=0,a=0;jr.reset();for(var s=0,l=t.length;s<l;++s){var u=t[s],c=u.length;if(c)for(var h=u[0],f=h[0],d=h[1]/2+O/4,p=Math.sin(d),m=Math.cos(d),g=1;;){var y=(e=u[g=g===c?0:g])[0],v=e[1]/2+O/4,_=Math.sin(v),v=Math.cos(v),x=y-f,b=0<=x?1:-1,w=b*x,E=O<w,T=p*_;if(jr.add(Math.atan2(T*b*Math.sin(w),m*v+T*Math.cos(w))),o+=E?x+b*S:x,E^r<=f^r<=y&&(Hr(T=Wr(Vr(h),Vr(e))),Hr(w=Wr(i,T)),((b=(E^0<=x?-1:1)*Ke(w[2]))<n||n===b&&(T[0]||T[1]))&&(a+=E^0<=x?1:-1)),!g++)break;f=y,p=_,m=v,h=e}}return(o<-P||o<P&&jr<-P)^1&a}(t,c);s.length?(p||(a.polygonStart(),p=!0),dn(s,_n,e,x,a)):e&&(p||(a.polygonStart(),p=!0),a.lineStart(),x(null,null,1,a),a.lineEnd()),p&&(a.polygonEnd(),p=!1),s=c=null},sphere:function(){a.polygonStart(),a.lineStart(),x(null,null,1,a),a.lineEnd(),a.polygonEnd()}};function o(e,t){var r=n(e,t);v(e=r[0],t=r[1])&&a.point(e,t)}function e(e,t){e=n(e,t);r.point(e[0],e[1])}function l(){i.point=e,r.lineStart()}function u(){i.point=o,r.lineEnd()}var c,h,f=vn(),d=_(f),p=!1;function m(e,t){h.push([e,t]);e=n(e,t);d.point(e[0],e[1])}function g(){d.lineStart(),h=[]}function y(){m(h[0][0],h[0][1]),d.lineEnd();var e=d.clean(),t=f.buffer(),r=t.length;if(h.pop(),c.push(h),h=null,r)if(1&e){var n,i,o=-1;if(0<(r=(n=t[0]).length-1)){for(p||(a.polygonStart(),p=!0),a.lineStart();++o<r;)a.point((i=n[o])[0],i[1]);a.lineEnd()}}else 1<r&&2&e&&t.push(t.pop().concat(t.shift())),s.push(t.filter(yn))}return i}}function yn(e){return 1<e.length}function vn(){var r,t=[];return{lineStart:function(){t.push(r=[])},point:function(e,t){r.push([e,t])},lineEnd:l,buffer:function(){var e=t;return t=[],r=null,e},rejoin:function(){1<t.length&&t.push(t.pop().concat(t.shift()))}}}function _n(e,t){return((e=e.x)[0]<0?e[1]-R-P:R-e[1])-((t=t.x)[0]<0?t[1]-R-P:R-t[1])}var xn=gn(fn,function(u){var c,h=NaN,f=NaN,d=NaN;return{lineStart:function(){u.lineStart(),c=1},point:function(e,t){var r,n,i,o,a,s=0<e?O:-O,l=L(e-h);L(l-O)<P?(u.point(h,f=0<(f+t)/2?R:-R),u.point(d,f),u.lineEnd(),u.lineStart(),u.point(s,f),u.point(e,f),c=0):d!==s&&O<=l&&(L(h-d)<P&&(h-=d*P),L(e-s)<P&&(e-=s*P),l=h,r=f,n=e,i=t,a=Math.sin(l-n),f=L(a)>P?Math.atan((Math.sin(r)*(o=Math.cos(i))*Math.sin(n)-Math.sin(i)*(n=Math.cos(r))*Math.sin(l))/(n*o*a)):(r+i)/2,u.point(d,f),u.lineEnd(),u.lineStart(),u.point(s,f),c=0),u.point(h=e,f=t),d=s},lineEnd:function(){u.lineEnd(),h=f=NaN},clean:function(){return 2-c}}},function(e,t,r,n){var i;null==e?(i=r*R,n.point(-O,i),n.point(0,i),n.point(O,i),n.point(O,0),n.point(O,-i),n.point(0,-i),n.point(-O,-i),n.point(-O,0),n.point(-O,i)):L(e[0]-t[0])>P?(e=e[0]<t[0]?O:-O,i=r*e/2,n.point(-e,i),n.point(0,i),n.point(e,i)):n.point(t[0],t[1])},[-O,-O/2]);function bn(i){var m=Math.cos(i),h=0<m,f=L(m)>P;return gn(d,function(o){var a,s,l,u,c;return{lineStart:function(){u=l=!1,c=1},point:function(e,t){var r,n=[e,t],i=d(e,t),e=h?i?0:g(e,t):i?g(e+(e<0?O:-O),t):0;!a&&(u=l=i)&&o.lineStart(),i!==l&&(r=p(a,n),(Xr(a,r)||Xr(n,r))&&(n[0]+=P,n[1]+=P,i=d(n[0],n[1]))),i!==l?(c=0,i?(o.lineStart(),r=p(n,a),o.point(r[0],r[1])):(r=p(a,n),o.point(r[0],r[1]),o.lineEnd()),a=r):f&&a&&h^i&&(e&s||!(t=p(n,a,!0))||(c=0,h?(o.lineStart(),o.point(t[0][0],t[0][1]),o.point(t[1][0],t[1][1]),o.lineEnd()):(o.point(t[1][0],t[1][1]),o.lineEnd(),o.lineStart(),o.point(t[0][0],t[0][1])))),!i||a&&Xr(a,n)||o.point(n[0],n[1]),a=n,l=i,s=e},lineEnd:function(){l&&o.lineEnd(),a=null},clean:function(){return c|(u&&l)<<1}}},ri(i,6*T),h?[0,-i]:[-O,i-O]);function d(e,t){return Math.cos(e)*Math.cos(t)>m}function p(e,t,r){var n,i,o,a,s,l,u,c=[1,0,0],h=Wr(Vr(e),Vr(t)),f=Gr(h,h),d=h[0],p=f-d*d;return p?(n=Wr(c,h),Zr(c=qr(c,m*f/p),qr(h,-m*d/p)),(p=(h=Gr(c,f=n))*h-(d=Gr(f,f))*(Gr(c,c)-1))<0?void 0:(Zr(p=qr(f,(-h-(n=Math.sqrt(p)))/d),c),p=$r(p),r?(i=e[0],o=t[0],a=e[1],t=t[1],o<i&&(u=i,i=o,o=u),!(l=L((s=o-i)-O)<P)&&t<a&&(u=a,a=t,t=u),(l||s<P?l?0<a+t^p[1]<(L(p[0]-i)<P?a:t):a<=p[1]&&p[1]<=t:O<s^(i<=p[0]&&p[0]<=o))?(Zr(u=qr(f,(-h+n)/d),c),[p,$r(u)]):void 0):p)):!r&&e}function g(e,t){var r=h?i:O-i,n=0;return e<-r?n|=1:r<e&&(n|=2),t<-r?n|=4:r<t&&(n|=8),n}}function wn(l,u,c,h){return function(e){var t=e.a,r=e.b,n=t.x,t=t.y,i=0,o=1,a=r.x-n,r=r.y-t,s=l-n;if(a||!(0<s)){if(s/=a,a<0){if(s<i)return;s<o&&(o=s)}else if(0<a){if(o<s)return;i<s&&(i=s)}if(s=c-n,a||!(s<0)){if(s/=a,a<0){if(o<s)return;i<s&&(i=s)}else if(0<a){if(s<i)return;s<o&&(o=s)}if(s=u-t,r||!(0<s)){if(s/=r,r<0){if(s<i)return;s<o&&(o=s)}else if(0<r){if(o<s)return;i<s&&(i=s)}if(s=h-t,r||!(s<0)){if(s/=r,r<0){if(o<s)return;i<s&&(i=s)}else if(0<r){if(s<i)return;s<o&&(o=s)}return 0<i&&(e.a={x:n+i*a,y:t+i*r}),o<1&&(e.b={x:n+o*a,y:t+o*r}),e}}}}}}var En=1e9;function Tn(x,b,w,E){return function(i){var n,c,o,a,s,l,u,h,f,d,p,m=i,e=vn(),g=wn(x,b,w,E),t={point:r,lineStart:function(){t.point=_,c&&c.push(o=[]);d=!0,f=!1,u=h=NaN},lineEnd:function(){n&&(_(a,s),l&&f&&e.rejoin(),n.push(e.buffer()));t.point=r,f&&i.lineEnd()},polygonStart:function(){i=e,n=[],c=[],p=!0},polygonEnd:function(){i=m,n=z.merge(n);var e=function(e){for(var t=0,r=c.length,n=e[1],i=0;i<r;++i)for(var o,a=1,s=c[i],l=s.length,u=s[0];a<l;++a)o=s[a],u[1]<=n?o[1]>n&&0<Ye(u,o,e)&&++t:o[1]<=n&&Ye(u,o,e)<0&&--t,u=o;return 0!==t}([x,E]),t=p&&e,r=n.length;(t||r)&&(i.polygonStart(),t&&(i.lineStart(),y(null,null,1,i),i.lineEnd()),r&&dn(n,S,e,y,i),i.polygonEnd()),n=c=o=null}};function y(e,t,r,n){var i=0,o=0;if(null==e||(i=T(e,r))!==(o=T(t,r))||M(e,t)<0^0<r)for(;n.point(0===i||3===i?x:w,1<i?E:b),(i=(i+r+4)%4)!==o;);else n.point(t[0],t[1])}function v(e,t){return x<=e&&e<=w&&b<=t&&t<=E}function r(e,t){v(e,t)&&i.point(e,t)}function _(e,t){var r,n=v(e=Math.max(-En,Math.min(En,e)),t=Math.max(-En,Math.min(En,t)));c&&o.push([e,t]),d?(a=e,s=t,d=!1,(l=n)&&(i.lineStart(),i.point(e,t))):n&&f?i.point(e,t):g(r={a:{x:u,y:h},b:{x:e,y:t}})?(f||(i.lineStart(),i.point(r.a.x,r.a.y)),i.point(r.b.x,r.b.y),n||i.lineEnd(),p=!1):n&&(i.lineStart(),i.point(e,t),p=!1),u=e,h=t,f=n}return t};function T(e,t){return L(e[0]-x)<P?0<t?0:3:L(e[0]-w)<P?0<t?2:1:L(e[1]-b)<P?0<t?1:0:0<t?3:2}function S(e,t){return M(e.x,t.x)}function M(e,t){var r=T(e,1),n=T(t,1);return r!==n?r-n:0===r?t[1]-e[1]:1===r?e[0]-t[0]:2===r?e[1]-t[1]:t[0]-e[0]}}function Sn(e){var t=0,r=O/3,n=$n(e),e=n(t,r);return e.parallels=function(e){return arguments.length?n(t=e[0]*O/180,r=e[1]*O/180):[t/O*180,r/O*180]},e}function Mn(e,t){var e=Math.sin(e),r=(e+Math.sin(t))/2,n=1+e*(2*r-e),i=Math.sqrt(n)/r;function o(e,t){t=Math.sqrt(n-2*r*Math.sin(t))/r;return[t*Math.sin(e*=r),i-t*Math.cos(e)]}return o.invert=function(e,t){t=i-t;return[Math.atan2(e,t)/r,Ke((n-(e*e+t*t)*r*r)/(2*r))]},o}z.geo.clipExtent=function(){var t,r,n,i,o,a,s={stream:function(e){return o&&(o.valid=!1),(o=a(e)).valid=!0,o},extent:function(e){return arguments.length?(a=Tn(t=+e[0][0],r=+e[0][1],n=+e[1][0],i=+e[1][1]),o&&(o.valid=!1,o=null),s):[[t,r],[n,i]]}};return s.extent([[0,0],[960,500]])},(z.geo.conicEqualArea=function(){return Sn(Mn)}).raw=Mn,z.geo.albers=function(){return z.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},z.geo.albersUsa=function(){var r,i,o,a,s=z.geo.albers(),l=z.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),u=z.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),c={point:function(e,t){r=[e,t]}};function h(e){var t=e[0],e=e[1];return r=null,i(t,e),r||(o(t,e),r||a(t,e)),r}return h.invert=function(e){var t=s.scale(),r=s.translate(),n=(e[0]-r[0])/t,r=(e[1]-r[1])/t;return(.12<=r&&r<.234&&-.425<=n&&n<-.214?l:.166<=r&&r<.234&&-.214<=n&&n<-.115?u:s).invert(e)},h.stream=function(e){var r=s.stream(e),n=l.stream(e),i=u.stream(e);return{point:function(e,t){r.point(e,t),n.point(e,t),i.point(e,t)},sphere:function(){r.sphere(),n.sphere(),i.sphere()},lineStart:function(){r.lineStart(),n.lineStart(),i.lineStart()},lineEnd:function(){r.lineEnd(),n.lineEnd(),i.lineEnd()},polygonStart:function(){r.polygonStart(),n.polygonStart(),i.polygonStart()},polygonEnd:function(){r.polygonEnd(),n.polygonEnd(),i.polygonEnd()}}},h.precision=function(e){return arguments.length?(s.precision(e),l.precision(e),u.precision(e),h):s.precision()},h.scale=function(e){return arguments.length?(s.scale(e),l.scale(.35*e),u.scale(e),h.translate(s.translate())):s.scale()},h.translate=function(e){var t,r,n;return arguments.length?(t=s.scale(),r=+e[0],n=+e[1],i=s.translate(e).clipExtent([[r-.455*t,n-.238*t],[r+.455*t,n+.238*t]]).stream(c).point,o=l.translate([r-.307*t,n+.201*t]).clipExtent([[r-.425*t+P,n+.12*t+P],[r-.214*t-P,n+.234*t-P]]).stream(c).point,a=u.translate([r-.205*t,n+.212*t]).clipExtent([[r-.214*t+P,n+.166*t+P],[r-.115*t-P,n+.234*t-P]]).stream(c).point,h):s.translate()},h.scale(1070)};var kn,Cn,An,In,Ln,Pn,zn={point:l,lineStart:l,lineEnd:l,polygonStart:function(){Cn=0,zn.lineStart=Dn},polygonEnd:function(){zn.lineStart=zn.lineEnd=zn.point=l,kn+=L(Cn/2)}};function Dn(){var r,n,i,o;function a(e,t){Cn+=o*e-i*t,i=e,o=t}zn.point=function(e,t){zn.point=a,r=i=e,n=o=t},zn.lineEnd=function(){a(r,n)}}var On={point:function(e,t){e<An&&(An=e);Ln<e&&(Ln=e);t<In&&(In=t);Pn<t&&(Pn=t)},lineStart:l,lineEnd:l,polygonStart:l,polygonEnd:l};function Rn(){var r=Fn(4.5),n=[],i={point:e,lineStart:function(){i.point=t},lineEnd:a,polygonStart:function(){i.lineEnd=s},polygonEnd:function(){i.lineEnd=a,i.point=e},pointRadius:function(e){return r=Fn(e),i},result:function(){var e;if(n.length)return e=n.join(""),n=[],e}};function e(e,t){n.push("M",e,",",t,r)}function t(e,t){n.push("M",e,",",t),i.point=o}function o(e,t){n.push("L",e,",",t)}function a(){i.point=e}function s(){n.push("Z")}return i}function Fn(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}var Bn,_={point:Nn,lineStart:jn,lineEnd:Un,polygonStart:function(){_.lineStart=Vn},polygonEnd:function(){_.point=Nn,_.lineStart=jn,_.lineEnd=Un}};function Nn(e,t){Pr+=e,zr+=t,++Dr}function jn(){var i,o;function r(e,t){var r=e-i,n=t-o,r=Math.sqrt(r*r+n*n);Or+=r*(i+e)/2,Rr+=r*(o+t)/2,m+=r,Nn(i=e,o=t)}_.point=function(e,t){_.point=r,Nn(i=e,o=t)}}function Un(){_.point=Nn}function Vn(){var r,n,i,o;function a(e,t){var r=e-i,n=t-o,r=Math.sqrt(r*r+n*n);Or+=r*(i+e)/2,Rr+=r*(o+t)/2,m+=r,Fr+=(r=o*e-i*t)*(i+e),Br+=r*(o+t),Nr+=3*r,Nn(i=e,o=t)}_.point=function(e,t){_.point=a,Nn(r=i=e,n=o=t)},_.lineEnd=function(){a(r,n)}}function Gn(r){var n=4.5,i={point:e,lineStart:function(){i.point=t},lineEnd:a,polygonStart:function(){i.lineEnd=s},polygonEnd:function(){i.lineEnd=a,i.point=e},pointRadius:function(e){return n=e,i},result:l};function e(e,t){r.moveTo(e+n,t),r.arc(e,t,n,0,S)}function t(e,t){r.moveTo(e,t),i.point=o}function o(e,t){r.lineTo(e,t)}function a(){i.point=e}function s(){r.closePath()}return i}function Wn(k){var C=.5,A=Math.cos(30*T),b=16;function t(e){return(b?n:r)(e)}function r(r){return qn(r,function(e,t){e=k(e,t),r.point(e[0],e[1])})}function n(n){var r,i,o,a,s,l,u,c,h,f,d,p,m={point:e,lineStart:t,lineEnd:y,polygonStart:function(){n.polygonStart(),m.lineStart=v},polygonEnd:function(){n.polygonEnd(),m.lineStart=t}};function e(e,t){e=k(e,t),n.point(e[0],e[1])}function t(){c=NaN,m.point=g,n.lineStart()}function g(e,t){var r=Vr([e,t]),t=k(e,t);I(c,h,u,f,d,p,c=t[0],h=t[1],u=e,f=r[0],d=r[1],p=r[2],b,n),n.point(c,h)}function y(){m.point=e,n.lineEnd()}function v(){t(),m.point=_,m.lineEnd=x}function _(e,t){g(r=e,t),i=c,o=h,a=f,s=d,l=p,m.point=g}function x(){I(c,h,u,f,d,p,i,o,r,a,s,l,b,n),m.lineEnd=y,y()}return m}function I(e,t,r,n,i,o,a,s,l,u,c,h,f,d){var p,m,g,y,v,_,x,b,w,E,T=a-e,S=s-t,M=T*T+S*S;4*C<M&&f--&&(p=n+u,m=i+c,g=o+h,y=Math.sqrt(p*p+m*m+g*g),x=Math.asin(g/=y),v=L(L(g)-1)<P||L(r-l)<P?(r+l)/2:Math.atan2(m,p),_=(x=k(v,x))[0],x=x[1],(C<(E=S*(b=_-e)-T*(w=x-t))*E/M||.3<L((T*b+S*w)/M-.5)||n*u+i*c+o*h<A)&&(I(e,t,r,n,i,o,_,x,v,p/=y,m/=y,g,f,d),d.point(_,x),I(_,x,v,p,m,g,a,s,l,u,c,h,f,d)))}return t.precision=function(e){return arguments.length?(b=0<(C=e*e)&&16,t):Math.sqrt(C)},t}function Zn(e){this.stream=e}function qn(e,t){return{point:t,sphere:function(){e.sphere()},lineStart:function(){e.lineStart()},lineEnd:function(){e.lineEnd()},polygonStart:function(){e.polygonStart()},polygonEnd:function(){e.polygonEnd()}}}function Hn(e){return $n(function(){return e})()}function $n(e){var r,t,n,i,o,a,s=Wn(function(e,t){return[(e=r(e,t))[0]*l+i,o-e[1]*l]}),l=150,u=480,c=250,h=0,f=0,d=0,p=0,m=0,g=xn,y=I,v=null,_=null;function x(e){return[(e=n(e[0]*T,e[1]*T))[0]*l+i,o-e[1]*l]}function b(e){return(e=n.invert((e[0]-i)/l,(o-e[1])/l))&&[e[0]*M,e[1]*M]}function w(){n=hn(t=Kn(d,p,m),r);var e=r(h,f);return i=u-e[0]*l,o=c+e[1]*l,E()}function E(){return a&&(a.valid=!1,a=null),x}return x.stream=function(e){return a&&(a.valid=!1),(a=Xn(g(t,s(y(e))))).valid=!0,a},x.clipAngle=function(e){return arguments.length?(g=null==e?(v=e,xn):bn((v=+e)*T),E()):v},x.clipExtent=function(e){return arguments.length?(y=(_=e)?Tn(e[0][0],e[0][1],e[1][0],e[1][1]):I,E()):_},x.scale=function(e){return arguments.length?(l=+e,w()):l},x.translate=function(e){return arguments.length?(u=+e[0],c=+e[1],w()):[u,c]},x.center=function(e){return arguments.length?(h=e[0]%360*T,f=e[1]%360*T,w()):[h*M,f*M]},x.rotate=function(e){return arguments.length?(d=e[0]%360*T,p=e[1]%360*T,m=2<e.length?e[2]%360*T:0,w()):[d*M,p*M,m*M]},z.rebind(x,s,"precision"),function(){return r=e.apply(this,arguments),x.invert=r.invert&&b,w()}}function Xn(r){return qn(r,function(e,t){r.point(e*T,t*T)})}function Yn(e,t){return[e,t]}function Jn(e,t){return[O<e?e-S:e<-O?e+S:e,t]}function Kn(e,t,r){return e?t||r?hn(ei(e),ti(t,r)):ei(e):t||r?ti(t,r):Jn}function Qn(r){return function(e,t){return[O<(e+=r)?e-S:e<-O?e+S:e,t]}}function ei(e){var t=Qn(e);return t.invert=Qn(-e),t}function ti(e,t){var i=Math.cos(e),o=Math.sin(e),a=Math.cos(t),s=Math.sin(t);function r(e,t){var r=Math.cos(t),n=Math.cos(e)*r,e=Math.sin(e)*r,r=Math.sin(t),t=r*i+n*o;return[Math.atan2(e*a-t*s,n*i-r*o),Ke(t*a+e*s)]}return r.invert=function(e,t){var r=Math.cos(t),n=Math.cos(e)*r,e=Math.sin(e)*r,r=Math.sin(t),t=r*a-e*s;return[Math.atan2(e*a+r*s,n*i+t*o),Ke(t*i-n*o)]},r}function ri(s,l){var u=Math.cos(s),c=Math.sin(s);return function(e,t,r,n){var i=r*l;null!=e?(e=ni(u,e),t=ni(u,t),(0<r?e<t:t<e)&&(e+=r*S)):(e=s+r*S,t=s-.5*i);for(var o,a=e;0<r?t<a:a<t;a-=i)n.point((o=$r([u,-c*Math.cos(a),-c*Math.sin(a)]))[0],o[1])}}function ni(e,t){t=Vr(t),t[0]-=e,Hr(t),e=Je(-t[1]);return((-t[2]<0?-e:e)+2*Math.PI-P)%(2*Math.PI)}function ii(e,t,r){var n=z.range(e,t-P,r).concat(t);return function(t){return n.map(function(e){return[t,e]})}}function oi(e,t,r){var n=z.range(e,t-P,r).concat(t);return function(t){return n.map(function(e){return[e,t]})}}function ai(e){return e.source}function si(e){return e.target}z.geo.path=function(){var n,t,i,r,o,a=4.5;function s(e){return e&&("function"==typeof a&&r.pointRadius(+a.apply(this,arguments)),o&&o.valid||(o=i(r)),z.geo.stream(e,o)),r.result()}function l(){return o=null,s}return s.area=function(e){return kn=0,z.geo.stream(e,i(zn)),kn},s.centroid=function(e){return Pr=zr=Dr=Or=Rr=m=Fr=Br=Nr=0,z.geo.stream(e,i(_)),Nr?[Fr/Nr,Br/Nr]:m?[Or/m,Rr/m]:Dr?[Pr/Dr,zr/Dr]:[NaN,NaN]},s.bounds=function(e){return Ln=Pn=-(An=In=1/0),z.geo.stream(e,i(On)),[[An,In],[Ln,Pn]]},s.projection=function(e){var r,t;return arguments.length?(i=(n=e)?e.stream||(r=e,t=Wn(function(e,t){return r([e*M,t*M])}),function(e){return Xn(t(e))}):I,l()):n},s.context=function(e){return arguments.length?(r=null==(t=e)?new Rn:new Gn(e),"function"!=typeof a&&r.pointRadius(a),l()):t},s.pointRadius=function(e){return arguments.length?(a="function"==typeof e?e:(r.pointRadius(+e),+e),s):a},s.projection(z.geo.albersUsa()).context(null)},z.geo.transform=function(n){return{stream:function(e){var t,r=new Zn(e);for(t in n)r[t]=n[t];return r}}},Zn.prototype={point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},z.geo.projection=Hn,z.geo.projectionMutator=$n,(z.geo.equirectangular=function(){return Hn(Yn)}).raw=Yn.invert=Yn,z.geo.rotation=function(t){function e(e){return(e=t(e[0]*T,e[1]*T))[0]*=M,e[1]*=M,e}return t=Kn(t[0]%360*T,t[1]*T,2<t.length?t[2]*T:0),e.invert=function(e){return(e=t.invert(e[0]*T,e[1]*T))[0]*=M,e[1]*=M,e},e},Jn.invert=Yn,z.geo.circle=function(){var t,i,o=[0,0],r=6;function n(){var e="function"==typeof o?o.apply(this,arguments):o,r=Kn(-e[0]*T,-e[1]*T,0).invert,n=[];return i(null,null,1,{point:function(e,t){n.push(e=r(e,t)),e[0]*=M,e[1]*=M}}),{type:"Polygon",coordinates:[n]}}return n.origin=function(e){return arguments.length?(o=e,n):o},n.angle=function(e){return arguments.length?(i=ri((t=+e)*T,r*T),n):t},n.precision=function(e){return arguments.length?(i=ri(t*T,(r=+e)*T),n):r},n.angle(90)},z.geo.distance=function(e,t){var r=(t[0]-e[0])*T,e=e[1]*T,t=t[1]*T,n=Math.sin(r),r=Math.cos(r),i=Math.sin(e),e=Math.cos(e),o=Math.sin(t),t=Math.cos(t);return Math.atan2(Math.sqrt((n=t*n)*n+(n=e*o-i*t*r)*n),i*o+e*t*r)},z.geo.graticule=function(){var t,r,n,i,o,a,s,l,u,c,h,f,d=10,p=d,m=90,g=360,y=2.5;function v(){return{type:"MultiLineString",coordinates:e()}}function e(){return z.range(Math.ceil(i/m)*m,n,m).map(h).concat(z.range(Math.ceil(l/g)*g,s,g).map(f)).concat(z.range(Math.ceil(r/d)*d,t,d).filter(function(e){return L(e%m)>P}).map(u)).concat(z.range(Math.ceil(a/p)*p,o,p).filter(function(e){return L(e%g)>P}).map(c))}return v.lines=function(){return e().map(function(e){return{type:"LineString",coordinates:e}})},v.outline=function(){return{type:"Polygon",coordinates:[h(i).concat(f(s).slice(1),h(n).reverse().slice(1),f(l).reverse().slice(1))]}},v.extent=function(e){return arguments.length?v.majorExtent(e).minorExtent(e):v.minorExtent()},v.majorExtent=function(e){return arguments.length?(i=+e[0][0],n=+e[1][0],l=+e[0][1],s=+e[1][1],n<i&&(e=i,i=n,n=e),s<l&&(e=l,l=s,s=e),v.precision(y)):[[i,l],[n,s]]},v.minorExtent=function(e){return arguments.length?(r=+e[0][0],t=+e[1][0],a=+e[0][1],o=+e[1][1],t<r&&(e=r,r=t,t=e),o<a&&(e=a,a=o,o=e),v.precision(y)):[[r,a],[t,o]]},v.step=function(e){return arguments.length?v.majorStep(e).minorStep(e):v.minorStep()},v.majorStep=function(e){return arguments.length?(m=+e[0],g=+e[1],v):[m,g]},v.minorStep=function(e){return arguments.length?(d=+e[0],p=+e[1],v):[d,p]},v.precision=function(e){return arguments.length?(y=+e,u=ii(a,o,90),c=oi(r,t,y),h=ii(l,s,90),f=oi(i,n,y),v):y},v.majorExtent([[-180,-90+P],[180,90-P]]).minorExtent([[-180,-80-P],[180,80+P]])},z.geo.greatArc=function(){var t,r,n=ai,i=si;function o(){return{type:"LineString",coordinates:[t||n.apply(this,arguments),r||i.apply(this,arguments)]}}return o.distance=function(){return z.geo.distance(t||n.apply(this,arguments),r||i.apply(this,arguments))},o.source=function(e){return arguments.length?(t="function"==typeof(n=e)?null:e,o):n},o.target=function(e){return arguments.length?(r="function"==typeof(i=e)?null:e,o):i},o.precision=function(){return arguments.length?o:0},o},z.geo.interpolate=function(e,t){return r=e[0]*T,n=e[1]*T,e=t[0]*T,t=t[1]*T,i=Math.cos(n),o=Math.sin(n),a=Math.cos(t),s=Math.sin(t),l=i*Math.cos(r),u=i*Math.sin(r),c=a*Math.cos(e),h=a*Math.sin(e),f=2*Math.asin(Math.sqrt(et(t-n)+i*a*et(e-r))),d=1/Math.sin(f),(t=f?function(e){var t=Math.sin(e*=f)*d,e=Math.sin(f-e)*d,r=e*l+t*c,n=e*u+t*h,e=e*o+t*s;return[Math.atan2(n,r)*M,Math.atan2(e,Math.sqrt(r*r+n*n))*M]}:function(){return[r*M,n*M]}).distance=f,t;var r,n,i,o,a,s,l,u,c,h,f,d},z.geo.length=function(e){return Bn=0,z.geo.stream(e,li),Bn};var li={sphere:l,point:l,lineStart:function(){var o,a,s;function r(e,t){var r=Math.sin(t*=T),t=Math.cos(t),n=L((e*=T)-o),i=Math.cos(n);Bn+=Math.atan2(Math.sqrt((n=t*Math.sin(n))*n+(n=s*r-a*t*i)*n),a*r+s*t*i),o=e,a=r,s=t}li.point=function(e,t){o=e*T,a=Math.sin(t*=T),s=Math.cos(t),li.point=r},li.lineEnd=function(){li.point=li.lineEnd=l}},lineEnd:l,polygonStart:l,polygonEnd:l};function ui(i,o){function e(e,t){var r=Math.cos(e),n=Math.cos(t),r=i(r*n);return[r*n*Math.sin(e),r*Math.sin(t)]}return e.invert=function(e,t){var r=Math.sqrt(e*e+t*t),n=o(r),i=Math.sin(n),n=Math.cos(n);return[Math.atan2(e*i,r*n),Math.asin(r&&t*i/r)]},e}var ci=ui(function(e){return Math.sqrt(2/(1+e))},function(e){return 2*Math.asin(e/2)}),hi=((z.geo.azimuthalEqualArea=function(){return Hn(ci)}).raw=ci,ui(function(e){e=Math.acos(e);return e&&e/Math.sin(e)},I));function fi(e,t){function r(e){return Math.tan(O/4+e/2)}var n=Math.cos(e),i=e===t?Math.sin(e):Math.log(n/Math.cos(t))/Math.log(r(t)/r(e)),o=n*Math.pow(r(e),i)/i;return i?(a.invert=function(e,t){var t=o-t,r=Xe(i)*Math.sqrt(e*e+t*t);return[Math.atan2(e,t)/i,2*Math.atan(Math.pow(o/r,1/i))-R]},a):mi;function a(e,t){0<o?t<-R+P&&(t=-R+P):R-P<t&&(t=R-P);t=o/Math.pow(r(t),i);return[t*Math.sin(i*e),o-t*Math.cos(i*e)]}}function di(e,t){var r=Math.cos(e),n=e===t?Math.sin(e):(r-Math.cos(t))/(t-e),i=r/n+e;return L(n)<P?Yn:(o.invert=function(e,t){t=i-t;return[Math.atan2(e,t)/n,i-Xe(n)*Math.sqrt(e*e+t*t)]},o);function o(e,t){t=i-t;return[t*Math.sin(n*e),i-t*Math.cos(n*e)]}}(z.geo.azimuthalEquidistant=function(){return Hn(hi)}).raw=hi,(z.geo.conicConformal=function(){return Sn(fi)}).raw=fi,(z.geo.conicEquidistant=function(){return Sn(di)}).raw=di;var pi=ui(function(e){return 1/e},Math.atan);function mi(e,t){return[e,Math.log(Math.tan(O/4+t/2))]}function gi(e){var i,o=Hn(e),a=o.scale,s=o.translate,l=o.clipExtent;return o.scale=function(){var e=a.apply(o,arguments);return e===o?i?o.clipExtent(null):o:e},o.translate=function(){var e=s.apply(o,arguments);return e===o?i?o.clipExtent(null):o:e},o.clipExtent=function(e){var t,r,n=l.apply(o,arguments);return n===o?(i=null==e)&&(t=O*a(),r=s(),l([[r[0]-t,r[1]-t],[r[0]+t,r[1]+t]])):i&&(n=null),n},o.clipExtent(null)}(z.geo.gnomonic=function(){return Hn(pi)}).raw=pi,mi.invert=function(e,t){return[e,2*Math.atan(Math.exp(t))-R]},(z.geo.mercator=function(){return gi(mi)}).raw=mi;var yi=ui(function(){return 1},Math.asin),vi=((z.geo.orthographic=function(){return Hn(yi)}).raw=yi,ui(function(e){return 1/(1+e)},function(e){return 2*Math.atan(e)}));function _i(e,t){return[Math.log(Math.tan(O/4+t/2)),-e]}function xi(e){return e[0]}function bi(e){return e[1]}function wi(e){for(var t=e.length,r=[0,1],n=2,i=2;i<t;i++){for(;1<n&&Ye(e[r[n-2]],e[r[n-1]],e[i])<=0;)--n;r[n++]=i}return r.slice(0,n)}function Ei(e,t){return e[0]-t[0]||e[1]-t[1]}(z.geo.stereographic=function(){return Hn(vi)}).raw=vi,_i.invert=function(e,t){return[-t,2*Math.atan(Math.exp(e))-R]},(z.geo.transverseMercator=function(){var e=gi(_i),t=e.center,r=e.rotate;return e.center=function(e){return e?t([-e[1],e[0]]):[(e=t())[1],-e[0]]},e.rotate=function(e){return e?r([e[0],e[1],2<e.length?e[2]+90:90]):[(e=r())[0],e[1],e[2]-90]},r([0,0,90])}).raw=_i,z.geom={},z.geom.hull=function(e){var f=xi,d=bi;return arguments.length?t(e):(t.x=function(e){return arguments.length?(f=e,t):f},t.y=function(e){return arguments.length?(d=e,t):d},t);function t(e){if(e.length<3)return[];for(var t=F(f),r=F(d),n=e.length,i=[],o=[],a=0;a<n;a++)i.push([+t.call(this,e[a],a),+r.call(this,e[a],a),a]);for(i.sort(Ei),a=0;a<n;a++)o.push([i[a][0],-i[a][1]]);var s=wi(i),l=wi(o),u=l[0]===s[0],c=l[l.length-1]===s[s.length-1],h=[];for(a=s.length-1;0<=a;--a)h.push(e[i[s[a]][2]]);for(a=+u;a<l.length-c;++a)h.push(e[i[l[a]][2]]);return h}},z.geom.polygon=function(e){return de(e,Ti),e};var Ti=z.geom.polygon.prototype=[];function Si(e,t,r){return(r[0]-t[0])*(e[1]-t[1])<(r[1]-t[1])*(e[0]-t[0])}function Mi(e,t,r,n){var i=e[0],o=r[0],a=t[0]-i,s=n[0]-o,e=e[1],r=r[1],t=t[1]-e,n=n[1]-r,r=(s*(e-r)-n*(i-o))/(n*a-s*t);return[i+r*a,e+r*t]}function ki(e){var t=e[0],e=e[e.length-1];return!(t[0]-e[0]||t[1]-e[1])}Ti.area=function(){for(var e,t=-1,r=this.length,n=this[r-1],i=0;++t<r;)e=n,n=this[t],i+=e[1]*n[0]-e[0]*n[1];return.5*i},Ti.centroid=function(e){var t,r,n=-1,i=this.length,o=0,a=0,s=this[i-1];for(arguments.length||(e=-1/(6*this.area()));++n<i;)t=s,s=this[n],r=t[0]*s[1]-s[0]*t[1],o+=(t[0]+s[0])*r,a+=(t[1]+s[1])*r;return[o*e,a*e]},Ti.clip=function(e){for(var t,r,n,i,o,a,s=ki(e),l=-1,u=this.length-ki(this),c=this[u-1];++l<u;){for(t=e.slice(),e.length=0,i=this[l],o=t[(n=t.length-s)-1],r=-1;++r<n;)Si(a=t[r],c,i)?(Si(o,c,i)||e.push(Mi(o,a,c,i)),e.push(a)):Si(o,c,i)&&e.push(Mi(o,a,c,i)),o=a;s&&e.push(e[0]),c=i}return e};var Ci,Ai,Ii,Li,Pi,zi=[],Di=[];function Oi(){Ki(this),this.edge=this.site=this.circle=null}function Ri(e){var t=zi.pop()||new Oi;return t.site=e,t}function Fi(e){Zi(e),Ii.remove(e),zi.push(e),Ki(e)}function Bi(e){for(var t,r,n,i,o,a,s=e.x,l=e.y,u=Ii._;u;)if(n=Ni(u,l)-s,P<n)u=u.L;else{if(i=s-(o=l,a=void 0,(a=(i=u).N)?Ni(a,o):(a=i.site).y===o?a.x:1/0),!(P<i)){-P<n?(t=u.P,r=u):-P<i?r=(t=u).N:t=r=u;break}if(!u.R){t=u;break}u=u.R}var c,h,f,d,p,m,g,y,v,_,x=Ri(e);Ii.insert(t,x),(t||r)&&(t===r?(Zi(t),r=Ri(t.site),Ii.insert(x,r),x.edge=r.edge=$i(t.site,x.site),Wi(t),Wi(r)):r?(Zi(t),Zi(r),h=(c=t.site).x,f=c.y,d=e.x-h,_=e.y-f,m=(p=r.site).x-h,g=p.y-f,Xi(r.edge,c,p,_={x:(g*(y=d*d+_*_)-_*(v=m*m+g*g))/(g=2*(d*g-_*m))+h,y:(d*v-m*y)/g+f}),x.edge=$i(c,e,null,_),r.edge=$i(e,p,null,_),Wi(t),Wi(r)):x.edge=$i(t.site,x.site))}function Ni(e,t){var r,n,i,o=e.site,a=o.x,s=o.y,l=s-t;return l?(e=e.P)?(e=(o=e.site).x,(t=(o=o.y)-t)?(i=(r=e-a)/t,(n=1/l-1/t)?(-i+Math.sqrt(i*i-2*n*(r*r/(-2*t)-o+t/2+s-l/2)))/n+a:(a+e)/2):e):-1/0:a}function ji(e){this.site=e,this.edges=[]}function Ui(e){for(var t,r,n,i,o,a,s,l,u,c=e[0][0],h=e[1][0],f=e[0][1],d=e[1][1],p=Ai,m=p.length;m--;)if((i=p[m])&&i.prepare())for(s=(a=i.edges).length,o=0;o<s;)r=(u=a[o].end()).x,n=u.y,t=(l=a[++o%s].start()).x,l=l.y,(L(r-t)>P||L(n-l)>P)&&(a.splice(o,0,new Yi(function(e,t,r){e=new Hi(e,null);return e.a=t,e.b=r,Ci.push(e),e}(i.site,u,L(r-c)<P&&P<d-n?{x:c,y:L(t-c)<P?l:d}:L(n-d)<P&&P<h-r?{x:L(l-d)<P?t:h,y:d}:L(r-h)<P&&P<n-f?{x:h,y:L(t-h)<P?l:f}:L(n-f)<P&&P<r-c?{x:L(l-f)<P?t:c,y:f}:null),i.site,null)),++s)}function Vi(e,t){return t.angle-e.angle}function Gi(){Ki(this),this.x=this.y=this.arc=this.site=this.cy=null}function Wi(e){var t=e.P,r=e.N;if(t&&r){var t=t.site,n=e.site,r=r.site;if(t!==r){var i=n.x,o=n.y,a=t.x-i,t=t.y-o,s=r.x-i,l=2*(a*(r=r.y-o)-t*s);if(!(-He<=l)){for(var u=a*a+t*t,c=s*s+r*r,t=(r*u-t*c)/l,a=(a*c-s*u)/l,r=a+o,h=Di.pop()||new Gi,f=(h.arc=e,h.site=n,h.x=t+i,h.y=r+Math.sqrt(t*t+a*a),h.cy=r,e.circle=h,null),d=Pi._;d;)if(h.y<d.y||h.y===d.y&&h.x<=d.x){if(!d.L){f=d.P;break}d=d.L}else{if(!d.R){f=d;break}d=d.R}Pi.insert(f,h),f||(Li=h)}}}}function Zi(e){var t=e.circle;t&&(t.P||(Li=t.N),Pi.remove(t),Di.push(t),Ki(t),e.circle=null)}function qi(e){for(var t,r=Ci,n=wn(e[0][0],e[0][1],e[1][0],e[1][1]),i=r.length;i--;)(!function(e,t){var r=e.b;if(!r){var n=e.a,i=t[0][0],o=t[1][0],a=t[0][1],t=t[1][1],s=e.l,l=e.r,u=s.x,s=s.y,c=l.x,l=l.y,h=(u+c)/2,f=(s+l)/2;if(l===s){if(h<i||o<=h)return;if(c<u){if(n){if(n.y>=t)return}else n={x:h,y:a};r={x:h,y:t}}else{if(n){if(n.y<a)return}else n={x:h,y:t};r={x:h,y:a}}}else if(h=f-(f=(u-c)/(l-s))*h,f<-1||1<f)if(c<u){if(n){if(n.y>=t)return}else n={x:(a-h)/f,y:a};r={x:(t-h)/f,y:t}}else{if(n){if(n.y<a)return}else n={x:(t-h)/f,y:t};r={x:(a-h)/f,y:a}}else if(s<l){if(n){if(n.x>=o)return}else n={x:i,y:f*i+h};r={x:o,y:f*o+h}}else{if(n){if(n.x<i)return}else n={x:o,y:f*o+h};r={x:i,y:f*i+h}}e.a=n,e.b=r}return 1}(t=r[i],e)||!n(t)||L(t.a.x-t.b.x)<P&&L(t.a.y-t.b.y)<P)&&(t.a=t.b=null,r.splice(i,1))}function Hi(e,t){this.l=e,this.r=t,this.a=this.b=null}function $i(e,t,r,n){var i=new Hi(e,t);return Ci.push(i),r&&Xi(i,e,t,r),n&&Xi(i,t,e,n),Ai[e.i].edges.push(new Yi(i,e,t)),Ai[t.i].edges.push(new Yi(i,t,e)),i}function Xi(e,t,r,n){e.a||e.b?e.l===r?e.b=n:e.a=n:(e.a=n,e.l=t,e.r=r)}function Yi(e,t,r){var n=e.a,i=e.b;this.edge=e,this.site=t,this.angle=r?Math.atan2(r.y-t.y,r.x-t.x):e.l===t?Math.atan2(i.x-n.x,n.y-i.y):Math.atan2(n.x-i.x,i.y-n.y)}function Ji(){this._=null}function Ki(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function Qi(e,t){var r=t,t=t.R,n=r.U;n?n.L===r?n.L=t:n.R=t:e._=t,t.U=n,r.U=t,r.R=t.L,r.R&&(r.R.U=r),t.L=r}function eo(e,t){var r=t,t=t.L,n=r.U;n?n.L===r?n.L=t:n.R=t:e._=t,t.U=n,r.U=t,r.L=t.R,r.L&&(r.L.U=r),t.R=r}function to(e){for(;e.L;)e=e.L;return e}function ro(e,t){var r,n,i,o=e.sort(no).pop();for(Ci=[],Ai=new Array(e.length),Ii=new Ji,Pi=new Ji;;)if(i=Li,o&&(!i||o.y<i.y||o.y===i.y&&o.x<i.x))o.x===r&&o.y===n||(Ai[o.i]=new ji(o),Bi(o),r=o.x,n=o.y),o=e.pop();else{if(!i)break;y=g=m=p=d=f=h=c=u=l=s=a=void 0;for(var a=i.arc,s=a.circle,l=s.x,u=s.cy,c={x:l,y:u},h=a.P,f=a.N,d=[a],p=(Fi(a),h);p.circle&&L(l-p.circle.x)<P&&L(u-p.circle.cy)<P;)h=p.P,d.unshift(p),Fi(p),p=h;d.unshift(p),Zi(p);for(var m=f;m.circle&&L(l-m.circle.x)<P&&L(u-m.circle.cy)<P;)f=m.N,d.push(m),Fi(m),m=f;d.push(m),Zi(m);for(var g=d.length,y=1;y<g;++y)Xi((m=d[y]).edge,(p=d[y-1]).site,m.site,c);(m=d[g-1]).edge=$i((p=d[0]).site,m.site,null,c),Wi(p),Wi(m)}t&&(qi(t),Ui(t));t={cells:Ai,edges:Ci};return Ii=Pi=Ci=Ai=null,t}function no(e,t){return t.y-e.y||t.x-e.x}ji.prototype.prepare=function(){for(var e,t=this.edges,r=t.length;r--;)(e=t[r].edge).b&&e.a||t.splice(r,1);return t.sort(Vi),t.length},Yi.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},Ji.prototype={insert:function(e,t){var r,n,i;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;r=e}else r=this._?(e=to(this._),t.P=null,(t.N=e).P=e.L=t,e):(t.P=t.N=null,this._=t,null);for(t.L=t.R=null,t.U=r,t.C=!0,e=t;r&&r.C;)r===(n=r.U).L?(i=n.R)&&i.C?(r.C=i.C=!1,n.C=!0,e=n):(e===r.R&&(Qi(this,r),r=(e=r).U),r.C=!1,n.C=!0,eo(this,n)):(i=n.L)&&i.C?(r.C=i.C=!1,n.C=!0,e=n):(e===r.L&&(eo(this,r),r=(e=r).U),r.C=!1,n.C=!0,Qi(this,n)),r=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t,r,n=e.U,i=e.L,o=e.R,a=i?o?to(o):i:o;if(n?n.L===e?n.L=a:n.R=a:this._=a,i&&o?(r=a.C,a.C=e.C,((a.L=i).U=a)!==o?(n=a.U,a.U=e.U,e=a.R,n.L=e,(a.R=o).U=a):(a.U=n,e=(n=a).R)):(r=e.C,e=a),e&&(e.U=n),!r)if(e&&e.C)e.C=!1;else{do{if(e===this._)break;if(e===n.L){if((t=n.R).C&&(t.C=!1,n.C=!0,Qi(this,n),t=n.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,eo(this,t),t=n.R),t.C=n.C,n.C=t.R.C=!1,Qi(this,n),e=this._;break}}else if((t=n.L).C&&(t.C=!1,n.C=!0,eo(this,n),t=n.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,Qi(this,t),t=n.L),t.C=n.C,n.C=t.L.C=!1,eo(this,n),e=this._;break}}while(t.C=!0,n=(e=n).U,!e.C);e&&(e.C=!1)}}},z.geom.voronoi=function(e){var t=xi,r=bi,n=t,i=r,u=io;return e?o(e):(o.links=function(t){return ro(f(t)).edges.filter(function(e){return e.l&&e.r}).map(function(e){return{source:t[e.l.i],target:t[e.r.i]}})},o.triangles=function(c){var h=[];return ro(f(c)).cells.forEach(function(e,t){for(var r,n,i=e.site,o=e.edges.sort(Vi),a=-1,s=o.length,l=o[s-1].edge,u=l.l===i?l.r:l.l;++a<s;)r=u,u=(l=o[a].edge).l===i?l.r:l.l,t<r.i&&t<u.i&&(n=u,(i.x-n.x)*(r.y-i.y)-(i.x-r.x)*(n.y-i.y)<0&&h.push([c[t],c[r.i],c[u.i]]))}),h},o.x=function(e){return arguments.length?(n=F(t=e),o):t},o.y=function(e){return arguments.length?(i=F(r=e),o):r},o.clipExtent=function(e){return arguments.length?(u=null==e?io:e,o):u===io?null:u},o.size=function(e){return arguments.length?o.clipExtent(e&&[[0,0],e]):u===io?null:u&&u[1]},o);function o(n){var i=new Array(n.length),o=u[0][0],a=u[0][1],s=u[1][0],l=u[1][1];return ro(f(n),u).cells.forEach(function(e,t){var r=e.edges,e=e.site;(i[t]=r.length?r.map(function(e){e=e.start();return[e.x,e.y]}):e.x>=o&&e.x<=s&&e.y>=a&&e.y<=l?[[o,l],[s,l],[s,a],[o,a]]:[]).point=n[t]}),i}function f(e){return e.map(function(e,t){return{x:Math.round(n(e,t)/P)*P,y:Math.round(i(e,t)/P)*P,i:t}})}};var io=[[-1e6,-1e6],[1e6,1e6]];function oo(e){return e.x}function ao(e){return e.y}function so(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function lo(e,t){e=z.rgb(e),t=z.rgb(t);var r=e.r,n=e.g,i=e.b,o=t.r-r,a=t.g-n,s=t.b-i;return function(e){return"#"+xt(Math.round(r+o*e))+xt(Math.round(n+a*e))+xt(Math.round(i+s*e))}}function uo(e,t){var r,n={},i={};for(r in e)r in t?n[r]=mo(e[r],t[r]):i[r]=e[r];for(r in t)r in e||(i[r]=t[r]);return function(e){for(r in n)i[r]=n[r](e);return i}}function co(t,r){return t=+t,r=+r,function(e){return t*(1-e)+r*e}}function ho(e,n){var t,r,i,o=fo.lastIndex=po.lastIndex=0,a=-1,s=[],l=[];for(e+="",n+="";(t=fo.exec(e))&&(r=po.exec(n));)(i=r.index)>o&&(i=n.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(t=t[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,l.push({i:a,x:co(t,r)})),o=po.lastIndex;return o<n.length&&(i=n.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?l[0]?(n=l[0].x,function(e){return n(e)+""}):function(){return n}:(n=l.length,function(e){for(var t,r=0;r<n;++r)s[(t=l[r]).i]=t.x(e);return s.join("")})}z.geom.delaunay=function(e){return z.geom.voronoi().triangles(e)},z.geom.quadtree=function(e,v,_,x,w){var E,T=xi,S=bi;return(E=arguments.length)?(T=oo,S=ao,3===E&&(w=_,x=v,_=v=0),t(e)):(t.x=function(e){return arguments.length?(T=e,t):T},t.y=function(e){return arguments.length?(S=e,t):S},t.extent=function(e){return arguments.length?(null==e?v=_=x=w=null:(v=+e[0][0],_=+e[0][1],x=+e[1][0],w=+e[1][1]),t):null==v?null:[[v,_],[x,w]]},t.size=function(e){return arguments.length?(null==e?v=_=x=w=null:(v=_=0,x=+e[0],w=+e[1]),t):null==v?null:[x-v,w-_]},t);function t(e){var t,r,n,i,o,a,s,l,u,c=F(T),h=F(S);if(null!=v)a=v,s=_,l=x,u=w;else if(l=u=-(a=s=1/0),r=[],n=[],o=e.length,E)for(i=0;i<o;++i)(t=e[i]).x<a&&(a=t.x),t.y<s&&(s=t.y),t.x>l&&(l=t.x),t.y>u&&(u=t.y),r.push(t.x),n.push(t.y);else for(i=0;i<o;++i){var f=+c(t=e[i],i),d=+h(t,i);f<a&&(a=f),d<s&&(s=d),l<f&&(l=f),u<d&&(u=d),r.push(f),n.push(d)}var p=l-a,m=u-s;function g(e,t,r,n,i,o,a,s){var l,u,c;isNaN(r)||isNaN(n)||(e.leaf?(l=e.x,u=e.y,null!=l?(L(l-r)+L(u-n)<.01||(c=e.point,e.x=e.y=e.point=null,y(e,c,l,u,i,o,a,s)),y(e,t,r,n,i,o,a,s)):(e.x=r,e.y=n,e.point=t)):y(e,t,r,n,i,o,a,s))}function y(e,t,r,n,i,o,a,s){var l=.5*(i+a),u=.5*(o+s),c=l<=r,h=u<=n,f=h<<1|c;e.leaf=!1,c?i=l:a=l,h?o=u:s=u,g(e=e.nodes[f]||(e.nodes[f]=so()),t,r,n,i,o,a,s)}m<p?u=s+p:l=a+m;var b=so();if(b.add=function(e){g(b,e,+c(e,++i),+h(e,i),a,s,l,u)},b.visit=function(e){!function e(t,r,n,i,o,a){{var s,l;t(r,n,i,o,a)||(s=.5*(n+o),l=.5*(i+a),(r=r.nodes)[0]&&e(t,r[0],n,i,s,l),r[1]&&e(t,r[1],s,i,o,l),r[2]&&e(t,r[2],n,l,s,a),r[3]&&e(t,r[3],s,l,o,a))}}(e,b,a,s,l,u)},b.find=function(e){return d=e[0],p=e[1],x=1/0,function e(t,r,n,i,o){if(!(y<r||v<n||i<m||o<g)){(a=t.point)&&(s=(s=d-t.x)*s+(s=p-t.y)*s)<x&&(s=Math.sqrt(x=s),m=d-s,g=p-s,y=d+s,v=p+s,_=a);for(var a,s,l=t.nodes,u=.5*(r+i),c=.5*(n+o),h=(c<=p)<<1|u<=d,f=h+4;h<f;++h)if(t=l[3&h])switch(3&h){case 0:e(t,r,n,u,c);break;case 1:e(t,u,n,i,c);break;case 2:e(t,r,c,u,o);break;case 3:e(t,u,c,i,o)}}}(b,m=a,g=s,y=l,v=u),_;var d,p,m,g,y,v,_,x},i=-1,null==v){for(;++i<o;)g(b,e[i],r[i],n[i],a,s,l,u);--i}else e.forEach(b.add);return r=n=e=t=null,b}},z.interpolateRgb=lo,z.interpolateObject=uo,z.interpolateNumber=co,z.interpolateString=ho;var fo=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,po=new RegExp(fo.source,"g");function mo(e,t){for(var r,n=z.interpolators.length;0<=--n&&!(r=z.interpolators[n](e,t)););return r}function go(e,t){for(var r=[],n=[],i=e.length,o=t.length,a=Math.min(e.length,t.length),s=0;s<a;++s)r.push(mo(e[s],t[s]));for(;s<i;++s)n[s]=e[s];for(;s<o;++s)n[s]=t[s];return function(e){for(s=0;s<a;++s)n[s]=r[s](e);return n}}z.interpolate=mo,z.interpolators=[function(e,t){var r=typeof t;return("string"==r?Mt.has(t.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(t)?lo:ho:t instanceof ot?lo:Array.isArray(t)?go:"object"==r&&isNaN(t)?uo:co)(e,t)}],z.interpolateArray=go;function yo(){return I}var vo=z.map({linear:yo,poly:function(t){return function(e){return Math.pow(e,t)}},quad:function(){return wo},cubic:function(){return Eo},sin:function(){return So},exp:function(){return Mo},circle:function(){return ko},elastic:function(t,r){var n;arguments.length<2&&(r=.45);n=arguments.length?r/S*Math.asin(1/t):(t=1,r/4);return function(e){return 1+t*Math.pow(2,-10*e)*Math.sin((e-n)*S/r)}},back:function(t){t=t||1.70158;return function(e){return e*e*((t+1)*e-t)}},bounce:function(){return Co}}),_o=z.map({in:I,out:xo,"in-out":bo,"out-in":function(e){return bo(xo(e))}});function xo(t){return function(e){return 1-t(1-e)}}function bo(t){return function(e){return.5*(e<.5?t(2*e):2-t(2-2*e))}}function wo(e){return e*e}function Eo(e){return e*e*e}function To(e){var t,r;return e<=0?0:1<=e?1:(r=(t=e*e)*e,4*(e<.5?r:3*(e-t)+r-.75))}function So(e){return 1-Math.cos(e*R)}function Mo(e){return Math.pow(2,10*(e-1))}function ko(e){return 1-Math.sqrt(1-e*e)}function Co(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}function Ao(t,r){return r-=t,function(e){return Math.round(t+r*e)}}function Io(e){var t,r,n=[e.a,e.b],i=[e.c,e.d],o=Po(n),a=Lo(n,i),s=Po(((t=i)[0]+=(s=-a)*(r=n)[0],t[1]+=s*r[1],t))||0;n[0]*i[1]<i[0]*n[1]&&(n[0]*=-1,n[1]*=-1,o*=-1,a*=-1),this.rotate=(o?Math.atan2(n[1],n[0]):Math.atan2(-i[0],i[1]))*M,this.translate=[e.e,e.f],this.scale=[o,s],this.skew=s?Math.atan2(a,s)*M:0}function Lo(e,t){return e[0]*t[0]+e[1]*t[1]}function Po(e){var t=Math.sqrt(Lo(e,e));return t&&(e[0]/=t,e[1]/=t),t}z.ease=function(e){var t,r=e.indexOf("-"),n=0<=r?e.slice(0,r):e,r=0<=r?e.slice(r+1):"in",n=vo.get(n)||yo,r=_o.get(r)||I;return t=r(n.apply(null,A.call(arguments,1))),function(e){return e<=0?0:1<=e?1:t(e)}},z.interpolateHcl=function(e,t){e=z.hcl(e),t=z.hcl(t);var r=e.h,n=e.c,i=e.l,o=t.h-r,a=t.c-n,s=t.l-i;isNaN(a)&&(a=0,n=isNaN(n)?t.c:n);isNaN(o)?(o=0,r=isNaN(r)?t.h:r):180<o?o-=360:o<-180&&(o+=360);return function(e){return lt(r+o*e,n+a*e,i+s*e)+""}},z.interpolateHsl=function(e,t){e=z.hsl(e),t=z.hsl(t);var r=e.h,n=e.s,i=e.l,o=t.h-r,a=t.s-n,s=t.l-i;isNaN(a)&&(a=0,n=isNaN(n)?t.s:n);isNaN(o)?(o=0,r=isNaN(r)?t.h:r):180<o?o-=360:o<-180&&(o+=360);return function(e){return st(r+o*e,n+a*e,i+s*e)+""}},z.interpolateLab=function(e,t){e=z.lab(e),t=z.lab(t);var r=e.l,n=e.a,i=e.b,o=t.l-r,a=t.a-n,s=t.b-i;return function(e){return dt(r+o*e,n+a*e,i+s*e)+""}},z.interpolateRound=Ao,z.transform=function(e){var r=D.createElementNS(z.ns.prefix.svg,"g");return(z.transform=function(e){var t;return null!=e&&(r.setAttribute("transform",e),t=r.transform.baseVal.consolidate()),new Io(t?t.matrix:zo)})(e)},Io.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var zo={a:1,b:0,c:0,d:1,e:0,f:0};function Do(e){return e.length?e.pop()+",":""}function Oo(e,t){var r,n,i,o,a,s,l=[],u=[];return e=z.transform(e),t=z.transform(t),n=e.translate,i=t.translate,a=l,o=u,n[0]!==i[0]||n[1]!==i[1]?(r=a.push("translate(",null,",",null,")"),o.push({i:r-4,x:co(n[0],i[0])},{i:r-2,x:co(n[1],i[1])})):(i[0]||i[1])&&a.push("translate("+i+")"),o=e.rotate,r=t.rotate,n=l,a=u,o!==r?(180<o-r?r+=360:180<r-o&&(o+=360),a.push({i:n.push(Do(n)+"rotate(",null,")")-2,x:co(o,r)})):r&&n.push(Do(n)+"rotate("+r+")"),i=e.skew,a=t.skew,o=l,n=u,i!==a?n.push({i:o.push(Do(o)+"skewX(",null,")")-2,x:co(i,a)}):a&&o.push(Do(o)+"skewX("+a+")"),n=e.scale,i=t.scale,o=l,a=u,n[0]!==i[0]||n[1]!==i[1]?(s=o.push(Do(o)+"scale(",null,",",null,")"),a.push({i:s-4,x:co(n[0],i[0])},{i:s-2,x:co(n[1],i[1])})):1===i[0]&&1===i[1]||o.push(Do(o)+"scale("+i+")"),e=t=null,function(e){for(var t,r=-1,n=u.length;++r<n;)l[(t=u[r]).i]=t.x(e);return l.join("")}}function Ro(t,r){return r=(r-=t=+t)||1/r,function(e){return(e-t)/r}}function Fo(t,r){return r=(r-=t=+t)||1/r,function(e){return Math.max(0,Math.min(1,(e-t)/r))}}function Bo(e){for(var t=[],r=e.parent;null!=r;)t.push(e),r=(e=r).parent;return t.push(e),t}function No(e){e.fixed|=2}function jo(e){e.fixed&=-7}function Uo(e){e.fixed|=4,e.px=e.x,e.py=e.y}function Vo(e){e.fixed&=-5}z.interpolateTransform=Oo,z.layout={},z.layout.bundle=function(){return function(e){for(var t=[],r=-1,n=e.length;++r<n;)t.push(function(e){var t=e.source,r=e.target,n=function(e,t){if(e===t)return e;var r=Bo(e),n=Bo(t),i=r.pop(),o=n.pop(),a=null;for(;i===o;)a=i,i=r.pop(),o=n.pop();return a}(t,r),i=[t];for(;t!==n;)t=t.parent,i.push(t);var o=i.length;for(;r!==n;)i.splice(o,0,r),r=r.parent;return i}(e[r]));return t}},z.layout.chord=function(){var g,y,v,_,x,b,w,t={},E=0;function e(){var e,t,r,n,i,o={},a=[],s=z.range(_),l=[];for(g=[],y=[],e=0,n=-1;++n<_;){for(t=0,i=-1;++i<_;)t+=v[n][i];a.push(t),l.push(z.range(_)),e+=t}for(x&&s.sort(function(e,t){return x(a[e],a[t])}),b&&l.forEach(function(e,r){e.sort(function(e,t){return b(v[r][e],v[r][t])})}),e=(S-E*_)/e,t=0,n=-1;++n<_;){for(r=t,i=-1;++i<_;){var u=s[n],c=l[u][i],h=v[u][c],f=t,d=t+=h*e;o[u+"-"+c]={index:u,subindex:c,startAngle:f,endAngle:d,value:h}}y[u]={index:u,startAngle:r,endAngle:t,value:a[u]},t+=E}for(n=-1;++n<_;)for(i=n-1;++i<_;){var p=o[n+"-"+i],m=o[i+"-"+n];(p.value||m.value)&&g.push(p.value<m.value?{source:m,target:p}:{source:p,target:m})}w&&T()}function T(){g.sort(function(e,t){return w((e.source.value+e.target.value)/2,(t.source.value+t.target.value)/2)})}return t.matrix=function(e){return arguments.length?(_=(v=e)&&v.length,g=y=null,t):v},t.padding=function(e){return arguments.length?(E=e,g=y=null,t):E},t.sortGroups=function(e){return arguments.length?(x=e,g=y=null,t):x},t.sortSubgroups=function(e){return arguments.length?(b=e,g=null,t):b},t.sortChords=function(e){return arguments.length?(w=e,g&&T(),t):w},t.chords=function(){return g||e(),g},t.groups=function(){return y||e(),y},t},z.layout.force=function(){var h,e,f,d,p,m,i={},g=z.dispatch("start","tick","end"),y=[1,1],v=.9,o=Go,a=Wo,_=-30,x=Zo,b=.1,w=.64,E=[],T=[];function t(e){e.px=z.event.x,e.py=z.event.y,i.resume()}return i.tick=function(){if((f*=.99)<.005)return h=null,g.end({type:"end",alpha:f=0}),!0;for(var e,t,r,n,i,o,a,s,l=E.length,u=T.length,c=0;c<u;++c)r=(t=T[c]).source,(i=(a=(n=t.target).x-r.x)*a+(s=n.y-r.y)*s)&&(a*=i=f*p[c]*((i=Math.sqrt(i))-d[c])/i,s*=i,n.x-=a*(o=r.weight+n.weight?r.weight/(r.weight+n.weight):.5),n.y-=s*o,r.x+=a*(o=1-o),r.y+=s*o);if((o=f*b)&&(a=y[0]/2,s=y[1]/2,c=-1,o))for(;++c<l;)(t=E[c]).x+=(a-t.x)*o,t.y+=(s-t.y)*o;if(_)for(!function e(t,r,n){var i=0,o=0;t.charge=0;if(!t.leaf)for(var a,s=t.nodes,l=s.length,u=-1;++u<l;)null!=(a=s[u])&&(e(a,r,n),t.charge+=a.charge,i+=a.charge*a.cx,o+=a.charge*a.cy);{var c;t.point&&(t.leaf||(t.point.x+=Math.random()-.5,t.point.y+=Math.random()-.5),c=r*n[t.point.index],t.charge+=t.pointCharge=c,i+=c*t.point.x,o+=c*t.point.y)}t.cx=i/t.charge;t.cy=o/t.charge}(e=z.geom.quadtree(E),f,m),c=-1;++c<l;)(t=E[c]).fixed||e.visit(function(s){return function(e,t,r,n){if(e.point!==s){var i,o=e.cx-s.x,a=e.cy-s.y,n=n-t,t=o*o+a*a;if(n*n/w<t)return t<x&&(i=e.charge/t,s.px-=o*i,s.py-=a*i),!0;e.point&&t&&t<x&&(i=e.pointCharge/t,s.px-=o*i,s.py-=a*i)}return!e.charge}}(t));for(c=-1;++c<l;)(t=E[c]).fixed?(t.x=t.px,t.y=t.py):(t.x-=(t.px-(t.px=t.x))*v,t.y-=(t.py-(t.py=t.y))*v);g.tick({type:"tick",alpha:f})},i.nodes=function(e){return arguments.length?(E=e,i):E},i.links=function(e){return arguments.length?(T=e,i):T},i.size=function(e){return arguments.length?(y=e,i):y},i.linkDistance=function(e){return arguments.length?(o="function"==typeof e?e:+e,i):o},i.distance=i.linkDistance,i.linkStrength=function(e){return arguments.length?(a="function"==typeof e?e:+e,i):a},i.friction=function(e){return arguments.length?(v=+e,i):v},i.charge=function(e){return arguments.length?(_="function"==typeof e?e:+e,i):_},i.chargeDistance=function(e){return arguments.length?(x=e*e,i):Math.sqrt(x)},i.gravity=function(e){return arguments.length?(b=+e,i):b},i.theta=function(e){return arguments.length?(w=e*e,i):Math.sqrt(w)},i.alpha=function(e){return arguments.length?(e=+e,f?0<e?f=e:(h.c=null,h.t=NaN,h=null,g.end({type:"end",alpha:f=0})):0<e&&(g.start({type:"start",alpha:f=e}),h=Dt(i.tick)),i):f},i.start=function(){for(var s,e,l=E.length,u=T.length,t=y[0],r=y[1],c=0;c<l;++c)(e=E[c]).index=c,e.weight=0;for(c=0;c<u;++c)"number"==typeof(e=T[c]).source&&(e.source=E[e.source]),"number"==typeof e.target&&(e.target=E[e.target]),++e.source.weight,++e.target.weight;for(c=0;c<l;++c)e=E[c],isNaN(e.x)&&(e.x=n("x",t)),isNaN(e.y)&&(e.y=n("y",r)),isNaN(e.px)&&(e.px=e.x),isNaN(e.py)&&(e.py=e.y);if(d=[],"function"==typeof o)for(c=0;c<u;++c)d[c]=+o.call(this,T[c],c);else for(c=0;c<u;++c)d[c]=o;if(p=[],"function"==typeof a)for(c=0;c<u;++c)p[c]=+a.call(this,T[c],c);else for(c=0;c<u;++c)p[c]=a;if(m=[],"function"==typeof _)for(c=0;c<l;++c)m[c]=+_.call(this,E[c],c);else for(c=0;c<l;++c)m[c]=_;function n(e,t){if(!s){for(s=new Array(l),o=0;o<l;++o)s[o]=[];for(o=0;o<u;++o){var r=T[o];s[r.source.index].push(r.target),s[r.target.index].push(r.source)}}for(var n,i=s[c],o=-1,a=i.length;++o<a;)if(!isNaN(n=i[o][e]))return n;return Math.random()*t}return i.resume()},i.resume=function(){return i.alpha(.1)},i.stop=function(){return i.alpha(0)},i.drag=function(){if(e=e||z.behavior.drag().origin(I).on("dragstart.force",No).on("drag.force",t).on("dragend.force",jo),!arguments.length)return e;this.on("mouseover.force",Uo).on("mouseout.force",Vo).call(e)},z.rebind(i,g,"on")};var Go=20,Wo=1,Zo=1/0;function qo(e,t){return z.rebind(e,t,"sort","children","value"),(e.nodes=e).links=Ko,e}function Ho(e,t){for(var r,n,i=[e];null!=(e=i.pop());)if(t(e),(n=e.children)&&(r=n.length))for(;0<=--r;)i.push(n[r])}function $o(e,t){for(var r=[e],n=[];null!=(e=r.pop());)if(n.push(e),(o=e.children)&&(i=o.length))for(var i,o,a=-1;++a<i;)r.push(o[a]);for(;null!=(e=n.pop());)t(e)}function Xo(e){return e.children}function Yo(e){return e.value}function Jo(e,t){return t.value-e.value}function Ko(e){return z.merge(e.map(function(t){return(t.children||[]).map(function(e){return{source:t,target:e}})}))}z.layout.hierarchy=function(){var s=Jo,l=Xo,u=Yo;function c(e){var t,r,n,i,o=[e],a=[];for(e.depth=0;null!=(t=o.pop());)if(a.push(t),(n=l.call(c,t,t.depth))&&(r=n.length)){for(;0<=--r;)o.push(i=n[r]),i.parent=t,i.depth=t.depth+1;u&&(t.value=0),t.children=n}else u&&(t.value=+u.call(c,t,t.depth)||0),delete t.children;return $o(e,function(e){var t;s&&(t=e.children)&&t.sort(s),u&&(t=e.parent)&&(t.value+=e.value)}),a}return c.sort=function(e){return arguments.length?(s=e,c):s},c.children=function(e){return arguments.length?(l=e,c):l},c.value=function(e){return arguments.length?(u=e,c):u},c.revalue=function(e){return u&&(Ho(e,function(e){e.children&&(e.value=0)}),$o(e,function(e){var t;e.children||(e.value=+u.call(c,e,e.depth)||0),(t=e.parent)&&(t.value+=e.value)})),e},c},z.layout.partition=function(){var r=z.layout.hierarchy(),n=[1,1];function t(e,t){e=r.call(this,e,t);return function e(t,r,n,i){var o=t.children;if(t.x=r,t.y=t.depth*i,t.dx=n,t.dy=i,o&&(a=o.length)){var a,s,l=-1;for(n=t.value?n/t.value:0;++l<a;)e(s=o[l],r,s=s.value*n,i),r+=s}}(e[0],0,n[0],n[1]/function e(t){var r=t.children,n=0;if(r&&(i=r.length))for(var i,o=-1;++o<i;)n=Math.max(n,e(r[o]));return 1+n}(e[0])),e}return t.size=function(e){return arguments.length?(n=e,t):n},qo(t,r)},z.layout.pie=function(){var h=Number,f=Qo,d=0,p=S,m=0;function g(r){var t,e=r.length,n=r.map(function(e,t){return+h.call(g,e,t)}),i=+("function"==typeof d?d.apply(this,arguments):d),o=("function"==typeof p?p.apply(this,arguments):p)-i,a=Math.min(Math.abs(o)/e,+("function"==typeof m?m.apply(this,arguments):m)),s=a*(o<0?-1:1),l=z.sum(n),u=l?(o-e*s)/l:0,o=z.range(e),c=[];return null!=f&&o.sort(f===Qo?function(e,t){return n[t]-n[e]}:function(e,t){return f(r[e],r[t])}),o.forEach(function(e){c[e]={data:r[e],value:t=n[e],startAngle:i,endAngle:i+=t*u+s,padAngle:a}}),c}return g.value=function(e){return arguments.length?(h=e,g):h},g.sort=function(e){return arguments.length?(f=e,g):f},g.startAngle=function(e){return arguments.length?(d=e,g):d},g.endAngle=function(e){return arguments.length?(p=e,g):p},g.padAngle=function(e){return arguments.length?(m=e,g):m},g};var Qo={};function ea(e){return e.x}function ta(e){return e.y}function ra(e,t,r){e.y0=t,e.y=r}z.layout.stack=function(){var h=I,f=oa,d=aa,p=ra,m=ea,g=ta;function y(e,t){if(r=e.length)for(var r,n,i,o=(s=e.map(function(e,t){return h.call(y,e,t)})).map(function(e){return e.map(function(e,t){return[m.call(y,e,t),g.call(y,e,t)]})}),a=f.call(y,o,t),s=z.permute(s,a),o=z.permute(o,a),l=d.call(y,o,t),u=s[0].length,c=0;c<u;++c)for(p.call(y,s[0][c],i=l[c],o[0][c][1]),n=1;n<r;++n)p.call(y,s[n][c],i+=o[n-1][c][1],o[n][c][1]);return e}return y.values=function(e){return arguments.length?(h=e,y):h},y.order=function(e){return arguments.length?(f="function"==typeof e?e:na.get(e)||oa,y):f},y.offset=function(e){return arguments.length?(d="function"==typeof e?e:ia.get(e)||aa,y):d},y.x=function(e){return arguments.length?(m=e,y):m},y.y=function(e){return arguments.length?(g=e,y):g},y.out=function(e){return arguments.length?(p=e,y):p},y};var na=z.map({"inside-out":function(e){for(var t,r=e.length,n=e.map(sa),i=e.map(la),o=z.range(r).sort(function(e,t){return n[e]-n[t]}),a=0,s=0,l=[],u=[],c=0;c<r;++c)t=o[c],(a<s?(a+=i[t],l):(s+=i[t],u)).push(t);return u.reverse().concat(l)},reverse:function(e){return z.range(e.length).reverse()},default:oa}),ia=z.map({silhouette:function(e){for(var t,r,n=e.length,i=e[0].length,o=[],a=0,s=[],l=0;l<i;++l){for(r=t=0;t<n;t++)r+=e[t][l][1];a<r&&(a=r),o.push(r)}for(l=0;l<i;++l)s[l]=(a-o[l])/2;return s},wiggle:function(e){var t,r,n,i,o,a,s,l,u,c=e.length,h=e[0],f=h.length,d=[];for(d[0]=l=u=0,r=1;r<f;++r){for(i=t=0;t<c;++t)i+=e[t][r][1];for(s=h[r][o=t=0]-h[r-1][0];t<c;++t){for(n=0,a=(e[t][r][1]-e[t][r-1][1])/(2*s);n<t;++n)a+=(e[n][r][1]-e[n][r-1][1])/s;o+=a*e[t][r][1]}d[r]=l-=i?o/i*s:0,l<u&&(u=l)}for(r=0;r<f;++r)d[r]-=u;return d},expand:function(e){for(var t,r,n=e.length,i=e[0].length,o=1/n,a=[],s=0;s<i;++s){for(r=t=0;t<n;t++)r+=e[t][s][1];if(r)for(t=0;t<n;t++)e[t][s][1]/=r;else for(t=0;t<n;t++)e[t][s][1]=o}for(s=0;s<i;++s)a[s]=0;return a},zero:aa});function oa(e){return z.range(e.length)}function aa(e){for(var t=-1,r=e[0].length,n=[];++t<r;)n[t]=0;return n}function sa(e){for(var t,r=1,n=0,i=e[0][1],o=e.length;r<o;++r)(t=e[r][1])>i&&(n=r,i=t);return n}function la(e){return e.reduce(ua,0)}function ua(e,t){return e+t[1]}function ca(e,t){return ha(e,Math.ceil(Math.log(t.length)/Math.LN2+1))}function ha(e,t){for(var r=-1,n=+e[0],i=(e[1]-n)/t,o=[];++r<=t;)o[r]=i*r+n;return o}function fa(e){return[z.min(e),z.max(e)]}function da(e,t){return e.value-t.value}function pa(e,t){var r=e._pack_next;(e._pack_next=t)._pack_prev=e,(t._pack_next=r)._pack_prev=t}function ma(e,t){(e._pack_next=t)._pack_prev=e}function ga(e,t){var r=t.x-e.x,n=t.y-e.y,e=e.r+t.r;return r*r+n*n<.999*e*e}function ya(e){if((t=e.children)&&(a=t.length)){var t,r,n,i,o,a,s=1/0,l=-1/0,u=1/0,c=-1/0;if(t.forEach(va),(r=t[0]).x=-r.r,r.y=0,_(r),1<a&&((n=t[1]).x=n.r,n.y=0,_(n),2<a))for(xa(r,n,i=t[2]),_(i),pa(r,i),pa(r._pack_prev=i,n),n=r._pack_next,v=3;v<a;v++){xa(r,n,i=t[v]);for(var h=0,f=1,d=1,p=n._pack_next;p!==n;p=p._pack_next,f++)if(ga(p,i)){h=1;break}if(1==h)for(o=r._pack_prev;o!==p._pack_prev&&!ga(o,i);o=o._pack_prev,d++);h?(f<d||f==d&&n.r<r.r?ma(r,n=p):ma(r=o,n),v--):(pa(r,i),_(n=i))}for(var m=(s+l)/2,g=(u+c)/2,y=0,v=0;v<a;v++)(i=t[v]).x-=m,i.y-=g,y=Math.max(y,i.r+Math.sqrt(i.x*i.x+i.y*i.y));e.r=y,t.forEach(_a)}function _(e){s=Math.min(e.x-e.r,s),l=Math.max(e.x+e.r,l),u=Math.min(e.y-e.r,u),c=Math.max(e.y+e.r,c)}}function va(e){e._pack_next=e._pack_prev=e}function _a(e){delete e._pack_next,delete e._pack_prev}function xa(e,t,r){var n,i,o=e.r+r.r,a=t.x-e.x,s=t.y-e.y;o&&(a||s)?(t=t.r+r.r,i=.5+((o*=o)-(t*=t))/(2*(n=a*a+s*s)),t=Math.sqrt(Math.max(0,2*t*(o+n)-(o-=n)*o-t*t))/(2*n),r.x=e.x+i*a+t*s,r.y=e.y+i*s-t*a):(r.x=e.x+o,r.y=e.y)}function ba(e,t){return e.parent==t.parent?1:2}function wa(e){var t=e.children;return t.length?t[0]:e.t}function Ea(e){var t,r=e.children;return(t=r.length)?r[t-1]:e.t}function Ta(e){return{x:e.x,y:e.y,dx:e.dx,dy:e.dy}}function Sa(e,t){var r=e.x+t[3],n=e.y+t[0],i=e.dx-t[1]-t[3],e=e.dy-t[0]-t[2];return i<0&&(r+=i/2,i=0),e<0&&(n+=e/2,e=0),{x:r,y:n,dx:i,dy:e}}function Ma(e){var t=e[0],e=e[e.length-1];return t<e?[t,e]:[e,t]}function ka(e){return e.rangeExtent?e.rangeExtent():Ma(e.range())}function Ca(e,t,r,n){var i=r(e[0],e[1]),o=n(t[0],t[1]);return function(e){return o(i(e))}}function Aa(e,t){var r,n=0,i=e.length-1,o=e[n],a=e[i];return a<o&&(r=n,n=i,i=r,r=o,o=a,a=r),e[n]=t.floor(o),e[i]=t.ceil(a),e}function Ia(t){return t?{floor:function(e){return Math.floor(e/t)*t},ceil:function(e){return Math.ceil(e/t)*t}}:La}z.layout.histogram=function(){var h=!0,f=Number,d=fa,p=ca;function r(e,t){for(var r,n,i=[],o=e.map(f,this),a=d.call(this,o,t),s=p.call(this,a,o,t),t=-1,l=o.length,u=s.length-1,c=h?1:1/l;++t<u;)(r=i[t]=[]).dx=s[t+1]-(r.x=s[t]),r.y=0;if(0<u)for(t=-1;++t<l;)(n=o[t])>=a[0]&&n<=a[1]&&((r=i[z.bisect(s,n,1,u)-1]).y+=c,r.push(e[t]));return i}return r.value=function(e){return arguments.length?(f=e,r):f},r.range=function(e){return arguments.length?(d=F(e),r):d},r.bins=function(t){return arguments.length?(p="number"==typeof t?function(e){return ha(e,t)}:F(t),r):p},r.frequency=function(e){return arguments.length?(h=!!e,r):h},r},z.layout.pack=function(){var a,s=z.layout.hierarchy().sort(da),l=0,u=[1,1];function t(e,t){var r,e=s.call(this,e,t),t=e[0],n=u[0],i=u[1],o=null==a?Math.sqrt:"function"==typeof a?a:function(){return a};return t.x=t.y=0,$o(t,function(e){e.r=+o(e.value)}),$o(t,ya),l&&(r=l*(a?1:Math.max(2*t.r/n,2*t.r/i))/2,$o(t,function(e){e.r+=r}),$o(t,ya),$o(t,function(e){e.r-=r})),function e(t,r,n,i){var o=t.children;t.x=r+=i*t.x;t.y=n+=i*t.y;t.r*=i;if(o)for(var a=-1,s=o.length;++a<s;)e(o[a],r,n,i)}(t,n/2,i/2,a?1:1/Math.max(2*t.r/n,2*t.r/i)),e}return t.size=function(e){return arguments.length?(u=e,t):u},t.radius=function(e){return arguments.length?(a=null==e||"function"==typeof e?e:+e,t):a},t.padding=function(e){return arguments.length?(l=+e,t):l},qo(t,s)},z.layout.tree=function(){var u=z.layout.hierarchy().sort(null).value(null),f=ba,c=[1,1],h=null;function t(e,t){var r,n,i,o,a,s,e=u.call(this,e,t),t=e[0],l=function(e){var t,e={A:null,children:[e]},r=[e];for(;null!=(t=r.pop());)for(var n,i=t.children,o=0,a=i.length;o<a;++o)r.push((i[o]=n={_:i[o],parent:t,children:(n=i[o].children)&&n.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:o}).a=n);return e.children[0]}(t);return $o(l,d),l.parent.m=-l.z,Ho(l,p),h?Ho(t,m):(Ho(i=n=r=t,function(e){e.x<r.x&&(r=e),e.x>n.x&&(n=e),e.depth>i.depth&&(i=e)}),o=f(r,n)/2-r.x,a=c[0]/(n.x+f(n,r)/2+o),s=c[1]/(i.depth||1),Ho(t,function(e){e.x=(e.x+o)*a,e.y=e.depth*s})),e}function d(e){var t=e.children,r=e.parent.children,n=e.i?r[e.i-1]:null;if(t.length){for(var i,o=0,a=0,s=e.children,l=s.length;0<=--l;)(i=s[l]).z+=o,i.m+=o,o+=i.s+(a+=i.c);t=(t[0].z+t[t.length-1].z)/2;n?(e.z=n.z+f(e._,n._),e.m=e.z-t):e.z=t}else n&&(e.z=n.z+f(e._,n._));e.parent.A=function(e,t,r){if(t){for(var n,i=e,o=e,a=t,s=i.parent.children[0],l=i.m,u=o.m,c=a.m,h=s.m;a=Ea(a),i=wa(i),a&&i;)s=wa(s),(o=Ea(o)).a=e,0<(n=a.z+c-i.z-l+f(a._,i._))&&(function(e,t,r){var n=r/(t.i-e.i);t.c-=n,t.s+=r,e.c+=n,t.z+=r,t.m+=r}(function(e,t,r){return e.a.parent===t.parent?e.a:r}(a,e,r),e,n),l+=n,u+=n),c+=a.m,l+=i.m,h+=s.m,u+=o.m;a&&!Ea(o)&&(o.t=a,o.m+=c-u),i&&!wa(s)&&(s.t=i,s.m+=l-h,r=e)}return r}(e,n,e.parent.A||r[0])}function p(e){e._.x=e.z+e.parent.m,e.m+=e.parent.m}function m(e){e.x*=c[0],e.y=e.depth*c[1]}return t.separation=function(e){return arguments.length?(f=e,t):f},t.size=function(e){return arguments.length?(h=null==(c=e)?m:null,t):h?null:c},t.nodeSize=function(e){return arguments.length?(h=null==(c=e)?null:m,t):h?c:null},qo(t,u)},z.layout.cluster=function(){var l=z.layout.hierarchy().sort(null).value(null),u=ba,c=[1,1],h=!1;function t(e,t){var n,e=l.call(this,e,t),r=e[0],i=0,t=($o(r,function(e){var t,r=e.children;r&&r.length?(e.x=(t=r).reduce(function(e,t){return e+t.x},0)/t.length,e.y=1+z.max(r,function(e){return e.y})):(e.x=n?i+=u(e,n):0,e.y=0,n=e)}),function e(t){var r=t.children;return r&&r.length?e(r[0]):t}(r)),o=function e(t){var r,n=t.children;return n&&(r=n.length)?e(n[r-1]):t}(r),a=t.x-u(t,o)/2,s=o.x+u(o,t)/2;return $o(r,h?function(e){e.x=(e.x-r.x)*c[0],e.y=(r.y-e.y)*c[1]}:function(e){e.x=(e.x-a)/(s-a)*c[0],e.y=(1-(r.y?e.y/r.y:1))*c[1]}),e}return t.separation=function(e){return arguments.length?(u=e,t):u},t.size=function(e){return arguments.length?(h=null==(c=e),t):h?null:c},t.nodeSize=function(e){return arguments.length?(h=null!=(c=e),t):h?c:null},qo(t,l)},z.layout.treemap=function(){var r,n=z.layout.hierarchy(),c=Math.round,i=[1,1],o=null,u=Ta,a=!1,h="squarify",f=.5*(1+Math.sqrt(5));function d(e,t){for(var r,n,i=-1,o=e.length;++i<o;)n=(r=e[i]).value*(t<0?0:t),r.area=isNaN(n)||n<=0?0:n}function p(e){var t=e.children;if(t&&t.length){var r,n,i=u(e),o=[],a=t.slice(),s=1/0,l="slice"===h?i.dx:"dice"===h?i.dy:"slice-dice"===h?1&e.depth?i.dy:i.dx:Math.min(i.dx,i.dy);for(d(a,i.dx*i.dy/e.value),o.area=0;0<(n=a.length);)o.push(n=a[n-1]),o.area+=n.area,s="squarify"!==h||(r=function(e,t){var r,n=e.area,i=0,o=1/0,a=-1,s=e.length;for(;++a<s;)(r=e[a].area)&&(r<o&&(o=r),i<r&&(i=r));return t*=t,(n*=n)?Math.max(t*i*f/n,n/(t*o*f)):1/0}(o,l))<=s?(a.pop(),r):(o.area-=o.pop().area,m(o,l,i,!1),l=Math.min(i.dx,i.dy),1/(o.length=o.area=0));o.length&&(m(o,l,i,!0),o.length=o.area=0),t.forEach(p)}}function s(e){var t=e.children;if(t&&t.length){var r,n=u(e),i=t.slice(),o=[];for(d(i,n.dx*n.dy/e.value),o.area=0;r=i.pop();)o.push(r),o.area+=r.area,null!=r.z&&(m(o,r.z?n.dx:n.dy,n,!i.length),o.length=o.area=0);t.forEach(s)}}function m(e,t,r,n){var i,o=-1,a=e.length,s=r.x,l=r.y,u=t?c(e.area/t):0;if(t==r.dx){for((n||u>r.dy)&&(u=r.dy);++o<a;)(i=e[o]).x=s,i.y=l,i.dy=u,s+=i.dx=Math.min(r.x+r.dx-s,u?c(i.area/u):0);i.z=!0,i.dx+=r.x+r.dx-s,r.y+=u,r.dy-=u}else{for((n||u>r.dx)&&(u=r.dx);++o<a;)(i=e[o]).x=s,i.y=l,i.dx=u,l+=i.dy=Math.min(r.y+r.dy-l,u?c(i.area/u):0);i.z=!1,i.dy+=r.y+r.dy-l,r.x+=u,r.dx-=u}}function l(e){var e=r||n(e),t=e[0];return t.x=t.y=0,t.value?(t.dx=i[0],t.dy=i[1]):t.dx=t.dy=0,r&&n.revalue(t),d([t],t.dx*t.dy/t.value),(r?s:p)(t),a&&(r=e),e}return l.size=function(e){return arguments.length?(i=e,l):i},l.padding=function(r){var e;return arguments.length?(u=null==(o=r)?Ta:"function"==(e=typeof r)?function(e){var t=r.call(l,e,e.depth);return null==t?Ta(e):Sa(e,"number"==typeof t?[t,t,t,t]:t)}:("number"==e&&(r=[r,r,r,r]),t),l):o;function t(e){return Sa(e,r)}},l.round=function(e){return arguments.length?(c=e?Math.round:Number,l):c!=Number},l.sticky=function(e){return arguments.length?(a=e,r=null,l):a},l.ratio=function(e){return arguments.length?(f=e,l):f},l.mode=function(e){return arguments.length?(h=e+"",l):h},qo(l,n)},z.random={normal:function(n,i){var e=arguments.length;return e<2&&(i=1),e<1&&(n=0),function(){for(var e,t,r;!(r=(e=2*Math.random()-1)*e+(t=2*Math.random()-1)*t)||1<r;);return n+i*e*Math.sqrt(-2*Math.log(r)/r)}},logNormal:function(){var e=z.random.normal.apply(z,arguments);return function(){return Math.exp(e())}},bates:function(e){var t=z.random.irwinHall(e);return function(){return t()/e}},irwinHall:function(r){return function(){for(var e=0,t=0;t<r;t++)e+=Math.random();return e}}},z.scale={};var La={floor:I,ceil:I};function Pa(r,e,t,n){var i=[],o=[],a=0,s=Math.min(r.length,e.length)-1;for(r[s]<r[0]&&(r=r.slice().reverse(),e=e.slice().reverse());++a<=s;)i.push(t(r[a-1],r[a])),o.push(n(e[a-1],e[a]));return function(e){var t=z.bisect(r,e,1,s)-1;return o[t](i[t](e))}}function za(e,t){return z.rebind(e,t,"range","rangeRound","interpolate","clamp")}function Da(e,t){return Aa(e,Ia(Oa(e,t)[2])),Aa(e,Ia(Oa(e,t)[2])),e}function Oa(e,t){null==t&&(t=10);var e=Ma(e),r=e[1]-e[0],n=Math.pow(10,Math.floor(Math.log(r/t)/Math.LN10)),t=t/r*n;return t<=.15?n*=10:t<=.35?n*=5:t<=.75&&(n*=2),e[0]=Math.ceil(e[0]/n)*n,e[1]=Math.floor(e[1]/n)*n+.5*n,e[2]=n,e}function Ra(e,t){return z.range.apply(z,Oa(e,t))}function Fa(e,t,r){var n,i,o,e=Oa(e,t);if(r){var a,t=jt.exec(r);if(t.shift(),"s"===t[8])return a=z.formatPrefix(Math.max(L(e[0]),L(e[1]))),t[7]||(t[7]="."+Na(a.scale(e[2]))),t[8]="f",r=z.format(t.join("")),function(e){return r(a.scale(e))+a.symbol};t[7]||(t[7]="."+(n=t[8],o=Na((i=e)[2]),n in Ba?Math.abs(o-Na(Math.max(L(i[0]),L(i[1]))))+ +("e"!==n):o-2*("%"===n))),r=t.join("")}else r=",."+Na(e[2])+"f";return z.format(r)}z.scale.linear=function(){return function e(r,n,i,o){var a,s;function t(){var e=2<Math.min(r.length,n.length)?Pa:Ca,t=o?Fo:Ro;return a=e(r,n,t,i),s=e(n,r,t,mo),l}function l(e){return a(e)}l.invert=function(e){return s(e)};l.domain=function(e){return arguments.length?(r=e.map(Number),t()):r};l.range=function(e){return arguments.length?(n=e,t()):n};l.rangeRound=function(e){return l.range(e).interpolate(Ao)};l.clamp=function(e){return arguments.length?(o=e,t()):o};l.interpolate=function(e){return arguments.length?(i=e,t()):i};l.ticks=function(e){return Ra(r,e)};l.tickFormat=function(e,t){return Fa(r,e,t)};l.nice=function(e){return Da(r,e),t()};l.copy=function(){return e(r,n,i,o)};return t()}([0,1],[0,1],mo,!1)};var Ba={s:1,g:1,p:1,r:1,e:1};function Na(e){return-Math.floor(Math.log(e)/Math.LN10+.01)}z.scale.log=function(){return function e(t,l,u,c){function h(e){return(u?Math.log(e<0?0:e):-Math.log(0<e?0:-e))/Math.log(l)}function f(e){return u?Math.pow(l,e):-Math.pow(l,-e)}function i(e){return t(h(e))}i.invert=function(e){return f(t.invert(e))};i.domain=function(e){return arguments.length?(u=0<=e[0],t.domain((c=e.map(Number)).map(h)),i):c};i.base=function(e){return arguments.length?(l=+e,t.domain(c.map(h)),i):l};i.nice=function(){var e=Aa(c.map(h),u?Math:Ua);return t.domain(e),c=e.map(f),i};i.ticks=function(){var e=Ma(c),t=[],r=e[0],n=e[1],i=Math.floor(h(r)),o=Math.ceil(h(n)),a=l%1?2:l;if(isFinite(o-i)){if(u){for(;i<o;i++)for(var s=1;s<a;s++)t.push(f(i)*s);t.push(f(i))}else for(t.push(f(i));i++<o;)for(s=a-1;0<s;s--)t.push(f(i)*s);for(i=0;t[i]<r;i++);for(o=t.length;t[o-1]>n;o--);t=t.slice(i,o)}return t};i.tickFormat=function(e,r){if(!arguments.length)return ja;arguments.length<2?r=ja:"function"!=typeof r&&(r=z.format(r));var n=Math.max(1,l*e/i.ticks().length);return function(e){var t=e/f(Math.round(h(e)));return t*l<l-.5&&(t*=l),t<=n?r(e):""}};i.copy=function(){return e(t.copy(),l,u,c)};return za(i,t)}(z.scale.linear().domain([0,1]),10,!0,[1,10])};var ja=z.format(".0e"),Ua={floor:function(e){return-Math.ceil(-e)},ceil:function(e){return-Math.floor(-e)}};function Va(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}z.scale.pow=function(){return function e(t,r,n){var i=Va(r),o=Va(1/r);function a(e){return t(i(e))}a.invert=function(e){return o(t.invert(e))};a.domain=function(e){return arguments.length?(t.domain((n=e.map(Number)).map(i)),a):n};a.ticks=function(e){return Ra(n,e)};a.tickFormat=function(e,t){return Fa(n,e,t)};a.nice=function(e){return a.domain(Da(n,e))};a.exponent=function(e){return arguments.length?(i=Va(r=e),o=Va(1/r),t.domain(n.map(i)),a):r};a.copy=function(){return e(t.copy(),r,n)};return za(a,t)}(z.scale.linear(),1,[0,1])},z.scale.sqrt=function(){return z.scale.pow().exponent(.5)},z.scale.ordinal=function(){return function e(s,l){var i,u,c;function h(e){return u[((i.get(e)||("range"===l.t?i.set(e,s.push(e)):NaN))-1)%u.length]}function f(t,r){return z.range(s.length).map(function(e){return t+r*e})}h.domain=function(e){if(!arguments.length)return s;s=[],i=new $;for(var t,r=-1,n=e.length;++r<n;)i.has(t=e[r])||i.set(t,s.push(t));return h[l.t].apply(h,l.a)};h.range=function(e){return arguments.length?(u=e,c=0,l={t:"range",a:arguments},h):u};h.rangePoints=function(e,t){arguments.length<2&&(t=0);var r=e[0],n=e[1],n=s.length<2?(r=(r+n)/2,0):(n-r)/(s.length-1+t);return u=f(r+n*t/2,n),c=0,l={t:"rangePoints",a:arguments},h};h.rangeRoundPoints=function(e,t){arguments.length<2&&(t=0);var r=e[0],n=e[1],i=s.length<2?(r=n=Math.round((r+n)/2),0):(n-r)/(s.length-1+t)|0;return u=f(r+Math.round(i*t/2+(n-r-(s.length-1+t)*i)/2),i),c=0,l={t:"rangeRoundPoints",a:arguments},h};h.rangeBands=function(e,t,r){arguments.length<2&&(t=0),arguments.length<3&&(r=t);var n=e[1]<e[0],i=e[+n],o=e[1-n],o=(o-i)/(s.length-t+2*r);return u=f(i+o*r,o),n&&u.reverse(),c=o*(1-t),l={t:"rangeBands",a:arguments},h};h.rangeRoundBands=function(e,t,r){arguments.length<2&&(t=0),arguments.length<3&&(r=t);var n=e[1]<e[0],i=e[+n],o=e[1-n],a=Math.floor((o-i)/(s.length-t+2*r));return u=f(i+Math.round((o-i-(s.length-t)*a)/2),a),n&&u.reverse(),c=Math.round(a*(1-t)),l={t:"rangeRoundBands",a:arguments},h};h.rangeBand=function(){return c};h.rangeExtent=function(){return Ma(l.a[0])};h.copy=function(){return e(s,l)};return h.domain(s)}([],{t:"range",a:[[]]})},z.scale.category10=function(){return z.scale.ordinal().range(Ga)},z.scale.category20=function(){return z.scale.ordinal().range(Wa)},z.scale.category20b=function(){return z.scale.ordinal().range(Za)},z.scale.category20c=function(){return z.scale.ordinal().range(qa)};var Ga=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(_t),Wa=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(_t),Za=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(_t),qa=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(_t);function Ha(){return 0}z.scale.quantile=function(){return function e(r,n){var i;function t(){var e=0,t=n.length;for(i=[];++e<t;)i[e-1]=z.quantile(r,e/t);return o}function o(e){if(!isNaN(e=+e))return n[z.bisect(i,e)]}o.domain=function(e){return arguments.length?(r=e.map(W).filter(Z).sort(G),t()):r};o.range=function(e){return arguments.length?(n=e,t()):n};o.quantiles=function(){return i};o.invertExtent=function(e){return(e=n.indexOf(e))<0?[NaN,NaN]:[0<e?i[e-1]:r[0],e<i.length?i[e]:r[r.length-1]]};o.copy=function(){return e(r,n)};return t()}([],[])},z.scale.quantize=function(){return function e(t,r,n){var i,o;function a(e){return n[Math.max(0,Math.min(o,Math.floor(i*(e-t))))]}function s(){return i=n.length/(r-t),o=n.length-1,a}a.domain=function(e){return arguments.length?(t=+e[0],r=+e[e.length-1],s()):[t,r]};a.range=function(e){return arguments.length?(n=e,s()):n};a.invertExtent=function(e){return[e=(e=n.indexOf(e))<0?NaN:e/i+t,e+1/i]};a.copy=function(){return e(t,r,n)};return s()}(0,1,[0,1])},z.scale.threshold=function(){return function e(t,r){function n(e){if(e<=e)return r[z.bisect(t,e)]}n.domain=function(e){return arguments.length?(t=e,n):t};n.range=function(e){return arguments.length?(r=e,n):r};n.invertExtent=function(e){return e=r.indexOf(e),[t[e-1],t[e]]};n.copy=function(){return e(t,r)};return n}([.5],[0,1])},z.scale.identity=function(){return function e(r){function t(e){return+e}t.invert=t;t.domain=t.range=function(e){return arguments.length?(r=e.map(t),t):r};t.ticks=function(e){return Ra(r,e)};t.tickFormat=function(e,t){return Fa(r,e,t)};t.copy=function(){return e(r)};return t}([0,1])},z.svg={},z.svg.arc=function(){var E=Xa,T=Ya,S=Ha,M=$a,k=Ja,C=Ka,A=Qa;function t(){var e,t,r,n,i,o,a,s,l,u,c,h,f,d,p,m,g,y=Math.max(0,+E.apply(this,arguments)),v=Math.max(0,+T.apply(this,arguments)),_=k.apply(this,arguments)-R,x=C.apply(this,arguments)-R,b=Math.abs(x-_),w=x<_?0:1;return v<y&&(e=v,v=y,y=e),$e<=b?I(v,w)+(y?I(y,1-w):"")+"Z":(f=d=0,t=[],(g=(+A.apply(this,arguments)||0)/2)&&(p=M===$a?Math.sqrt(y*y+v*v):+M.apply(this,arguments),w||(f*=-1),v&&(f=Ke(p/v*Math.sin(g))),y&&(d=Ke(p/y*Math.sin(g)))),v?(i=v*Math.cos(_+f),o=v*Math.sin(_+f),a=v*Math.cos(x-f),r=v*Math.sin(x-f),n=Math.abs(x-_-2*f)<=O?0:1,f&&es(i,o,a,r)===w^n&&(p=(_+x)/2,i=v*Math.cos(p),o=v*Math.sin(p),a=r=null)):i=o=0,y?(u=y*Math.cos(x-d),c=y*Math.sin(x-d),h=y*Math.cos(_+d),s=y*Math.sin(_+d),l=Math.abs(_-x+2*d)<=O?0:1,d&&es(u,c,h,s)===1-w^l&&(g=(_+x)/2,u=y*Math.cos(g),c=y*Math.sin(g),h=s=null)):u=c=0,P<b&&.001<(e=Math.min(Math.abs(v-y)/2,+S.apply(this,arguments)))?(f=y<v^w?0:1,d=p=e,b<O&&(x=i-(_=null==h?[u,c]:null==a?[i,o]:Mi([i,o],[h,s],[a,r],[u,c]))[0],g=o-_[1],b=a-_[0],m=r-_[1],x=1/Math.sin(Math.acos((x*b+g*m)/(Math.sqrt(x*x+g*g)*Math.sqrt(b*b+m*m)))/2),g=Math.sqrt(_[0]*_[0]+_[1]*_[1]),d=Math.min(e,(y-g)/(x-1)),p=Math.min(e,(v-g)/(1+x))),null!=a?(b=ts(null==h?[u,c]:[h,s],[i,o],v,p,w),m=ts([a,r],[u,c],v,p,w),e===p?t.push("M",b[0],"A",p,",",p," 0 0,",f," ",b[1],"A",v,",",v," 0 ",1-w^es(b[1][0],b[1][1],m[1][0],m[1][1]),",",w," ",m[1],"A",p,",",p," 0 0,",f," ",m[0]):t.push("M",b[0],"A",p,",",p," 0 1,",f," ",m[0])):t.push("M",i,",",o),null!=h?(_=ts([i,o],[h,s],y,-d,w),g=ts([u,c],null==a?[i,o]:[a,r],y,-d,w),e===d?t.push("L",g[0],"A",d,",",d," 0 0,",f," ",g[1],"A",y,",",y," 0 ",w^es(g[1][0],g[1][1],_[1][0],_[1][1]),",",1-w," ",_[1],"A",d,",",d," 0 0,",f," ",_[0]):t.push("L",g[0],"A",d,",",d," 0 0,",f," ",_[0])):t.push("L",u,",",c)):(t.push("M",i,",",o),null!=a&&t.push("A",v,",",v," 0 ",n,",",w," ",a,",",r),t.push("L",u,",",c),null!=h&&t.push("A",y,",",y," 0 ",l,",",1-w," ",h,",",s)),t.push("Z"),t.join(""))}function I(e,t){return"M0,"+e+"A"+e+","+e+" 0 1,"+t+" 0,"+-e+"A"+e+","+e+" 0 1,"+t+" 0,"+e}return t.innerRadius=function(e){return arguments.length?(E=F(e),t):E},t.outerRadius=function(e){return arguments.length?(T=F(e),t):T},t.cornerRadius=function(e){return arguments.length?(S=F(e),t):S},t.padRadius=function(e){return arguments.length?(M=e==$a?$a:F(e),t):M},t.startAngle=function(e){return arguments.length?(k=F(e),t):k},t.endAngle=function(e){return arguments.length?(C=F(e),t):C},t.padAngle=function(e){return arguments.length?(A=F(e),t):A},t.centroid=function(){var e=(+E.apply(this,arguments)+ +T.apply(this,arguments))/2,t=(+k.apply(this,arguments)+ +C.apply(this,arguments))/2-R;return[Math.cos(t)*e,Math.sin(t)*e]},t};var $a="auto";function Xa(e){return e.innerRadius}function Ya(e){return e.outerRadius}function Ja(e){return e.startAngle}function Ka(e){return e.endAngle}function Qa(e){return e&&e.padAngle}function es(e,t,r,n){return 0<(e-r)*t-(t-n)*e?0:1}function ts(e,t,r,n,i){var o=e[0]-t[0],a=e[1]-t[1],i=(i?n:-n)/Math.sqrt(o*o+a*a),a=i*a,i=-i*o,o=e[0]+a,e=e[1]+i,s=t[0]+a,t=t[1]+i,l=(o+s)/2,u=(e+t)/2,c=s-o,h=t-e,f=c*c+h*h,n=r-n,o=o*t-s*e,t=(h<0?-1:1)*Math.sqrt(Math.max(0,n*n*f-o*o)),s=(o*h-c*t)/f,e=(-o*c-h*t)/f,d=(o*h+c*t)/f,o=(-o*c+h*t)/f,c=s-l,h=e-u,t=d-l,f=o-u;return t*t+f*f<c*c+h*h&&(s=d,e=o),[[s-a,e-i],[s*r/n,e*r/n]]}function rs(u){var c=xi,h=bi,f=fn,d=C,t=d.key,p=.7;function r(e){var t,r=[],n=[],i=-1,o=e.length,a=F(c),s=F(h);function l(){r.push("M",d(u(n),p))}for(;++i<o;)f.call(this,t=e[i],i)?n.push([+a.call(this,t,i),+s.call(this,t,i)]):n.length&&(l(),n=[]);return n.length&&l(),r.length?r.join(""):null}return r.x=function(e){return arguments.length?(c=e,r):c},r.y=function(e){return arguments.length?(h=e,r):h},r.defined=function(e){return arguments.length?(f=e,r):f},r.interpolate=function(e){return arguments.length?(t="function"==typeof e?d=e:(d=ns.get(e)||C).key,r):t},r.tension=function(e){return arguments.length?(p=e,r):p},r}z.svg.line=function(){return rs(I)};var ns=z.map({linear:C,"linear-closed":is,step:function(e){var t=0,r=e.length,n=e[0],i=[n[0],",",n[1]];for(;++t<r;)i.push("H",(n[0]+(n=e[t])[0])/2,"V",n[1]);1<r&&i.push("H",n[0]);return i.join("")},"step-before":os,"step-after":as,basis:us,"basis-open":function(e){if(e.length<4)return C(e);var t,r=[],n=-1,i=e.length,o=[0],a=[0];for(;++n<3;)t=e[n],o.push(t[0]),a.push(t[1]);r.push(x(fs,o)+","+x(fs,a)),--n;for(;++n<i;)t=e[n],o.shift(),o.push(t[0]),a.shift(),a.push(t[1]),ds(r,o,a);return r.join("")},"basis-closed":function(e){var t,r,n=-1,i=e.length,o=i+4,a=[],s=[];for(;++n<4;)r=e[n%i],a.push(r[0]),s.push(r[1]);t=[x(fs,a),",",x(fs,s)],--n;for(;++n<o;)r=e[n%i],a.shift(),a.push(r[0]),s.shift(),s.push(r[1]),ds(t,a,s);return t.join("")},bundle:function(e,t){var r=e.length-1;if(r)for(var n,i,o=e[0][0],a=e[0][1],s=e[r][0]-o,l=e[r][1]-a,u=-1;++u<=r;)n=e[u],i=u/r,n[0]=t*n[0]+(1-t)*(o+i*s),n[1]=t*n[1]+(1-t)*(a+i*l);return us(e)},cardinal:function(e,t){return e.length<3?C(e):e[0]+ss(e,ls(e,t))},"cardinal-open":function(e,t){return e.length<4?C(e):e[1]+ss(e.slice(1,-1),ls(e,t))},"cardinal-closed":function(e,t){return e.length<3?is(e):e[0]+ss((e.push(e[0]),e),ls([e[e.length-2]].concat(e,[e[1]]),t))},monotone:function(e){return e.length<3?C(e):e[0]+ss(e,function(e){var t,r,n,i,o=[],a=function(e){var t=0,r=e.length-1,n=[],i=e[0],o=e[1],a=n[0]=ps(i,o);for(;++t<r;)n[t]=(a+(a=ps(i=o,o=e[t+1])))/2;return n[t]=a,n}(e),s=-1,l=e.length-1;for(;++s<l;)t=ps(e[s],e[s+1]),L(t)<P?a[s]=a[s+1]=0:(r=a[s]/t,n=a[s+1]/t,9<(i=r*r+n*n)&&(i=3*t/Math.sqrt(i),a[s]=i*r,a[s+1]=i*n));s=-1;for(;++s<=l;)i=(e[Math.min(l,s+1)][0]-e[Math.max(0,s-1)][0])/(6*(1+a[s]*a[s])),o.push([i||0,a[s]*i||0]);return o}(e))}});function C(e){return 1<e.length?e.join("L"):e+"Z"}function is(e){return e.join("L")+"Z"}function os(e){for(var t=0,r=e.length,n=e[0],i=[n[0],",",n[1]];++t<r;)i.push("V",(n=e[t])[1],"H",n[0]);return i.join("")}function as(e){for(var t=0,r=e.length,n=e[0],i=[n[0],",",n[1]];++t<r;)i.push("H",(n=e[t])[0],"V",n[1]);return i.join("")}function ss(e,t){if(t.length<1||e.length!=t.length&&e.length!=t.length+2)return C(e);var r=e.length!=t.length,n="",i=e[0],o=e[1],a=t[0],s=a,l=1;if(r&&(n+="Q"+(o[0]-2*a[0]/3)+","+(o[1]-2*a[1]/3)+","+o[0]+","+o[1],i=e[1],l=2),1<t.length){s=t[1],o=e[l],l++,n+="C"+(i[0]+a[0])+","+(i[1]+a[1])+","+(o[0]-s[0])+","+(o[1]-s[1])+","+o[0]+","+o[1];for(var u=2;u<t.length;u++,l++)o=e[l],s=t[u],n+="S"+(o[0]-s[0])+","+(o[1]-s[1])+","+o[0]+","+o[1]}return r&&(i=e[l],n+="Q"+(o[0]+2*s[0]/3)+","+(o[1]+2*s[1]/3)+","+i[0]+","+i[1]),n}function ls(e,t){for(var r,n=[],i=(1-t)/2,o=e[0],a=e[1],s=1,l=e.length;++s<l;)r=o,o=a,a=e[s],n.push([i*(a[0]-r[0]),i*(a[1]-r[1])]);return n}function us(e){if(e.length<3)return C(e);var t=1,r=e.length,n=e[0],i=n[0],o=n[1],a=[i,i,i,(n=e[1])[0]],s=[o,o,o,n[1]],l=[i,",",o,"L",x(fs,a),",",x(fs,s)];for(e.push(e[r-1]);++t<=r;)n=e[t],a.shift(),a.push(n[0]),s.shift(),s.push(n[1]),ds(l,a,s);return e.pop(),l.push("L",n),l.join("")}function x(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}ns.forEach(function(e,t){t.key=e,t.closed=/-closed$/.test(e)});var cs=[0,2/3,1/3,0],hs=[0,1/3,2/3,0],fs=[0,1/6,2/3,1/6];function ds(e,t,r){e.push("C",x(cs,t),",",x(cs,r),",",x(hs,t),",",x(hs,r),",",x(fs,t),",",x(fs,r))}function ps(e,t){return(t[1]-e[1])/(t[0]-e[0])}function ms(e){for(var t,r,n,i=-1,o=e.length;++i<o;)r=(t=e[i])[0],n=t[1]-R,t[0]=r*Math.cos(n),t[1]=r*Math.sin(n);return e}function gs(p){var m=xi,g=xi,y=0,v=bi,_=fn,x=C,t=x.key,b=x,w="L",E=.7;function r(e){var t,r,n,i=[],o=[],a=[],s=-1,l=e.length,u=F(m),c=F(y),h=m===g?function(){return r}:F(g),f=y===v?function(){return n}:F(v);function d(){i.push("M",x(p(a),E),w,b(p(o.reverse()),E),"Z")}for(;++s<l;)_.call(this,t=e[s],s)?(o.push([r=+u.call(this,t,s),n=+c.call(this,t,s)]),a.push([+h.call(this,t,s),+f.call(this,t,s)])):o.length&&(d(),o=[],a=[]);return o.length&&d(),i.length?i.join(""):null}return r.x=function(e){return arguments.length?(m=g=e,r):g},r.x0=function(e){return arguments.length?(m=e,r):m},r.x1=function(e){return arguments.length?(g=e,r):g},r.y=function(e){return arguments.length?(y=v=e,r):v},r.y0=function(e){return arguments.length?(y=e,r):y},r.y1=function(e){return arguments.length?(v=e,r):v},r.defined=function(e){return arguments.length?(_=e,r):_},r.interpolate=function(e){return arguments.length?(t="function"==typeof e?x=e:(x=ns.get(e)||C).key,b=x.reverse||x,w=x.closed?"M":"L",r):t},r.tension=function(e){return arguments.length?(E=e,r):E},r}function ys(e){return e.radius}function vs(e){return[e.x,e.y]}function _s(){return 64}function xs(){return"circle"}function bs(e){e=Math.sqrt(e/O);return"M0,"+e+"A"+e+","+e+" 0 1,1 0,"+-e+"A"+e+","+e+" 0 1,1 0,"+e+"Z"}z.svg.line.radial=function(){var e=rs(ms);return e.radius=e.x,delete e.x,e.angle=e.y,delete e.y,e},(os.reverse=as).reverse=os,z.svg.area=function(){return gs(I)},z.svg.area.radial=function(){var e=gs(ms);return e.radius=e.x,delete e.x,e.innerRadius=e.x0,delete e.x0,e.outerRadius=e.x1,delete e.x1,e.angle=e.y,delete e.y,e.startAngle=e.y0,delete e.y0,e.endAngle=e.y1,delete e.y1,e},z.svg.chord=function(){var i=ai,o=si,a=ys,s=Ja,l=Ka;function t(e,t){var r,n=u(this,i,e,t),e=u(this,o,e,t);return"M"+n.p0+c(n.r,n.p1,n.a1-n.a0)+(t=e,(r=n).a0==t.a0&&r.a1==t.a1?h(n.r,n.p1,n.r,n.p0):h(n.r,n.p1,e.r,e.p0)+c(e.r,e.p1,e.a1-e.a0)+h(e.r,e.p1,n.r,n.p0))+"Z"}function u(e,t,r,n){var t=t.call(e,r,n),r=a.call(e,t,n),i=s.call(e,t,n)-R,e=l.call(e,t,n)-R;return{r:r,a0:i,a1:e,p0:[r*Math.cos(i),r*Math.sin(i)],p1:[r*Math.cos(e),r*Math.sin(e)]}}function c(e,t,r){return"A"+e+","+e+" 0 "+ +(O<r)+",1 "+t}function h(e,t,r,n){return"Q 0,0 "+n}return t.radius=function(e){return arguments.length?(a=F(e),t):a},t.source=function(e){return arguments.length?(i=F(e),t):i},t.target=function(e){return arguments.length?(o=F(e),t):o},t.startAngle=function(e){return arguments.length?(s=F(e),t):s},t.endAngle=function(e){return arguments.length?(l=F(e),t):l},t},z.svg.diagonal=function(){var n=ai,i=si,o=vs;function t(e,t){var r=n.call(this,e,t),e=i.call(this,e,t),t=(r.y+e.y)/2,r=[r,{x:r.x,y:t},{x:e.x,y:t},e];return"M"+(r=r.map(o))[0]+"C"+r[1]+" "+r[2]+" "+r[3]}return t.source=function(e){return arguments.length?(n=F(e),t):n},t.target=function(e){return arguments.length?(i=F(e),t):i},t.projection=function(e){return arguments.length?(o=e,t):o},t},z.svg.diagonal.radial=function(){var e=z.svg.diagonal(),t=vs,n=e.projection;return e.projection=function(e){return arguments.length?n((r=t=e,function(){var e=r.apply(this,arguments),t=e[0],e=e[1]-R;return[t*Math.cos(e),t*Math.sin(e)]})):t;var r},e},z.svg.symbol=function(){var r=xs,n=_s;function t(e,t){return(ws.get(r.call(this,e,t))||bs)(n.call(this,e,t))}return t.type=function(e){return arguments.length?(r=F(e),t):r},t.size=function(e){return arguments.length?(n=F(e),t):n},t};var ws=z.map({circle:bs,cross:function(e){e=Math.sqrt(e/5)/2;return"M"+-3*e+","+-e+"H"+-e+"V"+-3*e+"H"+e+"V"+-e+"H"+3*e+"V"+e+"H"+e+"V"+3*e+"H"+-e+"V"+e+"H"+-3*e+"Z"},diamond:function(e){var e=Math.sqrt(e/(2*Ts)),t=e*Ts;return"M0,"+-e+"L"+t+",0 0,"+e+" "+-t+",0Z"},square:function(e){e=Math.sqrt(e)/2;return"M"+-e+","+-e+"L"+e+","+-e+" "+e+","+e+" "+-e+","+e+"Z"},"triangle-down":function(e){var e=Math.sqrt(e/Es),t=e*Es/2;return"M0,"+t+"L"+e+","+-t+" "+-e+","+-t+"Z"},"triangle-up":function(e){var e=Math.sqrt(e/Es),t=e*Es/2;return"M0,"+-t+"L"+e+","+t+" "+-e+","+t+"Z"}}),Es=(z.svg.symbolTypes=ws.keys(),Math.sqrt(3)),Ts=Math.tan(30*T),Ss=(n.transition=function(e){for(var t,r,n=Cs||++Is,i=zs(e),o=[],a=As||{time:Date.now(),ease:To,delay:0,duration:250},s=-1,l=this.length;++s<l;){o.push(t=[]);for(var u=this[s],c=-1,h=u.length;++c<h;)(r=u[c])&&Ds(r,c,i,n,a),t.push(r)}return ks(o,i,n)},n.interrupt=function(e){return this.each(null==e?Ss:Ms(zs(e)))},Ms(zs()));function Ms(n){return function(){var e,t,r;(e=this[n])&&(r=e[t=e.active])&&(r.timer.c=null,r.timer.t=NaN,--e.count?delete e[t]:delete this[n],e.active+=.5,r.event&&r.event.interrupt.call(this,this.__data__,r.index))}}function ks(e,t,r){return de(e,b),e.namespace=t,e.id=r,e}var Cs,As,b=[],Is=0;function Ls(e,n,i,o){var a=e.id,s=e.namespace;return De(e,"function"==typeof i?function(e,t,r){e[s][a].tween.set(n,o(i.call(e,e.__data__,t,r)))}:(i=o(i),function(e){e[s][a].tween.set(n,i)}))}function Ps(e){return null==e&&(e=""),function(){this.textContent=e}}function zs(e){return null==e?"__transition__":"__transition_"+e+"__"}function Ds(o,a,n,s,e){var l,u,c,h,f,d=o[n]||(o[n]={active:0,count:0}),p=d[s];function r(e){var t,r,n=d.active,i=d[n];for(t in i&&(i.timer.c=null,i.timer.t=NaN,--d.count,delete d[n],i.event&&i.event.interrupt.call(o,o.__data__,i.index)),d)+t<s&&((r=d[t]).timer.c=null,r.timer.t=NaN,--d.count,delete d[t]);u.c=m,Dt(function(){return u.c&&m(e||1)&&(u.c=null,u.t=NaN),1},0,l),d.active=s,p.event&&p.event.start.call(o,o.__data__,a),f=[],p.tween.forEach(function(e,t){(t=t.call(o,o.__data__,a))&&f.push(t)}),h=p.ease,c=p.duration}function m(e){for(var e=e/c,t=h(e),r=f.length;0<r;)f[--r].call(o,t);if(1<=e)return p.event&&p.event.end.call(o,o.__data__,a),--d.count?delete d[s]:delete o[n],1}p||(l=e.time,u=Dt(function(e){var t=p.delay;if(u.t=t+l,t<=e)return r(e-t);u.c=r},0,l),p=d[s]={tween:new $,time:l,timer:u,delay:e.delay,duration:e.duration,ease:e.ease,index:a},e=null,++d.count)}b.call=n.call,b.empty=n.empty,b.node=n.node,b.size=n.size,z.transition=function(e,t){return e&&e.transition?Cs?e.transition(t):e:z.selection().transition(e)},(z.transition.prototype=b).select=function(e){var t,r,n,i=this.id,o=this.namespace,a=[];e=ve(e);for(var s=-1,l=this.length;++s<l;){a.push(t=[]);for(var u=this[s],c=-1,h=u.length;++c<h;)(n=u[c])&&(r=e.call(n,n.__data__,c,s))?("__data__"in n&&(r.__data__=n.__data__),Ds(r,c,o,i,n[o][i]),t.push(r)):t.push(null)}return ks(a,o,i)},b.selectAll=function(e){var t,r,n,i,o,a=this.id,s=this.namespace,l=[];e=_e(e);for(var u=-1,c=this.length;++u<c;)for(var h=this[u],f=-1,d=h.length;++f<d;)if(n=h[f]){o=n[s][a],r=e.call(n,n.__data__,f,u),l.push(t=[]);for(var p=-1,m=r.length;++p<m;)(i=r[p])&&Ds(i,p,s,a,o),t.push(i)}return ks(l,s,a)},b.filter=function(e){var t,r,n=[];"function"!=typeof e&&(e=ze(e));for(var i=0,o=this.length;i<o;i++){n.push(t=[]);for(var a,s=0,l=(a=this[i]).length;s<l;s++)(r=a[s])&&e.call(r,r.__data__,s,i)&&t.push(r)}return ks(n,this.namespace,this.id)},b.tween=function(t,r){var n=this.id,i=this.namespace;return arguments.length<2?this.node()[i][n].tween.get(t):De(this,null==r?function(e){e[i][n].tween.remove(t)}:function(e){e[i][n].tween.set(t,r)})},b.attr=function(e,t){if(arguments.length<2){for(t in e)this.attr(t,e[t]);return this}var n="transform"==e?Oo:mo,i=z.ns.qualify(e);function o(){this.removeAttribute(i)}function a(){this.removeAttributeNS(i.space,i.local)}return Ls(this,"attr."+e,t,i.local?function(r){return null==r?a:(r+="",function(){var t,e=this.getAttributeNS(i.space,i.local);return e!==r&&(t=n(e,r),function(e){this.setAttributeNS(i.space,i.local,t(e))})})}:function(r){return null==r?o:(r+="",function(){var t,e=this.getAttribute(i);return e!==r&&(t=n(e,r),function(e){this.setAttribute(i,t(e))})})})},b.attrTween=function(e,n){var i=z.ns.qualify(e);return this.tween("attr."+e,i.local?function(e,t){var r=n.call(this,e,t,this.getAttributeNS(i.space,i.local));return r&&function(e){this.setAttributeNS(i.space,i.local,r(e))}}:function(e,t){var r=n.call(this,e,t,this.getAttribute(i));return r&&function(e){this.setAttribute(i,r(e))}})},b.style=function(n,e,i){var t=arguments.length;if(t<3){if("string"!=typeof n){for(i in t<2&&(e=""),n)this.style(i,n[i],e);return this}i=""}function o(){this.style.removeProperty(n)}return Ls(this,"style."+n,e,function(r){return null==r?o:(r+="",function(){var t,e=N(this).getComputedStyle(this,null).getPropertyValue(n);return e!==r&&(t=mo(e,r),function(e){this.style.setProperty(n,t(e),i)})})})},b.styleTween=function(n,i,o){return arguments.length<3&&(o=""),this.tween("style."+n,function(e,t){var r=i.call(this,e,t,N(this).getComputedStyle(this,null).getPropertyValue(n));return r&&function(e){this.style.setProperty(n,r(e),o)}})},b.text=function(e){return Ls(this,"text",e,Ps)},b.remove=function(){var t=this.namespace;return this.each("end.transition",function(){var e;this[t].count<2&&(e=this.parentNode)&&e.removeChild(this)})},b.ease=function(t){var r=this.id,n=this.namespace;return arguments.length<1?this.node()[n][r].ease:("function"!=typeof t&&(t=z.ease.apply(z,arguments)),De(this,function(e){e[n][r].ease=t}))},b.delay=function(n){var i=this.id,o=this.namespace;return arguments.length<1?this.node()[o][i].delay:De(this,"function"==typeof n?function(e,t,r){e[o][i].delay=+n.call(e,e.__data__,t,r)}:(n=+n,function(e){e[o][i].delay=n}))},b.duration=function(n){var i=this.id,o=this.namespace;return arguments.length<1?this.node()[o][i].duration:De(this,"function"==typeof n?function(e,t,r){e[o][i].duration=Math.max(1,n.call(e,e.__data__,t,r))}:(n=Math.max(1,n),function(e){e[o][i].duration=n}))},b.each=function(n,t){var i=this.id,o=this.namespace;if(arguments.length<2){var e=As,r=Cs;try{Cs=i,De(this,function(e,t,r){As=e[o][i],n.call(e,e.__data__,t,r)})}finally{As=e,Cs=r}}else De(this,function(e){e=e[o][i];(e.event||(e.event=z.dispatch("start","end","interrupt"))).on(n,t)});return this},b.transition=function(){for(var e,t,r,n=this.id,i=++Is,o=this.namespace,a=[],s=0,l=this.length;s<l;s++){a.push(e=[]);for(var u,c=0,h=(u=this[s]).length;c<h;c++)(t=u[c])&&Ds(t,c,o,i,{time:(r=t[o][n]).time,ease:r.ease,delay:r.delay+r.duration,duration:r.duration}),e.push(t)}return ks(a,o,i)},z.svg.axis=function(){var b,w=z.scale.linear(),E=Os,T=6,S=6,M=3,k=[10],C=null;function r(e){e.each(function(){var e,t,r,n,i,o,a,s=z.select(this),l=this.__chart__||w,u=this.__chart__=w.copy(),c=null==C?u.ticks?u.ticks.apply(u,k):u.domain():C,h=null==b?u.tickFormat?u.tickFormat.apply(u,k):I:b,c=s.selectAll(".tick").data(c,u),f=c.enter().insert("g",".domain").attr("class","tick").style("opacity",P),d=z.transition(c.exit()).style("opacity",P).remove(),p=z.transition(c.order()).style("opacity",1),m=Math.max(T,0)+M,g=ka(u),s=s.selectAll(".domain").data([0]),s=(s.enter().append("path").attr("class","domain"),z.transition(s)),y=(f.append("line"),f.append("text"),f.select("line")),v=p.select("line"),c=c.select("text").text(h),h=f.select("text"),_=p.select("text"),x="top"===E||"left"===E?-1:1;"bottom"===E||"top"===E?(e=Fs,t="x",n="y",r="x2",i="y2",c.attr("dy",x<0?"0em":".71em").style("text-anchor","middle"),s.attr("d","M"+g[0]+","+x*S+"V0H"+g[1]+"V"+x*S)):(e=Bs,t="y",n="x",r="y2",i="x2",c.attr("dy",".32em").style("text-anchor",x<0?"end":"start"),s.attr("d","M"+x*S+","+g[0]+"H0V"+g[1]+"H"+x*S)),y.attr(i,x*T),h.attr(n,x*m),v.attr(r,0).attr(i,x*T),_.attr(t,0).attr(n,x*m),u.rangeBand?(a=(o=u).rangeBand()/2,l=u=function(e){return o(e)+a}):l.rangeBand?l=u:d.call(e,u,l),f.call(e,l,u),p.call(e,u,u)})}return r.scale=function(e){return arguments.length?(w=e,r):w},r.orient=function(e){return arguments.length?(E=e in Rs?e+"":Os,r):E},r.ticks=function(){return arguments.length?(k=f(arguments),r):k},r.tickValues=function(e){return arguments.length?(C=e,r):C},r.tickFormat=function(e){return arguments.length?(b=e,r):b},r.tickSize=function(e){var t=arguments.length;return t?(T=+e,S=+arguments[t-1],r):T},r.innerTickSize=function(e){return arguments.length?(T=+e,r):T},r.outerTickSize=function(e){return arguments.length?(S=+e,r):S},r.tickPadding=function(e){return arguments.length?(M=+e,r):M},r.tickSubdivide=function(){return arguments.length&&r},r};var Os="bottom",Rs={top:1,right:1,bottom:1,left:1};function Fs(e,r,n){e.attr("transform",function(e){var t=r(e);return"translate("+(isFinite(t)?t:n(e))+",0)"})}function Bs(e,r,n){e.attr("transform",function(e){var t=r(e);return"translate(0,"+(isFinite(t)?t:n(e))+")"})}z.svg.brush=function(){var y,v,_=he(M,"brushstart","brush","brushend"),x=null,b=null,w=[0,0],E=[0,0],T=!0,S=!0,i=js[0];function M(e){e.each(function(){var e,t=z.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",o).on("touchstart.brush",o),r=t.selectAll(".background").data([0]),n=(r.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),t.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move"),t.selectAll(".resize").data(i,I)),n=(n.exit().remove(),n.enter().append("g").attr("class",function(e){return"resize "+e}).style("cursor",function(e){return Ns[e]}).append("rect").attr("x",function(e){return/[ew]$/.test(e)?-3:null}).attr("y",function(e){return/^[ns]/.test(e)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),n.style("display",M.empty()?"none":null),z.transition(t)),t=z.transition(r);x&&(e=ka(x),t.attr("x",e[0]).attr("width",e[1]-e[0]),C(n)),b&&(e=ka(b),t.attr("y",e[0]).attr("height",e[1]-e[0]),A(n)),k(n)})}function k(e){e.selectAll(".resize").attr("transform",function(e){return"translate("+w[+/e$/.test(e)]+","+E[+/^s/.test(e)]+")"})}function C(e){e.select(".extent").attr("x",w[0]),e.selectAll(".extent,.n>rect,.s>rect").attr("width",w[1]-w[0])}function A(e){e.select(".extent").attr("y",E[0]),e.selectAll(".extent,.e>rect,.w>rect").attr("height",E[1]-E[0])}function o(){var l,e,r,n=this,t=z.select(z.event.target),i=_.of(n,arguments),o=z.select(n),a=t.datum(),s=!/^(n|s)$/.test(a)&&x,u=!/^(e|w)$/.test(a)&&b,c=t.classed("extent"),h=Ge(n),f=z.mouse(n),d=z.select(N(n)).on("keydown.brush",function(){32==z.event.keyCode&&(c||(l=null,f[0]-=w[1],f[1]-=E[1],c=2),ue())}).on("keyup.brush",function(){32==z.event.keyCode&&2==c&&(f[0]+=w[1],f[1]+=E[1],c=0,ue())});function p(){var e=z.mouse(n),t=!1;r&&(e[0]+=r[0],e[1]+=r[1]),c||(z.event.altKey?(l=l||[(w[0]+w[1])/2,(E[0]+E[1])/2],f[0]=w[+(e[0]<l[0])],f[1]=E[+(e[1]<l[1])]):l=null),s&&m(e,x,0)&&(C(o),t=!0),u&&m(e,b,1)&&(A(o),t=!0),t&&(k(o),i({type:"brush",mode:c?"move":"resize"}))}function m(e,t,r){var n,t=ka(t),i=t[0],t=t[1],o=f[r],a=r?E:w,s=a[1]-a[0];return c&&(i-=o,t-=s+o),e=(r?S:T)?Math.max(i,Math.min(t,e[r])):e[r],c?n=(e+=o)+s:(o=l?Math.max(i,Math.min(t,2*l[r]-e)):o)<e?(n=e,e=o):n=o,(a[0]!=e||a[1]!=n)&&(r?v=null:y=null,a[0]=e,a[1]=n,1)}function g(){p(),o.style("pointer-events","all").selectAll(".resize").style("display",M.empty()?"none":null),z.select("body").style("cursor",null),d.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),h(),i({type:"brushend"})}z.event.changedTouches?d.on("touchmove.brush",p).on("touchend.brush",g):d.on("mousemove.brush",p).on("mouseup.brush",g),o.interrupt().selectAll("*").interrupt(),c?(f[0]=w[0]-f[0],f[1]=E[0]-f[1]):a?(e=+/w$/.test(a),a=+/^n/.test(a),r=[w[1-e]-f[0],E[1-a]-f[1]],f[0]=w[e],f[1]=E[a]):z.event.altKey&&(l=f.slice()),o.style("pointer-events","none").selectAll(".resize").style("display",null),z.select("body").style("cursor",t.style("cursor")),i({type:"brushstart"}),p()}return M.event=function(e){e.each(function(){var n=_.of(this,arguments),i={x:w,y:E,i:y,j:v},e=this.__chart__||i;this.__chart__=i,Cs?z.select(this).transition().each("start.brush",function(){y=e.i,v=e.j,w=e.x,E=e.y,n({type:"brushstart"})}).tween("brush:brush",function(){var t=go(w,i.x),r=go(E,i.y);return y=v=null,function(e){w=i.x=t(e),E=i.y=r(e),n({type:"brush",mode:"resize"})}}).each("end.brush",function(){y=i.i,v=i.j,n({type:"brush",mode:"resize"}),n({type:"brushend"})}):(n({type:"brushstart"}),n({type:"brush",mode:"resize"}),n({type:"brushend"}))})},M.x=function(e){return arguments.length?(i=js[!(x=e)<<1|!b],M):x},M.y=function(e){return arguments.length?(i=js[!x<<1|!(b=e)],M):b},M.clamp=function(e){return arguments.length?(x&&b?(T=!!e[0],S=!!e[1]):x?T=!!e:b&&(S=!!e),M):x&&b?[T,S]:x?T:b?S:null},M.extent=function(e){var t,r,n,i,o;return arguments.length?(x&&(t=e[0],r=e[1],b&&(t=t[0],r=r[0]),y=[t,r],x.invert&&(t=x(t),r=x(r)),r<t&&(o=t,t=r,r=o),t==w[0]&&r==w[1]||(w=[t,r])),b&&(n=e[0],i=e[1],x&&(n=n[1],i=i[1]),v=[n,i],b.invert&&(n=b(n),i=b(i)),i<n&&(o=n,n=i,i=o),n==E[0]&&i==E[1]||(E=[n,i])),M):(x&&(y?(t=y[0],r=y[1]):(t=w[0],r=w[1],x.invert&&(t=x.invert(t),r=x.invert(r)),r<t&&(o=t,t=r,r=o))),b&&(v?(n=v[0],i=v[1]):(n=E[0],i=E[1],b.invert&&(n=b.invert(n),i=b.invert(i)),i<n&&(o=n,n=i,i=o))),x&&b?[[t,n],[r,i]]:x?[t,r]:b&&[n,i])},M.clear=function(){return M.empty()||(w=[0,0],E=[0,0],y=v=null),M},M.empty=function(){return!!x&&w[0]==w[1]||!!b&&E[0]==E[1]},z.rebind(M,_,"on")};var Ns={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},js=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],t=w.format=r.timeFormat,r=t.utc,Us=r("%Y-%m-%dT%H:%M:%S.%LZ");function Vs(e){return e.toISOString()}function Gs(t,i,e){function o(e){return t(e)}function a(e,t){var r=(e[1]-e[0])/t,n=z.bisect(Zs,r);return n==Zs.length?[i.year,Oa(e.map(function(e){return e/31536e6}),t)[2]]:n?i[r/Zs[n-1]<Zs[n]/r?n-1:n]:[$s,Oa(e,t)[2]]}return o.invert=function(e){return Ws(t.invert(e))},o.domain=function(e){return arguments.length?(t.domain(e),o):t.domain().map(Ws)},o.nice=function(t,r){var e=o.domain(),n=Ma(e),n=null==t?a(n,10):"number"==typeof t&&a(n,t);function i(e){return!isNaN(e)&&!t.range(e,Ws(+e+1),r).length}return n&&(t=n[0],r=n[1]),o.domain(Aa(e,1<r?{floor:function(e){for(;i(e=t.floor(e));)e=Ws(e-1);return e},ceil:function(e){for(;i(e=t.ceil(e));)e=Ws(+e+1);return e}}:t))},o.ticks=function(e,t){var r=Ma(o.domain()),n=null==e?a(r,10):"number"==typeof e?a(r,e):!e.range&&[{range:e},t];return n&&(e=n[0],t=n[1]),e.range(r[0],Ws(+r[1]+1),t<1?1:t)},o.tickFormat=function(){return e},o.copy=function(){return Gs(t.copy(),i,e)},za(o,t)}function Ws(e){return new Date(e)}t.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?Vs:Us,Vs.parse=function(e){e=new Date(e);return isNaN(e)?null:e},Vs.toString=Us.toString,w.second=Zt(function(e){return new E(1e3*Math.floor(e/1e3))},function(e,t){e.setTime(e.getTime()+1e3*Math.floor(t))},function(e){return e.getSeconds()}),w.seconds=w.second.range,w.seconds.utc=w.second.utc.range,w.minute=Zt(function(e){return new E(6e4*Math.floor(e/6e4))},function(e,t){e.setTime(e.getTime()+6e4*Math.floor(t))},function(e){return e.getMinutes()}),w.minutes=w.minute.range,w.minutes.utc=w.minute.utc.range,w.hour=Zt(function(e){var t=e.getTimezoneOffset()/60;return new E(36e5*(Math.floor(e/36e5-t)+t))},function(e,t){e.setTime(e.getTime()+36e5*Math.floor(t))},function(e){return e.getHours()}),w.hours=w.hour.range,w.hours.utc=w.hour.utc.range,w.month=Zt(function(e){return(e=w.day(e)).setDate(1),e},function(e,t){e.setMonth(e.getMonth()+t)},function(e){return e.getMonth()}),w.months=w.month.range,w.months.utc=w.month.utc.range;var Zs=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],qs=[[w.second,1],[w.second,5],[w.second,15],[w.second,30],[w.minute,1],[w.minute,5],[w.minute,15],[w.minute,30],[w.hour,1],[w.hour,3],[w.hour,6],[w.hour,12],[w.day,1],[w.day,2],[w.week,1],[w.month,1],[w.month,3],[w.year,1]],Hs=t.multi([[".%L",function(e){return e.getMilliseconds()}],[":%S",function(e){return e.getSeconds()}],["%I:%M",function(e){return e.getMinutes()}],["%I %p",function(e){return e.getHours()}],["%a %d",function(e){return e.getDay()&&1!=e.getDate()}],["%b %d",function(e){return 1!=e.getDate()}],["%B",function(e){return e.getMonth()}],["%Y",fn]]),$s={range:function(e,t,r){return z.range(Math.ceil(e/r)*r,+t,r).map(Ws)},floor:I,ceil:I},Xs=(qs.year=w.year,w.scale=function(){return Gs(z.scale.linear(),qs,Hs)},qs.map(function(e){return[e[0].utc,e[1]]})),Ys=r.multi([[".%L",function(e){return e.getUTCMilliseconds()}],[":%S",function(e){return e.getUTCSeconds()}],["%I:%M",function(e){return e.getUTCMinutes()}],["%I %p",function(e){return e.getUTCHours()}],["%a %d",function(e){return e.getUTCDay()&&1!=e.getUTCDate()}],["%b %d",function(e){return 1!=e.getUTCDate()}],["%B",function(e){return e.getUTCMonth()}],["%Y",fn]]);function Js(e){return JSON.parse(e.responseText)}function Ks(e){var t=D.createRange();return t.selectNode(D.body),t.createContextualFragment(e.responseText)}Xs.year=w.year.utc,w.scale.utc=function(){return Gs(z.scale.linear(),Xs,Ys)},z.text=kt(function(e){return e.responseText}),z.json=function(e,t){return Ct(e,"application/json",Js,t)},z.html=function(e,t){return Ct(e,"text/html",Ks,t)},z.xml=kt(function(e){return e.responseXML}),Qs.exports?Qs.exports=z:this.d3=z}(),e.exports);window.d3=e;{const jy=d3.selection.prototype,Uy=jy.on,Vy={mouseenter:["mouseover",R],mouseleave:["mouseout",R]};function R(t){return function(){var e=d3.event.relatedTarget;if(this!==e&&!function(e,t){if(e===t)return;for(;t&&t!==e;)t=t.parentNode;return t===e}(this,e))return t.apply(this,arguments)}}jy.on=function(e,t,r){var n=e.split("."),i=n.shift(),i=Vy[i];return i?(e=n.length?[i[0],n].join("."):i[0],"function"==typeof t&&(t=i[1](t)),Uy.call(this,e,t,r)):Uy.apply(this,arguments)}}d3.keybinding=function(t){const i=[];function r(){for(let e=0;e<i.length;e++){var t=i[e];!function(e,t){for(const r in e.event)if(t[r]!==e.event[r])return;return!e.capture==(t.eventPhase!==Event.CAPTURING_PHASE)}(t,d3.event)||t.callback()}}function n(){var e=d3.select(d3.event.target).node().tagName;"INPUT"!==e&&"SELECT"!==e&&"TEXTAREA"!==e&&r()}function o(e){return(e=e||d3.select(document)).on("keydown.capture"+t,r,!0),e.on("keydown.bubble"+t,n,!1),o}return o.off=function(e){return(e=e||d3.select(document)).on("keydown.capture"+t,null),e.on("keydown.bubble"+t,null),o},o.on=function(t,e,r){var n={event:{keyCode:0,shiftKey:!1,ctrlKey:!1,altKey:!1,metaKey:!1},capture:r,callback:e};t=t.toLowerCase().match(/(?:(?:[^+⇧⌃⌥⌘])+|[⇧⌃⌥⌘]|\+\+|^\+$)/g);for(let e=0;e<t.length;e++)"++"===t[e]&&(t[e]="+"),t[e]in d3.keybinding.modifierCodes?n.event[d3.keybinding.modifierProperties[d3.keybinding.modifierCodes[t[e]]]]=!0:t[e]in d3.keybinding.keyCodes&&(n.event.keyCode=d3.keybinding.keyCodes[t[e]]);return i.push(n),o},o};{d3.keybinding.modifierCodes={"⇧":16,shift:16,"⌃":17,ctrl:17,"⌥":18,alt:18,option:18,"⌘":91,meta:91,cmd:91,super:91,win:91},d3.keybinding.modifierProperties={16:"shiftKey",17:"ctrlKey",18:"altKey",91:"metaKey"},d3.keybinding.keyCodes={"⌫":8,backspace:8,"⇥":9,"⇆":9,tab:9,"↩":13,return:13,enter:13,"⌅":13,pause:19,"pause-break":19,"⇪":20,caps:20,"caps-lock":20,"⎋":27,escape:27,esc:27,space:32,"↖":33,pgup:33,"page-up":33,"↘":34,pgdown:34,"page-down":34,"⇟":35,end:35,"⇞":36,home:36,ins:45,insert:45,"⌦":46,del:46,delete:46,"←":37,left:37,"arrow-left":37,"↑":38,up:38,"arrow-up":38,"→":39,right:39,"arrow-right":39,"↓":40,down:40,"arrow-down":40,"*":106,star:106,asterisk:106,multiply:106,"+":107,plus:107,"-":109,subtract:109,";":186,semicolon:186,"=":187,equals:187,",":188,comma:188,dash:189,".":190,period:190,"full-stop":190,"/":191,slash:191,"forward-slash":191,"`":192,tick:192,"back-quote":192,"[":219,"open-bracket":219,"\\":220,"back-slash":220,"]":221,"close-bracket":221,"'":222,quote:222,apostrophe:222};let e=95,t=0;for(;++e<106;)d3.keybinding.keyCodes["num-"+t]=e,++t;for(e=47,t=0;++e<58;)d3.keybinding.keyCodes[t]=e,++t;for(e=111,t=1;++e<136;)d3.keybinding.keyCodes["f"+t]=e,++t;for(e=64;++e<91;)d3.keybinding.keyCodes[String.fromCharCode(e).toLowerCase()]=e}d3.selection.prototype.trigger=function(t){this.each(function(){var e=document.createEvent("HTMLEvents");e.initEvent(t,!0,!0),this.dispatchEvent(e)})};e={exports:{}};function F(){var c=d3.dispatch("change","rowfocus");return d3.rebind(function(e){e.each(function(e){var s,t,r=d3.select(this),l=d3.set();function u(){var r=l.values(),e=s.select("thead").select("tr").selectAll("th").data(r,function(e){return e}),t=e.enter().append("th"),n=(t.append("span").text(String),t.append("button")),t=t.append("button"),i=(e.exit().remove(),s.select("tbody").selectAll("tr").data(function(e){return e})),e=(i.enter().append("tr"),i.exit().remove(),i.selectAll("td").data(r,function(e){return e}));function o(e){var t,r;e.data[d3.select(this).attr("field")]=(t=this.value,(r=parseFloat(t)).toString()===t?r:t),c.change(e.data,e.index)}function a(e){return e.entries().reduce(function(e,t){return e[t.key]=t.value,e},{})}e.enter().append("td").append("input").attr("field",String),e.exit().remove(),n.on("click",function(e){var r=e;confirm("Delete column "+r+"?")&&(l.remove(r),i.selectAll("input").data(function(e,t){e=d3.map(e),e.remove(r),e=a(e);return c.change(e,t),{data:e,index:t}}),u())}),n.append("span").attr("class","icon-minus"),n.append("span").text(" delete"),t.append("span").text(" rename"),t.on("click",function(e){var r=e,n=prompt("New name for column "+r+"?");n&&(l.remove(r),l.add(n),i.selectAll("input").data(function(e,t){e=d3.map(e),e.set(n,e.get(r)),e.remove(r),e=a(e);return c.change(e,t),{data:e,index:t}}),u())}),i.selectAll("input").data(function(e,t){return d3.range(r.length).map(function(){return{data:e,index:t}})}).classed("disabled",function(e){return void 0===e.data[d3.select(this).attr("field")]}).property("value",function(e){e=e.data[d3.select(this).attr("field")];return isNaN(e)?e||"":e}).on("keyup",o).on("change",o).on("click",function(e){void 0===e.data[d3.select(this).attr("field")]&&(e.data[d3.select(this).attr("field")]="",u())}).on("focus",function(e){c.rowfocus(e.data,e.index)})}e.map(Object.keys).forEach(function(e){e.forEach(function(e){l.add(e)})}),(t=r.selectAll(".controls").data([e]).enter().append("div").attr("class","controls").append("button").on("click",function(){var e=prompt("column name");e&&(l.add(e),u())})).append("span").attr("class","icon-plus"),t.append("span").text(" new column"),t=r.selectAll("table").data([e]).enter().append("table"),e=t.append("thead"),t.append("tbody"),e.append("tr"),s=r.select("table"),u()})},c,"on")}e.exports=function(e){return F};var n,t={},r={},B={};function N(e,t,r){var n={type:"Feature"};return 0!==(r=void 0===r?{}:r).id&&!r.id||(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=t||{},n.geometry=e,n}function j(e,t,r){if(void 0===r&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(Y(e[0])&&Y(e[1]))return N({type:"Point",coordinates:e},t,r);throw new Error("coordinates must contain numbers")}function U(e,t,r){void 0===r&&(r={});for(var n=0,i=e;n<i.length;n++){var o=i[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<o[o.length-1].length;a++)if(o[o.length-1][a]!==o[0][a])throw new Error("First and last Position are not equivalent.")}return N({type:"Polygon",coordinates:e},t,r)}function V(e,t,r){if(void 0===r&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return N({type:"LineString",coordinates:e},t,r)}function G(e,t){var r={type:"FeatureCollection"};return(t=void 0===t?{}:t).id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=e,r}function W(e,t,r){return N({type:"MultiLineString",coordinates:e},t,r=void 0===r?{}:r)}function Z(e,t,r){return N({type:"MultiPoint",coordinates:e},t,r=void 0===r?{}:r)}function q(e,t,r){return N({type:"MultiPolygon",coordinates:e},t,r=void 0===r?{}:r)}function H(e,t){var r=n.factors[t=void 0===t?"kilometers":t];if(r)return e*r;throw new Error(t+" units is invalid")}function $(e,t){var r=n.factors[t=void 0===t?"kilometers":t];if(r)return e/r;throw new Error(t+" units is invalid")}function X(e){return 180*(e%(2*Math.PI))/Math.PI}function Y(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}n=B,Object.defineProperty(n,"__esModule",{value:!0}),n.earthRadius=6371008.8,n.factors={centimeters:100*n.earthRadius,centimetres:100*n.earthRadius,degrees:n.earthRadius/111325,feet:3.28084*n.earthRadius,inches:39.37*n.earthRadius,kilometers:n.earthRadius/1e3,kilometres:n.earthRadius/1e3,meters:n.earthRadius,metres:n.earthRadius,miles:n.earthRadius/1609.344,millimeters:1e3*n.earthRadius,millimetres:1e3*n.earthRadius,nauticalmiles:n.earthRadius/1852,radians:1,yards:1.0936*n.earthRadius},n.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/n.earthRadius,yards:1.0936133},n.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},n.feature=N,n.geometry=function(e,t,r){switch(e){case"Point":return j(t).geometry;case"LineString":return V(t).geometry;case"Polygon":return U(t).geometry;case"MultiPoint":return Z(t).geometry;case"MultiLineString":return W(t).geometry;case"MultiPolygon":return q(t).geometry;default:throw new Error(e+" is invalid")}},n.point=j,n.points=function(e,t,r){return void 0===r&&(r={}),G(e.map(function(e){return j(e,t)}),r)},n.polygon=U,n.polygons=function(e,t,r){return void 0===r&&(r={}),G(e.map(function(e){return U(e,t)}),r)},n.lineString=V,n.lineStrings=function(e,t,r){return void 0===r&&(r={}),G(e.map(function(e){return V(e,t)}),r)},n.featureCollection=G,n.multiLineString=W,n.multiPoint=Z,n.multiPolygon=q,n.geometryCollection=function(e,t,r){return N({type:"GeometryCollection",geometries:e},t,r=void 0===r?{}:r)},n.round=function(e,t){if(!(t=void 0===t?0:t)||0<=t)return t=Math.pow(10,t||0),Math.round(e*t)/t;throw new Error("precision must be a positive number")},n.radiansToLength=H,n.lengthToRadians=$,n.lengthToDegrees=function(e,t){return X($(e,t))},n.bearingToAzimuth=function(e){return(e%=360)<0&&(e+=360),e},n.radiansToDegrees=X,n.degreesToRadians=function(e){return e%360*Math.PI/180},n.convertLength=function(e,t,r){if(void 0===t&&(t="kilometers"),void 0===r&&(r="kilometers"),0<=e)return H($(e,t),r);throw new Error("length must be a positive number")},n.convertArea=function(e,t,r){if(void 0===t&&(t="meters"),void 0===r&&(r="kilometers"),!(0<=e))throw new Error("area must be a positive number");if(!(t=n.areaFactors[t]))throw new Error("invalid original units");if(r=n.areaFactors[r])return e/t*r;throw new Error("invalid final units")},n.isNumber=Y,n.isObject=function(e){return!!e&&e.constructor===Object},n.validateBBox=function(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(4!==e.length&&6!==e.length)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(e){if(!Y(e))throw new Error("bbox must only contain numbers")})},n.validateId=function(e){if(!e)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof e))throw new Error("id must be a number or a string")},Object.defineProperty(r,"__esModule",{value:!0});var J=B;function K(e,t,r){if(null!==e)for(var n,i,o,a=0,s=e.type,l="FeatureCollection"===s,u="Feature"===s,c=l?e.features.length:1,h=0;h<c;h++)for(var f,d,p=(d=!!(f=l?e.features[h].geometry:u?e.geometry:e)&&"GeometryCollection"===f.type)?f.geometries.length:1,m=0;m<p;m++){var g=0,y=0,v=d?f.geometries[m]:f;if(null!==v){var _=v.coordinates,x=v.type,b=!r||"Polygon"!==x&&"MultiPolygon"!==x?0:1;switch(x){case null:break;case"Point":if(!1===t(_,a,h,g,y))return!1;a++,g++;break;case"LineString":case"MultiPoint":for(n=0;n<_.length;n++){if(!1===t(_[n],a,h,g,y))return!1;a++,"MultiPoint"===x&&g++}"LineString"===x&&g++;break;case"Polygon":case"MultiLineString":for(n=0;n<_.length;n++){for(i=0;i<_[n].length-b;i++){if(!1===t(_[n][i],a,h,g,y))return!1;a++}"MultiLineString"===x&&g++,"Polygon"===x&&y++}"Polygon"===x&&g++;break;case"MultiPolygon":for(n=0;n<_.length;n++){for(i=y=0;i<_[n].length;i++){for(o=0;o<_[n][i].length-b;o++){if(!1===t(_[n][i][o],a,h,g,y))return!1;a++}y++}g++}break;case"GeometryCollection":for(n=0;n<v.geometries.length;n++)if(!1===K(v.geometries[n],t,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}function Q(e,t){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&!1!==t(e.features[r].properties,r);r++);break;case"Feature":t(e.properties,0)}}function ee(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var r=0;r<e.features.length&&!1!==t(e.features[r],r);r++);}function te(e,t){for(var r,n,i,o,a,s,l,u,c,h=0,f="FeatureCollection"===e.type,d="Feature"===e.type,p=f?e.features.length:1,m=0;m<p;m++){for(a=f?e.features[m].geometry:d?e.geometry:e,l=f?e.features[m].properties:d?e.properties:{},u=f?e.features[m].bbox:d?e.bbox:void 0,c=f?e.features[m].id:d?e.id:void 0,o=(s=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,n=0;n<o;n++)if(null===(i=s?a.geometries[n]:a)){if(!1===t(null,h,l,u,c))return!1}else switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(i,h,l,u,c))return!1;break;case"GeometryCollection":for(r=0;r<i.geometries.length;r++)if(!1===t(i.geometries[r],h,l,u,c))return!1;break;default:throw new Error("Unknown Geometry Type")}h++}}function re(e,u){te(e,function(e,t,r,n,i){var o,a=null===e?null:e.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return!1===u(J.feature(e,r,{bbox:n,id:i}),t,0)?!1:void 0}switch(a){case"MultiPoint":o="Point";break;case"MultiLineString":o="LineString";break;case"MultiPolygon":o="Polygon"}for(var s=0;s<e.coordinates.length;s++){var l=e.coordinates[s];if(!1===u(J.feature({type:o,coordinates:l},r),t,s))return!1}})}function ne(e,d){re(e,function(o,a,s){var l=0;if(o.geometry){var u,c,h,f,e=o.geometry.type;if("Point"!==e&&"MultiPoint"!==e)return f=h=c=0,!1!==K(o,function(e,t,r,n,i){if(void 0===u||c<a||h<n||f<i)u=e,c=a,h=n,f=i,l=0;else{n=J.lineString([u,e],o.properties);if(!1===d(n,a,s,i,l))return!1;l++,u=e}})&&void 0}})}function ie(e,a){if(!e)throw new Error("geojson is required");re(e,function(e,t,r){if(null!==e.geometry){var n=e.geometry.type,i=e.geometry.coordinates;switch(n){case"LineString":if(!1===a(e,t,r,0,0))return!1;break;case"Polygon":for(var o=0;o<i.length;o++)if(!1===a(J.lineString(i[o],e.properties),t,r,o))return!1}}})}r.coordAll=function(e){var t=[];return K(e,function(e){t.push(e)}),t},r.coordEach=K,r.coordReduce=function(e,o,a,t){var s=a;return K(e,function(e,t,r,n,i){s=0===t&&void 0===a?e:o(s,e,t,r,n,i)},t),s},r.featureEach=ee,r.featureReduce=function(e,r,n){var i=n;return ee(e,function(e,t){i=0===t&&void 0===n?e:r(i,e,t)}),i},r.findPoint=function(e,t){if(!J.isObject(t=t||{}))throw new Error("options is invalid");var r,n=t.featureIndex||0,i=t.multiFeatureIndex||0,o=t.geometryIndex||0,a=t.coordIndex||0,s=t.properties;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),s=s||e.features[n].properties,r=e.features[n].geometry;break;case"Feature":s=s||e.properties,r=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=e;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var l=r.coordinates;switch(r.type){case"Point":return J.point(l,s,t);case"MultiPoint":return i<0&&(i=l.length+i),J.point(l[i],s,t);case"LineString":return a<0&&(a=l.length+a),J.point(l[a],s,t);case"Polygon":return o<0&&(o=l.length+o),a<0&&(a=l[o].length+a),J.point(l[o][a],s,t);case"MultiLineString":return i<0&&(i=l.length+i),a<0&&(a=l[i].length+a),J.point(l[i][a],s,t);case"MultiPolygon":return i<0&&(i=l.length+i),o<0&&(o=l[i].length+o),a<0&&(a=l[i][o].length-a),J.point(l[i][o][a],s,t)}throw new Error("geojson is invalid")},r.findSegment=function(e,t){if(!J.isObject(t=t||{}))throw new Error("options is invalid");var r,n=t.featureIndex||0,i=t.multiFeatureIndex||0,o=t.geometryIndex||0,a=t.segmentIndex||0,s=t.properties;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),s=s||e.features[n].properties,r=e.features[n].geometry;break;case"Feature":s=s||e.properties,r=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=e;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var l=r.coordinates;switch(r.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=l.length+a-1),J.lineString([l[a],l[a+1]],s,t);case"Polygon":return o<0&&(o=l.length+o),a<0&&(a=l[o].length+a-1),J.lineString([l[o][a],l[o][a+1]],s,t);case"MultiLineString":return i<0&&(i=l.length+i),a<0&&(a=l[i].length+a-1),J.lineString([l[i][a],l[i][a+1]],s,t);case"MultiPolygon":return i<0&&(i=l.length+i),o<0&&(o=l[i].length+o),a<0&&(a=l[i][o].length-a-1),J.lineString([l[i][o][a],l[i][o][a+1]],s,t)}throw new Error("geojson is invalid")},r.flattenEach=re,r.flattenReduce=function(e,n,i){var o=i;return re(e,function(e,t,r){o=0===t&&0===r&&void 0===i?e:n(o,e,t,r)}),o},r.geomEach=te,r.geomReduce=function(e,o,a){var s=a;return te(e,function(e,t,r,n,i){s=0===t&&void 0===a?e:o(s,e,t,r,n,i)}),s},r.lineEach=ie,r.lineReduce=function(e,i,o){var a=o;return ie(e,function(e,t,r,n){a=0===t&&void 0===o?e:i(a,e,t,r,n)}),a},r.propEach=Q,r.propReduce=function(e,r,n){var i=n;return Q(e,function(e,t){i=0===t&&void 0===n?e:r(i,e,t)}),i},r.segmentEach=ne,r.segmentReduce=function(e,o,a){var s=a,l=!1;return ne(e,function(e,t,r,n,i){s=!1===l&&void 0===a?e:o(s,e,t,r,n,i),l=!0}),s},Object.defineProperty(t,"__esModule",{value:!0});var oe=r;function ae(e){var t=[1/0,1/0,-1/0,-1/0];return oe.coordEach(e,function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])}),t}t.default=ae.default=ae;const se=t.default;const le=e.exports(d3),ue=function(e,t){"Point"===t.geometry.type?e.flyTo({center:t.geometry.coordinates}):(t=se(t),e.fitBounds(t,{padding:60}))};var ce,he,e={exports:{}},fe=(he=(ce=e).exports,function(){var Uo,Vo="Expected a function",va="__lodash_hash_undefined__",_a="__lodash_placeholder__",Go=9007199254740991,xa=NaN,Wo=4294967295,ba=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],Zo="[object Arguments]",wa="[object Array]",qo="[object Boolean]",Ho="[object Date]",Ea="[object Error]",Ta="[object Function]",Sa="[object GeneratorFunction]",$o="[object Map]",Xo="[object Number]",Yo="[object Object]",Ma="[object Promise]",Jo="[object RegExp]",Ko="[object Set]",Qo="[object String]",ka="[object Symbol]",ea="[object WeakMap]",ta="[object ArrayBuffer]",ra="[object DataView]",Ca="[object Float32Array]",Aa="[object Float64Array]",Ia="[object Int8Array]",La="[object Int16Array]",Pa="[object Int32Array]",za="[object Uint8Array]",Da="[object Uint8ClampedArray]",Oa="[object Uint16Array]",Ra="[object Uint32Array]",Fa=/\b__p \+= '';/g,Ba=/\b(__p \+=) '' \+/g,Na=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ja=/&(?:amp|lt|gt|quot|#39);/g,Ua=/[&<>"']/g,Va=RegExp(ja.source),Ga=RegExp(Ua.source),Wa=/<%-([\s\S]+?)%>/g,Za=/<%([\s\S]+?)%>/g,qa=/<%=([\s\S]+?)%>/g,Ha=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,$a=/^\w*$/,Xa=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ya=/[\\^$.*+?()[\]{}|]/g,Ja=RegExp(Ya.source),Ka=/^\s+/,o=/\s/,Qa=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,es=/\{\n\/\* \[wrapped with (.+)\] \*/,ts=/,? & /,rs=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ns=/[()=,{}\[\]\/\s]/,is=/\\(\\)?/g,os=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,as=/\w*$/,ss=/^[-+]0x[0-9a-f]+$/i,ls=/^0b[01]+$/i,us=/^\[object .+?Constructor\]$/,cs=/^0o[0-7]+$/i,hs=/^(?:0|[1-9]\d*)$/,fs=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ds=/($^)/,ps=/['\n\r\u2028\u2029\\]/g,a="\\ud800-\\udfff",s="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",l="\\u2700-\\u27bf",e="a-z\\xdf-\\xf6\\xf8-\\xff",t="A-Z\\xc0-\\xd6\\xd8-\\xde",u="\\ufe0e\\ufe0f",c="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",r="["+a+"]",h="["+c+"]",f="["+s+"]",d="["+l+"]",p="["+e+"]",c="[^"+a+c+"\\d+"+l+e+t+"]",l="\\ud83c[\\udffb-\\udfff]",e="[^"+a+"]",m="(?:\\ud83c[\\udde6-\\uddff]){2}",n="[\\ud800-\\udbff][\\udc00-\\udfff]",t="["+t+"]",g="(?:"+p+"|"+c+")",c="(?:"+t+"|"+c+")",y="(?:['’](?:d|ll|m|re|s|t|ve))?",v="(?:['’](?:D|LL|M|RE|S|T|VE))?",_="(?:"+f+"|"+l+")"+"?",x="["+u+"]?",x=x+_+("(?:\\u200d(?:"+[e,m,n].join("|")+")"+x+_+")*"),_="(?:"+[d,m,n].join("|")+")"+x,d="(?:"+[e+f+"?",f,m,n,r].join("|")+")",ms=RegExp("['’]","g"),gs=RegExp(f,"g"),b=RegExp(l+"(?="+l+")|"+d+x,"g"),ys=RegExp([t+"?"+p+"+"+y+"(?="+[h,t,"$"].join("|")+")",c+"+"+v+"(?="+[h,t+g,"$"].join("|")+")",t+"?"+g+"+"+y,t+"+"+v,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])","\\d+",_].join("|"),"g"),w=RegExp("[\\u200d"+a+s+u+"]"),vs=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,_s=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],xs=-1,na={},ia=(na[Ca]=na[Aa]=na[Ia]=na[La]=na[Pa]=na[za]=na[Da]=na[Oa]=na[Ra]=!0,na[Zo]=na[wa]=na[ta]=na[qo]=na[ra]=na[Ho]=na[Ea]=na[Ta]=na[$o]=na[Xo]=na[Yo]=na[Jo]=na[Ko]=na[Qo]=na[ea]=!1,{}),E=(ia[Zo]=ia[wa]=ia[ta]=ia[ra]=ia[qo]=ia[Ho]=ia[Ca]=ia[Aa]=ia[Ia]=ia[La]=ia[Pa]=ia[$o]=ia[Xo]=ia[Yo]=ia[Jo]=ia[Ko]=ia[Qo]=ia[ka]=ia[za]=ia[Da]=ia[Oa]=ia[Ra]=!0,ia[Ea]=ia[Ta]=ia[ea]=!1,{"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"}),bs=parseFloat,ws=parseInt,e="object"==typeof Ht&&Ht&&Ht.Object===Object&&Ht,m="object"==typeof self&&self&&self.Object===Object&&self,oa=e||m||Function("return this")(),n=he&&!he.nodeType&&he,i=n&&!ce.nodeType&&ce,Es=i&&i.exports===n,T=Es&&e.process,r=function(){try{var e=i&&i.require&&i.require("util").types;return e?e:T&&T.binding&&T.binding("util")}catch(e){}}(),Ts=r&&r.isArrayBuffer,Ss=r&&r.isDate,Ms=r&&r.isMap,ks=r&&r.isRegExp,Cs=r&&r.isSet,As=r&&r.isTypedArray;function aa(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function Is(e,t,r,n){for(var i=-1,o=null==e?0:e.length;++i<o;){var a=e[i];t(n,a,r(a),e)}return n}function sa(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}function Ls(e,t){for(var r=null==e?0:e.length;r--&&!1!==t(e[r],r,e););return e}function Ps(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}function la(e,t){for(var r=-1,n=null==e?0:e.length,i=0,o=[];++r<n;){var a=e[r];t(a,r,e)&&(o[i++]=a)}return o}function zs(e,t){return!!(null==e?0:e.length)&&-1<ha(e,t,0)}function Ds(e,t,r){for(var n=-1,i=null==e?0:e.length;++n<i;)if(r(t,e[n]))return!0;return!1}function ua(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}function ca(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}function Os(e,t,r,n){var i=-1,o=null==e?0:e.length;for(n&&o&&(r=e[++i]);++i<o;)r=t(r,e[i],i,e);return r}function Rs(e,t,r,n){var i=null==e?0:e.length;for(n&&i&&(r=e[--i]);i--;)r=t(r,e[i],i,e);return r}function Fs(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var S=Gs("length");function Bs(e,n,t){var i;return t(e,function(e,t,r){if(n(e,t,r))return i=t,!1}),i}function Ns(e,t,r,n){for(var i=e.length,o=r+(n?1:-1);n?o--:++o<i;)if(t(e[o],o,e))return o;return-1}function ha(e,t,r){if(t!=t)return Ns(e,Us,r);for(var n=e,i=t,o=r-1,a=n.length;++o<a;)if(n[o]===i)return o;return-1}function js(e,t,r,n){for(var i=r-1,o=e.length;++i<o;)if(n(e[i],t))return i;return-1}function Us(e){return e!=e}function Vs(e,t){var r=null==e?0:e.length;return r?Zs(e,t)/r:xa}function Gs(t){return function(e){return null==e?Uo:e[t]}}function M(t){return function(e){return null==t?Uo:t[e]}}function Ws(e,n,i,o,t){return t(e,function(e,t,r){i=o?(o=!1,e):n(i,e,t,r)}),i}function Zs(e,t){for(var r,n=-1,i=e.length;++n<i;){var o=t(e[n]);o!==Uo&&(r=r===Uo?o:r+o)}return r}function qs(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function Hs(e){return e&&e.slice(0,il(e)+1).replace(Ka,"")}function fa(t){return function(e){return t(e)}}function $s(t,e){return ua(e,function(e){return t[e]})}function Xs(e,t){return e.has(t)}function Ys(e,t){for(var r=-1,n=e.length;++r<n&&-1<ha(t,e[r],0););return r}function Js(e,t){for(var r=e.length;r--&&-1<ha(t,e[r],0););return r}var Ks=M({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),Qs=M({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function el(e){return"\\"+E[e]}function da(e){return w.test(e)}function tl(e){var r=-1,n=Array(e.size);return e.forEach(function(e,t){n[++r]=[t,e]}),n}function rl(t,r){return function(e){return t(r(e))}}function pa(e,t){for(var r=-1,n=e.length,i=0,o=[];++r<n;){var a=e[r];a!==t&&a!==_a||(e[r]=_a,o[i++]=r)}return o}function nl(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}function ma(e){return(da(e)?function(e){var t=b.lastIndex=0;for(;b.test(e);)++t;return t}:S)(e)}function ga(e){return da(e)?e.match(b)||[]:e.split("")}function il(e){for(var t=e.length;t--&&o.test(e.charAt(t)););return t}var ol=M({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var ya=function i(e){var w=(e=null==e?oa:ya.defaults(oa.Object(),e,ya.pick(oa,_s))).Array,o=e.Date,P=e.Error,z=e.Function,D=e.Math,m=e.Object,O=e.RegExp,V=e.String,E=e.TypeError,G=w.prototype,W=z.prototype,Z=m.prototype,q=e["__core-js_shared__"],H=W.toString,R=Z.hasOwnProperty,$=0,X=(W=/[^.]+$/.exec(q&&q.keys&&q.keys.IE_PROTO||""))?"Symbol(src)_1."+W:"",Y=Z.toString,J=H.call(m),K=oa._,Q=O("^"+H.call(R).replace(Ya,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),W=Es?e.Buffer:Uo,t=e.Symbol,ee=e.Uint8Array,te=W?W.allocUnsafe:Uo,re=rl(m.getPrototypeOf,m),ne=m.create,ie=Z.propertyIsEnumerable,oe=G.splice,ae=t?t.isConcatSpreadable:Uo,se=t?t.iterator:Uo,le=t?t.toStringTag:Uo,ue=function(){try{var e=Jr(m,"defineProperty");return e({},"",{}),e}catch(e){}}(),ce=e.clearTimeout!==oa.clearTimeout&&e.clearTimeout,he=o&&o.now!==oa.Date.now&&o.now,fe=e.setTimeout!==oa.setTimeout&&e.setTimeout,de=D.ceil,pe=D.floor,me=m.getOwnPropertySymbols,W=W?W.isBuffer:Uo,ge=e.isFinite,ye=G.join,ve=rl(m.keys,m),T=D.max,S=D.min,_e=o.now,xe=e.parseInt,be=D.random,we=G.reverse,o=Jr(e,"DataView"),Ee=Jr(e,"Map"),Te=Jr(e,"Promise"),Se=Jr(e,"Set"),e=Jr(e,"WeakMap"),Me=Jr(m,"create"),ke=e&&new e,Ce={},Ae=En(o),Ie=En(Ee),Le=En(Te),Pe=En(Se),ze=En(e),t=t?t.prototype:Uo,De=t?t.valueOf:Uo,Oe=t?t.toString:Uo;function p(e){if(U(e)&&!(j(e)||e instanceof y)){if(e instanceof g)return e;if(R.call(e,"__wrapped__"))return Tn(e)}return new g(e)}var Re=function(e){if(!b(e))return{};if(ne)return ne(e);Fe.prototype=e;e=new Fe;return Fe.prototype=Uo,e};function Fe(){}function Be(){}function g(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=Uo}function y(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Wo,this.__views__=[]}function Ne(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function je(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Ue(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Ve(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new Ue;++t<r;)this.add(e[t])}function F(e){e=this.__data__=new je(e);this.size=e.size}function Ge(e,t){var r,n=j(e),i=!n&&yi(e),o=!n&&!i&&_i(e),a=!n&&!i&&!o&&Ii(e),s=n||i||o||a,l=s?qs(e.length,V):[],u=l.length;for(r in e)!t&&!R.call(e,r)||s&&("length"==r||o&&("offset"==r||"parent"==r)||a&&("buffer"==r||"byteLength"==r||"byteOffset"==r)||nn(r,u))||l.push(r);return l}function We(e){var t=e.length;return t?e[Bt(0,t-1)]:Uo}function Ze(e,t){return _n(M(e),et(t,0,e.length))}function qe(e){return _n(M(e))}function He(e,t,r){(r===Uo||N(e[t],r))&&(r!==Uo||t in e)||Ke(e,t,r)}function $e(e,t,r){var n=e[t];R.call(e,t)&&N(n,r)&&(r!==Uo||t in e)||Ke(e,t,r)}function Xe(e,t){for(var r=e.length;r--;)if(N(e[r][0],t))return r;return-1}function Ye(e,n,i,o){return it(e,function(e,t,r){n(o,e,i(e),r)}),o}function Je(e,t){return e&&mr(t,A(t),e)}function Ke(e,t,r){"__proto__"==t&&ue?ue(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function Qe(e,t){for(var r=-1,n=t.length,i=w(n),o=null==e;++r<n;)i[r]=o?Uo:Wi(e,t[r]);return i}function et(e,t,r){return e==e&&(r!==Uo&&(e=e<=r?e:r),t!==Uo&&(e=t<=e?e:t)),e}function v(r,n,i,e,t,o){var a,s=1&n,l=2&n,u=4&n;if((a=i?t?i(r,e,t,o):i(r):a)===Uo){if(!b(r))return r;var c,e=j(r);if(e){if(a=function(e){var t=e.length,r=new e.constructor(t);t&&"string"==typeof e[0]&&R.call(e,"index")&&(r.index=e.index,r.input=e.input);return r}(r),!s)return M(r,a)}else{var h=B(r),f=h==Ta||h==Sa;if(_i(r))return ur(r,s);if(h==Yo||h==Zo||f&&!t){if(a=l||f?{}:tn(r),!s)return l?(d=f=r,d=(c=a)&&mr(d,I(d),c),mr(f,Qr(f),d)):(f=Je(a,c=r),mr(c,Kr(c),f))}else{if(!ia[h])return t?r:{};a=function(e,t,r){var n=e.constructor;switch(t){case ta:return cr(e);case qo:case Ho:return new n(+e);case ra:return function(e,t){t=t?cr(e.buffer):e.buffer;return new e.constructor(t,e.byteOffset,e.byteLength)}(e,r);case Ca:case Aa:case Ia:case La:case Pa:case za:case Da:case Oa:case Ra:return hr(e,r);case $o:return new n;case Xo:case Qo:return new n(e);case Jo:return function(e){var t=new e.constructor(e.source,as.exec(e));return t.lastIndex=e.lastIndex,t}(e);case Ko:return new n;case ka:return function(e){return De?m(De.call(e)):{}}(e)}}(r,h,s)}}var d=(o=o||new F).get(r);if(d)return d;o.set(r,a),Ci(r)?r.forEach(function(e){a.add(v(e,n,i,e,r,o))}):Ti(r)&&r.forEach(function(e,t){a.set(t,v(e,n,i,t,r,o))});var p=e?Uo:(u?l?Zr:Wr:l?I:A)(r);sa(p||r,function(e,t){p&&(e=r[t=e]),$e(a,t,v(e,n,i,t,r,o))})}return a}function tt(e,t,r){var n=r.length;if(null==e)return!n;for(e=m(e);n--;){var i=r[n],o=t[i],a=e[i];if(a===Uo&&!(i in e)||!o(a))return!1}return!0}function rt(e,t,r){if("function"!=typeof e)throw new E(Vo);return mn(function(){e.apply(Uo,r)},t)}function nt(e,t,r,n){var i=-1,o=zs,a=!0,s=e.length,l=[],u=t.length;if(s){r&&(t=ua(t,fa(r))),n?(o=Ds,a=!1):200<=t.length&&(o=Xs,a=!1,t=new Ve(t));e:for(;++i<s;){var c=e[i],h=null==r?c:r(c),c=n||0!==c?c:0;if(a&&h==h){for(var f=u;f--;)if(t[f]===h)continue e;l.push(c)}else o(t,h,n)||l.push(c)}}return l}p.templateSettings={escape:Wa,evaluate:Za,interpolate:qa,variable:"",imports:{_:p}},(p.prototype=Be.prototype).constructor=p,(g.prototype=Re(Be.prototype)).constructor=g,(y.prototype=Re(Be.prototype)).constructor=y,Ne.prototype.clear=function(){this.__data__=Me?Me(null):{},this.size=0},Ne.prototype.delete=function(e){return e=this.has(e)&&delete this.__data__[e],this.size-=e?1:0,e},Ne.prototype.get=function(e){var t,r=this.__data__;return Me?(t=r[e])===va?Uo:t:R.call(r,e)?r[e]:Uo},Ne.prototype.has=function(e){var t=this.__data__;return Me?t[e]!==Uo:R.call(t,e)},Ne.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Me&&t===Uo?va:t,this},je.prototype.clear=function(){this.__data__=[],this.size=0},je.prototype.delete=function(e){var t=this.__data__;return!((e=Xe(t,e))<0)&&(e==t.length-1?t.pop():oe.call(t,e,1),--this.size,!0)},je.prototype.get=function(e){var t=this.__data__;return(e=Xe(t,e))<0?Uo:t[e][1]},je.prototype.has=function(e){return-1<Xe(this.__data__,e)},je.prototype.set=function(e,t){var r=this.__data__,n=Xe(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this},Ue.prototype.clear=function(){this.size=0,this.__data__={hash:new Ne,map:new(Ee||je),string:new Ne}},Ue.prototype.delete=function(e){return e=Xr(this,e).delete(e),this.size-=e?1:0,e},Ue.prototype.get=function(e){return Xr(this,e).get(e)},Ue.prototype.has=function(e){return Xr(this,e).has(e)},Ue.prototype.set=function(e,t){var r=Xr(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this},Ve.prototype.add=Ve.prototype.push=function(e){return this.__data__.set(e,va),this},Ve.prototype.has=function(e){return this.__data__.has(e)},F.prototype.clear=function(){this.__data__=new je,this.size=0},F.prototype.delete=function(e){var t=this.__data__,e=t.delete(e);return this.size=t.size,e},F.prototype.get=function(e){return this.__data__.get(e)},F.prototype.has=function(e){return this.__data__.has(e)},F.prototype.set=function(e,t){var r=this.__data__;if(r instanceof je){var n=r.__data__;if(!Ee||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Ue(n)}return r.set(e,t),this.size=r.size,this};var it=vr(ht),ot=vr(ft,!0);function at(e,n){var i=!0;return it(e,function(e,t,r){return i=!!n(e,t,r)}),i}function st(e,t,r){for(var n=-1,i=e.length;++n<i;){var o,a,s=e[n],l=t(s);null!=l&&(o===Uo?l==l&&!_(l):r(l,o))&&(o=l,a=s)}return a}function lt(e,n){var i=[];return it(e,function(e,t,r){n(e,t,r)&&i.push(e)}),i}function l(e,t,r,n,i){var o=-1,a=e.length;for(r=r||rn,i=i||[];++o<a;){var s=e[o];0<t&&r(s)?1<t?l(s,t-1,r,n,i):ca(i,s):n||(i[i.length]=s)}return i}var ut=_r(),ct=_r(!0);function ht(e,t){return e&&ut(e,t,A)}function ft(e,t){return e&&ct(e,t,A)}function dt(t,e){return la(e,function(e){return bi(t[e])})}function pt(e,t){for(var r=0,n=(t=or(t,e)).length;null!=e&&r<n;)e=e[wn(t[r++])];return r&&r==n?e:Uo}function mt(e,t,r){t=t(e);return j(e)?t:ca(t,r(e))}function r(e){if(null==e)return e===Uo?"[object Undefined]":"[object Null]";if(le&&le in m(e)){var t=e,r=R.call(t,le),n=t[le];try{t[le]=Uo;var i=!0}catch(e){}var o=Y.call(t);return i&&(r?t[le]=n:delete t[le]),o}return Y.call(e)}function gt(e,t){return t<e}function yt(e,t){return null!=e&&R.call(e,t)}function vt(e,t){return null!=e&&t in m(e)}function _t(e,t,r){for(var n=r?Ds:zs,i=e[0].length,o=e.length,a=o,s=w(o),l=1/0,u=[];a--;){var c=e[a];a&&t&&(c=ua(c,fa(t))),l=S(c.length,l),s[a]=!r&&(t||120<=i&&120<=c.length)?new Ve(a&&c):Uo}var c=e[0],h=-1,f=s[0];e:for(;++h<i&&u.length<l;){var d=c[h],p=t?t(d):d,d=r||0!==d?d:0;if(!(f?Xs(f,p):n(u,p,r))){for(a=o;--a;){var m=s[a];if(!(m?Xs(m,p):n(e[a],p,r)))continue e}f&&f.push(p),u.push(d)}}return u}function xt(e,t,r){t=null==(e=fn(e,t=or(t,e)))?e:e[wn(n(t))];return null==t?Uo:aa(t,e,r)}function bt(e){return U(e)&&r(e)==Zo}function wt(e,t,r,n,i){if(e===t)return!0;if(null==e||null==t||!U(e)&&!U(t))return e!=e&&t!=t;var o=wt,a=j(e),s=j(t),l=a?wa:B(e),s=s?wa:B(t),u=(l=l==Zo?Yo:l)==Yo,c=(s=s==Zo?Yo:s)==Yo;if((s=l==s)&&_i(e)){if(!_i(t))return!1;u=!(a=!0)}if(s&&!u){i=i||new F;if(a||Ii(e))return Vr(e,t,r,n,o,i);else{var h=e;var f=t;var d=l;var p=r;var m=n;var g=o;var y=i;switch(d){case ra:if(h.byteLength!=f.byteLength||h.byteOffset!=f.byteOffset)return!1;h=h.buffer,f=f.buffer;case ta:return h.byteLength==f.byteLength&&g(new ee(h),new ee(f))?!0:!1;case qo:case Ho:case Xo:return N(+h,+f);case Ea:return h.name==f.name&&h.message==f.message;case Jo:case Qo:return h==f+"";case $o:var v=tl;case Ko:var _=1&p;if(v=v||nl,h.size!=f.size&&!_)return!1;_=y.get(h);if(_)return _==f;p|=2,y.set(h,f);_=Vr(v(h),v(f),p,m,g,y);return y.delete(h),_;case ka:if(De)return De.call(h)==De.call(f)}return!1;return}}if(!(1&r)){a=u&&R.call(e,"__wrapped__"),l=c&&R.call(t,"__wrapped__");if(a||l)return u=a?e.value():e,c=l?t.value():t,i=i||new F,o(u,c,r,n,i)}if(s){i=i||new F;var x=e,b=t,w=r,E=n,T=o,S=i,M=1&w,k=Wr(x),C=k.length,a=Wr(b).length;if(C!=a&&!M)return!1;for(var A=C;A--;){var I=k[A];if(!(M?I in b:R.call(b,I)))return!1}a=S.get(x),l=S.get(b);if(a&&l)return a==b&&l==x;for(var L=!0,P=(S.set(x,b),S.set(b,x),M);++A<C;){I=k[A];var z,D=x[I],O=b[I];if(!((z=E?M?E(O,D,I,b,x,S):E(D,O,I,x,b,S):z)===Uo?D===O||T(D,O,w,E,S):z)){L=!1;break}P=P||"constructor"==I}return L&&!P&&(a=x.constructor,l=b.constructor,a!=l&&"constructor"in x&&"constructor"in b&&!("function"==typeof a&&a instanceof a&&"function"==typeof l&&l instanceof l)&&(L=!1)),S.delete(x),S.delete(b),L}return!1}function Et(e,t,r,n){var i=r.length,o=i,a=!n;if(null==e)return!o;for(e=m(e);i--;){var s=r[i];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<o;){var l=(s=r[i])[0],u=e[l],c=s[1];if(a&&s[2]){if(u===Uo&&!(l in e))return!1}else{var h,f=new F;if(!((h=n?n(u,c,l,e,t,f):h)===Uo?wt(c,u,3,n,f):h))return!1}}return!0}function Tt(e){var t;return!(!b(e)||(t=e,X&&X in t))&&(bi(e)?Q:us).test(En(e))}function St(e){return"function"==typeof e?e:null==e?L:"object"==typeof e?j(e)?Lt(e[0],e[1]):It(e):Co(e)}function Mt(e){if(!ln(e))return ve(e);var t,r=[];for(t in m(e))R.call(e,t)&&"constructor"!=t&&r.push(t);return r}function kt(e){if(!b(e)){var t=e,r=[];if(null!=t)for(var n in m(t))r.push(n);return r}var i,o=ln(e),a=[];for(i in e)("constructor"!=i||!o&&R.call(e,i))&&a.push(i);return a}function Ct(e,t){return e<t}function At(e,n){var i=-1,o=c(e)?w(e.length):[];return it(e,function(e,t,r){o[++i]=n(e,t,r)}),o}function It(t){var r=Yr(t);return 1==r.length&&r[0][2]?cn(r[0][0],r[0][1]):function(e){return e===t||Et(e,t,r)}}function Lt(r,n){return on(r)&&un(n)?cn(wn(r),n):function(e){var t=Wi(e,r);return t===Uo&&t===n?Zi(e,r):wt(n,t,3)}}function Pt(m,g,y,v,_){m!==g&&ut(g,function(e,t){var r,n,i,o,a,s,l,u,c,h,f,d,p;_=_||new F,b(e)?(n=g,o=y,a=Pt,s=v,l=_,f=dn(r=m,i=t),d=dn(n,i),(p=l.get(d))?He(r,i,p):(p=s?s(f,d,i+"",r,n,l):Uo,(n=p===Uo)&&(u=j(d),c=!u&&_i(d),h=!u&&!c&&Ii(d),p=d,u||c||h?p=j(f)?f:x(f)?M(f):c?ur(d,!(n=!1)):h?hr(d,!(n=!1)):[]:Mi(d)||yi(d)?yi(p=f)?p=Ri(f):b(f)&&!bi(f)||(p=tn(d)):n=!1),n&&(l.set(d,p),a(p,d,o,s,l),l.delete(d)),He(r,i,p))):(u=v?v(dn(m,t),e,t+"",m,g,_):Uo,He(m,t,u=u===Uo?e:u))},I)}function zt(e,t){var r=e.length;if(r)return nn(t+=t<0?r:0,r)?e[t]:Uo}function Dt(e,n,c){n=n.length?ua(n,function(t){return j(t)?function(e){return pt(e,1===t.length?t[0]:t)}:t}):[L];var i=-1;n=ua(n,fa(h()));var t=At(e,function(t,e,r){return{criteria:ua(n,function(e){return e(t)}),index:++i,value:t}}),e=function(e,t){for(var r=c,n=-1,i=e.criteria,o=t.criteria,a=i.length,s=r.length;++n<a;){var l,u=fr(i[n],o[n]);if(u)return s<=n?u:(l=r[n],u*("desc"==l?-1:1))}return e.index-t.index},r=t.length;for(t.sort(e);r--;)t[r]=t[r].value;return t}function Ot(e,t,r){for(var n=-1,i=t.length,o={};++n<i;){var a=t[n],s=pt(e,a);r(s,a)&&Vt(o,or(a,e),s)}return o}function Rt(e,t,r,n){var i=n?js:ha,o=-1,a=t.length,s=e;for(e===t&&(t=M(t)),r&&(s=ua(e,fa(r)));++o<a;)for(var l=0,u=t[o],c=r?r(u):u;-1<(l=i(s,c,l,n));)s!==e&&oe.call(s,l,1),oe.call(e,l,1);return e}function Ft(e,t){for(var r=e?t.length:0,n=r-1;r--;){var i,o=t[r];r!=n&&o===i||(nn(i=o)?oe.call(e,o,1):Jt(e,o))}}function Bt(e,t){return e+pe(be()*(t-e+1))}function Nt(e,t){var r="";if(!(!e||t<1||Go<t))for(;t%2&&(r+=e),(t=pe(t/2))&&(e+=e),t;);return r}function a(e,t){return gn(hn(e,t,L),e+"")}function jt(e){return We(ro(e))}function Ut(e,t){e=ro(e);return _n(e,et(t,0,e.length))}function Vt(e,t,r,n){if(b(e))for(var i=-1,o=(t=or(t,e)).length,a=o-1,s=e;null!=s&&++i<o;){var l,u=wn(t[i]),c=r;if("__proto__"===u||"constructor"===u||"prototype"===u)return e;i!=a&&(l=s[u],(c=n?n(l,u,s):Uo)===Uo&&(c=b(l)?l:nn(t[i+1])?[]:{})),$e(s,u,c),s=s[u]}return e}var Gt=ke?function(e,t){return ke.set(e,t),e}:L,t=ue?function(e,t){return ue(e,"toString",{configurable:!0,enumerable:!1,value:yo(t),writable:!0})}:L;function Wt(e){return _n(ro(e))}function s(e,t,r){for(var n=-1,i=e.length,o=((r=i<r?i:r)<0&&(r+=i),i=r<(t=t<0?i<-t?0:i+t:t)?0:r-t>>>0,t>>>=0,w(i));++n<i;)o[n]=e[n+t];return o}function Zt(e,n){var i;return it(e,function(e,t,r){return!(i=n(e,t,r))}),!!i}function qt(e,t,r){var n=0,i=null==e?n:e.length;if("number"==typeof t&&t==t&&i<=2147483647){for(;n<i;){var o=n+i>>>1,a=e[o];null!==a&&!_(a)&&(r?a<=t:a<t)?n=1+o:i=o}return i}return Ht(e,t,L,r)}function Ht(e,t,r,n){var i=0,o=null==e?0:e.length;if(0===o)return 0;for(var a=(t=r(t))!=t,s=null===t,l=_(t),u=t===Uo;i<o;){var c=pe((i+o)/2),h=r(e[c]),f=h!==Uo,d=null===h,p=h==h,m=_(h),p=a?n||p:u?p&&(n||f):s?p&&f&&(n||!d):l?p&&f&&!d&&(n||!m):!d&&!m&&(n?h<=t:h<t);p?i=c+1:o=c}return S(o,4294967294)}function $t(e,t){for(var r=-1,n=e.length,i=0,o=[];++r<n;){var a,s=e[r],l=t?t(s):s;r&&N(l,a)||(a=l,o[i++]=0===s?0:s)}return o}function Xt(e){return"number"==typeof e?e:_(e)?xa:+e}function u(e){var t;return"string"==typeof e?e:j(e)?ua(e,u)+"":_(e)?Oe?Oe.call(e):"":"0"==(t=e+"")&&1/e==-1/0?"-0":t}function Yt(e,t,r){var n=-1,i=zs,o=e.length,a=!0,s=[],l=s;if(r)a=!1,i=Ds;else if(200<=o){var u=t?null:Rr(e);if(u)return nl(u);a=!1,i=Xs,l=new Ve}else l=t?[]:s;e:for(;++n<o;){var c=e[n],h=t?t(c):c,c=r||0!==c?c:0;if(a&&h==h){for(var f=l.length;f--;)if(l[f]===h)continue e;t&&l.push(h),s.push(c)}else i(l,h,r)||(l!==s&&l.push(h),s.push(c))}return s}function Jt(e,t){return null==(e=fn(e,t=or(t,e)))||delete e[wn(n(t))]}function Kt(e,t,r,n){return Vt(e,t,r(pt(e,t)),n)}function Qt(e,t,r,n){for(var i=e.length,o=n?i:-1;(n?o--:++o<i)&&t(e[o],o,e););return r?s(e,n?0:o,n?o+1:i):s(e,n?o+1:0,n?i:o)}function er(e,t){var r=e;return Os(t,function(e,t){return t.func.apply(t.thisArg,ca([e],t.args))},r=e instanceof y?e.value():r)}function tr(e,t,r){var n=e.length;if(n<2)return n?Yt(e[0]):[];for(var i=-1,o=w(n);++i<n;)for(var a=e[i],s=-1;++s<n;)s!=i&&(o[i]=nt(o[i]||a,e[s],t,r));return Yt(l(o,1),t,r)}function rr(e,t,r){for(var n=-1,i=e.length,o=t.length,a={};++n<i;){var s=n<o?t[n]:Uo;r(a,e[n],s)}return a}function nr(e){return x(e)?e:[]}function ir(e){return"function"==typeof e?e:L}function or(e,t){return j(e)?e:on(e,t)?[e]:bn(d(e))}var ar=a;function sr(e,t,r){var n=e.length;return r=r===Uo?n:r,!t&&n<=r?e:s(e,t,r)}var lr=ce||function(e){return oa.clearTimeout(e)};function ur(e,t){return t?e.slice():(t=e.length,t=te?te(t):new e.constructor(t),e.copy(t),t)}function cr(e){var t=new e.constructor(e.byteLength);return new ee(t).set(new ee(e)),t}function hr(e,t){t=t?cr(e.buffer):e.buffer;return new e.constructor(t,e.byteOffset,e.length)}function fr(e,t){if(e!==t){var r=e!==Uo,n=null===e,i=e==e,o=_(e),a=t!==Uo,s=null===t,l=t==t,u=_(t);if(!s&&!u&&!o&&t<e||o&&a&&l&&!s&&!u||n&&a&&l||!r&&l||!i)return 1;if(!n&&!o&&!u&&e<t||u&&r&&i&&!n&&!o||s&&r&&i||!a&&i||!l)return-1}return 0}function dr(e,t,r,n){for(var i=-1,o=e.length,a=r.length,s=-1,l=t.length,u=T(o-a,0),c=w(l+u),h=!n;++s<l;)c[s]=t[s];for(;++i<a;)(h||i<o)&&(c[r[i]]=e[i]);for(;u--;)c[s++]=e[i++];return c}function pr(e,t,r,n){for(var i=-1,o=e.length,a=-1,s=r.length,l=-1,u=t.length,c=T(o-s,0),h=w(c+u),f=!n;++i<c;)h[i]=e[i];for(var d=i;++l<u;)h[d+l]=t[l];for(;++a<s;)(f||i<o)&&(h[d+r[a]]=e[i++]);return h}function M(e,t){var r=-1,n=e.length;for(t=t||w(n);++r<n;)t[r]=e[r];return t}function mr(e,t,r,n){for(var i=!r,o=(r=r||{},-1),a=t.length;++o<a;){var s=t[o],l=n?n(r[s],e[s],s,r,e):Uo;(i?Ke:$e)(r,s,l=l===Uo?e[s]:l)}return r}function gr(i,o){return function(e,t){var r=j(e)?Is:Ye,n=o?o():{};return r(e,i,h(t,2),n)}}function yr(s){return a(function(e,t){var r=-1,n=t.length,i=1<n?t[n-1]:Uo,o=2<n?t[2]:Uo,i=3<s.length&&"function"==typeof i?(n--,i):Uo;for(o&&f(t[0],t[1],o)&&(i=n<3?Uo:i,n=1),e=m(e);++r<n;){var a=t[r];a&&s(e,a,r,i)}return e})}function vr(o,a){return function(e,t){if(null!=e){if(!c(e))return o(e,t);for(var r=e.length,n=a?r:-1,i=m(e);(a?n--:++n<r)&&!1!==t(i[n],n,i););}return e}}function _r(l){return function(e,t,r){for(var n=-1,i=m(e),o=r(e),a=o.length;a--;){var s=o[l?a:++n];if(!1===t(i[s],s,i))break}return e}}function xr(n){return function(e){var t=da(e=d(e))?ga(e):Uo,r=t?t[0]:e.charAt(0),t=t?sr(t,1).join(""):e.slice(1);return r[n]()+t}}function br(t){return function(e){return Os(po(oo(e).replace(ms,"")),t,"")}}function wr(n){return function(){var e=arguments;switch(e.length){case 0:return new n;case 1:return new n(e[0]);case 2:return new n(e[0],e[1]);case 3:return new n(e[0],e[1],e[2]);case 4:return new n(e[0],e[1],e[2],e[3]);case 5:return new n(e[0],e[1],e[2],e[3],e[4]);case 6:return new n(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new n(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var t=Re(n.prototype),r=n.apply(t,e);return b(r)?r:t}}function Er(o,a,s){var l=wr(o);return function e(){for(var t=arguments.length,r=w(t),n=t,i=$r(e);n--;)r[n]=arguments[n];i=t<3&&r[0]!==i&&r[t-1]!==i?[]:pa(r,i);return(t-=i.length)<s?Dr(o,a,Mr,e.placeholder,Uo,r,i,Uo,Uo,s-t):aa(this&&this!==oa&&this instanceof e?l:o,this,r)}}function Tr(o){return function(e,t,r){var n,i=m(e),t=(c(e)||(n=h(t,3),e=A(e),t=function(e){return n(i[e],e,i)}),o(e,t,r));return-1<t?i[n?e[t]:t]:Uo}}function Sr(l){return Gr(function(i){var o=i.length,e=o,t=g.prototype.thru;for(l&&i.reverse();e--;){var r=i[e];if("function"!=typeof r)throw new E(Vo);t&&!s&&"wrapper"==Hr(r)&&(s=new g([],!0))}for(e=s?e:o;++e<o;)var n=Hr(r=i[e]),a="wrapper"==n?qr(r):Uo,s=a&&an(a[0])&&424==a[1]&&!a[4].length&&1==a[9]?s[Hr(a[0])].apply(s,a[3]):1==r.length&&an(r)?s[n]():s.thru(r);return function(){var e=arguments,t=e[0];if(s&&1==e.length&&j(t))return s.plant(t).value();for(var r=0,n=o?i[r].apply(this,e):t;++r<o;)n=i[r].call(this,n);return n}})}function Mr(a,s,l,u,c,h,f,d,p,m){var g=128&s,y=1&s,v=2&s,_=24&s,x=512&s,b=v?Uo:wr(a);return function e(){for(var t,r,n,i=w(n=arguments.length),o=n;o--;)i[o]=arguments[o];return _&&(r=function(e,t){for(var r=e.length,n=0;r--;)e[r]===t&&++n;return n}(i,t=$r(e))),u&&(i=dr(i,u,c,_)),h&&(i=pr(i,h,f,_)),n-=r,_&&n<m?(r=pa(i,t),Dr(a,s,Mr,e.placeholder,l,i,r,d,p,m-n)):(t=y?l:this,r=v?t[a]:a,n=i.length,d?i=function(e,t){for(var r=e.length,n=S(t.length,r),i=M(e);n--;){var o=t[n];e[n]=nn(o,r)?i[o]:Uo}return e}(i,d):x&&1<n&&i.reverse(),g&&p<n&&(i.length=p),(r=this&&this!==oa&&this instanceof e?b||wr(r):r).apply(t,i))}}function kr(r,a){return function(e,t){return e=e,n=r,i=a(t),o={},ht(e,function(e,t,r){n(o,i(e),t,r)}),o;var n,i,o}}function Cr(n,i){return function(e,t){var r;if(e===Uo&&t===Uo)return i;if(e!==Uo&&(r=e),t!==Uo){if(r===Uo)return t;t=("string"==typeof e||"string"==typeof t?(e=u(e),u):(e=Xt(e),Xt))(t),r=n(e,t)}return r}}function Ar(n){return Gr(function(e){return e=ua(e,fa(h())),a(function(t){var r=this;return n(e,function(e){return aa(e,r,t)})})})}function Ir(e,t){var r=(t=t===Uo?" ":u(t)).length;return r<2?r?Nt(t,e):t:(r=Nt(t,de(e/ma(t))),da(t)?sr(ga(r),0,e).join(""):r.slice(0,e))}function Lr(s,e,l,u){var c=1&e,h=wr(s);return function e(){for(var t=-1,r=arguments.length,n=-1,i=u.length,o=w(i+r),a=this&&this!==oa&&this instanceof e?h:s;++n<i;)o[n]=u[n];for(;r--;)o[n++]=arguments[++t];return aa(a,c?l:this,o)}}function Pr(u){return function(e,t,r){r&&"number"!=typeof r&&f(e,t,r)&&(t=r=Uo),e=Di(e),t===Uo?(t=e,e=0):t=Di(t),r=r===Uo?e<t?1:-1:Di(r);for(var n=e,i=r,o=u,a=-1,s=T(de((t-n)/(i||1)),0),l=w(s);s--;)l[o?s:++a]=n,n+=i;return l}}function zr(r){return function(e,t){return"string"==typeof e&&"string"==typeof t||(e=C(e),t=C(t)),r(e,t)}}function Dr(e,t,r,n,i,o,a,s,l,u){var c=8&t,i=(4&(t=(t|(c?32:64))&~(c?64:32))||(t&=-4),[e,t,i,c?o:Uo,c?a:Uo,c?Uo:o,c?Uo:a,s,l,u]),o=r.apply(Uo,i);return an(e)&&pn(o,i),o.placeholder=n,yn(o,e,t)}function Or(e){var n=D[e];return function(e,t){var r;return e=C(e),(t=null==t?0:S(k(t),292))&&ge(e)?(r=(d(e)+"e").split("e"),+((r=(d(n(r[0]+"e"+(+r[1]+t)))+"e").split("e"))[0]+"e"+(+r[1]-t))):n(e)}}var Rr=Se&&1/nl(new Se([,-0]))[1]==1/0?function(e){return new Se(e)}:To;function Fr(o){return function(e){var t,r,n,i=B(e);return i==$o?tl(e):i==Ko?(i=e,t=-1,r=Array(i.size),i.forEach(function(e){r[++t]=[e,e]}),r):ua(o(n=e),function(e){return[e,n[e]]})}}function Br(e,t,r,n,i,o,a,s){var l,u,c,h,f,d,p,m,g,y,v,_,x,b=2&t;if(b||"function"==typeof e)return(l=n?n.length:0)||(t&=-97,n=i=Uo),a=a===Uo?a:T(k(a),0),s=s===Uo?s:k(s),l-=i?i.length:0,64&t&&(c=n,h=i,n=i=Uo),u=b?Uo:qr(e),c=[e,t,r,n,i,c,h,o,a,s],u&&(h=u,a=(o=c)[1],d=h[1],m=(p=a|d)<131,g=128==d&&8==a||128==d&&256==a&&o[7].length<=h[8]||384==d&&h[7].length<=h[8]&&8==a,(m||g)&&(1&d&&(o[2]=h[2],p|=1&a?0:4),(m=h[3])&&(f=o[3],o[3]=f?dr(f,m,h[4]):m,o[4]=f?pa(o[3],_a):h[4]),(m=h[5])&&(f=o[5],o[5]=f?pr(f,m,h[6]):m,o[6]=f?pa(o[5],_a):h[6]),(m=h[7])&&(o[7]=m),128&d&&(o[8]=null==o[8]?h[8]:S(o[8],h[8])),null==o[9]&&(o[9]=h[9]),o[0]=h[0],o[1]=p)),e=c[0],t=c[1],r=c[2],n=c[3],i=c[4],!(s=c[9]=c[9]===Uo?b?0:e.length:T(c[9]-l,0))&&24&t&&(t&=-25),g=t&&1!=t?8==t||16==t?Er(e,t,s):32!=t&&33!=t||i.length?Mr.apply(Uo,c):Lr(e,t,r,n):(v=r,_=1&t,x=wr(y=e),function e(){return(this&&this!==oa&&this instanceof e?x:y).apply(_?v:this,arguments)}),yn((u?Gt:pn)(g,c),e,t);throw new E(Vo)}function Nr(e,t,r,n){return e===Uo||N(e,Z[r])&&!R.call(n,r)?t:e}function jr(e,t,r,n,i,o){return b(e)&&b(t)&&(o.set(t,e),Pt(e,t,Uo,jr,o),o.delete(t)),e}function Ur(e){return Mi(e)?Uo:e}function Vr(e,t,r,n,i,o){var a=1&r,s=e.length,l=t.length;if(s!=l&&!(a&&s<l))return!1;var l=o.get(e),u=o.get(t);if(l&&u)return l==t&&u==e;var c=-1,h=!0,f=2&r?new Ve:Uo;for(o.set(e,t),o.set(t,e);++c<s;){var d,p=e[c],m=t[c];if((d=n?a?n(m,p,c,t,e,o):n(p,m,c,e,t,o):d)!==Uo){if(d)continue;h=!1;break}if(f){if(!Fs(t,function(e,t){return!Xs(f,t)&&(p===e||i(p,e,r,n,o))&&f.push(t)})){h=!1;break}}else if(p!==m&&!i(p,m,r,n,o)){h=!1;break}}return o.delete(e),o.delete(t),h}function Gr(e){return gn(hn(e,Uo,kn),e+"")}function Wr(e){return mt(e,A,Kr)}function Zr(e){return mt(e,I,Qr)}var qr=ke?function(e){return ke.get(e)}:To;function Hr(e){for(var t=e.name+"",r=Ce[t],n=R.call(Ce,t)?r.length:0;n--;){var i=r[n],o=i.func;if(null==o||o==e)return i.name}return t}function $r(e){return(R.call(p,"placeholder")?p:e).placeholder}function h(){var e=(e=p.iteratee||xo)===xo?St:e;return arguments.length?e(arguments[0],arguments[1]):e}function Xr(e,t){var r,n,e=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?e["string"==typeof t?"string":"hash"]:e.map}function Yr(e){for(var t=A(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,un(i)]}return t}function Jr(e,t){t=t;e=null==(e=e)?Uo:e[t];return Tt(e)?e:Uo}var Kr=me?function(t){return null==t?[]:(t=m(t),la(me(t),function(e){return ie.call(t,e)}))}:Lo,Qr=me?function(e){for(var t=[];e;)ca(t,Kr(e)),e=re(e);return t}:Lo,B=r;function en(e,t,r){for(var n=-1,i=(t=or(t,e)).length,o=!1;++n<i;){var a=wn(t[n]);if(!(o=null!=e&&r(e,a)))break;e=e[a]}return o||++n!=i?o:!!(i=null==e?0:e.length)&&Ei(i)&&nn(a,i)&&(j(e)||yi(e))}function tn(e){return"function"!=typeof e.constructor||ln(e)?{}:Re(re(e))}function rn(e){return j(e)||yi(e)||!!(ae&&e&&e[ae])}function nn(e,t){var r=typeof e;return!!(t=null==t?Go:t)&&("number"==r||"symbol"!=r&&hs.test(e))&&-1<e&&e%1==0&&e<t}function f(e,t,r){var n;if(b(r))return("number"==(n=typeof t)?c(r)&&nn(t,r.length):"string"==n&&t in r)&&N(r[t],e)}function on(e,t){var r;if(!j(e))return"number"==(r=typeof e)||"symbol"==r||"boolean"==r||null==e||_(e)||($a.test(e)||!Ha.test(e)||null!=t&&e in m(t))}function an(e){var t=Hr(e),r=p[t];return"function"==typeof r&&t in y.prototype&&(e===r||(t=qr(r))&&e===t[0])}(o&&B(new o(new ArrayBuffer(1)))!=ra||Ee&&B(new Ee)!=$o||Te&&B(Te.resolve())!=Ma||Se&&B(new Se)!=Ko||e&&B(new e)!=ea)&&(B=function(e){var t=r(e),e=t==Yo?e.constructor:Uo,e=e?En(e):"";if(e)switch(e){case Ae:return ra;case Ie:return $o;case Le:return Ma;case Pe:return Ko;case ze:return ea}return t});var sn=q?bi:Po;function ln(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Z)}function un(e){return e==e&&!b(e)}function cn(t,r){return function(e){return null!=e&&(e[t]===r&&(r!==Uo||t in m(e)))}}function hn(o,a,s){return a=T(a===Uo?o.length-1:a,0),function(){for(var e=arguments,t=-1,r=T(e.length-a,0),n=w(r);++t<r;)n[t]=e[a+t];for(var t=-1,i=w(a+1);++t<a;)i[t]=e[t];return i[a]=s(n),aa(o,this,i)}}function fn(e,t){return t.length<2?e:pt(e,s(t,0,-1))}function dn(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var pn=vn(Gt),mn=fe||function(e,t){return oa.setTimeout(e,t)},gn=vn(t);function yn(e,t,r){var n,i,o,t=t+"";return gn(e,(i=(t=(t=e=t).match(es))?t[1].split(ts):[],o=r,sa(ba,function(e){var t="_."+e[0];o&e[1]&&!zs(i,t)&&i.push(t)}),t=i.sort(),(r=t.length)?(t[n=r-1]=(1<r?"& ":"")+t[n],t=t.join(2<r?", ":" "),e.replace(Qa,"{\n/* [wrapped with "+t+"] */\n")):e))}function vn(r){var n=0,i=0;return function(){var e=_e(),t=16-(e-i);if(i=e,0<t){if(800<=++n)return arguments[0]}else n=0;return r.apply(Uo,arguments)}}function _n(e,t){var r=-1,n=e.length,i=n-1;for(t=t===Uo?n:t;++r<t;){var o=Bt(r,i),a=e[o];e[o]=e[r],e[r]=a}return e.length=t,e}xn=(ce=ci(ce=function(e){var i=[];return 46===e.charCodeAt(0)&&i.push(""),e.replace(Xa,function(e,t,r,n){i.push(r?n.replace(is,"$1"):t||e)}),i},function(e){return 500===xn.size&&xn.clear(),e})).cache;var xn,bn=ce;function wn(e){var t;return"string"==typeof e||_(e)?e:"0"==(t=e+"")&&1/e==-1/0?"-0":t}function En(e){if(null!=e){try{return H.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Tn(e){var t;return e instanceof y?e.clone():((t=new g(e.__wrapped__,e.__chain__)).__actions__=M(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t)}o=a(function(e,t){return x(e)?nt(e,l(t,1,x,!0)):[]}),Te=a(function(e,t){var r=n(t);return x(r)&&(r=Uo),x(e)?nt(e,l(t,1,x,!0),h(r,2)):[]}),e=a(function(e,t){var r=n(t);return x(r)&&(r=Uo),x(e)?nt(e,l(t,1,x,!0),Uo,r):[]});function Sn(e,t,r){var n=null==e?0:e.length;return n?((r=null==r?0:k(r))<0&&(r=T(n+r,0)),Ns(e,h(t,3),r)):-1}function Mn(e,t,r){var n,i=null==e?0:e.length;return i?(n=i-1,r!==Uo&&(n=k(r),n=r<0?T(i+n,0):S(n,i-1)),Ns(e,h(t,3),n,!0)):-1}function kn(e){return(null==e?0:e.length)?l(e,1):[]}function Cn(e){return e&&e.length?e[0]:Uo}q=a(function(e){var t=ua(e,nr);return t.length&&t[0]===e[0]?_t(t):[]}),fe=a(function(e){var t=n(e),r=ua(e,nr);return t===n(r)?t=Uo:r.pop(),r.length&&r[0]===e[0]?_t(r,h(t,2)):[]}),t=a(function(e){var t=n(e),r=ua(e,nr);return(t="function"==typeof t?t:Uo)&&r.pop(),r.length&&r[0]===e[0]?_t(r,Uo,t):[]});function n(e){var t=null==e?0:e.length;return t?e[t-1]:Uo}ce=a(An);function An(e,t){return e&&e.length&&t&&t.length?Rt(e,t):e}var In=Gr(function(e,t){var r=null==e?0:e.length,n=Qe(e,t);return Ft(e,ua(t,function(e){return nn(e,r)?+e:e}).sort(fr)),n});function Ln(e){return null==e?e:we.call(e)}var Pn=a(function(e){return Yt(l(e,1,x,!0))}),zn=a(function(e){var t=n(e);return x(t)&&(t=Uo),Yt(l(e,1,x,!0),h(t,2))}),Dn=a(function(e){var t="function"==typeof(t=n(e))?t:Uo;return Yt(l(e,1,x,!0),Uo,t)});function On(t){var r;return t&&t.length?(r=0,t=la(t,function(e){return x(e)&&(r=T(e.length,r),1)}),qs(r,function(e){return ua(t,Gs(e))})):[]}function Rn(e,t){return e&&e.length?(e=On(e),null==t?e:ua(e,function(e){return aa(t,Uo,e)})):[]}var Fn=a(function(e,t){return x(e)?nt(e,t):[]}),Bn=a(function(e){return tr(la(e,x))}),Nn=a(function(e){var t=n(e);return x(t)&&(t=Uo),tr(la(e,x),h(t,2))}),jn=a(function(e){var t="function"==typeof(t=n(e))?t:Uo;return tr(la(e,x),Uo,t)}),Un=a(On);var Vn=a(function(e){var t=e.length,t="function"==typeof(t=1<t?e[t-1]:Uo)?(e.pop(),t):Uo;return Rn(e,t)});function Gn(e){e=p(e);return e.__chain__=!0,e}function Wn(e,t){return t(e)}var Zn=Gr(function(t){function e(e){return Qe(e,t)}var r=t.length,n=r?t[0]:0,i=this.__wrapped__;return 1<r||this.__actions__.length||!(i instanceof y&&nn(n))?this.thru(e):((i=i.slice(n,+n+(r?1:0))).__actions__.push({func:Wn,args:[e],thisArg:Uo}),new g(i,this.__chain__).thru(function(e){return r&&!e.length&&e.push(Uo),e}))});var qn=gr(function(e,t,r){R.call(e,r)?++e[r]:Ke(e,r,1)});var Hn=Tr(Sn),$n=Tr(Mn);function Xn(e,t){return(j(e)?sa:it)(e,h(t,3))}function Yn(e,t){return(j(e)?Ls:ot)(e,h(t,3))}var Jn=gr(function(e,t,r){R.call(e,r)?e[r].push(t):Ke(e,r,[t])});var Kn=a(function(e,t,r){var n=-1,i="function"==typeof t,o=c(e)?w(e.length):[];return it(e,function(e){o[++n]=i?aa(t,e,r):xt(e,t,r)}),o}),Qn=gr(function(e,t,r){Ke(e,r,t)});function ei(e,t){return(j(e)?ua:At)(e,h(t,3))}var ti=gr(function(e,t,r){e[r?0:1].push(t)},function(){return[[],[]]});var ri=a(function(e,t){var r;return null==e?[]:(1<(r=t.length)&&f(e,t[0],t[1])?t=[]:2<r&&f(t[0],t[1],t[2])&&(t=[t[0]]),Dt(e,l(t,1),[]))}),ni=he||function(){return oa.Date.now()};function ii(e,t,r){return t=r?Uo:t,t=e&&null==t?e.length:t,Br(e,128,Uo,Uo,Uo,Uo,t)}function oi(e,t){var r;if("function"!=typeof t)throw new E(Vo);return e=k(e),function(){return 0<--e&&(r=t.apply(this,arguments)),e<=1&&(t=Uo),r}}var ai=a(function(e,t,r){var n,i=1;return r.length&&(n=pa(r,$r(ai)),i|=32),Br(e,i,t,r,n)}),si=a(function(e,t,r){var n,i=3;return r.length&&(n=pa(r,$r(si)),i|=32),Br(t,i,e,r,n)});function li(n,r,e){var i,o,a,s,l,u,c=0,h=!1,f=!1,t=!0;if("function"!=typeof n)throw new E(Vo);function d(e){var t=i,r=o;return i=o=Uo,c=e,s=n.apply(r,t)}function p(e){var t=e-u;return u===Uo||r<=t||t<0||f&&a<=e-c}function m(){var e,t=ni();if(p(t))return g(t);l=mn(m,(e=r-((t=t)-u),f?S(e,a-(t-c)):e))}function g(e){return l=Uo,t&&i?d(e):(i=o=Uo,s)}function y(){var e=ni(),t=p(e);if(i=arguments,o=this,u=e,t){if(l===Uo)return c=e=u,l=mn(m,r),h?d(e):s;if(f)return lr(l),l=mn(m,r),d(u)}return l===Uo&&(l=mn(m,r)),s}return r=C(r)||0,b(e)&&(h=!!e.leading,f="maxWait"in e,a=f?T(C(e.maxWait)||0,r):a,t="trailing"in e?!!e.trailing:t),y.cancel=function(){l!==Uo&&lr(l),c=0,i=u=o=l=Uo},y.flush=function(){return l===Uo?s:g(ni())},y}var he=a(function(e,t){return rt(e,1,t)}),ui=a(function(e,t,r){return rt(e,C(t)||0,r)});function ci(n,i){if("function"!=typeof n||null!=i&&"function"!=typeof i)throw new E(Vo);function o(){var e=arguments,t=i?i.apply(this,e):e[0],r=o.cache;return r.has(t)?r.get(t):(e=n.apply(this,e),o.cache=r.set(t,e)||r,e)}return o.cache=new(ci.Cache||Ue),o}function hi(t){if("function"!=typeof t)throw new E(Vo);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}ci.Cache=Ue;var ar=ar(function(n,i){var o=(i=1==i.length&&j(i[0])?ua(i[0],fa(h())):ua(l(i,1),fa(h()))).length;return a(function(e){for(var t=-1,r=S(e.length,o);++t<r;)e[t]=i[t].call(this,e[t]);return aa(n,this,e)})}),fi=a(function(e,t){var r=pa(t,$r(fi));return Br(e,32,Uo,t,r)}),di=a(function(e,t){var r=pa(t,$r(di));return Br(e,64,Uo,t,r)}),pi=Gr(function(e,t){return Br(e,256,Uo,Uo,Uo,t)});function N(e,t){return e===t||e!=e&&t!=t}var mi=zr(gt),gi=zr(function(e,t){return t<=e}),yi=bt(function(){return arguments}())?bt:function(e){return U(e)&&R.call(e,"callee")&&!ie.call(e,"callee")},j=w.isArray,vi=Ts?fa(Ts):function(e){return U(e)&&r(e)==ta};function c(e){return null!=e&&Ei(e.length)&&!bi(e)}function x(e){return U(e)&&c(e)}var _i=W||Po,W=Ss?fa(Ss):function(e){return U(e)&&r(e)==Ho};function xi(e){var t;return!!U(e)&&((t=r(e))==Ea||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!Mi(e))}function bi(e){return!!b(e)&&((e=r(e))==Ta||e==Sa||"[object AsyncFunction]"==e||"[object Proxy]"==e)}function wi(e){return"number"==typeof e&&e==k(e)}function Ei(e){return"number"==typeof e&&-1<e&&e%1==0&&e<=Go}function b(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function U(e){return null!=e&&"object"==typeof e}var Ti=Ms?fa(Ms):function(e){return U(e)&&B(e)==$o};function Si(e){return"number"==typeof e||U(e)&&r(e)==Xo}function Mi(e){return!(!U(e)||r(e)!=Yo)&&(null===(e=re(e))||"function"==typeof(e=R.call(e,"constructor")&&e.constructor)&&e instanceof e&&H.call(e)==J)}var ki=ks?fa(ks):function(e){return U(e)&&r(e)==Jo};var Ci=Cs?fa(Cs):function(e){return U(e)&&B(e)==Ko};function Ai(e){return"string"==typeof e||!j(e)&&U(e)&&r(e)==Qo}function _(e){return"symbol"==typeof e||U(e)&&r(e)==ka}var Ii=As?fa(As):function(e){return U(e)&&Ei(e.length)&&!!na[r(e)]};var Li=zr(Ct),Pi=zr(function(e,t){return e<=t});function zi(e){if(!e)return[];if(c(e))return(Ai(e)?ga:M)(e);if(se&&e[se]){for(var t,r=e[se](),n=[];!(t=r.next()).done;)n.push(t.value);return n}var i=B(e);return(i==$o?tl:i==Ko?nl:ro)(e)}function Di(e){return e?(e=C(e))===1/0||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function k(e){var e=Di(e),t=e%1;return e==e?t?e-t:e:0}function Oi(e){return e?et(k(e),0,Wo):0}function C(e){if("number"==typeof e)return e;if(_(e))return xa;if("string"!=typeof(e=b(e)?b(t="function"==typeof e.valueOf?e.valueOf():e)?t+"":t:e))return 0===e?e:+e;e=Hs(e);var t=ls.test(e);return t||cs.test(e)?ws(e.slice(2),t?2:8):ss.test(e)?xa:+e}function Ri(e){return mr(e,I(e))}function d(e){return null==e?"":u(e)}var Fi=yr(function(e,t){if(ln(t)||c(t))mr(t,A(t),e);else for(var r in t)R.call(t,r)&&$e(e,r,t[r])}),Bi=yr(function(e,t){mr(t,I(t),e)}),Ni=yr(function(e,t,r,n){mr(t,I(t),e,n)}),ji=yr(function(e,t,r,n){mr(t,A(t),e,n)}),Ui=Gr(Qe);var Vi=a(function(e,t){e=m(e);var r=-1,n=t.length,i=2<n?t[2]:Uo;for(i&&f(t[0],t[1],i)&&(n=1);++r<n;)for(var o=t[r],a=I(o),s=-1,l=a.length;++s<l;){var u=a[s],c=e[u];(c===Uo||N(c,Z[u])&&!R.call(e,u))&&(e[u]=o[u])}return e}),Gi=a(function(e){return e.push(Uo,jr),aa(Yi,Uo,e)});function Wi(e,t,r){e=null==e?Uo:pt(e,t);return e===Uo?r:e}function Zi(e,t){return null!=e&&en(e,t,vt)}var qi=kr(function(e,t,r){e[t=null!=t&&"function"!=typeof t.toString?Y.call(t):t]=r},yo(L)),Hi=kr(function(e,t,r){null!=t&&"function"!=typeof t.toString&&(t=Y.call(t)),R.call(e,t)?e[t].push(r):e[t]=[r]},h),$i=a(xt);function A(e){return(c(e)?Ge:Mt)(e)}function I(e){return c(e)?Ge(e,!0):kt(e)}var Xi=yr(function(e,t,r){Pt(e,t,r)}),Yi=yr(function(e,t,r,n){Pt(e,t,r,n)}),Ji=Gr(function(t,e){var r={};if(null!=t)for(var n=!1,i=(e=ua(e,function(e){return e=or(e,t),n=n||1<e.length,e}),mr(t,Zr(t),r),n&&(r=v(r,7,Ur)),e.length);i--;)Jt(r,e[i]);return r});var Ki=Gr(function(e,t){return null==e?{}:Ot(r=e,t,function(e,t){return Zi(r,t)});var r});function Qi(e,r){var t;return null==e?{}:(t=ua(Zr(e),function(e){return[e]}),r=h(r),Ot(e,t,function(e,t){return r(e,t[0])}))}var eo=Fr(A),to=Fr(I);function ro(e){return null==e?[]:$s(e,A(e))}var no=br(function(e,t,r){return t=t.toLowerCase(),e+(r?io(t):t)});function io(e){return fo(d(e).toLowerCase())}function oo(e){return(e=d(e))&&e.replace(fs,Ks).replace(gs,"")}var ao=br(function(e,t,r){return e+(r?"-":"")+t.toLowerCase()}),so=br(function(e,t,r){return e+(r?" ":"")+t.toLowerCase()}),lo=xr("toLowerCase");var uo=br(function(e,t,r){return e+(r?"_":"")+t.toLowerCase()});var co=br(function(e,t,r){return e+(r?" ":"")+fo(t)});var ho=br(function(e,t,r){return e+(r?" ":"")+t.toUpperCase()}),fo=xr("toUpperCase");function po(e,t,r){return e=d(e),(t=r?Uo:t)===Uo?(r=e,vs.test(r)?e.match(ys)||[]:e.match(rs)||[]):e.match(t)||[]}var mo=a(function(e,t){try{return aa(e,Uo,t)}catch(e){return xi(e)?e:new P(e)}}),go=Gr(function(t,e){return sa(e,function(e){e=wn(e),Ke(t,e,ai(t[e],t))}),t});function yo(e){return function(){return e}}var vo=Sr(),_o=Sr(!0);function L(e){return e}function xo(e){return St("function"==typeof e?e:v(e,1))}var bo=a(function(t,r){return function(e){return xt(e,t,r)}}),wo=a(function(t,r){return function(e){return xt(t,e,r)}});function Eo(n,t,e){var r=A(t),i=dt(t,r),o=(null!=e||b(t)&&(i.length||!r.length)||(e=t,t=n,n=this,i=dt(t,A(t))),!(b(e)&&"chain"in e&&!e.chain)),a=bi(n);return sa(i,function(e){var r=t[e];n[e]=r,a&&(n.prototype[e]=function(){var e,t=this.__chain__;return o||t?(((e=n(this.__wrapped__)).__actions__=M(this.__actions__)).push({func:r,args:arguments,thisArg:n}),e.__chain__=t,e):r.apply(n,ca([this.value()],arguments))})}),n}function To(){}var So=Ar(ua),Mo=Ar(Ps),ko=Ar(Fs);function Co(e){return on(e)?Gs(wn(e)):(t=e,function(e){return pt(e,t)});var t}var Ao=Pr(),Io=Pr(!0);function Lo(){return[]}function Po(){return!1}var zo=Cr(function(e,t){return e+t},0),Do=Or("ceil"),Oo=Cr(function(e,t){return e/t},1),Ro=Or("floor");var Fo,Bo=Cr(function(e,t){return e*t},1),No=Or("round"),jo=Cr(function(e,t){return e-t},0);return p.after=function(e,t){if("function"!=typeof t)throw new E(Vo);return e=k(e),function(){if(--e<1)return t.apply(this,arguments)}},p.ary=ii,p.assign=Fi,p.assignIn=Bi,p.assignInWith=Ni,p.assignWith=ji,p.at=Ui,p.before=oi,p.bind=ai,p.bindAll=go,p.bindKey=si,p.castArray=function(){var e;return arguments.length?j(e=arguments[0])?e:[e]:[]},p.chain=Gn,p.chunk=function(e,t,r){t=(r?f(e,t,r):t===Uo)?1:T(k(t),0);var n=null==e?0:e.length;if(!n||t<1)return[];for(var i=0,o=0,a=w(de(n/t));i<n;)a[o++]=s(e,i,i+=t);return a},p.compact=function(e){for(var t=-1,r=null==e?0:e.length,n=0,i=[];++t<r;){var o=e[t];o&&(i[n++]=o)}return i},p.concat=function(){var e=arguments.length;if(!e)return[];for(var t=w(e-1),r=arguments[0],n=e;n--;)t[n-1]=arguments[n];return ca(j(r)?M(r):[r],l(t,1))},p.cond=function(n){var i=null==n?0:n.length,t=h();return n=i?ua(n,function(e){if("function"!=typeof e[1])throw new E(Vo);return[t(e[0]),e[1]]}):[],a(function(e){for(var t=-1;++t<i;){var r=n[t];if(aa(r[0],this,e))return aa(r[1],this,e)}})},p.conforms=function(e){return t=v(e,1),r=A(t),function(e){return tt(e,t,r)};var t,r},p.constant=yo,p.countBy=qn,p.create=function(e,t){return e=Re(e),null==t?e:Je(e,t)},p.curry=function e(t,r,n){t=Br(t,8,Uo,Uo,Uo,Uo,Uo,r=n?Uo:r);return t.placeholder=e.placeholder,t},p.curryRight=function e(t,r,n){t=Br(t,16,Uo,Uo,Uo,Uo,Uo,r=n?Uo:r);return t.placeholder=e.placeholder,t},p.debounce=li,p.defaults=Vi,p.defaultsDeep=Gi,p.defer=he,p.delay=ui,p.difference=o,p.differenceBy=Te,p.differenceWith=e,p.drop=function(e,t,r){var n=null==e?0:e.length;return n?s(e,(t=r||t===Uo?1:k(t))<0?0:t,n):[]},p.dropRight=function(e,t,r){var n=null==e?0:e.length;return n?s(e,0,(t=n-(t=r||t===Uo?1:k(t)))<0?0:t):[]},p.dropRightWhile=function(e,t){return e&&e.length?Qt(e,h(t,3),!0,!0):[]},p.dropWhile=function(e,t){return e&&e.length?Qt(e,h(t,3),!0):[]},p.fill=function(e,t,r,n){if(!(l=null==e?0:e.length))return[];r&&"number"!=typeof r&&f(e,t,r)&&(r=0,n=l);var i=e,o=t,a=r,s=n,l=i.length;for((a=k(a))<0&&(a=l<-a?0:l+a),(s=s===Uo||l<s?l:k(s))<0&&(s+=l),s=s<a?0:Oi(s);a<s;)i[a++]=o;return i},p.filter=function(e,t){return(j(e)?la:lt)(e,h(t,3))},p.flatMap=function(e,t){return l(ei(e,t),1)},p.flatMapDeep=function(e,t){return l(ei(e,t),1/0)},p.flatMapDepth=function(e,t,r){return r=r===Uo?1:k(r),l(ei(e,t),r)},p.flatten=kn,p.flattenDeep=function(e){return(null==e?0:e.length)?l(e,1/0):[]},p.flattenDepth=function(e,t){return(null==e?0:e.length)?l(e,t=t===Uo?1:k(t)):[]},p.flip=function(e){return Br(e,512)},p.flow=vo,p.flowRight=_o,p.fromPairs=function(e){for(var t=-1,r=null==e?0:e.length,n={};++t<r;){var i=e[t];n[i[0]]=i[1]}return n},p.functions=function(e){return null==e?[]:dt(e,A(e))},p.functionsIn=function(e){return null==e?[]:dt(e,I(e))},p.groupBy=Jn,p.initial=function(e){return(null==e?0:e.length)?s(e,0,-1):[]},p.intersection=q,p.intersectionBy=fe,p.intersectionWith=t,p.invert=qi,p.invertBy=Hi,p.invokeMap=Kn,p.iteratee=xo,p.keyBy=Qn,p.keys=A,p.keysIn=I,p.map=ei,p.mapKeys=function(e,n){var i={};return n=h(n,3),ht(e,function(e,t,r){Ke(i,n(e,t,r),e)}),i},p.mapValues=function(e,n){var i={};return n=h(n,3),ht(e,function(e,t,r){Ke(i,t,n(e,t,r))}),i},p.matches=function(e){return It(v(e,1))},p.matchesProperty=function(e,t){return Lt(e,v(t,1))},p.memoize=ci,p.merge=Xi,p.mergeWith=Yi,p.method=bo,p.methodOf=wo,p.mixin=Eo,p.negate=hi,p.nthArg=function(t){return t=k(t),a(function(e){return zt(e,t)})},p.omit=Ji,p.omitBy=function(e,t){return Qi(e,hi(h(t)))},p.once=function(e){return oi(2,e)},p.orderBy=function(e,t,r,n){return null==e?[]:Dt(e,t=j(t)?t:null==t?[]:[t],r=j(r=n?Uo:r)?r:null==r?[]:[r])},p.over=So,p.overArgs=ar,p.overEvery=Mo,p.overSome=ko,p.partial=fi,p.partialRight=di,p.partition=ti,p.pick=Ki,p.pickBy=Qi,p.property=Co,p.propertyOf=function(t){return function(e){return null==t?Uo:pt(t,e)}},p.pull=ce,p.pullAll=An,p.pullAllBy=function(e,t,r){return e&&e.length&&t&&t.length?Rt(e,t,h(r,2)):e},p.pullAllWith=function(e,t,r){return e&&e.length&&t&&t.length?Rt(e,t,Uo,r):e},p.pullAt=In,p.range=Ao,p.rangeRight=Io,p.rearg=pi,p.reject=function(e,t){return(j(e)?la:lt)(e,hi(h(t,3)))},p.remove=function(e,t){var r=[];if(e&&e.length){var n=-1,i=[],o=e.length;for(t=h(t,3);++n<o;){var a=e[n];t(a,n,e)&&(r.push(a),i.push(n))}Ft(e,i)}return r},p.rest=function(e,t){if("function"!=typeof e)throw new E(Vo);return a(e,t=t===Uo?t:k(t))},p.reverse=Ln,p.sampleSize=function(e,t,r){return t=(r?f(e,t,r):t===Uo)?1:k(t),(j(e)?Ze:Ut)(e,t)},p.set=function(e,t,r){return null==e?e:Vt(e,t,r)},p.setWith=function(e,t,r,n){return n="function"==typeof n?n:Uo,null==e?e:Vt(e,t,r,n)},p.shuffle=function(e){return(j(e)?qe:Wt)(e)},p.slice=function(e,t,r){var n=null==e?0:e.length;return n?(r=r&&"number"!=typeof r&&f(e,t,r)?(t=0,n):(t=null==t?0:k(t),r===Uo?n:k(r)),s(e,t,r)):[]},p.sortBy=ri,p.sortedUniq=function(e){return e&&e.length?$t(e):[]},p.sortedUniqBy=function(e,t){return e&&e.length?$t(e,h(t,2)):[]},p.split=function(e,t,r){return r&&"number"!=typeof r&&f(e,t,r)&&(t=r=Uo),(r=r===Uo?Wo:r>>>0)?(e=d(e))&&("string"==typeof t||null!=t&&!ki(t))&&!(t=u(t))&&da(e)?sr(ga(e),0,r):e.split(t,r):[]},p.spread=function(r,n){if("function"!=typeof r)throw new E(Vo);return n=null==n?0:T(k(n),0),a(function(e){var t=e[n],e=sr(e,0,n);return t&&ca(e,t),aa(r,this,e)})},p.tail=function(e){var t=null==e?0:e.length;return t?s(e,1,t):[]},p.take=function(e,t,r){return e&&e.length?s(e,0,(t=r||t===Uo?1:k(t))<0?0:t):[]},p.takeRight=function(e,t,r){var n=null==e?0:e.length;return n?s(e,(t=n-(t=r||t===Uo?1:k(t)))<0?0:t,n):[]},p.takeRightWhile=function(e,t){return e&&e.length?Qt(e,h(t,3),!1,!0):[]},p.takeWhile=function(e,t){return e&&e.length?Qt(e,h(t,3)):[]},p.tap=function(e,t){return t(e),e},p.throttle=function(e,t,r){var n=!0,i=!0;if("function"!=typeof e)throw new E(Vo);return b(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),li(e,t,{leading:n,maxWait:t,trailing:i})},p.thru=Wn,p.toArray=zi,p.toPairs=eo,p.toPairsIn=to,p.toPath=function(e){return j(e)?ua(e,wn):_(e)?[e]:M(bn(d(e)))},p.toPlainObject=Ri,p.transform=function(e,n,i){var t,r=j(e),o=r||_i(e)||Ii(e);return n=h(n,4),null==i&&(t=e&&e.constructor,i=o?r?new t:[]:b(e)&&bi(t)?Re(re(e)):{}),(o?sa:ht)(e,function(e,t,r){return n(i,e,t,r)}),i},p.unary=function(e){return ii(e,1)},p.union=Pn,p.unionBy=zn,p.unionWith=Dn,p.uniq=function(e){return e&&e.length?Yt(e):[]},p.uniqBy=function(e,t){return e&&e.length?Yt(e,h(t,2)):[]},p.uniqWith=function(e,t){return t="function"==typeof t?t:Uo,e&&e.length?Yt(e,Uo,t):[]},p.unset=function(e,t){return null==e||Jt(e,t)},p.unzip=On,p.unzipWith=Rn,p.update=function(e,t,r){return null==e?e:Kt(e,t,ir(r))},p.updateWith=function(e,t,r,n){return n="function"==typeof n?n:Uo,null==e?e:Kt(e,t,ir(r),n)},p.values=ro,p.valuesIn=function(e){return null==e?[]:$s(e,I(e))},p.without=Fn,p.words=po,p.wrap=function(e,t){return fi(ir(t),e)},p.xor=Bn,p.xorBy=Nn,p.xorWith=jn,p.zip=Un,p.zipObject=function(e,t){return rr(e||[],t||[],$e)},p.zipObjectDeep=function(e,t){return rr(e||[],t||[],Vt)},p.zipWith=Vn,p.entries=eo,p.entriesIn=to,p.extend=Bi,p.extendWith=Ni,Eo(p,p),p.add=zo,p.attempt=mo,p.camelCase=no,p.capitalize=io,p.ceil=Do,p.clamp=function(e,t,r){return r===Uo&&(r=t,t=Uo),r!==Uo&&(r=(r=C(r))==r?r:0),t!==Uo&&(t=(t=C(t))==t?t:0),et(C(e),t,r)},p.clone=function(e){return v(e,4)},p.cloneDeep=function(e){return v(e,5)},p.cloneDeepWith=function(e,t){return v(e,5,t="function"==typeof t?t:Uo)},p.cloneWith=function(e,t){return v(e,4,t="function"==typeof t?t:Uo)},p.conformsTo=function(e,t){return null==t||tt(e,t,A(t))},p.deburr=oo,p.defaultTo=function(e,t){return null==e||e!=e?t:e},p.divide=Oo,p.endsWith=function(e,t,r){e=d(e),t=u(t);var n=e.length,n=r=r===Uo?n:et(k(r),0,n);return 0<=(r-=t.length)&&e.slice(r,n)==t},p.eq=N,p.escape=function(e){return(e=d(e))&&Ga.test(e)?e.replace(Ua,Qs):e},p.escapeRegExp=function(e){return(e=d(e))&&Ja.test(e)?e.replace(Ya,"\\$&"):e},p.every=function(e,t,r){return(j(e)?Ps:at)(e,h(t=r&&f(e,t,r)?Uo:t,3))},p.find=Hn,p.findIndex=Sn,p.findKey=function(e,t){return Bs(e,h(t,3),ht)},p.findLast=$n,p.findLastIndex=Mn,p.findLastKey=function(e,t){return Bs(e,h(t,3),ft)},p.floor=Ro,p.forEach=Xn,p.forEachRight=Yn,p.forIn=function(e,t){return null==e?e:ut(e,h(t,3),I)},p.forInRight=function(e,t){return null==e?e:ct(e,h(t,3),I)},p.forOwn=function(e,t){return e&&ht(e,h(t,3))},p.forOwnRight=function(e,t){return e&&ft(e,h(t,3))},p.get=Wi,p.gt=mi,p.gte=gi,p.has=function(e,t){return null!=e&&en(e,t,yt)},p.hasIn=Zi,p.head=Cn,p.identity=L,p.includes=function(e,t,r,n){return e=c(e)?e:ro(e),r=r&&!n?k(r):0,n=e.length,r<0&&(r=T(n+r,0)),Ai(e)?r<=n&&-1<e.indexOf(t,r):!!n&&-1<ha(e,t,r)},p.indexOf=function(e,t,r){var n=null==e?0:e.length;return n?ha(e,t,e=(e=null==r?0:k(r))<0?T(n+e,0):e):-1},p.inRange=function(e,t,r){return t=Di(t),r===Uo?(r=t,t=0):r=Di(r),(e=e=C(e))>=S(t=t,r=r)&&e<T(t,r)},p.invoke=$i,p.isArguments=yi,p.isArray=j,p.isArrayBuffer=vi,p.isArrayLike=c,p.isArrayLikeObject=x,p.isBoolean=function(e){return!0===e||!1===e||U(e)&&r(e)==qo},p.isBuffer=_i,p.isDate=W,p.isElement=function(e){return U(e)&&1===e.nodeType&&!Mi(e)},p.isEmpty=function(e){if(null!=e){if(c(e)&&(j(e)||"string"==typeof e||"function"==typeof e.splice||_i(e)||Ii(e)||yi(e)))return!e.length;var t,r=B(e);if(r==$o||r==Ko)return!e.size;if(ln(e))return!Mt(e).length;for(t in e)if(R.call(e,t))return!1}return!0},p.isEqual=function(e,t){return wt(e,t)},p.isEqualWith=function(e,t,r){var n=(r="function"==typeof r?r:Uo)?r(e,t):Uo;return n===Uo?wt(e,t,Uo,r):!!n},p.isError=xi,p.isFinite=function(e){return"number"==typeof e&&ge(e)},p.isFunction=bi,p.isInteger=wi,p.isLength=Ei,p.isMap=Ti,p.isMatch=function(e,t){return e===t||Et(e,t,Yr(t))},p.isMatchWith=function(e,t,r){return r="function"==typeof r?r:Uo,Et(e,t,Yr(t),r)},p.isNaN=function(e){return Si(e)&&e!=+e},p.isNative=function(e){if(sn(e))throw new P("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Tt(e)},p.isNil=function(e){return null==e},p.isNull=function(e){return null===e},p.isNumber=Si,p.isObject=b,p.isObjectLike=U,p.isPlainObject=Mi,p.isRegExp=ki,p.isSafeInteger=function(e){return wi(e)&&-Go<=e&&e<=Go},p.isSet=Ci,p.isString=Ai,p.isSymbol=_,p.isTypedArray=Ii,p.isUndefined=function(e){return e===Uo},p.isWeakMap=function(e){return U(e)&&B(e)==ea},p.isWeakSet=function(e){return U(e)&&"[object WeakSet]"==r(e)},p.join=function(e,t){return null==e?"":ye.call(e,t)},p.kebabCase=ao,p.last=n,p.lastIndexOf=function(e,t,r){var n=null==e?0:e.length;if(!n)return-1;var i=n;if(r!==Uo&&(i=(i=k(r))<0?T(n+i,0):S(i,n-1)),t!=t)return Ns(e,Us,i,!0);for(var o=e,a=t,s=i+1;s--;)if(o[s]===a)return s;return s},p.lowerCase=so,p.lowerFirst=lo,p.lt=Li,p.lte=Pi,p.max=function(e){return e&&e.length?st(e,L,gt):Uo},p.maxBy=function(e,t){return e&&e.length?st(e,h(t,2),gt):Uo},p.mean=function(e){return Vs(e,L)},p.meanBy=function(e,t){return Vs(e,h(t,2))},p.min=function(e){return e&&e.length?st(e,L,Ct):Uo},p.minBy=function(e,t){return e&&e.length?st(e,h(t,2),Ct):Uo},p.stubArray=Lo,p.stubFalse=Po,p.stubObject=function(){return{}},p.stubString=function(){return""},p.stubTrue=function(){return!0},p.multiply=Bo,p.nth=function(e,t){return e&&e.length?zt(e,k(t)):Uo},p.noConflict=function(){return oa._===this&&(oa._=K),this},p.noop=To,p.now=ni,p.pad=function(e,t,r){e=d(e);var n=(t=k(t))?ma(e):0;return!t||t<=n?e:Ir(pe(t=(t-n)/2),r)+e+Ir(de(t),r)},p.padEnd=function(e,t,r){e=d(e);var n=(t=k(t))?ma(e):0;return t&&n<t?e+Ir(t-n,r):e},p.padStart=function(e,t,r){e=d(e);var n=(t=k(t))?ma(e):0;return t&&n<t?Ir(t-n,r)+e:e},p.parseInt=function(e,t,r){return t=r||null==t?0:t&&+t,xe(d(e).replace(Ka,""),t||0)},p.random=function(e,t,r){var n;return r&&"boolean"!=typeof r&&f(e,t,r)&&(t=r=Uo),r===Uo&&("boolean"==typeof t?(r=t,t=Uo):"boolean"==typeof e&&(r=e,e=Uo)),e===Uo&&t===Uo?(e=0,t=1):(e=Di(e),t===Uo?(t=e,e=0):t=Di(t)),t<e&&(n=e,e=t,t=n),r||e%1||t%1?(n=be(),S(e+n*(t-e+bs("1e-"+((n+"").length-1))),t)):Bt(e,t)},p.reduce=function(e,t,r){var n=j(e)?Os:Ws,i=arguments.length<3;return n(e,h(t,4),r,i,it)},p.reduceRight=function(e,t,r){var n=j(e)?Rs:Ws,i=arguments.length<3;return n(e,h(t,4),r,i,ot)},p.repeat=function(e,t,r){return t=(r?f(e,t,r):t===Uo)?1:k(t),Nt(d(e),t)},p.replace=function(){var e=arguments,t=d(e[0]);return e.length<3?t:t.replace(e[1],e[2])},p.result=function(e,t,r){var n=-1,i=(t=or(t,e)).length;for(i||(i=1,e=Uo);++n<i;){var o=null==e?Uo:e[wn(t[n])];o===Uo&&(n=i,o=r),e=bi(o)?o.call(e):o}return e},p.round=No,p.runInContext=i,p.sample=function(e){return(j(e)?We:jt)(e)},p.size=function(e){var t;return null==e?0:c(e)?Ai(e)?ma(e):e.length:(t=B(e))==$o||t==Ko?e.size:Mt(e).length},p.snakeCase=uo,p.some=function(e,t,r){return(j(e)?Fs:Zt)(e,h(t=r&&f(e,t,r)?Uo:t,3))},p.sortedIndex=function(e,t){return qt(e,t)},p.sortedIndexBy=function(e,t,r){return Ht(e,t,h(r,2))},p.sortedIndexOf=function(e,t){var r=null==e?0:e.length;if(r){var n=qt(e,t);if(n<r&&N(e[n],t))return n}return-1},p.sortedLastIndex=function(e,t){return qt(e,t,!0)},p.sortedLastIndexBy=function(e,t,r){return Ht(e,t,h(r,2),!0)},p.sortedLastIndexOf=function(e,t){if(null==e?0:e.length){var r=qt(e,t,!0)-1;if(N(e[r],t))return r}return-1},p.startCase=co,p.startsWith=function(e,t,r){return e=d(e),r=null==r?0:et(k(r),0,e.length),t=u(t),e.slice(r,r+t.length)==t},p.subtract=jo,p.sum=function(e){return e&&e.length?Zs(e,L):0},p.sumBy=function(e,t){return e&&e.length?Zs(e,h(t,2)):0},p.template=function(a,e,t){var s,l,r=p.templateSettings;t&&f(a,e,t)&&(e=Uo),a=d(a),e=Ni({},e,r,Nr);var n=A(t=Ni({},e.imports,r.imports,Nr)),i=$s(t,n),u=0,r=e.interpolate||ds,c="__p += '",t=O((e.escape||ds).source+"|"+r.source+"|"+(r===qa?os:ds).source+"|"+(e.evaluate||ds).source+"|$","g"),o="//# sourceURL="+(R.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++xs+"]")+"\n";if(a.replace(t,function(e,t,r,n,i,o){return r=r||n,c+=a.slice(u,o).replace(ps,el),t&&(s=!0,c+="' +\n__e("+t+") +\n'"),i&&(l=!0,c+="';\n"+i+";\n__p += '"),r&&(c+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),u=o+e.length,e}),c+="';\n",r=R.call(e,"variable")&&e.variable){if(ns.test(r))throw new P("Invalid `variable` option passed into `_.template`")}else c="with (obj) {\n"+c+"\n}\n";if(c=(l?c.replace(Fa,""):c).replace(Ba,"$1").replace(Na,"$1;"),c="function("+(r||"obj")+") {\n"+(r?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(s?", __e = _.escape":"")+(l?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+c+"return __p\n}",(t=mo(function(){return z(n,o+"return "+c).apply(Uo,i)})).source=c,xi(t))throw t;return t},p.times=function(e,t){if((e=k(e))<1||Go<e)return[];for(var r=Wo,n=S(e,Wo),n=(t=h(t),e-=Wo,qs(n,t));++r<e;)t(r);return n},p.toFinite=Di,p.toInteger=k,p.toLength=Oi,p.toLower=function(e){return d(e).toLowerCase()},p.toNumber=C,p.toSafeInteger=function(e){return e?et(k(e),-Go,Go):0===e?e:0},p.toString=d,p.toUpper=function(e){return d(e).toUpperCase()},p.trim=function(e,t,r){return(e=d(e))&&(r||t===Uo)?Hs(e):e&&(t=u(t))?sr(r=ga(e),Ys(r,t=ga(t)),Js(r,t)+1).join(""):e},p.trimEnd=function(e,t,r){return(e=d(e))&&(r||t===Uo)?e.slice(0,il(e)+1):e&&(t=u(t))?sr(r=ga(e),0,Js(r,ga(t))+1).join(""):e},p.trimStart=function(e,t,r){return(e=d(e))&&(r||t===Uo)?e.replace(Ka,""):e&&(t=u(t))?sr(r=ga(e),Ys(r,ga(t))).join(""):e},p.truncate=function(e,t){var r,n=30,i="...",t=(b(t)&&(r="separator"in t?t.separator:r,n="length"in t?k(t.length):n,i="omission"in t?u(t.omission):i),(e=d(e)).length);if((t=da(e)?(o=ga(e)).length:t)<=n)return e;if((t=n-ma(i))<1)return i;var o,n=o?sr(o,0,t).join(""):e.slice(0,t);if(r!==Uo)if(o&&(t+=n.length-t),ki(r)){if(e.slice(t).search(r)){var a,s=n;for((r=r.global?r:O(r.source,d(as.exec(r))+"g")).lastIndex=0;a=r.exec(s);)var l=a.index;n=n.slice(0,l===Uo?t:l)}}else e.indexOf(u(r),t)==t||-1<(o=n.lastIndexOf(r))&&(n=n.slice(0,o));return n+i},p.unescape=function(e){return(e=d(e))&&Va.test(e)?e.replace(ja,ol):e},p.uniqueId=function(e){var t=++$;return d(e)+t},p.upperCase=ho,p.upperFirst=fo,p.each=Xn,p.eachRight=Yn,p.first=Cn,Eo(p,(Fo={},ht(p,function(e,t){R.call(p.prototype,t)||(Fo[t]=e)}),Fo),{chain:!1}),p.VERSION="4.17.21",sa(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){p[e].placeholder=p}),sa(["drop","take"],function(r,n){y.prototype[r]=function(e){e=e===Uo?1:T(k(e),0);var t=this.__filtered__&&!n?new y(this):this.clone();return t.__filtered__?t.__takeCount__=S(e,t.__takeCount__):t.__views__.push({size:S(e,Wo),type:r+(t.__dir__<0?"Right":"")}),t},y.prototype[r+"Right"]=function(e){return this.reverse()[r](e).reverse()}}),sa(["filter","map","takeWhile"],function(e,t){var r=t+1,n=1==r||3==r;y.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:h(e,3),type:r}),t.__filtered__=t.__filtered__||n,t}}),sa(["head","last"],function(e,t){var r="take"+(t?"Right":"");y.prototype[e]=function(){return this[r](1).value()[0]}}),sa(["initial","tail"],function(e,t){var r="drop"+(t?"":"Right");y.prototype[e]=function(){return this.__filtered__?new y(this):this[r](1)}}),y.prototype.compact=function(){return this.filter(L)},y.prototype.find=function(e){return this.filter(e).head()},y.prototype.findLast=function(e){return this.reverse().find(e)},y.prototype.invokeMap=a(function(t,r){return"function"==typeof t?new y(this):this.map(function(e){return xt(e,t,r)})}),y.prototype.reject=function(e){return this.filter(hi(h(e)))},y.prototype.slice=function(e,t){e=k(e);var r=this;return r.__filtered__&&(0<e||t<0)?new y(r):(e<0?r=r.takeRight(-e):e&&(r=r.drop(e)),t!==Uo?(t=k(t))<0?r.dropRight(-t):r.take(t-e):r)},y.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},y.prototype.toArray=function(){return this.take(Wo)},ht(y.prototype,function(u,e){var c=/^(?:filter|find|map|reject)|While$/.test(e),h=/^(?:head|last)$/.test(e),f=p[h?"take"+("last"==e?"Right":""):e],d=h||/^find/.test(e);f&&(p.prototype[e]=function(){function e(e){return e=f.apply(p,ca([e],n)),h&&s?e[0]:e}var t,r=this.__wrapped__,n=h?[1]:arguments,i=r instanceof y,o=n[0],a=i||j(r),s=(a&&c&&"function"==typeof o&&1!=o.length&&(i=a=!1),this.__chain__),o=!!this.__actions__.length,l=d&&!s,i=i&&!o;return!d&&a?(r=i?r:new y(this),(t=u.apply(r,n)).__actions__.push({func:Wn,args:[e],thisArg:Uo}),new g(t,s)):l&&i?u.apply(this,n):(t=this.thru(e),l?h?t.value()[0]:t.value():t)})}),sa(["pop","push","shift","sort","splice","unshift"],function(e){var r=G[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",i=/^(?:pop|shift)$/.test(e);p.prototype[e]=function(){var e,t=arguments;return i&&!this.__chain__?(e=this.value(),r.apply(j(e)?e:[],t)):this[n](function(e){return r.apply(j(e)?e:[],t)})}}),ht(y.prototype,function(e,t){var r,n=p[t];n&&(r=n.name+"",R.call(Ce,r)||(Ce[r]=[]),Ce[r].push({name:t,func:n}))}),Ce[Mr(Uo,2).name]=[{name:"wrapper",func:Uo}],y.prototype.clone=function(){var e=new y(this.__wrapped__);return e.__actions__=M(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=M(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=M(this.__views__),e},y.prototype.reverse=function(){var e;return this.__filtered__?((e=new y(this)).__dir__=-1,e.__filtered__=!0):(e=this.clone()).__dir__*=-1,e},y.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,r=j(e),n=t<0,i=r?e.length:0,o=function(e,t,r){var n=-1,i=r.length;for(;++n<i;){var o=r[n],a=o.size;switch(o.type){case"drop":e+=a;break;case"dropRight":t-=a;break;case"take":t=S(t,e+a);break;case"takeRight":e=T(e,t-a)}}return{start:e,end:t}}(0,i,this.__views__),a=o.start,s=(o=o.end)-a,l=n?o:a-1,u=this.__iteratees__,c=u.length,h=0,f=S(s,this.__takeCount__);if(!r||!n&&i==s&&f==s)return er(e,this.__actions__);var d=[];e:for(;s--&&h<f;){for(var p=-1,m=e[l+=t];++p<c;){var g=u[p],y=g.iteratee,g=g.type,y=y(m);if(2==g)m=y;else if(!y){if(1==g)continue e;break e}}d[h++]=m}return d},p.prototype.at=Zn,p.prototype.chain=function(){return Gn(this)},p.prototype.commit=function(){return new g(this.value(),this.__chain__)},p.prototype.next=function(){this.__values__===Uo&&(this.__values__=zi(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?Uo:this.__values__[this.__index__++]}},p.prototype.plant=function(e){for(var t,r=this;r instanceof Be;)var n=Tn(r),i=(n.__index__=0,n.__values__=Uo,t?i.__wrapped__=n:t=n,n),r=r.__wrapped__;return i.__wrapped__=e,t},p.prototype.reverse=function(){var e=this.__wrapped__;return e instanceof y?(e=e,(e=(e=this.__actions__.length?new y(this):e).reverse()).__actions__.push({func:Wn,args:[Ln],thisArg:Uo}),new g(e,this.__chain__)):this.thru(Ln)},p.prototype.toJSON=p.prototype.valueOf=p.prototype.value=function(){return er(this.__wrapped__,this.__actions__)},p.prototype.first=p.prototype.head,se&&(p.prototype[se]=function(){return this}),p}();i?((i.exports=ya)._=ya,n._=ya):oa._=ya}.call(Ht),"top"),de="bottom",pe="right",me="left",ge="auto",ye=[fe,de,pe,me],ve="start",_e="end",xe="clippingParents",be="viewport",we="popper",Ee="reference",Te=ye.reduce(function(e,t){return e.concat([t+"-"+ve,t+"-"+_e])},[]),Se=[].concat(ye,[ge]).reduce(function(e,t){return e.concat([t,t+"-"+ve,t+"-"+_e])},[]),i="beforeRead",o="read",a="afterRead",s="beforeMain",l="main",u="afterMain",c="beforeWrite",h="afterWrite",Me=[i,o,a,s,l,u,c,"write",h];function ke(e){return e?(e.nodeName||"").toLowerCase():null}function Ce(e){var t;return null==e?window:"[object Window]"!==e.toString()?(t=e.ownerDocument)&&t.defaultView||window:e}function Ae(e){return e instanceof Ce(e).Element||e instanceof Element}function Ie(e){return e instanceof Ce(e).HTMLElement||e instanceof HTMLElement}function Le(e){return"undefined"!=typeof ShadowRoot&&(e instanceof Ce(e).ShadowRoot||e instanceof ShadowRoot)}var f={name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var i=e.state;Object.keys(i.elements).forEach(function(e){var t=i.styles[e]||{},r=i.attributes[e]||{},n=i.elements[e];Ie(n)&&ke(n)&&(Object.assign(n.style,t),Object.keys(r).forEach(function(e){var t=r[e];!1===t?n.removeAttribute(e):n.setAttribute(e,!0===t?"":t)}))})},effect:function(e){var n=e.state,i={popper:{position:n.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(n.elements.popper.style,i.popper),n.styles=i,n.elements.arrow&&Object.assign(n.elements.arrow.style,i.arrow),function(){Object.keys(n.elements).forEach(function(e){var t=n.elements[e],r=n.attributes[e]||{},e=Object.keys((n.styles.hasOwnProperty(e)?n.styles:i)[e]).reduce(function(e,t){return e[t]="",e},{});Ie(t)&&ke(t)&&(Object.assign(t.style,e),Object.keys(r).forEach(function(e){t.removeAttribute(e)}))})}},requires:["computeStyles"]},Pe="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function ze(){throw new Error("setTimeout has not been defined")}function De(){throw new Error("clearTimeout has not been defined")}var Oe=ze,Re=De;function Fe(t){if(Oe===setTimeout)return setTimeout(t,0);if((Oe===ze||!Oe)&&setTimeout)return(Oe=setTimeout)(t,0);try{return Oe(t,0)}catch(e){try{return Oe.call(null,t,0)}catch(e){return Oe.call(this,t,0)}}}"function"==typeof Pe.setTimeout&&(Oe=setTimeout),"function"==typeof Pe.clearTimeout&&(Re=clearTimeout);var Be,Ne=[],je=!1,Ue=-1;function Ve(){je&&Be&&(je=!1,Be.length?Ne=Be.concat(Ne):Ue=-1,Ne.length&&Ge())}function Ge(){if(!je){for(var e=Fe(Ve),t=(je=!0,Ne.length);t;){for(Be=Ne,Ne=[];++Ue<t;)Be&&Be[Ue].run();Ue=-1,t=Ne.length}Be=null,je=!1,!function(t){if(Re===clearTimeout)return clearTimeout(t);if((Re===De||!Re)&&clearTimeout)return(Re=clearTimeout)(t);try{Re(t)}catch(e){try{return Re.call(null,t)}catch(e){return Re.call(this,t)}}}(e)}}function We(e,t){this.fun=e,this.array=t}We.prototype.run=function(){this.fun.apply(null,this.array)};function Ze(){}var qe=Ze,d=Ze,p=Ze,m=Ze,g=Ze,y=Ze,v=Ze;var He=Pe.performance||{},$e=He.now||He.mozNow||He.msNow||He.oNow||He.webkitNow||function(){return(new Date).getTime()};var Xe=new Date;var $d={nextTick:function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];Ne.push(new We(e,t)),1!==Ne.length||je||Fe(Ge)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:qe,addListener:d,once:p,off:m,removeListener:g,removeAllListeners:y,emit:v,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*$e.call(He),r=Math.floor(t),t=Math.floor(t%1*1e9);return e&&(r-=e[0],(t-=e[1])<0&&(r--,t+=1e9)),[r,t]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-Xe)/1e3}};function Ye(e){return e.split("-")[0]}var Je=Math.max,Ke=Math.min,Qe=Math.round;function et(){var e=navigator.userAgentData;return null!=e&&e.brands?e.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function tt(){return!/^((?!chrome|android).)*safari/i.test(et())}function rt(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=!1);var n=e.getBoundingClientRect(),i=1,o=1;t&&Ie(e)&&(i=0<e.offsetWidth&&Qe(n.width)/e.offsetWidth||1,o=0<e.offsetHeight&&Qe(n.height)/e.offsetHeight||1);t=(Ae(e)?Ce(e):window).visualViewport,e=!tt()&&r,r=(n.left+(e&&t?t.offsetLeft:0))/i,e=(n.top+(e&&t?t.offsetTop:0))/o,t=n.width/i,i=n.height/o;return{width:t,height:i,top:e,right:r+t,bottom:e+i,left:r,x:r,y:e}}function nt(e){var t=rt(e),r=e.offsetWidth,n=e.offsetHeight;return Math.abs(t.width-r)<=1&&(r=t.width),Math.abs(t.height-n)<=1&&(n=t.height),{x:e.offsetLeft,y:e.offsetTop,width:r,height:n}}function it(e,t){var r=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(r&&Le(r)){var n=t;do{if(n&&e.isSameNode(n))return!0}while(n=n.parentNode||n.host)}return!1}function ot(e){return Ce(e).getComputedStyle(e)}function at(e){return((Ae(e)?e.ownerDocument:e.document)||window.document).documentElement}function st(e){return"html"===ke(e)?e:e.assignedSlot||e.parentNode||(Le(e)?e.host:null)||at(e)}function lt(e){return Ie(e)&&"fixed"!==ot(e).position?e.offsetParent:null}function ut(e){for(var t,r=Ce(e),n=lt(e);n&&(t=n,0<=["table","td","th"].indexOf(ke(t))&&"static"===ot(n).position);)n=lt(n);return(!n||"html"!==ke(n)&&("body"!==ke(n)||"static"!==ot(n).position))&&(n||function(e){var t=/firefox/i.test(et()),r=/Trident/i.test(et());if(!r||!Ie(e)||"fixed"!==ot(e).position){var n=st(e);for(Le(n)&&(n=n.host);Ie(n)&&["html","body"].indexOf(ke(n))<0;){var i=ot(n);if("none"!==i.transform||"none"!==i.perspective||"paint"===i.contain||-1!==["transform","perspective"].indexOf(i.willChange)||t&&"filter"===i.willChange||t&&i.filter&&"none"!==i.filter)return n;n=n.parentNode}}return null}(e))||r}function ct(e){return 0<=["top","bottom"].indexOf(e)?"x":"y"}function ht(e,t,r){return Je(e,Ke(t,r))}function ft(){return{top:0,right:0,bottom:0,left:0}}function dt(e){return Object.assign({},ft(),e)}function pt(r,e){return e.reduce(function(e,t){return e[t]=r,e},{})}qe={name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,r,n,i,o=e.state,a=e.name,e=e.options,s=o.elements.arrow,l=o.modifiersData.popperOffsets,u=ct(c=Ye(o.placement)),c=0<=[me,pe].indexOf(c)?"height":"width";s&&l&&(e=e.padding,r=o,r=dt("number"!=typeof(e="function"==typeof e?e(Object.assign({},r.rects,{placement:r.placement})):e)?e:pt(e,ye)),e=nt(s),i="y"===u?fe:me,n="y"===u?de:pe,t=o.rects.reference[c]+o.rects.reference[u]-l[u]-o.rects.popper[c],l=l[u]-o.rects.reference[u],s=(s=ut(s))?"y"===u?s.clientHeight||0:s.clientWidth||0:0,i=r[i],r=s-e[c]-r[n],i=ht(i,n=s/2-e[c]/2+(t/2-l/2),r),o.modifiersData[a]=((s={})[u]=i,s.centerOffset=i-n,s))},effect:function(e){var t=e.state;null==(e=void 0===(e=e.options.element)?"[data-popper-arrow]":e)||"string"==typeof e&&!(e=t.elements.popper.querySelector(e))||("production"===$d.env.NODE_ENV||Ie(e)||console.error(['Popper: "arrow" element must be an HTMLElement (not an SVGElement).',"To use an SVG arrow, wrap it in an HTMLElement that will be used as","the arrow."].join(" ")),it(t.elements.popper,e)?t.elements.arrow=e:"production"!==$d.env.NODE_ENV&&console.error(['Popper: "arrow" modifier\'s `element` must be a child of the popper',"element."].join(" ")))},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function mt(e){return e.split("-")[1]}var gt={top:"auto",right:"auto",bottom:"auto",left:"auto"};function yt(e){var t,r,n,i=e.popper,o=e.popperRect,a=e.placement,s=e.variation,l=e.offsets,u=e.position,c=e.gpuAcceleration,h=e.adaptive,f=e.roundOffsets,e=e.isFixed,d=l.x,d=void 0===d?0:d,p=l.y,p=void 0===p?0:p,m="function"==typeof f?f({x:d,y:p}):{x:d,y:p},m=(d=m.x,p=m.y,l.hasOwnProperty("x")),l=l.hasOwnProperty("y"),g=me,y=fe,v=window,i=(h&&(r="clientHeight",t="clientWidth",(n=ut(i))===Ce(i)&&"static"!==ot(n=at(i)).position&&"absolute"===u&&(r="scrollHeight",t="scrollWidth"),a!==fe&&(a!==me&&a!==pe||s!==_e)||(y=de,p=(p-((e&&n===v&&v.visualViewport?v.visualViewport.height:n[r])-o.height))*(c?1:-1)),a!==me&&(a!==fe&&a!==de||s!==_e)||(g=pe,d=(d-((e&&n===v&&v.visualViewport?v.visualViewport.width:n[t])-o.width))*(c?1:-1))),Object.assign({position:u},h&&gt)),e=!0===f?(a=(r={x:d,y:p}).x,r=r.y,s=window.devicePixelRatio||1,{x:Qe(a*s)/s||0,y:Qe(r*s)/s||0}):{x:d,y:p};return d=e.x,p=e.y,c?Object.assign({},i,((n={})[y]=l?"0":"",n[g]=m?"0":"",n.transform=(v.devicePixelRatio||1)<=1?"translate("+d+"px, "+p+"px)":"translate3d("+d+"px, "+p+"px, 0)",n)):Object.assign({},i,((t={})[y]=l?p+"px":"",t[g]=m?d+"px":"",t.transform="",t))}var d={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t,r=e.state,e=e.options,n=void 0===(n=e.gpuAcceleration)||n,i=void 0===(i=e.adaptive)||i,e=void 0===(e=e.roundOffsets)||e,n=("production"!==$d.env.NODE_ENV&&(t=ot(r.elements.popper).transitionProperty||"",i&&["transform","top","right","bottom","left"].some(function(e){return 0<=t.indexOf(e)})&&console.warn(["Popper: Detected CSS transitions on at least one of the following",'CSS properties: "transform", "top", "right", "bottom", "left".',"\n\n",'Disable the "computeStyles" modifier\'s `adaptive` option to allow',"for smooth transitions, or remove these properties from the CSS","transition declaration on the popper element if only transitioning","opacity or background-color for example.","\n\n","We recommend using the popper element as a wrapper around an inner","element that can have any CSS property transitioned for animations."].join(" "))),{placement:Ye(r.placement),variation:mt(r.placement),popper:r.elements.popper,popperRect:r.rects.popper,gpuAcceleration:n,isFixed:"fixed"===r.options.strategy});null!=r.modifiersData.popperOffsets&&(r.styles.popper=Object.assign({},r.styles.popper,yt(Object.assign({},n,{offsets:r.modifiersData.popperOffsets,position:r.options.strategy,adaptive:i,roundOffsets:e})))),null!=r.modifiersData.arrow&&(r.styles.arrow=Object.assign({},r.styles.arrow,yt(Object.assign({},n,{offsets:r.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:e})))),r.attributes.popper=Object.assign({},r.attributes.popper,{"data-popper-placement":r.placement})},data:{}},vt={passive:!0};var p={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,r=e.instance,n=(e=e.options).scroll,i=void 0===n||n,o=void 0===(n=e.resize)||n,a=Ce(t.elements.popper),s=[].concat(t.scrollParents.reference,t.scrollParents.popper);return i&&s.forEach(function(e){e.addEventListener("scroll",r.update,vt)}),o&&a.addEventListener("resize",r.update,vt),function(){i&&s.forEach(function(e){e.removeEventListener("scroll",r.update,vt)}),o&&a.removeEventListener("resize",r.update,vt)}},data:{}},_t={left:"right",right:"left",bottom:"top",top:"bottom"};function xt(e){return e.replace(/left|right|bottom|top/g,function(e){return _t[e]})}var bt={start:"end",end:"start"};function wt(e){return e.replace(/start|end/g,function(e){return bt[e]})}function Et(e){e=Ce(e);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function Tt(e){return rt(at(e)).left+Et(e).scrollLeft}function St(e){var e=ot(e),t=e.overflow,r=e.overflowX,e=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+e+r)}function Mt(e,t){void 0===t&&(t=[]);var r=function e(t){return 0<=["html","body","#document"].indexOf(ke(t))?t.ownerDocument.body:Ie(t)&&St(t)?t:e(st(t))}(e),e=r===(null==(e=e.ownerDocument)?void 0:e.body),n=Ce(r),n=e?[n].concat(n.visualViewport||[],St(r)?r:[]):r,r=t.concat(n);return e?r:r.concat(Mt(st(n)))}function kt(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function Ct(e,t,r){return t===be?kt((i=r,a=Ce(n=e),s=at(n),a=a.visualViewport,l=s.clientWidth,s=s.clientHeight,c=u=0,a&&(l=a.width,s=a.height,((o=tt())||!o&&"fixed"===i)&&(u=a.offsetLeft,c=a.offsetTop)),{width:l,height:s,x:u+Tt(n),y:c})):Ae(t)?((i=rt(o=t,!1,"fixed"===(i=r))).top=i.top+o.clientTop,i.left=i.left+o.clientLeft,i.bottom=i.top+o.clientHeight,i.right=i.left+o.clientWidth,i.width=o.clientWidth,i.height=o.clientHeight,i.x=i.left,i.y=i.top,i):kt((a=at(e),l=at(a),s=Et(a),u=null==(u=a.ownerDocument)?void 0:u.body,n=Je(l.scrollWidth,l.clientWidth,u?u.scrollWidth:0,u?u.clientWidth:0),c=Je(l.scrollHeight,l.clientHeight,u?u.scrollHeight:0,u?u.clientHeight:0),a=-s.scrollLeft+Tt(a),s=-s.scrollTop,"rtl"===ot(u||l).direction&&(a+=Je(l.clientWidth,u?u.clientWidth:0)-n),{width:n,height:c,x:a,y:s}));var n,i,o,a,s,l,u,c}function At(r,e,t,n){var i,o="clippingParents"===e?(a=Mt(st(o=r)),Ae(i=0<=["absolute","fixed"].indexOf(ot(o).position)&&Ie(o)?ut(o):o)?a.filter(function(e){return Ae(e)&&it(e,i)&&"body"!==ke(e)}):[]):[].concat(e),a=[].concat(o,[t]),e=a[0],t=a.reduce(function(e,t){t=Ct(r,t,n);return e.top=Je(t.top,e.top),e.right=Ke(t.right,e.right),e.bottom=Ke(t.bottom,e.bottom),e.left=Je(t.left,e.left),e},Ct(r,e,n));return t.width=t.right-t.left,t.height=t.bottom-t.top,t.x=t.left,t.y=t.top,t}function It(e){var t,r=e.reference,n=e.element,e=e.placement,i=e?Ye(e):null,e=e?mt(e):null,o=r.x+r.width/2-n.width/2,a=r.y+r.height/2-n.height/2;switch(i){case fe:t={x:o,y:r.y-n.height};break;case de:t={x:o,y:r.y+r.height};break;case pe:t={x:r.x+r.width,y:a};break;case me:t={x:r.x-n.width,y:a};break;default:t={x:r.x,y:r.y}}var s=i?ct(i):null;if(null!=s){var l="y"===s?"height":"width";switch(e){case ve:t[s]=t[s]-(r[l]/2-n[l]/2);break;case _e:t[s]=t[s]+(r[l]/2-n[l]/2)}}return t}function Lt(e,t){var n,t=t=void 0===t?{}:t,r=t.placement,r=void 0===r?e.placement:r,i=t.strategy,i=void 0===i?e.strategy:i,o=t.boundary,o=void 0===o?xe:o,a=t.rootBoundary,a=void 0===a?be:a,s=t.elementContext,s=void 0===s?we:s,l=t.altBoundary,l=void 0!==l&&l,t=t.padding,t=void 0===t?0:t,t=dt("number"!=typeof t?t:pt(t,ye)),u=e.rects.popper,l=e.elements[l?s===we?Ee:we:s],l=At(Ae(l)?l:l.contextElement||at(e.elements.popper),o,a,i),o=rt(e.elements.reference),a=It({reference:o,element:u,strategy:"absolute",placement:r}),i=kt(Object.assign({},u,a)),u=s===we?i:o,c={top:l.top-u.top+t.top,bottom:u.bottom-l.bottom+t.bottom,left:l.left-u.left+t.left,right:u.right-l.right+t.right},a=e.modifiersData.offset;return s===we&&a&&(n=a[r],Object.keys(c).forEach(function(e){var t=0<=[pe,de].indexOf(e)?1:-1,r=0<=[fe,de].indexOf(e)?"y":"x";c[e]+=n[r]*t})),c}m={name:"flip",enabled:!0,phase:"main",fn:function(e){var h=e.state,t=e.options,e=e.name;if(!h.modifiersData[e]._skip){for(var r=t.mainAxis,n=void 0===r||r,r=t.altAxis,i=void 0===r||r,r=t.fallbackPlacements,f=t.padding,d=t.boundary,p=t.rootBoundary,o=t.altBoundary,a=t.flipVariations,m=void 0===a||a,g=t.allowedAutoPlacements,a=h.options.placement,t=Ye(a),r=r||(t===a||!m?[xt(a)]:Ye(r=a)===ge?[]:(t=xt(r),[wt(r),t,wt(t)])),s=[a].concat(r).reduce(function(e,t){return e.concat(Ye(t)===ge?(r=h,n=(e=e=void 0===(e={placement:t,boundary:d,rootBoundary:p,padding:f,flipVariations:m,allowedAutoPlacements:g})?{}:e).placement,i=e.boundary,o=e.rootBoundary,a=e.padding,s=e.flipVariations,l=void 0===(e=e.allowedAutoPlacements)?Se:e,u=mt(n),e=u?s?Te:Te.filter(function(e){return mt(e)===u}):ye,0===(n=e.filter(function(e){return 0<=l.indexOf(e)})).length&&(n=e,"production"!==$d.env.NODE_ENV&&console.error(["Popper: The `allowedAutoPlacements` option did not allow any","placements. Ensure the `placement` option matches the variation","of the allowed placements.",'For example, "auto" cannot be used to allow "bottom-start".','Use "auto-start" instead.'].join(" "))),c=n.reduce(function(e,t){return e[t]=Lt(r,{placement:t,boundary:i,rootBoundary:o,padding:a})[Ye(t)],e},{}),Object.keys(c).sort(function(e,t){return c[e]-c[t]})):t);var r,n,i,o,a,s,l,u,c},[]),l=h.rects.reference,u=h.rects.popper,c=new Map,y=!0,v=s[0],_=0;_<s.length;_++){var x=s[_],b=Ye(x),w=mt(x)===ve,E=0<=[fe,de].indexOf(b),T=E?"width":"height",S=Lt(h,{placement:x,boundary:d,rootBoundary:p,altBoundary:o,padding:f}),E=E?w?pe:me:w?de:fe,w=(l[T]>u[T]&&(E=xt(E)),xt(E)),T=[];if(n&&T.push(S[b]<=0),i&&T.push(S[E]<=0,S[w]<=0),T.every(function(e){return e})){v=x,y=!1;break}c.set(x,T)}if(y)for(var M=m?3:1;0<M;M--)if("break"===function(t){var e=s.find(function(e){e=c.get(e);if(e)return e.slice(0,t).every(function(e){return e})});if(e)return v=e,"break"}(M))break;h.placement!==v&&(h.modifiersData[e]._skip=!0,h.placement=v,h.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function Pt(e,t,r){return{top:e.top-t.height-(r=void 0===r?{x:0,y:0}:r).y,right:e.right-t.width+r.x,bottom:e.bottom-t.height+r.y,left:e.left-t.width-r.x}}function zt(t){return[fe,pe,de,me].some(function(e){return 0<=t[e]})}g={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,e=e.name,r=t.rects.reference,n=t.rects.popper,i=t.modifiersData.preventOverflow,o=Lt(t,{elementContext:"reference"}),a=Lt(t,{altBoundary:!0}),o=Pt(o,r),r=Pt(a,n,i),a=zt(o),n=zt(r);t.modifiersData[e]={referenceClippingOffsets:o,popperEscapeOffsets:r,isReferenceHidden:a,hasPopperEscaped:n},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":a,"data-popper-escaped":n})}};y={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var a=e.state,t=e.options,e=e.name,s=void 0===(t=t.offset)?[0,0]:t,t=Se.reduce(function(e,t){var r,n,i,o;return e[t]=(t=t,r=a.rects,n=s,i=Ye(t),o=0<=[me,fe].indexOf(i)?-1:1,t=(r="function"==typeof n?n(Object.assign({},r,{placement:t})):n)[0]||0,n=(r[1]||0)*o,0<=[me,pe].indexOf(i)?{x:n,y:t}:{x:t,y:n}),e},{}),r=(n=t[a.placement]).x,n=n.y;null!=a.modifiersData.popperOffsets&&(a.modifiersData.popperOffsets.x+=r,a.modifiersData.popperOffsets.y+=n),a.modifiersData[e]=t}};v={name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,e=e.name;t.modifiersData[e]=It({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}};var Dt={name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t,r,n,i,o,a,s,l,u,c=e.state,h=e.options,e=e.name,f=void 0===(f=h.mainAxis)||f,d=void 0!==(d=h.altAxis)&&d,p=h.boundary,m=h.rootBoundary,g=h.altBoundary,y=h.padding,v=void 0===(v=h.tether)||v,h=void 0===(h=h.tetherOffset)?0:h,p=Lt(c,{boundary:p,rootBoundary:m,padding:y,altBoundary:g}),m=Ye(c.placement),g=!(y=mt(c.placement)),_=ct(m),x="x"===_?"y":"x",b=c.modifiersData.popperOffsets,w=c.rects.reference,E=c.rects.popper,h="number"==typeof(h="function"==typeof h?h(Object.assign({},c.rects,{placement:c.placement})):h)?{mainAxis:h,altAxis:h}:Object.assign({mainAxis:0,altAxis:0},h),T=c.modifiersData.offset?c.modifiersData.offset[c.placement]:null,S={x:0,y:0};b&&(f&&(f="y"===_?"height":"width",a=(s=b[_])+p[r="y"===_?fe:me],l=s-p[u="y"===_?de:pe],t=v?-E[f]/2:0,i=(y===ve?w:E)[f],y=y===ve?-E[f]:-w[f],o=c.elements.arrow,o=v&&o?nt(o):{width:0,height:0},r=(n=c.modifiersData["arrow#persistent"]?c.modifiersData["arrow#persistent"].padding:ft())[r],n=n[u],u=ht(0,w[f],o[f]),o=g?w[f]/2-t-u-r-h.mainAxis:i-u-r-h.mainAxis,i=g?-w[f]/2+t+u+n+h.mainAxis:y+u+n+h.mainAxis,g=(r=c.elements.arrow&&ut(c.elements.arrow))?"y"===_?r.clientTop||0:r.clientLeft||0:0,y=s+i-(t=null!=(f=null==T?void 0:T[_])?f:0),u=ht(v?Ke(a,s+o-t-g):a,s,v?Je(l,y):l),b[_]=u,S[_]=u-s),d&&(n="y"==x?"height":"width",i=(r=b[x])+p["x"===_?fe:me],f=r-p["x"===_?de:pe],o=-1!==[fe,me].indexOf(m),g=null!=(t=null==T?void 0:T[x])?t:0,a=o?i:r-w[n]-E[n]-g+h.altAxis,y=o?r+w[n]+E[n]-g-h.altAxis:f,s=v&&o?(l=ht(l=a,r,u=y),u<l?u:l):ht(v?a:i,r,v?y:f),b[x]=s,S[x]=s-r),c.modifiersData[e]=S)},requiresIfExists:["offset"]};function Ot(e,t,r){void 0===r&&(r=!1);var n=Ie(t),i=Ie(t)&&(a=(i=t).getBoundingClientRect(),o=Qe(a.width)/i.offsetWidth||1,a=Qe(a.height)/i.offsetHeight||1,1!==o||1!==a),o=at(t),a=rt(e,i,r),e={scrollLeft:0,scrollTop:0},s={x:0,y:0};return!n&&r||("body"===ke(t)&&!St(o)||(e=(n=t)!==Ce(n)&&Ie(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:Et(n)),Ie(t)?((s=rt(t,!0)).x+=t.clientLeft,s.y+=t.clientTop):o&&(s.x=Tt(o))),{x:a.left+e.scrollLeft-s.x,y:a.top+e.scrollTop-s.y,width:a.width,height:a.height}}function Rt(e){var r=new Map,n=new Set,i=[];return e.forEach(function(e){r.set(e.name,e)}),e.forEach(function(e){n.has(e.name)||!function t(e){n.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach(function(e){n.has(e)||(e=r.get(e))&&t(e)}),i.push(e)}(e)}),i}function Ft(e){for(var t=arguments.length,r=new Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return[].concat(r).reduce(function(e,t){return e.replace(/%s/,t)},e)}var Bt='Popper: modifier "%s" provided an invalid %s property, expected %s but got %s',Nt='Popper: modifier "%s" requires "%s", but "%s" modifier is not available',jt=["name","enabled","phase","fn","effect","requires","options"];var Ut="Popper: Invalid reference or popper argument provided. They must be either a DOM element or virtual element.",Vt={placement:"bottom",modifiers:[],strategy:"absolute"};function Gt(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return!t.some(function(e){return!(e&&"function"==typeof e.getBoundingClientRect)})}function Wt(e){var e=e=void 0===e?{}:e,t=e.defaultModifiers,d=void 0===t?[]:t,t=e.defaultOptions,p=void 0===t?Vt:t;return function(a,s,t){void 0===t&&(t=p);var r,n,l={placement:"bottom",orderedModifiers:[],options:Object.assign({},Vt,p),modifiersData:{},elements:{reference:a,popper:s},attributes:{},styles:{}},u=[],c=!1,h={state:l,setOptions:function(e){var r,t,n,i,o,e="function"==typeof e?e(l.options):e,e=(f(),l.options=Object.assign({},p,l.options,e),l.scrollParents={reference:Ae(a)?Mt(a):a.contextElement?Mt(a.contextElement):[],popper:Mt(s)},e=[].concat(d,l.options.modifiers),t=e.reduce(function(e,t){var r=e[t.name];return e[t.name]=r?Object.assign({},r,t,{options:Object.assign({},r.options,t.options),data:Object.assign({},r.data,t.data)}):t,e},{}),e=Object.keys(t).map(function(e){return t[e]}),r=Rt(e),Me.reduce(function(e,t){return e.concat(r.filter(function(e){return e.phase===t}))},[]));return l.orderedModifiers=e.filter(function(e){return e.enabled}),"production"!==$d.env.NODE_ENV&&(e=[].concat(e,l.options.modifiers),i=function(e){return e.name},o=new Set,e=e.filter(function(e){e=i(e);if(!o.has(e))return o.add(e),!0}),(n=e).forEach(function(r){[].concat(Object.keys(r),jt).filter(function(e,t,r){return r.indexOf(e)===t}).forEach(function(e){switch(e){case"name":"string"!=typeof r.name&&console.error(Ft(Bt,String(r.name),'"name"','"string"','"'+String(r.name)+'"'));break;case"enabled":"boolean"!=typeof r.enabled&&console.error(Ft(Bt,r.name,'"enabled"','"boolean"','"'+String(r.enabled)+'"'));break;case"phase":Me.indexOf(r.phase)<0&&console.error(Ft(Bt,r.name,'"phase"',"either "+Me.join(", "),'"'+String(r.phase)+'"'));break;case"fn":"function"!=typeof r.fn&&console.error(Ft(Bt,r.name,'"fn"','"function"','"'+String(r.fn)+'"'));break;case"effect":null!=r.effect&&"function"!=typeof r.effect&&console.error(Ft(Bt,r.name,'"effect"','"function"','"'+String(r.fn)+'"'));break;case"requires":null==r.requires||Array.isArray(r.requires)||console.error(Ft(Bt,r.name,'"requires"','"array"','"'+String(r.requires)+'"'));break;case"requiresIfExists":Array.isArray(r.requiresIfExists)||console.error(Ft(Bt,r.name,'"requiresIfExists"','"array"','"'+String(r.requiresIfExists)+'"'));break;case"options":case"data":break;default:console.error('PopperJS: an invalid property has been provided to the "'+r.name+'" modifier, valid properties are '+jt.map(function(e){return'"'+e+'"'}).join(", ")+'; but "'+e+'" was provided.')}r.requires&&r.requires.forEach(function(t){null==n.find(function(e){return e.name===t})&&console.error(Ft(Nt,String(r.name),t,t))})})}),Ye(l.options.placement)!==ge||l.orderedModifiers.find(function(e){return"flip"===e.name})||console.error(['Popper: "auto" placements require the "flip" modifier be',"present and enabled to work."].join(" ")),[(e=ot(s)).marginTop,e.marginRight,e.marginBottom,e.marginLeft].some(function(e){return parseFloat(e)})&&console.warn(['Popper: CSS "margin" styles cannot be used to apply padding',"between the popper and its reference element or boundary.","To replicate margin, use the `offset` modifier, as well as","the `padding` option in the `preventOverflow` and `flip`","modifiers."].join(" "))),l.orderedModifiers.forEach(function(e){var t=e.name,r=e.options,e=e.effect;"function"==typeof e&&(e=e({state:l,name:t,instance:h,options:void 0===r?{}:r}),u.push(e||function(){}))}),h.update()},forceUpdate:function(){if(!c){var e=l.elements,t=e.reference,e=e.popper;if(Gt(t,e)){l.rects={reference:Ot(t,ut(e),"fixed"===l.options.strategy),popper:nt(e)},l.reset=!1,l.placement=l.options.placement,l.orderedModifiers.forEach(function(e){return l.modifiersData[e.name]=Object.assign({},e.data)});for(var r,n,i,o=0,a=0;a<l.orderedModifiers.length;a++){if("production"!==$d.env.NODE_ENV&&100<(o+=1)){console.error("Popper: An infinite loop in the modifiers cycle has been detected! The cycle has been interrupted to prevent a browser crash.");break}!0===l.reset?(l.reset=!1,a=-1):(r=(i=l.orderedModifiers[a]).fn,n=i.options,i=i.name,"function"==typeof r&&(l=r({state:l,options:void 0===n?{}:n,name:i,instance:h})||l))}}else"production"!==$d.env.NODE_ENV&&console.error(Ut)}},update:(r=function(){return new Promise(function(e){h.forceUpdate(),e(l)})},function(){return n=n||new Promise(function(e){Promise.resolve().then(function(){n=void 0,e(r())})})}),destroy:function(){f(),c=!0}};return Gt(a,s)?h.setOptions(t).then(function(e){!c&&t.onFirstUpdate&&t.onFirstUpdate(e)}):"production"!==$d.env.NODE_ENV&&console.error(Ut),h;function f(){u.forEach(function(e){return e()}),u=[]}}}function Zt(e){var t;return e&&e.type&&(t=qt[e.type])?"geometry"===t?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:e}]}:"feature"===t?{type:"FeatureCollection",features:[e]}:"featurecollection"===t?e:void 0:null}var i=O(Object.freeze({__proto__:null,popperGenerator:Wt,detectOverflow:Lt,createPopperBase:Wt(),createPopper:Wt({defaultModifiers:[p,v,d,f,y,m,Dt,qe,g]}),createPopperLite:Wt({defaultModifiers:[p,v,d,f]}),top:fe,bottom:de,right:pe,left:me,auto:ge,basePlacements:ye,start:ve,end:_e,clippingParents:xe,viewport:be,popper:we,reference:Ee,variationPlacements:Te,placements:Se,beforeRead:i,read:o,afterRead:a,beforeMain:s,main:l,afterMain:u,beforeWrite:c,write:"write",afterWrite:h,modifierPhases:Me,applyStyles:f,arrow:qe,computeStyles:d,eventListeners:p,flip:m,hide:g,offset:y,popperOffsets:v,preventOverflow:Dt})),qt={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};o={exports:{}};o.exports=function(){var e=navigator.userAgent,a=navigator.platform,B=/gecko\/\d/i.test(e),s=/MSIE \d/.test(e),c=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(e),N=/Edge\/(\d+)/.exec(e),T=s||c||N,b=T&&(s?document.documentMode||6:+(N||c)[1]),g=!N&&/WebKit\//.test(e),j=g&&/Qt\/\d+\.\d+/.test(e),U=!N&&/Chrome\/(\d+)/.exec(e),V=U&&+U[1],G=/Opera\//.test(e),W=/Apple Computer/.test(navigator.vendor),q=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(e),H=/PhantomJS/.test(e),$=W&&(/Mobile\/\w+/.test(e)||navigator.maxTouchPoints>2),X=/Android/.test(e),Y=$||X||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(e),y=$||/Mac/.test(a),J=/\bCrOS\b/.test(e),K=/win/i.test(a),Q=G&&e.match(/Version\/(\d*\.\d*)/);if(Q)Q=Number(Q[1]);if(Q&&Q>=15){G=false;g=true}var ee=y&&(j||G&&(Q==null||Q<12.11)),te=B||T&&b>=9;function re(e){return new RegExp("(^|\\s)"+e+"(?:$|\\s)\\s*")}var ne=function(e,t){var r=e.className;var n=re(t).exec(r);if(n){var i=r.slice(n.index+n[0].length);e.className=r.slice(0,n.index)+(i?n[1]+i:"")}},ie;function oe(e){for(var t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild);return e}function o(e,t){return oe(e).appendChild(t)}function w(e,t,r,n){var i=document.createElement(e);if(r)i.className=r;if(n)i.style.cssText=n;if(typeof t=="string")i.appendChild(document.createTextNode(t));else if(t)for(var o=0;o<t.length;++o)i.appendChild(t[o]);return i}function ae(e,t,r,n){var i=w(e,t,r,n);i.setAttribute("role","presentation");return i}if(document.createRange)ie=function(e,t,r,n){var i=document.createRange();i.setEnd(n||e,r);i.setStart(e,t);return i};else ie=function(e,t,r){var n=document.body.createTextRange();try{n.moveToElementText(e.parentNode)}catch(e){return n}n.collapse(true);n.moveEnd("character",r);n.moveStart("character",t);return n};function se(e,t){if(t.nodeType==3)t=t.parentNode;if(e.contains)return e.contains(t);do{if(t.nodeType==11)t=t.host;if(t==e)return true}while(t=t.parentNode)}function h(t){var r;try{r=t.activeElement}catch(e){r=t.body||null}while(r&&r.shadowRoot&&r.shadowRoot.activeElement)r=r.shadowRoot.activeElement;return r}function le(e,t){var r=e.className;if(!re(t).test(r))e.className+=(r?" ":"")+t}function ue(e,t){var r=e.split(" ");for(var n=0;n<r.length;n++)if(r[n]&&!re(r[n]).test(t))t+=" "+r[n];return t}var ce=function(e){e.select()};if($)ce=function(e){e.selectionStart=0;e.selectionEnd=e.value.length};else if(T)ce=function(e){try{e.select()}catch(e){}};function he(e){return e.display.wrapper.ownerDocument}function fe(e){return he(e).defaultView}function de(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function pe(e,t,r){if(!t)t={};for(var n in e)if(e.hasOwnProperty(n)&&(r!==false||!t.hasOwnProperty(n)))t[n]=e[n];return t}function S(e,t,r,n,i){if(t==null){t=e.search(/[^\s\u00a0]/);if(t==-1)t=e.length}for(var o=n||0,a=i||0;;){var s=e.indexOf("\t",o);if(s<0||s>=t)return a+(t-o);a+=s-o;a+=r-a%r;o=s+1}}var me=function(){this.id=null;this.f=null;this.time=0;this.handler=de(this.onTimeout,this)};function m(e,t){for(var r=0;r<e.length;++r)if(e[r]==t)return r;return-1}me.prototype.onTimeout=function(e){e.id=0;if(e.time<=+new Date)e.f();else setTimeout(e.handler,e.time-+new Date)},me.prototype.set=function(e,t){this.f=t;var r=+new Date+e;if(!this.id||r<this.time){clearTimeout(this.id);this.id=setTimeout(this.handler,e);this.time=r}};var ge=50,ye={toString:function(){return"CodeMirror.Pass"}},ve={scroll:false},_e={origin:"*mouse"},xe={origin:"+move"};function be(e,t,r){for(var n=0,i=0;;){var o=e.indexOf("\t",n);if(o==-1)o=e.length;var a=o-n;if(o==e.length||i+a>=t)return n+Math.min(a,t-i);i+=o-n;i+=r-i%r;n=o+1;if(i>=t)return n}}var we=[""];function Ee(e){while(we.length<=e)we.push(Z(we)+" ");return we[e]}function Z(e){return e[e.length-1]}function Te(e,t){var r=[];for(var n=0;n<e.length;n++)r[n]=t(e[n],n);return r}function Se(e,t,r){var n=0,i=r(t);while(n<e.length&&r(e[n])<=i)n++;e.splice(n,0,t)}function Me(){}function ke(e,t){var r;if(Object.create)r=Object.create(e);else{Me.prototype=e;r=new Me}if(t)pe(t,r);return r}var Ce=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function Ae(e){return/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||Ce.test(e))}function Ie(e,t){if(!t)return Ae(e);if(t.source.indexOf("\\w")>-1&&Ae(e))return true;return t.test(e)}function Le(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return false;return true}var Pe=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function ze(e){return e.charCodeAt(0)>=768&&Pe.test(e)}function De(e,t,r){while((r<0?t>0:t<e.length)&&ze(e.charAt(t)))t+=r;return t}function Oe(e,t,r){var n=t>r?-1:1;for(;;){if(t==r)return t;var i=(t+r)/2,o=n<0?Math.ceil(i):Math.floor(i);if(o==t)return e(o)?t:r;if(e(o))r=o;else t=o+n}}function Re(e,t,r,n){if(!e)return n(t,r,"ltr",0);var i=false;for(var o=0;o<e.length;++o){var a=e[o];if(a.from<r&&a.to>t||t==r&&a.to==t){n(Math.max(a.from,t),Math.min(a.to,r),a.level==1?"rtl":"ltr",o);i=true}}if(!i)n(t,r,"ltr")}var Fe=null;function Be(e,t,r){var n;Fe=null;for(var i=0;i<e.length;++i){var o=e[i];if(o.from<t&&o.to>t)return i;if(o.to==t)if(o.from!=o.to&&r=="before")n=i;else Fe=i;if(o.from==t)if(o.from!=o.to&&r!="before")n=i;else Fe=i}return n!=null?n:Fe}var Ne=function(){var t="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN";var r="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";function B(e){if(e<=247)return t.charAt(e);else if(1424<=e&&e<=1524)return"R";else if(1536<=e&&e<=1785)return r.charAt(e-1536);else if(1774<=e&&e<=2220)return"r";else if(8192<=e&&e<=8203)return"w";else if(e==8204)return"b";else return"L"}var N=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;var j=/[stwN]/,U=/[LRr]/,V=/[Lb1n]/,G=/[1n]/;function W(e,t,r){this.level=e;this.from=t;this.to=r}return function(e,t){var r=t=="ltr"?"L":"R";if(e.length==0||t=="ltr"&&!N.test(e))return false;var n=e.length,i=[];for(var o=0;o<n;++o)i.push(B(e.charCodeAt(o)));for(var a=0,s=r;a<n;++a){var l=i[a];if(l=="m")i[a]=s;else s=l}for(var u=0,c=r;u<n;++u){var h=i[u];if(h=="1"&&c=="r")i[u]="n";else if(U.test(h)){c=h;if(h=="r")i[u]="R"}}for(var f=1,d=i[0];f<n-1;++f){var p=i[f];if(p=="+"&&d=="1"&&i[f+1]=="1")i[f]="1";else if(p==","&&d==i[f+1]&&(d=="1"||d=="n"))i[f]=d;d=p}for(var m=0;m<n;++m){var g=i[m];if(g==",")i[m]="N";else if(g=="%"){var y=void 0;for(y=m+1;y<n&&i[y]=="%";++y);var v=m&&i[m-1]=="!"||y<n&&i[y]=="1"?"1":"N";for(var _=m;_<y;++_)i[_]=v;m=y-1}}for(var x=0,b=r;x<n;++x){var w=i[x];if(b=="L"&&w=="1")i[x]="L";else if(U.test(w))b=w}for(var E=0;E<n;++E)if(j.test(i[E])){var T=void 0;for(T=E+1;T<n&&j.test(i[T]);++T);var S=(E?i[E-1]:r)=="L";var M=(T<n?i[T]:r)=="L";var k=S==M?S?"L":"R":r;for(var C=E;C<T;++C)i[C]=k;E=T-1}var A=[],I;for(var L=0;L<n;)if(V.test(i[L])){var R=L;for(++L;L<n&&V.test(i[L]);++L);A.push(new W(0,R,L))}else{var P=L,z=A.length,D=t=="rtl"?1:0;for(++L;L<n&&i[L]!="L";++L);for(var O=P;O<L;)if(G.test(i[O])){if(P<O){A.splice(z,0,new W(1,P,O));z+=D}var F=O;for(++O;O<L&&G.test(i[O]);++O);A.splice(z,0,new W(2,F,O));z+=D;P=O}else++O;if(P<L)A.splice(z,0,new W(1,P,L))}if(t=="ltr"){if(A[0].level==1&&(I=e.match(/^\s+/))){A[0].from=I[0].length;A.unshift(new W(0,0,I[0].length))}if(Z(A).level==1&&(I=e.match(/\s+$/))){Z(A).to-=I[0].length;A.push(new W(0,n-I[0].length,n))}}return t=="rtl"?A.reverse():A}}();function je(e,t){var r=e.order;if(r==null)r=e.order=Ne(e.text,t);return r}var Ue=[],M=function(e,t,r){if(e.addEventListener)e.addEventListener(t,r,false);else if(e.attachEvent)e.attachEvent("on"+t,r);else{var n=e._handlers||(e._handlers={});n[t]=(n[t]||Ue).concat(r)}};function Ve(e,t){return e._handlers&&e._handlers[t]||Ue}function k(e,t,r){if(e.removeEventListener)e.removeEventListener(t,r,false);else if(e.detachEvent)e.detachEvent("on"+t,r);else{var n=e._handlers,i=n&&n[t];if(i){var o=m(i,r);if(o>-1)n[t]=i.slice(0,o).concat(i.slice(o+1))}}}function p(e,t){var r=Ve(e,t);if(!r.length)return;var n=Array.prototype.slice.call(arguments,2);for(var i=0;i<r.length;++i)r[i].apply(null,n)}function d(e,t,r){if(typeof t=="string")t={type:t,preventDefault:function(){this.defaultPrevented=true}};p(e,r||t.type,e,t);return qe(t)||t.codemirrorIgnore}function Ge(e){var t=e._handlers&&e._handlers.cursorActivity;if(!t)return;var r=e.curOp.cursorActivityHandlers||(e.curOp.cursorActivityHandlers=[]);for(var n=0;n<t.length;++n)if(m(r,t[n])==-1)r.push(t[n])}function v(e,t){return Ve(e,t).length>0}function We(e){e.prototype.on=function(e,t){M(this,e,t)};e.prototype.off=function(e,t){k(this,e,t)}}function C(e){if(e.preventDefault)e.preventDefault();else e.returnValue=false}function Ze(e){if(e.stopPropagation)e.stopPropagation();else e.cancelBubble=true}function qe(e){return e.defaultPrevented!=null?e.defaultPrevented:e.returnValue==false}function He(e){C(e);Ze(e)}function $e(e){return e.target||e.srcElement}function Xe(e){var t=e.which;if(t==null)if(e.button&1)t=1;else if(e.button&2)t=3;else if(e.button&4)t=2;if(y&&e.ctrlKey&&t==1)t=3;return t}var Ye=function(){if(T&&b<9)return false;var e=w("div");return"draggable"in e||"dragDrop"in e}(),Je,Ke;function Qe(e){if(Je==null){var t=w("span","​");o(e,w("span",[t,document.createTextNode("x")]));if(e.firstChild.offsetHeight!=0)Je=t.offsetWidth<=1&&t.offsetHeight>2&&!(T&&b<8)}var r=Je?w("span","​"):w("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px");r.setAttribute("cm-text","");return r}function et(e){if(Ke!=null)return Ke;var t=o(e,document.createTextNode("AخA"));var r=ie(t,0,1).getBoundingClientRect();var n=ie(t,1,2).getBoundingClientRect();oe(e);if(!r||r.left==r.right)return false;return Ke=n.right-r.right<3}var tt="\n\nb".split(/\n/).length!=3?function(e){var t=0,r=[],n=e.length;while(t<=n){var i=e.indexOf("\n",t);if(i==-1)i=e.length;var o=e.slice(t,e.charAt(i-1)=="\r"?i-1:i);var a=o.indexOf("\r");if(a!=-1){r.push(o.slice(0,a));t+=a+1}else{r.push(o);t=i+1}}return r}:function(e){return e.split(/\r\n?|\n/)},rt=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(e){return false}}:function(e){var t;try{t=e.ownerDocument.selection.createRange()}catch(e){}if(!t||t.parentElement()!=e)return false;return t.compareEndPoints("StartToEnd",t)!=0},nt=function(){var e=w("div");if("oncopy"in e)return true;e.setAttribute("oncopy","return;");return typeof e.oncopy=="function"}(),it=null;function ot(e){if(it!=null)return it;var t=o(e,w("span","x"));var r=t.getBoundingClientRect();var n=ie(t,0,1).getBoundingClientRect();return it=Math.abs(r.left-n.left)>1}var at={},st={};function lt(e,t){if(arguments.length>2)t.dependencies=Array.prototype.slice.call(arguments,2);at[e]=t}function ut(e,t){st[e]=t}function ct(e){if(typeof e=="string"&&st.hasOwnProperty(e))e=st[e];else if(e&&typeof e.name=="string"&&st.hasOwnProperty(e.name)){var t=st[e.name];if(typeof t=="string")t={name:t};e=ke(t,e);e.name=t.name}else if(typeof e=="string"&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return ct("application/xml");else if(typeof e=="string"&&/^[\w\-]+\/[\w\-]+\+json$/.test(e))return ct("application/json");if(typeof e=="string")return{name:e};else return e||{name:"null"}}function ht(e,t){t=ct(t);var r=at[t.name];if(!r)return ht(e,"text/plain");var n=r(e,t);if(ft.hasOwnProperty(t.name)){var i=ft[t.name];for(var o in i){if(!i.hasOwnProperty(o))continue;if(n.hasOwnProperty(o))n["_"+o]=n[o];n[o]=i[o]}}n.name=t.name;if(t.helperType)n.helperType=t.helperType;if(t.modeProps)for(var a in t.modeProps)n[a]=t.modeProps[a];return n}var ft={};function dt(e,t){var r=ft.hasOwnProperty(e)?ft[e]:ft[e]={};pe(t,r)}function pt(e,t){if(t===true)return t;if(e.copyState)return e.copyState(t);var r={};for(var n in t){var i=t[n];if(i instanceof Array)i=i.concat([]);r[n]=i}return r}function mt(e,t){var r;while(e.innerMode){r=e.innerMode(t);if(!r||r.mode==e)break;t=r.state;e=r.mode}return r||{mode:e,state:t}}function gt(e,t,r){return e.startState?e.startState(t,r):true}var _=function(e,t,r){this.pos=this.start=0;this.string=e;this.tabSize=t||8;this.lastColumnPos=this.lastColumnValue=0;this.lineStart=0;this.lineOracle=r};function L(e,t){t-=e.first;if(t<0||t>=e.size)throw new Error("There is no line "+(t+e.first)+" in the document.");var r=e;while(!r.lines)for(var n=0;;++n){var i=r.children[n],o=i.chunkSize();if(t<o){r=i;break}t-=o}return r.lines[t]}function yt(e,r,n){var i=[],o=r.line;e.iter(r.line,n.line+1,function(e){var t=e.text;if(o==n.line)t=t.slice(0,n.ch);if(o==r.line)t=t.slice(r.ch);i.push(t);++o});return i}function vt(e,t,r){var n=[];e.iter(t,r,function(e){n.push(e.text)});return n}function _t(e,t){var r=t-e.height;if(r)for(var n=e;n;n=n.parent)n.height+=r}function E(e){if(e.parent==null)return null;var t=e.parent,r=m(t.lines,e);for(var n=t.parent;n;t=n,n=n.parent)for(var i=0;;++i){if(n.children[i]==t)break;r+=n.children[i].chunkSize()}return r+t.first}function xt(e,t){var r=e.first;e:do{for(var n=0;n<e.children.length;++n){var i=e.children[n],o=i.height;if(t<o){e=i;continue e}t-=o;r+=i.chunkSize()}return r}while(!e.lines);var a=0;for(;a<e.lines.length;++a){var s=e.lines[a],l=s.height;if(t<l)break;t-=l}return r+a}function bt(e,t){return t>=e.first&&t<e.first+e.size}function wt(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function P(e,t,r){if(r===void 0)r=null;if(!(this instanceof P))return new P(e,t,r);this.line=e;this.ch=t;this.sticky=r}function A(e,t){return e.line-t.line||e.ch-t.ch}function Et(e,t){return e.sticky==t.sticky&&A(e,t)==0}function Tt(e){return P(e.line,e.ch)}function St(e,t){return A(e,t)<0?t:e}function Mt(e,t){return A(e,t)<0?e:t}function kt(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function I(e,t){if(t.line<e.first)return P(e.first,0);var r=e.first+e.size-1;if(t.line>r)return P(r,L(e,r).text.length);return Ct(t,L(e,t.line).text.length)}function Ct(e,t){var r=e.ch;if(r==null||r>t)return P(e.line,t);else if(r<0)return P(e.line,0);else return e}function At(e,t){var r=[];for(var n=0;n<t.length;n++)r[n]=I(e,t[n]);return r}_.prototype.eol=function(){return this.pos>=this.string.length},_.prototype.sol=function(){return this.pos==this.lineStart},_.prototype.peek=function(){return this.string.charAt(this.pos)||undefined},_.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},_.prototype.eat=function(e){var t=this.string.charAt(this.pos);var r;if(typeof e=="string")r=t==e;else r=t&&(e.test?e.test(t):e(t));if(r){++this.pos;return t}},_.prototype.eatWhile=function(e){var t=this.pos;while(this.eat(e));return this.pos>t},_.prototype.eatSpace=function(){var e=this.pos;while(/[\s\u00a0]/.test(this.string.charAt(this.pos)))++this.pos;return this.pos>e},_.prototype.skipToEnd=function(){this.pos=this.string.length},_.prototype.skipTo=function(e){var t=this.string.indexOf(e,this.pos);if(t>-1){this.pos=t;return true}},_.prototype.backUp=function(e){this.pos-=e},_.prototype.column=function(){if(this.lastColumnPos<this.start){this.lastColumnValue=S(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue);this.lastColumnPos=this.start}return this.lastColumnValue-(this.lineStart?S(this.string,this.lineStart,this.tabSize):0)},_.prototype.indentation=function(){return S(this.string,null,this.tabSize)-(this.lineStart?S(this.string,this.lineStart,this.tabSize):0)},_.prototype.match=function(e,t,r){if(typeof e=="string"){var n=function(e){return r?e.toLowerCase():e};var i=this.string.substr(this.pos,e.length);if(n(i)==n(e)){if(t!==false)this.pos+=e.length;return true}}else{var o=this.string.slice(this.pos).match(e);if(o&&o.index>0)return null;if(o&&t!==false)this.pos+=o[0].length;return o}},_.prototype.current=function(){return this.string.slice(this.start,this.pos)},_.prototype.hideFirstChars=function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}},_.prototype.lookAhead=function(e){var t=this.lineOracle;return t&&t.lookAhead(e)},_.prototype.baseToken=function(){var e=this.lineOracle;return e&&e.baseToken(this.pos)};var It=function(e,t){this.state=e;this.lookAhead=t},Lt=function(e,t,r,n){this.state=t;this.doc=e;this.line=r;this.maxLookAhead=n||0;this.baseTokens=null;this.baseTokenPos=1};function Pt(t,r,n,e){var l=[t.state.modeGen],i={};Ut(t,r.text,t.doc.mode,n,function(e,t){return l.push(e,t)},i,e);var u=n.state;var o=function(e){n.baseTokens=l;var o=t.state.overlays[e],a=1,s=0;n.state=true;Ut(t,r.text,o.mode,n,function(e,t){var r=a;while(s<e){var n=l[a];if(n>e)l.splice(a,1,e,l[a+1],n);a+=2;s=Math.min(e,n)}if(!t)return;if(o.opaque){l.splice(r,a-r,e,"overlay "+t);a=r+2}else for(;r<a;r+=2){var i=l[r+1];l[r+1]=(i?i+" ":"")+"overlay "+t}},i);n.state=u;n.baseTokens=null;n.baseTokenPos=1};for(var a=0;a<t.state.overlays.length;++a)o(a);return{styles:l,classes:i.bgClass||i.textClass?i:null}}function zt(e,t,r){if(!t.styles||t.styles[0]!=e.state.modeGen){var n=Dt(e,E(t));var i=t.text.length>e.options.maxHighlightLength&&pt(e.doc.mode,n.state);var o=Pt(e,t,n);if(i)n.state=i;t.stateAfter=n.save(!i);t.styles=o.styles;if(o.classes)t.styleClasses=o.classes;else if(t.styleClasses)t.styleClasses=null;if(r===e.doc.highlightFrontier)e.doc.modeFrontier=Math.max(e.doc.modeFrontier,++e.doc.highlightFrontier)}return t.styles}function Dt(r,n,e){var t=r.doc,i=r.display;if(!t.mode.startState)return new Lt(t,true,n);var o=Vt(r,n,e);var a=o>t.first&&L(t,o-1).stateAfter;var s=a?Lt.fromSaved(t,a,o):new Lt(t,gt(t.mode),o);t.iter(o,n,function(e){Ot(r,e.text,s);var t=s.line;e.stateAfter=t==n-1||t%5==0||t>=i.viewFrom&&t<i.viewTo?s.save():null;s.nextLine()});if(e)t.modeFrontier=s.line;return s}function Ot(e,t,r,n){var i=e.doc.mode;var o=new _(t,e.options.tabSize,r);o.start=o.pos=n||0;if(t=="")Rt(i,r.state);while(!o.eol()){Ft(i,o,r.state);o.start=o.pos}}function Rt(e,t){if(e.blankLine)return e.blankLine(t);if(!e.innerMode)return;var r=mt(e,t);if(r.mode.blankLine)return r.mode.blankLine(r.state)}function Ft(e,t,r,n){for(var i=0;i<10;i++){if(n)n[0]=mt(e,r).mode;var o=e.token(t,r);if(t.pos>t.start)return o}throw new Error("Mode "+e.name+" failed to advance stream.")}Lt.prototype.lookAhead=function(e){var t=this.doc.getLine(this.line+e);if(t!=null&&e>this.maxLookAhead)this.maxLookAhead=e;return t},Lt.prototype.baseToken=function(e){if(!this.baseTokens)return null;while(this.baseTokens[this.baseTokenPos]<=e)this.baseTokenPos+=2;var t=this.baseTokens[this.baseTokenPos+1];return{type:t&&t.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-e}},Lt.prototype.nextLine=function(){this.line++;if(this.maxLookAhead>0)this.maxLookAhead--},Lt.fromSaved=function(e,t,r){if(t instanceof It)return new Lt(e,pt(e.mode,t.state),r,t.lookAhead);else return new Lt(e,pt(e.mode,t),r)},Lt.prototype.save=function(e){var t=e!==false?pt(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new It(t,this.maxLookAhead):t};var Bt=function(e,t,r){this.start=e.start;this.end=e.pos;this.string=e.current();this.type=t||null;this.state=r};function Nt(e,t,r,n){var i=e.doc,o=i.mode,a;t=I(i,t);var s=L(i,t.line),l=Dt(e,t.line,r);var u=new _(s.text,e.options.tabSize,l),c;if(n)c=[];while((n||u.pos<t.ch)&&!u.eol()){u.start=u.pos;a=Ft(o,u,l.state);if(n)c.push(new Bt(u,a,pt(i.mode,l.state)))}return n?c:new Bt(u,a,l.state)}function jt(e,t){if(e)for(;;){var r=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!r)break;e=e.slice(0,r.index)+e.slice(r.index+r[0].length);var n=r[1]?"bgClass":"textClass";if(t[n]==null)t[n]=r[2];else if(!new RegExp("(?:^|\\s)"+r[2]+"(?:$|\\s)").test(t[n]))t[n]+=" "+r[2]}return e}function Ut(e,t,r,n,i,o,a){var s=r.flattenSpans;if(s==null)s=e.options.flattenSpans;var l=0,u=null;var c=new _(t,e.options.tabSize,n),h;var f=e.options.addModeClass&&[null];if(t=="")jt(Rt(r,n.state),o);while(!c.eol()){if(c.pos>e.options.maxHighlightLength){s=false;if(a)Ot(e,t,n,c.pos);c.pos=t.length;h=null}else h=jt(Ft(r,c,n.state,f),o);if(f){var d=f[0].name;if(d)h="m-"+(h?d+" "+h:d)}if(!s||u!=h){while(l<c.start){l=Math.min(c.start,l+5e3);i(l,u)}u=h}c.start=c.pos}while(l<c.pos){var p=Math.min(c.pos,l+5e3);i(p,u);l=p}}function Vt(e,t,r){var n,i,o=e.doc;var a=r?-1:t-(e.doc.mode.innerMode?1e3:100);for(var s=t;s>a;--s){if(s<=o.first)return o.first;var l=L(o,s-1),u=l.stateAfter;if(u&&(!r||s+(u instanceof It?u.lookAhead:0)<=o.modeFrontier))return s;var c=S(l.text,null,e.options.tabSize);if(i==null||n>c){i=s-1;n=c}}return i}function Gt(e,t){e.modeFrontier=Math.min(e.modeFrontier,t);if(e.highlightFrontier<t-10)return;var r=e.first;for(var n=t-1;n>r;n--){var i=L(e,n).stateAfter;if(i&&(!(i instanceof It)||n+i.lookAhead<t)){r=n+1;break}}e.highlightFrontier=Math.min(e.highlightFrontier,r)}var Wt=false,Zt=false;function qt(){Wt=true}function Ht(){Zt=true}function $t(e,t,r){this.marker=e;this.from=t;this.to=r}function Xt(e,t){if(e)for(var r=0;r<e.length;++r){var n=e[r];if(n.marker==t)return n}}function Yt(e,t){var r;for(var n=0;n<e.length;++n)if(e[n]!=t)(r||(r=[])).push(e[n]);return r}function Jt(e,t,r){var n=r&&window.WeakSet&&(r.markedSpans||(r.markedSpans=new WeakSet));if(n&&e.markedSpans&&n.has(e.markedSpans))e.markedSpans.push(t);else{e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t];if(n)n.add(e.markedSpans)}t.marker.attachLine(e)}function Kt(e,t,r){var n;if(e)for(var i=0;i<e.length;++i){var o=e[i],a=o.marker;var s=o.from==null||(a.inclusiveLeft?o.from<=t:o.from<t);if(s||o.from==t&&a.type=="bookmark"&&(!r||!o.marker.insertLeft)){var l=o.to==null||(a.inclusiveRight?o.to>=t:o.to>t);(n||(n=[])).push(new $t(a,o.from,l?null:o.to))}}return n}function Qt(e,t,r){var n;if(e)for(var i=0;i<e.length;++i){var o=e[i],a=o.marker;var s=o.to==null||(a.inclusiveRight?o.to>=t:o.to>t);if(s||o.from==t&&a.type=="bookmark"&&(!r||o.marker.insertLeft)){var l=o.from==null||(a.inclusiveLeft?o.from<=t:o.from<t);(n||(n=[])).push(new $t(a,l?null:o.from-t,o.to==null?null:o.to-t))}}return n}function er(e,t){if(t.full)return null;var r=bt(e,t.from.line)&&L(e,t.from.line).markedSpans;var n=bt(e,t.to.line)&&L(e,t.to.line).markedSpans;if(!r&&!n)return null;var i=t.from.ch,o=t.to.ch,a=A(t.from,t.to)==0;var s=Kt(r,i,a);var l=Qt(n,o,a);var u=t.text.length==1,c=Z(t.text).length+(u?i:0);if(s)for(var h=0;h<s.length;++h){var f=s[h];if(f.to==null){var d=Xt(l,f.marker);if(!d)f.to=i;else if(u)f.to=d.to==null?null:d.to+c}}if(l)for(var p=0;p<l.length;++p){var m=l[p];if(m.to!=null)m.to+=c;if(m.from==null){var g=Xt(s,m.marker);if(!g){m.from=c;if(u)(s||(s=[])).push(m)}}else{m.from+=c;if(u)(s||(s=[])).push(m)}}if(s)s=tr(s);if(l&&l!=s)l=tr(l);var y=[s];if(!u){var v=t.text.length-2,_;if(v>0&&s)for(var x=0;x<s.length;++x)if(s[x].to==null)(_||(_=[])).push(new $t(s[x].marker,null,null));for(var b=0;b<v;++b)y.push(_);y.push(l)}return y}function tr(e){for(var t=0;t<e.length;++t){var r=e[t];if(r.from!=null&&r.from==r.to&&r.marker.clearWhenEmpty!==false)e.splice(t--,1)}if(!e.length)return null;return e}function rr(e,t,r){var n=null;e.iter(t.line,r.line+1,function(e){if(e.markedSpans)for(var t=0;t<e.markedSpans.length;++t){var r=e.markedSpans[t].marker;if(r.readOnly&&(!n||m(n,r)==-1))(n||(n=[])).push(r)}});if(!n)return null;var i=[{from:t,to:r}];for(var o=0;o<n.length;++o){var a=n[o],s=a.find(0);for(var l=0;l<i.length;++l){var u=i[l];if(A(u.to,s.from)<0||A(u.from,s.to)>0)continue;var c=[l,1],h=A(u.from,s.from),f=A(u.to,s.to);if(h<0||!a.inclusiveLeft&&!h)c.push({from:u.from,to:s.from});if(f>0||!a.inclusiveRight&&!f)c.push({from:s.to,to:u.to});i.splice.apply(i,c);l+=c.length-3}}return i}function nr(e){var t=e.markedSpans;if(!t)return;for(var r=0;r<t.length;++r)t[r].marker.detachLine(e);e.markedSpans=null}function ir(e,t){if(!t)return;for(var r=0;r<t.length;++r)t[r].marker.attachLine(e);e.markedSpans=t}function or(e){return e.inclusiveLeft?-1:0}function ar(e){return e.inclusiveRight?1:0}function sr(e,t){var r=e.lines.length-t.lines.length;if(r!=0)return r;var n=e.find(),i=t.find();var o=A(n.from,i.from)||or(e)-or(t);if(o)return-o;var a=A(n.to,i.to)||ar(e)-ar(t);if(a)return a;return t.id-e.id}function lr(e,t){var r=Zt&&e.markedSpans,n;if(r)for(var i=void 0,o=0;o<r.length;++o){i=r[o];if(i.marker.collapsed&&(t?i.from:i.to)==null&&(!n||sr(n,i.marker)<0))n=i.marker}return n}function ur(e){return lr(e,true)}function cr(e){return lr(e,false)}function hr(e,t){var r=Zt&&e.markedSpans,n;if(r)for(var i=0;i<r.length;++i){var o=r[i];if(o.marker.collapsed&&(o.from==null||o.from<t)&&(o.to==null||o.to>t)&&(!n||sr(n,o.marker)<0))n=o.marker}return n}function fr(e,t,r,n,i){var o=L(e,t);var a=Zt&&o.markedSpans;if(a)for(var s=0;s<a.length;++s){var l=a[s];if(!l.marker.collapsed)continue;var u=l.marker.find(0);var c=A(u.from,r)||or(l.marker)-or(i);var h=A(u.to,n)||ar(l.marker)-ar(i);if(c>=0&&h<=0||c<=0&&h>=0)continue;if(c<=0&&(l.marker.inclusiveRight&&i.inclusiveLeft?A(u.to,r)>=0:A(u.to,r)>0)||c>=0&&(l.marker.inclusiveRight&&i.inclusiveLeft?A(u.from,n)<=0:A(u.from,n)<0))return true}}function dr(e){var t;while(t=ur(e))e=t.find(-1,true).line;return e}function pr(e){var t;while(t=cr(e))e=t.find(1,true).line;return e}function mr(e){var t,r;while(t=cr(e)){e=t.find(1,true).line;(r||(r=[])).push(e)}return r}function gr(e,t){var r=L(e,t),n=dr(r);if(r==n)return t;return E(n)}function yr(e,t){if(t>e.lastLine())return t;var r=L(e,t),n;if(!vr(e,r))return t;while(n=cr(r))r=n.find(1,true).line;return E(r)+1}function vr(e,t){var r=Zt&&t.markedSpans;if(r)for(var n=void 0,i=0;i<r.length;++i){n=r[i];if(!n.marker.collapsed)continue;if(n.from==null)return true;if(n.marker.widgetNode)continue;if(n.from==0&&n.marker.inclusiveLeft&&_r(e,t,n))return true}}function _r(e,t,r){if(r.to==null){var n=r.marker.find(1,true);return _r(e,n.line,Xt(n.line.markedSpans,r.marker))}if(r.marker.inclusiveRight&&r.to==t.text.length)return true;for(var i=void 0,o=0;o<t.markedSpans.length;++o){i=t.markedSpans[o];if(i.marker.collapsed&&!i.marker.widgetNode&&i.from==r.to&&(i.to==null||i.to!=r.from)&&(i.marker.inclusiveLeft||r.marker.inclusiveRight)&&_r(e,t,i))return true}}function xr(e){e=dr(e);var t=0,r=e.parent;for(var n=0;n<r.lines.length;++n){var i=r.lines[n];if(i==e)break;else t+=i.height}for(var o=r.parent;o;r=o,o=r.parent)for(var a=0;a<o.children.length;++a){var s=o.children[a];if(s==r)break;else t+=s.height}return t}function br(e){if(e.height==0)return 0;var t=e.text.length,r,n=e;while(r=ur(n)){var i=r.find(0,true);n=i.from.line;t+=i.from.ch-i.to.ch}n=e;while(r=cr(n)){var o=r.find(0,true);t-=n.text.length-o.from.ch;n=o.to.line;t+=n.text.length-o.to.ch}return t}function wr(e){var r=e.display,t=e.doc;r.maxLine=L(t,t.first);r.maxLineLength=br(r.maxLine);r.maxLineChanged=true;t.iter(function(e){var t=br(e);if(t>r.maxLineLength){r.maxLineLength=t;r.maxLine=e}})}var Er=function(e,t,r){this.text=e;ir(this,t);this.height=r?r(this):1};function Tr(e,t,r,n){e.text=t;if(e.stateAfter)e.stateAfter=null;if(e.styles)e.styles=null;if(e.order!=null)e.order=null;nr(e);ir(e,r);var i=n?n(e):1;if(i!=e.height)_t(e,i)}function Sr(e){e.parent=null;nr(e)}Er.prototype.lineNo=function(){return E(this)},We(Er);var Mr={},kr={};function Cr(e,t){if(!e||/^\s*$/.test(e))return null;var r=t.addModeClass?kr:Mr;return r[e]||(r[e]=e.replace(/\S+/g,"cm-$&"))}function Ar(e,t){var r=ae("span",null,null,g?"padding-right: .1px":null);var n={pre:ae("pre",[r],"CodeMirror-line"),content:r,col:0,pos:0,cm:e,trailingSpace:false,splitSpaces:e.getOption("lineWrapping")};t.measure={};for(var i=0;i<=(t.rest?t.rest.length:0);i++){var o=i?t.rest[i-1]:t.line,a=void 0;n.pos=0;n.addToken=Lr;if(et(e.display.measure)&&(a=je(o,e.doc.direction)))n.addToken=zr(n.addToken,a);n.map=[];var s=t!=e.display.externalMeasured&&E(o);Or(o,n,zt(e,o,s));if(o.styleClasses){if(o.styleClasses.bgClass)n.bgClass=ue(o.styleClasses.bgClass,n.bgClass||"");if(o.styleClasses.textClass)n.textClass=ue(o.styleClasses.textClass,n.textClass||"")}if(n.map.length==0)n.map.push(0,0,n.content.appendChild(Qe(e.display.measure)));if(i==0){t.measure.map=n.map;t.measure.cache={}}else{(t.measure.maps||(t.measure.maps=[])).push(n.map);(t.measure.caches||(t.measure.caches=[])).push({})}}if(g){var l=n.content.lastChild;if(/\bcm-tab\b/.test(l.className)||l.querySelector&&l.querySelector(".cm-tab"))n.content.className="cm-tab-wrap-hack"}p(e,"renderLine",e,t.line,n.pre);if(n.pre.className)n.textClass=ue(n.pre.className,n.textClass||"");return n}function Ir(e){var t=w("span","•","cm-invalidchar");t.title="\\u"+e.charCodeAt(0).toString(16);t.setAttribute("aria-label",t.title);return t}function Lr(e,t,r,n,i,o,a){if(!t)return;var s=e.splitSpaces?Pr(t,e.trailingSpace):t;var l=e.cm.state.specialChars,u=false;var c;if(!l.test(t)){e.col+=t.length;c=document.createTextNode(s);e.map.push(e.pos,e.pos+t.length,c);if(T&&b<9)u=true;e.pos+=t.length}else{c=document.createDocumentFragment();var h=0;while(true){l.lastIndex=h;var f=l.exec(t);var d=f?f.index-h:t.length-h;if(d){var p=document.createTextNode(s.slice(h,h+d));if(T&&b<9)c.appendChild(w("span",[p]));else c.appendChild(p);e.map.push(e.pos,e.pos+d,p);e.col+=d;e.pos+=d}if(!f)break;h+=d+1;var m=void 0;if(f[0]=="\t"){var g=e.cm.options.tabSize,y=g-e.col%g;m=c.appendChild(w("span",Ee(y),"cm-tab"));m.setAttribute("role","presentation");m.setAttribute("cm-text","\t");e.col+=y}else if(f[0]=="\r"||f[0]=="\n"){m=c.appendChild(w("span",f[0]=="\r"?"␍":"␤","cm-invalidchar"));m.setAttribute("cm-text",f[0]);e.col+=1}else{m=e.cm.options.specialCharPlaceholder(f[0]);m.setAttribute("cm-text",f[0]);if(T&&b<9)c.appendChild(w("span",[m]));else c.appendChild(m);e.col+=1}e.map.push(e.pos,e.pos+1,m);e.pos++}}e.trailingSpace=s.charCodeAt(t.length-1)==32;if(r||n||i||u||o||a){var v=r||"";if(n)v+=n;if(i)v+=i;var _=w("span",[c],v,o);if(a)for(var x in a)if(a.hasOwnProperty(x)&&x!="style"&&x!="class")_.setAttribute(x,a[x]);return e.content.appendChild(_)}e.content.appendChild(c)}function Pr(e,t){if(e.length>1&&!/  /.test(e))return e;var r=t,n="";for(var i=0;i<e.length;i++){var o=e.charAt(i);if(o==" "&&r&&(i==e.length-1||e.charCodeAt(i+1)==32))o=" ";n+=o;r=o==" "}return n}function zr(h,f){return function(e,t,r,n,i,o,a){r=r?r+" cm-force-border":"cm-force-border";var s=e.pos,l=s+t.length;for(;;){var u=void 0;for(var c=0;c<f.length;c++){u=f[c];if(u.to>s&&u.from<=s)break}if(u.to>=l)return h(e,t,r,n,i,o,a);h(e,t.slice(0,u.to-s),r,n,null,o,a);n=null;t=t.slice(u.to-s);s=u.to}}}function Dr(e,t,r,n){var i=!n&&r.widgetNode;if(i)e.map.push(e.pos,e.pos+t,i);if(!n&&e.cm.display.input.needsContentAttribute){if(!i)i=e.content.appendChild(document.createElement("span"));i.setAttribute("cm-marker",r.id)}if(i){e.cm.display.input.setUneditable(i);e.content.appendChild(i)}e.pos+=t;e.trailingSpace=false}function Or(e,t,r){var n=e.markedSpans,i=e.text,o=0;if(!n){for(var a=1;a<r.length;a+=2)t.addToken(t,i.slice(o,o=r[a]),Cr(r[a+1],t.cm.options));return}var s=i.length,l=0,u=1,c="",h,f;var d=0,p,m,g,y,v;for(;;){if(d==l){p=m=g=f="";v=null;y=null;d=Infinity;var _=[],x=void 0;for(var b=0;b<n.length;++b){var w=n[b],E=w.marker;if(E.type=="bookmark"&&w.from==l&&E.widgetNode)_.push(E);else if(w.from<=l&&(w.to==null||w.to>l||E.collapsed&&w.to==l&&w.from==l)){if(w.to!=null&&w.to!=l&&d>w.to){d=w.to;m=""}if(E.className)p+=" "+E.className;if(E.css)f=(f?f+";":"")+E.css;if(E.startStyle&&w.from==l)g+=" "+E.startStyle;if(E.endStyle&&w.to==d)(x||(x=[])).push(E.endStyle,w.to);if(E.title)(v||(v={})).title=E.title;if(E.attributes)for(var T in E.attributes)(v||(v={}))[T]=E.attributes[T];if(E.collapsed&&(!y||sr(y.marker,E)<0))y=w}else if(w.from>l&&d>w.from)d=w.from}if(x)for(var S=0;S<x.length;S+=2)if(x[S+1]==d)m+=" "+x[S];if(!y||y.from==l)for(var M=0;M<_.length;++M)Dr(t,0,_[M]);if(y&&(y.from||0)==l){Dr(t,(y.to==null?s+1:y.to)-l,y.marker,y.from==null);if(y.to==null)return;if(y.to==l)y=false}}if(l>=s)break;var k=Math.min(s,d);while(true){if(c){var C=l+c.length;if(!y){var A=C>k?c.slice(0,k-l):c;t.addToken(t,A,h?h+p:p,g,l+A.length==d?m:"",f,v)}if(C>=k){c=c.slice(k-l);l=k;break}l=C;g=""}c=i.slice(o,o=r[u++]);h=Cr(r[u++],t.cm.options)}}}function Rr(e,t,r){this.line=t;this.rest=mr(t);this.size=this.rest?E(Z(this.rest))-r+1:1;this.node=this.text=null;this.hidden=vr(e,t)}function Fr(e,t,r){var n=[],i;for(var o=t;o<r;o=i){var a=new Rr(e.doc,L(e.doc,o),o);i=o+a.size;n.push(a)}return n}var Br=null;function Nr(e){if(Br)Br.ops.push(e);else e.ownsGroup=Br={ops:[e],delayedCallbacks:[]}}function jr(e){var t=e.delayedCallbacks,r=0;do{for(;r<t.length;r++)t[r].call(null);for(var n=0;n<e.ops.length;n++){var i=e.ops[n];if(i.cursorActivityHandlers)while(i.cursorActivityCalled<i.cursorActivityHandlers.length)i.cursorActivityHandlers[i.cursorActivityCalled++].call(null,i.cm)}}while(r<t.length)}function Ur(e,t){var r=e.ownsGroup;if(!r)return;try{jr(r)}finally{Br=null;t(r)}}var Vr=null;function x(e,t){var r=Ve(e,t);if(!r.length)return;var n=Array.prototype.slice.call(arguments,2),i;if(Br)i=Br.delayedCallbacks;else if(Vr)i=Vr;else{i=Vr=[];setTimeout(Gr,0)}var o=function(e){i.push(function(){return r[e].apply(null,n)})};for(var a=0;a<r.length;++a)o(a)}function Gr(){var e=Vr;Vr=null;for(var t=0;t<e.length;++t)e[t]()}function Wr(e,t,r,n){for(var i=0;i<t.changes.length;i++){var o=t.changes[i];if(o=="text")$r(e,t);else if(o=="gutter")Yr(e,t,r,n);else if(o=="class")Xr(e,t);else if(o=="widget")Jr(e,t,n)}t.changes=null}function Zr(e){if(e.node==e.text){e.node=w("div",null,null,"position: relative");if(e.text.parentNode)e.text.parentNode.replaceChild(e.node,e.text);e.node.appendChild(e.text);if(T&&b<8)e.node.style.zIndex=2}return e.node}function qr(e,t){var r=t.bgClass?t.bgClass+" "+(t.line.bgClass||""):t.line.bgClass;if(r)r+=" CodeMirror-linebackground";if(t.background)if(r)t.background.className=r;else{t.background.parentNode.removeChild(t.background);t.background=null}else if(r){var n=Zr(t);t.background=n.insertBefore(w("div",null,r),n.firstChild);e.display.input.setUneditable(t.background)}}function Hr(e,t){var r=e.display.externalMeasured;if(r&&r.line==t.line){e.display.externalMeasured=null;t.measure=r.measure;return r.built}return Ar(e,t)}function $r(e,t){var r=t.text.className;var n=Hr(e,t);if(t.text==t.node)t.node=n.pre;t.text.parentNode.replaceChild(n.pre,t.text);t.text=n.pre;if(n.bgClass!=t.bgClass||n.textClass!=t.textClass){t.bgClass=n.bgClass;t.textClass=n.textClass;Xr(e,t)}else if(r)t.text.className=r}function Xr(e,t){qr(e,t);if(t.line.wrapClass)Zr(t).className=t.line.wrapClass;else if(t.node!=t.text)t.node.className="";var r=t.textClass?t.textClass+" "+(t.line.textClass||""):t.line.textClass;t.text.className=r||""}function Yr(e,t,r,n){if(t.gutter){t.node.removeChild(t.gutter);t.gutter=null}if(t.gutterBackground){t.node.removeChild(t.gutterBackground);t.gutterBackground=null}if(t.line.gutterClass){var i=Zr(t);t.gutterBackground=w("div",null,"CodeMirror-gutter-background "+t.line.gutterClass,"left: "+(e.options.fixedGutter?n.fixedPos:-n.gutterTotalWidth)+"px; width: "+n.gutterTotalWidth+"px");e.display.input.setUneditable(t.gutterBackground);i.insertBefore(t.gutterBackground,t.text)}var o=t.line.gutterMarkers;if(e.options.lineNumbers||o){var a=Zr(t);var s=t.gutter=w("div",null,"CodeMirror-gutter-wrapper","left: "+(e.options.fixedGutter?n.fixedPos:-n.gutterTotalWidth)+"px");s.setAttribute("aria-hidden","true");e.display.input.setUneditable(s);a.insertBefore(s,t.text);if(t.line.gutterClass)s.className+=" "+t.line.gutterClass;if(e.options.lineNumbers&&(!o||!o["CodeMirror-linenumbers"]))t.lineNumber=s.appendChild(w("div",wt(e.options,r),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+n.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+e.display.lineNumInnerWidth+"px"));if(o)for(var l=0;l<e.display.gutterSpecs.length;++l){var u=e.display.gutterSpecs[l].className,c=o.hasOwnProperty(u)&&o[u];if(c)s.appendChild(w("div",[c],"CodeMirror-gutter-elt","left: "+n.gutterLeft[u]+"px; width: "+n.gutterWidth[u]+"px"))}}}function Jr(e,t,r){if(t.alignable)t.alignable=null;var n=re("CodeMirror-linewidget");for(var i=t.node.firstChild,o=void 0;i;i=o){o=i.nextSibling;if(n.test(i.className))t.node.removeChild(i)}Qr(e,t,r)}function Kr(e,t,r,n){var i=Hr(e,t);t.text=t.node=i.pre;if(i.bgClass)t.bgClass=i.bgClass;if(i.textClass)t.textClass=i.textClass;Xr(e,t);Yr(e,t,r,n);Qr(e,t,n);return t.node}function Qr(e,t,r){en(e,t.line,t,r,true);if(t.rest)for(var n=0;n<t.rest.length;n++)en(e,t.rest[n],t,r,false)}function en(e,t,r,n,i){if(!t.widgets)return;var o=Zr(r);for(var a=0,s=t.widgets;a<s.length;++a){var l=s[a],u=w("div",[l.node],"CodeMirror-linewidget"+(l.className?" "+l.className:""));if(!l.handleMouseEvents)u.setAttribute("cm-ignore-events","true");tn(l,u,r,n);e.display.input.setUneditable(u);if(i&&l.above)o.insertBefore(u,r.gutter||r.text);else o.appendChild(u);x(l,"redraw")}}function tn(e,t,r,n){if(e.noHScroll){(r.alignable||(r.alignable=[])).push(t);var i=n.wrapperWidth;t.style.left=n.fixedPos+"px";if(!e.coverGutter){i-=n.gutterTotalWidth;t.style.paddingLeft=n.gutterTotalWidth+"px"}t.style.width=i+"px"}if(e.coverGutter){t.style.zIndex=5;t.style.position="relative";if(!e.noHScroll)t.style.marginLeft=-n.gutterTotalWidth+"px"}}function rn(e){if(e.height!=null)return e.height;var t=e.doc.cm;if(!t)return 0;if(!se(document.body,e.node)){var r="position: relative;";if(e.coverGutter)r+="margin-left: -"+t.display.gutters.offsetWidth+"px;";if(e.noHScroll)r+="width: "+t.display.wrapper.clientWidth+"px;";o(t.display.measure,w("div",[e.node],null,r))}return e.height=e.node.parentNode.offsetHeight}function nn(e,t){for(var r=$e(t);r!=e.wrapper;r=r.parentNode)if(!r||r.nodeType==1&&r.getAttribute("cm-ignore-events")=="true"||r.parentNode==e.sizer&&r!=e.mover)return true}function on(e){return e.lineSpace.offsetTop}function an(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function sn(e){if(e.cachedPaddingH)return e.cachedPaddingH;var t=o(e.measure,w("pre","x","CodeMirror-line-like"));var r=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle;var n={left:parseInt(r.paddingLeft),right:parseInt(r.paddingRight)};if(!isNaN(n.left)&&!isNaN(n.right))e.cachedPaddingH=n;return n}function ln(e){return ge-e.display.nativeBarWidth}function un(e){return e.display.scroller.clientWidth-ln(e)-e.display.barWidth}function cn(e){return e.display.scroller.clientHeight-ln(e)-e.display.barHeight}function hn(e,t,r){var n=e.options.lineWrapping;var i=n&&un(e);if(!t.measure.heights||n&&t.measure.width!=i){var o=t.measure.heights=[];if(n){t.measure.width=i;var a=t.text.firstChild.getClientRects();for(var s=0;s<a.length-1;s++){var l=a[s],u=a[s+1];if(Math.abs(l.bottom-u.bottom)>2)o.push((l.bottom+u.top)/2-r.top)}}o.push(r.bottom-r.top)}}function fn(e,t,r){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache};if(e.rest){for(var n=0;n<e.rest.length;n++)if(e.rest[n]==t)return{map:e.measure.maps[n],cache:e.measure.caches[n]};for(var i=0;i<e.rest.length;i++)if(E(e.rest[i])>r)return{map:e.measure.maps[i],cache:e.measure.caches[i],before:true}}}function dn(e,t){t=dr(t);var r=E(t);var n=e.display.externalMeasured=new Rr(e.doc,t,r);n.lineN=r;var i=n.built=Ar(e,n);n.text=i.pre;o(e.display.lineMeasure,i.pre);return n}function pn(e,t,r,n){return yn(e,gn(e,t),r,n)}function mn(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo)return e.display.view[Yn(e,t)];var r=e.display.externalMeasured;if(r&&t>=r.lineN&&t<r.lineN+r.size)return r}function gn(e,t){var r=E(t);var n=mn(e,r);if(n&&!n.text)n=null;else if(n&&n.changes){Wr(e,n,r,Zn(e));e.curOp.forceUpdate=true}if(!n)n=dn(e,t);var i=fn(n,t,r);return{line:t,view:n,rect:null,map:i.map,cache:i.cache,before:i.before,hasHeights:false}}function yn(e,t,r,n,i){if(t.before)r=-1;var o=r+(n||""),a;if(t.cache.hasOwnProperty(o))a=t.cache[o];else{if(!t.rect)t.rect=t.view.text.getBoundingClientRect();if(!t.hasHeights){hn(e,t.view,t.rect);t.hasHeights=true}a=wn(e,t,r,n);if(!a.bogus)t.cache[o]=a}return{left:a.left,right:a.right,top:i?a.rtop:a.top,bottom:i?a.rbottom:a.bottom}}var vn={left:0,right:0,top:0,bottom:0},_n;function xn(e,t,r){var n,i,o,a,s,l;for(var u=0;u<e.length;u+=3){s=e[u];l=e[u+1];if(t<s){i=0;o=1;a="left"}else if(t<l){i=t-s;o=i+1}else if(u==e.length-3||t==l&&e[u+3]>t){o=l-s;i=o-1;if(t>=l)a="right"}if(i!=null){n=e[u+2];if(s==l&&r==(n.insertLeft?"left":"right"))a=r;if(r=="left"&&i==0)while(u&&e[u-2]==e[u-3]&&e[u-1].insertLeft){n=e[(u-=3)+2];a="left"}if(r=="right"&&i==l-s)while(u<e.length-3&&e[u+3]==e[u+4]&&!e[u+5].insertLeft){n=e[(u+=3)+2];a="right"}break}}return{node:n,start:i,end:o,collapse:a,coverStart:s,coverEnd:l}}function bn(e,t){var r=vn;if(t=="left"){for(var n=0;n<e.length;n++)if((r=e[n]).left!=r.right)break}else for(var i=e.length-1;i>=0;i--)if((r=e[i]).left!=r.right)break;return r}function wn(e,t,r,n){var i=xn(t.map,r,n);var o=i.node,a=i.start,s=i.end,l=i.collapse;var u;if(o.nodeType==3){for(var c=0;c<4;c++){while(a&&ze(t.line.text.charAt(i.coverStart+a)))--a;while(i.coverStart+s<i.coverEnd&&ze(t.line.text.charAt(i.coverStart+s)))++s;if(T&&b<9&&a==0&&s==i.coverEnd-i.coverStart)u=o.parentNode.getBoundingClientRect();else u=bn(ie(o,a,s).getClientRects(),n);if(u.left||u.right||a==0)break;s=a;a=a-1;l="right"}if(T&&b<11)u=En(e.display.measure,u)}else{if(a>0)l=n="right";var h;if(e.options.lineWrapping&&(h=o.getClientRects()).length>1)u=h[n=="right"?h.length-1:0];else u=o.getBoundingClientRect()}if(T&&b<9&&!a&&(!u||!u.left&&!u.right)){var f=o.parentNode.getClientRects()[0];if(f)u={left:f.left,right:f.left+Wn(e.display),top:f.top,bottom:f.bottom};else u=vn}var d=u.top-t.rect.top,p=u.bottom-t.rect.top;var m=(d+p)/2;var g=t.view.measure.heights;var y=0;for(;y<g.length-1;y++)if(m<g[y])break;var v=y?g[y-1]:0,_=g[y];var x={left:(l=="right"?u.right:u.left)-t.rect.left,right:(l=="left"?u.left:u.right)-t.rect.left,top:v,bottom:_};if(!u.left&&!u.right)x.bogus=true;if(!e.options.singleCursorHeightPerLine){x.rtop=d;x.rbottom=p}return x}function En(e,t){if(!window.screen||screen.logicalXDPI==null||screen.logicalXDPI==screen.deviceXDPI||!ot(e))return t;var r=screen.logicalXDPI/screen.deviceXDPI;var n=screen.logicalYDPI/screen.deviceYDPI;return{left:t.left*r,right:t.right*r,top:t.top*n,bottom:t.bottom*n}}function Tn(e){if(e.measure){e.measure.cache={};e.measure.heights=null;if(e.rest)for(var t=0;t<e.rest.length;t++)e.measure.caches[t]={}}}function Sn(e){e.display.externalMeasure=null;oe(e.display.lineMeasure);for(var t=0;t<e.display.view.length;t++)Tn(e.display.view[t])}function Mn(e){Sn(e);e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null;if(!e.options.lineWrapping)e.display.maxLineChanged=true;e.display.lineNumChars=null}function kn(e){if(U&&X)return-(e.body.getBoundingClientRect().left-parseInt(getComputedStyle(e.body).marginLeft));return e.defaultView.pageXOffset||(e.documentElement||e.body).scrollLeft}function Cn(e){if(U&&X)return-(e.body.getBoundingClientRect().top-parseInt(getComputedStyle(e.body).marginTop));return e.defaultView.pageYOffset||(e.documentElement||e.body).scrollTop}function An(e){var t=dr(e);var r=t.widgets;var n=0;if(r)for(var i=0;i<r.length;++i)if(r[i].above)n+=rn(r[i]);return n}function In(e,t,r,n,i){if(!i){var o=An(t);r.top+=o;r.bottom+=o}if(n=="line")return r;if(!n)n="local";var a=xr(t);if(n=="local")a+=on(e.display);else a-=e.display.viewOffset;if(n=="page"||n=="window"){var s=e.display.lineSpace.getBoundingClientRect();a+=s.top+(n=="window"?0:Cn(he(e)));var l=s.left+(n=="window"?0:kn(he(e)));r.left+=l;r.right+=l}r.top+=a;r.bottom+=a;return r}function Ln(e,t,r){if(r=="div")return t;var n=t.left,i=t.top;if(r=="page"){n-=kn(he(e));i-=Cn(he(e))}else if(r=="local"||!r){var o=e.display.sizer.getBoundingClientRect();n+=o.left;i+=o.top}var a=e.display.lineSpace.getBoundingClientRect();return{left:n-a.left,top:i-a.top}}function Pn(e,t,r,n,i){if(!n)n=L(e.doc,t.line);return In(e,n,pn(e,n,t.ch,i),r)}function zn(n,e,i,o,a,s){o=o||L(n.doc,e.line);if(!a)a=gn(n,o);function l(e,t){var r=yn(n,a,e,t?"right":"left",s);if(t)r.left=r.right;else r.right=r.left;return In(n,o,r,i)}var u=je(o,n.doc.direction),t=e.ch,r=e.sticky;if(t>=o.text.length){t=o.text.length;r="before"}else if(t<=0){t=0;r="after"}if(!u)return l(r=="before"?t-1:t,r=="before");function c(e,t,r){var n=u[t],i=n.level==1;return l(r?e-1:e,i!=r)}var h=Be(u,t,r);var f=Fe;var d=c(t,h,r=="before");if(f!=null)d.other=c(t,f,r!="before");return d}function Dn(e,t){var r=0;t=I(e.doc,t);if(!e.options.lineWrapping)r=Wn(e.display)*t.ch;var n=L(e.doc,t.line);var i=xr(n)+on(e.display);return{left:r,right:r,top:i,bottom:i+n.height}}function On(e,t,r,n,i){var o=P(e,t,r);o.xRel=i;if(n)o.outside=n;return o}function Rn(e,t,r){var n=e.doc;r+=e.display.viewOffset;if(r<0)return On(n.first,0,null,-1,-1);var i=xt(n,r),o=n.first+n.size-1;if(i>o)return On(n.first+n.size-1,L(n,o).text.length,null,1,1);if(t<0)t=0;var a=L(n,i);for(;;){var s=jn(e,a,i,t,r);var l=hr(a,s.ch+(s.xRel>0||s.outside>0?1:0));if(!l)return s;var u=l.find(1);if(u.line==i)return u;a=L(n,i=u.line)}}function Fn(t,e,r,n){n-=An(e);var i=e.text.length;var o=Oe(function(e){return yn(t,r,e-1).bottom<=n},i,0);i=Oe(function(e){return yn(t,r,e).top>n},o,i);return{begin:o,end:i}}function Bn(e,t,r,n){if(!r)r=gn(e,t);var i=In(e,t,yn(e,r,n),"line").top;return Fn(e,t,r,i)}function Nn(e,t,r,n){return e.bottom<=r?false:e.top>r?true:(n?e.left:e.right)>t}function jn(r,e,t,n,i){i-=xr(e);var o=gn(r,e);var a=An(e);var s=0,l=e.text.length,u=true;var c=je(e,r.doc.direction);if(c){var h=(r.options.lineWrapping?Vn:Un)(r,e,t,o,c,n,i);u=h.level!=1;s=u?h.from:h.to-1;l=u?h.to:h.from-1}var f=null,d=null;var p=Oe(function(e){var t=yn(r,o,e);t.top+=a;t.bottom+=a;if(!Nn(t,n,i,false))return false;if(t.top<=i&&t.left<=n){f=e;d=t}return true},s,l);var m,g,y=false;if(d){var v=n-d.left<d.right-n,_=v==u;p=f+(_?0:1);g=_?"after":"before";m=v?d.left:d.right}else{if(!u&&(p==l||p==s))p++;g=p==0?"after":p==e.text.length?"before":yn(r,o,p-(u?1:0)).bottom+a<=i==u?"after":"before";var x=zn(r,P(t,p,g),"line",e,o);m=x.left;y=i<x.top?-1:i>=x.bottom?1:0}p=De(e.text,p,1);return On(t,p,g,y,n-m)}function Un(n,i,o,a,s,l,u){var e=Oe(function(e){var t=s[e],r=t.level!=1;return Nn(zn(n,P(o,r?t.to:t.from,r?"before":"after"),"line",i,a),l,u,true)},0,s.length-1);var t=s[e];if(e>0){var r=t.level!=1;var c=zn(n,P(o,r?t.from:t.to,r?"after":"before"),"line",i,a);if(Nn(c,l,u,true)&&c.top>u)t=s[e-1]}return t}function Vn(e,t,r,n,i,o,a){var s=Fn(e,t,n,a);var l=s.begin;var u=s.end;if(/\s/.test(t.text.charAt(u-1)))u--;var c=null,h=null;for(var f=0;f<i.length;f++){var d=i[f];if(d.from>=u||d.to<=l)continue;var p=d.level!=1;var m=yn(e,n,p?Math.min(u,d.to)-1:Math.max(l,d.from)).right;var g=m<o?o-m+1e9:m-o;if(!c||h>g){c=d;h=g}}if(!c)c=i[i.length-1];if(c.from<l)c={from:l,to:c.to,level:c.level};if(c.to>u)c={from:c.from,to:u,level:c.level};return c}function Gn(e){if(e.cachedTextHeight!=null)return e.cachedTextHeight;if(_n==null){_n=w("pre",null,"CodeMirror-line-like");for(var t=0;t<49;++t){_n.appendChild(document.createTextNode("x"));_n.appendChild(w("br"))}_n.appendChild(document.createTextNode("x"))}o(e.measure,_n);var r=_n.offsetHeight/50;if(r>3)e.cachedTextHeight=r;oe(e.measure);return r||1}function Wn(e){if(e.cachedCharWidth!=null)return e.cachedCharWidth;var t=w("span","xxxxxxxxxx");var r=w("pre",[t],"CodeMirror-line-like");o(e.measure,r);var n=t.getBoundingClientRect(),i=(n.right-n.left)/10;if(i>2)e.cachedCharWidth=i;return i||10}function Zn(e){var t=e.display,r={},n={};var i=t.gutters.clientLeft;for(var o=t.gutters.firstChild,a=0;o;o=o.nextSibling,++a){var s=e.display.gutterSpecs[a].className;r[s]=o.offsetLeft+o.clientLeft+i;n[s]=o.clientWidth}return{fixedPos:qn(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:r,gutterWidth:n,wrapperWidth:t.wrapper.clientWidth}}function qn(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function Hn(n){var i=Gn(n.display),o=n.options.lineWrapping;var a=o&&Math.max(5,n.display.scroller.clientWidth/Wn(n.display)-3);return function(e){if(vr(n.doc,e))return 0;var t=0;if(e.widgets)for(var r=0;r<e.widgets.length;r++)if(e.widgets[r].height)t+=e.widgets[r].height;if(o)return t+(Math.ceil(e.text.length/a)||1)*i;else return t+i}}function $n(e){var t=e.doc,r=Hn(e);t.iter(function(e){var t=r(e);if(t!=e.height)_t(e,t)})}function Xn(e,t,r,n){var i=e.display;if(!r&&$e(t).getAttribute("cm-not-content")=="true")return null;var o,a,s=i.lineSpace.getBoundingClientRect();try{o=t.clientX-s.left;a=t.clientY-s.top}catch(e){return null}var l=Rn(e,o,a),u;if(n&&l.xRel>0&&(u=L(e.doc,l.line).text).length==l.ch){var c=S(u,u.length,e.options.tabSize)-u.length;l=P(l.line,Math.max(0,Math.round((o-sn(e.display).left)/Wn(e.display))-c))}return l}function Yn(e,t){if(t>=e.display.viewTo)return null;t-=e.display.viewFrom;if(t<0)return null;var r=e.display.view;for(var n=0;n<r.length;n++){t-=r[n].size;if(t<0)return n}}function z(e,t,r,n){if(t==null)t=e.doc.first;if(r==null)r=e.doc.first+e.doc.size;if(!n)n=0;var i=e.display;if(n&&r<i.viewTo&&(i.updateLineNumbers==null||i.updateLineNumbers>t))i.updateLineNumbers=t;e.curOp.viewChanged=true;if(t>=i.viewTo){if(Zt&&gr(e.doc,t)<i.viewTo)Kn(e)}else if(r<=i.viewFrom)if(Zt&&yr(e.doc,r+n)>i.viewFrom)Kn(e);else{i.viewFrom+=n;i.viewTo+=n}else if(t<=i.viewFrom&&r>=i.viewTo)Kn(e);else if(t<=i.viewFrom){var o=Qn(e,r,r+n,1);if(o){i.view=i.view.slice(o.index);i.viewFrom=o.lineN;i.viewTo+=n}else Kn(e)}else if(r>=i.viewTo){var a=Qn(e,t,t,-1);if(a){i.view=i.view.slice(0,a.index);i.viewTo=a.lineN}else Kn(e)}else{var s=Qn(e,t,t,-1);var l=Qn(e,r,r+n,1);if(s&&l){i.view=i.view.slice(0,s.index).concat(Fr(e,s.lineN,l.lineN)).concat(i.view.slice(l.index));i.viewTo+=n}else Kn(e)}var u=i.externalMeasured;if(u)if(r<u.lineN)u.lineN+=n;else if(t<u.lineN+u.size)i.externalMeasured=null}function Jn(e,t,r){e.curOp.viewChanged=true;var n=e.display,i=e.display.externalMeasured;if(i&&t>=i.lineN&&t<i.lineN+i.size)n.externalMeasured=null;if(t<n.viewFrom||t>=n.viewTo)return;var o=n.view[Yn(e,t)];if(o.node==null)return;var a=o.changes||(o.changes=[]);if(m(a,r)==-1)a.push(r)}function Kn(e){e.display.viewFrom=e.display.viewTo=e.doc.first;e.display.view=[];e.display.viewOffset=0}function Qn(e,t,r,n){var i=Yn(e,t),o,a=e.display.view;if(!Zt||r==e.doc.first+e.doc.size)return{index:i,lineN:r};var s=e.display.viewFrom;for(var l=0;l<i;l++)s+=a[l].size;if(s!=t){if(n>0){if(i==a.length-1)return null;o=s+a[i].size-t;i++}else o=s-t;t+=o;r+=o}while(gr(e.doc,r)!=r){if(i==(n<0?0:a.length-1))return null;r+=n*a[i-(n<0?1:0)].size;i+=n}return{index:i,lineN:r}}function ei(e,t,r){var n=e.display,i=n.view;if(i.length==0||t>=n.viewTo||r<=n.viewFrom){n.view=Fr(e,t,r);n.viewFrom=t}else{if(n.viewFrom>t)n.view=Fr(e,t,n.viewFrom).concat(n.view);else if(n.viewFrom<t)n.view=n.view.slice(Yn(e,t));n.viewFrom=t;if(n.viewTo<r)n.view=n.view.concat(Fr(e,n.viewTo,r));else if(n.viewTo>r)n.view=n.view.slice(0,Yn(e,r))}n.viewTo=r}function ti(e){var t=e.display.view,r=0;for(var n=0;n<t.length;n++){var i=t[n];if(!i.hidden&&(!i.node||i.changes))++r}return r}function ri(e){e.display.input.showSelection(e.display.input.prepareSelection())}function ni(e,t){if(t===void 0)t=true;var r=e.doc,n={};var i=n.cursors=document.createDocumentFragment();var o=n.selection=document.createDocumentFragment();var a=e.options.$customCursor;if(a)t=true;for(var s=0;s<r.sel.ranges.length;s++){if(!t&&s==r.sel.primIndex)continue;var l=r.sel.ranges[s];if(l.from().line>=e.display.viewTo||l.to().line<e.display.viewFrom)continue;var u=l.empty();if(a){var c=a(e,l);if(c)ii(e,c,i)}else if(u||e.options.showCursorWhenSelecting)ii(e,l.head,i);if(!u)ai(e,l,o)}return n}function ii(e,t,r){var n=zn(e,t,"div",null,null,!e.options.singleCursorHeightPerLine);var i=r.appendChild(w("div"," ","CodeMirror-cursor"));i.style.left=n.left+"px";i.style.top=n.top+"px";i.style.height=Math.max(0,n.bottom-n.top)*e.options.cursorHeight+"px";if(/\bcm-fat-cursor\b/.test(e.getWrapperElement().className)){var o=Pn(e,t,"div",null,null);var a=o.right-o.left;i.style.width=(a>0?a:e.defaultCharWidth())+"px"}if(n.other){var s=r.appendChild(w("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));s.style.display="";s.style.left=n.other.left+"px";s.style.top=n.other.top+"px";s.style.height=(n.other.bottom-n.other.top)*.85+"px"}}function oi(e,t){return e.top-t.top||e.left-t.left}function ai(s,e,t){var r=s.display,n=s.doc;var i=document.createDocumentFragment();var o=sn(s.display),k=o.left;var C=Math.max(r.sizerWidth,un(s)-r.sizer.offsetLeft)-o.right;var A=n.direction=="ltr";function I(e,t,r,n){if(t<0)t=0;t=Math.round(t);n=Math.round(n);i.appendChild(w("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px;\n                             top: "+t+"px; width: "+(r==null?C-e:r)+"px;\n                             height: "+(n-t)+"px"))}function a(r,_,x){var a=L(n,r);var b=a.text.length;var w,E;function T(e,t){return Pn(s,P(r,e),"div",a,t)}function S(e,t,r){var n=Bn(s,a,null,e);var i=t=="ltr"==(r=="after")?"left":"right";var o=r=="after"?n.begin:n.end-(/\s/.test(a.text.charAt(n.end-1))?2:1);return T(o,i)[i]}var M=je(a,n.direction);Re(M,_||0,x==null?b:x,function(e,t,r,n){var i=r=="ltr";var o=T(e,i?"left":"right");var a=T(t-1,i?"right":"left");var s=_==null&&e==0,l=x==null&&t==b;var u=n==0,c=!M||n==M.length-1;if(a.top-o.top<=3){var h=(A?s:l)&&u;var f=(A?l:s)&&c;var d=h?k:(i?o:a).left;var p=f?C:(i?a:o).right;I(d,o.top,p-d,o.bottom)}else{var m,g,y,v;if(i){m=A&&s&&u?k:o.left;g=A?C:S(e,r,"before");y=A?k:S(t,r,"after");v=A&&l&&c?C:a.right}else{m=!A?k:S(e,r,"before");g=!A&&s&&u?C:o.right;y=!A&&l&&c?k:a.left;v=!A?C:S(t,r,"after")}I(m,o.top,g-m,o.bottom);if(o.bottom<a.top)I(k,o.bottom,null,a.top);I(y,a.top,v-y,a.bottom)}if(!w||oi(o,w)<0)w=o;if(oi(a,w)<0)w=a;if(!E||oi(o,E)<0)E=o;if(oi(a,E)<0)E=a});return{start:w,end:E}}var l=e.from(),u=e.to();if(l.line==u.line)a(l.line,l.ch,u.ch);else{var c=L(n,l.line),h=L(n,u.line);var f=dr(c)==dr(h);var d=a(l.line,l.ch,f?c.text.length+1:null).end;var p=a(u.line,f?0:null,u.ch).start;if(f)if(d.top<p.top-2){I(d.right,d.top,null,d.bottom);I(k,p.top,p.left,p.bottom)}else I(d.right,d.top,p.left-d.right,d.bottom);if(d.bottom<p.top)I(k,d.bottom,null,p.top)}t.appendChild(i)}function si(e){if(!e.state.focused)return;var t=e.display;clearInterval(t.blinker);var r=true;t.cursorDiv.style.visibility="";if(e.options.cursorBlinkRate>0)t.blinker=setInterval(function(){if(!e.hasFocus())hi(e);t.cursorDiv.style.visibility=(r=!r)?"":"hidden"},e.options.cursorBlinkRate);else if(e.options.cursorBlinkRate<0)t.cursorDiv.style.visibility="hidden"}function li(e){if(!e.hasFocus()){e.display.input.focus();if(!e.state.focused)ci(e)}}function ui(e){e.state.delayingBlurEvent=true;setTimeout(function(){if(e.state.delayingBlurEvent){e.state.delayingBlurEvent=false;if(e.state.focused)hi(e)}},100)}function ci(e,t){if(e.state.delayingBlurEvent&&!e.state.draggingText)e.state.delayingBlurEvent=false;if(e.options.readOnly=="nocursor")return;if(!e.state.focused){p(e,"focus",e,t);e.state.focused=true;le(e.display.wrapper,"CodeMirror-focused");if(!e.curOp&&e.display.selForContextMenu!=e.doc.sel){e.display.input.reset();if(g)setTimeout(function(){return e.display.input.reset(true)},20)}e.display.input.receivedFocus()}si(e)}function hi(e,t){if(e.state.delayingBlurEvent)return;if(e.state.focused){p(e,"blur",e,t);e.state.focused=false;ne(e.display.wrapper,"CodeMirror-focused")}clearInterval(e.display.blinker);setTimeout(function(){if(!e.state.focused)e.display.shift=false},150)}function fi(e){var t=e.display;var r=t.lineDiv.offsetTop;var n=Math.max(0,t.scroller.getBoundingClientRect().top);var i=t.lineDiv.getBoundingClientRect().top;var o=0;for(var a=0;a<t.view.length;a++){var s=t.view[a],l=e.options.lineWrapping;var u=void 0,c=0;if(s.hidden)continue;i+=s.line.height;if(T&&b<8){var h=s.node.offsetTop+s.node.offsetHeight;u=h-r;r=h}else{var f=s.node.getBoundingClientRect();u=f.bottom-f.top;if(!l&&s.text.firstChild)c=s.text.firstChild.getBoundingClientRect().right-f.left-1}var d=s.line.height-u;if(d>.005||d<-.005){if(i<n)o-=d;_t(s.line,u);di(s.line);if(s.rest)for(var p=0;p<s.rest.length;p++)di(s.rest[p])}if(c>e.display.sizerWidth){var m=Math.ceil(c/Wn(e.display));if(m>e.display.maxLineLength){e.display.maxLineLength=m;e.display.maxLine=s.line;e.display.maxLineChanged=true}}}if(Math.abs(o)>2)t.scroller.scrollTop+=o}function di(e){if(e.widgets)for(var t=0;t<e.widgets.length;++t){var r=e.widgets[t],n=r.node.parentNode;if(n)r.height=n.offsetHeight}}function pi(e,t,r){var n=r&&r.top!=null?Math.max(0,r.top):e.scroller.scrollTop;n=Math.floor(n-on(e));var i=r&&r.bottom!=null?r.bottom:n+e.wrapper.clientHeight;var o=xt(t,n),a=xt(t,i);if(r&&r.ensure){var s=r.ensure.from.line,l=r.ensure.to.line;if(s<o){o=s;a=xt(t,xr(L(t,s))+e.wrapper.clientHeight)}else if(Math.min(l,t.lastLine())>=a){o=xt(t,xr(L(t,l))-e.wrapper.clientHeight);a=l}}return{from:o,to:Math.max(a,o+1)}}function mi(e,t){if(d(e,"scrollCursorIntoView"))return;var r=e.display,n=r.sizer.getBoundingClientRect(),i=null;var o=r.wrapper.ownerDocument;if(t.top+n.top<0)i=true;else if(t.bottom+n.top>(o.defaultView.innerHeight||o.documentElement.clientHeight))i=false;if(i!=null&&!H){var a=w("div","​",null,"position: absolute;\n                         top: "+(t.top-r.viewOffset-on(e.display))+"px;\n                         height: "+(t.bottom-t.top+ln(e)+r.barHeight)+"px;\n                         left: "+t.left+"px; width: "+Math.max(2,t.right-t.left)+"px;");e.display.lineSpace.appendChild(a);a.scrollIntoView(i);e.display.lineSpace.removeChild(a)}}function gi(e,t,r,n){if(n==null)n=0;var i;if(!e.options.lineWrapping&&t==r){r=t.sticky=="before"?P(t.line,t.ch+1,"before"):t;t=t.ch?P(t.line,t.sticky=="before"?t.ch-1:t.ch,"after"):t}for(var o=0;o<5;o++){var a=false;var s=zn(e,t);var l=!r||r==t?s:zn(e,r);i={left:Math.min(s.left,l.left),top:Math.min(s.top,l.top)-n,right:Math.max(s.left,l.left),bottom:Math.max(s.bottom,l.bottom)+n};var u=vi(e,i);var c=e.doc.scrollTop,h=e.doc.scrollLeft;if(u.scrollTop!=null){Si(e,u.scrollTop);if(Math.abs(e.doc.scrollTop-c)>1)a=true}if(u.scrollLeft!=null){ki(e,u.scrollLeft);if(Math.abs(e.doc.scrollLeft-h)>1)a=true}if(!a)break}return i}function yi(e,t){var r=vi(e,t);if(r.scrollTop!=null)Si(e,r.scrollTop);if(r.scrollLeft!=null)ki(e,r.scrollLeft)}function vi(e,t){var r=e.display,n=Gn(e.display);if(t.top<0)t.top=0;var i=e.curOp&&e.curOp.scrollTop!=null?e.curOp.scrollTop:r.scroller.scrollTop;var o=cn(e),a={};if(t.bottom-t.top>o)t.bottom=t.top+o;var s=e.doc.height+an(r);var l=t.top<n,u=t.bottom>s-n;if(t.top<i)a.scrollTop=l?0:t.top;else if(t.bottom>i+o){var c=Math.min(t.top,(u?s:t.bottom)-o);if(c!=i)a.scrollTop=c}var h=e.options.fixedGutter?0:r.gutters.offsetWidth;var f=e.curOp&&e.curOp.scrollLeft!=null?e.curOp.scrollLeft:r.scroller.scrollLeft-h;var d=un(e)-r.gutters.offsetWidth;var p=t.right-t.left>d;if(p)t.right=t.left+d;if(t.left<10)a.scrollLeft=0;else if(t.left<f)a.scrollLeft=Math.max(0,t.left+h-(p?0:10));else if(t.right>d+f-3)a.scrollLeft=t.right+(p?0:10)-d;return a}function _i(e,t){if(t==null)return;Ei(e);e.curOp.scrollTop=(e.curOp.scrollTop==null?e.doc.scrollTop:e.curOp.scrollTop)+t}function xi(e){Ei(e);var t=e.getCursor();e.curOp.scrollToPos={from:t,to:t,margin:e.options.cursorScrollMargin}}function bi(e,t,r){if(t!=null||r!=null)Ei(e);if(t!=null)e.curOp.scrollLeft=t;if(r!=null)e.curOp.scrollTop=r}function wi(e,t){Ei(e);e.curOp.scrollToPos=t}function Ei(e){var t=e.curOp.scrollToPos;if(t){e.curOp.scrollToPos=null;var r=Dn(e,t.from),n=Dn(e,t.to);Ti(e,r,n,t.margin)}}function Ti(e,t,r,n){var i=vi(e,{left:Math.min(t.left,r.left),top:Math.min(t.top,r.top)-n,right:Math.max(t.right,r.right),bottom:Math.max(t.bottom,r.bottom)+n});bi(e,i.scrollLeft,i.scrollTop)}function Si(e,t){if(Math.abs(e.doc.scrollTop-t)<2)return;if(!B)Ki(e,{top:t});Mi(e,t,true);if(B)Ki(e);Wi(e,100)}function Mi(e,t,r){t=Math.max(0,Math.min(e.display.scroller.scrollHeight-e.display.scroller.clientHeight,t));if(e.display.scroller.scrollTop==t&&!r)return;e.doc.scrollTop=t;e.display.scrollbars.setScrollTop(t);if(e.display.scroller.scrollTop!=t)e.display.scroller.scrollTop=t}function ki(e,t,r,n){t=Math.max(0,Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth));if((r?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)&&!n)return;e.doc.scrollLeft=t;ro(e);if(e.display.scroller.scrollLeft!=t)e.display.scroller.scrollLeft=t;e.display.scrollbars.setScrollLeft(t)}function Ci(e){var t=e.display,r=t.gutters.offsetWidth;var n=Math.round(e.doc.height+an(e.display));return{clientHeight:t.scroller.clientHeight,viewHeight:t.wrapper.clientHeight,scrollWidth:t.scroller.scrollWidth,clientWidth:t.scroller.clientWidth,viewWidth:t.wrapper.clientWidth,barLeft:e.options.fixedGutter?r:0,docHeight:n,scrollHeight:n+ln(e)+t.barHeight,nativeBarWidth:t.nativeBarWidth,gutterWidth:r}}var Ai=function(e,t,r){this.cm=r;var n=this.vert=w("div",[w("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar");var i=this.horiz=w("div",[w("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");n.tabIndex=i.tabIndex=-1;e(n);e(i);M(n,"scroll",function(){if(n.clientHeight)t(n.scrollTop,"vertical")});M(i,"scroll",function(){if(i.clientWidth)t(i.scrollLeft,"horizontal")});this.checkedZeroWidth=false;if(T&&b<8)this.horiz.style.minHeight=this.vert.style.minWidth="18px"},Ii=(Ai.prototype.update=function(e){var t=e.scrollWidth>e.clientWidth+1;var r=e.scrollHeight>e.clientHeight+1;var n=e.nativeBarWidth;if(r){this.vert.style.display="block";this.vert.style.bottom=t?n+"px":"0";var i=e.viewHeight-(t?n:0);this.vert.firstChild.style.height=Math.max(0,e.scrollHeight-e.clientHeight+i)+"px"}else{this.vert.scrollTop=0;this.vert.style.display="";this.vert.firstChild.style.height="0"}if(t){this.horiz.style.display="block";this.horiz.style.right=r?n+"px":"0";this.horiz.style.left=e.barLeft+"px";var o=e.viewWidth-e.barLeft-(r?n:0);this.horiz.firstChild.style.width=Math.max(0,e.scrollWidth-e.clientWidth+o)+"px"}else{this.horiz.style.display="";this.horiz.firstChild.style.width="0"}if(!this.checkedZeroWidth&&e.clientHeight>0){if(n==0)this.zeroWidthHack();this.checkedZeroWidth=true}return{right:r?n:0,bottom:t?n:0}},Ai.prototype.setScrollLeft=function(e){if(this.horiz.scrollLeft!=e)this.horiz.scrollLeft=e;if(this.disableHoriz)this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},Ai.prototype.setScrollTop=function(e){if(this.vert.scrollTop!=e)this.vert.scrollTop=e;if(this.disableVert)this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},Ai.prototype.zeroWidthHack=function(){var e=y&&!q?"12px":"18px";this.horiz.style.height=this.vert.style.width=e;this.horiz.style.visibility=this.vert.style.visibility="hidden";this.disableHoriz=new me;this.disableVert=new me},Ai.prototype.enableZeroWidthBar=function(r,n,i){r.style.visibility="";function o(){var e=r.getBoundingClientRect();var t=i=="vert"?document.elementFromPoint(e.right-1,(e.top+e.bottom)/2):document.elementFromPoint((e.right+e.left)/2,e.bottom-1);if(t!=r)r.style.visibility="hidden";else n.set(1e3,o)}n.set(1e3,o)},Ai.prototype.clear=function(){var e=this.horiz.parentNode;e.removeChild(this.horiz);e.removeChild(this.vert)},function(){});function Li(e,t){if(!t)t=Ci(e);var r=e.display.barWidth,n=e.display.barHeight;Pi(e,t);for(var i=0;i<4&&r!=e.display.barWidth||n!=e.display.barHeight;i++){if(r!=e.display.barWidth&&e.options.lineWrapping)fi(e);Pi(e,Ci(e));r=e.display.barWidth;n=e.display.barHeight}}function Pi(e,t){var r=e.display;var n=r.scrollbars.update(t);r.sizer.style.paddingRight=(r.barWidth=n.right)+"px";r.sizer.style.paddingBottom=(r.barHeight=n.bottom)+"px";r.heightForcer.style.borderBottom=n.bottom+"px solid transparent";if(n.right&&n.bottom){r.scrollbarFiller.style.display="block";r.scrollbarFiller.style.height=n.bottom+"px";r.scrollbarFiller.style.width=n.right+"px"}else r.scrollbarFiller.style.display="";if(n.bottom&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter){r.gutterFiller.style.display="block";r.gutterFiller.style.height=n.bottom+"px";r.gutterFiller.style.width=t.gutterWidth+"px"}else r.gutterFiller.style.display=""}Ii.prototype.update=function(){return{bottom:0,right:0}},Ii.prototype.setScrollLeft=function(){},Ii.prototype.setScrollTop=function(){},Ii.prototype.clear=function(){};var zi={native:Ai,null:Ii};function Di(r){if(r.display.scrollbars){r.display.scrollbars.clear();if(r.display.scrollbars.addClass)ne(r.display.wrapper,r.display.scrollbars.addClass)}r.display.scrollbars=new zi[r.options.scrollbarStyle](function(e){r.display.wrapper.insertBefore(e,r.display.scrollbarFiller);M(e,"mousedown",function(){if(r.state.focused)setTimeout(function(){return r.display.input.focus()},0)});e.setAttribute("cm-not-content","true")},function(e,t){if(t=="horizontal")ki(r,e);else Si(r,e)},r);if(r.display.scrollbars.addClass)le(r.display.wrapper,r.display.scrollbars.addClass)}var Oi=0;function Ri(e){e.curOp={cm:e,viewChanged:false,startHeight:e.doc.height,forceUpdate:false,updateInput:0,typing:false,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:false,updateMaxLine:false,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:false,id:++Oi,markArrays:null};Nr(e.curOp)}function Fi(e){var t=e.curOp;if(t)Ur(t,function(e){for(var t=0;t<e.ops.length;t++)e.ops[t].cm.curOp=null;Bi(e)})}function Bi(e){var t=e.ops;for(var r=0;r<t.length;r++)Ni(t[r]);for(var n=0;n<t.length;n++)ji(t[n]);for(var i=0;i<t.length;i++)Ui(t[i]);for(var o=0;o<t.length;o++)Vi(t[o]);for(var a=0;a<t.length;a++)Gi(t[a])}function Ni(e){var t=e.cm,r=t.display;Hi(t);if(e.updateMaxLine)wr(t);e.mustUpdate=e.viewChanged||e.forceUpdate||e.scrollTop!=null||e.scrollToPos&&(e.scrollToPos.from.line<r.viewFrom||e.scrollToPos.to.line>=r.viewTo)||r.maxLineChanged&&t.options.lineWrapping;e.update=e.mustUpdate&&new qi(t,e.mustUpdate&&{top:e.scrollTop,ensure:e.scrollToPos},e.forceUpdate)}function ji(e){e.updatedDisplay=e.mustUpdate&&Yi(e.cm,e.update)}function Ui(e){var t=e.cm,r=t.display;if(e.updatedDisplay)fi(t);e.barMeasure=Ci(t);if(r.maxLineChanged&&!t.options.lineWrapping){e.adjustWidthTo=pn(t,r.maxLine,r.maxLine.text.length).left+3;t.display.sizerWidth=e.adjustWidthTo;e.barMeasure.scrollWidth=Math.max(r.scroller.clientWidth,r.sizer.offsetLeft+e.adjustWidthTo+ln(t)+t.display.barWidth);e.maxScrollLeft=Math.max(0,r.sizer.offsetLeft+e.adjustWidthTo-un(t))}if(e.updatedDisplay||e.selectionChanged)e.preparedSelection=r.input.prepareSelection()}function Vi(e){var t=e.cm;if(e.adjustWidthTo!=null){t.display.sizer.style.minWidth=e.adjustWidthTo+"px";if(e.maxScrollLeft<t.doc.scrollLeft)ki(t,Math.min(t.display.scroller.scrollLeft,e.maxScrollLeft),true);t.display.maxLineChanged=false}var r=e.focus&&e.focus==h(he(t));if(e.preparedSelection)t.display.input.showSelection(e.preparedSelection,r);if(e.updatedDisplay||e.startHeight!=t.doc.height)Li(t,e.barMeasure);if(e.updatedDisplay)to(t,e.barMeasure);if(e.selectionChanged)si(t);if(t.state.focused&&e.updateInput)t.display.input.reset(e.typing);if(r)li(e.cm)}function Gi(e){var t=e.cm,r=t.display,n=t.doc;if(e.updatedDisplay)Ji(t,e.update);if(r.wheelStartX!=null&&(e.scrollTop!=null||e.scrollLeft!=null||e.scrollToPos))r.wheelStartX=r.wheelStartY=null;if(e.scrollTop!=null)Mi(t,e.scrollTop,e.forceScroll);if(e.scrollLeft!=null)ki(t,e.scrollLeft,true,true);if(e.scrollToPos){var i=gi(t,I(n,e.scrollToPos.from),I(n,e.scrollToPos.to),e.scrollToPos.margin);mi(t,i)}var o=e.maybeHiddenMarkers,a=e.maybeUnhiddenMarkers;if(o)for(var s=0;s<o.length;++s)if(!o[s].lines.length)p(o[s],"hide");if(a)for(var l=0;l<a.length;++l)if(a[l].lines.length)p(a[l],"unhide");if(r.wrapper.offsetHeight)n.scrollTop=t.display.scroller.scrollTop;if(e.changeObjs)p(t,"changes",t,e.changeObjs);if(e.update)e.update.finish()}function D(e,t){if(e.curOp)return t();Ri(e);try{return t()}finally{Fi(e)}}function O(e,t){return function(){if(e.curOp)return t.apply(e,arguments);Ri(e);try{return t.apply(e,arguments)}finally{Fi(e)}}}function t(e){return function(){if(this.curOp)return e.apply(this,arguments);Ri(this);try{return e.apply(this,arguments)}finally{Fi(this)}}}function r(t){return function(){var e=this.cm;if(!e||e.curOp)return t.apply(this,arguments);Ri(e);try{return t.apply(this,arguments)}finally{Fi(e)}}}function Wi(e,t){if(e.doc.highlightFrontier<e.display.viewTo)e.state.highlight.set(t,de(Zi,e))}function Zi(l){var u=l.doc;if(u.highlightFrontier>=l.display.viewTo)return;var c=+new Date+l.options.workTime;var h=Dt(l,u.highlightFrontier);var f=[];u.iter(h.line,Math.min(u.first+u.size,l.display.viewTo+500),function(e){if(h.line>=l.display.viewFrom){var t=e.styles;var r=e.text.length>l.options.maxHighlightLength?pt(u.mode,h.state):null;var n=Pt(l,e,h,true);if(r)h.state=r;e.styles=n.styles;var i=e.styleClasses,o=n.classes;if(o)e.styleClasses=o;else if(i)e.styleClasses=null;var a=!t||t.length!=e.styles.length||i!=o&&(!i||!o||i.bgClass!=o.bgClass||i.textClass!=o.textClass);for(var s=0;!a&&s<t.length;++s)a=t[s]!=e.styles[s];if(a)f.push(h.line);e.stateAfter=h.save();h.nextLine()}else{if(e.text.length<=l.options.maxHighlightLength)Ot(l,e.text,h);e.stateAfter=h.line%5==0?h.save():null;h.nextLine()}if(+new Date>c){Wi(l,l.options.workDelay);return true}});u.highlightFrontier=h.line;u.modeFrontier=Math.max(u.modeFrontier,h.line);if(f.length)D(l,function(){for(var e=0;e<f.length;e++)Jn(l,f[e],"text")})}var qi=function(e,t,r){var n=e.display;this.viewport=t;this.visible=pi(n,e.doc,t);this.editorIsHidden=!n.wrapper.offsetWidth;this.wrapperHeight=n.wrapper.clientHeight;this.wrapperWidth=n.wrapper.clientWidth;this.oldDisplayWidth=un(e);this.force=r;this.dims=Zn(e);this.events=[]};function Hi(e){var t=e.display;if(!t.scrollbarsClipped&&t.scroller.offsetWidth){t.nativeBarWidth=t.scroller.offsetWidth-t.scroller.clientWidth;t.heightForcer.style.height=ln(e)+"px";t.sizer.style.marginBottom=-t.nativeBarWidth+"px";t.sizer.style.borderRightWidth=ln(e)+"px";t.scrollbarsClipped=true}}function $i(e){if(e.hasFocus())return null;var t=h(he(e));if(!t||!se(e.display.lineDiv,t))return null;var r={activeElt:t};if(window.getSelection){var n=fe(e).getSelection();if(n.anchorNode&&n.extend&&se(e.display.lineDiv,n.anchorNode)){r.anchorNode=n.anchorNode;r.anchorOffset=n.anchorOffset;r.focusNode=n.focusNode;r.focusOffset=n.focusOffset}}return r}function Xi(e){if(!e||!e.activeElt||e.activeElt==h(e.activeElt.ownerDocument))return;e.activeElt.focus();if(!/^(INPUT|TEXTAREA)$/.test(e.activeElt.nodeName)&&e.anchorNode&&se(document.body,e.anchorNode)&&se(document.body,e.focusNode)){var t=e.activeElt.ownerDocument;var r=t.defaultView.getSelection(),n=t.createRange();n.setEnd(e.anchorNode,e.anchorOffset);n.collapse(false);r.removeAllRanges();r.addRange(n);r.extend(e.focusNode,e.focusOffset)}}function Yi(e,t){var r=e.display,n=e.doc;if(t.editorIsHidden){Kn(e);return false}if(!t.force&&t.visible.from>=r.viewFrom&&t.visible.to<=r.viewTo&&(r.updateLineNumbers==null||r.updateLineNumbers>=r.viewTo)&&r.renderedView==r.view&&ti(e)==0)return false;if(no(e)){Kn(e);t.dims=Zn(e)}var i=n.first+n.size;var o=Math.max(t.visible.from-e.options.viewportMargin,n.first);var a=Math.min(i,t.visible.to+e.options.viewportMargin);if(r.viewFrom<o&&o-r.viewFrom<20)o=Math.max(n.first,r.viewFrom);if(r.viewTo>a&&r.viewTo-a<20)a=Math.min(i,r.viewTo);if(Zt){o=gr(e.doc,o);a=yr(e.doc,a)}var s=o!=r.viewFrom||a!=r.viewTo||r.lastWrapHeight!=t.wrapperHeight||r.lastWrapWidth!=t.wrapperWidth;ei(e,o,a);r.viewOffset=xr(L(e.doc,r.viewFrom));e.display.mover.style.top=r.viewOffset+"px";var l=ti(e);if(!s&&l==0&&!t.force&&r.renderedView==r.view&&(r.updateLineNumbers==null||r.updateLineNumbers>=r.viewTo))return false;var u=$i(e);if(l>4)r.lineDiv.style.display="none";Qi(e,r.updateLineNumbers,t.dims);if(l>4)r.lineDiv.style.display="";r.renderedView=r.view;Xi(u);oe(r.cursorDiv);oe(r.selectionDiv);r.gutters.style.height=r.sizer.style.minHeight=0;if(s){r.lastWrapHeight=t.wrapperHeight;r.lastWrapWidth=t.wrapperWidth;Wi(e,400)}r.updateLineNumbers=null;return true}function Ji(e,t){var r=t.viewport;for(var n=true;;n=false){if(!n||!e.options.lineWrapping||t.oldDisplayWidth==un(e)){if(r&&r.top!=null)r={top:Math.min(e.doc.height+an(e.display)-cn(e),r.top)};t.visible=pi(e.display,e.doc,r);if(t.visible.from>=e.display.viewFrom&&t.visible.to<=e.display.viewTo)break}else if(n)t.visible=pi(e.display,e.doc,r);if(!Yi(e,t))break;fi(e);var i=Ci(e);ri(e);Li(e,i);to(e,i);t.force=false}t.signal(e,"update",e);if(e.display.viewFrom!=e.display.reportedViewFrom||e.display.viewTo!=e.display.reportedViewTo){t.signal(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo);e.display.reportedViewFrom=e.display.viewFrom;e.display.reportedViewTo=e.display.viewTo}}function Ki(e,t){var r=new qi(e,t);if(Yi(e,r)){fi(e);Ji(e,r);var n=Ci(e);ri(e);Li(e,n);to(e,n);r.finish()}}function Qi(r,e,t){var n=r.display,i=r.options.lineNumbers;var o=n.lineDiv,a=o.firstChild;function s(e){var t=e.nextSibling;if(g&&y&&r.display.currentWheelTarget==e)e.style.display="none";else e.parentNode.removeChild(e);return t}var l=n.view,u=n.viewFrom;for(var c=0;c<l.length;c++){var h=l[c];if(h.hidden);else if(!h.node||h.node.parentNode!=o){var f=Kr(r,h,u,t);o.insertBefore(f,a)}else{while(a!=h.node)a=s(a);var d=i&&e!=null&&e<=u&&h.lineNumber;if(h.changes){if(m(h.changes,"gutter")>-1)d=false;Wr(r,h,u,t)}if(d){oe(h.lineNumber);h.lineNumber.appendChild(document.createTextNode(wt(r.options,u)))}a=h.node.nextSibling}u+=h.size}while(a)a=s(a)}function eo(e){var t=e.gutters.offsetWidth;e.sizer.style.marginLeft=t+"px";x(e,"gutterChanged",e)}function to(e,t){e.display.sizer.style.minHeight=t.docHeight+"px";e.display.heightForcer.style.top=t.docHeight+"px";e.display.gutters.style.height=t.docHeight+e.display.barHeight+ln(e)+"px"}function ro(e){var t=e.display,r=t.view;if(!t.alignWidgets&&(!t.gutters.firstChild||!e.options.fixedGutter))return;var n=qn(t)-t.scroller.scrollLeft+e.doc.scrollLeft;var i=t.gutters.offsetWidth,o=n+"px";for(var a=0;a<r.length;a++)if(!r[a].hidden){if(e.options.fixedGutter){if(r[a].gutter)r[a].gutter.style.left=o;if(r[a].gutterBackground)r[a].gutterBackground.style.left=o}var s=r[a].alignable;if(s)for(var l=0;l<s.length;l++)s[l].style.left=o}if(e.options.fixedGutter)t.gutters.style.left=n+i+"px"}function no(e){if(!e.options.lineNumbers)return false;var t=e.doc,r=wt(e.options,t.first+t.size-1),n=e.display;if(r.length!=n.lineNumChars){var i=n.measure.appendChild(w("div",[w("div",r)],"CodeMirror-linenumber CodeMirror-gutter-elt"));var o=i.firstChild.offsetWidth,a=i.offsetWidth-o;n.lineGutter.style.width="";n.lineNumInnerWidth=Math.max(o,n.lineGutter.offsetWidth-a)+1;n.lineNumWidth=n.lineNumInnerWidth+a;n.lineNumChars=n.lineNumInnerWidth?r.length:-1;n.lineGutter.style.width=n.lineNumWidth+"px";eo(e.display);return true}return false}function io(e,t){var r=[],n=false;for(var i=0;i<e.length;i++){var o=e[i],a=null;if(typeof o!="string"){a=o.style;o=o.className}if(o=="CodeMirror-linenumbers")if(!t)continue;else n=true;r.push({className:o,style:a})}if(t&&!n)r.push({className:"CodeMirror-linenumbers",style:null});return r}function oo(e){var t=e.gutters,r=e.gutterSpecs;oe(t);e.lineGutter=null;for(var n=0;n<r.length;++n){var i=r[n];var o=i.className;var a=i.style;var s=t.appendChild(w("div",null,"CodeMirror-gutter "+o));if(a)s.style.cssText=a;if(o=="CodeMirror-linenumbers"){e.lineGutter=s;s.style.width=(e.lineNumWidth||1)+"px"}}t.style.display=r.length?"":"none";eo(e)}function ao(e){oo(e.display);z(e);ro(e)}function so(e,t,r,n){var i=this;this.input=r;i.scrollbarFiller=w("div",null,"CodeMirror-scrollbar-filler");i.scrollbarFiller.setAttribute("cm-not-content","true");i.gutterFiller=w("div",null,"CodeMirror-gutter-filler");i.gutterFiller.setAttribute("cm-not-content","true");i.lineDiv=ae("div",null,"CodeMirror-code");i.selectionDiv=w("div",null,null,"position: relative; z-index: 1");i.cursorDiv=w("div",null,"CodeMirror-cursors");i.measure=w("div",null,"CodeMirror-measure");i.lineMeasure=w("div",null,"CodeMirror-measure");i.lineSpace=ae("div",[i.measure,i.lineMeasure,i.selectionDiv,i.cursorDiv,i.lineDiv],null,"position: relative; outline: none");var o=ae("div",[i.lineSpace],"CodeMirror-lines");i.mover=w("div",[o],null,"position: relative");i.sizer=w("div",[i.mover],"CodeMirror-sizer");i.sizerWidth=null;i.heightForcer=w("div",null,null,"position: absolute; height: "+ge+"px; width: 1px;");i.gutters=w("div",null,"CodeMirror-gutters");i.lineGutter=null;i.scroller=w("div",[i.sizer,i.heightForcer,i.gutters],"CodeMirror-scroll");i.scroller.setAttribute("tabIndex","-1");i.wrapper=w("div",[i.scrollbarFiller,i.gutterFiller,i.scroller],"CodeMirror");if(U&&V>=105)i.wrapper.style.clipPath="inset(0px)";i.wrapper.setAttribute("translate","no");if(T&&b<8){i.gutters.style.zIndex=-1;i.scroller.style.paddingRight=0}if(!g&&!(B&&Y))i.scroller.draggable=true;if(e)if(e.appendChild)e.appendChild(i.wrapper);else e(i.wrapper);i.viewFrom=i.viewTo=t.first;i.reportedViewFrom=i.reportedViewTo=t.first;i.view=[];i.renderedView=null;i.externalMeasured=null;i.viewOffset=0;i.lastWrapHeight=i.lastWrapWidth=0;i.updateLineNumbers=null;i.nativeBarWidth=i.barHeight=i.barWidth=0;i.scrollbarsClipped=false;i.lineNumWidth=i.lineNumInnerWidth=i.lineNumChars=null;i.alignWidgets=false;i.cachedCharWidth=i.cachedTextHeight=i.cachedPaddingH=null;i.maxLine=null;i.maxLineLength=0;i.maxLineChanged=false;i.wheelDX=i.wheelDY=i.wheelStartX=i.wheelStartY=null;i.shift=false;i.selForContextMenu=null;i.activeTouch=null;i.gutterSpecs=io(n.gutters,n.lineNumbers);oo(i);r.init(i)}qi.prototype.signal=function(e,t){if(v(e,t))this.events.push(arguments)},qi.prototype.finish=function(){for(var e=0;e<this.events.length;e++)p.apply(null,this.events[e])};var lo=0,uo=null;if(T)uo=-.53;else if(B)uo=15;else if(U)uo=-.7;else if(W)uo=-1/3;function co(e){var t=e.wheelDeltaX,r=e.wheelDeltaY;if(t==null&&e.detail&&e.axis==e.HORIZONTAL_AXIS)t=e.detail;if(r==null&&e.detail&&e.axis==e.VERTICAL_AXIS)r=e.detail;else if(r==null)r=e.wheelDelta;return{x:t,y:r}}function ho(e){var t=co(e);t.x*=uo;t.y*=uo;return t}function fo(e,t){if(U&&V==102){if(e.display.chromeScrollHack==null)e.display.sizer.style.pointerEvents="none";else clearTimeout(e.display.chromeScrollHack);e.display.chromeScrollHack=setTimeout(function(){e.display.chromeScrollHack=null;e.display.sizer.style.pointerEvents=""},100)}var r=co(t),n=r.x,i=r.y;var o=uo;if(t.deltaMode===0){n=t.deltaX;i=t.deltaY;o=1}var a=e.display,s=a.scroller;var l=s.scrollWidth>s.clientWidth;var u=s.scrollHeight>s.clientHeight;if(!(n&&l||i&&u))return;if(i&&y&&g)e:for(var c=t.target,h=a.view;c!=s;c=c.parentNode)for(var f=0;f<h.length;f++)if(h[f].node==c){e.display.currentWheelTarget=c;break e}if(n&&!B&&!G&&o!=null){if(i&&u)Si(e,Math.max(0,s.scrollTop+i*o));ki(e,Math.max(0,s.scrollLeft+n*o));if(!i||i&&u)C(t);a.wheelStartX=null;return}if(i&&o!=null){var d=i*o;var p=e.doc.scrollTop,m=p+a.wrapper.clientHeight;if(d<0)p=Math.max(0,p+d-50);else m=Math.min(e.doc.height,m+d+50);Ki(e,{top:p,bottom:m})}if(lo<20&&t.deltaMode!==0)if(a.wheelStartX==null){a.wheelStartX=s.scrollLeft;a.wheelStartY=s.scrollTop;a.wheelDX=n;a.wheelDY=i;setTimeout(function(){if(a.wheelStartX==null)return;var e=s.scrollLeft-a.wheelStartX;var t=s.scrollTop-a.wheelStartY;var r=t&&a.wheelDY&&t/a.wheelDY||e&&a.wheelDX&&e/a.wheelDX;a.wheelStartX=a.wheelStartY=null;if(!r)return;uo=(uo*lo+r)/(lo+1);++lo},200)}else{a.wheelDX+=n;a.wheelDY+=i}}var f=function(e,t){this.ranges=e;this.primIndex=t},R=(f.prototype.primary=function(){return this.ranges[this.primIndex]},f.prototype.equals=function(e){if(e==this)return true;if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return false;for(var t=0;t<this.ranges.length;t++){var r=this.ranges[t],n=e.ranges[t];if(!Et(r.anchor,n.anchor)||!Et(r.head,n.head))return false}return true},f.prototype.deepCopy=function(){var e=[];for(var t=0;t<this.ranges.length;t++)e[t]=new R(Tt(this.ranges[t].anchor),Tt(this.ranges[t].head));return new f(e,this.primIndex)},f.prototype.somethingSelected=function(){for(var e=0;e<this.ranges.length;e++)if(!this.ranges[e].empty())return true;return false},f.prototype.contains=function(e,t){if(!t)t=e;for(var r=0;r<this.ranges.length;r++){var n=this.ranges[r];if(A(t,n.from())>=0&&A(e,n.to())<=0)return r}return-1},function(e,t){this.anchor=e;this.head=t});function po(e,t,r){var n=e&&e.options.selectionsMayTouch;var i=t[r];t.sort(function(e,t){return A(e.from(),t.from())});r=m(t,i);for(var o=1;o<t.length;o++){var a=t[o],s=t[o-1];var l=A(s.to(),a.from());if(n&&!a.empty()?l>0:l>=0){var u=Mt(s.from(),a.from()),c=St(s.to(),a.to());var h=s.empty()?a.from()==a.head:s.from()==s.head;if(o<=r)--r;t.splice(--o,2,new R(h?c:u,h?u:c))}}return new f(t,r)}function mo(e,t){return new f([new R(e,t||e)],0)}function go(e){if(!e.text)return e.to;return P(e.from.line+e.text.length-1,Z(e.text).length+(e.text.length==1?e.from.ch:0))}function yo(e,t){if(A(e,t.from)<0)return e;if(A(e,t.to)<=0)return go(t);var r=e.line+t.text.length-(t.to.line-t.from.line)-1,n=e.ch;if(e.line==t.to.line)n+=go(t).ch-t.to.ch;return P(r,n)}function vo(e,t){var r=[];for(var n=0;n<e.sel.ranges.length;n++){var i=e.sel.ranges[n];r.push(new R(yo(i.anchor,t),yo(i.head,t)))}return po(e.cm,r,e.sel.primIndex)}function _o(e,t,r){if(e.line==t.line)return P(r.line,e.ch-t.ch+r.ch);else return P(r.line+(e.line-t.line),e.ch)}function xo(e,t,r){var n=[];var i=P(e.first,0),o=i;for(var a=0;a<t.length;a++){var s=t[a];var l=_o(s.from,i,o);var u=_o(go(s),i,o);i=s.to;o=u;if(r=="around"){var c=e.sel.ranges[a],h=A(c.head,c.anchor)<0;n[a]=new R(h?u:l,h?l:u)}else n[a]=new R(l,l)}return new f(n,e.sel.primIndex)}function bo(e){e.doc.mode=ht(e.options,e.doc.modeOption);wo(e)}function wo(e){e.doc.iter(function(e){if(e.stateAfter)e.stateAfter=null;if(e.styles)e.styles=null});e.doc.modeFrontier=e.doc.highlightFrontier=e.doc.first;Wi(e,100);e.state.modeGen++;if(e.curOp)z(e)}function Eo(e,t){return t.from.ch==0&&t.to.ch==0&&Z(t.text)==""&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function To(e,n,t,i){function o(e){return t?t[e]:null}function r(e,t,r){Tr(e,t,r,i);x(e,"change",e,n)}function a(e,t){var r=[];for(var n=e;n<t;++n)r.push(new Er(u[n],o(n),i));return r}var s=n.from,l=n.to,u=n.text;var c=L(e,s.line),h=L(e,l.line);var f=Z(u),d=o(u.length-1),p=l.line-s.line;if(n.full){e.insert(0,a(0,u.length));e.remove(u.length,e.size-u.length)}else if(Eo(e,n)){var m=a(0,u.length-1);r(h,h.text,d);if(p)e.remove(s.line,p);if(m.length)e.insert(s.line,m)}else if(c==h)if(u.length==1)r(c,c.text.slice(0,s.ch)+f+c.text.slice(l.ch),d);else{var g=a(1,u.length-1);g.push(new Er(f+c.text.slice(l.ch),d,i));r(c,c.text.slice(0,s.ch)+u[0],o(0));e.insert(s.line+1,g)}else if(u.length==1){r(c,c.text.slice(0,s.ch)+u[0]+h.text.slice(l.ch),o(0));e.remove(s.line+1,p)}else{r(c,c.text.slice(0,s.ch)+u[0],o(0));r(h,f+h.text.slice(l.ch),d);var y=a(1,u.length-1);if(p>1)e.remove(s.line+1,p-1);e.insert(s.line+1,y)}x(e,"change",e,n)}function So(e,a,s){function l(e,t,r){if(e.linked)for(var n=0;n<e.linked.length;++n){var i=e.linked[n];if(i.doc==t)continue;var o=r&&i.sharedHist;if(s&&!o)continue;a(i.doc,o);l(i.doc,e,o)}}l(e,null,true)}function Mo(e,t){if(t.cm)throw new Error("This document is already in use.");e.doc=t;t.cm=e;$n(e);bo(e);ko(e);e.options.direction=t.direction;if(!e.options.lineWrapping)wr(e);e.options.mode=t.modeOption;z(e)}function ko(e){(e.doc.direction=="rtl"?le:ne)(e.display.lineDiv,"CodeMirror-rtl")}function Co(e){D(e,function(){ko(e);z(e)})}function Ao(e){this.done=[];this.undone=[];this.undoDepth=e?e.undoDepth:Infinity;this.lastModTime=this.lastSelTime=0;this.lastOp=this.lastSelOp=null;this.lastOrigin=this.lastSelOrigin=null;this.generation=this.maxGeneration=e?e.maxGeneration:1}function Io(e,t){var r={from:Tt(t.from),to:go(t),text:yt(e,t.from,t.to)};Fo(e,r,t.from.line,t.to.line+1);So(e,function(e){return Fo(e,r,t.from.line,t.to.line+1)},true);return r}function Lo(e){while(e.length){var t=Z(e);if(t.ranges)e.pop();else break}}function Po(e,t){if(t){Lo(e.done);return Z(e.done)}else if(e.done.length&&!Z(e.done).ranges)return Z(e.done);else if(e.done.length>1&&!e.done[e.done.length-2].ranges){e.done.pop();return Z(e.done)}}function zo(e,t,r,n){var i=e.history;i.undone.length=0;var o=+new Date,a;var s;if((i.lastOp==n||i.lastOrigin==t.origin&&t.origin&&(t.origin.charAt(0)=="+"&&i.lastModTime>o-(e.cm?e.cm.options.historyEventDelay:500)||t.origin.charAt(0)=="*"))&&(a=Po(i,i.lastOp==n))){s=Z(a.changes);if(A(t.from,t.to)==0&&A(t.from,s.to)==0)s.to=go(t);else a.changes.push(Io(e,t))}else{var l=Z(i.done);if(!l||!l.ranges)Ro(e.sel,i.done);a={changes:[Io(e,t)],generation:i.generation};i.done.push(a);while(i.done.length>i.undoDepth){i.done.shift();if(!i.done[0].ranges)i.done.shift()}}i.done.push(r);i.generation=++i.maxGeneration;i.lastModTime=i.lastSelTime=o;i.lastOp=i.lastSelOp=n;i.lastOrigin=i.lastSelOrigin=t.origin;if(!s)p(e,"historyAdded")}function Do(e,t,r,n){var i=t.charAt(0);return i=="*"||i=="+"&&r.ranges.length==n.ranges.length&&r.somethingSelected()==n.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500)}function Oo(e,t,r,n){var i=e.history,o=n&&n.origin;if(r==i.lastSelOp||o&&i.lastSelOrigin==o&&(i.lastModTime==i.lastSelTime&&i.lastOrigin==o||Do(e,o,Z(i.done),t)))i.done[i.done.length-1]=t;else Ro(t,i.done);i.lastSelTime=+new Date;i.lastSelOrigin=o;i.lastSelOp=r;if(n&&n.clearRedo!==false)Lo(i.undone)}function Ro(e,t){var r=Z(t);if(!(r&&r.ranges&&r.equals(e)))t.push(e)}function Fo(t,r,e,n){var i=r["spans_"+t.id],o=0;t.iter(Math.max(t.first,e),Math.min(t.first+t.size,n),function(e){if(e.markedSpans)(i||(i=r["spans_"+t.id]={}))[o]=e.markedSpans;++o})}function Bo(e){if(!e)return null;var t;for(var r=0;r<e.length;++r)if(e[r].marker.explicitlyCleared){if(!t)t=e.slice(0,r)}else if(t)t.push(e[r]);return!t?e:t.length?t:null}function No(e,t){var r=t["spans_"+e.id];if(!r)return null;var n=[];for(var i=0;i<t.text.length;++i)n.push(Bo(r[i]));return n}function jo(e,t){var r=No(e,t);var n=er(e,t);if(!r)return n;if(!n)return r;for(var i=0;i<r.length;++i){var o=r[i],a=n[i];if(o&&a)e:for(var s=0;s<a.length;++s){var l=a[s];for(var u=0;u<o.length;++u)if(o[u].marker==l.marker)continue e;o.push(l)}else if(a)r[i]=a}return r}function Uo(e,t,r){var n=[];for(var i=0;i<e.length;++i){var o=e[i];if(o.ranges){n.push(r?f.prototype.deepCopy.call(o):o);continue}var a=o.changes,s=[];n.push({changes:s});for(var l=0;l<a.length;++l){var u=a[l],c=void 0;s.push({from:u.from,to:u.to,text:u.text});if(t)for(var h in u)if(c=h.match(/^spans_(\d+)$/))if(m(t,Number(c[1]))>-1){Z(s)[h]=u[h];delete u[h]}}}return n}function Vo(e,t,r,n){if(n){var i=e.anchor;if(r){var o=A(t,i)<0;if(o!=A(r,i)<0){i=t;t=r}else if(o!=A(t,r)<0)t=r}return new R(i,t)}else return new R(r||t,t)}function Go(e,t,r,n,i){if(i==null)i=e.cm&&(e.cm.display.shift||e.extend);F(e,new f([Vo(e.sel.primary(),t,r,i)],0),n)}function Wo(e,t,r){var n=[];var i=e.cm&&(e.cm.display.shift||e.extend);for(var o=0;o<e.sel.ranges.length;o++)n[o]=Vo(e.sel.ranges[o],t[o],null,i);var a=po(e.cm,n,e.sel.primIndex);F(e,a,r)}function Zo(e,t,r,n){var i=e.sel.ranges.slice(0);i[t]=r;F(e,po(e.cm,i,e.sel.primIndex),n)}function qo(e,t,r,n){F(e,mo(t,r),n)}function Ho(r,e,t){var n={ranges:e.ranges,update:function(e){this.ranges=[];for(var t=0;t<e.length;t++)this.ranges[t]=new R(I(r,e[t].anchor),I(r,e[t].head))},origin:t&&t.origin};p(r,"beforeSelectionChange",r,n);if(r.cm)p(r.cm,"beforeSelectionChange",r.cm,n);if(n.ranges!=e.ranges)return po(r.cm,n.ranges,n.ranges.length-1);else return e}function $o(e,t,r){var n=e.history.done,i=Z(n);if(i&&i.ranges){n[n.length-1]=t;Xo(e,t,r)}else F(e,t,r)}function F(e,t,r){Xo(e,t,r);Oo(e,e.sel,e.cm?e.cm.curOp.id:NaN,r)}function Xo(e,t,r){if(v(e,"beforeSelectionChange")||e.cm&&v(e.cm,"beforeSelectionChange"))t=Ho(e,t,r);var n=r&&r.bias||(A(t.primary().head,e.sel.primary().head)<0?-1:1);Yo(e,Ko(e,t,n,true));if(!(r&&r.scroll===false)&&e.cm&&e.cm.getOption("readOnly")!="nocursor")xi(e.cm)}function Yo(e,t){if(t.equals(e.sel))return;e.sel=t;if(e.cm){e.cm.curOp.updateInput=1;e.cm.curOp.selectionChanged=true;Ge(e.cm)}x(e,"cursorActivity",e)}function Jo(e){Yo(e,Ko(e,e.sel,null,false))}function Ko(e,t,r,n){var i;for(var o=0;o<t.ranges.length;o++){var a=t.ranges[o];var s=t.ranges.length==e.sel.ranges.length&&e.sel.ranges[o];var l=ea(e,a.anchor,s&&s.anchor,r,n);var u=a.head==a.anchor?l:ea(e,a.head,s&&s.head,r,n);if(i||l!=a.anchor||u!=a.head){if(!i)i=t.ranges.slice(0,o);i[o]=new R(l,u)}}return i?po(e.cm,i,t.primIndex):t}function Qo(e,t,r,n,i){var o=L(e,t.line);if(o.markedSpans)for(var a=0;a<o.markedSpans.length;++a){var s=o.markedSpans[a],l=s.marker;var u="selectLeft"in l?!l.selectLeft:l.inclusiveLeft;var c="selectRight"in l?!l.selectRight:l.inclusiveRight;if((s.from==null||(u?s.from<=t.ch:s.from<t.ch))&&(s.to==null||(c?s.to>=t.ch:s.to>t.ch))){if(i){p(l,"beforeCursorEnter");if(l.explicitlyCleared)if(!o.markedSpans)break;else{--a;continue}}if(!l.atomic)continue;if(r){var h=l.find(n<0?1:-1),f=void 0;if(n<0?c:u)h=ta(e,h,-n,h&&h.line==t.line?o:null);if(h&&h.line==t.line&&(f=A(h,r))&&(n<0?f<0:f>0))return Qo(e,h,t,n,i)}var d=l.find(n<0?-1:1);if(n<0?u:c)d=ta(e,d,n,d.line==t.line?o:null);return d?Qo(e,d,t,n,i):null}}return t}function ea(e,t,r,n,i){var o=n||1;var a=Qo(e,t,r,o,i)||!i&&Qo(e,t,r,o,true)||Qo(e,t,r,-o,i)||!i&&Qo(e,t,r,-o,true);if(!a){e.cantEdit=true;return P(e.first,0)}return a}function ta(e,t,r,n){if(r<0&&t.ch==0)if(t.line>e.first)return I(e,P(t.line-1));else return null;else if(r>0&&t.ch==(n||L(e,t.line)).text.length)if(t.line<e.first+e.size-1)return P(t.line+1,0);else return null;else return new P(t.line,t.ch+r)}function ra(e){e.setSelection(P(e.firstLine(),0),P(e.lastLine()),ve)}function na(i,e,t){var o={canceled:false,from:e.from,to:e.to,text:e.text,origin:e.origin,cancel:function(){return o.canceled=true}};if(t)o.update=function(e,t,r,n){if(e)o.from=I(i,e);if(t)o.to=I(i,t);if(r)o.text=r;if(n!==undefined)o.origin=n};p(i,"beforeChange",i,o);if(i.cm)p(i.cm,"beforeChange",i.cm,o);if(o.canceled){if(i.cm)i.cm.curOp.updateInput=2;return null}return{from:o.from,to:o.to,text:o.text,origin:o.origin}}function ia(e,t,r){if(e.cm){if(!e.cm.curOp)return O(e.cm,ia)(e,t,r);if(e.cm.state.suppressEdits)return}if(v(e,"beforeChange")||e.cm&&v(e.cm,"beforeChange")){t=na(e,t,true);if(!t)return}var n=Wt&&!r&&rr(e,t.from,t.to);if(n)for(var i=n.length-1;i>=0;--i)oa(e,{from:n[i].from,to:n[i].to,text:i?[""]:t.text,origin:t.origin});else oa(e,t)}function oa(e,r){if(r.text.length==1&&r.text[0]==""&&A(r.from,r.to)==0)return;var t=vo(e,r);zo(e,r,t,e.cm?e.cm.curOp.id:NaN);la(e,r,t,er(e,r));var n=[];So(e,function(e,t){if(!t&&m(n,e.history)==-1){da(e.history,r);n.push(e.history)}la(e,r,null,er(e,r))})}function aa(i,o,e){var t=i.cm&&i.cm.state.suppressEdits;if(t&&!e)return;var r=i.history,a,n=i.sel;var s=o=="undo"?r.done:r.undone,l=o=="undo"?r.undone:r.done;var u=0;for(;u<s.length;u++){a=s[u];if(e?a.ranges&&!a.equals(i.sel):!a.ranges)break}if(u==s.length)return;r.lastOrigin=r.lastSelOrigin=null;for(;;){a=s.pop();if(a.ranges){Ro(a,l);if(e&&!a.equals(i.sel)){F(i,a,{clearRedo:false});return}n=a}else if(t){s.push(a);return}else break}var c=[];Ro(n,l);l.push({changes:c,generation:r.generation});r.generation=a.generation||++r.maxGeneration;var h=v(i,"beforeChange")||i.cm&&v(i.cm,"beforeChange");var f=function(e){var r=a.changes[e];r.origin=o;if(h&&!na(i,r,false)){s.length=0;return{}}c.push(Io(i,r));var t=e?vo(i,r):Z(s);la(i,r,t,jo(i,r));if(!e&&i.cm)i.cm.scrollIntoView({from:r.from,to:go(r)});var n=[];So(i,function(e,t){if(!t&&m(n,e.history)==-1){da(e.history,r);n.push(e.history)}la(e,r,null,jo(e,r))})};for(var d=a.changes.length-1;d>=0;--d){var p=f(d);if(p)return p.v}}function sa(e,t){if(t==0)return;e.first+=t;e.sel=new f(Te(e.sel.ranges,function(e){return new R(P(e.anchor.line+t,e.anchor.ch),P(e.head.line+t,e.head.ch))}),e.sel.primIndex);if(e.cm){z(e.cm,e.first,e.first-t,t);for(var r=e.cm.display,n=r.viewFrom;n<r.viewTo;n++)Jn(e.cm,n,"gutter")}}function la(e,t,r,n){if(e.cm&&!e.cm.curOp)return O(e.cm,la)(e,t,r,n);if(t.to.line<e.first){sa(e,t.text.length-1-(t.to.line-t.from.line));return}if(t.from.line>e.lastLine())return;if(t.from.line<e.first){var i=t.text.length-1-(e.first-t.from.line);sa(e,i);t={from:P(e.first,0),to:P(t.to.line+i,t.to.ch),text:[Z(t.text)],origin:t.origin}}var o=e.lastLine();if(t.to.line>o)t={from:t.from,to:P(o,L(e,o).text.length),text:[t.text[0]],origin:t.origin};t.removed=yt(e,t.from,t.to);if(!r)r=vo(e,t);if(e.cm)ua(e.cm,t,n);else To(e,t,n);Xo(e,r,ve);if(e.cantEdit&&ea(e,P(e.firstLine(),0)))e.cantEdit=false}function ua(e,t,r){var n=e.doc,i=e.display,o=t.from,a=t.to;var s=false,l=o.line;if(!e.options.lineWrapping){l=E(dr(L(n,o.line)));n.iter(l,a.line+1,function(e){if(e==i.maxLine){s=true;return true}})}if(n.sel.contains(t.from,t.to)>-1)Ge(e);To(n,t,r,Hn(e));if(!e.options.lineWrapping){n.iter(l,o.line+t.text.length,function(e){var t=br(e);if(t>i.maxLineLength){i.maxLine=e;i.maxLineLength=t;i.maxLineChanged=true;s=false}});if(s)e.curOp.updateMaxLine=true}Gt(n,o.line);Wi(e,400);var u=t.text.length-(a.line-o.line)-1;if(t.full)z(e);else if(o.line==a.line&&t.text.length==1&&!Eo(e.doc,t))Jn(e,o.line,"text");else z(e,o.line,a.line+1,u);var c=v(e,"changes"),h=v(e,"change");if(h||c){var f={from:o,to:a,text:t.text,removed:t.removed,origin:t.origin};if(h)x(e,"change",e,f);if(c)(e.curOp.changeObjs||(e.curOp.changeObjs=[])).push(f)}e.display.selForContextMenu=null}function ca(e,t,r,n,i){var o;if(!n)n=r;if(A(n,r)<0)o=[n,r],r=o[0],n=o[1];if(typeof t=="string")t=e.splitLines(t);ia(e,{from:r,to:n,text:t,origin:i})}function ha(e,t,r,n){if(r<e.line)e.line+=n;else if(t<e.line){e.line=t;e.ch=0}}function fa(e,t,r,n){for(var i=0;i<e.length;++i){var o=e[i],a=true;if(o.ranges){if(!o.copied){o=e[i]=o.deepCopy();o.copied=true}for(var s=0;s<o.ranges.length;s++){ha(o.ranges[s].anchor,t,r,n);ha(o.ranges[s].head,t,r,n)}continue}for(var l=0;l<o.changes.length;++l){var u=o.changes[l];if(r<u.from.line){u.from=P(u.from.line+n,u.from.ch);u.to=P(u.to.line+n,u.to.ch)}else if(t<=u.to.line){a=false;break}}if(!a){e.splice(0,i+1);i=0}}}function da(e,t){var r=t.from.line,n=t.to.line,i=t.text.length-(n-r)-1;fa(e.done,r,n,i);fa(e.undone,r,n,i)}function pa(e,t,r,n){var i=t,o=t;if(typeof t=="number")o=L(e,kt(e,t));else i=E(t);if(i==null)return null;if(n(o,i)&&e.cm)Jn(e.cm,i,r);return o}function ma(e){this.lines=e;this.parent=null;var t=0;for(var r=0;r<e.length;++r){e[r].parent=this;t+=e[r].height}this.height=t}function ga(e){this.children=e;var t=0,r=0;for(var n=0;n<e.length;++n){var i=e[n];t+=i.chunkSize();r+=i.height;i.parent=this}this.size=t;this.height=r;this.parent=null}R.prototype.from=function(){return Mt(this.anchor,this.head)},R.prototype.to=function(){return St(this.anchor,this.head)},R.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch},ma.prototype={chunkSize:function(){return this.lines.length},removeInner:function(e,t){for(var r=e,n=e+t;r<n;++r){var i=this.lines[r];this.height-=i.height;Sr(i);x(i,"delete")}this.lines.splice(e,t)},collapse:function(e){e.push.apply(e,this.lines)},insertInner:function(e,t,r){this.height+=r;this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var n=0;n<t.length;++n)t[n].parent=this},iterN:function(e,t,r){for(var n=e+t;e<n;++e)if(r(this.lines[e]))return true}},ga.prototype={chunkSize:function(){return this.size},removeInner:function(e,t){this.size-=t;for(var r=0;r<this.children.length;++r){var n=this.children[r],i=n.chunkSize();if(e<i){var o=Math.min(t,i-e),a=n.height;n.removeInner(e,o);this.height-=a-n.height;if(i==o){this.children.splice(r--,1);n.parent=null}if((t-=o)==0)break;e=0}else e-=i}if(this.size-t<25&&(this.children.length>1||!(this.children[0]instanceof ma))){var s=[];this.collapse(s);this.children=[new ma(s)];this.children[0].parent=this}},collapse:function(e){for(var t=0;t<this.children.length;++t)this.children[t].collapse(e)},insertInner:function(e,t,r){this.size+=t.length;this.height+=r;for(var n=0;n<this.children.length;++n){var i=this.children[n],o=i.chunkSize();if(e<=o){i.insertInner(e,t,r);if(i.lines&&i.lines.length>50){var a=i.lines.length%25+25;for(var s=a;s<i.lines.length;){var l=new ma(i.lines.slice(s,s+=25));i.height-=l.height;this.children.splice(++n,0,l);l.parent=this}i.lines=i.lines.slice(0,a);this.maybeSpill()}break}e-=o}},maybeSpill:function(){if(this.children.length<=10)return;var e=this;do{var t=e.children.splice(e.children.length-5,5);var r=new ga(t);if(!e.parent){var n=new ga(e.children);n.parent=e;e.children=[n,r];e=n}else{e.size-=r.size;e.height-=r.height;var i=m(e.parent.children,e);e.parent.children.splice(i+1,0,r)}r.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()},iterN:function(e,t,r){for(var n=0;n<this.children.length;++n){var i=this.children[n],o=i.chunkSize();if(e<o){var a=Math.min(t,o-e);if(i.iterN(e,a,r))return true;if((t-=a)==0)break;e=0}else e-=o}}};var ya=function(e,t,r){if(r)for(var n in r)if(r.hasOwnProperty(n))this[n]=r[n];this.doc=e;this.node=t};function va(e,t,r){if(xr(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop))_i(e,r)}function _a(n,e,t,r){var i=new ya(n,t,r);var o=n.cm;if(o&&i.noHScroll)o.display.alignWidgets=true;pa(n,e,"widget",function(e){var t=e.widgets||(e.widgets=[]);if(i.insertAt==null)t.push(i);else t.splice(Math.min(t.length,Math.max(0,i.insertAt)),0,i);i.line=e;if(o&&!vr(n,e)){var r=xr(e)<n.scrollTop;_t(e,e.height+rn(i));if(r)_i(o,i.height);o.curOp.forceUpdate=true}return true});if(o)x(o,"lineWidgetAdded",o,i,typeof e=="number"?e:E(e));return i}ya.prototype.clear=function(){var e=this.doc.cm,t=this.line.widgets,r=this.line,n=E(r);if(n==null||!t)return;for(var i=0;i<t.length;++i)if(t[i]==this)t.splice(i--,1);if(!t.length)r.widgets=null;var o=rn(this);_t(r,Math.max(0,r.height-o));if(e){D(e,function(){va(e,r,-o);Jn(e,n,"widget")});x(e,"lineWidgetCleared",e,this,n)}},ya.prototype.changed=function(){var e=this;var t=this.height,r=this.doc.cm,n=this.line;this.height=null;var i=rn(this)-t;if(!i)return;if(!vr(this.doc,n))_t(n,n.height+i);if(r)D(r,function(){r.curOp.forceUpdate=true;va(r,n,i);x(r,"lineWidgetChanged",r,e,E(n))})},We(ya);var xa=0,ba=function(e,t){this.lines=[];this.type=t;this.doc=e;this.id=++xa};function wa(t,r,n,e,i){if(e&&e.shared)return Ta(t,r,n,e,i);if(t.cm&&!t.cm.curOp)return O(t.cm,wa)(t,r,n,e,i);var o=new ba(t,i),a=A(r,n);if(e)pe(e,o,false);if(a>0||a==0&&o.clearWhenEmpty!==false)return o;if(o.replacedWith){o.collapsed=true;o.widgetNode=ae("span",[o.replacedWith],"CodeMirror-widget");if(!e.handleMouseEvents)o.widgetNode.setAttribute("cm-ignore-events","true");if(e.insertLeft)o.widgetNode.insertLeft=true}if(o.collapsed){if(fr(t,r.line,r,n,o)||r.line!=n.line&&fr(t,n.line,r,n,o))throw new Error("Inserting collapsed marker partially overlapping an existing one");Ht()}if(o.addToHistory)zo(t,{from:r,to:n,origin:"markText"},t.sel,NaN);var s=r.line,l=t.cm,u;t.iter(s,n.line+1,function(e){if(l&&o.collapsed&&!l.options.lineWrapping&&dr(e)==l.display.maxLine)u=true;if(o.collapsed&&s!=r.line)_t(e,0);Jt(e,new $t(o,s==r.line?r.ch:null,s==n.line?n.ch:null),t.cm&&t.cm.curOp);++s});if(o.collapsed)t.iter(r.line,n.line+1,function(e){if(vr(t,e))_t(e,0)});if(o.clearOnEnter)M(o,"beforeCursorEnter",function(){return o.clear()});if(o.readOnly){qt();if(t.history.done.length||t.history.undone.length)t.clearHistory()}if(o.collapsed){o.id=++xa;o.atomic=true}if(l){if(u)l.curOp.updateMaxLine=true;if(o.collapsed)z(l,r.line,n.line+1);else if(o.className||o.startStyle||o.endStyle||o.css||o.attributes||o.title)for(var c=r.line;c<=n.line;c++)Jn(l,c,"text");if(o.atomic)Jo(l.doc);x(l,"markerAdded",l,o)}return o}ba.prototype.clear=function(){if(this.explicitlyCleared)return;var e=this.doc.cm,t=e&&!e.curOp;if(t)Ri(e);if(v(this,"clear")){var r=this.find();if(r)x(this,"clear",r.from,r.to)}var n=null,i=null;for(var o=0;o<this.lines.length;++o){var a=this.lines[o];var s=Xt(a.markedSpans,this);if(e&&!this.collapsed)Jn(e,E(a),"text");else if(e){if(s.to!=null)i=E(a);if(s.from!=null)n=E(a)}a.markedSpans=Yt(a.markedSpans,s);if(s.from==null&&this.collapsed&&!vr(this.doc,a)&&e)_t(a,Gn(e.display))}if(e&&this.collapsed&&!e.options.lineWrapping)for(var l=0;l<this.lines.length;++l){var u=dr(this.lines[l]),c=br(u);if(c>e.display.maxLineLength){e.display.maxLine=u;e.display.maxLineLength=c;e.display.maxLineChanged=true}}if(n!=null&&e&&this.collapsed)z(e,n,i+1);this.lines.length=0;this.explicitlyCleared=true;if(this.atomic&&this.doc.cantEdit){this.doc.cantEdit=false;if(e)Jo(e.doc)}if(e)x(e,"markerCleared",e,this,n,i);if(t)Fi(e);if(this.parent)this.parent.clear()},ba.prototype.find=function(e,t){if(e==null&&this.type=="bookmark")e=1;var r,n;for(var i=0;i<this.lines.length;++i){var o=this.lines[i];var a=Xt(o.markedSpans,this);if(a.from!=null){r=P(t?o:E(o),a.from);if(e==-1)return r}if(a.to!=null){n=P(t?o:E(o),a.to);if(e==1)return n}}return r&&{from:r,to:n}},ba.prototype.changed=function(){var o=this;var a=this.find(-1,true),s=this,l=this.doc.cm;if(!a||!l)return;D(l,function(){var e=a.line,t=E(a.line);var r=mn(l,t);if(r){Tn(r);l.curOp.selectionChanged=l.curOp.forceUpdate=true}l.curOp.updateMaxLine=true;if(!vr(s.doc,e)&&s.height!=null){var n=s.height;s.height=null;var i=rn(s)-n;if(i)_t(e,e.height+i)}x(l,"markerChanged",l,o)})},ba.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;if(!t.maybeHiddenMarkers||m(t.maybeHiddenMarkers,this)==-1)(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)},ba.prototype.detachLine=function(e){this.lines.splice(m(this.lines,e),1);if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}},We(ba);var Ea=function(e,t){this.markers=e;this.primary=t;for(var r=0;r<e.length;++r)e[r].parent=this};function Ta(e,r,n,i,o){i=pe(i);i.shared=false;var a=[wa(e,r,n,i,o)],s=a[0];var l=i.widgetNode;So(e,function(e){if(l)i.widgetNode=l.cloneNode(true);a.push(wa(e,I(e,r),I(e,n),i,o));for(var t=0;t<e.linked.length;++t)if(e.linked[t].isParent)return;s=Z(a)});return new Ea(a,s)}function Sa(e){return e.findMarks(P(e.first,0),e.clipPos(P(e.lastLine())),function(e){return e.parent})}function Ma(e,t){for(var r=0;r<t.length;r++){var n=t[r],i=n.find();var o=e.clipPos(i.from),a=e.clipPos(i.to);if(A(o,a)){var s=wa(e,o,a,n.primary,n.primary.type);n.markers.push(s);s.parent=n}}}function ka(o){var e=function(e){var t=o[e],r=[t.primary.doc];So(t.primary.doc,function(e){return r.push(e)});for(var n=0;n<t.markers.length;n++){var i=t.markers[n];if(m(r,i.doc)==-1){i.parent=null;t.markers.splice(n--,1)}}};for(var t=0;t<o.length;t++)e(t)}Ea.prototype.clear=function(){if(this.explicitlyCleared)return;this.explicitlyCleared=true;for(var e=0;e<this.markers.length;++e)this.markers[e].clear();x(this,"clear")},Ea.prototype.find=function(e,t){return this.primary.find(e,t)},We(Ea);var Ca=0,l=function(e,t,r,n,i){if(!(this instanceof l))return new l(e,t,r,n,i);if(r==null)r=0;ga.call(this,[new ma([new Er("",null)])]);this.first=r;this.scrollTop=this.scrollLeft=0;this.cantEdit=false;this.cleanGeneration=1;this.modeFrontier=this.highlightFrontier=r;var o=P(r,0);this.sel=mo(o);this.history=new Ao(null);this.id=++Ca;this.modeOption=t;this.lineSep=n;this.direction=i=="rtl"?"rtl":"ltr";this.extend=false;if(typeof e=="string")e=this.splitLines(e);To(this,{from:o,to:o,text:e});F(this,mo(o),ve)},Aa=((l.prototype=ke(ga.prototype,{constructor:l,iter:function(e,t,r){if(r)this.iterN(e-this.first,t-e,r);else this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){var r=0;for(var n=0;n<t.length;++n)r+=t[n].height;this.insertInner(e-this.first,t,r)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=vt(this,this.first,this.first+this.size);if(e===false)return t;return t.join(e||this.lineSeparator())},setValue:r(function(e){var t=P(this.first,0),r=this.first+this.size-1;ia(this,{from:t,to:P(r,L(this,r).text.length),text:this.splitLines(e),origin:"setValue",full:true},true);if(this.cm)bi(this.cm,0,0);F(this,mo(t),ve)}),replaceRange:function(e,t,r,n){t=I(this,t);r=r?I(this,r):t;ca(this,e,t,r,n)},getRange:function(e,t,r){var n=yt(this,I(this,e),I(this,t));if(r===false)return n;if(r==="")return n.join("");return n.join(r||this.lineSeparator())},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){if(bt(this,e))return L(this,e)},getLineNumber:function(e){return E(e)},getLineHandleVisualStart:function(e){if(typeof e=="number")e=L(this,e);return dr(e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return I(this,e)},getCursor:function(e){var t=this.sel.primary(),r;if(e==null||e=="head")r=t.head;else if(e=="anchor")r=t.anchor;else if(e=="end"||e=="to"||e===false)r=t.to();else r=t.from();return r},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:r(function(e,t,r){qo(this,I(this,typeof e=="number"?P(e,t||0):e),null,r)}),setSelection:r(function(e,t,r){qo(this,I(this,e),I(this,t||e),r)}),extendSelection:r(function(e,t,r){Go(this,I(this,e),t&&I(this,t),r)}),extendSelections:r(function(e,t){Wo(this,At(this,e),t)}),extendSelectionsBy:r(function(e,t){var r=Te(this.sel.ranges,e);Wo(this,At(this,r),t)}),setSelections:r(function(e,t,r){if(!e.length)return;var n=[];for(var i=0;i<e.length;i++)n[i]=new R(I(this,e[i].anchor),I(this,e[i].head||e[i].anchor));if(t==null)t=Math.min(e.length-1,this.sel.primIndex);F(this,po(this.cm,n,t),r)}),addSelection:r(function(e,t,r){var n=this.sel.ranges.slice(0);n.push(new R(I(this,e),I(this,t||e)));F(this,po(this.cm,n,n.length-1),r)}),getSelection:function(e){var t=this.sel.ranges,r;for(var n=0;n<t.length;n++){var i=yt(this,t[n].from(),t[n].to());r=r?r.concat(i):i}if(e===false)return r;else return r.join(e||this.lineSeparator())},getSelections:function(e){var t=[],r=this.sel.ranges;for(var n=0;n<r.length;n++){var i=yt(this,r[n].from(),r[n].to());if(e!==false)i=i.join(e||this.lineSeparator());t[n]=i}return t},replaceSelection:function(e,t,r){var n=[];for(var i=0;i<this.sel.ranges.length;i++)n[i]=e;this.replaceSelections(n,t,r||"+input")},replaceSelections:r(function(e,t,r){var n=[],i=this.sel;for(var o=0;o<i.ranges.length;o++){var a=i.ranges[o];n[o]={from:a.from(),to:a.to(),text:this.splitLines(e[o]),origin:r}}var s=t&&t!="end"&&xo(this,n,t);for(var l=n.length-1;l>=0;l--)ia(this,n[l]);if(s)$o(this,s);else if(this.cm)xi(this.cm)}),undo:r(function(){aa(this,"undo")}),redo:r(function(){aa(this,"redo")}),undoSelection:r(function(){aa(this,"undo",true)}),redoSelection:r(function(){aa(this,"redo",true)}),setExtending:function(e){this.extend=e},getExtending:function(){return this.extend},historySize:function(){var e=this.history,t=0,r=0;for(var n=0;n<e.done.length;n++)if(!e.done[n].ranges)++t;for(var i=0;i<e.undone.length;i++)if(!e.undone[i].ranges)++r;return{undo:t,redo:r}},clearHistory:function(){var t=this;this.history=new Ao(this.history);So(this,function(e){return e.history=t.history},true)},markClean:function(){this.cleanGeneration=this.changeGeneration(true)},changeGeneration:function(e){if(e)this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null;return this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:Uo(this.history.done),undone:Uo(this.history.undone)}},setHistory:function(e){var t=this.history=new Ao(this.history);t.done=Uo(e.done.slice(0),null,true);t.undone=Uo(e.undone.slice(0),null,true)},setGutterMarker:r(function(e,r,n){return pa(this,e,"gutter",function(e){var t=e.gutterMarkers||(e.gutterMarkers={});t[r]=n;if(!n&&Le(t))e.gutterMarkers=null;return true})}),clearGutter:r(function(t){var r=this;this.iter(function(e){if(e.gutterMarkers&&e.gutterMarkers[t])pa(r,e,"gutter",function(){e.gutterMarkers[t]=null;if(Le(e.gutterMarkers))e.gutterMarkers=null;return true})})}),lineInfo:function(e){var t;if(typeof e=="number"){if(!bt(this,e))return null;t=e;e=L(this,e);if(!e)return null}else{t=E(e);if(t==null)return null}return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},addLineClass:r(function(e,r,n){return pa(this,e,r=="gutter"?"gutter":"class",function(e){var t=r=="text"?"textClass":r=="background"?"bgClass":r=="gutter"?"gutterClass":"wrapClass";if(!e[t])e[t]=n;else if(re(n).test(e[t]))return false;else e[t]+=" "+n;return true})}),removeLineClass:r(function(e,o,a){return pa(this,e,o=="gutter"?"gutter":"class",function(e){var t=o=="text"?"textClass":o=="background"?"bgClass":o=="gutter"?"gutterClass":"wrapClass";var r=e[t];if(!r)return false;else if(a==null)e[t]=null;else{var n=r.match(re(a));if(!n)return false;var i=n.index+n[0].length;e[t]=r.slice(0,n.index)+(!n.index||i==r.length?"":" ")+r.slice(i)||null}return true})}),addLineWidget:r(function(e,t,r){return _a(this,e,t,r)}),removeLineWidget:function(e){e.clear()},markText:function(e,t,r){return wa(this,I(this,e),I(this,t),r,r&&r.type||"range")},setBookmark:function(e,t){var r={replacedWith:t&&(t.nodeType==null?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:false,shared:t&&t.shared,handleMouseEvents:t&&t.handleMouseEvents};e=I(this,e);return wa(this,e,e,r,"bookmark")},findMarksAt:function(e){e=I(this,e);var t=[],r=L(this,e.line).markedSpans;if(r)for(var n=0;n<r.length;++n){var i=r[n];if((i.from==null||i.from<=e.ch)&&(i.to==null||i.to>=e.ch))t.push(i.marker.parent||i.marker)}return t},findMarks:function(i,o,a){i=I(this,i);o=I(this,o);var s=[],l=i.line;this.iter(i.line,o.line+1,function(e){var t=e.markedSpans;if(t)for(var r=0;r<t.length;r++){var n=t[r];if(!(n.to!=null&&l==i.line&&i.ch>=n.to||n.from==null&&l!=i.line||n.from!=null&&l==o.line&&n.from>=o.ch)&&(!a||a(n.marker)))s.push(n.marker.parent||n.marker)}++l});return s},getAllMarks:function(){var n=[];this.iter(function(e){var t=e.markedSpans;if(t)for(var r=0;r<t.length;++r)if(t[r].from!=null)n.push(t[r].marker)});return n},posFromIndex:function(r){var n,i=this.first,o=this.lineSeparator().length;this.iter(function(e){var t=e.text.length+o;if(t>r){n=r;return true}r-=t;++i});return I(this,P(i,n))},indexFromPos:function(e){e=I(this,e);var t=e.ch;if(e.line<this.first||e.ch<0)return 0;var r=this.lineSeparator().length;this.iter(this.first,e.line,function(e){t+=e.text.length+r});return t},copy:function(e){var t=new l(vt(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);t.scrollTop=this.scrollTop;t.scrollLeft=this.scrollLeft;t.sel=this.sel;t.extend=false;if(e){t.history.undoDepth=this.history.undoDepth;t.setHistory(this.getHistory())}return t},linkedDoc:function(e){if(!e)e={};var t=this.first,r=this.first+this.size;if(e.from!=null&&e.from>t)t=e.from;if(e.to!=null&&e.to<r)r=e.to;var n=new l(vt(this,t,r),e.mode||this.modeOption,t,this.lineSep,this.direction);if(e.sharedHist)n.history=this.history;(this.linked||(this.linked=[])).push({doc:n,sharedHist:e.sharedHist});n.linked=[{doc:this,isParent:true,sharedHist:e.sharedHist}];Ma(n,Sa(this));return n},unlinkDoc:function(e){if(e instanceof u)e=e.doc;if(this.linked)for(var t=0;t<this.linked.length;++t){var r=this.linked[t];if(r.doc!=e)continue;this.linked.splice(t,1);e.unlinkDoc(this);ka(Sa(this));break}if(e.history==this.history){var n=[e.id];So(e,function(e){return n.push(e.id)},true);e.history=new Ao(null);e.history.done=Uo(this.history.done,n);e.history.undone=Uo(this.history.undone,n)}},iterLinkedDocs:function(e){So(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(e){if(this.lineSep)return e.split(this.lineSep);return tt(e)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:r(function(e){if(e!="rtl")e="ltr";if(e==this.direction)return;this.direction=e;this.iter(function(e){return e.order=null});if(this.cm)Co(this.cm)})})).eachLine=l.prototype.iter,0);function Ia(e){var n=this;za(n);if(d(n,e)||nn(n.display,e))return;C(e);if(T)Aa=+new Date;var t=Xn(n,e,true),r=e.dataTransfer.files;if(!t||n.isReadOnly())return;if(r&&r.length&&window.FileReader&&window.File){var i=r.length,o=Array(i),a=0;var s=function(){if(++a==i)O(n,function(){t=I(n.doc,t);var e={from:t,to:t,text:n.doc.splitLines(o.filter(function(e){return e!=null}).join(n.doc.lineSeparator())),origin:"paste"};ia(n.doc,e);$o(n.doc,mo(I(n.doc,t),I(n.doc,go(e))))})()};var l=function(e,t){if(n.options.allowDropFileTypes&&m(n.options.allowDropFileTypes,e.type)==-1){s();return}var r=new FileReader;r.onerror=function(){return s()};r.onload=function(){var e=r.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(e)){s();return}o[t]=e;s()};r.readAsText(e)};for(var u=0;u<r.length;u++)l(r[u],u)}else{if(n.state.draggingText&&n.doc.sel.contains(t)>-1){n.state.draggingText(e);setTimeout(function(){return n.display.input.focus()},20);return}try{var c=e.dataTransfer.getData("Text");if(c){var h;if(n.state.draggingText&&!n.state.draggingText.copy)h=n.listSelections();Xo(n.doc,mo(t,t));if(h)for(var f=0;f<h.length;++f)ca(n.doc,"",h[f].anchor,h[f].head,"drag");n.replaceSelection(c,"around","paste");n.display.input.focus()}}catch(e){}}}function La(e,t){if(T&&(!e.state.draggingText||+new Date-Aa<100)){He(t);return}if(d(e,t)||nn(e.display,t))return;t.dataTransfer.setData("Text",e.getSelection());t.dataTransfer.effectAllowed="copyMove";if(t.dataTransfer.setDragImage&&!W){var r=w("img",null,null,"position: fixed; left: 0; top: 0;");r.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";if(G){r.width=r.height=1;e.display.wrapper.appendChild(r);r._top=r.offsetTop}t.dataTransfer.setDragImage(r,0,0);if(G)r.parentNode.removeChild(r)}}function Pa(e,t){var r=Xn(e,t);if(!r)return;var n=document.createDocumentFragment();ii(e,r,n);if(!e.display.dragCursor){e.display.dragCursor=w("div",null,"CodeMirror-cursors CodeMirror-dragcursors");e.display.lineSpace.insertBefore(e.display.dragCursor,e.display.cursorDiv)}o(e.display.dragCursor,n)}function za(e){if(e.display.dragCursor){e.display.lineSpace.removeChild(e.display.dragCursor);e.display.dragCursor=null}}function Da(t){if(!document.getElementsByClassName)return;var e=document.getElementsByClassName("CodeMirror"),r=[];for(var n=0;n<e.length;n++){var i=e[n].CodeMirror;if(i)r.push(i)}if(r.length)r[0].operation(function(){for(var e=0;e<r.length;e++)t(r[e])})}var Oa=false;function Ra(){if(Oa)return;Fa();Oa=true}function Fa(){var e;M(window,"resize",function(){if(e==null)e=setTimeout(function(){e=null;Da(Ba)},100)});M(window,"blur",function(){return Da(hi)})}function Ba(e){var t=e.display;t.cachedCharWidth=t.cachedTextHeight=t.cachedPaddingH=null;t.scrollbarsClipped=false;e.setSize()}for(var Na={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",224:"Mod",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},ja=0;ja<10;ja++)Na[ja+48]=Na[ja+96]=String(ja);for(var Ua=65;Ua<=90;Ua++)Na[Ua]=String.fromCharCode(Ua);for(var Va=1;Va<=12;Va++)Na[Va+111]=Na[Va+63235]="F"+Va;var Ga={};function Wa(e){var t=e.split(/-(?!$)/);e=t[t.length-1];var r,n,i,o;for(var a=0;a<t.length-1;a++){var s=t[a];if(/^(cmd|meta|m)$/i.test(s))o=true;else if(/^a(lt)?$/i.test(s))r=true;else if(/^(c|ctrl|control)$/i.test(s))n=true;else if(/^s(hift)?$/i.test(s))i=true;else throw new Error("Unrecognized modifier name: "+s)}if(r)e="Alt-"+e;if(n)e="Ctrl-"+e;if(o)e="Cmd-"+e;if(i)e="Shift-"+e;return e}function Za(e){var t={};for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];if(/^(name|fallthrough|(de|at)tach)$/.test(r))continue;if(n=="..."){delete e[r];continue}var i=Te(r.split(" "),Wa);for(var o=0;o<i.length;o++){var a=void 0,s=void 0;if(o==i.length-1){s=i.join(" ");a=n}else{s=i.slice(0,o+1).join(" ");a="..."}var l=t[s];if(!l)t[s]=a;else if(l!=a)throw new Error("Inconsistent bindings for "+s)}delete e[r]}for(var u in t)e[u]=t[u];return e}function qa(e,t,r,n){t=Ya(t);var i=t.call?t.call(e,n):t[e];if(i===false)return"nothing";if(i==="...")return"multi";if(i!=null&&r(i))return"handled";if(t.fallthrough){if(Object.prototype.toString.call(t.fallthrough)!="[object Array]")return qa(e,t.fallthrough,r,n);for(var o=0;o<t.fallthrough.length;o++){var a=qa(e,t.fallthrough[o],r,n);if(a)return a}}}function Ha(e){var t=typeof e=="string"?e:Na[e.keyCode];return t=="Ctrl"||t=="Alt"||t=="Shift"||t=="Mod"}function $a(e,t,r){var n=e;if(t.altKey&&n!="Alt")e="Alt-"+e;if((ee?t.metaKey:t.ctrlKey)&&n!="Ctrl")e="Ctrl-"+e;if((ee?t.ctrlKey:t.metaKey)&&n!="Mod")e="Cmd-"+e;if(!r&&t.shiftKey&&n!="Shift")e="Shift-"+e;return e}function Xa(e,t){if(G&&e.keyCode==34&&e["char"])return false;var r=Na[e.keyCode];if(r==null||e.altGraphKey)return false;if(e.keyCode==3&&e.code)r=e.code;return $a(r,e,t)}function Ya(e){return typeof e=="string"?Ga[e]:e}function Ja(t,e){var r=t.doc.sel.ranges,n=[];for(var i=0;i<r.length;i++){var o=e(r[i]);while(n.length&&A(o.from,Z(n).to)<=0){var a=n.pop();if(A(a.from,o.from)<0){o.from=a.from;break}}n.push(o)}D(t,function(){for(var e=n.length-1;e>=0;e--)ca(t.doc,"",n[e].from,n[e].to,"+delete");xi(t)})}function Ka(e,t,r){var n=De(e.text,t+r,r);return n<0||n>e.text.length?null:n}function Qa(e,t,r){var n=Ka(e,t.ch,r);return n==null?null:new P(t.line,n,r<0?"after":"before")}function es(e,t,r,n,i){if(e){if(t.doc.direction=="rtl")i=-i;var o=je(r,t.doc.direction);if(o){var a=i<0?Z(o):o[0];var s=i<0==(a.level==1);var l=s?"after":"before";var u;if(a.level>0||t.doc.direction=="rtl"){var c=gn(t,r);u=i<0?r.text.length-1:0;var h=yn(t,c,u).top;u=Oe(function(e){return yn(t,c,e).top==h},i<0==(a.level==1)?a.from:a.to-1,u);if(l=="before")u=Ka(r,u,1)}else u=i<0?a.to:a.from;return new P(n,u,l)}}return new P(n,i<0?r.text.length:0,i<0?"before":"after")}function ts(t,r,s,e){var l=je(r,t.doc.direction);if(!l)return Qa(r,s,e);if(s.ch>=r.text.length){s.ch=r.text.length;s.sticky="before"}else if(s.ch<=0){s.ch=0;s.sticky="after"}var n=Be(l,s.ch,s.sticky),i=l[n];if(t.doc.direction=="ltr"&&i.level%2==0&&(e>0?i.to>s.ch:i.from<s.ch))return Qa(r,s,e);var u=function(e,t){return Ka(r,e instanceof P?e.ch:e,t)};var o;var a=function(e){if(!t.options.lineWrapping)return{begin:0,end:r.text.length};o=o||gn(t,r);return Bn(t,r,o,e)};var c=a(s.sticky=="before"?u(s,-1):s.ch);if(t.doc.direction=="rtl"||i.level==1){var h=i.level==1==e<0;var f=u(s,h?1:-1);if(f!=null&&(!h?f>=i.from&&f>=c.begin:f<=i.to&&f<=c.end)){var d=h?"before":"after";return new P(s.line,f,d)}}var p=function(e,t,r){var n=function(e,t){return t?new P(s.line,u(e,1),"before"):new P(s.line,e,"after")};for(;e>=0&&e<l.length;e+=t){var i=l[e];var o=t>0==(i.level!=1);var a=o?r.begin:u(r.end,-1);if(i.from<=a&&a<i.to)return n(a,o);a=o?i.from:u(i.to,-1);if(r.begin<=a&&a<r.end)return n(a,o)}};var m=p(n+e,e,c);if(m)return m;var g=e>0?c.end:u(c.begin,-1);if(g!=null&&!(e>0&&g==r.text.length)){m=p(e>0?0:l.length-1,e,a(g));if(m)return m}return null}Ga.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},Ga.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},Ga.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},Ga.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},Ga["default"]=y?Ga.macDefault:Ga.pcDefault;var rs={selectAll:ra,singleSelection:function(e){return e.setSelection(e.getCursor("anchor"),e.getCursor("head"),ve)},killLine:function(r){return Ja(r,function(e){if(e.empty()){var t=L(r.doc,e.head.line).text.length;if(e.head.ch==t&&e.head.line<r.lastLine())return{from:e.head,to:P(e.head.line+1,0)};else return{from:e.head,to:P(e.head.line,t)}}else return{from:e.from(),to:e.to()}})},deleteLine:function(t){return Ja(t,function(e){return{from:P(e.from().line,0),to:I(t.doc,P(e.to().line+1,0))}})},delLineLeft:function(e){return Ja(e,function(e){return{from:P(e.from().line,0),to:e.from()}})},delWrappedLineLeft:function(n){return Ja(n,function(e){var t=n.charCoords(e.head,"div").top+5;var r=n.coordsChar({left:0,top:t},"div");return{from:r,to:e.from()}})},delWrappedLineRight:function(n){return Ja(n,function(e){var t=n.charCoords(e.head,"div").top+5;var r=n.coordsChar({left:n.display.lineDiv.offsetWidth+100,top:t},"div");return{from:e.from(),to:r}})},undo:function(e){return e.undo()},redo:function(e){return e.redo()},undoSelection:function(e){return e.undoSelection()},redoSelection:function(e){return e.redoSelection()},goDocStart:function(e){return e.extendSelection(P(e.firstLine(),0))},goDocEnd:function(e){return e.extendSelection(P(e.lastLine()))},goLineStart:function(t){return t.extendSelectionsBy(function(e){return ns(t,e.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(t){return t.extendSelectionsBy(function(e){return os(t,e.head)},{origin:"+move",bias:1})},goLineEnd:function(t){return t.extendSelectionsBy(function(e){return is(t,e.head.line)},{origin:"+move",bias:-1})},goLineRight:function(r){return r.extendSelectionsBy(function(e){var t=r.cursorCoords(e.head,"div").top+5;return r.coordsChar({left:r.display.lineDiv.offsetWidth+100,top:t},"div")},xe)},goLineLeft:function(r){return r.extendSelectionsBy(function(e){var t=r.cursorCoords(e.head,"div").top+5;return r.coordsChar({left:0,top:t},"div")},xe)},goLineLeftSmart:function(n){return n.extendSelectionsBy(function(e){var t=n.cursorCoords(e.head,"div").top+5;var r=n.coordsChar({left:0,top:t},"div");if(r.ch<n.getLine(r.line).search(/\S/))return os(n,e.head);return r},xe)},goLineUp:function(e){return e.moveV(-1,"line")},goLineDown:function(e){return e.moveV(1,"line")},goPageUp:function(e){return e.moveV(-1,"page")},goPageDown:function(e){return e.moveV(1,"page")},goCharLeft:function(e){return e.moveH(-1,"char")},goCharRight:function(e){return e.moveH(1,"char")},goColumnLeft:function(e){return e.moveH(-1,"column")},goColumnRight:function(e){return e.moveH(1,"column")},goWordLeft:function(e){return e.moveH(-1,"word")},goGroupRight:function(e){return e.moveH(1,"group")},goGroupLeft:function(e){return e.moveH(-1,"group")},goWordRight:function(e){return e.moveH(1,"word")},delCharBefore:function(e){return e.deleteH(-1,"codepoint")},delCharAfter:function(e){return e.deleteH(1,"char")},delWordBefore:function(e){return e.deleteH(-1,"word")},delWordAfter:function(e){return e.deleteH(1,"word")},delGroupBefore:function(e){return e.deleteH(-1,"group")},delGroupAfter:function(e){return e.deleteH(1,"group")},indentAuto:function(e){return e.indentSelection("smart")},indentMore:function(e){return e.indentSelection("add")},indentLess:function(e){return e.indentSelection("subtract")},insertTab:function(e){return e.replaceSelection("\t")},insertSoftTab:function(e){var t=[],r=e.listSelections(),n=e.options.tabSize;for(var i=0;i<r.length;i++){var o=r[i].from();var a=S(e.getLine(o.line),o.ch,n);t.push(Ee(n-a%n))}e.replaceSelections(t)},defaultTab:function(e){if(e.somethingSelected())e.indentSelection("add");else e.execCommand("insertTab")},transposeChars:function(a){return D(a,function(){var e=a.listSelections(),t=[];for(var r=0;r<e.length;r++){if(!e[r].empty())continue;var n=e[r].head,i=L(a.doc,n.line).text;if(i){if(n.ch==i.length)n=new P(n.line,n.ch-1);if(n.ch>0){n=new P(n.line,n.ch+1);a.replaceRange(i.charAt(n.ch-1)+i.charAt(n.ch-2),P(n.line,n.ch-2),n,"+transpose")}else if(n.line>a.doc.first){var o=L(a.doc,n.line-1).text;if(o){n=new P(n.line,1);a.replaceRange(i.charAt(0)+a.doc.lineSeparator()+o.charAt(o.length-1),P(n.line-1,o.length-1),n,"+transpose")}}}t.push(new R(n,n))}a.setSelections(t)})},newlineAndIndent:function(n){return D(n,function(){var e=n.listSelections();for(var t=e.length-1;t>=0;t--)n.replaceRange(n.doc.lineSeparator(),e[t].anchor,e[t].head,"+input");e=n.listSelections();for(var r=0;r<e.length;r++)n.indentLine(e[r].from().line,null,true);xi(n)})},openLine:function(e){return e.replaceSelection("\n","start")},toggleOverwrite:function(e){return e.toggleOverwrite()}};function ns(e,t){var r=L(e.doc,t);var n=dr(r);if(n!=r)t=E(n);return es(true,e,n,t,1)}function is(e,t){var r=L(e.doc,t);var n=pr(r);if(n!=r)t=E(n);return es(true,e,r,t,-1)}function os(e,t){var r=ns(e,t.line);var n=L(e.doc,r.line);var i=je(n,e.doc.direction);if(!i||i[0].level==0){var o=Math.max(r.ch,n.text.search(/\S/));var a=t.line==r.line&&t.ch<=o&&t.ch;return P(r.line,a?0:o,r.sticky)}return r}function as(e,t,r){if(typeof t=="string"){t=rs[t];if(!t)return false}e.display.input.ensurePolled();var n=e.display.shift,i=false;try{if(e.isReadOnly())e.state.suppressEdits=true;if(r)e.display.shift=false;i=t(e)!=ye}finally{e.display.shift=n;e.state.suppressEdits=false}return i}function ss(e,t,r){for(var n=0;n<e.state.keyMaps.length;n++){var i=qa(t,e.state.keyMaps[n],r,e);if(i)return i}return e.options.extraKeys&&qa(t,e.options.extraKeys,r,e)||qa(t,e.options.keyMap,r,e)}var ls=new me;function us(e,t,r,n){var i=e.state.keySeq;if(i){if(Ha(t))return"handled";if(/\'$/.test(t))e.state.keySeq=null;else ls.set(50,function(){if(e.state.keySeq==i){e.state.keySeq=null;e.display.input.reset()}});if(cs(e,i+" "+t,r,n))return true}return cs(e,t,r,n)}function cs(e,t,r,n){var i=ss(e,t,n);if(i=="multi")e.state.keySeq=t;if(i=="handled")x(e,"keyHandled",e,t,r);if(i=="handled"||i=="multi"){C(r);si(e)}return!!i}function hs(t,e){var r=Xa(e,true);if(!r)return false;if(e.shiftKey&&!t.state.keySeq)return us(t,"Shift-"+r,e,function(e){return as(t,e,true)})||us(t,r,e,function(e){if(typeof e=="string"?/^go[A-Z]/.test(e):e.motion)return as(t,e)});else return us(t,r,e,function(e){return as(t,e)})}function fs(t,e,r){return us(t,"'"+r+"'",e,function(e){return as(t,e,true)})}var ds=null;function ps(e){var t=this;if(e.target&&e.target!=t.display.input.getField())return;t.curOp.focus=h(he(t));if(d(t,e))return;if(T&&b<11&&e.keyCode==27)e.returnValue=false;var r=e.keyCode;t.display.shift=r==16||e.shiftKey;var n=hs(t,e);if(G){ds=n?r:null;if(!n&&r==88&&!nt&&(y?e.metaKey:e.ctrlKey))t.replaceSelection("",null,"cut")}if(B&&!y&&!n&&r==46&&e.shiftKey&&!e.ctrlKey&&document.execCommand)document.execCommand("cut");if(r==18&&!/\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className))ms(t)}function ms(e){var t=e.display.lineDiv;le(t,"CodeMirror-crosshair");function r(e){if(e.keyCode==18||!e.altKey){ne(t,"CodeMirror-crosshair");k(document,"keyup",r);k(document,"mouseover",r)}}M(document,"keyup",r);M(document,"mouseover",r)}function gs(e){if(e.keyCode==16)this.doc.sel.shift=false;d(this,e)}function ys(e){var t=this;if(e.target&&e.target!=t.display.input.getField())return;if(nn(t.display,e)||d(t,e)||e.ctrlKey&&!e.altKey||y&&e.metaKey)return;var r=e.keyCode,n=e.charCode;if(G&&r==ds){ds=null;C(e);return}if(G&&(!e.which||e.which<10)&&hs(t,e))return;var i=String.fromCharCode(n==null?r:n);if(i=="\b")return;if(fs(t,e,i))return;t.display.input.onKeyPress(e)}var vs=400,_s=function(e,t,r){this.time=e;this.pos=t;this.button=r},xs,bs;function ws(e,t){var r=+new Date;if(bs&&bs.compare(r,e,t)){xs=bs=null;return"triple"}else if(xs&&xs.compare(r,e,t)){bs=new _s(r,e,t);xs=null;return"double"}else{xs=new _s(r,e,t);bs=null;return"single"}}function Es(e){var t=this,r=t.display;if(d(t,e)||r.activeTouch&&r.input.supportsTouch())return;r.input.ensurePolled();r.shift=e.shiftKey;if(nn(r,e)){if(!g){r.scroller.draggable=false;setTimeout(function(){return r.scroller.draggable=true},100)}return}if(Ps(t,e))return;var n=Xn(t,e),i=Xe(e),o=n?ws(n,i):"single";fe(t).focus();if(i==1&&t.state.selectingText)t.state.selectingText(e);if(n&&Ts(t,i,n,o,e))return;if(i==1){if(n)Ms(t,n,o,e);else if($e(e)==r.scroller)C(e)}else if(i==2){if(n)Go(t.doc,n);setTimeout(function(){return r.input.focus()},20)}else if(i==3)if(te)t.display.input.onContextMenu(e);else ui(t)}function Ts(r,e,n,t,i){var o="Click";if(t=="double")o="Double"+o;else if(t=="triple")o="Triple"+o;o=(e==1?"Left":e==2?"Middle":"Right")+o;return us(r,$a(o,i),i,function(e){if(typeof e=="string")e=rs[e];if(!e)return false;var t=false;try{if(r.isReadOnly())r.state.suppressEdits=true;t=e(r,n)!=ye}finally{r.state.suppressEdits=false}return t})}function Ss(e,t,r){var n=e.getOption("configureMouse");var i=n?n(e,t,r):{};if(i.unit==null){var o=J?r.shiftKey&&r.metaKey:r.altKey;i.unit=o?"rectangle":t=="single"?"char":t=="double"?"word":"line"}if(i.extend==null||e.doc.extend)i.extend=e.doc.extend||r.shiftKey;if(i.addNew==null)i.addNew=y?r.metaKey:r.ctrlKey;if(i.moveOnDrag==null)i.moveOnDrag=!(y?r.altKey:r.ctrlKey);return i}function Ms(e,t,r,n){if(T)setTimeout(de(li,e),0);else e.curOp.focus=h(he(e));var i=Ss(e,r,n);var o=e.doc.sel,a;if(e.options.dragDrop&&Ye&&!e.isReadOnly()&&r=="single"&&(a=o.contains(t))>-1&&(A((a=o.ranges[a]).from(),t)<0||t.xRel>0)&&(A(a.to(),t)>0||t.xRel<0))ks(e,n,t,i);else As(e,n,t,i)}function ks(t,r,n,i){var o=t.display,a=false;var s=O(t,function(e){if(g)o.scroller.draggable=false;t.state.draggingText=false;if(t.state.delayingBlurEvent)if(t.hasFocus())t.state.delayingBlurEvent=false;else ui(t);k(o.wrapper.ownerDocument,"mouseup",s);k(o.wrapper.ownerDocument,"mousemove",l);k(o.scroller,"dragstart",u);k(o.scroller,"drop",s);if(!a){C(e);if(!i.addNew)Go(t.doc,n,null,null,i.extend);if(g&&!W||T&&b==9)setTimeout(function(){o.wrapper.ownerDocument.body.focus({preventScroll:true});o.input.focus()},20);else o.input.focus()}});var l=function(e){a=a||Math.abs(r.clientX-e.clientX)+Math.abs(r.clientY-e.clientY)>=10};var u=function(){return a=true};if(g)o.scroller.draggable=true;t.state.draggingText=s;s.copy=!i.moveOnDrag;M(o.wrapper.ownerDocument,"mouseup",s);M(o.wrapper.ownerDocument,"mousemove",l);M(o.scroller,"dragstart",u);M(o.scroller,"drop",s);t.state.delayingBlurEvent=true;setTimeout(function(){return o.input.focus()},20);if(o.scroller.dragDrop)o.scroller.dragDrop()}function Cs(e,t,r){if(r=="char")return new R(t,t);if(r=="word")return e.findWordAt(t);if(r=="line")return new R(P(t.line,0),I(e.doc,P(t.line+1,0)));var n=r(e,t);return new R(n.from,n.to)}function As(g,e,y,v){if(T)ui(g);var o=g.display,_=g.doc;C(e);var x,b,w=_.sel,t=w.ranges;if(v.addNew&&!v.extend){b=_.sel.contains(y);if(b>-1)x=t[b];else x=new R(y,y)}else{x=_.sel.primary();b=_.sel.primIndex}if(v.unit=="rectangle"){if(!v.addNew)x=new R(y,y);y=Xn(g,e,true,true);b=-1}else{var r=Cs(g,y,v.unit);if(v.extend)x=Vo(x,r.anchor,r.head,v.extend);else x=r}if(!v.addNew){b=0;F(_,new f([x],0),_e);w=_.sel}else if(b==-1){b=t.length;F(_,po(g,t.concat([x]),b),{scroll:false,origin:"*mouse"})}else if(t.length>1&&t[b].empty()&&v.unit=="char"&&!v.extend){F(_,po(g,t.slice(0,b).concat(t.slice(b+1)),0),{scroll:false,origin:"*mouse"});w=_.sel}else Zo(_,b,x,_e);var E=y;function a(e){if(A(E,e)==0)return;E=e;if(v.unit=="rectangle"){var t=[],r=g.options.tabSize;var n=S(L(_,y.line).text,y.ch,r);var i=S(L(_,e.line).text,e.ch,r);var o=Math.min(n,i),a=Math.max(n,i);for(var s=Math.min(y.line,e.line),l=Math.min(g.lastLine(),Math.max(y.line,e.line));s<=l;s++){var u=L(_,s).text,c=be(u,o,r);if(o==a)t.push(new R(P(s,c),P(s,c)));else if(u.length>c)t.push(new R(P(s,c),P(s,be(u,a,r))))}if(!t.length)t.push(new R(y,y));F(_,po(g,w.ranges.slice(0,b).concat(t),b),{origin:"*mouse",scroll:false});g.scrollIntoView(e)}else{var h=x;var f=Cs(g,e,v.unit);var d=h.anchor,p;if(A(f.anchor,d)>0){p=f.head;d=Mt(h.from(),f.anchor)}else{p=f.anchor;d=St(h.to(),f.head)}var m=w.ranges.slice(0);m[b]=Is(g,new R(I(_,d),p));F(_,po(g,m,b),_e)}}var s=o.wrapper.getBoundingClientRect();var l=0;function u(e){var t=++l;var r=Xn(g,e,true,v.unit=="rectangle");if(!r)return;if(A(r,E)!=0){g.curOp.focus=h(he(g));a(r);var n=pi(o,_);if(r.line>=n.to||r.line<n.from)setTimeout(O(g,function(){if(l==t)u(e)}),150)}else{var i=e.clientY<s.top?-20:e.clientY>s.bottom?20:0;if(i)setTimeout(O(g,function(){if(l!=t)return;o.scroller.scrollTop+=i;u(e)}),50)}}function n(e){g.state.selectingText=false;l=Infinity;if(e){C(e);o.input.focus()}k(o.wrapper.ownerDocument,"mousemove",i);k(o.wrapper.ownerDocument,"mouseup",c);_.history.lastSelOrigin=null}var i=O(g,function(e){if(e.buttons===0||!Xe(e))n(e);else u(e)});var c=O(g,n);g.state.selectingText=c;M(o.wrapper.ownerDocument,"mousemove",i);M(o.wrapper.ownerDocument,"mouseup",c)}function Is(e,t){var r=t.anchor;var n=t.head;var i=L(e.doc,r.line);if(A(r,n)==0&&r.sticky==n.sticky)return t;var o=je(i);if(!o)return t;var a=Be(o,r.ch,r.sticky),s=o[a];if(s.from!=r.ch&&s.to!=r.ch)return t;var l=a+(s.from==r.ch==(s.level!=1)?0:1);if(l==0||l==o.length)return t;var u;if(n.line!=r.line)u=(n.line-r.line)*(e.doc.direction=="ltr"?1:-1)>0;else{var c=Be(o,n.ch,n.sticky);var h=c-a||(n.ch-r.ch)*(s.level==1?-1:1);if(c==l-1||c==l)u=h<0;else u=h>0}var f=o[l+(u?-1:0)];var d=u==(f.level==1);var p=d?f.from:f.to,m=d?"after":"before";return r.ch==p&&r.sticky==m?t:new R(new P(r.line,p,m),n)}function Ls(e,t,r,n){var i,o;if(t.touches){i=t.touches[0].clientX;o=t.touches[0].clientY}else try{i=t.clientX;o=t.clientY}catch(e){return false}if(i>=Math.floor(e.display.gutters.getBoundingClientRect().right))return false;if(n)C(t);var a=e.display;var s=a.lineDiv.getBoundingClientRect();if(o>s.bottom||!v(e,r))return qe(t);o-=s.top-a.viewOffset;for(var l=0;l<e.display.gutterSpecs.length;++l){var u=a.gutters.childNodes[l];if(u&&u.getBoundingClientRect().right>=i){var c=xt(e.doc,o);var h=e.display.gutterSpecs[l];p(e,r,e,c,h.className,t);return qe(t)}}}function Ps(e,t){return Ls(e,t,"gutterClick",true)}function zs(e,t){if(nn(e.display,t)||Ds(e,t))return;if(d(e,t,"contextmenu"))return;if(!te)e.display.input.onContextMenu(t)}function Ds(e,t){if(!v(e,"gutterContextMenu"))return false;return Ls(e,t,"gutterContextMenu",false)}function Os(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-");Mn(e)}_s.prototype.compare=function(e,t,r){return this.time+vs>e&&A(t,this.pos)==0&&r==this.button};var Rs={toString:function(){return"CodeMirror.Init"}},Fs={},Bs={};function Ns(i){var o=i.optionHandlers;function e(e,t,n,r){i.defaults[e]=t;if(n)o[e]=r?function(e,t,r){if(r!=Rs)n(e,t,r)}:n}i.defineOption=e;i.Init=Rs;e("value","",function(e,t){return e.setValue(t)},true);e("mode",null,function(e,t){e.doc.modeOption=t;bo(e)},true);e("indentUnit",2,bo,true);e("indentWithTabs",false);e("smartIndent",true);e("tabSize",4,function(e){wo(e);Mn(e);z(e)},true);e("lineSeparator",null,function(e,n){e.doc.lineSep=n;if(!n)return;var i=[],o=e.doc.first;e.doc.iter(function(e){for(var t=0;;){var r=e.text.indexOf(n,t);if(r==-1)break;t=r+n.length;i.push(P(o,r))}o++});for(var t=i.length-1;t>=0;t--)ca(e.doc,n,i[t],P(i[t].line,i[t].ch+n.length))});e("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b\u200e\u200f\u2028\u2029\u202d\u202e\u2066\u2067\u2069\ufeff\ufff9-\ufffc]/g,function(e,t,r){e.state.specialChars=new RegExp(t.source+(t.test("\t")?"":"|\t"),"g");if(r!=Rs)e.refresh()});e("specialCharPlaceholder",Ir,function(e){return e.refresh()},true);e("electricChars",true);e("inputStyle",Y?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},true);e("spellcheck",false,function(e,t){return e.getInputField().spellcheck=t},true);e("autocorrect",false,function(e,t){return e.getInputField().autocorrect=t},true);e("autocapitalize",false,function(e,t){return e.getInputField().autocapitalize=t},true);e("rtlMoveVisually",!K);e("wholeLineUpdateBefore",true);e("theme","default",function(e){Os(e);ao(e)},true);e("keyMap","default",function(e,t,r){var n=Ya(t);var i=r!=Rs&&Ya(r);if(i&&i.detach)i.detach(e,n);if(n.attach)n.attach(e,i||null)});e("extraKeys",null);e("configureMouse",null);e("lineWrapping",false,Us,true);e("gutters",[],function(e,t){e.display.gutterSpecs=io(t,e.options.lineNumbers);ao(e)},true);e("fixedGutter",true,function(e,t){e.display.gutters.style.left=t?qn(e.display)+"px":"0";e.refresh()},true);e("coverGutterNextToScrollbar",false,function(e){return Li(e)},true);e("scrollbarStyle","native",function(e){Di(e);Li(e);e.display.scrollbars.setScrollTop(e.doc.scrollTop);e.display.scrollbars.setScrollLeft(e.doc.scrollLeft)},true);e("lineNumbers",false,function(e,t){e.display.gutterSpecs=io(e.options.gutters,t);ao(e)},true);e("firstLineNumber",1,ao,true);e("lineNumberFormatter",function(e){return e},ao,true);e("showCursorWhenSelecting",false,ri,true);e("resetSelectionOnContextMenu",true);e("lineWiseCopyCut",true);e("pasteLinesPerSelection",true);e("selectionsMayTouch",false);e("readOnly",false,function(e,t){if(t=="nocursor"){hi(e);e.display.input.blur()}e.display.input.readOnlyChanged(t)});e("screenReaderLabel",null,function(e,t){t=t===""?null:t;e.display.input.screenReaderLabelChanged(t)});e("disableInput",false,function(e,t){if(!t)e.display.input.reset()},true);e("dragDrop",true,js);e("allowDropFileTypes",null);e("cursorBlinkRate",530);e("cursorScrollMargin",0);e("cursorHeight",1,ri,true);e("singleCursorHeightPerLine",true,ri,true);e("workTime",100);e("workDelay",100);e("flattenSpans",true,wo,true);e("addModeClass",false,wo,true);e("pollInterval",100);e("undoDepth",200,function(e,t){return e.doc.history.undoDepth=t});e("historyEventDelay",1250);e("viewportMargin",10,function(e){return e.refresh()},true);e("maxHighlightLength",1e4,wo,true);e("moveInputWithCursor",true,function(e,t){if(!t)e.display.input.resetPosition()});e("tabindex",null,function(e,t){return e.display.input.getField().tabIndex=t||""});e("autofocus",null);e("direction","ltr",function(e,t){return e.doc.setDirection(t)},true);e("phrases",null)}function js(e,t,r){var n=r&&r!=Rs;if(!t!=!n){var i=e.display.dragFunctions;var o=t?M:k;o(e.display.scroller,"dragstart",i.start);o(e.display.scroller,"dragenter",i.enter);o(e.display.scroller,"dragover",i.over);o(e.display.scroller,"dragleave",i.leave);o(e.display.scroller,"drop",i.drop)}}function Us(e){if(e.options.lineWrapping){le(e.display.wrapper,"CodeMirror-wrap");e.display.sizer.style.minWidth="";e.display.sizerWidth=null}else{ne(e.display.wrapper,"CodeMirror-wrap");wr(e)}$n(e);z(e);Mn(e);setTimeout(function(){return Li(e)},100)}function u(e,t){var r=this;if(!(this instanceof u))return new u(e,t);this.options=t=t?pe(t):{};pe(Fs,t,false);var n=t.value;if(typeof n=="string")n=new l(n,t.mode,null,t.lineSeparator,t.direction);else if(t.mode)n.modeOption=t.mode;this.doc=n;var i=new u.inputStyles[t.inputStyle](this);var o=this.display=new so(e,n,i,t);o.wrapper.CodeMirror=this;Os(this);if(t.lineWrapping)this.display.wrapper.className+=" CodeMirror-wrap";Di(this);this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:false,delayingBlurEvent:false,focused:false,suppressEdits:false,pasteIncoming:-1,cutIncoming:-1,selectingText:false,draggingText:false,highlight:new me,keySeq:null,specialChars:null};if(t.autofocus&&!Y)o.input.focus();if(T&&b<11)setTimeout(function(){return r.display.input.reset(true)},20);Vs(this);Ra();Ri(this);this.curOp.forceUpdate=true;Mo(this,n);if(t.autofocus&&!Y||this.hasFocus())setTimeout(function(){if(r.hasFocus()&&!r.state.focused)ci(r)},20);else hi(this);for(var a in Bs)if(Bs.hasOwnProperty(a))Bs[a](this,t[a],Rs);no(this);if(t.finishInit)t.finishInit(this);for(var s=0;s<Gs.length;++s)Gs[s](this);Fi(this);if(g&&t.lineWrapping&&getComputedStyle(o.lineDiv).textRendering=="optimizelegibility")o.lineDiv.style.textRendering="auto"}function Vs(i){var o=i.display;M(o.scroller,"mousedown",O(i,Es));if(T&&b<11)M(o.scroller,"dblclick",O(i,function(e){if(d(i,e))return;var t=Xn(i,e);if(!t||Ps(i,e)||nn(i.display,e))return;C(e);var r=i.findWordAt(t);Go(i.doc,r.anchor,r.head)}));else M(o.scroller,"dblclick",function(e){return d(i,e)||C(e)});M(o.scroller,"contextmenu",function(e){return zs(i,e)});M(o.input.getField(),"contextmenu",function(e){if(!o.scroller.contains(e.target))zs(i,e)});var r,n={end:0};function a(){if(o.activeTouch){r=setTimeout(function(){return o.activeTouch=null},1e3);n=o.activeTouch;n.end=+new Date}}function s(e){if(e.touches.length!=1)return false;var t=e.touches[0];return t.radiusX<=1&&t.radiusY<=1}function l(e,t){if(t.left==null)return true;var r=t.left-e.left,n=t.top-e.top;return r*r+n*n>20*20}M(o.scroller,"touchstart",function(e){if(!d(i,e)&&!s(e)&&!Ps(i,e)){o.input.ensurePolled();clearTimeout(r);var t=+new Date;o.activeTouch={start:t,moved:false,prev:t-n.end<=300?n:null};if(e.touches.length==1){o.activeTouch.left=e.touches[0].pageX;o.activeTouch.top=e.touches[0].pageY}}});M(o.scroller,"touchmove",function(){if(o.activeTouch)o.activeTouch.moved=true});M(o.scroller,"touchend",function(e){var t=o.activeTouch;if(t&&!nn(o,e)&&t.left!=null&&!t.moved&&new Date-t.start<300){var r=i.coordsChar(o.activeTouch,"page"),n;if(!t.prev||l(t,t.prev))n=new R(r,r);else if(!t.prev.prev||l(t,t.prev.prev))n=i.findWordAt(r);else n=new R(P(r.line,0),I(i.doc,P(r.line+1,0)));i.setSelection(n.anchor,n.head);i.focus();C(e)}a()});M(o.scroller,"touchcancel",a);M(o.scroller,"scroll",function(){if(o.scroller.clientHeight){Si(i,o.scroller.scrollTop);ki(i,o.scroller.scrollLeft,true);p(i,"scroll",i)}});M(o.scroller,"mousewheel",function(e){return fo(i,e)});M(o.scroller,"DOMMouseScroll",function(e){return fo(i,e)});M(o.wrapper,"scroll",function(){return o.wrapper.scrollTop=o.wrapper.scrollLeft=0});o.dragFunctions={enter:function(e){if(!d(i,e))He(e)},over:function(e){if(!d(i,e)){Pa(i,e);He(e)}},start:function(e){return La(i,e)},drop:O(i,Ia),leave:function(e){if(!d(i,e))za(i)}};var e=o.input.getField();M(e,"keyup",function(e){return gs.call(i,e)});M(e,"keydown",O(i,ps));M(e,"keypress",O(i,ys));M(e,"focus",function(e){return ci(i,e)});M(e,"blur",function(e){return hi(i,e)})}u.defaults=Fs,u.optionHandlers=Bs;var Gs=[];function Ws(e,t,r,n){var i=e.doc,o;if(r==null)r="add";if(r=="smart")if(!i.mode.indent)r="prev";else o=Dt(e,t).state;var a=e.options.tabSize;var s=L(i,t),l=S(s.text,null,a);if(s.stateAfter)s.stateAfter=null;var u=s.text.match(/^\s*/)[0],c;if(!n&&!/\S/.test(s.text)){c=0;r="not"}else if(r=="smart"){c=i.mode.indent(o,s.text.slice(u.length),s.text);if(c==ye||c>150){if(!n)return;r="prev"}}if(r=="prev")if(t>i.first)c=S(L(i,t-1).text,null,a);else c=0;else if(r=="add")c=l+e.options.indentUnit;else if(r=="subtract")c=l-e.options.indentUnit;else if(typeof r=="number")c=l+r;c=Math.max(0,c);var h="",f=0;if(e.options.indentWithTabs)for(var d=Math.floor(c/a);d;--d){f+=a;h+="\t"}if(f<c)h+=Ee(c-f);if(h!=u){ca(i,h,P(t,0),P(t,u.length),"+input");s.stateAfter=null;return true}else for(var p=0;p<i.sel.ranges.length;p++){var m=i.sel.ranges[p];if(m.head.line==t&&m.head.ch<u.length){var g=P(t,u.length);Zo(i,p,new R(g,g));break}}}u.defineInitHook=function(e){return Gs.push(e)};var Zs=null;function qs(e){Zs=e}function Hs(e,t,r,n,i){var o=e.doc;e.display.shift=false;if(!n)n=o.sel;var a=+new Date-200;var s=i=="paste"||e.state.pasteIncoming>a;var l=tt(t),u=null;if(s&&n.ranges.length>1)if(Zs&&Zs.text.join("\n")==t){if(n.ranges.length%Zs.text.length==0){u=[];for(var c=0;c<Zs.text.length;c++)u.push(o.splitLines(Zs.text[c]))}}else if(l.length==n.ranges.length&&e.options.pasteLinesPerSelection)u=Te(l,function(e){return[e]});var h=e.curOp.updateInput;for(var f=n.ranges.length-1;f>=0;f--){var d=n.ranges[f];var p=d.from(),m=d.to();if(d.empty())if(r&&r>0)p=P(p.line,p.ch-r);else if(e.state.overwrite&&!s)m=P(m.line,Math.min(L(o,m.line).text.length,m.ch+Z(l).length));else if(s&&Zs&&Zs.lineWise&&Zs.text.join("\n")==l.join("\n"))p=m=P(p.line,0);var g={from:p,to:m,text:u?u[f%u.length]:l,origin:i||(s?"paste":e.state.cutIncoming>a?"cut":"+input")};ia(e.doc,g);x(e,"inputRead",e,g)}if(t&&!s)Xs(e,t);xi(e);if(e.curOp.updateInput<2)e.curOp.updateInput=h;e.curOp.typing=true;e.state.pasteIncoming=e.state.cutIncoming=-1}function $s(e,t){var r=e.clipboardData&&e.clipboardData.getData("Text");if(r){e.preventDefault();if(!t.isReadOnly()&&!t.options.disableInput&&t.hasFocus())D(t,function(){return Hs(t,r,0,null,"paste")});return true}}function Xs(e,t){if(!e.options.electricChars||!e.options.smartIndent)return;var r=e.doc.sel;for(var n=r.ranges.length-1;n>=0;n--){var i=r.ranges[n];if(i.head.ch>100||n&&r.ranges[n-1].head.line==i.head.line)continue;var o=e.getModeAt(i.head);var a=false;if(o.electricChars){for(var s=0;s<o.electricChars.length;s++)if(t.indexOf(o.electricChars.charAt(s))>-1){a=Ws(e,i.head.line,"smart");break}}else if(o.electricInput)if(o.electricInput.test(L(e.doc,i.head.line).text.slice(0,i.head.ch)))a=Ws(e,i.head.line,"smart");if(a)x(e,"electricInput",e,i.head.line)}}function Ys(e){var t=[],r=[];for(var n=0;n<e.doc.sel.ranges.length;n++){var i=e.doc.sel.ranges[n].head.line;var o={anchor:P(i,0),head:P(i+1,0)};r.push(o);t.push(e.getRange(o.anchor,o.head))}return{text:t,ranges:r}}function Js(e,t,r,n){e.setAttribute("autocorrect",r?"":"off");e.setAttribute("autocapitalize",n?"":"off");e.setAttribute("spellcheck",!!t)}function Ks(){var e=w("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; min-height: 1em; outline: none");var t=w("div",[e],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");if(g)e.style.width="1000px";else e.setAttribute("wrap","off");if($)e.style.border="1px solid black";Js(e);return t}function Qs(i){var o=i.optionHandlers;var u=i.helpers={};i.prototype={constructor:i,focus:function(){fe(this).focus();this.display.input.focus()},setOption:function(e,t){var r=this.options,n=r[e];if(r[e]==t&&e!="mode")return;r[e]=t;if(o.hasOwnProperty(e))O(this,o[e])(this,t,n);p(this,"optionChange",this,e)},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e,t){this.state.keyMaps[t?"push":"unshift"](Ya(e))},removeKeyMap:function(e){var t=this.state.keyMaps;for(var r=0;r<t.length;++r)if(t[r]==e||t[r].name==e){t.splice(r,1);return true}},addOverlay:t(function(e,t){var r=e.token?e:i.getMode(this.options,e);if(r.startState)throw new Error("Overlays may not be stateful.");Se(this.state.overlays,{mode:r,modeSpec:e,opaque:t&&t.opaque,priority:t&&t.priority||0},function(e){return e.priority});this.state.modeGen++;z(this)}),removeOverlay:t(function(e){var t=this.state.overlays;for(var r=0;r<t.length;++r){var n=t[r].modeSpec;if(n==e||typeof e=="string"&&n.name==e){t.splice(r,1);this.state.modeGen++;z(this);return}}}),indentLine:t(function(e,t,r){if(typeof t!="string"&&typeof t!="number")if(t==null)t=this.options.smartIndent?"smart":"prev";else t=t?"add":"subtract";if(bt(this.doc,e))Ws(this,e,t,r)}),indentSelection:t(function(e){var t=this.doc.sel.ranges,r=-1;for(var n=0;n<t.length;n++){var i=t[n];if(!i.empty()){var o=i.from(),a=i.to();var s=Math.max(r,o.line);r=Math.min(this.lastLine(),a.line-(a.ch?0:1))+1;for(var l=s;l<r;++l)Ws(this,l,e);var u=this.doc.sel.ranges;if(o.ch==0&&t.length==u.length&&u[n].from().ch>0)Zo(this.doc,n,new R(o,u[n].to()),ve)}else if(i.head.line>r){Ws(this,i.head.line,e,true);r=i.head.line;if(n==this.doc.sel.primIndex)xi(this)}}}),getTokenAt:function(e,t){return Nt(this,e,t)},getLineTokens:function(e,t){return Nt(this,P(e),t,true)},getTokenTypeAt:function(e){e=I(this.doc,e);var t=zt(this,L(this.doc,e.line));var r=0,n=(t.length-1)/2,i=e.ch;var o;if(i==0)o=t[2];else for(;;){var a=r+n>>1;if((a?t[a*2-1]:0)>=i)n=a;else if(t[a*2+1]<i)r=a+1;else{o=t[a*2+2];break}}var s=o?o.indexOf("overlay "):-1;return s<0?o:s==0?null:o.slice(0,s-1)},getModeAt:function(e){var t=this.doc.mode;if(!t.innerMode)return t;return i.innerMode(t,this.getTokenAt(e).state).mode},getHelper:function(e,t){return this.getHelpers(e,t)[0]},getHelpers:function(e,t){var r=[];if(!u.hasOwnProperty(t))return r;var n=u[t],i=this.getModeAt(e);if(typeof i[t]=="string"){if(n[i[t]])r.push(n[i[t]])}else if(i[t])for(var o=0;o<i[t].length;o++){var a=n[i[t][o]];if(a)r.push(a)}else if(i.helperType&&n[i.helperType])r.push(n[i.helperType]);else if(n[i.name])r.push(n[i.name]);for(var s=0;s<n._global.length;s++){var l=n._global[s];if(l.pred(i,this)&&m(r,l.val)==-1)r.push(l.val)}return r},getStateAfter:function(e,t){var r=this.doc;e=kt(r,e==null?r.first+r.size-1:e);return Dt(this,e+1,t).state},cursorCoords:function(e,t){var r,n=this.doc.sel.primary();if(e==null)r=n.head;else if(typeof e=="object")r=I(this.doc,e);else r=e?n.from():n.to();return zn(this,r,t||"page")},charCoords:function(e,t){return Pn(this,I(this.doc,e),t||"page")},coordsChar:function(e,t){e=Ln(this,e,t||"page");return Rn(this,e.left,e.top)},lineAtHeight:function(e,t){e=Ln(this,{top:e,left:0},t||"page").top;return xt(this.doc,e+this.display.viewOffset)},heightAtLine:function(e,t,r){var n=false,i;if(typeof e=="number"){var o=this.doc.first+this.doc.size-1;if(e<this.doc.first)e=this.doc.first;else if(e>o){e=o;n=true}i=L(this.doc,e)}else i=e;return In(this,i,{top:0,left:0},t||"page",r||n).top+(n?this.doc.height-xr(i):0)},defaultTextHeight:function(){return Gn(this.display)},defaultCharWidth:function(){return Wn(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(e,t,r,n,i){var o=this.display;e=zn(this,I(this.doc,e));var a=e.bottom,s=e.left;t.style.position="absolute";t.setAttribute("cm-ignore-events","true");this.display.input.setUneditable(t);o.sizer.appendChild(t);if(n=="over")a=e.top;else if(n=="above"||n=="near"){var l=Math.max(o.wrapper.clientHeight,this.doc.height),u=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);if((n=="above"||e.bottom+t.offsetHeight>l)&&e.top>t.offsetHeight)a=e.top-t.offsetHeight;else if(e.bottom+t.offsetHeight<=l)a=e.bottom;if(s+t.offsetWidth>u)s=u-t.offsetWidth}t.style.top=a+"px";t.style.left=t.style.right="";if(i=="right"){s=o.sizer.clientWidth-t.offsetWidth;t.style.right="0px"}else{if(i=="left")s=0;else if(i=="middle")s=(o.sizer.clientWidth-t.offsetWidth)/2;t.style.left=s+"px"}if(r)yi(this,{left:s,top:a,right:s+t.offsetWidth,bottom:a+t.offsetHeight})},triggerOnKeyDown:t(ps),triggerOnKeyPress:t(ys),triggerOnKeyUp:gs,triggerOnMouseDown:t(Es),execCommand:function(e){if(rs.hasOwnProperty(e))return rs[e].call(null,this)},triggerElectric:t(function(e){Xs(this,e)}),findPosH:function(e,t,r,n){var i=1;if(t<0){i=-1;t=-t}var o=I(this.doc,e);for(var a=0;a<t;++a){o=el(this.doc,o,i,r,n);if(o.hitSide)break}return o},moveH:t(function(t,r){var n=this;this.extendSelectionsBy(function(e){if(n.display.shift||n.doc.extend||e.empty())return el(n.doc,e.head,t,r,n.options.rtlMoveVisually);else return t<0?e.from():e.to()},xe)}),deleteH:t(function(r,n){var e=this.doc.sel,i=this.doc;if(e.somethingSelected())i.replaceSelection("",null,"+delete");else Ja(this,function(e){var t=el(i,e.head,r,n,false);return r<0?{from:t,to:e.head}:{from:e.head,to:t}})}),findPosV:function(e,t,r,n){var i=1,o=n;if(t<0){i=-1;t=-t}var a=I(this.doc,e);for(var s=0;s<t;++s){var l=zn(this,a,"div");if(o==null)o=l.left;else l.left=o;a=tl(this,l,i,r);if(a.hitSide)break}return a},moveV:t(function(n,i){var o=this;var a=this.doc,s=[];var l=!this.display.shift&&!a.extend&&a.sel.somethingSelected();a.extendSelectionsBy(function(e){if(l)return n<0?e.from():e.to();var t=zn(o,e.head,"div");if(e.goalColumn!=null)t.left=e.goalColumn;s.push(t.left);var r=tl(o,t,n,i);if(i=="page"&&e==a.sel.primary())_i(o,Pn(o,r,"div").top-t.top);return r},xe);if(s.length)for(var e=0;e<a.sel.ranges.length;e++)a.sel.ranges[e].goalColumn=s[e]}),findWordAt:function(e){var t=this.doc,r=L(t,e.line).text;var n=e.ch,i=e.ch;if(r){var o=this.getHelper(e,"wordChars");if((e.sticky=="before"||i==r.length)&&n)--n;else++i;var a=r.charAt(n);var s=Ie(a,o)?function(e){return Ie(e,o)}:/\s/.test(a)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!Ie(e)};while(n>0&&s(r.charAt(n-1)))--n;while(i<r.length&&s(r.charAt(i)))++i}return new R(P(e.line,n),P(e.line,i))},toggleOverwrite:function(e){if(e!=null&&e==this.state.overwrite)return;if(this.state.overwrite=!this.state.overwrite)le(this.display.cursorDiv,"CodeMirror-overwrite");else ne(this.display.cursorDiv,"CodeMirror-overwrite");p(this,"overwriteToggle",this,this.state.overwrite)},hasFocus:function(){return this.display.input.getField()==h(he(this))},isReadOnly:function(){return!!(this.options.readOnly||this.doc.cantEdit)},scrollTo:t(function(e,t){bi(this,e,t)}),getScrollInfo:function(){var e=this.display.scroller;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-ln(this)-this.display.barHeight,width:e.scrollWidth-ln(this)-this.display.barWidth,clientHeight:cn(this),clientWidth:un(this)}},scrollIntoView:t(function(e,t){if(e==null){e={from:this.doc.sel.primary().head,to:null};if(t==null)t=this.options.cursorScrollMargin}else if(typeof e=="number")e={from:P(e,0),to:null};else if(e.from==null)e={from:e,to:null};if(!e.to)e.to=e.from;e.margin=t||0;if(e.from.line!=null)wi(this,e);else Ti(this,e.from,e.to,e.margin)}),setSize:t(function(e,t){var r=this;var n=function(e){return typeof e=="number"||/^\d+$/.test(String(e))?e+"px":e};if(e!=null)this.display.wrapper.style.width=n(e);if(t!=null)this.display.wrapper.style.height=n(t);if(this.options.lineWrapping)Sn(this);var i=this.display.viewFrom;this.doc.iter(i,this.display.viewTo,function(e){if(e.widgets)for(var t=0;t<e.widgets.length;t++)if(e.widgets[t].noHScroll){Jn(r,i,"widget");break}++i});this.curOp.forceUpdate=true;p(this,"refresh",this)}),operation:function(e){return D(this,e)},startOperation:function(){return Ri(this)},endOperation:function(){return Fi(this)},refresh:t(function(){var e=this.display.cachedTextHeight;z(this);this.curOp.forceUpdate=true;Mn(this);bi(this,this.doc.scrollLeft,this.doc.scrollTop);eo(this.display);if(e==null||Math.abs(e-Gn(this.display))>.5||this.options.lineWrapping)$n(this);p(this,"refresh",this)}),swapDoc:t(function(e){var t=this.doc;t.cm=null;if(this.state.selectingText)this.state.selectingText();Mo(this,e);Mn(this);this.display.input.reset();bi(this,e.scrollLeft,e.scrollTop);this.curOp.forceScroll=true;x(this,"swapDoc",this,t);return t}),phrase:function(e){var t=this.options.phrases;return t&&Object.prototype.hasOwnProperty.call(t,e)?t[e]:e},getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}};We(i);i.registerHelper=function(e,t,r){if(!u.hasOwnProperty(e))u[e]=i[e]={_global:[]};u[e][t]=r};i.registerGlobalHelper=function(e,t,r,n){i.registerHelper(e,t,n);u[e]._global.push({pred:r,val:n})}}function el(i,o,a,s,l){var e=o;var t=a;var u=L(i,o.line);var c=l&&i.direction=="rtl"?-a:a;function h(){var e=o.line+c;if(e<i.first||e>=i.first+i.size)return false;o=new P(e,o.ch,o.sticky);return u=L(i,e)}function r(e){var t;if(s=="codepoint"){var r=u.text.charCodeAt(o.ch+(a>0?0:-1));if(isNaN(r))t=null;else{var n=a>0?r>=55296&&r<56320:r>=56320&&r<57343;t=new P(o.line,Math.max(0,Math.min(u.text.length,o.ch+a*(n?2:1))),-a)}}else if(l)t=ts(i.cm,u,o,a);else t=Qa(u,o,a);if(t==null)if(!e&&h())o=es(l,i.cm,u,o.line,c);else return false;else o=t;return true}if(s=="char"||s=="codepoint")r();else if(s=="column")r(true);else if(s=="word"||s=="group"){var n=null,f=s=="group";var d=i.cm&&i.cm.getHelper(o,"wordChars");for(var p=true;;p=false){if(a<0&&!r(!p))break;var m=u.text.charAt(o.ch)||"\n";var g=Ie(m,d)?"w":f&&m=="\n"?"n":!f||/\s/.test(m)?null:"p";if(f&&!p&&!g)g="s";if(n&&n!=g){if(a<0){a=1;r();o.sticky="after"}break}if(g)n=g;if(a>0&&!r(!p))break}}var y=ea(i,o,e,t,true);if(Et(e,y))y.hitSide=true;return y}function tl(e,t,r,n){var i=e.doc,o=t.left,a;if(n=="page"){var s=Math.min(e.display.wrapper.clientHeight,fe(e).innerHeight||i(e).documentElement.clientHeight);var l=Math.max(s-.5*Gn(e.display),3);a=(r>0?t.bottom:t.top)+r*l}else if(n=="line")a=r>0?t.bottom+3:t.top-3;var u;for(;;){u=Rn(e,o,a);if(!u.outside)break;if(r<0?a<=0:a>=i.height){u.hitSide=true;break}a+=r*5}return u}var n=function(e){this.cm=e;this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null;this.polling=new me;this.composing=null;this.gracePeriod=false;this.readDOMTimeout=null};function rl(e,t){var r=mn(e,t.line);if(!r||r.hidden)return null;var n=L(e.doc,t.line);var i=fn(r,n,t.line);var o=je(n,e.doc.direction),a="left";if(o){var s=Be(o,t.ch);a=s%2?"right":"left"}var l=xn(i.map,t.ch,a);l.offset=l.collapse=="right"?l.end:l.start;return l}function nl(e){for(var t=e;t;t=t.parentNode)if(/CodeMirror-gutter-wrapper/.test(t.className))return true;return false}function il(e,t){if(t)e.bad=true;return e}function ol(s,e,t,l,u){var r="",c=false,h=s.doc.lineSeparator(),f=false;function d(t){return function(e){return e.id==t}}function p(){if(c){r+=h;if(f)r+=h;c=f=false}}function m(e){if(e){p();r+=e}}function g(e){if(e.nodeType==1){var t=e.getAttribute("cm-text");if(t){m(t);return}var r=e.getAttribute("cm-marker"),n;if(r){var i=s.findMarks(P(l,0),P(u+1,0),d(+r));if(i.length&&(n=i[0].find(0)))m(yt(s.doc,n.from,n.to).join(h));return}if(e.getAttribute("contenteditable")=="false")return;var o=/^(pre|div|p|li|table|br)$/i.test(e.nodeName);if(!/^br$/i.test(e.nodeName)&&e.textContent.length==0)return;if(o)p();for(var a=0;a<e.childNodes.length;a++)g(e.childNodes[a]);if(/^(pre|p)$/i.test(e.nodeName))f=true;if(o)c=true}else if(e.nodeType==3)m(e.nodeValue.replace(/\u200b/g,"").replace(/\u00a0/g," "))}for(;;){g(e);if(e==t)break;e=e.nextSibling;f=false}return r}function al(e,t,r){var n;if(t==e.display.lineDiv){n=e.display.lineDiv.childNodes[r];if(!n)return il(e.clipPos(P(e.display.viewTo-1)),true);t=null;r=0}else for(n=t;;n=n.parentNode){if(!n||n==e.display.lineDiv)return null;if(n.parentNode&&n.parentNode==e.display.lineDiv)break}for(var i=0;i<e.display.view.length;i++){var o=e.display.view[i];if(o.node==n)return sl(o,t,r)}}function sl(u,e,t){var r=u.text.firstChild,n=false;if(!e||!se(r,e))return il(P(E(u.line),0),true);if(e==r){n=true;e=r.childNodes[t];t=0;if(!e){var i=u.rest?Z(u.rest):u.line;return il(P(E(i),i.text.length),n)}}var o=e.nodeType==3?e:null,a=e;if(!o&&e.childNodes.length==1&&e.firstChild.nodeType==3){o=e.firstChild;if(t)t=o.nodeValue.length}while(a.parentNode!=r)a=a.parentNode;var c=u.measure,h=c.maps;function s(e,t,r){for(var n=-1;n<(h?h.length:0);n++){var i=n<0?c.map:h[n];for(var o=0;o<i.length;o+=3){var a=i[o+2];if(a==e||a==t){var s=E(n<0?u.line:u.rest[n]);var l=i[o]+r;if(r<0||a!=e)l=i[o+(r?1:0)];return P(s,l)}}}}var l=s(o,a,t);if(l)return il(l,n);for(var f=a.nextSibling,d=o?o.nodeValue.length-t:0;f;f=f.nextSibling){l=s(f,f.firstChild,0);if(l)return il(P(l.line,l.ch-d),n);else d+=f.textContent.length}for(var p=a.previousSibling,m=t;p;p=p.previousSibling){l=s(p,p.firstChild,-1);if(l)return il(P(l.line,l.ch+m),n);else m+=p.textContent.length}}n.prototype.init=function(e){var t=this;var a=this,s=a.cm;var l=a.div=e.lineDiv;l.contentEditable=true;Js(l,s.options.spellcheck,s.options.autocorrect,s.options.autocapitalize);function u(e){for(var t=e.target;t;t=t.parentNode){if(t==l)return true;if(/\bCodeMirror-(?:line)?widget\b/.test(t.className))break}return false}M(l,"paste",function(e){if(!u(e)||d(s,e)||$s(e,s))return;if(b<=11)setTimeout(O(s,function(){return t.updateFromDOM()}),20)});M(l,"compositionstart",function(e){t.composing={data:e.data,done:false}});M(l,"compositionupdate",function(e){if(!t.composing)t.composing={data:e.data,done:false}});M(l,"compositionend",function(e){if(t.composing){if(e.data!=t.composing.data)t.readFromDOMSoon();t.composing.done=true}});M(l,"touchstart",function(){return a.forceCompositionEnd()});M(l,"input",function(){if(!t.composing)t.readFromDOMSoon()});function r(e){if(!u(e)||d(s,e))return;if(s.somethingSelected()){qs({lineWise:false,text:s.getSelections()});if(e.type=="cut")s.replaceSelection("",null,"cut")}else if(!s.options.lineWiseCopyCut)return;else{var t=Ys(s);qs({lineWise:true,text:t.text});if(e.type=="cut")s.operation(function(){s.setSelections(t.ranges,0,ve);s.replaceSelection("",null,"cut")})}if(e.clipboardData){e.clipboardData.clearData();var r=Zs.text.join("\n");e.clipboardData.setData("Text",r);if(e.clipboardData.getData("Text")==r){e.preventDefault();return}}var n=Ks(),i=n.firstChild;s.display.lineSpace.insertBefore(n,s.display.lineSpace.firstChild);i.value=Zs.text.join("\n");var o=h(l.ownerDocument);ce(i);setTimeout(function(){s.display.lineSpace.removeChild(n);o.focus();if(o==l)a.showPrimarySelection()},50)}M(l,"copy",r);M(l,"cut",r)},n.prototype.screenReaderLabelChanged=function(e){if(e)this.div.setAttribute("aria-label",e);else this.div.removeAttribute("aria-label")},n.prototype.prepareSelection=function(){var e=ni(this.cm,false);e.focus=h(this.div.ownerDocument)==this.div;return e},n.prototype.showSelection=function(e,t){if(!e||!this.cm.display.view.length)return;if(e.focus||t)this.showPrimarySelection();this.showMultipleSelections(e)},n.prototype.getSelection=function(){return this.cm.display.wrapper.ownerDocument.getSelection()},n.prototype.showPrimarySelection=function(){var e=this.getSelection(),t=this.cm,r=t.doc.sel.primary();var n=r.from(),i=r.to();if(t.display.viewTo==t.display.viewFrom||n.line>=t.display.viewTo||i.line<t.display.viewFrom){e.removeAllRanges();return}var o=al(t,e.anchorNode,e.anchorOffset);var a=al(t,e.focusNode,e.focusOffset);if(o&&!o.bad&&a&&!a.bad&&A(Mt(o,a),n)==0&&A(St(o,a),i)==0)return;var s=t.display.view;var l=n.line>=t.display.viewFrom&&rl(t,n)||{node:s[0].measure.map[2],offset:0};var u=i.line<t.display.viewTo&&rl(t,i);if(!u){var c=s[s.length-1].measure;var h=c.maps?c.maps[c.maps.length-1]:c.map;u={node:h[h.length-1],offset:h[h.length-2]-h[h.length-3]}}if(!l||!u){e.removeAllRanges();return}var f=e.rangeCount&&e.getRangeAt(0),d;try{d=ie(l.node,l.offset,u.offset,u.node)}catch(e){}if(d){if(!B&&t.state.focused){e.collapse(l.node,l.offset);if(!d.collapsed){e.removeAllRanges();e.addRange(d)}}else{e.removeAllRanges();e.addRange(d)}if(f&&e.anchorNode==null)e.addRange(f);else if(B)this.startGracePeriod()}this.rememberSelection()},n.prototype.startGracePeriod=function(){var e=this;clearTimeout(this.gracePeriod);this.gracePeriod=setTimeout(function(){e.gracePeriod=false;if(e.selectionChanged())e.cm.operation(function(){return e.cm.curOp.selectionChanged=true})},20)},n.prototype.showMultipleSelections=function(e){o(this.cm.display.cursorDiv,e.cursors);o(this.cm.display.selectionDiv,e.selection)},n.prototype.rememberSelection=function(){var e=this.getSelection();this.lastAnchorNode=e.anchorNode;this.lastAnchorOffset=e.anchorOffset;this.lastFocusNode=e.focusNode;this.lastFocusOffset=e.focusOffset},n.prototype.selectionInEditor=function(){var e=this.getSelection();if(!e.rangeCount)return false;var t=e.getRangeAt(0).commonAncestorContainer;return se(this.div,t)},n.prototype.focus=function(){if(this.cm.options.readOnly!="nocursor"){if(!this.selectionInEditor()||h(this.div.ownerDocument)!=this.div)this.showSelection(this.prepareSelection(),true);this.div.focus()}},n.prototype.blur=function(){this.div.blur()},n.prototype.getField=function(){return this.div},n.prototype.supportsTouch=function(){return true},n.prototype.receivedFocus=function(){var e=this;var t=this;if(this.selectionInEditor())setTimeout(function(){return e.pollSelection()},20);else D(this.cm,function(){return t.cm.curOp.selectionChanged=true});function r(){if(t.cm.state.focused){t.pollSelection();t.polling.set(t.cm.options.pollInterval,r)}}this.polling.set(this.cm.options.pollInterval,r)},n.prototype.selectionChanged=function(){var e=this.getSelection();return e.anchorNode!=this.lastAnchorNode||e.anchorOffset!=this.lastAnchorOffset||e.focusNode!=this.lastFocusNode||e.focusOffset!=this.lastFocusOffset},n.prototype.pollSelection=function(){if(this.readDOMTimeout!=null||this.gracePeriod||!this.selectionChanged())return;var e=this.getSelection(),t=this.cm;if(X&&U&&this.cm.display.gutterSpecs.length&&nl(e.anchorNode)){this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs});this.blur();this.focus();return}if(this.composing)return;this.rememberSelection();var r=al(t,e.anchorNode,e.anchorOffset);var n=al(t,e.focusNode,e.focusOffset);if(r&&n)D(t,function(){F(t.doc,mo(r,n),ve);if(r.bad||n.bad)t.curOp.selectionChanged=true})},n.prototype.pollContent=function(){if(this.readDOMTimeout!=null){clearTimeout(this.readDOMTimeout);this.readDOMTimeout=null}var e=this.cm,t=e.display,r=e.doc.sel.primary();var n=r.from(),i=r.to();if(n.ch==0&&n.line>e.firstLine())n=P(n.line-1,L(e.doc,n.line-1).length);if(i.ch==L(e.doc,i.line).text.length&&i.line<e.lastLine())i=P(i.line+1,0);if(n.line<t.viewFrom||i.line>t.viewTo-1)return false;var o,a,s;if(n.line==t.viewFrom||(o=Yn(e,n.line))==0){a=E(t.view[0].line);s=t.view[0].node}else{a=E(t.view[o].line);s=t.view[o-1].node.nextSibling}var l=Yn(e,i.line);var u,c;if(l==t.view.length-1){u=t.viewTo-1;c=t.lineDiv.lastChild}else{u=E(t.view[l+1].line)-1;c=t.view[l+1].node.previousSibling}if(!s)return false;var h=e.doc.splitLines(ol(e,s,c,a,u));var f=yt(e.doc,P(a,0),P(u,L(e.doc,u).text.length));while(h.length>1&&f.length>1)if(Z(h)==Z(f)){h.pop();f.pop();u--}else if(h[0]==f[0]){h.shift();f.shift();a++}else break;var d=0,p=0;var m=h[0],g=f[0],y=Math.min(m.length,g.length);while(d<y&&m.charCodeAt(d)==g.charCodeAt(d))++d;var v=Z(h),_=Z(f);var x=Math.min(v.length-(h.length==1?d:0),_.length-(f.length==1?d:0));while(p<x&&v.charCodeAt(v.length-p-1)==_.charCodeAt(_.length-p-1))++p;if(h.length==1&&f.length==1&&a==n.line)while(d&&d>n.ch&&v.charCodeAt(v.length-p-1)==_.charCodeAt(_.length-p-1)){d--;p++}h[h.length-1]=v.slice(0,v.length-p).replace(/^\u200b+/,"");h[0]=h[0].slice(d).replace(/\u200b+$/,"");var b=P(a,d);var w=P(u,f.length?Z(f).length-p:0);if(h.length>1||h[0]||A(b,w)){ca(e.doc,h,b,w,"+input");return true}},n.prototype.ensurePolled=function(){this.forceCompositionEnd()},n.prototype.reset=function(){this.forceCompositionEnd()},n.prototype.forceCompositionEnd=function(){if(!this.composing)return;clearTimeout(this.readDOMTimeout);this.composing=null;this.updateFromDOM();this.div.blur();this.div.focus()},n.prototype.readFromDOMSoon=function(){var e=this;if(this.readDOMTimeout!=null)return;this.readDOMTimeout=setTimeout(function(){e.readDOMTimeout=null;if(e.composing)if(e.composing.done)e.composing=null;else return;e.updateFromDOM()},80)},n.prototype.updateFromDOM=function(){var e=this;if(this.cm.isReadOnly()||!this.pollContent())D(this.cm,function(){return z(e.cm)})},n.prototype.setUneditable=function(e){e.contentEditable="false"},n.prototype.onKeyPress=function(e){if(e.charCode==0||this.composing)return;e.preventDefault();if(!this.cm.isReadOnly())O(this.cm,Hs)(this.cm,String.fromCharCode(e.charCode==null?e.keyCode:e.charCode),0)},n.prototype.readOnlyChanged=function(e){this.div.contentEditable=String(e!="nocursor")},n.prototype.onContextMenu=function(){},n.prototype.resetPosition=function(){},n.prototype.needsContentAttribute=true;var i=function(e){this.cm=e;this.prevInput="";this.pollingFast=false;this.polling=new me;this.hasSelection=false;this.composing=null;this.resetting=false};function ll(t,r){r=r?pe(r):{};r.value=t.value;if(!r.tabindex&&t.tabIndex)r.tabindex=t.tabIndex;if(!r.placeholder&&t.placeholder)r.placeholder=t.placeholder;if(r.autofocus==null){var e=h(t.ownerDocument);r.autofocus=e==t||t.getAttribute("autofocus")!=null&&e==document.body}function n(){t.value=s.getValue()}var i;if(t.form){M(t.form,"submit",n);if(!r.leaveSubmitMethodAlone){var o=t.form;i=o.submit;try{var a=o.submit=function(){n();o.submit=i;o.submit();o.submit=a}}catch(e){}}}r.finishInit=function(e){e.save=n;e.getTextArea=function(){return t};e.toTextArea=function(){e.toTextArea=isNaN;n();t.parentNode.removeChild(e.getWrapperElement());t.style.display="";if(t.form){k(t.form,"submit",n);if(!r.leaveSubmitMethodAlone&&typeof t.form.submit=="function")t.form.submit=i}}};t.style.display="none";var s=u(function(e){return t.parentNode.insertBefore(e,t.nextSibling)},r);return s}function ul(e){e.off=k;e.on=M;e.wheelEventPixels=ho;e.Doc=l;e.splitLines=tt;e.countColumn=S;e.findColumn=be;e.isWordChar=Ae;e.Pass=ye;e.signal=p;e.Line=Er;e.changeEnd=go;e.scrollbarModel=zi;e.Pos=P;e.cmpPos=A;e.modes=at;e.mimeModes=st;e.resolveMode=ct;e.getMode=ht;e.modeExtensions=ft;e.extendMode=dt;e.copyState=pt;e.startState=gt;e.innerMode=mt;e.commands=rs;e.keyMap=Ga;e.keyName=Xa;e.isModifierKey=Ha;e.lookupKey=qa;e.normalizeKeyMap=Za;e.StringStream=_;e.SharedTextMarker=Ea;e.TextMarker=ba;e.LineWidget=ya;e.e_preventDefault=C;e.e_stopPropagation=Ze;e.e_stop=He;e.addClass=le;e.contains=se;e.rmClass=ne;e.keyNames=Na}i.prototype.init=function(r){var e=this;var n=this,i=this.cm;this.createField(r);var o=this.textarea;r.wrapper.insertBefore(this.wrapper,r.wrapper.firstChild);if($)o.style.width="0px";M(o,"input",function(){if(T&&b>=9&&e.hasSelection)e.hasSelection=null;n.poll()});M(o,"paste",function(e){if(d(i,e)||$s(e,i))return;i.state.pasteIncoming=+new Date;n.fastPoll()});function t(e){if(d(i,e))return;if(i.somethingSelected())qs({lineWise:false,text:i.getSelections()});else if(!i.options.lineWiseCopyCut)return;else{var t=Ys(i);qs({lineWise:true,text:t.text});if(e.type=="cut")i.setSelections(t.ranges,null,ve);else{n.prevInput="";o.value=t.text.join("\n");ce(o)}}if(e.type=="cut")i.state.cutIncoming=+new Date}M(o,"cut",t);M(o,"copy",t);M(r.scroller,"paste",function(e){if(nn(r,e)||d(i,e))return;if(!o.dispatchEvent){i.state.pasteIncoming=+new Date;n.focus();return}var t=new Event("paste");t.clipboardData=e.clipboardData;o.dispatchEvent(t)});M(r.lineSpace,"selectstart",function(e){if(!nn(r,e))C(e)});M(o,"compositionstart",function(){var e=i.getCursor("from");if(n.composing)n.composing.range.clear();n.composing={start:e,range:i.markText(e,i.getCursor("to"),{className:"CodeMirror-composing"})}});M(o,"compositionend",function(){if(n.composing){n.poll();n.composing.range.clear();n.composing=null}})},i.prototype.createField=function(e){this.wrapper=Ks();this.textarea=this.wrapper.firstChild},i.prototype.screenReaderLabelChanged=function(e){if(e)this.textarea.setAttribute("aria-label",e);else this.textarea.removeAttribute("aria-label")},i.prototype.prepareSelection=function(){var e=this.cm,t=e.display,r=e.doc;var n=ni(e);if(e.options.moveInputWithCursor){var i=zn(e,r.sel.primary().head,"div");var o=t.wrapper.getBoundingClientRect(),a=t.lineDiv.getBoundingClientRect();n.teTop=Math.max(0,Math.min(t.wrapper.clientHeight-10,i.top+a.top-o.top));n.teLeft=Math.max(0,Math.min(t.wrapper.clientWidth-10,i.left+a.left-o.left))}return n},i.prototype.showSelection=function(e){var t=this.cm,r=t.display;o(r.cursorDiv,e.cursors);o(r.selectionDiv,e.selection);if(e.teTop!=null){this.wrapper.style.top=e.teTop+"px";this.wrapper.style.left=e.teLeft+"px"}},i.prototype.reset=function(e){if(this.contextMenuPending||this.composing&&e)return;var t=this.cm;this.resetting=true;if(t.somethingSelected()){this.prevInput="";var r=t.getSelection();this.textarea.value=r;if(t.state.focused)ce(this.textarea);if(T&&b>=9)this.hasSelection=r}else if(!e){this.prevInput=this.textarea.value="";if(T&&b>=9)this.hasSelection=null}this.resetting=false},i.prototype.getField=function(){return this.textarea},i.prototype.supportsTouch=function(){return false},i.prototype.focus=function(){if(this.cm.options.readOnly!="nocursor"&&(!Y||h(this.textarea.ownerDocument)!=this.textarea))try{this.textarea.focus()}catch(e){}},i.prototype.blur=function(){this.textarea.blur()},i.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},i.prototype.receivedFocus=function(){this.slowPoll()},i.prototype.slowPoll=function(){var e=this;if(this.pollingFast)return;this.polling.set(this.cm.options.pollInterval,function(){e.poll();if(e.cm.state.focused)e.slowPoll()})},i.prototype.fastPoll=function(){var t=false,r=this;r.pollingFast=true;function n(){var e=r.poll();if(!e&&!t){t=true;r.polling.set(60,n)}else{r.pollingFast=false;r.slowPoll()}}r.polling.set(20,n)},i.prototype.poll=function(){var e=this;var t=this.cm,r=this.textarea,n=this.prevInput;if(this.contextMenuPending||this.resetting||!t.state.focused||rt(r)&&!n&&!this.composing||t.isReadOnly()||t.options.disableInput||t.state.keySeq)return false;var i=r.value;if(i==n&&!t.somethingSelected())return false;if(T&&b>=9&&this.hasSelection===i||y&&/[\uf700-\uf7ff]/.test(i)){t.display.input.reset();return false}if(t.doc.sel==t.display.selForContextMenu){var o=i.charCodeAt(0);if(o==8203&&!n)n="​";if(o==8666){this.reset();return this.cm.execCommand("undo")}}var a=0,s=Math.min(n.length,i.length);while(a<s&&n.charCodeAt(a)==i.charCodeAt(a))++a;D(t,function(){Hs(t,i.slice(a),n.length-a,null,e.composing?"*compose":null);if(i.length>1e3||i.indexOf("\n")>-1)r.value=e.prevInput="";else e.prevInput=i;if(e.composing){e.composing.range.clear();e.composing.range=t.markText(e.composing.start,t.getCursor("to"),{className:"CodeMirror-composing"})}});return true},i.prototype.ensurePolled=function(){if(this.pollingFast&&this.poll())this.pollingFast=false},i.prototype.onKeyPress=function(){if(T&&b>=9)this.hasSelection=null;this.fastPoll()},i.prototype.onContextMenu=function(e){var r=this,n=r.cm,i=n.display,o=r.textarea;if(r.contextMenuPending)r.contextMenuPending();var t=Xn(n,e),a=i.scroller.scrollTop;if(!t||G)return;var s=n.options.resetSelectionOnContextMenu;if(s&&n.doc.sel.contains(t)==-1)O(n,F)(n.doc,mo(t),ve);var l=o.style.cssText,u=r.wrapper.style.cssText;var c=r.wrapper.offsetParent.getBoundingClientRect();r.wrapper.style.cssText="position: static";o.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(e.clientY-c.top-5)+"px; left: "+(e.clientX-c.left-5)+"px;\n      z-index: 1000; background: "+(T?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";var h;if(g)h=o.ownerDocument.defaultView.scrollY;i.input.focus();if(g)o.ownerDocument.defaultView.scrollTo(null,h);i.input.reset();if(!n.somethingSelected())o.value=r.prevInput=" ";r.contextMenuPending=d;i.selForContextMenu=n.doc.sel;clearTimeout(i.detectingSelectAll);function f(){if(o.selectionStart!=null){var e=n.somethingSelected();var t="​"+(e?o.value:"");o.value="⇚";o.value=t;r.prevInput=e?"":"​";o.selectionStart=1;o.selectionEnd=t.length;i.selForContextMenu=n.doc.sel}}function d(){if(r.contextMenuPending!=d)return;r.contextMenuPending=false;r.wrapper.style.cssText=u;o.style.cssText=l;if(T&&b<9)i.scrollbars.setScrollTop(i.scroller.scrollTop=a);if(o.selectionStart!=null){if(!T||T&&b<9)f();var e=0,t=function(){if(i.selForContextMenu==n.doc.sel&&o.selectionStart==0&&o.selectionEnd>0&&r.prevInput=="​")O(n,ra)(n);else if(e++<10)i.detectingSelectAll=setTimeout(t,500);else{i.selForContextMenu=null;i.input.reset()}};i.detectingSelectAll=setTimeout(t,200)}}if(T&&b>=9)f();if(te){He(e);var p=function(){k(window,"mouseup",p);setTimeout(d,20)};M(window,"mouseup",p)}else setTimeout(d,50)},i.prototype.readOnlyChanged=function(e){if(!e)this.reset();this.textarea.disabled=e=="nocursor";this.textarea.readOnly=!!e},i.prototype.setUneditable=function(){},i.prototype.needsContentAttribute=false,Ns(u),Qs(u);var cl="iter insert remove copy getEditor constructor".split(" "),hl;for(hl in l.prototype)if(l.prototype.hasOwnProperty(hl)&&m(cl,hl)<0)u.prototype[hl]=function(e){return function(){return e.apply(this.doc,arguments)}}(l.prototype[hl]);return We(l),u.inputStyles={textarea:i,contenteditable:n},u.defineMode=function(e){if(!u.defaults.mode&&e!="null")u.defaults.mode=e;lt.apply(this,arguments)},u.defineMIME=ut,u.defineMode("null",function(){return{token:function(e){return e.skipToEnd()}}}),u.defineMIME("text/plain","null"),u.defineExtension=function(e,t){u.prototype[e]=t},u.defineDocExtension=function(e,t){l.prototype[e]=t},u.fromTextArea=ll,ul(u),u.version="5.65.9",u}();var _,$t,Xt,Yt,Jt,Kt,Qt,er,tr,rr;function nr(i,o,e,a){e&&e.call?(s=e,e=null):s=ir(i,e,"rangeFinder"),"number"==typeof o&&(o=_.Pos(o,0));var s,l=ir(i,e,"minFoldSize");function t(e){var t=s(i,o);if(!t||t.to.line-t.from.line<l)return null;if("fold"!==a)for(var r=i.findMarksAt(t.from),n=0;n<r.length;++n)if(r[n].__isFold){if(!e)return null;t.cleared=!0,r[n].clear()}return t}var r,n,u=t(!0);if(ir(i,e,"scanUp"))for(;!u&&o.line>i.firstLine();)o=_.Pos(o.line-1,0),u=t(!1);u&&!u.cleared&&"unfold"!==a&&(r=function(e,t,r){e=ir(e,t,"widget");"function"==typeof e&&(e=e(r.from,r.to));"string"==typeof e?(t=document.createTextNode(e),(e=document.createElement("span")).appendChild(t),e.className="CodeMirror-foldmarker"):e=e&&e.cloneNode(!0);return e}(i,e,u),_.on(r,"mousedown",function(e){n.clear(),_.e_preventDefault(e)}),(n=i.markText(u.from,u.to,{replacedWith:r,clearOnEnter:ir(i,e,"clearOnEnter"),__isFold:!0})).on("clear",function(e,t){_.signal(i,"unfold",i,e,t)}),_.signal(i,"fold",i,u.from,u.to))}function ir(e,t,r){return(t&&void 0!==t[r]||(t=e.options.foldOptions)&&void 0!==t[r]?t:$t)[r]}function or(e){this.options=e,this.from=this.to=0}function ar(e,t){for(var r=e.findMarks(Yt(t,0),Yt(t+1,0)),n=0;n<r.length;++n)if(r[n].__isFold){var i=r[n].find(-1);if(i&&i.line===t)return r[n]}}function sr(e){var t;return"string"==typeof e?((t=document.createElement("div")).className=e+" CodeMirror-guttermarker-subtle",t):e.cloneNode(!0)}function lr(i,e,t){var o=i.state.foldGutter.options,a=e-1,s=i.foldOption(o,"minFoldSize"),l=i.foldOption(o,"rangeFinder"),u="string"==typeof o.indicatorFolded&&ur(o.indicatorFolded),c="string"==typeof o.indicatorOpen&&ur(o.indicatorOpen);i.eachLine(e,t,function(e){++a;var t=null,r=(r=e.gutterMarkers)&&r[o.gutter];if(ar(i,a)){if(u&&r&&u.test(r.className))return;t=sr(o.indicatorFolded)}else{var n=Yt(a,0),n=l&&l(i,n);if(n&&n.to.line-n.from.line>=s){if(c&&r&&c.test(r.className))return;t=sr(o.indicatorOpen)}}(t||r)&&i.setGutterMarker(e,o.gutter,t)})}function ur(e){return new RegExp("(^|\\s)"+e+"(?:$|\\s)\\s*")}function cr(e){var t=e.getViewport(),r=e.state.foldGutter;r&&(e.operation(function(){lr(e,t.from,t.to)}),r.from=t.from,r.to=t.to)}function hr(e,t,r){var n=e.state.foldGutter;!n||r==(r=n.options).gutter&&((n=ar(e,t))?n.clear():e.foldCode(Yt(t,0),r))}function fr(e,t){"mode"==t&&dr(e)}function dr(e){var t,r=e.state.foldGutter;r&&(t=r.options,r.from=r.to=0,clearTimeout(r.changeUpdate),r.changeUpdate=setTimeout(function(){cr(e)},t.foldOnChangeTimeSpan||600))}function pr(t){var e,r=t.state.foldGutter;r&&(e=r.options,clearTimeout(r.changeUpdate),r.changeUpdate=setTimeout(function(){var e=t.getViewport();r.from==r.to||20<e.from-r.to||20<r.from-e.to?cr(t):t.operation(function(){e.from<r.from&&(lr(t,e.from,r.from),r.from=e.from),e.to>r.to&&(lr(t,r.to,e.to),r.to=e.to)})},e.updateViewportTimeSpan||400))}function mr(e,t){var r=e.state.foldGutter;!r||(t=t.line)>=r.from&&t<r.to&&lr(e,t,t+1)}function gr(i){return function(h,o){var f=o.line,a=h.getLine(f);for(var e=[],t=0;t<i.length;t++){var r=function(e){for(var t,r=o.ch,n=0;;){var i=r<=0?-1:a.lastIndexOf(e[0],r-1);if(-1==i){if(1==n)break;n=1,r=a.length}else{if(1==n&&i<o.ch)break;if(t=h.getTokenTypeAt(Jt.Pos(f,i+1)),!/^(comment|string)/.test(t))return{ch:i+1,tokenType:t,pair:e};r=i-1}}}(i[t]);r&&e.push(r)}e.sort(function(e,t){return e.ch-t.ch});for(t=0;t<e.length;t++){var n=function(e){var t,r,n=1,i=h.lastLine(),o=e.ch;e:for(var a=f;a<=i;++a)for(var s=h.getLine(a),l=a==f?o:0;;){var u=s.indexOf(e.pair[0],l),c=s.indexOf(e.pair[1],l);if(u<0&&(u=s.length),c<0&&(c=s.length),(l=Math.min(u,c))==s.length)break;if(h.getTokenTypeAt(Jt.Pos(a,l+1))==e.tokenType)if(l==u)++n;else if(!--n){t=a,r=l;break e}++l}return null==t||f==t?null:{from:Jt.Pos(f,o),to:Jt.Pos(t,r)}}(e[t]);if(n)return n}return null}}function yr(e){return e&&e.bracketRegex||/[(){}[\]]/}function vr(e,t,r){var n=e.getLineHandle(t.line),i=t.ch-1,o=r&&r.afterCursor,a=(null==o&&(o=/(^| )cm-fat-cursor($| )/.test(e.getWrapperElement().className)),yr(r)),o=!o&&0<=i&&a.test(n.text.charAt(i))&&tr[n.text.charAt(i)]||a.test(n.text.charAt(i+1))&&tr[n.text.charAt(++i)];return!o||(a=">"==o.charAt(1)?1:-1,r&&r.strict&&0<a!=(i==t.ch)||(n=e.getTokenTypeAt(er(t.line,i+1)),null==(e=_r(e,er(t.line,i+(0<a?1:0)),a,n,r))))?null:{from:er(t.line,i),to:e&&e.pos,match:e&&e.ch==o.charAt(0),forward:0<a}}function _r(e,t,r,n,i){for(var o=i&&i.maxScanLineLength||1e4,a=i&&i.maxScanLines||1e3,s=[],l=yr(i),u=0<r?Math.min(t.line+a,e.lastLine()+1):Math.max(e.firstLine()-1,t.line-a),c=t.line;c!=u;c+=r){var h=e.getLine(c);if(h){var f=0<r?0:h.length-1,d=0<r?h.length:-1;if(!(h.length>o))for(c==t.line&&(f=t.ch-(r<0?1:0));f!=d;f+=r){var p=h.charAt(f);if(l.test(p)&&(void 0===n||(e.getTokenTypeAt(er(c,f+1))||"")==(n||""))){var m=tr[p];if(m&&">"==m.charAt(1)==0<r)s.push(p);else{if(!s.length)return{pos:er(c,f),ch:p};s.pop()}}}}}return c-r!=(0<r?e.lastLine():e.firstLine())&&null}function xr(e,t,r){for(var n=e.state.matchBrackets.maxHighlightLineLength||1e3,i=r&&r.highlightNonMatching,o=[],a=e.listSelections(),s=0;s<a.length;s++){var l,u=a[s].empty()&&vr(e,a[s].head,r);u&&(u.match||!1!==i)&&e.getLine(u.from.line).length<=n&&(l=u.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket",o.push(e.markText(u.from,er(u.from.line,u.from.ch+1),{className:l})),u.to&&e.getLine(u.to.line).length<=n&&o.push(e.markText(u.to,er(u.to.line,u.to.ch+1),{className:l})))}if(o.length){Qt&&e.state.focused&&e.focus();function c(){e.operation(function(){for(var e=0;e<o.length;e++)o[e].clear()})}if(!t)return c;setTimeout(c,800)}}function br(e){e.operation(function(){e.state.matchBrackets.currentlyHighlighted&&(e.state.matchBrackets.currentlyHighlighted(),e.state.matchBrackets.currentlyHighlighted=null),e.state.matchBrackets.currentlyHighlighted=xr(e,!1,e.state.matchBrackets)})}function wr(e){e.state.matchBrackets&&e.state.matchBrackets.currentlyHighlighted&&(e.state.matchBrackets.currentlyHighlighted(),e.state.matchBrackets.currentlyHighlighted=null)}(_=o.exports).newFoldFunction=function(r,n){return function(e,t){nr(e,t,{rangeFinder:r,widget:n})}},_.defineExtension("foldCode",function(e,t,r){nr(this,e,t,r)}),_.defineExtension("isFolded",function(e){for(var t=this.findMarksAt(e),r=0;r<t.length;++r)if(t[r].__isFold)return!0}),_.commands.toggleFold=function(e){e.foldCode(e.getCursor())},_.commands.fold=function(e){e.foldCode(e.getCursor(),null,"fold")},_.commands.unfold=function(e){e.foldCode(e.getCursor(),{scanUp:!1},"unfold")},_.commands.foldAll=function(r){r.operation(function(){for(var e=r.firstLine(),t=r.lastLine();e<=t;e++)r.foldCode(_.Pos(e,0),{scanUp:!1},"fold")})},_.commands.unfoldAll=function(r){r.operation(function(){for(var e=r.firstLine(),t=r.lastLine();e<=t;e++)r.foldCode(_.Pos(e,0),{scanUp:!1},"unfold")})},_.registerHelper("fold","combine",function(){var i=Array.prototype.slice.call(arguments,0);return function(e,t){for(var r=0;r<i.length;++r){var n=i[r](e,t);if(n)return n}}}),_.registerHelper("fold","auto",function(e,t){for(var r=e.getHelpers(t,"fold"),n=0;n<r.length;n++){var i=r[n](e,t);if(i)return i}}),$t={rangeFinder:_.fold.auto,widget:"↔",minFoldSize:0,scanUp:!1,clearOnEnter:!0},_.defineOption("foldOptions",null),_.defineExtension("foldOption",function(e,t){return ir(this,e,t)}),(Xt=o.exports).defineOption("foldGutter",!1,function(e,t,r){r&&r!=Xt.Init&&(e.clearGutter(e.state.foldGutter.options.gutter),e.state.foldGutter=null,e.off("gutterClick",hr),e.off("changes",dr),e.off("viewportChange",pr),e.off("fold",mr),e.off("unfold",mr),e.off("swapDoc",dr),e.off("optionChange",fr)),t&&(e.state.foldGutter=new or(function(e){!0===e&&(e={});null==e.gutter&&(e.gutter="CodeMirror-foldgutter");null==e.indicatorOpen&&(e.indicatorOpen="CodeMirror-foldgutter-open");null==e.indicatorFolded&&(e.indicatorFolded="CodeMirror-foldgutter-folded");return e}(t)),cr(e),e.on("gutterClick",hr),e.on("changes",dr),e.on("viewportChange",pr),e.on("fold",mr),e.on("unfold",mr),e.on("swapDoc",dr),e.on("optionChange",fr))}),Yt=Xt.Pos,(Jt=o.exports).registerHelper("fold","brace",gr([["{","}"],["[","]"]])),Jt.registerHelper("fold","brace-paren",gr([["{","}"],["[","]"],["(",")"]])),Jt.registerHelper("fold","import",function(o,e){function t(e){if(e<o.firstLine()||e>o.lastLine())return null;var t=o.getTokenAt(Jt.Pos(e,1));if("keyword"!=(t=/\S/.test(t.string)?t:o.getTokenAt(Jt.Pos(e,t.end+1))).type||"import"!=t.string)return null;for(var r=e,n=Math.min(o.lastLine(),e+10);r<=n;++r){var i=o.getLine(r).indexOf(";");if(-1!=i)return{startCh:t.end,end:Jt.Pos(r,i)}}}var r,e=e.line,n=t(e);if(!n||t(e-1)||(r=t(e-2))&&r.end.line==e-1)return null;for(var i=n.end;;){var a=t(i.line+1);if(null==a)break;i=a.end}return{from:o.clipPos(Jt.Pos(e,n.startCh+1)),to:i}}),Jt.registerHelper("fold","include",function(r,e){function t(e){var t;return e<r.firstLine()||e>r.lastLine()?null:(t=r.getTokenAt(Jt.Pos(e,1)),"meta"==(t=/\S/.test(t.string)?t:r.getTokenAt(Jt.Pos(e,t.end+1))).type&&"#include"==t.string.slice(0,8)?t.start+8:void 0)}var e=e.line,n=t(e);if(null==n||null!=t(e-1))return null;for(var i=e;;){if(null==t(i+1))break;++i}return{from:Jt.Pos(e,n+1),to:r.clipPos(Jt.Pos(i))}}),Kt=o.exports,Qt=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||document.documentMode<8),er=Kt.Pos,tr={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<","<":">>",">":"<<"},Kt.defineOption("matchBrackets",!1,function(e,t,r){r&&r!=Kt.Init&&(e.off("cursorActivity",br),e.off("focus",br),e.off("blur",wr),wr(e)),t&&(e.state.matchBrackets="object"==typeof t?t:{},e.on("cursorActivity",br),e.on("focus",br),e.on("blur",wr))}),Kt.defineExtension("matchBrackets",function(){xr(this,!0)}),Kt.defineExtension("findMatchingBracket",function(e,t,r){return vr(this,e,t=!r&&"boolean"!=typeof t?t:r?(r.strict=t,r):t?{strict:!0}:null)}),Kt.defineExtension("scanForBracket",function(e,t,r,n){return _r(this,e,t,r,n)}),(rr=o.exports).defineMode("javascript",function(e,c){var t,r,R,F,h=e.indentUnit,B=c.statementIndent,N=c.jsonld,a=c.json||N,j=!1!==c.trackScope,u=c.typescript,U=c.wordCharacters||/[\w$\xa1-\uffff]/,V=(e=n("keyword a"),t=n("keyword b"),r=n("keyword c"),R=n("keyword d"),F=n("operator"),{if:n("if"),while:e,with:e,else:t,do:t,try:t,finally:t,return:R,break:R,continue:R,new:n("new"),delete:r,void:r,throw:r,debugger:n("debugger"),var:n("var"),const:n("var"),let:n("var"),function:n("function"),catch:n("catch"),for:n("for"),switch:n("switch"),case:n("case"),default:n("default"),in:F,typeof:F,instanceof:F,true:e={type:"atom",style:"atom"},false:e,null:e,undefined:e,NaN:e,Infinity:e,this:n("this"),class:n("class"),super:n("atom"),yield:r,export:n("export"),import:n("import"),extends:r,await:r});function n(e){return{type:e,style:"keyword"}}var G,W,Z=/[+\-*&%=<>!?|~^@]/,q=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/;function o(e,t,r){return G=e,W=r,t}function f(e,t){var i,r=e.next();if('"'==r||"'"==r)return t.tokenize=(i=r,function(e,t){var r,n=!1;if(N&&"@"==e.peek()&&e.match(q))return t.tokenize=f,o("jsonld-keyword","meta");for(;null!=(r=e.next())&&(r!=i||n);)n=!n&&"\\"==r;return n||(t.tokenize=f),o("string","string")}),t.tokenize(e,t);if("."==r&&e.match(/^\d[\d_]*(?:[eE][+\-]?[\d_]+)?/))return o("number","number");if("."==r&&e.match(".."))return o("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(r))return o(r);if("="==r&&e.eat(">"))return o("=>","operator");if("0"==r&&e.match(/^(?:x[\dA-Fa-f_]+|o[0-7_]+|b[01_]+)n?/))return o("number","number");if(/\d/.test(r))return e.match(/^[\d_]*(?:n|(?:\.[\d_]*)?(?:[eE][+\-]?[\d_]+)?)?/),o("number","number");if("/"==r)return e.eat("*")?(t.tokenize=H)(e,t):e.eat("/")?(e.skipToEnd(),o("comment","comment")):tt(e,t,1)?(function(e){for(var t,r=!1,n=!1;null!=(t=e.next());){if(!r){if("/"==t&&!n)return;"["==t?n=!0:n&&"]"==t&&(n=!1)}r=!r&&"\\"==t}}(e),e.match(/^\b(([gimyus])(?![gimyus]*\2))+\b/),o("regexp","string-2")):(e.eat("="),o("operator","operator",e.current()));if("`"==r)return(t.tokenize=$)(e,t);if("#"==r&&"!"==e.peek())return e.skipToEnd(),o("meta","meta");if("#"==r&&e.eatWhile(U))return o("variable","property");if("<"==r&&e.match("!--")||"-"==r&&e.match("->")&&!/\S/.test(e.string.slice(0,e.start)))return e.skipToEnd(),o("comment","comment");if(Z.test(r))return">"==r&&t.lexical&&">"==t.lexical.type||(e.eat("=")?"!"!=r&&"="!=r||e.eat("="):/[<>*+\-|&?]/.test(r)&&(e.eat(r),">"==r&&e.eat(r))),"?"==r&&e.eat(".")?o("."):o("operator","operator",e.current());if(U.test(r)){e.eatWhile(U);r=e.current();if("."!=t.lastType){if(V.propertyIsEnumerable(r))return o((t=V[r]).type,t.style,r);if("async"==r&&e.match(/^(\s|\/\*([^*]|\*(?!\/))*?\*\/)*[\[\(\w]/,!1))return o("async","keyword",r)}return o("variable","variable",r)}}function H(e,t){for(var r,n=!1;r=e.next();){if("/"==r&&n){t.tokenize=f;break}n="*"==r}return o("comment","comment")}function $(e,t){for(var r,n=!1;null!=(r=e.next());){if(!n&&("`"==r||"$"==r&&e.eat("{"))){t.tokenize=f;break}n=!n&&"\\"==r}return o("quasi","string-2",e.current())}function X(e,t){t.fatArrowAt&&(t.fatArrowAt=null);var r=e.string.indexOf("=>",e.start);if(!(r<0)){!u||(n=/:\s*(?:\w+(?:<[^>]*>|\[\])?|\{[^}]*\})\s*$/.exec(e.string.slice(e.start,r)))&&(r=n.index);for(var n,i=0,o=!1,a=r-1;0<=a;--a){var s=e.string.charAt(a),l="([{}])".indexOf(s);if(0<=l&&l<3){if(!i){++a;break}if(0==--i){"("==s&&(o=!0);break}}else if(3<=l&&l<6)++i;else if(U.test(s))o=!0;else if(/["'\/`]/.test(s))for(;;--a){if(0==a)return;if(e.string.charAt(a-1)==s&&"\\"!=e.string.charAt(a-2)){a--;break}}else if(o&&!i){++a;break}}o&&!i&&(t.fatArrowAt=a)}}var Y={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,this:!0,import:!0,"jsonld-keyword":!0};function J(e,t,r,n,i,o){this.indented=e,this.column=t,this.type=r,this.prev=i,this.info=o,null!=n&&(this.align=n)}function K(e,t,r,n,i){var o=e.cc;for(s.state=e,s.stream=i,s.marked=null,s.cc=o,s.style=t,e.lexical.hasOwnProperty("align")||(e.lexical.align=!0);;)if((o.length?o.pop():a?x:_)(r,n)){for(;o.length&&o[o.length-1].lex;)o.pop()();return s.marked?s.marked:"variable"==r&&function(e,t){if(j){for(var r=e.localVars;r;r=r.next)if(r.name==t)return 1;for(var n=e.context;n;n=n.prev)for(r=n.vars;r;r=r.next)if(r.name==t)return 1}}(e,n)?"variable-2":t}}var s={state:null,column:null,marked:null,cc:null};function l(){for(var e=arguments.length-1;0<=e;e--)s.cc.push(arguments[e])}function d(){return l.apply(null,arguments),!0}function Q(e,t){for(var r=t;r;r=r.next)if(r.name==e)return 1}function i(e){var t=s.state;if(s.marked="def",j){if(t.context)if("var"==t.lexical.info&&t.context&&t.context.block){var r=function e(t,r){{var n;return r?r.block?(n=e(t,r.prev))?n==r.prev?r:new te(n,r.vars,!0):null:Q(t,r.vars)?r:new te(r.prev,new re(t,r.vars),!1):null}}(e,t.context);if(null!=r)return void(t.context=r)}else if(!Q(e,t.localVars))return void(t.localVars=new re(e,t.localVars));c.globalVars&&!Q(e,t.globalVars)&&(t.globalVars=new re(e,t.globalVars))}}function ee(e){return"public"==e||"private"==e||"protected"==e||"abstract"==e||"readonly"==e}function te(e,t,r){this.prev=e,this.vars=t,this.block=r}function re(e,t){this.name=e,this.next=t}var ne=new re("this",new re("arguments",null));function p(){s.state.context=new te(s.state.context,s.state.localVars,!1),s.state.localVars=ne}function ie(){s.state.context=new te(s.state.context,s.state.localVars,!0),s.state.localVars=null}function m(){s.state.localVars=s.state.context.vars,s.state.context=s.state.context.prev}function g(n,i){function e(){var e=s.state,t=e.indented;if("stat"==e.lexical.type)t=e.lexical.indented;else for(var r=e.lexical;r&&")"==r.type&&r.align;r=r.prev)t=r.indented;e.lexical=new J(t,s.stream.column(),n,null,e.lexical,i)}return e.lex=!0,e}function y(){var e=s.state;e.lexical.prev&&(")"==e.lexical.type&&(e.indented=e.lexical.indented),e.lexical=e.lexical.prev)}function v(r){return function e(t){return t==r?d():";"==r||"}"==t||")"==t||"]"==t?l():d(e)}}function _(e,t){return"var"==e?d(g("vardef",t),Pe,v(";"),y):"keyword a"==e?d(g("form"),ae,_,y):"keyword b"==e?d(g("form"),_,y):"keyword d"==e?s.stream.match(/^\s*$/,!1)?d():d(g("stat"),w,v(";"),y):"debugger"==e?d(v(";")):"{"==e?d(g("}"),ie,_e,y,m):";"==e?d():"if"==e?("else"==s.state.lexical.info&&s.state.cc[s.state.cc.length-1]==y&&s.state.cc.pop()(),d(g("form"),ae,_,y,Re)):"function"==e?d(P):"for"==e?d(g("form"),ie,Fe,_,m,y):"class"==e||u&&"interface"==t?(s.marked="keyword",d(g("form","class"==e?e:t),Ve,y)):"variable"==e?u&&"declare"==t?(s.marked="keyword",d(_)):u&&("module"==t||"enum"==t||"type"==t)&&s.stream.match(/^\s*\w/,!1)?(s.marked="keyword","enum"==t?d(Qe):"type"==t?d(je,v("operator"),C,v(";")):d(g("form"),I,v("{"),g("}"),_e,y,y)):u&&"namespace"==t?(s.marked="keyword",d(g("form"),x,_,y)):u&&"abstract"==t?(s.marked="keyword",d(_)):d(g("stat"),pe):"switch"==e?d(g("form"),ae,v("{"),g("}","switch"),ie,_e,y,y,m):"case"==e?d(x,v(":")):"default"==e?d(v(":")):"catch"==e?d(g("form"),p,oe,_,y,m):"export"==e?d(g("stat"),Ze,y):"import"==e?d(g("stat"),He,y):"async"==e?d(_):"@"==t?d(x,_):l(g("stat"),x,v(";"),y)}function oe(e){if("("==e)return d(D,v(")"))}function x(e,t){return se(e,t,!1)}function b(e,t){return se(e,t,!0)}function ae(e){return"("!=e?l():d(g(")"),w,v(")"),y)}function se(e,t,r){if(s.state.fatArrowAt==s.stream.start){var n=r?he:ce;if("("==e)return d(p,g(")"),M(D,")"),y,v("=>"),n,m);if("variable"==e)return l(p,I,v("=>"),n,m)}var i,n=r?T:E;return Y.hasOwnProperty(e)?d(n):"function"==e?d(P,n):"class"==e||u&&"interface"==t?(s.marked="keyword",d(g("form"),Ue,y)):"keyword c"==e||"async"==e?d(r?b:x):"("==e?d(g(")"),w,v(")"),y,n):"operator"==e||"spread"==e?d(r?b:x):"["==e?d(g("]"),Ke,y,n):"{"==e?ve(ge,"}",null,n):"quasi"==e?l(le,n):"new"==e?d((i=r,function(e){return"."==e?d(i?de:fe):"variable"==e&&u?d(Ae,i?T:E):l(i?b:x)})):d()}function w(e){return e.match(/[;\}\)\],]/)?l():l(x)}function E(e,t){return","==e?d(w):T(e,t,!1)}function T(e,t,r){var n=0==r?E:T,i=0==r?x:b;return"=>"==e?d(p,r?he:ce,m):"operator"==e?/\+\+|--/.test(t)||u&&"!"==t?d(n):u&&"<"==t&&s.stream.match(/^([^<>]|<[^<>]*>)*>\s*\(/,!1)?d(g(">"),M(C,">"),y,n):"?"==t?d(x,v(":"),i):d(i):"quasi"==e?l(le,n):";"!=e?"("==e?ve(b,")","call",n):"."==e?d(me,n):"["==e?d(g("]"),w,v("]"),y,n):u&&"as"==t?(s.marked="keyword",d(C,n)):"regexp"==e?(s.state.lastType=s.marked="operator",s.stream.backUp(s.stream.pos-s.stream.start-1),d(i)):void 0:void 0}function le(e,t){return"quasi"!=e?l():"${"!=t.slice(t.length-2)?d(le):d(w,ue)}function ue(e){if("}"==e)return s.marked="string-2",s.state.tokenize=$,d(le)}function ce(e){return X(s.stream,s.state),l("{"==e?_:x)}function he(e){return X(s.stream,s.state),l("{"==e?_:b)}function fe(e,t){if("target"==t)return s.marked="keyword",d(E)}function de(e,t){if("target"==t)return s.marked="keyword",d(T)}function pe(e){return":"==e?d(y,_):l(E,v(";"),y)}function me(e){if("variable"==e)return s.marked="property",d()}function ge(e,t){var r;return"async"==e?(s.marked="property",d(ge)):"variable"==e||"keyword"==s.style?(s.marked="property","get"==t||"set"==t?d(ye):(u&&s.state.fatArrowAt==s.stream.start&&(r=s.stream.match(/^\s*:\s*/,!1))&&(s.state.fatArrowAt=s.stream.pos+r[0].length),d(S))):"number"==e||"string"==e?(s.marked=N?"property":s.style+" property",d(S)):"jsonld-keyword"==e?d(S):u&&ee(t)?(s.marked="keyword",d(ge)):"["==e?d(x,k,v("]"),S):"spread"==e?d(b,S):"*"==t?(s.marked="keyword",d(ge)):":"==e?l(S):void 0}function ye(e){return"variable"!=e?l(S):(s.marked="property",d(P))}function S(e){return":"==e?d(b):"("==e?l(P):void 0}function M(n,i,o){function a(e,t){var r;return(o?-1<o.indexOf(e):","==e)?("call"==(r=s.state.lexical).info&&(r.pos=(r.pos||0)+1),d(function(e,t){return e==i||t==i?l():l(n)},a)):e==i||t==i?d():o&&-1<o.indexOf(";")?l(n):d(v(i))}return function(e,t){return e==i||t==i?d():l(n,a)}}function ve(e,t,r){for(var n=3;n<arguments.length;n++)s.cc.push(arguments[n]);return d(g(t,r),M(e,t),y)}function _e(e){return"}"==e?d():l(_,_e)}function k(e,t){if(u)return":"==e?d(C):"?"==t?d(k):void 0}function xe(e,t){if(u&&(":"==e||"in"==t))return d(C)}function be(e){if(u&&":"==e)return s.stream.match(/^\s*\w+\s+is\b/,!1)?d(x,we,C):d(C)}function we(e,t){if("is"==t)return s.marked="keyword",d()}function C(e,t){return"keyof"==t||"typeof"==t||"infer"==t||"readonly"==t?(s.marked="keyword",d("typeof"==t?b:C)):"variable"==e||"void"==t?(s.marked="type",d(A)):"|"==t||"&"==t?d(C):"string"==e||"number"==e||"atom"==e?d(A):"["==e?d(g("]"),M(C,"]",","),y,A):"{"==e?d(g("}"),Te,y,A):"("==e?d(M(Ce,")"),Ee,A):"<"==e?d(M(C,">"),C):"quasi"==e?l(Me,A):void 0}function Ee(e){if("=>"==e)return d(C)}function Te(e){return e.match(/[\}\)\]]/)?d():","==e||";"==e?d(Te):l(Se,Te)}function Se(e,t){return"variable"==e||"keyword"==s.style?(s.marked="property",d(Se)):"?"==t||"number"==e||"string"==e?d(Se):":"==e?d(C):"["==e?d(v("variable"),xe,v("]"),Se):"("==e?l(z,Se):e.match(/[;\}\)\],]/)?void 0:d()}function Me(e,t){return"quasi"!=e?l():"${"!=t.slice(t.length-2)?d(Me):d(C,ke)}function ke(e){if("}"==e)return s.marked="string-2",s.state.tokenize=$,d(Me)}function Ce(e,t){return"variable"==e&&s.stream.match(/^\s*[?:]/,!1)||"?"==t?d(Ce):":"==e?d(C):"spread"==e?d(Ce):l(C)}function A(e,t){return"<"==t?d(g(">"),M(C,">"),y,A):"|"==t||"."==e||"&"==t?d(C):"["==e?d(C,v("]"),A):"extends"==t||"implements"==t?(s.marked="keyword",d(C)):"?"==t?d(C,v(":"),C):void 0}function Ae(e,t){if("<"==t)return d(g(">"),M(C,">"),y,A)}function Ie(){return l(C,Le)}function Le(e,t){if("="==t)return d(C)}function Pe(e,t){return"enum"==t?(s.marked="keyword",d(Qe)):l(I,k,L,Oe)}function I(e,t){return u&&ee(t)?(s.marked="keyword",d(I)):"variable"==e?(i(t),d()):"spread"==e?d(I):"["==e?ve(De,"]"):"{"==e?ve(ze,"}"):void 0}function ze(e,t){return"variable"!=e||s.stream.match(/^\s*:/,!1)?("variable"==e&&(s.marked="property"),"spread"==e?d(I):"}"==e?l():"["==e?d(x,v("]"),v(":"),ze):d(v(":"),I,L)):(i(t),d(L))}function De(){return l(I,L)}function L(e,t){if("="==t)return d(b)}function Oe(e){if(","==e)return d(Pe)}function Re(e,t){if("keyword b"==e&&"else"==t)return d(g("form","else"),_,y)}function Fe(e,t){return"await"==t?d(Fe):"("==e?d(g(")"),Be,y):void 0}function Be(e){return"var"==e?d(Pe,Ne):("variable"==e?d:l)(Ne)}function Ne(e,t){return")"==e?d():";"==e?d(Ne):("in"==t||"of"==t?(s.marked="keyword",d):l)(x,Ne)}function P(e,t){return"*"==t?(s.marked="keyword",d(P)):"variable"==e?(i(t),d(P)):"("==e?d(p,g(")"),M(D,")"),y,be,_,m):u&&"<"==t?d(g(">"),M(Ie,">"),y,P):void 0}function z(e,t){return"*"==t?(s.marked="keyword",d(z)):"variable"==e?(i(t),d(z)):"("==e?d(p,g(")"),M(D,")"),y,be,m):u&&"<"==t?d(g(">"),M(Ie,">"),y,z):void 0}function je(e,t){return"keyword"==e||"variable"==e?(s.marked="type",d(je)):"<"==t?d(g(">"),M(Ie,">"),y):void 0}function D(e,t){return"@"==t&&d(x,D),"spread"==e?d(D):u&&ee(t)?(s.marked="keyword",d(D)):u&&"this"==e?d(k,L):l(I,k,L)}function Ue(e,t){return("variable"==e?Ve:Ge)(e,t)}function Ve(e,t){if("variable"==e)return i(t),d(Ge)}function Ge(e,t){return"<"==t?d(g(">"),M(Ie,">"),y,Ge):"extends"==t||"implements"==t||u&&","==e?("implements"==t&&(s.marked="keyword"),d(u?C:x,Ge)):"{"==e?d(g("}"),O,y):void 0}function O(e,t){return"async"==e||"variable"==e&&("static"==t||"get"==t||"set"==t||u&&ee(t))&&s.stream.match(/^\s+[\w$\xa1-\uffff]/,!1)?(s.marked="keyword",d(O)):"variable"==e||"keyword"==s.style?(s.marked="property",d(We,O)):"number"==e||"string"==e?d(We,O):"["==e?d(x,k,v("]"),We,O):"*"==t?(s.marked="keyword",d(O)):u&&"("==e?l(z,O):";"==e||","==e?d(O):"}"==e?d():"@"==t?d(x,O):void 0}function We(e,t){return"!"==t||"?"==t?d(We):":"==e?d(C,L):"="==t?d(b):l((e=s.state.lexical.prev)&&"interface"==e.info?z:P)}function Ze(e,t){return"*"==t?(s.marked="keyword",d(Je,v(";"))):"default"==t?(s.marked="keyword",d(x,v(";"))):"{"==e?d(M(qe,"}"),Je,v(";")):l(_)}function qe(e,t){return"as"==t?(s.marked="keyword",d(v("variable"))):"variable"==e?l(b,qe):void 0}function He(e){return"string"==e?d():"("==e?l(x):"."==e?l(E):l($e,Xe,Je)}function $e(e,t){return"{"==e?ve($e,"}"):("variable"==e&&i(t),"*"==t&&(s.marked="keyword"),d(Ye))}function Xe(e){if(","==e)return d($e,Xe)}function Ye(e,t){if("as"==t)return s.marked="keyword",d($e)}function Je(e,t){if("from"==t)return s.marked="keyword",d(x)}function Ke(e){return"]"==e?d():l(M(b,"]"))}function Qe(){return l(g("form"),I,v("{"),g("}"),M(et,"}"),y,y)}function et(){return l(I,L)}function tt(e,t,r){return t.tokenize==f&&/^(?:operator|sof|keyword [bcd]|case|new|export|default|spread|[\[{}\(,;:]|=>)$/.test(t.lastType)||"quasi"==t.lastType&&/\{\s*$/.test(e.string.slice(0,e.pos-(r||0)))}return p.lex=ie.lex=!0,y.lex=m.lex=!0,{startState:function(e){e={tokenize:f,lastType:"sof",cc:[],lexical:new J((e||0)-h,0,"block",!1),localVars:c.localVars,context:c.localVars&&new te(null,null,!1),indented:e||0};return c.globalVars&&"object"==typeof c.globalVars&&(e.globalVars=c.globalVars),e},token:function(e,t){var r;return e.sol()&&(t.lexical.hasOwnProperty("align")||(t.lexical.align=!1),t.indented=e.indentation(),X(e,t)),t.tokenize!=H&&e.eatSpace()?null:(r=t.tokenize(e,t),"comment"==G?r:(t.lastType="operator"!=G||"++"!=W&&"--"!=W?G:"incdec",K(t,r,G,W,e)))},indent:function(e,t){if(e.tokenize==H||e.tokenize==$)return rr.Pass;if(e.tokenize!=f)return 0;var r,n=t&&t.charAt(0),i=e.lexical;if(!/^\s*else\b/.test(t))for(var o=e.cc.length-1;0<=o;--o){var a=e.cc[o];if(a==y)i=i.prev;else if(a!=Re&&a!=m)break}for(;("stat"==i.type||"form"==i.type)&&("}"==n||(r=e.cc[e.cc.length-1])&&(r==E||r==T)&&!/^[,\.=+\-*:?[\(]/.test(t));)i=i.prev;var s,l=(i=B&&")"==i.type&&"stat"==i.prev.type?i.prev:i).type,u=n==l;return"vardef"==l?i.indented+("operator"==e.lastType||","==e.lastType?i.info.length+1:0):"form"==l&&"{"==n?i.indented:"form"==l?i.indented+h:"stat"==l?i.indented+(l=t,"operator"==(s=e).lastType||","==s.lastType||Z.test(l.charAt(0))||/[,.]/.test(l.charAt(0))?B||h:0):"switch"!=i.info||u||0==c.doubleIndentSwitch?i.align?i.column+(u?0:1):i.indented+(u?0:h):i.indented+(/^(?:case|default)\b/.test(t)?h:2*h)},electricInput:/^\s*(?:case .*?:|default:|\{|\})$/,blockCommentStart:a?null:"/*",blockCommentEnd:a?null:"*/",blockCommentContinue:a?null:" * ",lineComment:a?null:"//",fold:"brace",closeBrackets:"()[]{}''\"\"``",helperType:a?"json":"javascript",jsonldMode:N,jsonMode:a,expressionAllowed:tt,skipExpression:function(e){K(e,"atom","atom","true",new rr.StringStream("",2,null))}}}),rr.registerHelper("wordChars","javascript",/[\w$]/),rr.defineMIME("text/javascript","javascript"),rr.defineMIME("text/ecmascript","javascript"),rr.defineMIME("application/javascript","javascript"),rr.defineMIME("application/x-javascript","javascript"),rr.defineMIME("application/ecmascript","javascript"),rr.defineMIME("application/json",{name:"javascript",json:!0}),rr.defineMIME("application/x-json",{name:"javascript",json:!0}),rr.defineMIME("application/manifest+json",{name:"javascript",json:!0}),rr.defineMIME("application/ld+json",{name:"javascript",jsonld:!0}),rr.defineMIME("text/typescript",{name:"javascript",typescript:!0}),rr.defineMIME("application/typescript",{name:"javascript",typescript:!0});a={};var s={exports:{}},Er=O(Object.freeze({__proto__:null,default:{}}));function Tr(e,t){for(var r=0,n=e.length-1;0<=n;n--){var i=e[n];"."===i?e.splice(n,1):".."===i?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r--;)e.unshift("..");return e}function Sr(e){return Mr.exec(e).slice(1)}var Mr=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;function kr(){for(var e="",t=!1,r=arguments.length-1;-1<=r&&!t;r--){var n=0<=r?arguments[r]:"/";if("string"!=typeof n)throw new TypeError("Arguments to path.resolve must be strings");n&&(e=n+"/"+e,t="/"===n.charAt(0))}return(t?"/":"")+(e=Tr(Or(e.split("/"),function(e){return!!e}),!t).join("/"))||"."}function Cr(e){var t=Ar(e),r="/"===Br(e,-1);return(e=(e=Tr(Or(e.split("/"),function(e){return!!e}),!t).join("/"))||t?e:".")&&r&&(e+="/"),(t?"/":"")+e}function Ar(e){return"/"===e.charAt(0)}function Ir(){return Cr(Or(Array.prototype.slice.call(arguments,0),function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))}function Lr(e,t){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;0<=r&&""===e[r];r--);return r<t?[]:e.slice(t,r-t+1)}e=kr(e).substr(1),t=kr(t).substr(1);for(var n=r(e.split("/")),i=r(t.split("/")),o=Math.min(n.length,i.length),a=o,s=0;s<o;s++)if(n[s]!==i[s]){a=s;break}for(var l=[],s=a;s<n.length;s++)l.push("..");return(l=l.concat(i.slice(a))).join("/")}function Pr(e){var e=Sr(e),t=e[0],e=e[1];return t||e?t+(e=e&&e.substr(0,e.length-1)):"."}function zr(e,t){e=Sr(e)[2];return e=t&&e.substr(-1*t.length)===t?e.substr(0,e.length-t.length):e}function Dr(e){return Sr(e)[3]}l={extname:Dr,basename:zr,dirname:Pr,sep:"/",delimiter:":",relative:Lr,join:Ir,isAbsolute:Ar,normalize:Cr,resolve:kr};function Or(e,t){if(e.filter)return e.filter(t);for(var r=[],n=0;n<e.length;n++)t(e[n],n,e)&&r.push(e[n]);return r}var Rr,Fr,Br="b"==="ab".substr(-1)?function(e,t,r){return e.substr(t,r)}:function(e,t,r){return t<0&&(t=e.length+t),e.substr(t,r)},Nr=O(Object.freeze({__proto__:null,resolve:kr,normalize:Cr,isAbsolute:Ar,join:Ir,relative:Lr,sep:"/",delimiter:":",dirname:Pr,basename:zr,extname:Dr,default:l}));function x(e,t,r,n){for(r=r||{},n=e.length;n--;r[e[n]]=t);return r}function jr(){this.yy={}}Rr=s.exports,u=[18,22],c=[22,24],y={trace:function(){},yy:{},symbols_:{error:2,JSONString:3,STRING:4,JSONNumber:5,NUMBER:6,JSONNullLiteral:7,NULL:8,JSONBooleanLiteral:9,TRUE:10,FALSE:11,JSONText:12,JSONValue:13,EOF:14,JSONObject:15,JSONArray:16,"{":17,"}":18,JSONMemberList:19,JSONMember:20,":":21,",":22,"[":23,"]":24,JSONElementList:25,$accept:0,$end:1},terminals_:{2:"error",4:"STRING",6:"NUMBER",8:"NULL",10:"TRUE",11:"FALSE",14:"EOF",17:"{",18:"}",21:":",22:",",23:"[",24:"]"},productions_:[0,[3,1],[5,1],[7,1],[9,1],[9,1],[12,2],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[15,2],[15,3],[20,3],[19,1],[19,3],[16,2],[16,3],[25,1],[25,3]],performAction:function(e,t,r,n,i,o,a){var s=o.length-1;switch(i){case 1:this.$=e.replace(/\\(\\|")/g,"$1").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\t/g,"\t").replace(/\\v/g,"\v").replace(/\\f/g,"\f").replace(/\\b/g,"\b");break;case 2:this.$=Number(e);break;case 3:this.$=null;break;case 4:this.$=!0;break;case 5:this.$=!1;break;case 6:return this.$=o[s-1];case 13:this.$={},Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 14:case 19:this.$=o[s-1],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 15:this.$=[o[s-2],o[s]];break;case 16:this.$={},this.$[o[s][0]]=o[s][1];break;case 17:this.$=o[s-2],void 0!==o[s-2][o[s][0]]&&(this.$.__duplicateProperties__||Object.defineProperty(this.$,"__duplicateProperties__",{value:[],enumerable:!1}),this.$.__duplicateProperties__.push(o[s][0])),o[s-2][o[s][0]]=o[s][1];break;case 18:this.$=[],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 20:this.$=[o[s]];break;case 21:this.$=o[s-2],o[s-2].push(o[s])}},table:[{3:5,4:h=[1,12],5:6,6:f=[1,13],7:3,8:qe=[1,9],9:4,10:d=[1,10],11:p=[1,11],12:1,13:2,15:7,16:8,17:m=[1,14],23:g=[1,15]},{1:[3]},{14:[1,16]},x(y=[14,18,22,24],[2,7]),x(y,[2,8]),x(y,[2,9]),x(y,[2,10]),x(y,[2,11]),x(y,[2,12]),x(y,[2,3]),x(y,[2,4]),x(y,[2,5]),x([14,18,21,22,24],[2,1]),x(y,[2,2]),{3:20,4:h,18:[1,17],19:18,20:19},{3:5,4:h,5:6,6:f,7:3,8:qe,9:4,10:d,11:p,13:23,15:7,16:8,17:m,23:g,24:[1,21],25:22},{1:[2,6]},x(y,[2,13]),{18:[1,24],22:[1,25]},x(u,[2,16]),{21:[1,26]},x(y,[2,18]),{22:[1,28],24:[1,27]},x(c,[2,20]),x(y,[2,14]),{3:20,4:h,20:29},{3:5,4:h,5:6,6:f,7:3,8:qe,9:4,10:d,11:p,13:30,15:7,16:8,17:m,23:g},x(y,[2,19]),{3:5,4:h,5:6,6:f,7:3,8:qe,9:4,10:d,11:p,13:31,15:7,16:8,17:m,23:g},x(u,[2,17]),x(u,[2,15]),x(c,[2,21])],defaultActions:{16:[2,6]},parseError:function(e,t){function r(e,t){this.message=e,this.hash=t}if(!t.recoverable)throw r.prototype=Error,new r(e,t);this.trace(e)},parse:function(e){var t,r=this,n=[0],i=[null],o=[],a=this.table,s="",l=0,u=0,c=1,h=o.slice.call(arguments,1),f=Object.create(this.lexer),d={yy:{}};for(t in this.yy)Object.prototype.hasOwnProperty.call(this.yy,t)&&(d.yy[t]=this.yy[t]);f.setInput(e,d.yy),d.yy.lexer=f,d.yy.parser=this,void 0===f.yylloc&&(f.yylloc={});for(var p,m,g,y,v,_,x=f.yylloc,b=(o.push(x),f.options&&f.options.ranges),w=("function"==typeof d.yy.parseError?this.parseError=d.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError,{});;){if(m=n[n.length-1],void 0===(g=this.defaultActions[m]||(null==p&&(E=void 0,p=E="number"!=typeof(E=f.lex()||c)&&r.symbols_[E]||E),a[m]&&a[m][p]))||!g.length||!g[0]){var E="",T=[];for(y in a[m])this.terminals_[y]&&2<y&&T.push("'"+this.terminals_[y]+"'");E=f.showPosition?"Parse error on line "+(l+1)+":\n"+f.showPosition()+"\nExpecting "+T.join(", ")+", got '"+(this.terminals_[p]||p)+"'":"Parse error on line "+(l+1)+": Unexpected "+(p==c?"end of input":"'"+(this.terminals_[p]||p)+"'"),this.parseError(E,{text:f.match,token:this.terminals_[p]||p,line:f.yylineno,loc:x,expected:T})}if(g[0]instanceof Array&&1<g.length)throw new Error("Parse Error: multiple actions possible at state: "+m+", token: "+p);switch(g[0]){case 1:n.push(p),i.push(f.yytext),o.push(f.yylloc),n.push(g[1]),p=null,u=f.yyleng,s=f.yytext,l=f.yylineno,x=f.yylloc;break;case 2:if(v=this.productions_[g[1]][1],w.$=i[i.length-v],w._$={first_line:o[o.length-(v||1)].first_line,last_line:o[o.length-1].last_line,first_column:o[o.length-(v||1)].first_column,last_column:o[o.length-1].last_column},b&&(w._$.range=[o[o.length-(v||1)].range[0],o[o.length-1].range[1]]),void 0!==(_=this.performAction.apply(w,[s,u,l,d.yy,g[1],i,o].concat(h))))return _;v&&(n=n.slice(0,-1*v*2),i=i.slice(0,-1*v),o=o.slice(0,-1*v)),n.push(this.productions_[g[1]][0]),i.push(w.$),o.push(w._$),_=a[n[n.length-2]][n[n.length-1]],n.push(_);break;case 3:return!0}}return!0},lexer:{EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e,t){return this.yy=t||this.yy||{},this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,r=e.split(/(?:\r\n?|\n)/g),e=(this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t),this.offset-=t,this.match.split(/(?:\r\n?|\n)/g)),n=(this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),r.length-1&&(this.yylineno-=r.length-1),this.yylloc.range);return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:r?(r.length===e.length?this.yylloc.first_column:0)+e[e.length-r.length].length-r[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[n[0],n[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(20<e.length?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(20<e.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var r,n;if(this.options.backtrack_lexer&&(n={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(n.yylloc.range=this.yylloc.range.slice(0))),(r=e[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-r[r.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],r=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),r)return r;if(this._backtrack)for(var i in n)this[i]=n[i];return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var e,t,r,n,i=this._currentRules(),o=0;o<i.length;o++)if((r=this._input.match(this.rules[i[o]]))&&(!t||r[0].length>t[0].length))if(t=r,n=o,this.options.backtrack_lexer){if(!1!==(e=this.test_match(r,i[o])))return e;if(!this._backtrack)return!1;t=!1}else if(!this.options.flex)break;return t?!1!==(e=this.test_match(t,i[n]))&&e:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return e||this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return 0<this.conditionStack.length-1?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return(this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]]:this.conditions.INITIAL).rules},topState:function(e){return 0<=(e=this.conditionStack.length-1-Math.abs(e||0))?this.conditionStack[e]:"INITIAL"},pushState:function(e){this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(e,t,r,n){switch(r){case 0:break;case 1:return 6;case 2:return t.yytext=t.yytext.substr(1,t.yyleng-2),4;case 3:return 17;case 4:return 18;case 5:return 23;case 6:return 24;case 7:return 22;case 8:return 21;case 9:return 10;case 10:return 11;case 11:return 8;case 12:return 14;case 13:return"INVALID"}},rules:[/^(?:\s+)/,/^(?:(-?([0-9]|[1-9][0-9]+))(\.[0-9]+)?([eE][-+]?[0-9]+)?\b)/,/^(?:"(?:\\[\\"bfnrt\/]|\\u[a-fA-F0-9]{4}|[^\\\0-\x09\x0a-\x1f"])*")/,/^(?:\{)/,/^(?:\})/,/^(?:\[)/,/^(?:\])/,/^(?:,)/,/^(?::)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}}},Fr=new((jr.prototype=y).Parser=jr),Rr.parser=Fr,Rr.Parser=Fr.Parser,Rr.parse=function(){return Fr.parse.apply(Fr,arguments)},Rr.main=function(e){e[1]||(console.log("Usage: "+e[0]+" FILE"),$d.exit(1));e=Er.readFileSync(Nr.normalize(e[1]),"utf8");return Rr.parser.parse(e)};v={};function Ur(e){var t=0;if(2<e.length)for(var r,n,i=0;i<e.length-1;i++)r=e[i],t+=((n=e[i+1])[0]-r[0])*(n[1]+r[1]);return 0<=t}function Vr(e){if(e&&0<e.length){if(Ur(e[0]))return!1;if(!e.slice(1,e.length).every(Ur))return!1}return!0}var Gr=function(e,t){var r;("Polygon"===(r=e).type?Vr(r.coordinates):"MultiPolygon"===r.type&&r.coordinates.every(Vr))||t.push({message:"Polygons and MultiPolygons should follow the right-hand rule",level:"message",line:e.__line__})};v.hint=function(e,i){var o=[],a=0,t=10,s=6;function r(e){var t;i&&!1===i.noDuplicateMembers||!e.__duplicateProperties__||o.push({message:"An object contained duplicate members, making parsing ambigous: "+e.__duplicateProperties__.join(", "),line:e.__line__}),n(e,"type","string")||(p[e.type]?e&&p[e.type](e):void 0!==(t=m[e.type.toLowerCase()])?o.push({message:"Expected "+t+" but got "+e.type+" (case sensitive)",line:e.__line__}):o.push({message:"The type "+e.type+" is unknown",line:e.__line__}))}function l(e,t){return e.every(function(e){return null!==e&&typeof e===t})}function n(e,t,r){return void 0===e[t]?o.push({message:'"'+t+'" member required',line:e.__line__}):"array"===r?!Array.isArray(e[t])&&o.push({message:'"'+t+'" member should be an array, but is an '+typeof e[t]+" instead",line:e.__line__}):"object"===r&&e[t]&&e[t].constructor!==Object?o.push({message:'"'+t+'" member should be '+r+", but is an "+e[t].constructor.name+" instead",line:e.__line__}):r&&typeof e[t]!==r&&o.push({message:'"'+t+'" member should be '+r+", but is an "+typeof e[t]+" instead",line:e.__line__})}function u(r,n){if(!Array.isArray(r))return o.push({message:"position should be an array, is a "+typeof r+" instead",line:r.__line__||n});if(r.length<2)return o.push({message:"position must have 2 or more elements",line:r.__line__||n});if(3<r.length)return o.push({message:"position should not have more than 3 elements",level:"message",line:r.__line__||n});if(!l(r,"number"))return o.push({message:"each element in a position must be a number",line:r.__line__||n});if(i&&i.precisionWarning){if(a===t)return a+=1,o.push({message:"truncated warnings: we've encountered coordinate precision warning "+t+" times, no more warnings will be reported",level:"message",line:r.__line__||n});a<t&&r.forEach(function(e){var t=0,e=String(e).split(".")[1];if(void 0!==e&&(t=e.length),s<t)return a+=1,o.push({message:"precision of coordinates should be reduced",level:"message",line:r.__line__||n})})}}function c(r,t,n,i){if(void 0===i&&void 0!==r.__line__&&(i=r.__line__),0===n)return u(r,i);if(1===n&&t)if("LinearRing"===t){if(!Array.isArray(r[r.length-1]))return o.push({message:"a number was found where a coordinate array should have been found: this needs to be nested more deeply",line:i}),!0;if(r.length<4&&o.push({message:"a LinearRing of coordinates needs to have four or more positions",line:i}),r.length&&(r[r.length-1].length!==r[0].length||!r[r.length-1].every(function(e,t){return r[0][t]===e})))return o.push({message:"the first and last positions in a LinearRing of coordinates must be the same",line:i}),!0}else if("Line"===t&&r.length<2)return o.push({message:"a line needs to have two or more coordinates to be valid",line:i});if(Array.isArray(r))return r.map(function(e){return c(e,t,n-1,e.__line__||i)}).some(function(e){return e});o.push({message:"a number was found where a coordinate array should have been found: this needs to be nested more deeply",line:i})}function h(e){e.crs&&("object"==typeof e.crs&&e.crs.properties&&"urn:ogc:def:crs:OGC:1.3:CRS84"===e.crs.properties.name?o.push({message:"old-style crs member is not recommended, this object is equivalent to the default and should be removed",line:e.__line__}):o.push({message:"old-style crs member is not recommended",line:e.__line__}))}function f(e){if(e.bbox)return Array.isArray(e.bbox)?(l(e.bbox,"number")||o.push({message:"each element in a bbox member must be a number",line:e.bbox.__line__}),4!==e.bbox.length&&6!==e.bbox.length&&o.push({message:"bbox must contain 4 elements (for 2D) or 6 elements (for 3D)",line:e.bbox.__line__}),o.length):void o.push({message:"bbox member must be an array of numbers, but is a "+typeof e.bbox,line:e.__line__})}function d(e){h(e),f(e),void 0!==e.id&&"string"!=typeof e.id&&"number"!=typeof e.id&&o.push({message:'Feature "id" member must have a string or number value',line:e.__line__}),void 0!==e.features&&o.push({message:'Feature object cannot contain a "features" member',line:e.__line__}),void 0!==e.coordinates&&o.push({message:'Feature object cannot contain a "coordinates" member',line:e.__line__}),"Feature"!==e.type&&o.push({message:"GeoJSON features must have a type=feature member",line:e.__line__}),n(e,"properties","object"),n(e,"geometry","object")||e.geometry&&r(e.geometry)}var p={Point:function(e){var t;h(e),f(e),void 0!==(t=e).properties&&o.push({message:'geometry object cannot contain a "properties" member',line:t.__line__}),void 0!==t.geometry&&o.push({message:'geometry object cannot contain a "geometry" member',line:t.__line__}),void 0!==t.features&&o.push({message:'geometry object cannot contain a "features" member',line:t.__line__}),n(e,"coordinates","array")||u(e.coordinates)},Feature:d,MultiPoint:function(e){h(e),f(e),n(e,"coordinates","array")||c(e.coordinates,"",1)},LineString:function(e){h(e),f(e),n(e,"coordinates","array")||c(e.coordinates,"Line",1)},MultiLineString:function(e){h(e),f(e),n(e,"coordinates","array")||c(e.coordinates,"Line",2)},FeatureCollection:function(e){if(h(e),f(e),void 0!==e.properties&&o.push({message:'FeatureCollection object cannot contain a "properties" member',line:e.__line__}),void 0!==e.coordinates&&o.push({message:'FeatureCollection object cannot contain a "coordinates" member',line:e.__line__}),!n(e,"features","array")){if(!l(e.features,"object"))return o.push({message:"Every feature must be an object",line:e.__line__});e.features.forEach(d)}},GeometryCollection:function(t){h(t),f(t),n(t,"geometries","array")||(l(t.geometries,"object")||o.push({message:"The geometries array in a GeometryCollection must contain only geometry objects",line:t.__line__}),1===t.geometries.length&&o.push({message:"GeometryCollection with a single geometry should be avoided in favor of single part or a single object of multi-part type",line:t.geometries.__line__}),t.geometries.forEach(function(e){e&&("GeometryCollection"===e.type&&o.push({message:"GeometryCollection should avoid nested geometry collections",line:t.geometries.__line__}),r(e))}))},Polygon:function(e){h(e),f(e),n(e,"coordinates","array")||c(e.coordinates,"LinearRing",2)||i&&!0===i.ignoreRightHandRule||Gr(e,o)},MultiPolygon:function(e){h(e),f(e),n(e,"coordinates","array")||c(e.coordinates,"LinearRing",3)||i&&!0===i.ignoreRightHandRule||Gr(e,o)}},m=Object.keys(p).reduce(function(e,t){return e[t.toLowerCase()]=t,e},{});return"object"!=typeof e||null==e?o.push({message:"The root of a GeoJSON object must be an object.",line:0}):(r(e),o.forEach(function(e){!{}.hasOwnProperty.call(e,"line")||void 0!==e.line||delete e.line})),o};var Wr=s.exports,Zr=v;a.hint=function(t,e){var r,n=[];if("object"==typeof t)r=t;else{if("string"!=typeof t)return[{message:"Expected string or object as input",line:0}];try{r=Wr.parse(t)}catch(e){t=e.message.match(/line (\d+)/);return[{line:parseInt(t[1],10)-1,message:e.message,error:e}]}}return n=n.concat(Zr.hint(r,e))};const qr=a;const Hr=t.default;function $r(e){var t=e.data.get("map");1===t.features.length&&"Point"===t.features[0].geometry.type?e.map.flyTo({center:t.features[0].geometry.coordinates,zoom:6,duration:1e3}):(t=Hr(t),e.map.fitBounds(t,{padding:50,duration:1e3}))}const Xr=function(e){e.select("div.message").remove();const t=e.append("div").attr("class","message pad1");return t.append("a").attr("class","icon-remove fr").on("click",()=>{t.remove()}),t.append("div").attr("class","content"),t.style("opacity",0).transition().duration(200).style("opacity",1),t.close=function(){t.transition().duration(200).style("opacity",0).remove(),t.transition().duration(200).style("top","0px")},t};function Yr(e,t){const r=Xr(e);return t&&r.select(".content").html(t),setTimeout(()=>{r.transition().style("opacity",0).remove()},5e3),r}const Jr=e.exports,Kr=i["createPopper"],Qr=Zt,en=o.exports,tn=function(l){return function(t,e){var r=qr.hint(t.getValue()),n=(t.clearGutter("error"),r.filter(e=>!Object.prototype.hasOwnProperty.call(e,"level")));if(r instanceof Error)return o=r.message,(i=o.match(/line (\d+)/))&&i[1]&&(t.clearGutter("error"),t.setGutterMarker(parseInt(i[1],10)-1,"error",s(o))),l({class:"icon-circle-blank",title:"invalid JSON",message:"invalid JSON"});if(n.length)return a(r),l({class:"icon-circle-blank",title:"invalid GeoJSON",message:"invalid GeoJSON"});a(r);var i=0===e.from.ch&&0===e.from.line&&"paste"===e.origin,o=JSON.parse(t.getValue());try{return l(null,o,i)}catch(e){return l({class:"icon-circle-blank",title:"invalid GeoJSON",message:"invalid GeoJSON"})}function a(e){t.clearGutter("error"),e.forEach(e=>{t.setGutterMarker(e.line,"error",s(e.message,e.level))})}function s(e,t){let r="error-marker";return"message"===t&&(r+=" warning"),d3.select(document.createElement("div")).attr("class",r).attr("message",e).node()}}},rn=$r,nn=Yr;const on=O(Object.freeze({__proto__:null,default:{html:'<h2 id="help">Help</h2>\n<p><strong>geojson.io</strong> is a quick, simple tool for creating, viewing, and sharing maps. geojson.io is named after <a href="http://geojson.org/">GeoJSON</a>, an open source spatial data format, and it supports GeoJSON in all ways - but also accepts KML, GPX, CSV, GTFS, TopoJSON, and other formats.</p>\n<p>Want to request a feature or report a bug? <a href="https://github.com/mapbox/geojson.io/issues?state=open">Open an issue on geojson.io\'s issue tracker.</a></p>\n<h3 id="ive-got-data">I\'ve got data</h3>\n<p>If you have data, like a KML, GeoJSON, or CSV file, just drag &amp; drop it onto the page or click \'Open\' and select your file. Your data should appear on the map!</p>\n<h3 id="i-want-to-draw-features">I want to draw features</h3>\n<p>Use the drawing tools to draw points, polygons, lines, rectangles, and circles. After you\'re done drawing the shapes, you can add information to each feature by clicking on it, editing the feature\'s properties, and clicking \'Save\'.</p>\n<p>Note: Circles are not supported in GeoJSON, so the circle drawing tool is really creating a circle-shaped polygon with 64 vertices.</p>\n<h3 id="i-want-to-edit-features">I want to edit features</h3>\n<p>To edit geometries, click the edit button to enter editng mode. All Features are selected by default. Click to select a Feature or Vertex. Press delete to remove selected Feature or Vertex. Drag to move selected vertex. Shift + drag to move selected Feature(s)</p>\n<p>Properties in GeoJSON are stored as \'key value pairs\'. You can edit properties in three ways: 1 - Click the feature on the map and edit properties in the popup. 2 - Edit properties in the data table, 3 - Edit properties in the Code editor</p>\n<h3 id="im-a-coder">I\'m a coder</h3>\n<p><a href="#geojson-io-api">geojson.io accepts URL parameters</a> that make it easy to go from a GeoJSON file on your computer to geojson.io.</p>\n<h3 id="privacy--license-issues">Privacy &amp; License Issues</h3>\n<ul>\n<li><strong>The data you create and modify in geojson.io</strong> doesn\'t acquire any additional license: if it\'s secret and copyrighted, it will remain that way - it doesn\'t have to be public or open source.</li>\n</ul>',metadata:{},filename:"help.md",path:"/home/lib0c/git-repo/geojson/data/help.md"}})).default,an=O(Object.freeze({__proto__:null,default:{html:'<h2 id="geojsonio-api">Geojson.io API</h2>\n<p>You can interact with geojson.io programmatically in two ways:</p>\n<ul>\n<li><a href="#url-api">URL parameters</a></li>\n<li><a href="#console-api">Browser console</a></li>\n</ul>\n<h2 id="url-api">URL API</h2>\n<p>You can do a few interesting things with just URLs and geojson.io. Here are the<br />\ncurrent URL formats.</p>\n<h3 id="map"><code>map</code></h3>\n<p>Open the map at a specific location. The argument is numbers separated by <code>/</code><br />\nin the form <code>zoom/latitude/longitude</code>.</p>\n<h4 id="example">Example:</h4>\n<p><a href="http://geojson.io/#map=2/20.0/0.0">http://geojson.io/#map=2/20.0/0.0</a></p>\n<h3 id="datadataapplicationjson"><code>data=data:application/json,</code></h3>\n<p>Open the map and load a chunk of <a href="http://geojson.org/">GeoJSON</a> data from a<br />\nURL segment directly onto the map. The GeoJSON data should be encoded<br />\nas per <code>encodeURIComponent(JSON.stringify(geojson_data))</code>.</p>\n<h4 id="example-1">Example:</h4>\n<p><a href="http://geojson.io/#data=data:application/json,%7B%22type%22%3A%22LineString%22%2C%22coordinates%22%3A%5B%5B0%2C0%5D%2C%5B10%2C10%5D%5D%7D">http://geojson.io/#data=data:application/json,%7B%22type%22%3A%22LineString%22%2C%22coordinates%22%3A%5B%5B0%2C0%5D%2C%5B10%2C10%5D%5D%7D</a></p>\n<h3 id="datadatatextx-url"><code>data=data:text/x-url,</code></h3>\n<p>Load GeoJSON data from a URL on the internet onto the map. The URL must<br />\nrefer directly to a resource that is:</p>\n<ul>\n<li>Freely accessible (not behind a password)</li>\n<li>Supports <a href="http://en.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a></li>\n<li>Is valid GeoJSON</li>\n</ul>\n<p>The URL should be encoded as per <code>encodeURIComponent(url)</code>.</p>\n<h4 id="example-2">Example:</h4>\n<p><a href="http://geojson.io/#data=data:text/x-url,https%3A%2F%2Fraw.githubusercontent.com%2Fcodeforgermany%2Fclick_that_hood%2Fmain%2Fpublic%2Fdata%2Fcalifornia-counties.geojson">http://geojson.io/#data=data:text/x-url,https%3A%2F%2Fraw.githubusercontent.com%2Fcodeforgermany%2Fclick_that_hood%2Fmain%2Fpublic%2Fdata%2Fcalifornia-counties.geojson</a></p>\n<h3 id="idgist"><code>id=gist:</code></h3>\n<p>Load GeoJSON data from a <a href="https://gist.github.com/">GitHub Gist</a>, given an argument<br />\nin the form of <code>login/gistid</code>. The Gist can be public or private, and must<br />\ncontain a file with a <code>.geojson</code> extension that is valid GeoJSON.</p>\n<h4 id="example-3">Example:</h4>\n<p><a href="http://geojson.io/#id=gist:tmcw/e9a29ad54dbaa83dee08&map=8/39.198/-76.981">http://geojson.io/#id=gist:tmcw/e9a29ad54dbaa83dee08&map=8/39.198/-76.981</a></p>\n<h3 id="idgithub"><code>id=github:</code></h3>\n<p>Load a file from a GitHub repository. You must have access to the file, and<br />\nit must be valid GeoJSON.</p>\n<p>The url is in the form:</p>\n<pre><code>login/repository/blob/branch/filepath</code></pre>\n<h4 id="example-4">Example:</h4>\n<p><a href="http://geojson.io/#id=github:benbalter/dc-wifi-social/blob/master/bars.geojson&map=14/38.9140/-77.0302">http://geojson.io/#id=github:benbalter/dc-wifi-social/blob/master/bars.geojson&map=14/38.9140/-77.0302</a></p>\n<h2 id="console-api">Console API</h2>\n<p>Pop open your browser console and see the beautiful examples: geojson.io has started to expose a subset of its inner workings for you to mess around with:</p>\n<h3 id="windowapimap"><code>window.api.map</code></h3>\n<p>The <a href="https://docs.mapbox.com/mapbox-gl-js/guides/">Mapbox GL JS</a> map that you see and use on the site. See the <a href="https://docs.mapbox.com/mapbox-gl-js/api/">Mapbox GL JS API Reference</a> for all the things you can do with it.</p>\n<p>For instance, you could add another map source and layer:</p>\n<pre><code class="js language-js">window.api.map.addSource(\'raster-tiles\', {\n    \'type\': \'raster\',\n    \'tiles\': [\n    \'https://stamen-tiles.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.jpg\'\n    ],\n    \'tileSize\': 256,\n    \'attribution\':\n    \'Map tiles by &lt;a target="_top" rel="noopener" href="http://stamen.com"&gt;Stamen Design&lt;/a&gt;, under &lt;a target="_top" rel="noopener" href="http://creativecommons.org/licenses/by/3.0"&gt;CC BY 3.0&lt;/a&gt;. Data by &lt;a target="_top" rel="noopener" href="http://openstreetmap.org"&gt;OpenStreetMap&lt;/a&gt;, under &lt;a target="_top" rel="noopener" href="http://creativecommons.org/licenses/by-sa/3.0"&gt;CC BY SA&lt;/a&gt;\'\n})\n\nwindow.api.map.addLayer({\n    \'id\': \'simple-tiles\',\n    \'type\': \'raster\',\n    \'source\': \'raster-tiles\',\n    \'minzoom\': 0,\n    \'maxzoom\': 22\n})</code></pre>\n<h3 id="windowapidata"><code>window.api.data</code></h3>\n<p>The data model. See the <a href="https://github.com/mapbox/geojson.io/blob/main/src/core/data.js#L46-L101">code to get an idea of how it works</a> -<br />\nyou\'ll want to use stuff like <code>data.set({ map: { .. your geojson map information .. })</code><br />\nand <code>data.get(\'map\')</code> and <code>data.mergeFeatures([arrayoffeatures])</code> to do your<br />\ndirty business.</p>\n<h2 id="windowapidraw"><code>window.api.draw</code></h2>\n<p>Exposes the <a href="https://github.com/mapbox/mapbox-gl-draw">mapbox-gl-draw</a> instance in the console.</p>\n<h2 id="windowapionevent-fn"><code>window.api.on(event, fn)</code></h2>\n<p>Exposes d3 events, including <code>change</code>.</p>',metadata:{},filename:"API.md",path:"/home/lib0c/git-repo/geojson/API.md"}})).default;function sn(n){function e(t){function e(){var e=n.data.get("map");e&&(e.geometry||e.features&&e.features.length)?(e=e.geometry?[e.properties]:e.features.map(r),t.select(".blank-banner").remove(),t.data([e]).call(le().on("change",(e,t)=>{var r=n.data.get("map");r.geometry?r.properties=e:r.features[t].properties=e,n.data.set("map",r)}).on("rowfocus",(e,t)=>{var r=n.data.get("map");r.geometry||ue(n.map,r.features[t])}))):t.html("").append("div").attr("class","blank-banner center").text("no features")}function r(e){return e.properties}t.html(""),n.dispatch.on("change.table",()=>{e()}),e()}return e.off=function(){n.dispatch.on("change.table",null)},e}function ln(o){function e(e){var t=e.html("").append("textarea");const r=e.append("div").attr("id","tooltip").attr("class","opacity-0 text-white font-medium text-xs rounded text-left py-1 px-2 bg-mb-gray-dark transition-opacity duration-100").attr("role","tooltip").text("Copied!");r.append("div").attr("id","arrow").attr("class","-right-1 top-0 translate-y-2 absolute w-2 h-2 bg-transparent before:opacity-0 before:transition-opacity before:duration-100 group-hover:before:opacity-100 before:absolute before:w-2 before:h-2 before:rotate-45 before:bg-mb-gray-dark").attr("data-popper-arrow","");e=e.append("div").attr("class","mapboxgl-ctrl mapboxgl-ctrl-group absolute right-5 top-5 opacity-0 group-hover:opacity-100 transition-opacity duration-100");const n=en.fromTextArea(t.node(),{mode:{name:"javascript",json:!0},matchBrackets:!0,tabSize:2,gutters:["error","CodeMirror-linenumbers","CodeMirror-foldgutter"],theme:"eclipse",autofocus:window===window.top,keyMap:"tabSpace",lineNumbers:!0,foldGutter:!0});t=e.append("button").attr("id","copy-button").attr("title","Copy");const i=t.append("span").attr("class","fa-solid fa-copy text-gray-500");t.on("click",()=>{navigator.clipboard.writeText(n.getValue()),i.classed("fa-copy",!1).attr("class","fa-solid fa-check text-green-600"),r.classed("group-hover:opacity-100",!0),setTimeout(()=>{i.attr("class","fa-solid fa-copy text-gray-500"),r.classed("group-hover:opacity-100",!1)},3e3)});e=document.querySelector("#copy-button"),t=document.querySelector("#tooltip");Kr(e,t,{placement:"left",modifiers:[{name:"offset",options:{offset:[0,8]}}]}),n.display.input.blur(),n.foldCode(en.Pos(0,0)),n.matchBrackets(),n.on("beforeChange",(e,t)=>{if("paste"===t.origin)try{var r=JSON.stringify(JSON.parse(t.text[0]),null,2);t.update(null,null,r.split("\n"))}catch(e){console.log("error pretty-printing pasted geojson",e)}}),n.on("change",tn(function(t,r,n){if(!t){let e="json";t=r.type;["Feature","GeometryCollection","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon"].includes(r.type)&&(r=Qr(r),e="geojsonNormalize",nn(o.container,`The imported ${t} was normalized into a FeatureCollection`)),Jr.isEqual(r,o.data.get("map"))||(o.data.set({map:r},e),n&&rn(o))}})),o.dispatch.on("change.json",e=>{"json"!==e.source&&(e=n.getScrollInfo(),n.setValue(JSON.stringify(o.data.get("map"),null,2)),n.scrollTo(e.left,e.top))}),n.setValue(JSON.stringify(o.data.get("map"),null,2))}return en.keyMap.tabSpace={Tab:function(e){var t=new Array(e.getOption("indentUnit")+1).join(" ");e.replaceSelection(t,"end","+input")},fallthrough:["default"]},e.off=function(){o.dispatch.on("change.json",null)},e}function un(){const t=on.html+"<br><hr><br>"+an.html;function e(e){e.html("").append("div").attr("class","pad2 prose").html(t)}return e.off=function(){},e}var Dt={},l={geometries:{NULL:0,POINT:1,POLYLINE:3,POLYGON:5,MULTIPOINT:8,POINTZ:11,POLYLINEZ:13,POLYGONZ:15,MULTIPOINTZ:18,POINTM:21,POLYLINEM:23,POLYGONM:25,MULTIPOINTM:28,MULTIPATCH:31}},h={},f={lpad:function(e,t,r){for(;e.length<t;)e=r+e;return e},rpad:function(e,t,r){for(;e.length<t;)e+=r;return e},writeField:function(e,t,r,n){for(var i=0;i<t;i++)e.setUint8(n,r.charCodeAt(i)),n++;return n}},qe={},cn={C:254,L:1,D:8,N:18,M:18,F:18,B:8},hn={string:"C",number:"N",boolean:"L",null:"C"};function fn(e){var t,r,n={},i=[];for(t in e)n[t]=null===e[t]?"null":typeof e[t];for(r in n){var o=hn[n[r]];o&&i.push({name:r,type:o,size:cn[o]})}return i}qe.multi=function(e){var o={};return e.forEach(function(e){var t,r=o,n=e;for(t in n){var i=void 0!==n[t]&&null!==n[t];void 0!==r[t]&&!i||(r[t]=n[t])}}),fn(o)},qe.bytesPer=function(e){return e.reduce(function(e,t){return e+t.size},1)},qe.obj=fn;var dn=f,pn=qe,d=(h.structure=function(e,t){var n=t||pn.multi(e),t=32*n.length+1,r=pn.bytesPer(n),i=new ArrayBuffer(32+t+r*e.length+1),o=new Date,a=new DataView(i),i=(a.setUint8(0,3),a.setUint8(1,o.getFullYear()-1900),a.setUint8(2,o.getMonth()),a.setUint8(3,o.getDate()),a.setUint32(4,e.length,!0),32+t);return a.setUint16(8,i,!0),a.setUint16(10,r,!0),a.setInt8(32+t-1,13),n.forEach(function(e,r){e.name.split("").slice(0,8).forEach(function(e,t){a.setInt8(32+32*r+t,e.charCodeAt(0))}),a.setInt8(32+32*r+11,e.type.charCodeAt(0)),a.setInt8(32+32*r+16,e.size),"N"==e.type&&a.setInt8(32+32*r+17,3)}),offset=32+t,e.forEach(function(r,e){a.setUint8(offset,32),offset++,n.forEach(function(e){var t=r[e.name];switch(null==t&&(t=""),e.type){case"L":a.setUint8(offset,t?84:70),offset++;break;case"D":offset=dn.writeField(a,8,dn.lpad(t.toString(),8," "),offset);break;case"N":offset=dn.writeField(a,e.size,dn.lpad(t.toString(),e.size," ").substr(0,18),offset);break;case"C":offset=dn.writeField(a,e.size,dn.rpad(t.toString(),e.size," "),offset);break;default:throw new Error("Unknown field type")}})}),a.setUint8(offset,26),a},{enlarge:function(e,t){return t[0]<e.xmin&&(e.xmin=t[0]),t[0]>e.xmax&&(e.xmax=t[0]),t[1]<e.ymin&&(e.ymin=t[1]),t[1]>e.ymax&&(e.ymax=t[1]),e},enlargeExtent:function(e,t){return t.xmax>e.xmax&&(e.xmax=t.xmax),t.xmin<e.xmin&&(e.xmin=t.xmin),t.ymax>e.ymax&&(e.ymax=t.ymax),t.ymin<e.ymin&&(e.ymin=t.ymin),e},blank:function(){return{xmin:Number.MAX_VALUE,ymin:Number.MAX_VALUE,xmax:-Number.MAX_VALUE,ymax:-Number.MAX_VALUE}}}),mn=[],gn=[],yn="undefined"!=typeof Uint8Array?Uint8Array:Array,vn=!1;function _n(){vn=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,r=e.length;t<r;++t)mn[t]=e[t],gn[e.charCodeAt(t)]=t;gn["-".charCodeAt(0)]=62,gn["_".charCodeAt(0)]=63}function xn(e,t,r){for(var n,i=[],o=t;o<r;o+=3)n=(e[o]<<16)+(e[o+1]<<8)+e[o+2],i.push(mn[n>>18&63]+mn[n>>12&63]+mn[n>>6&63]+mn[63&n]);return i.join("")}function bn(e){vn||_n();for(var t,r=e.length,n=r%3,i="",o=[],a=0,s=r-n;a<s;a+=16383)o.push(xn(e,a,s<a+16383?s:a+16383));return 1==n?(t=e[r-1],i=(i+=mn[t>>2])+mn[t<<4&63]+"=="):2==n&&(t=(e[r-2]<<8)+e[r-1],i=(i=(i+=mn[t>>10])+mn[t>>4&63])+mn[t<<2&63]+"="),o.push(i),o.join("")}function wn(e,t,r,n,i){var o,a,s=8*i-n-1,l=(1<<s)-1,u=l>>1,c=-7,h=r?i-1:0,f=r?-1:1,i=e[t+h];for(h+=f,o=i&(1<<-c)-1,i>>=-c,c+=s;0<c;o=256*o+e[t+h],h+=f,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=n;0<c;a=256*a+e[t+h],h+=f,c-=8);if(0===o)o=1-u;else{if(o===l)return a?NaN:1/0*(i?-1:1);a+=Math.pow(2,n),o-=u}return(i?-1:1)*a*Math.pow(2,o-n)}function En(e,t,r,n,i,o){var a,s,l=8*o-i-1,u=(1<<l)-1,c=u>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:o-1,d=n?1:-1,o=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(n=Math.pow(2,-a))<1&&(a--,n*=2),2<=(t+=1<=a+c?h/n:h*Math.pow(2,1-c))*n&&(a++,n/=2),u<=a+c?(s=0,a=u):1<=a+c?(s=(t*n-1)*Math.pow(2,i),a+=c):(s=t*Math.pow(2,c-1)*Math.pow(2,i),a=0));8<=i;e[r+f]=255&s,f+=d,s/=256,i-=8);for(a=a<<i|s,l+=i;0<l;e[r+f]=255&a,f+=d,a/=256,l-=8);e[r+f-d]|=128*o}var Tn={}.toString,Sn=Array.isArray||function(e){return"[object Array]"==Tn.call(e)};function Mn(){return b.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function kn(e,t){if(Mn()<t)throw new RangeError("Invalid typed array length");return b.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=b.prototype:(e=null===e?new b(t):e).length=t,e}function b(e,t,r){if(!(b.TYPED_ARRAY_SUPPORT||this instanceof b))return new b(e,t,r);if("number"!=typeof e)return Cn(this,e,t,r);if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return In(this,e)}function Cn(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer){var i=e,o=t,a=r;if(o.byteLength,a<0||o.byteLength<a)throw new RangeError("'offset' is out of bounds");if(o.byteLength<a+(n||0))throw new RangeError("'length' is out of bounds");return o=void 0===a&&void 0===n?new Uint8Array(o):void 0===n?new Uint8Array(o,a):new Uint8Array(o,a,n),b.TYPED_ARRAY_SUPPORT?(i=o).__proto__=b.prototype:i=Ln(i,o),i}if("string"!=typeof t){a=e,n=t;if(zn(n))return o=0|Pn(n.length),0!==(a=kn(a,o)).length&&n.copy(a,0,0,o),a;if(n){if("undefined"!=typeof ArrayBuffer&&n.buffer instanceof ArrayBuffer||"length"in n)return"number"!=typeof n.length||function(e){return e!=e}(n.length)?kn(a,0):Ln(a,n);if("Buffer"===n.type&&Sn(n.data))return Ln(a,n.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}i=e,n=t,e=r;if(b.isEncoding(e="string"==typeof e&&""!==e?e:"utf8"))return t=0|Dn(n,e),i=(n=(i=kn(i,t)).write(n,e))!==t?i.slice(0,n):i;throw new TypeError('"encoding" must be a valid string encoding')}function An(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function In(e,t){if(An(t),e=kn(e,t<0?0:0|Pn(t)),!b.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function Ln(e,t){var r=t.length<0?0:0|Pn(t.length);e=kn(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function Pn(e){if(e>=Mn())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Mn().toString(16)+" bytes");return 0|e}function zn(e){return null!=e&&e._isBuffer}function Dn(e,t){if(zn(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;var r=(e="string"!=typeof e?""+e:e).length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return Jn(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return Kn(e).length;default:if(n)return Jn(e).length;t=(""+t).toLowerCase(),n=!0}}function On(e,t,r){var n,i=!1;if((t=void 0===t||t<0?0:t)>this.length)return"";if((r=void 0===r||r>this.length?this.length:r)<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e=e||"utf8";;)switch(e){case"hex":var o=this,a=t,s=r,l=o.length;(!s||s<0||l<s)&&(s=l);for(var u="",c=a=!a||a<0?0:a;c<s;++c)u+=function(e){return e<16?"0"+e.toString(16):e.toString(16)}(o[c]);return u;case"utf8":case"utf-8":return Un(this,t,r);case"ascii":var h=this,l=t,f=r,d="";f=Math.min(h.length,f);for(var p=l;p<f;++p)d+=String.fromCharCode(127&h[p]);return d;case"latin1":case"binary":var m=this,a=t,g=r,y="";g=Math.min(m.length,g);for(var v=a;v<g;++v)y+=String.fromCharCode(m[v]);return y;case"base64":return _=this,n=r,0===(x=t)&&n===_.length?bn(_):bn(_.slice(x,n));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":for(var _=t,x=r,b=this.slice(_,x),w="",E=0;E<b.length;E+=2)w+=String.fromCharCode(b[E]+256*b[E+1]);return w;default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function Rn(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function Fn(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):2147483647<r?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,(r=(r=isNaN(r)?i?0:e.length-1:r)<0?e.length+r:r)>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if(zn(t="string"==typeof t?b.from(t,n):t))return 0===t.length?-1:Bn(e,t,r,n,i);if("number"==typeof t)return t&=255,b.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?(i?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(e,t,r):Bn(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function Bn(e,t,r,n,i){var o=1,a=e.length,s=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a/=o=2,s/=2,r/=2}function l(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i)for(var u=-1,c=r;c<a;c++)if(l(e,c)===l(t,-1===u?0:c-u)){if(c-(u=-1===u?c:u)+1===s)return u*o}else-1!==u&&(c-=c-u),u=-1;else for(c=r=a<r+s?a-s:r;0<=c;c--){for(var h=!0,f=0;f<s;f++)if(l(e,c+f)!==l(t,f)){h=!1;break}if(h)return c}return-1}function Nn(e,t,r,n){return Qn(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function jn(e,t,r,n){return Qn(function(e,t){for(var r,n,i=[],o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),n=r>>8,i.push(r%256),i.push(n);return i}(t,e.length-r),e,r,n)}function Un(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,a,s,l,u=e[i],c=null,h=239<u?4:223<u?3:191<u?2:1;if(i+h<=r)switch(h){case 1:u<128&&(c=u);break;case 2:128==(192&(o=e[i+1]))&&127<(l=(31&u)<<6|63&o)&&(c=l);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&2047<(l=(15&u)<<12|(63&o)<<6|63&a)&&(l<55296||57343<l)&&(c=l);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&65535<(l=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)&&l<1114112&&(c=l)}null===c?(c=65533,h=1):65535<c&&(n.push((c-=65536)>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=h}var f=n,d=f.length;if(d<=Vn)return String.fromCharCode.apply(String,f);for(var p="",m=0;m<d;)p+=String.fromCharCode.apply(String,f.slice(m,m+=Vn));return p}b.TYPED_ARRAY_SUPPORT=void 0===Pe.TYPED_ARRAY_SUPPORT||Pe.TYPED_ARRAY_SUPPORT,b.poolSize=8192,b._augment=function(e){return e.__proto__=b.prototype,e},b.from=function(e,t,r){return Cn(null,e,t,r)},b.TYPED_ARRAY_SUPPORT&&(b.prototype.__proto__=Uint8Array.prototype,b.__proto__=Uint8Array),b.alloc=function(e,t,r){return n=null,t=t,r=r,An(e=e),!(e<=0)&&void 0!==t?"string"==typeof r?kn(n,e).fill(t,r):kn(n,e).fill(t):kn(n,e);var n},b.allocUnsafe=function(e){return In(null,e)},b.allocUnsafeSlow=function(e){return In(null,e)},b.isBuffer=function(e){return null!=e&&(!!e._isBuffer||ei(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&ei(e.slice(0,0))}(e))},b.compare=function(e,t){if(!zn(e)||!zn(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},b.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},b.concat=function(e,t){if(!Sn(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return b.alloc(0);if(void 0===t)for(i=t=0;i<e.length;++i)t+=e[i].length;for(var r=b.allocUnsafe(t),n=0,i=0;i<e.length;++i){var o=e[i];if(!zn(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,n),n+=o.length}return r},b.byteLength=Dn,b.prototype._isBuffer=!0,b.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)Rn(this,t,t+1);return this},b.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)Rn(this,t,t+3),Rn(this,t+1,t+2);return this},b.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)Rn(this,t,t+7),Rn(this,t+1,t+6),Rn(this,t+2,t+5),Rn(this,t+3,t+4);return this},b.prototype.toString=function(){var e=0|this.length;return 0==e?"":0===arguments.length?Un(this,0,e):On.apply(this,arguments)},b.prototype.equals=function(e){if(zn(e))return this===e||0===b.compare(this,e);throw new TypeError("Argument must be a Buffer")},b.prototype.inspect=function(){var e="";return 0<this.length&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),50<this.length&&(e+=" ... ")),"<Buffer "+e+">"},b.prototype.compare=function(e,t,r,n,i){if(!zn(e))throw new TypeError("Argument must be a Buffer");if(void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),(t=void 0===t?0:t)<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(i<=n&&r<=t)return 0;if(i<=n)return-1;if(r<=t)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(n>>>=0),a=(r>>>=0)-(t>>>=0),s=Math.min(o,a),l=this.slice(n,i),u=e.slice(t,r),c=0;c<s;++c)if(l[c]!==u[c]){o=l[c],a=u[c];break}return o<a?-1:a<o?1:0},b.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},b.prototype.indexOf=function(e,t,r){return Fn(this,e,t,r,!0)},b.prototype.lastIndexOf=function(e,t,r){return Fn(this,e,t,r,!1)},b.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||i<r)&&(r=i),0<e.length&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n=n||"utf8";for(var o,a,s,l=!1;;)switch(n){case"hex":var u=this,c=e,h=t,f=r,d=(h=Number(h)||0,u.length-h);if((!f||d<(f=Number(f)))&&(f=d),(d=c.length)%2!=0)throw new TypeError("Invalid hex string");d/2<f&&(f=d/2);for(var p=0;p<f;++p){var m=parseInt(c.substr(2*p,2),16);if(isNaN(m))return p;u[h+p]=m}return p;case"utf8":case"utf-8":return d=t,s=r,Qn(Jn(e,(a=this).length-d),a,d,s);case"ascii":return Nn(this,e,t,r);case"latin1":case"binary":return Nn(this,e,t,r);case"base64":return a=this,s=t,o=r,Qn(Kn(e),a,s,o);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return jn(this,e,t,r);default:if(l)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),l=!0}},b.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Vn=4096;function Gn(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(r<e+t)throw new RangeError("Trying to access beyond buffer length")}function Wn(e,t,r,n,i,o){if(!zn(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(i<t||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function Zn(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-r,2);i<o;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function qn(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-r,4);i<o;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function Hn(e,t,r,n){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function $n(e,t,r,n,i){return i||Hn(e,0,r,4),En(e,t,r,n,23,4),r+4}function Xn(e,t,r,n,i){return i||Hn(e,0,r,8),En(e,t,r,n,52,8),r+8}b.prototype.slice=function(e,t){var r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):r<e&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):r<t&&(t=r),t<e&&(t=e),b.TYPED_ARRAY_SUPPORT)(i=this.subarray(e,t)).__proto__=b.prototype;else for(var n=t-e,i=new b(n,void 0),o=0;o<n;++o)i[o]=this[o+e];return i},b.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||Gn(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},b.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||Gn(e,t,this.length);for(var n=this[e+--t],i=1;0<t&&(i*=256);)n+=this[e+--t]*i;return n},b.prototype.readUInt8=function(e,t){return t||Gn(e,1,this.length),this[e]},b.prototype.readUInt16LE=function(e,t){return t||Gn(e,2,this.length),this[e]|this[e+1]<<8},b.prototype.readUInt16BE=function(e,t){return t||Gn(e,2,this.length),this[e]<<8|this[e+1]},b.prototype.readUInt32LE=function(e,t){return t||Gn(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},b.prototype.readUInt32BE=function(e,t){return t||Gn(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},b.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||Gn(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return(i*=128)<=n&&(n-=Math.pow(2,8*t)),n},b.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||Gn(e,t,this.length);for(var n=t,i=1,o=this[e+--n];0<n&&(i*=256);)o+=this[e+--n]*i;return(i*=128)<=o&&(o-=Math.pow(2,8*t)),o},b.prototype.readInt8=function(e,t){return t||Gn(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},b.prototype.readInt16LE=function(e,t){t||Gn(e,2,this.length);t=this[e]|this[e+1]<<8;return 32768&t?4294901760|t:t},b.prototype.readInt16BE=function(e,t){t||Gn(e,2,this.length);t=this[e+1]|this[e]<<8;return 32768&t?4294901760|t:t},b.prototype.readInt32LE=function(e,t){return t||Gn(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},b.prototype.readInt32BE=function(e,t){return t||Gn(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},b.prototype.readFloatLE=function(e,t){return t||Gn(e,4,this.length),wn(this,e,!0,23,4)},b.prototype.readFloatBE=function(e,t){return t||Gn(e,4,this.length),wn(this,e,!1,23,4)},b.prototype.readDoubleLE=function(e,t){return t||Gn(e,8,this.length),wn(this,e,!0,52,8)},b.prototype.readDoubleBE=function(e,t){return t||Gn(e,8,this.length),wn(this,e,!1,52,8)},b.prototype.writeUIntLE=function(e,t,r,n){e=+e,t|=0,r|=0,n||Wn(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},b.prototype.writeUIntBE=function(e,t,r,n){e=+e,t|=0,r|=0,n||Wn(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;0<=--i&&(o*=256);)this[t+i]=e/o&255;return t+r},b.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||Wn(this,e,t,1,255,0),b.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},b.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||Wn(this,e,t,2,65535,0),b.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Zn(this,e,t,!0),t+2},b.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||Wn(this,e,t,2,65535,0),b.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Zn(this,e,t,!1),t+2},b.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||Wn(this,e,t,4,4294967295,0),b.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):qn(this,e,t,!0),t+4},b.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||Wn(this,e,t,4,4294967295,0),b.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):qn(this,e,t,!1),t+4},b.prototype.writeIntLE=function(e,t,r,n){e=+e,t|=0,n||Wn(this,e,t,r,(n=Math.pow(2,8*r-1))-1,-n);var i=0,o=1,a=0;for(this[t]=255&e;++i<r&&(o*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/o>>0)-a&255;return t+r},b.prototype.writeIntBE=function(e,t,r,n){e=+e,t|=0,n||Wn(this,e,t,r,(n=Math.pow(2,8*r-1))-1,-n);var i=r-1,o=1,a=0;for(this[t+i]=255&e;0<=--i&&(o*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/o>>0)-a&255;return t+r},b.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||Wn(this,e,t,1,127,-128),b.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&(e=e<0?255+e+1:e),t+1},b.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||Wn(this,e,t,2,32767,-32768),b.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Zn(this,e,t,!0),t+2},b.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||Wn(this,e,t,2,32767,-32768),b.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Zn(this,e,t,!1),t+2},b.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||Wn(this,e,t,4,2147483647,-2147483648),b.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):qn(this,e,t,!0),t+4},b.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||Wn(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),b.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):qn(this,e,t,!1),t+4},b.prototype.writeFloatLE=function(e,t,r){return $n(this,e,t,!0,r)},b.prototype.writeFloatBE=function(e,t,r){return $n(this,e,t,!1,r)},b.prototype.writeDoubleLE=function(e,t,r){return Xn(this,e,t,!0,r)},b.prototype.writeDoubleBE=function(e,t,r){return Xn(this,e,t,!1,r)},b.prototype.copy=function(e,t,r,n){if(r=r||0,n||0===n||(n=this.length),t>=e.length&&(t=e.length),(n=0<n&&n<r?r:n)===r)return 0;if(0===e.length||0===this.length)return 0;if((t=t||0)<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length);var i,o=(n=e.length-t<n-r?e.length-t+r:n)-r;if(this===e&&r<t&&t<n)for(i=o-1;0<=i;--i)e[i+t]=this[i+r];else if(o<1e3||!b.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+o),t);return o},b.prototype.fill=function(e,t,r,n){if("string"==typeof e){var i;if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1!==e.length||(i=e.charCodeAt(0))<256&&(e=i),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!b.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(!(r<=t))if(t>>>=0,r=void 0===r?this.length:r>>>0,"number"==typeof(e=e||0))for(s=t;s<r;++s)this[s]=e;else for(var o=zn(e)?e:Jn(new b(e,n).toString()),a=o.length,s=0;s<r-t;++s)this[s+t]=o[s%a];return this};var Yn=/[^+\/0-9A-Za-z-_]/g;function Jn(e,t){t=t||1/0;for(var r,n=e.length,i=null,o=[],a=0;a<n;++a){if(55295<(r=e.charCodeAt(a))&&r<57344){if(!i){if(56319<r){-1<(t-=3)&&o.push(239,191,189);continue}if(a+1===n){-1<(t-=3)&&o.push(239,191,189);continue}i=r;continue}if(r<56320){-1<(t-=3)&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&-1<(t-=3)&&o.push(239,191,189);if(i=null,r<128){if(--t<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function Kn(e){var t=function(e){var t;if((e=((t=e).trim?t.trim():t.replace(/^\s+|\s+$/g,"")).replace(Yn,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e);vn||_n();var r,e=t.length;if(0<e%4)throw new Error("Invalid string. Length must be a multiple of 4");for(var n="="===t[e-2]?2:"="===t[e-1]?1:0,i=new yn(3*e/4-n),o=0<n?e-4:e,a=0,s=0;s<o;s+=4)r=gn[t.charCodeAt(s)]<<18|gn[t.charCodeAt(s+1)]<<12|gn[t.charCodeAt(s+2)]<<6|gn[t.charCodeAt(s+3)],i[a++]=r>>16&255,i[a++]=r>>8&255,i[a++]=255&r;return 2==n?(r=gn[t.charCodeAt(s)]<<2|gn[t.charCodeAt(s+1)]>>4,i[a++]=255&r):1==n&&(r=gn[t.charCodeAt(s)]<<10|gn[t.charCodeAt(s+1)]<<4|gn[t.charCodeAt(s+2)]>>2,i[a++]=r>>8&255,i[a++]=255&r),i}function Qn(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function ei(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var p="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;function r(){}r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e},ti=/%[sdj%]/g;function ri(e){if(!vi(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(si(arguments[r]));return t.join(" ")}for(var r=1,n=arguments,i=n.length,o=String(e).replace(ti,function(e){if("%%"===e)return"%";if(i<=r)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),a=n[r];r<i;a=n[++r])mi(a)||!wi(a)?o+=" "+a:o+=" "+si(a);return o}function ni(e,t){var r;return xi(Pe.process)?function(){return ni(e,t).apply(this,arguments)}:!0===$d.noDeprecation?e:(r=!1,function(){if(!r){if($d.throwDeprecation)throw new Error(t);$d.traceDeprecation?console.trace(t):console.error(t),r=!0}return e.apply(this,arguments)})}var ii,oi={};function ai(t){return xi(ii)&&(ii=$d.env.NODE_DEBUG||""),t=t.toUpperCase(),oi[t]||(new RegExp("\\b"+t+"\\b","i").test(ii)?oi[t]=function(){var e=ri.apply(null,arguments);console.error("%s %d: %s",t,0,e)}:oi[t]=function(){}),oi[t]}function si(e,t){var r={seen:[],stylize:ui};return 3<=arguments.length&&(r.depth=arguments[2]),4<=arguments.length&&(r.colors=arguments[3]),pi(t)?r.showHidden=t:t&&Pi(r,t),xi(r.showHidden)&&(r.showHidden=!1),xi(r.depth)&&(r.depth=2),xi(r.colors)&&(r.colors=!1),xi(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=li),ci(r,e,r.depth)}function li(e,t){t=si.styles[t];return t?"["+si.colors[t][0]+"m"+e+"["+si.colors[t][1]+"m":e}function ui(e,t){return e}function ci(t,r,n){if(t.customInspect&&r&&Si(r.inspect)&&r.inspect!==si&&(!r.constructor||r.constructor.prototype!==r))return vi(e=r.inspect(n,t))?e:ci(t,e,n);var e=function(e,t){if(xi(t))return e.stylize("undefined","undefined");{var r;if(vi(t))return r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'",e.stylize(r,"string")}return yi(t)?e.stylize(""+t,"number"):pi(t)?e.stylize(""+t,"boolean"):mi(t)?e.stylize("null","null"):void 0}(t,r);if(e)return e;var i,e=Object.keys(r),o=(i={},e.forEach(function(e,t){i[e]=!0}),i);if(t.showHidden&&(e=Object.getOwnPropertyNames(r)),Ti(r)&&(0<=e.indexOf("message")||0<=e.indexOf("description")))return hi(r);if(0===e.length){if(Si(r))return a=r.name?": "+r.name:"",t.stylize("[Function"+a+"]","special");if(bi(r))return t.stylize(RegExp.prototype.toString.call(r),"regexp");if(Ei(r))return t.stylize(Date.prototype.toString.call(r),"date");if(Ti(r))return hi(r)}var a="",s=!1,l=["{","}"];if(di(r)&&(s=!0,l=["[","]"]),Si(r)&&(a=" [Function"+(r.name?": "+r.name:"")+"]"),bi(r)&&(a=" "+RegExp.prototype.toString.call(r)),Ei(r)&&(a=" "+Date.prototype.toUTCString.call(r)),Ti(r)&&(a=" "+hi(r)),0===e.length&&(!s||0==r.length))return l[0]+a+l[1];if(n<0)return bi(r)?t.stylize(RegExp.prototype.toString.call(r),"regexp"):t.stylize("[Object]","special");t.seen.push(r),u=s?function(t,r,n,i,e){for(var o=[],a=0,s=r.length;a<s;++a)zi(r,String(a))?o.push(fi(t,r,n,i,String(a),!0)):o.push("");return e.forEach(function(e){e.match(/^\d+$/)||o.push(fi(t,r,n,i,e,!0))}),o}(t,r,n,o,e):e.map(function(e){return fi(t,r,n,o,e,s)}),t.seen.pop();var u;return 60<u.reduce(function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)?l[0]+(""===a?"":a+"\n ")+" "+u.join(",\n  ")+" "+l[1]:l[0]+a+" "+u.join(", ")+" "+l[1]}function hi(e){return"["+Error.prototype.toString.call(e)+"]"}function fi(e,t,r,n,i,o){var a,s,t=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]};if(t.get?s=t.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):t.set&&(s=e.stylize("[Setter]","special")),zi(n,i)||(a="["+i+"]"),s||(e.seen.indexOf(t.value)<0?-1<(s=mi(r)?ci(e,t.value,null):ci(e,t.value,r-1)).indexOf("\n")&&(s=o?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),xi(a)){if(o&&i.match(/^\d+$/))return s;a=(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),e.stylize(a,"string"))}return a+": "+s}function di(e){return Array.isArray(e)}function pi(e){return"boolean"==typeof e}function mi(e){return null===e}function gi(e){return null==e}function yi(e){return"number"==typeof e}function vi(e){return"string"==typeof e}function _i(e){return"symbol"==typeof e}function xi(e){return void 0===e}function bi(e){return wi(e)&&"[object RegExp]"===Ci(e)}function wi(e){return"object"==typeof e&&null!==e}function Ei(e){return wi(e)&&"[object Date]"===Ci(e)}function Ti(e){return wi(e)&&("[object Error]"===Ci(e)||e instanceof Error)}function Si(e){return"function"==typeof e}function Mi(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function ki(e){return b.isBuffer(e)}function Ci(e){return Object.prototype.toString.call(e)}function Ai(e){return e<10?"0"+e.toString(10):e.toString(10)}si.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},si.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};var Ii=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Li(){var e,t;console.log("%s - %s",(e=new Date,t=[Ai(e.getHours()),Ai(e.getMinutes()),Ai(e.getSeconds())].join(":"),[e.getDate(),Ii[e.getMonth()],t].join(" ")),ri.apply(null,arguments))}function Pi(e,t){if(t&&wi(t))for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}function zi(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var m=Object.freeze({__proto__:null,format:ri,deprecate:ni,debuglog:ai,inspect:si,isArray:di,isBoolean:pi,isNull:mi,isNullOrUndefined:gi,isNumber:yi,isString:vi,isSymbol:_i,isUndefined:xi,isRegExp:bi,isObject:wi,isDate:Ei,isError:Ti,isFunction:Si,isPrimitive:Mi,isBuffer:ki,log:Li,inherits:p,_extend:Pi,default:{inherits:p,_extend:Pi,log:Li,isBuffer:ki,isPrimitive:Mi,isFunction:Si,isError:Ti,isDate:Ei,isObject:wi,isRegExp:bi,isUndefined:xi,isSymbol:_i,isString:vi,isNumber:yi,isNullOrUndefined:gi,isNull:mi,isBoolean:pi,isArray:di,inspect:si,deprecate:ni,format:ri,debuglog:ai}}),g={},Di=d,u=(g.write=function(e,t,r,n){var i=100,o=0,a=0;e.forEach(function(e,t){r.setInt32(o,t),r.setInt32(o+4,10),r.setInt32(o+8,1,!0),r.setFloat64(o+12,e[0],!0),r.setFloat64(o+20,e[1],!0),n.setInt32(a,i/2),n.setInt32(a+4,10),a+=8,o+=28,i+=28})},g.extent=function(e){return e.reduce(function(e,t){return Di.enlarge(e,t)},Di.blank())},g.parts=function(e,t){return e.length},g.shxLength=function(e){return 8*e.length},g.shpLength=function(e){return 28*e.length},{}),Oi=d,Ri=l;function Fi(e,t){var r=1;return r=t!==Ri.geometries.POLYGON&&t!==Ri.geometries.POLYLINE?r:e.reduce(function(e,t){return e+=t.length,Array.isArray(t[0][0][0])&&(e+=t.reduce(function(e,t){return e+t.length-1},0)),e},0)}function Bi(e,t){return void 0===t&&(t=[]),"object"==typeof e[0][0]?e.reduce(function(e,t){return e.concat(Bi(t))},t):e}u.write=function(e,t,l,u,c){var h=0,f=0,d=100;e.forEach(function(e,t){for(var r=Bi(e),n=Fi([e],c),i=16*r.length+48+4*(n-1),o=r.reduce(function(e,t){return Oi.enlarge(e,t)},Oi.blank()),a=(u.setInt32(f,d/2),u.setInt32(f+4,i/2),f+=8,d+=8+i,l.setInt32(h,t+1),l.setInt32(h+4,i/2),l.setInt32(h+8,c,!0),l.setFloat64(h+12,o.xmin,!0),l.setFloat64(h+20,o.ymin,!0),l.setFloat64(h+28,o.xmax,!0),l.setFloat64(h+36,o.ymax,!0),l.setInt32(h+44,n,!0),l.setInt32(h+48,r.length,!0),l.setInt32(h+52,0,!0),e.reduce(function(e,t){return Array.isArray(t[0][0])?e=e.concat(t):e.push(t),e},[])),s=1;s<n;s++)l.setInt32(h+52+4*s,a.reduce(function(e,t,r){return r<s?e+t.length:e},0),!0);r.forEach(function(e,t){l.setFloat64(h+56+16*t+4*(n-1),e[0],!0),l.setFloat64(h+56+16*t+4*(n-1)+8,e[1],!0)}),h+=8+i})},u.shpLength=function(e){return 56*e.length+16*Bi(e).length},u.shxLength=function(e){return 8*e.length},u.extent=function(e){return Bi(e).reduce(function(e,t){return Oi.enlarge(e,t)},Oi.blank())},u.parts=Fi;function Ni(e,t,r,n){var t=ji.geometries[t],i=100+4*((c=Vi[t]).parts(r,t)-r.length)+c.shpLength(r),o=100+c.shxLength(r),a=new ArrayBuffer(i),s=new DataView(a),o=new ArrayBuffer(o),l=new DataView(o),u=c.extent(r),c=(Gi(s,t),Gi(l,t),Wi(u,s),Wi(u,l),c.write(r,u,new DataView(a,100),new DataView(o,100),t),s.setInt32(24,i/2),l.setInt32(24,50+4*r.length),Ui.structure(e));n(null,{shp:s,shx:l,dbf:c,prj:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137,298.257223563]],PRIMEM["Greenwich",0],UNIT["Degree",0.017453292519943295]]'})}var ji=l,Ui=h,Vi={1:g,5:u,3:u};function Gi(e,t){e.setInt32(0,9994),e.setInt32(28,1e3,!0),e.setInt32(32,t,!0)}function Wi(e,t){t.setFloat64(36,e.xmin,!0),t.setFloat64(44,e.ymin,!0),t.setFloat64(52,e.xmax,!0),t.setFloat64(60,e.ymax,!0)}c={};function Zi(r,n){return function(e){var t,e=e.features.filter((t=r,function(e){return e.geometry.type===t}));return{geometries:"POLYGON"===n||"POLYLINE"===n?[e.map(qi)]:e.map(qi),properties:e.map(Hi),type:n}}}function qi(e){return void 0!==e.geometry.coordinates[0]&&void 0!==e.geometry.coordinates[0][0]&&void 0!==e.geometry.coordinates[0][0][0]?e.geometry.coordinates[0]:e.geometry.coordinates}function Hi(e){return e.properties}c.point=Zi("Point","POINT"),c.line=Zi("LineString","POLYLINE"),c.polygon=Zi("Polygon","POLYGON");var y={},$i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s=(y.encode=function(e,t){for(var r,n,i,o,a,s,l="",u=0;u<e.length;)i=(r=e.charCodeAt(u++))>>2,o=(3&r)<<4|(r=e.charCodeAt(u++))>>4,a=(15&r)<<2|(n=e.charCodeAt(u++))>>6,s=63&n,isNaN(r)?a=s=64:isNaN(n)&&(s=64),l=l+$i.charAt(i)+$i.charAt(o)+$i.charAt(a)+$i.charAt(s);return l},y.decode=function(e,t){var r,n,i,o,a,s,l="",u=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");u<e.length;)i=$i.indexOf(e.charAt(u++)),r=(15&(o=$i.indexOf(e.charAt(u++))))<<4|(a=$i.indexOf(e.charAt(u++)))>>2,n=(3&a)<<6|(s=$i.indexOf(e.charAt(u++))),l+=String.fromCharCode(i<<2|o>>4),64!=a&&(l+=String.fromCharCode(r)),64!=s&&(l+=String.fromCharCode(n));return l},{});if(s.base64=!0,s.array=!0,s.string=!0,s.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,s.nodebuffer=void 0!==b,s.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)s.blob=!1;else{v=new ArrayBuffer(0);try{s.blob=0===new Blob([v],{type:"application/zip"}).size}catch(e){try{var Xi=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);Xi.append(v),s.blob=0===Xi.getBlob("application/zip").size}catch(e){s.blob=!1}}}var Yi,a={},Ji={},Ki={},Qi={};function eo(){var t,e,r,n;return Yi||(Yi=1,t=Qi,e="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array,t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])}}return e},t.shrinkBuf=function(e,t){if(e.length!==t){if(e.subarray)return e.subarray(0,t);e.length=t}return e},r={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var o=0;o<n;o++)e[i+o]=t[r+o]},flattenChunks:function(e){for(var t,r,n,i=0,o=0,a=e.length;o<a;o++)i+=e[o].length;for(n=new Uint8Array(i),o=t=0,a=e.length;o<a;o++)r=e[o],n.set(r,t),t+=r.length;return n}},n={arraySet:function(e,t,r,n,i){for(var o=0;o<n;o++)e[i+o]=t[r+o]},flattenChunks:function(e){return[].concat.apply([],e)}},t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,r)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,n))},t.setTyped(e)),Qi}var to,ro,no,io,oo,ao,so,lo,uo={},co={},ho={};function fo(){var i,c,h,s,f,l,u,d,S,M,n,p,m,g,y,v,_,x,b,w,E,T,k,C,A,I,L,N,j,P;return to||(to=1,i=eo(),u=30,d=19,S=2*(l=(f=256)+(h=1)+(s=29))+1,m=256,_=[c=0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],x=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,p=7,7,8,8,9,9,10,10,11,11,12,12,13,13],b=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],w=[g=n=16,y=17,v=18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,M=15],e(E=new Array(2*(l+2))),e(T=new Array(2*u)),e(k=new Array(512)),e(C=new Array(256)),e(A=new Array(s)),e(I=new Array(u)),P=!1,ho._tr_init=function(e){if(!P){for(var t,r,n,i=new Array(M+1),o=0,a=0;a<s-1;a++)for(A[a]=o,t=0;t<1<<_[a];t++)C[o++]=a;for(C[o-1]=a,a=n=0;a<16;a++)for(I[a]=n,t=0;t<1<<x[a];t++)k[n++]=a;for(n>>=7;a<u;a++)for(I[a]=n<<7,t=0;t<1<<x[a]-7;t++)k[256+n++]=a;for(r=0;r<=M;r++)i[r]=0;for(t=0;t<=143;)E[2*t+1]=8,t++,i[8]++;for(;t<=255;)E[2*t+1]=9,t++,i[9]++;for(;t<=279;)E[2*t+1]=7,t++,i[7]++;for(;t<=287;)E[2*t+1]=8,t++,i[8]++;for(G(E,l+1,i),t=0;t<u;t++)T[2*t+1]=5,T[2*t]=V(t,5);L=new z(E,_,f+1,l,M),N=new z(T,x,0,u,M),j=new z(new Array(0),b,0,d,p),P=!0}e.l_desc=new D(e.dyn_ltree,L),e.d_desc=new D(e.dyn_dtree,N),e.bl_desc=new D(e.bl_tree,j),e.bi_buf=0,e.bi_valid=0,W(e)},ho._tr_stored_block=X,ho._tr_flush_block=function(e,t,r,n){var i,o,a=0;if(0<e.level?(2===e.strm.data_type&&(e.strm.data_type=function(e){for(var t=4093624447,r=0;r<=31;r++,t>>>=1)if(1&t&&0!==e.dyn_ltree[2*r])return c;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return h;for(r=32;r<f;r++)if(0!==e.dyn_ltree[2*r])return h;return c}(e)),B(e,e.l_desc),B(e,e.d_desc),a=function(e){var t;for(H(e,e.dyn_ltree,e.l_desc.max_code),H(e,e.dyn_dtree,e.d_desc.max_code),B(e,e.bl_desc),t=d-1;3<=t&&0===e.bl_tree[2*w[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=i&&(i=o)):i=o=r+5,r+4<=i&&-1!==t)X(e,t,r,n);else if(4===e.strategy||o===i)O(e,2+(n?1:0),3),q(e,E,T);else{O(e,4+(n?1:0),3);var s,l=e,t=e.l_desc.max_code+1,r=e.d_desc.max_code+1,u=a+1;for(O(l,t-257,5),O(l,r-1,5),O(l,u-4,4),s=0;s<u;s++)O(l,l.bl_tree[2*w[s]+1],3);$(l,l.dyn_ltree,t-1),$(l,l.dyn_dtree,r-1),q(e,e.dyn_ltree,e.dyn_dtree)}W(e),n&&Z(e)},ho._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(C[r]+f+1)]++,e.dyn_dtree[2*U(t)]++),e.last_lit===e.lit_bufsize-1},ho._tr_align=function(e){O(e,2,3),R(e,m,E),16===(e=e).bi_valid?(o(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}),ho;function e(e){for(var t=e.length;0<=--t;)e[t]=0}function z(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function D(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function U(e){return e<256?k[e]:k[256+(e>>>7)]}function o(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function O(e,t,r){e.bi_valid>n-r?(e.bi_buf|=t<<e.bi_valid&65535,o(e,e.bi_buf),e.bi_buf=t>>n-e.bi_valid,e.bi_valid+=r-n):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function R(e,t,r){O(e,r[2*t],r[2*t+1])}function V(e,t){for(var r=0;r|=1&e,e>>>=1,r<<=1,0<--t;);return r>>>1}function G(e,t,r){for(var n,i=new Array(M+1),o=0,a=1;a<=M;a++)i[a]=o=o+r[a-1]<<1;for(n=0;n<=t;n++){var s=e[2*n+1];0!==s&&(e[2*n]=V(i[s]++,s))}}function W(e){for(var t=0;t<l;t++)e.dyn_ltree[2*t]=0;for(t=0;t<u;t++)e.dyn_dtree[2*t]=0;for(t=0;t<d;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*m]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function Z(e){8<e.bi_valid?o(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function a(e,t,r,n){var i=2*t,o=2*r;return e[i]<e[o]||e[i]===e[o]&&n[t]<=n[r]}function F(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&a(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!a(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function q(e,t,r){var n,i,o,a,s=0;if(0!==e.last_lit)for(;n=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],i=e.pending_buf[e.l_buf+s],s++,0==n?R(e,i,t):(R(e,(o=C[i])+f+1,t),0!==(a=_[o])&&O(e,i-=A[o],a),R(e,o=U(--n),r),0!==(a=x[o])&&O(e,n-=I[o],a)),s<e.last_lit;);R(e,m,t)}function B(e,t){var r,n,i,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=S,r=0;r<l;r++)0!==o[2*r]?(e.heap[++e.heap_len]=u=r,e.depth[r]=0):o[2*r+1]=0;for(;e.heap_len<2;)o[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=a[2*i+1]);for(t.max_code=u,r=e.heap_len>>1;1<=r;r--)F(e,o,r);for(i=l;r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],F(e,o,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,o[2*i]=o[2*r]+o[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,o[2*r+1]=o[2*n+1]=i,e.heap[1]=i++,F(e,o,1),2<=e.heap_len;);e.heap[--e.heap_max]=e.heap[1];for(var c,h,f,d,p,m=e,g=t.dyn_tree,y=t.max_code,v=t.stat_desc.static_tree,_=t.stat_desc.has_stree,x=t.stat_desc.extra_bits,b=t.stat_desc.extra_base,w=t.stat_desc.max_length,E=0,T=0;T<=M;T++)m.bl_count[T]=0;for(g[2*m.heap[m.heap_max]+1]=0,c=m.heap_max+1;c<S;c++)w<(T=g[2*g[2*(h=m.heap[c])+1]+1]+1)&&(T=w,E++),g[2*h+1]=T,y<h||(m.bl_count[T]++,d=0,b<=h&&(d=x[h-b]),p=g[2*h],m.opt_len+=p*(T+d),_&&(m.static_len+=p*(v[2*h+1]+d)));if(0!==E){do{for(T=w-1;0===m.bl_count[T];)T--}while(m.bl_count[T]--,m.bl_count[T+1]+=2,m.bl_count[w]--,0<(E-=2));for(T=w;0!==T;T--)for(h=m.bl_count[T];0!==h;)y<(f=m.heap[--c])||(g[2*f+1]!==T&&(m.opt_len+=(T-g[2*f+1])*g[2*f],g[2*f+1]=T),h--)}G(o,u,e.bl_count)}function H(e,t,r){var n,i,o=-1,a=t[1],s=0,l=7,u=4;for(0===a&&(l=138,u=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=a,a=t[2*(n+1)+1],++s<l&&i===a||(s<u?e.bl_tree[2*i]+=s:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[2*g]++):s<=10?e.bl_tree[2*y]++:e.bl_tree[2*v]++,o=i,u=(s=0)===a?(l=138,3):i===a?(l=6,3):(l=7,4))}function $(e,t,r){var n,i,o=-1,a=t[1],s=0,l=7,u=4;for(0===a&&(l=138,u=3),n=0;n<=r;n++)if(i=a,a=t[2*(n+1)+1],!(++s<l&&i===a)){if(s<u)for(;R(e,i,e.bl_tree),0!=--s;);else 0!==i?(i!==o&&(R(e,i,e.bl_tree),s--),R(e,g,e.bl_tree),O(e,s-3,2)):s<=10?(R(e,y,e.bl_tree),O(e,s-3,3)):(R(e,v,e.bl_tree),O(e,s-11,7));o=i,u=(s=0)===a?(l=138,3):i===a?(l=6,3):(l=7,4)}}function X(e,t,r,n){O(e,0+(n?1:0),3),n=t,t=r,r=!0,Z(e=e),r&&(o(e,t),o(e,~t)),i.arraySet(e.pending_buf,e.window,n,t,e.pending),e.pending+=t}}function po(){return no||(no=1,ro=function(e,t,r,n){for(var i=65535&e|0,o=e>>>16&65535|0,a=0;0!==r;){for(r-=a=2e3<r?2e3:r;o=o+(i=i+t[n++]|0)|0,--a;);i%=65521,o%=65521}return i|o<<16|0}),ro}function mo(){var s;return oo||(oo=1,s=function(){for(var e=[],t=0;t<256;t++){for(var r=t,n=0;n<8;n++)r=1&r?3988292384^r>>>1:r>>>1;e[t]=r}return e}(),io=function(e,t,r,n){var i=s,o=n+r;e^=-1;for(var a=n;a<o;a++)e=e>>>8^i[255&(e^t[a])];return-1^e}),io}function go(){return so||(so=1,ao={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}),ao}function yo(){var h,s,f,d,r,l,u,c,p,m,g,n,y,v,e,t,R,F,B,_,x,b,w,E,T,S,M,k,C;return lo||(lo=1,h=eo(),s=fo(),f=po(),d=mo(),r=go(),p=-2,0,0,m=-1,v=9,y=8,t=30,R=19,F=(n=2)*(e=286)+1,B=15,b=(x=258)+(_=3)+1,w=42,E=113,T=1,S=2,k=g=u=4,M=3,C=[new a(c=l=0,0,0,0,function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(O(e),0===e.lookahead&&t===l)return T;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,P(e,!1),0===e.strm.avail_out))return T;if(e.strstart-e.block_start>=e.w_size-b&&(P(e,!1),0===e.strm.avail_out))return T}return e.insert=0,t===u?(P(e,!0),0===e.strm.avail_out?M:k):(e.strstart>e.block_start&&(P(e,!1),e.strm.avail_out),T)}),new a(4,4,8,4,i),new a(4,5,16,8,i),new a(4,6,32,32,i),new a(4,4,16,16,o),new a(8,16,32,32,o),new a(8,16,128,128,o),new a(8,32,128,256,o),new a(32,128,258,1024,o),new a(32,258,258,4096,o)],co.deflateInit=function(e,t){return W(e,t,y,15,8,0)},co.deflateInit2=W,co.deflateReset=G,co.deflateResetKeep=V,co.deflateSetHeader=function(e,t){return!e||!e.state||2!==e.state.wrap?p:(e.state.gzhead=t,c)},co.deflate=function(e,t){var r,n,i,o;if(!e||!e.state||5<t||t<0)return e?A(e,p):p;if(n=e.state,!e.output||!e.input&&0!==e.avail_in||666===n.status&&t!==u)return A(e,0===e.avail_out?-5:p);if(n.strm=e,r=n.last_flush,n.last_flush=t,n.status===w&&(2===n.wrap?(e.adler=0,z(n,31),z(n,139),z(n,8),n.gzhead?(z(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),z(n,255&n.gzhead.time),z(n,n.gzhead.time>>8&255),z(n,n.gzhead.time>>16&255),z(n,n.gzhead.time>>24&255),z(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),z(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(z(n,255&n.gzhead.extra.length),z(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=d(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(z(n,0),z(n,0),z(n,0),z(n,0),z(n,0),z(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),z(n,3),n.status=E)):(a=y+(n.w_bits-8<<4)<<8,a|=(2<=n.strategy||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(a|=32),a+=31-a%31,n.status=E,D(n,a),0!==n.strstart&&(D(n,e.adler>>>16),D(n,65535&e.adler)),e.adler=1)),69===n.status)if(n.gzhead.extra){for(i=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>i&&(e.adler=d(e.adler,n.pending_buf,n.pending-i,i)),L(e),i=n.pending,n.pending!==n.pending_buf_size));)z(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>i&&(e.adler=d(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=d(e.adler,n.pending_buf,n.pending-i,i)),L(e),i=n.pending,n.pending===n.pending_buf_size)){o=1;break}}while(o=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,z(n,o),0!==o);n.gzhead.hcrc&&n.pending>i&&(e.adler=d(e.adler,n.pending_buf,n.pending-i,i)),0===o&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=d(e.adler,n.pending_buf,n.pending-i,i)),L(e),i=n.pending,n.pending===n.pending_buf_size)){o=1;break}}while(o=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,z(n,o),0!==o);n.gzhead.hcrc&&n.pending>i&&(e.adler=d(e.adler,n.pending_buf,n.pending-i,i)),0===o&&(n.status=103)}else n.status=103;if(103===n.status&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&L(e),n.pending+2<=n.pending_buf_size&&(z(n,255&e.adler),z(n,e.adler>>8&255),e.adler=0,n.status=E)):n.status=E),0!==n.pending){if(L(e),0===e.avail_out)return n.last_flush=-1,c}else if(0===e.avail_in&&N(t)<=N(r)&&t!==u)return A(e,-5);if(666===n.status&&0!==e.avail_in)return A(e,-5);if(0!==e.avail_in||0!==n.lookahead||t!==l&&666!==n.status){var a=2===n.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(O(e),0===e.lookahead)){if(t===l)return T;break}if(e.match_length=0,r=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(P(e,!1),0===e.strm.avail_out))return T}return e.insert=0,t===u?(P(e,!0),0===e.strm.avail_out?M:k):e.last_lit&&(P(e,!1),0===e.strm.avail_out)?T:S}(n,t):3===n.strategy?function(e,t){for(var r,n,i,o,a=e.window;;){if(e.lookahead<=x){if(O(e),e.lookahead<=x&&t===l)return T;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=_&&0<e.strstart&&(n=a[i=e.strstart-1])===a[++i]&&n===a[++i]&&n===a[++i]){for(o=e.strstart+x;n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&i<o;);e.match_length=x-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=_?(r=s._tr_tally(e,1,e.match_length-_),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(P(e,!1),0===e.strm.avail_out))return T}return e.insert=0,t===u?(P(e,!0),0===e.strm.avail_out?M:k):e.last_lit&&(P(e,!1),0===e.strm.avail_out)?T:S}(n,t):C[n.level].func(n,t);if(a!==M&&a!==k||(n.status=666),a===T||a===M)return 0===e.avail_out&&(n.last_flush=-1),c;if(a===S&&(1===t?s._tr_align(n):5!==t&&(s._tr_stored_block(n,0,0,!1),3===t&&(I(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),L(e),0===e.avail_out))return n.last_flush=-1,c}return t!==u||!(n.wrap<=0)&&(2===n.wrap?(z(n,255&e.adler),z(n,e.adler>>8&255),z(n,e.adler>>16&255),z(n,e.adler>>24&255),z(n,255&e.total_in),z(n,e.total_in>>8&255),z(n,e.total_in>>16&255),z(n,e.total_in>>24&255)):(D(n,e.adler>>>16),D(n,65535&e.adler)),L(e),0<n.wrap&&(n.wrap=-n.wrap),0!==n.pending)?c:1},co.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==w&&69!==t&&73!==t&&91!==t&&103!==t&&t!==E&&666!==t?A(e,p):(e.state=null,t===E?A(e,-3):c):p},co.deflateSetDictionary=function(e,t){var r,n,i,o,a,s,l,u=t.length;if(!e||!e.state)return p;if(2===(o=(r=e.state).wrap)||1===o&&r.status!==w||r.lookahead)return p;for(1===o&&(e.adler=f(e.adler,t,u,0)),r.wrap=0,u>=r.w_size&&(0===o&&(I(r.head),r.strstart=0,r.block_start=0,r.insert=0),l=new h.Buf8(r.w_size),h.arraySet(l,t,u-r.w_size,r.w_size,0),t=l,u=r.w_size),l=e.avail_in,a=e.next_in,s=e.input,e.avail_in=u,e.next_in=0,e.input=t,O(r);r.lookahead>=_;){for(n=r.strstart,i=r.lookahead-(_-1);r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+_-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++,--i;);r.strstart=n,r.lookahead=_-1,O(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=_-1,r.match_available=0,e.next_in=a,e.input=s,e.avail_in=l,r.wrap=o,c},co.deflateInfo="pako deflate (from Nodeca project)"),co;function A(e,t){return e.msg=r[t],t}function N(e){return(e<<1)-(4<e?9:0)}function I(e){for(var t=e.length;0<=--t;)e[t]=0}function L(e){var t=e.state,r=t.pending;0!==(r=r>e.avail_out?e.avail_out:r)&&(h.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function P(e,t){s._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,L(e.strm)}function z(e,t){e.pending_buf[e.pending++]=t}function D(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function j(e,t){var r,n,i=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-b?e.strstart-(e.w_size-b):0,u=e.window,c=e.w_mask,h=e.prev,f=e.strstart+x,d=u[o+a-1],p=u[o+a];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(u[(r=t)+a]===p&&u[r+a-1]===d&&u[r]===u[o]&&u[++r]===u[o+1]){for(o+=2,r++;u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&o<f;);if(n=x-(f-o),o=f-x,a<n){if(e.match_start=t,s<=(a=n))break;d=u[o+a-1],p=u[o+a]}}}while((t=h[t&c])>l&&0!=--i);return a<=e.lookahead?a:e.lookahead}function O(e){var t,r,n,i,o,a,s,l,u,c=e.w_size;do{if(l=e.window_size-e.lookahead-e.strstart,e.strstart>=c+(c-b)){for(h.arraySet(e.window,e.window,c,c,0),e.match_start-=c,e.strstart-=c,e.block_start-=c,t=r=e.hash_size;n=e.head[--t],e.head[t]=c<=n?n-c:0,--r;);for(t=r=c;n=e.prev[--t],e.prev[t]=c<=n?n-c:0,--r;);l+=c}if(0===e.strm.avail_in)break;if(o=e.strm,a=e.window,s=e.strstart+e.lookahead,l=l,u=void 0,u=o.avail_in,r=0===(u=l<u?l:u)?0:(o.avail_in-=u,h.arraySet(a,o.input,o.next_in,u,s),1===o.state.wrap?o.adler=f(o.adler,a,u,s):2===o.state.wrap&&(o.adler=d(o.adler,a,u,s)),o.next_in+=u,o.total_in+=u,u),e.lookahead+=r,e.lookahead+e.insert>=_)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=(e.ins_h<<e.hash_shift^e.window[i+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[i+_-1])&e.hash_mask,e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<_)););}while(e.lookahead<b&&0!==e.strm.avail_in)}function i(e,t){for(var r,n;;){if(e.lookahead<b){if(O(e),e.lookahead<b&&t===l)return T;if(0===e.lookahead)break}if(r=0,e.lookahead>=_&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+_-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-b&&(e.match_length=j(e,r)),e.match_length>=_)if(n=s._tr_tally(e,e.strstart-e.match_start,e.match_length-_),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=_){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+_-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,0!=--e.match_length;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(P(e,!1),0===e.strm.avail_out))return T}return e.insert=e.strstart<_-1?e.strstart:_-1,t===u?(P(e,!0),0===e.strm.avail_out?M:k):e.last_lit&&(P(e,!1),0===e.strm.avail_out)?T:S}function o(e,t){for(var r,n,i;;){if(e.lookahead<b){if(O(e),e.lookahead<b&&t===l)return T;if(0===e.lookahead)break}if(r=0,e.lookahead>=_&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+_-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=_-1,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-b&&(e.match_length=j(e,r),e.match_length<=5&&(1===e.strategy||e.match_length===_&&4096<e.strstart-e.match_start)&&(e.match_length=_-1)),e.prev_length>=_&&e.match_length<=e.prev_length){for(i=e.strstart+e.lookahead-_,n=s._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-_),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+_-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!=--e.prev_length;);if(e.match_available=0,e.match_length=_-1,e.strstart++,n&&(P(e,!1),0===e.strm.avail_out))return T}else if(e.match_available){if((n=s._tr_tally(e,0,e.window[e.strstart-1]))&&P(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return T}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=s._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<_-1?e.strstart:_-1,t===u?(P(e,!0),0===e.strm.avail_out?M:k):e.last_lit&&(P(e,!1),0===e.strm.avail_out)?T:S}function a(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}function U(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new h.Buf16(2*F),this.dyn_dtree=new h.Buf16(2*(2*t+1)),this.bl_tree=new h.Buf16(2*(2*R+1)),I(this.dyn_ltree),I(this.dyn_dtree),I(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new h.Buf16(B+1),this.heap=new h.Buf16(2*e+1),I(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new h.Buf16(2*e+1),I(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function V(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=n,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?w:E,e.adler=2===t.wrap?0:1,t.last_flush=l,s._tr_init(t),c):A(e,p)}function G(e){var t=V(e);return t===c&&((e=e.state).window_size=2*e.w_size,I(e.head),e.max_lazy_match=C[e.level].max_lazy,e.good_match=C[e.level].good_length,e.nice_match=C[e.level].nice_length,e.max_chain_length=C[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=_-1,e.match_available=0,e.ins_h=0),t}function W(e,t,r,n,i,o){if(!e)return p;var a=1;if(t===m&&(t=6),n<0?(a=0,n=-n):15<n&&(a=2,n-=16),i<1||v<i||r!==y||n<8||15<n||t<0||9<t||o<0||g<o)return A(e,p);8===n&&(n=9);var s=new U;return(e.state=s).strm=e,s.wrap=a,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+_-1)/_),s.window=new h.Buf8(2*s.w_size),s.head=new h.Buf16(s.hash_size),s.prev=new h.Buf16(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new h.Buf8(s.pending_buf_size),s.d_buf=+s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=o,s.method=r,G(e)}}var vo,_o,xo,bo,wo={};function Eo(){if(!vo){vo=1;var l=eo(),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var u=new l.Buf8(256),e=0;e<256;e++)u[e]=252<=e?6:248<=e?5:240<=e?4:224<=e?3:192<=e?2:1;u[254]=u[254]=1,wo.string2buf=function(e){for(var t,r,n,i,o=e.length,a=0,s=0;s<o;s++)55296==(64512&(r=e.charCodeAt(s)))&&s+1<o&&56320==(64512&(n=e.charCodeAt(s+1)))&&(r=65536+(r-55296<<10)+(n-56320),s++),a+=r<128?1:r<2048?2:r<65536?3:4;for(t=new l.Buf8(a),s=i=0;i<a;s++)55296==(64512&(r=e.charCodeAt(s)))&&s+1<o&&56320==(64512&(n=e.charCodeAt(s+1)))&&(r=65536+(r-55296<<10)+(n-56320),s++),r<128?t[i++]=r:(r<2048?t[i++]=192|r>>>6:(r<65536?t[i++]=224|r>>>12:(t[i++]=240|r>>>18,t[i++]=128|r>>>12&63),t[i++]=128|r>>>6&63),t[i++]=128|63&r);return t},wo.buf2binstring=function(e){return c(e,e.length)},wo.binstring2buf=function(e){for(var t=new l.Buf8(e.length),r=0,n=t.length;r<n;r++)t[r]=e.charCodeAt(r);return t},wo.buf2string=function(e,t){for(var r,n,i=t||e.length,o=new Array(2*i),a=0,s=0;s<i;)if((r=e[s++])<128)o[a++]=r;else if(4<(n=u[r]))o[a++]=65533,s+=n-1;else{for(r&=2===n?31:3===n?15:7;1<n&&s<i;)r=r<<6|63&e[s++],n--;1<n?o[a++]=65533:r<65536?o[a++]=r:(r-=65536,o[a++]=55296|r>>10&1023,o[a++]=56320|1023&r)}return c(o,a)},wo.utf8border=function(e,t){for(var r=(t=(t=t||e.length)>e.length?e.length:t)-1;0<=r&&128==(192&e[r]);)r--;return!(r<0)&&0!==r&&r+u[e[r]]>t?r:t}}return wo;function c(e,t){if(t<65537&&(e.subarray&&o||!e.subarray&&i))return String.fromCharCode.apply(null,l.shrinkBuf(e,t));for(var r="",n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r}}function To(){return xo||(xo=1,_o=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}),_o}function So(){var a,s,l,r,n,u;return bo||(bo=1,a=yo(),s=eo(),l=Eo(),r=go(),n=To(),u=Object.prototype.toString,0,0,i.prototype.push=function(e,t){var r,n,i=this.strm,o=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:!0===t?4:0,"string"==typeof e?i.input=l.string2buf(e):"[object ArrayBuffer]"===u.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new s.Buf8(o),i.next_out=0,i.avail_out=o),1!==(r=a.deflate(i,n))&&0!==r)return this.onEnd(r),!(this.ended=!0)}while(0!==i.avail_out&&(0!==i.avail_in||4!==n&&2!==n)||("string"===this.options.to?this.onData(l.buf2binstring(s.shrinkBuf(i.output,i.next_out))):this.onData(s.shrinkBuf(i.output,i.next_out))),(0<i.avail_in||0===i.avail_out)&&1!==r);return 4===n?(r=a.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,0===r):2!==n||(this.onEnd(0),!(i.avail_out=0))},i.prototype.onData=function(e){this.chunks.push(e)},i.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},uo.Deflate=i,uo.deflate=o,uo.deflateRaw=function(e,t){return(t=t||{}).raw=!0,o(e,t)},uo.gzip=function(e,t){return(t=t||{}).gzip=!0,o(e,t)}),uo;function i(e){if(!(this instanceof i))return new i(e);this.options=s.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});e=this.options;if(e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new n,(this.strm.avail_out=0)!==(t=a.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy)))throw new Error(r[t]);if(e.header&&a.deflateSetHeader(this.strm,e.header),e.dictionary){var t,e="string"==typeof e.dictionary?l.string2buf(e.dictionary):"[object ArrayBuffer]"===u.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary;if(0!==(t=a.deflateSetDictionary(this.strm,e)))throw new Error(r[t]);this._dict_set=!0}}function o(e,t){t=new i(t);if(t.push(e,!0),t.err)throw t.msg;return t.result}}var Mo,ko,Co,Ao,Io,Lo,Po,zo,Do,Oo,Ro,Fo,Bo,No,jo={},Uo={};function Vo(){var L,P,z,D,k,C,O,R,F,B,N,j,U,V,G,W,Z,q,H,$,X,Y,J,r,n,K,Q,ee;return Io||(Io=1,L=eo(),P=po(),z=mo(),ko||(ko=1,k=30,C=12,Mo=function(e,t){var r,n,i,o,a,s,l=e.state,u=e.next_in,c=e.input,h=u+(e.avail_in-5),f=e.next_out,d=e.output,p=f-(t-e.avail_out),m=f+(e.avail_out-257),g=l.dmax,y=l.wsize,v=l.whave,_=l.wnext,x=l.window,b=l.hold,w=l.bits,E=l.lencode,T=l.distcode,S=(1<<l.lenbits)-1,M=(1<<l.distbits)-1;e:do{for(w<15&&(b+=c[u++]<<w,w+=8,b+=c[u++]<<w,w+=8),r=E[b&S];;){if(b>>>=n=r>>>24,w-=n,0===(n=r>>>16&255))d[f++]=65535&r;else{if(!(16&n)){if(0==(64&n)){r=E[(65535&r)+(b&(1<<n)-1)];continue}if(32&n){l.mode=C;break e}e.msg="invalid literal/length code",l.mode=k;break e}for(i=65535&r,(n&=15)&&(w<n&&(b+=c[u++]<<w,w+=8),i+=b&(1<<n)-1,b>>>=n,w-=n),w<15&&(b+=c[u++]<<w,w+=8,b+=c[u++]<<w,w+=8),r=T[b&M];;){if(b>>>=n=r>>>24,w-=n,!(16&(n=r>>>16&255))){if(0==(64&n)){r=T[(65535&r)+(b&(1<<n)-1)];continue}e.msg="invalid distance code",l.mode=k;break e}if(o=65535&r,w<(n&=15)&&(b+=c[u++]<<w,(w+=8)<n&&(b+=c[u++]<<w,w+=8)),g<(o+=b&(1<<n)-1)){e.msg="invalid distance too far back",l.mode=k;break e}if(b>>>=n,w-=n,(n=f-p)<o){if(v<(n=o-n)&&l.sane){e.msg="invalid distance too far back",l.mode=k;break e}if(s=x,(a=0)===_){if(a+=y-n,n<i){for(i-=n;d[f++]=x[a++],--n;);a=f-o,s=d}}else if(_<n){if(a+=y+_-n,(n-=_)<i){for(i-=n;d[f++]=x[a++],--n;);if(a=0,_<i){for(i-=n=_;d[f++]=x[a++],--n;);a=f-o,s=d}}}else if(a+=_-n,n<i){for(i-=n;d[f++]=x[a++],--n;);a=f-o,s=d}for(;2<i;)d[f++]=s[a++],d[f++]=s[a++],d[f++]=s[a++],i-=3;i&&(d[f++]=s[a++],1<i&&(d[f++]=s[a++]))}else{for(a=f-o;d[f++]=d[a++],d[f++]=d[a++],d[f++]=d[a++],2<(i-=3););i&&(d[f++]=d[a++],1<i&&(d[f++]=d[a++]))}break}}break}}while(u<h&&f<m);b&=(1<<(w-=(i=w>>3)<<3))-1,e.next_in=u-=i,e.next_out=f,e.avail_in=u<h?h-u+5:5-(u-h),e.avail_out=f<m?m-f+257:257-(f-m),l.hold=b,l.bits=w}),D=Mo,Ao||(Ao=1,R=eo(),B=852,N=592,G=[3,4,5,6,7,8,9,10,11,13,F=15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,j=0,0],W=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Z=[U=1,V=2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],q=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],Co=function(e,t,r,n,i,o,a,s){for(var l,u,c,h,f,d,p,m,g,y=s.bits,v=0,_=0,x=0,b=0,w=0,E=0,T=0,S=0,M=0,k=0,C=null,A=0,I=new R.Buf16(F+1),L=new R.Buf16(F+1),P=null,z=0,v=0;v<=F;v++)I[v]=0;for(_=0;_<n;_++)I[t[r+_]]++;for(w=y,b=F;1<=b&&0===I[b];b--);if(b<w&&(w=b),0===b)i[o++]=20971520,i[o++]=20971520,s.bits=1;else{for(x=1;x<b&&0===I[x];x++);for(w<x&&(w=x),v=S=1;v<=F;v++)if((S=(S<<=1)-I[v])<0)return-1;if(0<S&&(e===j||1!==b))return-1;for(L[1]=0,v=1;v<F;v++)L[v+1]=L[v]+I[v];for(_=0;_<n;_++)0!==t[r+_]&&(a[L[t[r+_]]++]=_);if(d=e===j?(C=P=a,19):e===U?(C=G,A-=257,P=W,z-=257,256):(C=Z,P=q,-1),v=x,f=o,T=_=k=0,c=-1,h=(M=1<<(E=w))-1,e===U&&B<M||e===V&&N<M)return 1;for(;;){for(g=a[_]<d?(m=0,a[_]):a[_]>d?(m=P[z+a[_]],C[A+a[_]]):(m=96,0),l=1<<(p=v-T),x=u=1<<E;i[f+(k>>T)+(u-=l)]=p<<24|m<<16|g|0,0!==u;);for(l=1<<v-1;k&l;)l>>=1;if(k=0!==l?(k&l-1)+l:0,_++,0==--I[v]){if(v===b)break;v=t[r+a[_]]}if(w<v&&(k&h)!==c){for(f+=x,S=1<<(E=v-(T=0===T?w:T));E+T<b&&!((S-=I[E+T])<=0);)E++,S<<=1;if(M+=1<<E,e===U&&B<M||e===V&&N<M)return 1;i[c=k&h]=w<<24|E<<16|f-o|0}}0!==k&&(i[f+k]=v-T<<24|64<<16|0),s.bits=w}return 0}),O=Co,Y=-($=2),0,0,J=H=1,0,0,r=852,n=592,0,K=!(X=0),Uo.inflateReset=a,Uo.inflateReset2=s,Uo.inflateResetKeep=o,Uo.inflateInit=function(e){return t(e,15)},Uo.inflateInit2=t,Uo.inflate=function(e,t){var r,n,i,o,a,s,l,u,c,h,f,d,p,m,g,y,v,_,x,b,w,E,T,S,M=0,k=new L.Buf8(4),C=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return Y;12===(r=e.state).mode&&(r.mode=13),a=e.next_out,i=e.output,l=e.avail_out,o=e.next_in,n=e.input,s=e.avail_in,u=r.hold,c=r.bits,h=s,f=l,E=X;e:for(;;)switch(r.mode){case J:if(0===r.wrap)r.mode=13;else{for(;c<16;){if(0===s)break e;s--,u+=n[o++]<<c,c+=8}if(2&r.wrap&&35615===u)k[r.check=0]=255&u,k[1]=u>>>8&255,r.check=z(r.check,k,2,0),c=u=0,r.mode=2;else if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&u)<<8)+(u>>8))%31)e.msg="incorrect header check",r.mode=30;else if(8!=(15&u))e.msg="unknown compression method",r.mode=30;else{if(c-=4,w=8+(15&(u>>>=4)),0===r.wbits)r.wbits=w;else if(w>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<w,e.adler=r.check=1,r.mode=512&u?10:12,c=u=0}}break;case 2:for(;c<16;){if(0===s)break e;s--,u+=n[o++]<<c,c+=8}if(r.flags=u,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=u>>8&1),512&r.flags&&(k[0]=255&u,k[1]=u>>>8&255,r.check=z(r.check,k,2,0)),c=u=0,r.mode=3;case 3:for(;c<32;){if(0===s)break e;s--,u+=n[o++]<<c,c+=8}r.head&&(r.head.time=u),512&r.flags&&(k[0]=255&u,k[1]=u>>>8&255,k[2]=u>>>16&255,k[3]=u>>>24&255,r.check=z(r.check,k,4,0)),c=u=0,r.mode=4;case 4:for(;c<16;){if(0===s)break e;s--,u+=n[o++]<<c,c+=8}r.head&&(r.head.xflags=255&u,r.head.os=u>>8),512&r.flags&&(k[0]=255&u,k[1]=u>>>8&255,r.check=z(r.check,k,2,0)),c=u=0,r.mode=5;case 5:if(1024&r.flags){for(;c<16;){if(0===s)break e;s--,u+=n[o++]<<c,c+=8}r.length=u,r.head&&(r.head.extra_len=u),512&r.flags&&(k[0]=255&u,k[1]=u>>>8&255,r.check=z(r.check,k,2,0)),c=u=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&((d=s<(d=r.length)?s:d)&&(r.head&&(w=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),L.arraySet(r.head.extra,n,o,d,w)),512&r.flags&&(r.check=z(r.check,n,d,o)),s-=d,o+=d,r.length-=d),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===s)break e;for(d=0;w=n[o+d++],r.head&&w&&r.length<65536&&(r.head.name+=String.fromCharCode(w)),w&&d<s;);if(512&r.flags&&(r.check=z(r.check,n,d,o)),s-=d,o+=d,w)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===s)break e;for(d=0;w=n[o+d++],r.head&&w&&r.length<65536&&(r.head.comment+=String.fromCharCode(w)),w&&d<s;);if(512&r.flags&&(r.check=z(r.check,n,d,o)),s-=d,o+=d,w)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;c<16;){if(0===s)break e;s--,u+=n[o++]<<c,c+=8}if(u!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}c=u=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;c<32;){if(0===s)break e;s--,u+=n[o++]<<c,c+=8}e.adler=r.check=te(u),c=u=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=a,e.avail_out=l,e.next_in=o,e.avail_in=s,r.hold=u,r.bits=c,2;e.adler=r.check=1,r.mode=12;case 12:if(5===t||6===t)break e;case 13:if(r.last)u>>>=7&c,c-=7&c,r.mode=27;else{for(;c<3;){if(0===s)break e;s--,u+=n[o++]<<c,c+=8}switch(r.last=1&u,--c,3&(u>>>=1)){case 0:r.mode=14;break;case 1:A=I=void 0;var A,I=r;if(K){for(Q=new L.Buf32(512),ee=new L.Buf32(32),A=0;A<144;)I.lens[A++]=8;for(;A<256;)I.lens[A++]=9;for(;A<280;)I.lens[A++]=7;for(;A<288;)I.lens[A++]=8;for(O(H,I.lens,0,288,Q,0,I.work,{bits:9}),A=0;A<32;)I.lens[A++]=5;O($,I.lens,0,32,ee,0,I.work,{bits:5}),K=!1}if(I.lencode=Q,I.lenbits=9,I.distcode=ee,I.distbits=5,r.mode=20,6!==t)break;u>>>=2,c-=2;break e;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}u>>>=2,c-=2}break;case 14:for(u>>>=7&c,c-=7&c;c<32;){if(0===s)break e;s--,u+=n[o++]<<c,c+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&u,c=u=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(d=r.length){if(0===(d=l<(d=s<d?s:d)?l:d))break e;L.arraySet(i,n,o,d,a),s-=d,o+=d,l-=d,a+=d,r.length-=d}else r.mode=12;break;case 17:for(;c<14;){if(0===s)break e;s--,u+=n[o++]<<c,c+=8}if(r.nlen=257+(31&u),u>>>=5,c-=5,r.ndist=1+(31&u),u>>>=5,c-=5,r.ncode=4+(15&u),u>>>=4,c-=4,286<r.nlen||30<r.ndist){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;c<3;){if(0===s)break e;s--,u+=n[o++]<<c,c+=8}r.lens[C[r.have++]]=7&u,u>>>=3,c-=3}for(;r.have<19;)r.lens[C[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,T={bits:r.lenbits},E=O(0,r.lens,0,19,r.lencode,0,r.work,T),r.lenbits=T.bits,E){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;y=(M=r.lencode[u&(1<<r.lenbits)-1])>>>16&255,v=65535&M,!((g=M>>>24)<=c);){if(0===s)break e;s--,u+=n[o++]<<c,c+=8}if(v<16)u>>>=g,c-=g,r.lens[r.have++]=v;else{if(16===v){for(S=g+2;c<S;){if(0===s)break e;s--,u+=n[o++]<<c,c+=8}if(u>>>=g,c-=g,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}w=r.lens[r.have-1],d=3+(3&u),u>>>=2,c-=2}else if(17===v){for(S=g+3;c<S;){if(0===s)break e;s--,u+=n[o++]<<c,c+=8}w=0,d=3+(7&(u>>>=g)),u>>>=3,c=c-g-3}else{for(S=g+7;c<S;){if(0===s)break e;s--,u+=n[o++]<<c,c+=8}w=0,d=11+(127&(u>>>=g)),u>>>=7,c=c-g-7}if(r.have+d>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;d--;)r.lens[r.have++]=w}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,T={bits:r.lenbits},E=O(H,r.lens,0,r.nlen,r.lencode,0,r.work,T),r.lenbits=T.bits,E){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,T={bits:r.distbits},E=O($,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,T),r.distbits=T.bits,E){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(6<=s&&258<=l){e.next_out=a,e.avail_out=l,e.next_in=o,e.avail_in=s,r.hold=u,r.bits=c,D(e,f),a=e.next_out,i=e.output,l=e.avail_out,o=e.next_in,n=e.input,s=e.avail_in,u=r.hold,c=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;y=(M=r.lencode[u&(1<<r.lenbits)-1])>>>16&255,v=65535&M,!((g=M>>>24)<=c);){if(0===s)break e;s--,u+=n[o++]<<c,c+=8}if(y&&0==(240&y)){for(_=g,x=y,b=v;y=(M=r.lencode[b+((u&(1<<_+x)-1)>>_)])>>>16&255,v=65535&M,!(_+(g=M>>>24)<=c);){if(0===s)break e;s--,u+=n[o++]<<c,c+=8}u>>>=_,c-=_,r.back+=_}if(u>>>=g,c-=g,r.back+=g,r.length=v,0===y){r.mode=26;break}if(32&y){r.back=-1,r.mode=12;break}if(64&y){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&y,r.mode=22;case 22:if(r.extra){for(S=r.extra;c<S;){if(0===s)break e;s--,u+=n[o++]<<c,c+=8}r.length+=u&(1<<r.extra)-1,u>>>=r.extra,c-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;y=(M=r.distcode[u&(1<<r.distbits)-1])>>>16&255,v=65535&M,!((g=M>>>24)<=c);){if(0===s)break e;s--,u+=n[o++]<<c,c+=8}if(0==(240&y)){for(_=g,x=y,b=v;y=(M=r.distcode[b+((u&(1<<_+x)-1)>>_)])>>>16&255,v=65535&M,!(_+(g=M>>>24)<=c);){if(0===s)break e;s--,u+=n[o++]<<c,c+=8}u>>>=_,c-=_,r.back+=_}if(u>>>=g,c-=g,r.back+=g,64&y){e.msg="invalid distance code",r.mode=30;break}r.offset=v,r.extra=15&y,r.mode=24;case 24:if(r.extra){for(S=r.extra;c<S;){if(0===s)break e;s--,u+=n[o++]<<c,c+=8}r.offset+=u&(1<<r.extra)-1,u>>>=r.extra,c-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===l)break e;if(r.offset>(d=f-l)){if((d=r.offset-d)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}p=d>r.wnext?(d-=r.wnext,r.wsize-d):r.wnext-d,d>r.length&&(d=r.length),m=r.window}else m=i,p=a-r.offset,d=r.length;for(l-=d=l<d?l:d,r.length-=d;i[a++]=m[p++],--d;);0===r.length&&(r.mode=21);break;case 26:if(0===l)break e;i[a++]=r.length,l--,r.mode=21;break;case 27:if(r.wrap){for(;c<32;){if(0===s)break e;s--,u|=n[o++]<<c,c+=8}if(f-=l,e.total_out+=f,r.total+=f,f&&(e.adler=r.check=(r.flags?z:P)(r.check,i,f,a-f)),f=l,(r.flags?u:te(u))!==r.check){e.msg="incorrect data check",r.mode=30;break}c=u=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;c<32;){if(0===s)break e;s--,u+=n[o++]<<c,c+=8}if(u!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=30;break}c=u=0}r.mode=29;case 29:E=1;break e;case 30:E=-3;break e;case 31:return-4;default:return Y}return e.next_out=a,e.avail_out=l,e.next_in=o,e.avail_in=s,r.hold=u,r.bits=c,(r.wsize||f!==e.avail_out&&r.mode<30&&(r.mode<27||4!==t))&&re(e,e.output,e.next_out,f-e.avail_out),h-=e.avail_in,f-=e.avail_out,e.total_in+=h,e.total_out+=f,r.total+=f,r.wrap&&f&&(e.adler=r.check=(r.flags?z:P)(r.check,i,f,e.next_out-f)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),E=(0==h&&0===f||4===t)&&E===X?-5:E},Uo.inflateEnd=function(e){var t;return e&&e.state?((t=e.state).window&&(t.window=null),e.state=null,X):Y},Uo.inflateGetHeader=function(e,t){return!e||!e.state||0==(2&(e=e.state).wrap)?Y:((e.head=t).done=!1,X)},Uo.inflateSetDictionary=function(e,t){var r,n=t.length;return!e||!e.state||0!==(r=e.state).wrap&&11!==r.mode?Y:11===r.mode&&P(1,t,n,0)!==r.check?-3:re(e,t,n,n)?(r.mode=31,-4):(r.havedict=1,X)},Uo.inflateInfo="pako inflate (from Nodeca project)"),Uo;function te(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function i(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new L.Buf16(320),this.work=new L.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function o(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=J,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new L.Buf32(r),t.distcode=t.distdyn=new L.Buf32(n),t.sane=1,t.back=-1,X):Y}function a(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,o(e)):Y}function s(e,t){var r,n;return!e||!e.state||(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t))?Y:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,a(e))}function t(e,t){var r;return e?(r=new i,(e.state=r).window=null,(r=s(e,t))!==X&&(e.state=null),r):Y}function re(e,t,r,n){var i,e=e.state;return null===e.window&&(e.wsize=1<<e.wbits,e.wnext=0,e.whave=0,e.window=new L.Buf8(e.wsize)),n>=e.wsize?(L.arraySet(e.window,t,r-e.wsize,e.wsize,0),e.wnext=0,e.whave=e.wsize):(n<(i=e.wsize-e.wnext)&&(i=n),L.arraySet(e.window,t,r-n,i,e.wnext),(n-=i)?(L.arraySet(e.window,t,r-n,n,0),e.wnext=n,e.whave=e.wsize):(e.wnext+=i,e.wnext===e.wsize&&(e.wnext=0),e.whave<e.wsize&&(e.whave+=i))),0}}function Go(){return Lo=Po?Lo:{Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:Po=1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}}function Wo(){var h,f,d,p,r,n,i,m;return Oo||(Oo=1,h=Vo(),f=eo(),d=Eo(),p=Go(),r=go(),n=To(),Do||(Do=1,zo=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}),i=zo,m=Object.prototype.toString,o.prototype.push=function(e,t){var r,n,i,o,a,s=this.strm,l=this.options.chunkSize,u=this.options.dictionary,c=!1;if(this.ended)return!1;n=t===~~t?t:!0===t?p.Z_FINISH:p.Z_NO_FLUSH,"string"==typeof e?s.input=d.binstring2buf(e):"[object ArrayBuffer]"===m.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new f.Buf8(l),s.next_out=0,s.avail_out=l),(r=h.inflate(s,p.Z_NO_FLUSH))===p.Z_NEED_DICT&&u&&(a="string"==typeof u?d.string2buf(u):"[object ArrayBuffer]"===m.call(u)?new Uint8Array(u):u,r=h.inflateSetDictionary(this.strm,a)),r===p.Z_BUF_ERROR&&!0===c&&(r=p.Z_OK,c=!1),r!==p.Z_STREAM_END&&r!==p.Z_OK)return this.onEnd(r),!(this.ended=!0)}while(!s.next_out||0!==s.avail_out&&r!==p.Z_STREAM_END&&(0!==s.avail_in||n!==p.Z_FINISH&&n!==p.Z_SYNC_FLUSH)||("string"===this.options.to?(a=d.utf8border(s.output,s.next_out),i=s.next_out-a,o=d.buf2string(s.output,a),s.next_out=i,s.avail_out=l-i,i&&f.arraySet(s.output,s.output,a,i,0),this.onData(o)):this.onData(f.shrinkBuf(s.output,s.next_out))),0===s.avail_in&&0===s.avail_out&&(c=!0),(0<s.avail_in||0===s.avail_out)&&r!==p.Z_STREAM_END);return(n=r===p.Z_STREAM_END?p.Z_FINISH:n)===p.Z_FINISH?(r=h.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===p.Z_OK):n!==p.Z_SYNC_FLUSH||(this.onEnd(p.Z_OK),!(s.avail_out=0))},o.prototype.onData=function(e){this.chunks.push(e)},o.prototype.onEnd=function(e){e===p.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=f.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},jo.Inflate=o,jo.inflate=a,jo.inflateRaw=function(e,t){return(t=t||{}).raw=!0,a(e,t)},jo.ungzip=a),jo;function o(e){if(!(this instanceof o))return new o(e);this.options=f.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options,e=(t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new n,this.strm.avail_out=0,h.inflateInit2(this.strm,t.windowBits));if(e!==p.Z_OK)throw new Error(r[e]);this.header=new i,h.inflateGetHeader(this.strm,this.header)}function a(e,t){t=new o(t);if(t.push(e,!0),t.err)throw t.msg;return t.result}}function Zo(){var e,r,t;return Bo||(Bo=1,e="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,Fo||(Fo=1,t={},(0,eo().assign)(t,So(),Wo(),Go()),Ro=t),r=Ro,Ki.uncompressInputType=e?"uint8array":"array",Ki.compressInputType=e?"uint8array":"array",Ki.magic="\b\0",Ki.compress=function(e,t){return r.deflateRaw(e,{level:t.level||-1})},Ki.uncompress=function(e){return r.inflateRaw(e)}),Ki}function qo(){return No||(No=1,Ji.STORE={magic:"\0\0",compress:function(e,t){return e},uncompress:function(e){return e},compressInputType:null,uncompressInputType:null},Ji.DEFLATE=Zo()),Ji}var Ho,$o,Xo,Yo,Jo,t={exports:{}};function Ko(e){return e}function Qo(e,t){for(var r=0;r<e.length;++r)t[r]=255&e.charCodeAt(r);return t}function ea(e){var t=65536,r=[],n=e.length,i=Ho.getTypeOf(e),o=0,a=!0;try{switch(i){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,Yo(0))}}catch(e){a=!1}if(!a){for(var s="",l=0;l<e.length;l++)s+=String.fromCharCode(e[l]);return s}for(;o<n&&1<t;)try{r.push("array"===i||"nodebuffer"===i?String.fromCharCode.apply(null,e.slice(o,Math.min(o+t,n))):String.fromCharCode.apply(null,e.subarray(o,Math.min(o+t,n)))),o+=t}catch(e){t=Math.floor(t/2)}return r.join("")}function ta(e,t){for(var r=0;r<e.length;r++)t[r]=e[r];return t}t.exports=function(e,t){return new b(e,t)},t.exports.test=function(e){return b.isBuffer(e)},Ho=a,$o=s,Xo=qo(),Yo=t.exports,Ho.string2binary=function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(255&e.charCodeAt(r));return t},Ho.arrayBuffer2Blob=function(t,r){Ho.checkSupport("blob"),r=r||"application/zip";try{return new Blob([t],{type:r})}catch(e){try{var n=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);return n.append(t),n.getBlob(r)}catch(e){throw new Error("Bug : can't construct the Blob.")}}},Ho.applyFromCharCode=ea,(Jo={}).string={string:Ko,array:function(e){return Qo(e,new Array(e.length))},arraybuffer:function(e){return Jo.string.uint8array(e).buffer},uint8array:function(e){return Qo(e,new Uint8Array(e.length))},nodebuffer:function(e){return Qo(e,Yo(e.length))}},Jo.array={string:ea,array:Ko,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return Yo(e)}},Jo.arraybuffer={string:function(e){return ea(new Uint8Array(e))},array:function(e){return ta(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:Ko,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return Yo(new Uint8Array(e))}},Jo.uint8array={string:ea,array:function(e){return ta(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:Ko,nodebuffer:function(e){return Yo(e)}},Jo.nodebuffer={string:ea,array:function(e){return ta(e,new Array(e.length))},arraybuffer:function(e){return Jo.nodebuffer.uint8array(e).buffer},uint8array:function(e){return ta(e,new Uint8Array(e.length))},nodebuffer:Ko},Ho.transformTo=function(e,t){if(t=t||"",!e)return t;Ho.checkSupport(e);var r=Ho.getTypeOf(t);return Jo[r][e](t)},Ho.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":$o.nodebuffer&&Yo.test(e)?"nodebuffer":$o.uint8array&&e instanceof Uint8Array?"uint8array":$o.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},Ho.checkSupport=function(e){if(!$o[e.toLowerCase()])throw new Error(e+" is not supported by this browser")},Ho.MAX_VALUE_16BITS=65535,Ho.MAX_VALUE_32BITS=-1,Ho.pretty=function(e){for(var t,r="",n=0;n<(e||"").length;n++)r+="\\x"+((t=e.charCodeAt(n))<16?"0":"")+t.toString(16).toUpperCase();return r},Ho.findCompression=function(e){for(var t in Xo)if(Xo.hasOwnProperty(t)&&Xo[t].magic===e)return Xo[t];return null},Ho.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)};var ra=a,na=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],e={LOCAL_FILE_HEADER:"PK",CENTRAL_FILE_HEADER:"PK",CENTRAL_DIRECTORY_END:"PK",ZIP64_CENTRAL_DIRECTORY_LOCATOR:"PK",ZIP64_CENTRAL_DIRECTORY_END:"PK",DATA_DESCRIPTOR:"PK\b"},i={};function ia(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!1,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null,ia.prototype={getContent:function(){return null},getCompressedContent:function(){return null}};for(var o=ia,f={},oa=a,aa=s,sa=t.exports,la=new Array(256),ua=0;ua<256;ua++)la[ua]=252<=ua?6:248<=ua?5:240<=ua?4:224<=ua?3:192<=ua?2:1;la[254]=la[254]=1;function ca(e){for(var t,r,n=e.length,i=new Array(2*n),o=0,a=0;a<n;)if((t=e[a++])<128)i[o++]=t;else if(4<(r=la[t]))i[o++]=65533,a+=r-1;else{for(t&=2===r?31:3===r?15:7;1<r&&a<n;)t=t<<6|63&e[a++],r--;1<r?i[o++]=65533:t<65536?i[o++]=t:(t-=65536,i[o++]=55296|t>>10&1023,i[o++]=56320|1023&t)}return i.length!==o&&(i.subarray?i=i.subarray(0,o):i.length=o),oa.applyFromCharCode(i)}function ha(){this.data=[]}function fa(e){this.data=new Uint8Array(e),this.index=0}function da(e){var t;return e._data instanceof Ca&&(e._data=e._data.getContent(),e.options.binary=!0,e.options.base64=!1,"uint8array"===E.getTypeOf(e._data)&&(t=e._data,e._data=new Uint8Array(t.length),0!==t.length&&e._data.set(t,0))),e._data}function pa(e){var t=da(e);return"string"===E.getTypeOf(t)?!e.options.binary&&wa.nodebuffer?Aa(t,"utf-8"):e.asBinary():t}function ma(e){var t=da(this);return null==t?"":(this.options.base64&&(t=Ma.decode(t)),t=e&&this.options.binary?Ra.utf8decode(t):E.transformTo("string",t),e||this.options.binary?t:E.transformTo("string",Ra.utf8encode(t)))}function ga(e,t,r){this.name=e,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=t,this.options=r,this._initialMetadata={dir:r.dir,date:r.date}}function w(e,t){for(var r="",n=0;n<t;n++)r+=String.fromCharCode(255&e),e>>>=8;return r}function ya(e,t){return t=void 0!==t&&t,e=Oa(e),this.files[e]||Da.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]}function va(e,t,r){var n,i=new Ca;return e._data instanceof Ca?(i.uncompressedSize=e._data.uncompressedSize,i.crc32=e._data.crc32,0===i.uncompressedSize||e.dir?(t=ka.STORE,i.compressedContent="",i.crc32=0):e._data.compressionMethod===t.magic?i.compressedContent=e._data.getCompressedContent():(n=e._data.getContent(),i.compressedContent=t.compress(E.transformTo(t.compressInputType,n),r))):((n=pa(e))&&0!==n.length&&!e.dir||(t=ka.STORE,n=""),i.uncompressedSize=n.length,i.crc32=Ea(n),i.compressedContent=t.compress(E.transformTo(t.compressInputType,n),r)),i.compressedSize=i.compressedContent.length,i.compressionMethod=t.magic,i}function _a(e,t,r,n,i){r.compressedContent;var o=E.transformTo("string",Ia.utf8encode(t.name)),a=t.comment||"",s=E.transformTo("string",Ia.utf8encode(a)),l=o.length!==t.name.length,a=s.length!==a.length,u=t.options,c="",h=(t._initialMetadata.dir!==t.dir?t:u).dir,u=(t._initialMetadata.date!==t.date?t:u).date,f=0,d=0,t=(h&&(f|=16),"UNIX"===i?(d=798,f|=(i=t.unixPermissions,h=h,(65535&(i?i:h?16893:33204))<<16)):(d=20,f|=63&(t.dosPermissions||0)),i=u.getHours(),i=(i=((i<<=6)|u.getMinutes())<<5)|u.getSeconds()/2,h=u.getFullYear()-1980,h=(h=((h<<=4)|u.getMonth()+1)<<5)|u.getDate(),l&&(t=w(1,1)+w(Ea(o),4)+o,c+="up"+w(t.length,2)+t),a&&(u=w(1,1)+w(this.crc32(s),4)+s,c+="uc"+w(u.length,2)+u),""),t=(t=(t=(t=(t=(t=(t=(t=(t+="\n\0")+(l||a?"\0\b":"\0\0")+r.compressionMethod)+w(i,2))+w(h,2))+w(r.crc32,4))+w(r.compressedSize,4))+w(r.uncompressedSize,4))+w(o.length,2))+w(c.length,2);return{fileRecord:Ta.LOCAL_FILE_HEADER+t+o+c,dirRecord:Ta.CENTRAL_FILE_HEADER+w(d,2)+t+w(s.length,2)+"\0\0\0\0"+w(f,4)+w(n,4)+o+c+s,compressedObject:r}}f.utf8encode=function(e){if(aa.nodebuffer)return sa(e,"utf-8");for(var t,r,n,i,o=e,a=o.length,s=0,l=0;l<a;l++)55296==(64512&(r=o.charCodeAt(l)))&&l+1<a&&56320==(64512&(n=o.charCodeAt(l+1)))&&(r=65536+(r-55296<<10)+(n-56320),l++),s+=r<128?1:r<2048?2:r<65536?3:4;for(t=new(aa.uint8array?Uint8Array:Array)(s),l=i=0;i<s;l++)55296==(64512&(r=o.charCodeAt(l)))&&l+1<a&&56320==(64512&(n=o.charCodeAt(l+1)))&&(r=65536+(r-55296<<10)+(n-56320),l++),r<128?t[i++]=r:(r<2048?t[i++]=192|r>>>6:(r<65536?t[i++]=224|r>>>12:(t[i++]=240|r>>>18,t[i++]=128|r>>>12&63),t[i++]=128|r>>>6&63),t[i++]=128|63&r);return t},f.utf8decode=function(e){if(aa.nodebuffer)return oa.transformTo("nodebuffer",e).toString("utf-8");for(var t=[],r=0,n=(e=oa.transformTo(aa.uint8array?"uint8array":"array",e)).length;r<n;){var i=function(e,t){for(var r=(t=(t=t||e.length)>e.length?e.length:t)-1;0<=r&&128==(192&e[r]);)r--;return!(r<0)&&0!==r&&r+la[e[r]]>t?r:t}(e,Math.min(r+65536,n));t.push(ca(aa.uint8array?e.subarray(r,i):e.slice(r,i))),r=i}return t.join("")};var xa=a,qe=(ha.prototype={append:function(e){e=xa.transformTo("string",e),this.data.push(e)},finalize:function(){return this.data.join("")}},ha),ba=a,p=(fa.prototype={append:function(e){0!==e.length&&(e=ba.transformTo("uint8array",e),this.data.set(e,this.index),this.index+=e.length)},finalize:function(){return this.data}},fa),wa=s,E=a,Ea=function(e,t){if(void 0===e||!e.length)return 0;var r,n="string"!==ra.getTypeOf(e);void 0===t&&(t=0);t^=-1;for(var i=0,o=e.length;i<o;i++)r=n?e[i]:e.charCodeAt(i),t=t>>>8^na[255&(t^r)];return-1^t},Ta=e,Sa=i,Ma=y,ka=qo(),Ca=o,Aa=t.exports,Ia=f,La=qe,Pa=p,za=(ga.prototype={asText:function(){return ma.call(this,!0)},asBinary:function(){return ma.call(this,!1)},asNodeBuffer:function(){var e=pa(this);return E.transformTo("nodebuffer",e)},asUint8Array:function(){var e=pa(this);return E.transformTo("uint8array",e)},asArrayBuffer:function(){return this.asUint8Array().buffer}},function(){for(var e,t={},r=0;r<arguments.length;r++)for(e in arguments[r])arguments[r].hasOwnProperty(e)&&void 0===t[e]&&(t[e]=arguments[r][e]);return t}),Da=function(e,t,r){var n=E.getTypeOf(t);if(!0!==(i=(i=r)||{}).base64||null!==i.binary&&void 0!==i.binary||(i.binary=!0),(i=za(i,Sa)).date=i.date||new Date,null!==i.compression&&(i.compression=i.compression.toUpperCase()),"string"==typeof(r=i).unixPermissions&&(r.unixPermissions=parseInt(r.unixPermissions,8)),r.unixPermissions&&16384&r.unixPermissions&&(r.dir=!0),r.dosPermissions&&16&r.dosPermissions&&(r.dir=!0),r.dir&&(e=Oa(e)),r.createFolders&&(i=function(e){if(e.slice(-1)=="/")e=e.substring(0,e.length-1);var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""}(e))&&ya.call(this,i,!0),r.dir||null==t)r.base64=!1,r.binary=!1,n=t=null;else if("string"===n)r.binary&&!r.base64&&!0!==r.optimizedBinaryString&&(t=E.string2binary(t));else{if(r.base64=!1,r.binary=!0,!(n||t instanceof Ca))throw new Error("The data of '"+e+"' is in an unsupported format !");"arraybuffer"===n&&(t=E.transformTo("uint8array",t))}var i=new ga(e,t,r);return this.files[e]=i},Oa=function(e){return"/"!=e.slice(-1)&&(e+="/"),e},Ra={load:function(e,t){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(e){var t,r,n,i=[];for(t in this.files)this.files.hasOwnProperty(t)&&(n=this.files[t],n=new ga(n.name,n._data,za(n.options)),r=t.slice(this.root.length,t.length),t.slice(0,this.root.length)===this.root&&e(r,n)&&i.push(n));return i},file:function(r,e,t){var n;return 1===arguments.length?E.isRegExp(r)?(n=r,this.filter(function(e,t){return!t.dir&&n.test(e)})):this.filter(function(e,t){return!t.dir&&e===r})[0]||null:(r=this.root+r,Da.call(this,r,e,t),this)},folder:function(r){var e,t;return r?E.isRegExp(r)?this.filter(function(e,t){return t.dir&&r.test(e)}):(e=this.root+r,e=ya.call(this,e),(t=this.clone()).root=e.name,t):this},remove:function(r){r=this.root+r;var e=this.files[r];if(e||("/"!=r.slice(-1)&&(r+="/"),e=this.files[r]),e&&!e.dir)delete this.files[r];else for(var t=this.filter(function(e,t){return t.name.slice(0,r.length)===r}),n=0;n<t.length;n++)delete this.files[t[n].name];return this},generate:function(e){e=za(e||{},{base64:!0,compression:"STORE",compressionOptions:null,type:"base64",platform:"DOS",comment:null,mimeType:"application/zip"}),E.checkSupport(e.type),"darwin"!==e.platform&&"freebsd"!==e.platform&&"linux"!==e.platform&&"sunos"!==e.platform||(e.platform="UNIX"),"win32"===e.platform&&(e.platform="DOS");var t,r=[],n=0,i=0,o=E.transformTo("string",this.utf8encode(e.comment||this.comment||""));for(t in this.files)if(this.files.hasOwnProperty(t)){var a=this.files[t],s=a.options.compression||e.compression.toUpperCase(),l=ka[s];if(!l)throw new Error(s+" is not a valid compression method !");s=a.options.compressionOptions||e.compressionOptions||{},l=va.call(this,a,l,s),s=_a.call(this,t,a,l,n,e.platform);n+=s.fileRecord.length+l.compressedSize,i+=s.dirRecord.length,r.push(s)}for(var o=Ta.CENTRAL_DIRECTORY_END+"\0\0\0\0"+w(r.length,2)+w(r.length,2)+w(i,4)+w(n,4)+w(o.length,2)+o,u=e.type.toLowerCase(),c=new("uint8array"===u||"arraybuffer"===u||"blob"===u||"nodebuffer"===u?Pa:La)(n+i+o.length),h=0;h<r.length;h++)c.append(r[h].fileRecord),c.append(r[h].compressedObject.compressedContent);for(h=0;h<r.length;h++)c.append(r[h].dirRecord);c.append(o);var f=c.finalize();switch(e.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return E.transformTo(e.type.toLowerCase(),f);case"blob":return E.arrayBuffer2Blob(E.transformTo("arraybuffer",f),e.mimeType);case"base64":return e.base64?Ma.encode(f):f;default:return f}},crc32:function(e,t){return Ea(e,t)},utf8encode:function(e){return E.transformTo("string",Ia.utf8encode(e))},utf8decode:function(e){return Ia.utf8decode(e)}},d=Ra,Fa=a;function Ba(e){this.data=null,this.length=0,this.index=0}Ba.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,r=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)r=(r<<8)+this.byteAt(t);return this.index+=e,r},readString:function(e){return Fa.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1)}};var l=Ba,h=l,Na=a;function ja(e,t){this.data=e,t||(this.data=Na.string2binary(this.data)),this.length=this.data.length,this.index=0}(ja.prototype=new h).byteAt=function(e){return this.data.charCodeAt(e)},ja.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)},ja.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t};g=ja,u=l;function Ua(e){e&&(this.data=e,this.length=this.data.length,this.index=0)}(Ua.prototype=new u).byteAt=function(e){return this.data[e]},Ua.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),r=e.charCodeAt(1),n=e.charCodeAt(2),i=e.charCodeAt(3),o=this.length-4;0<=o;--o)if(this.data[o]===t&&this.data[o+1]===r&&this.data[o+2]===n&&this.data[o+3]===i)return o;return-1},Ua.prototype.readData=function(e){var t;return this.checkOffset(e),0===e?new Uint8Array(0):(t=this.data.subarray(this.index,this.index+e),this.index+=e,t)};v=Ua,Xi=v;function Va(e){this.data=e,this.length=this.data.length,this.index=0}(Va.prototype=new Xi).readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t};var t=Va,Ga=g,Wa=a,Za=o,qa=d;function Ha(e,t){this.options=e,this.loadOptions=t}Ha.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},prepareCompressedContent:function(r,n,i){return function(){var e=r.index,t=(r.setIndex(n),r.readData(i));return r.setIndex(e),t}},prepareContent:function(e,t,r,n,i){return function(){var e=Wa.transformTo(n.uncompressInputType,this.getCompressedContent()),e=n.uncompress(e);if(e.length!==i)throw new Error("Bug : uncompressed data size mismatch");return e}},readLocalPart:function(e){var t;if(e.skip(22),this.fileNameLength=e.readInt(2),t=e.readInt(2),this.fileName=e.readString(this.fileNameLength),e.skip(t),-1==this.compressedSize||-1==this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");if(null===(t=Wa.findCompression(this.compressionMethod)))throw new Error("Corrupted zip : compression "+Wa.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")");if(this.decompressed=new Za,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(e,e.index,this.compressedSize,t),this.decompressed.getContent=this.prepareContent(e,e.index,this.compressedSize,t,this.uncompressedSize),this.loadOptions.checkCRC32&&(this.decompressed=Wa.transformTo("string",this.decompressed.getContent()),qa.crc32(this.decompressed)!==this.crc32))throw new Error("Corrupted zip : CRC32 mismatch")},readCentralPart:function(e){if(this.versionMadeBy=e.readInt(2),this.versionNeeded=e.readInt(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4),this.fileNameLength=e.readInt(2),this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=e.readString(this.fileNameLength),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readString(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==e&&(this.dosPermissions=63&this.externalFileAttributes),3==e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileName.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(e){var t;this.extraFields[1]&&(t=new Ga(this.extraFields[1].value),this.uncompressedSize===Wa.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===Wa.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===Wa.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===Wa.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4)))},readExtraFields:function(e){var t,r,n,i=e.index;for(this.extraFields=this.extraFields||{};e.index<i+this.extraFieldsLength;)t=e.readInt(2),r=e.readInt(2),n=e.readString(r),this.extraFields[t]={id:t,length:r,value:n}},handleUTF8:function(){var e;this.useUTF8()?(this.fileName=qa.utf8decode(this.fileName),this.fileComment=qa.utf8decode(this.fileComment)):(null!==(e=this.findExtraFieldUnicodePath())&&(this.fileName=e),null!==(e=this.findExtraFieldUnicodeComment())&&(this.fileComment=e))},findExtraFieldUnicodePath:function(){var e,t=this.extraFields[28789];return!t||1!==(e=new Ga(t.value)).readInt(1)||qa.crc32(this.fileName)!==e.readInt(4)?null:qa.utf8decode(e.readString(t.length-5))},findExtraFieldUnicodeComment:function(){var e,t=this.extraFields[25461];return!t||1!==(e=new Ga(t.value)).readInt(1)||qa.crc32(this.fileComment)!==e.readInt(4)?null:qa.utf8decode(e.readString(t.length-5))}};var $a=g,Xa=t,Ya=v,Ja=a,Ka=e,Qa=Ha,es=s,ts=d;function rs(e,t){this.files=[],this.loadOptions=t,e&&this.load(e)}rs.prototype={checkSignature:function(e){var t=this.reader.readString(4);if(t!==e)throw new Error("Corrupted zip or bug : unexpected signature ("+Ja.pretty(t)+", expected "+Ja.pretty(e)+")")},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2),this.zipComment=this.reader.readString(this.zipCommentLength),this.zipComment=ts.utf8decode(this.zipComment)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,r,n=this.zip64EndOfCentralSize-44;0<n;)e=this.reader.readInt(2),t=this.reader.readInt(4),r=this.reader.readString(t),this.zip64ExtensibleData[e]={id:e,length:t,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){for(var e,t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(Ka.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===Ka.CENTRAL_FILE_HEADER;)(e=new Qa({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(Ka.CENTRAL_DIRECTORY_END);if(-1===e){var t=!0;try{this.reader.setIndex(0),this.checkSignature(Ka.LOCAL_FILE_HEADER),t=!1}catch(e){}throw t?new Error("Can't find end of central directory : is this a zip file ? If it is, see http://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip : can't find end of central directory")}if(this.reader.setIndex(e),this.checkSignature(Ka.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===Ja.MAX_VALUE_16BITS||this.diskWithCentralDirStart===Ja.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===Ja.MAX_VALUE_16BITS||this.centralDirRecords===Ja.MAX_VALUE_16BITS||this.centralDirSize===Ja.MAX_VALUE_32BITS||this.centralDirOffset===Ja.MAX_VALUE_32BITS){if(this.zip64=!0,-1===(e=this.reader.lastIndexOfSignature(Ka.ZIP64_CENTRAL_DIRECTORY_LOCATOR)))throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(e),this.checkSignature(Ka.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(Ka.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}},prepareReader:function(e){var t=Ja.getTypeOf(e);this.reader="string"!==t||es.uint8array?"nodebuffer"===t?new Xa(e):new Ya(Ja.transformTo("uint8array",e)):new $a(e,this.loadOptions.optimizedBinaryString)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}};var ns=y,is=rs,f={},os=a,as=(f.string2binary=function(e){return os.string2binary(e)},f.string2Uint8Array=function(e){return os.transformTo("uint8array",e)},f.uint8Array2String=function(e){return os.transformTo("string",e)},f.string2Blob=function(e){e=os.transformTo("arraybuffer",e);return os.arrayBuffer2Blob(e)},f.arrayBuffer2Blob=function(e){return os.arrayBuffer2Blob(e)},f.transformTo=function(e,t){return os.transformTo(e,t)},f.getTypeOf=function(e){return os.getTypeOf(e)},f.checkSupport=function(e){return os.checkSupport(e)},f.MAX_VALUE_16BITS=os.MAX_VALUE_16BITS,f.MAX_VALUE_32BITS=os.MAX_VALUE_32BITS,f.pretty=function(e){return os.pretty(e)},f.findCompression=function(e){return os.findCompression(e)},f.isRegExp=function(e){return os.isRegExp(e)},y);function ss(e,t){if(!(this instanceof ss))return new ss(e,t);this.files={},this.comment=null,this.root="",e&&this.load(e,t),this.clone=function(){var e,t=new ss;for(e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}(ss.prototype=d).load=function(e,t){var r,n,i;for((t=t||{}).base64&&(e=ns.decode(e)),r=(e=new is(e,t)).files,n=0;n<r.length;n++)i=r[n],this.file(i.fileName,i.decompressed,{binary:!0,optimizedBinaryString:!0,date:i.date,dir:i.dir,comment:i.fileComment.length?i.fileComment:null,unixPermissions:i.unixPermissions,dosPermissions:i.dosPermissions,createFolders:t.createFolders});return e.zipComment.length&&(this.comment=e.zipComment),this},ss.support=s,ss.defaults=i,ss.utils=f,ss.base64={encode:function(e){return as.encode(e)},decode:function(e){return as.decode(e)}},ss.compressions=qo();function ls(e,i){var t=new ms,o=t.folder(i&&i.folder?i.folder:"layers"),e=([ps.point(e),ps.line(e),ps.polygon(e)].forEach(function(n){n.geometries.length&&n.geometries[0].length&&ds(n.properties,n.type,n.geometries,function(e,t){var r=i&&i.types[n.type.toLowerCase()]?i.types[n.type.toLowerCase()]:n.type;o.file(r+".shp",t.shp.buffer,{binary:!0}),o.file(r+".shx",t.shx.buffer,{binary:!0}),o.file(r+".dbf",t.dbf.buffer,{binary:!0}),o.file(r+".prj",'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137,298.257223563]],PRIMEM["Greenwich",0],UNIT["Degree",0.017453292519943295]]')})}),{compression:"STORE"});return $d.browser||(e.type="nodebuffer"),t.generate(e)}var us,cs,hs,fs,ds=Ni,ps=c,ms=ss,gs=ls,qe=(Dt.download=function(e,t){e=gs(e,t);location.href="data:application/zip;base64,"+e},Dt.write=Ni,Dt.zip=ls,{exports:{}});function ys(e){return Object.prototype.toString.call(e)}function vs(e,a,t,s){var l=[],u=[],c=void 0!==b;return void 0===a&&(a=!0),function e(t,r){if(null===t)return null;if(0==r)return t;var n,i;if("object"!=typeof t)return t;if(us(t)?n=[]:hs(t)?(n=new RegExp(t.source,fs(t)),t.lastIndex&&(n.lastIndex=t.lastIndex)):cs(t)?n=new Date(t.getTime()):c&&b.isBuffer(t)?(n=new b(t.length),t.copy(n)):n=void 0===s?Object.create(Object.getPrototypeOf(t)):Object.create(s),a){var o=l.indexOf(t);if(-1!=o)return u[o];l.push(t),u.push(n)}for(i in t)n[i]=e(t[i],r-1);return n}(e,t=void 0===t?1/0:t)}us=function(e){return Array.isArray(e)||"object"==typeof e&&"[object Array]"===ys(e)},cs=function(e){return"object"==typeof e&&"[object Date]"===ys(e)},hs=function(e){return"object"==typeof e&&"[object RegExp]"===ys(e)},fs=function(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t},(qe.exports=vs).clonePrototype=function(e){var t;return null===e?null:((t=function(){}).prototype=e,new t)};var _s={},xs={};function bs(e){return new Function("d","return {"+e.map(function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'}).join(",")+"}")}function ws(e){var r=Object.create(null),n=[];return e.forEach(function(e){for(var t in e)t in r||n.push(r[t]=t)}),n}function Es(e,t){var e=e+"",r=e.length;return r<t?new Array(t-r+1).join(0)+e:e}function Ts(e){var t,r=e.getUTCHours(),n=e.getUTCMinutes(),i=e.getUTCSeconds(),o=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":((t=e.getUTCFullYear())<0?"-"+Es(-t,6):9999<t?"+"+Es(t,6):Es(t,4))+"-"+Es(e.getUTCMonth()+1,2)+"-"+Es(e.getUTCDate(),2)+(o?"T"+Es(r,2)+":"+Es(n,2)+":"+Es(i,2)+"."+Es(o,3)+"Z":i?"T"+Es(r,2)+":"+Es(n,2)+":"+Es(i,2)+"Z":n||r?"T"+Es(r,2)+":"+Es(n,2)+"Z":"")}function Ss(n){var t=new RegExp('["'+n+"\n\r]"),h=n.charCodeAt(0);function r(n,e){var t,r=[],i=n.length,o=0,a=0,s=i<=0,l=!1;function u(){if(s)return xs;if(l)return l=!1,_s;var e,t,r=o;if(34===n.charCodeAt(r)){for(;o++<i&&34!==n.charCodeAt(o)||34===n.charCodeAt(++o););return(e=o)>=i?s=!0:10===(t=n.charCodeAt(o++))?l=!0:13===t&&(l=!0,10===n.charCodeAt(o)&&++o),n.slice(r+1,e-1).replace(/""/g,'"')}for(;o<i;){if(10===(t=n.charCodeAt(e=o++)))l=!0;else if(13===t)l=!0,10===n.charCodeAt(o)&&++o;else if(t!==h)continue;return n.slice(r,e)}return s=!0,n.slice(r,i)}for(10===n.charCodeAt(i-1)&&--i,13===n.charCodeAt(i-1)&&--i;(t=u())!==xs;){for(var c=[];t!==_s&&t!==xs;)c.push(t),t=u();e&&null==(c=e(c,a++))||r.push(c)}return r}function i(e,r){return e.map(function(t){return r.map(function(e){return a(t[e])}).join(n)})}function o(e){return e.map(a).join(n)}function a(e){return null==e?"":e instanceof Date?Ts(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,o){var a,s;return(e=r(e,function(e,t){if(a)return a(e,t-1);var r,n,i;s=e,a=o?(n=o,i=bs(r=e),function(e,t){return n(i(e),t,r)}):bs(e)})).columns=s||[],e},parseRows:r,format:function(e,t){return[(t=null==t?ws(e):t).map(a).join(n)].concat(i(e,t)).join("\n")},formatBody:function(e,t){return i(e,t=null==t?ws(e):t).join("\n")},formatRows:function(e){return e.map(o).join("\n")},formatRow:o,formatValue:a}}p=Ss(","),h=p.parse,l=p.parseRows,u=p.format,Xi=p.formatBody,o=p.formatRows,g=p.formatRow,t=p.formatValue,v=Ss("\t"),e=v.parse,a=v.parseRows,y=v.format,d=v.formatBody,s=v.formatRows,i=v.formatRow,f=v.formatValue;var Ms=new Date("2019-01-01T00:00").getHours()||new Date("2019-07-01T00:00").getHours(),ks=O(Object.freeze({__proto__:null,dsvFormat:Ss,csvParse:h,csvParseRows:l,csvFormat:u,csvFormatBody:Xi,csvFormatRows:o,csvFormatRow:g,csvFormatValue:t,tsvParse:e,tsvParseRows:a,tsvFormat:y,tsvFormatBody:d,tsvFormatRows:s,tsvFormatRow:i,tsvFormatValue:f,autoType:function(e){for(var t in e){var r,n,i=e[t].trim();if(i)if("true"===i)i=!0;else if("false"===i)i=!1;else if("NaN"===i)i=NaN;else if(isNaN(r=+i)){if(!(n=i.match(/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/)))continue;Ms&&n[4]&&!n[7]&&(i=i.replace(/-/g,"/").replace(/T/," ")),i=new Date(i)}else i=r;else i=null;e[t]=i}return e}})).dsvFormat,Cs=Zt;function As(e,t,r){return e=Cs(e).features.map(function(e){return e.geometry&&"Point"===e.geometry.type?Object.assign({},e.properties,{lon:e.geometry.coordinates[0],lat:e.geometry.coordinates[1]}):r?e.properties:void 0}).filter(Boolean),ks(t||",").format(e)}var Is=Object.prototype.hasOwnProperty;function Ls(i,o,a,e,s){3===arguments.length&&(e=Array,s=null);for(var l=new e(i=1<<Math.max(4,Math.ceil(Math.log(i)/Math.LN2))),u=i-1,t=0;t<i;++t)l[t]=s;return{add:function(e){for(var t=o(e)&u,r=l[t],n=0;r!=s;){if(a(r,e))return!0;if(++n>=i)throw new Error("full hashset");r=l[t=t+1&u]}return l[t]=e,!0},has:function(e){for(var t=o(e)&u,r=l[t],n=0;r!=s;){if(a(r,e))return!0;if(++n>=i)break;r=l[t=t+1&u]}return!1},values:function(){for(var e=[],t=0,r=l.length;t<r;++t){var n=l[t];n!=s&&e.push(n)}return e}}}function Ps(o,a,s,e,l,t){3===arguments.length&&(e=t=Array,l=null);for(var u=new e(o=1<<Math.max(4,Math.ceil(Math.log(o)/Math.LN2))),c=new t(o),h=o-1,r=0;r<o;++r)u[r]=l;return{set:function(e,t){for(var r=a(e)&h,n=u[r],i=0;n!=l;){if(s(n,e))return c[r]=t;if(++i>=o)throw new Error("full hashmap");n=u[r=r+1&h]}return u[r]=e,c[r]=t},maybeSet:function(e,t){for(var r=a(e)&h,n=u[r],i=0;n!=l;){if(s(n,e))return c[r];if(++i>=o)throw new Error("full hashmap");n=u[r=r+1&h]}return u[r]=e,c[r]=t},get:function(e,t){for(var r=a(e)&h,n=u[r],i=0;n!=l;){if(s(n,e))return c[r];if(++i>=o)break;n=u[r=r+1&h]}return t},keys:function(){for(var e=[],t=0,r=u.length;t<r;++t){var n=u[t];n!=l&&e.push(n)}return e}}}function zs(e,t){return e[0]===t[0]&&e[1]===t[1]}var c=new ArrayBuffer(16),Ds=new Float64Array(c),Os=new Uint32Array(c);function Rs(e){Ds[0]=e[0],Ds[1]=e[1];e=Os[0]^Os[1];return 2147483647&(e<<5^e>>7^Os[2]^Os[3])}function Fs(e){for(var i=e.coordinates,t=e.lines,r=e.rings,n=function(){for(var e=Ps(1.4*i.length,b,w,Int32Array,-1,Int32Array),t=new Int32Array(i.length),r=0,n=i.length;r<n;++r)t[r]=e.maybeSet(r,r);return t}(),o=new Int32Array(i.length),a=new Int32Array(i.length),s=new Int32Array(i.length),l=new Int8Array(i.length),u=0,c=0,h=i.length;c<h;++c)o[c]=a[c]=s[c]=-1;for(c=0,h=t.length;c<h;++c){var f=t[c],d=f[0],p=f[1],m=n[d],g=n[++d];for(++u,l[m]=1;++d<=p;)x(c,m,m=g,g=n[d]);++u,l[g]=1}for(c=0,h=i.length;c<h;++c)o[c]=-1;for(c=0,h=r.length;c<h;++c){var y=r[c],v=y[0]+1,_=y[1];for(x(c,n[_-1],m=n[v-1],g=n[v]);++v<=_;)x(c,m,m=g,g=n[v])}function x(e,t,r,n){var i;o[r]!==e&&(o[r]=e,0<=(e=a[r])?(i=s[r],e===t&&i===n||e===n&&i===t||(++u,l[r]=1)):(a[r]=t,s[r]=n))}function b(e){return Rs(i[e])}function w(e,t){return zs(i[e],i[t])}var E,o=a=s=null,T=Ls(1.4*u,Rs,zs);for(c=0,h=i.length;c<h;++c)l[E=n[c]]&&T.add(i[E]);return T}function Bs(e){for(var t,r,n,i,o,a=Fs(e),s=e.coordinates,l=e.lines,u=e.rings,c=0,h=l.length;c<h;++c)for(var f=l[c],d=f[0],p=f[1];++d<p;)a.has(s[d])&&(t={0:d,1:f[1]},f[1]=d,f=f.next=t);for(c=0,h=u.length;c<h;++c)for(var m=u[c],g=m[0],y=g,v=m[1],_=a.has(s[g]);++y<v;)a.has(s[y])&&(_?(t={0:y,1:m[1]},m[1]=y,m=m.next=t):(o=(i=v)-y,Ns(r=s,n=g,i),Ns(r,n,n+o),Ns(r,n+o,i),s[v]=s[g],_=!0,y=g));return e}function Ns(e,t,r){for(var n,i=t+(r---t>>1);t<i;++t,--r)n=e[t],e[t]=e[r],e[r]=n}function js(e){var t,r,c=e.coordinates,n=e.lines,i=e.rings,o=n.length+i.length;for(delete e.lines,delete e.rings,a=0,s=n.length;a<s;++a)for(t=n[a];t=t.next;)++o;for(a=0,s=i.length;a<s;++a)for(r=i[a];r=r.next;)++o;for(var u=Ps(2*o*1.4,Rs,zs),h=e.arcs=[],a=0,s=n.length;a<s;++a)for(t=n[a];l(t),t=t.next;);for(a=0,s=i.length;a<s;++a)if((r=i[a]).next)for(;l(r),r=r.next;);else!function(e){var t,r,n,i,o;if(r=u.get(t=c[e[0]]))for(i=0,o=r.length;i<o;++i){if(f(n=r[i],e))return e[0]=n[0],e[1]=n[1];if(d(n,e))return e[0]=n[1],e[1]=n[0]}if(r=u.get(t=c[e[0]+p(e)]))for(i=0,o=r.length;i<o;++i){if(f(n=r[i],e))return e[0]=n[0],e[1]=n[1];if(d(n,e))return e[0]=n[1],e[1]=n[0]}r?r.push(e):u.set(t,[e]);h.push(e)}(r);function l(e){var t,r,n,i,o,a,s,l;if(n=u.get(t=c[e[0]]))for(s=0,l=n.length;s<l;++s)if(function(e,t){var r=e[0],n=t[0],i=e[1],e=t[1];if(r-i!=n-e)return;for(;r<=i;++r,++n)if(!zs(c[r],c[n]))return;return 1}(i=n[s],e))return e[0]=i[0],void(e[1]=i[1]);if(o=u.get(r=c[e[1]]))for(s=0,l=o.length;s<l;++s)if(function(e,t){var r=e[0],n=t[0],i=e[1],o=t[1];if(r-i!=n-o)return;for(;r<=i;++r,--o)if(!zs(c[r],c[o]))return;return 1}(a=o[s],e))return e[1]=a[0],void(e[0]=a[1]);n?n.push(e):u.set(t,[e]),o?o.push(e):u.set(r,[e]),h.push(e)}function f(e,t){var r=e[0],n=t[0],i=e[1],o=t[1],a=i-r;if(a==o-n){for(var s=p(e),l=p(t),u=0;u<a;++u)if(!zs(c[r+(u+s)%a],c[n+(u+l)%a]))return;return 1}}function d(e,t){var r=e[0],n=t[0],i=e[1],o=t[1],a=i-r;if(a==o-n){for(var s=p(e),l=a-p(t),u=0;u<a;++u)if(!zs(c[r+(u+s)%a],c[o-(u+l)%a]))return;return 1}}function p(e){for(var t=e[0],r=e[1],n=t,i=n,o=c[n];++n<r;){var a=c[n];(a[0]<o[0]||a[0]===o[0]&&a[1]<o[1])&&(i=n,o=a)}return i-t}return e}function Us(e){var t,r,n={};for(t in e)n[t]=(r=e[t],null==r?{type:null}:("FeatureCollection"===r.type?Vs:"Feature"===r.type?Gs:Ws)(r));return n}function Vs(e){var t={type:"GeometryCollection",geometries:e.features.map(Gs)};return null!=e.bbox&&(t.bbox=e.bbox),t}function Gs(e){var t,r=Ws(e.geometry);for(t in null!=e.id&&(r.id=e.id),null!=e.bbox&&(r.bbox=e.bbox),e.properties){r.properties=e.properties;break}return r}function Ws(e){var t;return null==e?{type:null}:(t="GeometryCollection"===e.type?{type:"GeometryCollection",geometries:e.geometries.map(Ws)}:"Point"===e.type||"MultiPoint"===e.type?{type:e.type,coordinates:e.coordinates}:{type:e.type,arcs:e.coordinates},null!=e.bbox&&(t.bbox=e.bbox),t)}function Zs(e){var t,r=e[0],e=e[1];return e<r&&(t=r,r=e,e=t),r+31*e}function qs(e,t){var r,n=e[0],e=e[1],i=t[0],t=t[1];return e<n&&(r=n,n=e,e=r),t<i&&(r=i,i=t,t=r),n===i&&e===t}var Hs,$s,Xs,p=O(Object.freeze({__proto__:null,topology:function(e,t){var r=function(e){var r=1/0,n=1/0,i=-1/0,o=-1/0;function t(e){null!=e&&Is.call(s,e.type)&&s[e.type](e)}var a,s={GeometryCollection:function(e){e.geometries.forEach(t)},Point:function(e){l(e.coordinates)},MultiPoint:function(e){e.coordinates.forEach(l)},LineString:function(e){u(e.arcs)},MultiLineString:function(e){e.arcs.forEach(u)},Polygon:function(e){e.arcs.forEach(u)},MultiPolygon:function(e){e.arcs.forEach(c)}};function l(e){var t=e[0],e=e[1];t<r&&(r=t),i<t&&(i=t),e<n&&(n=e),o<e&&(o=e)}function u(e){e.forEach(l)}function c(e){e.forEach(u)}for(a in e)t(e[a]);return r<=i&&n<=o?[r,n,i,o]:void 0}(e=Us(e)),t=0<t&&r&&function(e,t,r){var c=t[0],h=t[1],n=t[2],t=t[3],f=n-c?(r-1)/(n-c):1,d=t-h?(r-1)/(t-h):1;function i(e){return[Math.round((e[0]-c)*f),Math.round((e[1]-h)*d)]}function o(e,t){for(var r,n,i,o,a=-1,s=0,l=e.length,u=new Array(l);++a<l;)o=e[a],i=Math.round((o[0]-c)*f),o=Math.round((o[1]-h)*d),i===r&&o===n||(u[s++]=[r=i,n=o]);for(u.length=s;s<t;)s=u.push([u[0][0],u[0][1]]);return u}function a(e){return o(e,2)}function s(e){return o(e,4)}function l(e){return e.map(s)}function u(e){null!=e&&Is.call(m,e.type)&&m[e.type](e)}var p,m={GeometryCollection:function(e){e.geometries.forEach(u)},Point:function(e){e.coordinates=i(e.coordinates)},MultiPoint:function(e){e.coordinates=e.coordinates.map(i)},LineString:function(e){e.arcs=a(e.arcs)},MultiLineString:function(e){e.arcs=e.arcs.map(a)},Polygon:function(e){e.arcs=l(e.arcs)},MultiPolygon:function(e){e.arcs=e.arcs.map(l)}};for(p in e)u(e[p]);return{scale:[1/f,1/d],translate:[c,h]}}(e,r,t),n=js(Bs(function(e){var i=-1,o=[],a=[],s=[];function t(e){e&&Is.call(n,e.type)&&n[e.type](e)}var r,n={GeometryCollection:function(e){e.geometries.forEach(t)},LineString:function(e){e.arcs=l(e.arcs)},MultiLineString:function(e){e.arcs=e.arcs.map(l)},Polygon:function(e){e.arcs=e.arcs.map(u)},MultiPolygon:function(e){e.arcs=e.arcs.map(c)}};function l(e){for(var t=0,r=e.length;t<r;++t)s[++i]=e[t];var n={0:i-r+1,1:i};return o.push(n),n}function u(e){for(var t=0,r=e.length;t<r;++t)s[++i]=e[t];var n={0:i-r+1,1:i};return a.push(n),n}function c(e){return e.map(u)}for(r in e)t(e[r]);return{type:"Topology",coordinates:s,lines:o,rings:a,objects:e}}(e))),i=n.coordinates,o=Ps(1.4*n.arcs.length,Zs,qs);function a(e){e&&Is.call(l,e.type)&&l[e.type](e)}e=n.objects,n.bbox=r,n.arcs=n.arcs.map(function(e,t){return o.set(e,t),i.slice(e[0],e[1]+1)}),delete n.coordinates;var s,i=null,l={GeometryCollection:function(e){e.geometries.forEach(a)},LineString:function(e){e.arcs=u(e.arcs)},MultiLineString:function(e){e.arcs=e.arcs.map(u)},Polygon:function(e){e.arcs=e.arcs.map(u)},MultiPolygon:function(e){e.arcs=e.arcs.map(c)}};function u(e){var t=[];do{var r=o.get(e)}while(t.push(e[0]<e[1]?r:~r),e=e.next);return t}function c(e){return e.map(u)}for(s in e)a(e[s]);return t&&(n.transform=t,n.arcs=function(e){for(var t=-1,r=e.length;++t<r;){for(var n,i,o=e[t],a=0,s=1,l=o.length,u=o[0],c=u[0],h=u[1];++a<l;)n=(u=o[a])[0],i=u[1],n===c&&i===h||(o[s++]=[n-c,i-h],c=n,h=i);1===s&&(o[s++]=[0,0]),o.length=s}return e}(n.arcs)),n}})),v={exports:{}};function Ys(e,t,r){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){Xs(n.response,t,r)},n.onerror=function(){console.error("could not download file")},n.send()}function Js(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&t.status<=299}function Ks(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(e){var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(r)}}h=v,Hs="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof Ht&&Ht.global===Ht?Ht:void 0,$s=Hs.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),Xs=Hs.saveAs||("object"!=typeof window||window!==Hs?function(){}:"download"in HTMLAnchorElement.prototype&&!$s?function(e,t,r){var n=Hs.URL||Hs.webkitURL,i=document.createElement("a");t=t||e.name||"download",i.download=t,i.rel="noopener","string"==typeof e?(i.href=e,i.origin===location.origin?Ks(i):Js(i.href)?Ys(e,t,r):Ks(i,i.target="_blank")):(i.href=n.createObjectURL(e),setTimeout(function(){n.revokeObjectURL(i.href)},4e4),setTimeout(function(){Ks(i)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,r){var n,i,o;t=t||e.name||"download","string"!=typeof e?navigator.msSaveOrOpenBlob((i=e,void 0===(o=r)?o={autoBom:!1}:"object"!=typeof o&&(console.warn("Deprecated: Expected third argument to be a object"),o={autoBom:!o}),o.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(i.type)?new Blob(["\ufeff",i],{type:i.type}):i),t):Js(e)?Ys(e,t,r):((n=document.createElement("a")).href=e,n.target="_blank",setTimeout(function(){Ks(n)}))}:function(e,t,r,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),"string"==typeof e)return Ys(e,t,r);var i,o,a,t="application/octet-stream"===e.type,r=/constructor/i.test(Hs.HTMLElement)||Hs.safari,s=/CriOS\/[\d]+/.test(navigator.userAgent);(s||t&&r||$s)&&"undefined"!=typeof FileReader?((i=new FileReader).onloadend=function(){var e=i.result,e=s?e:e.replace(/^data:[^;]*;/,"data:attachment/file;");n?n.location.href=e:location=e,n=null},i.readAsDataURL(e)):(o=Hs.URL||Hs.webkitURL,a=o.createObjectURL(e),n?n.location=a:location.href=a,n=null,setTimeout(function(){o.revokeObjectURL(a)},4e4))}),Hs.saveAs=Xs.saveAs=Xs,h.exports=Xs;var l={},el=(Object.defineProperty(l,"__esModule",{value:!0}),function(e,t,r){e={type:String(e)};return null!=r||"string"!=typeof t&&!Array.isArray(t)?Object.assign(e,t):r=t,Array.isArray(r)?e.children=r:null!=r&&(e.value=String(r)),e});const T=function(e,t,...r){var n,i,o=-1;if(null==e)n={type:"root",children:[]},r.unshift(t);else{if("string"!=typeof e)throw new TypeError("Expected element name, got `"+e+"`");if(n={type:"element",name:e,attributes:{},children:[]},function(e){if(null==e||"object"!=typeof e||Array.isArray(e))return;return 1}(t))for(i in t)void 0===t[i]||null===t[i]||"number"==typeof t[i]&&Number.isNaN(t[i])||(n.attributes[i]=String(t[i]));else r.unshift(t)}for(;++o<r.length;)!function e(t,r){var n=-1;if(null!=r)if("string"==typeof r||"number"==typeof r)t.push({type:"text",value:String(r)});else if(Array.isArray(r))for(;++n<r.length;)e(t,r[n]);else{if(!("object"==typeof r&&"type"in r))throw new TypeError("Expected node, nodes, string, got `"+r+"`");"root"===r.type?e(t,r.children):t.push(r)}}(n.children,r[o]);return n};function tl(e,t){for(var r=e&&e.children||[],n=-1,i=[];++n<r.length;)i[n]=_l(r[n],t);return i.join("")}function rl(e,n){return e=e.replace(n.subset?function(e){var t=[];let r=-1;for(;++r<e.length;)t.push(e[r].replace(/[|\\{}()[\]^$+*?.]/g,"\\$&"));return new RegExp("(?:"+t.join("|")+")","g")}(n.subset):/["&'<>`]/g,t),n.subset||n.escapeOnly?e:e.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,function(e,t,r){return n.format(1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)-56320+65536,r.charCodeAt(t+2),n)}).replace(/[\x01-\t\v\f\x0E-\x1F\x7F\x81\x8D\x8F\x90\x9D\xA0-\uFFFF]/g,t);function t(e,t,r){return n.format(e.charCodeAt(0),r.charCodeAt(t+1),n)}}function nl(e){return"&#x"+e.toString(16).toUpperCase()+";"}var il=/[\u0000-\u0008\u000B\u000C\u000E-\u001F]/g;function ol(e,r,t){e=String(e||"").replace(il,"");return t?e.replace(t,n):n(e);function n(e){return t={subset:r},rl(e,Object.assign({format:nl},t));var t}}var al=["\t","\n"," ",'"',"&","'","/","<","=",">"];function sl(e){return ol(e,al)}function ll(e,t){var r=String(e);if("string"!=typeof t)throw new TypeError("Expected character");let n=0,i=r.indexOf(t);for(;-1!==i;)n++,i=r.indexOf(t,i+t.length);return n}function ul(e,t){var r=t.quote,t=t.alternative,e=String(e),t=t&&ll(e,r)>ll(e,t)?t:r;return t+ol(e,["<","&",t])+t}var cl={}.hasOwnProperty;var hl=["&","<"];function fl(e){return ol(e.value,hl)}var dl=/\?>/g,pl=[">"];var ml=/]]>/g,gl=[">"];var yl={}.hasOwnProperty,vl={root:tl,element:function(e,t){var r,n,i=sl(e.name),o=tl(e,t),a=e.attributes||{},e=!o&&t.close,s=[];for(r in a)cl.call(a,r)&&null!=(n=a[r])&&s.push(sl(r)+"="+ul(n,t));return"<"+i+(0===s.length?"":" "+s.join(" "))+(e?(t.tight?"":" ")+"/":"")+">"+o+(e?"":"</"+i+">")},text:fl,comment:function(e){return"\x3c!--"+ol(e.value,["-"])+"--\x3e"},doctype:function(e,t){var r=sl(e.name),n=e.public,e=e.system,i="<!DOCTYPE";return""!==r&&(i+=" "+r),null!=n&&""!==n?i+=" PUBLIC "+ul(n,t):null!=e&&""!==e&&(i+=" SYSTEM"),null!=e&&""!==e&&(i+=" "+ul(e,t)),i+">"},instruction:function(e){var t=sl(e.name)||"x",e=ol(e.value,pl,dl);return"<?"+t+(e?" "+e:"")+"?>"},cdata:function(e){return"<![CDATA["+ol(e.value,gl,ml)+"]]>"},raw:function(e,t){return t.dangerous?e.value:fl(e)}};function _l(e,t){var r=e&&e.type;if(!r)throw new Error("Expected node, not `"+e+"`");if(yl.call(vl,r))return vl[r](e,t);throw new Error("Cannot compile unknown node `"+r+"`")}function xl(e,t={}){var r=t.quote||'"',n='"'===r?"'":'"',i=t.quoteSmart,e=Array.isArray(e)?{type:"root",children:e}:e;if('"'!==r&&"'"!==r)throw new Error("Invalid quote `"+r+"`, expected `'` or `\"`");return _l(e,{dangerous:t.allowDangerousXml,close:t.closeEmptyElements,tight:t.tightClose,quote:r,alternative:i?n:null})}const bl=el("text","\n"),wl=el("text","  ");function El(e){switch(e.type){case"Feature":return Sl(e);case"folder":return r=["string","number"].includes(typeof(t=e).meta.id)?{id:String(t.meta.id)}:{},[bl,T("Folder",r,[bl,...function(t){return Tl.filter(e=>void 0!==t[e]).map(e=>T(e,[el("text",String(t[e]))]))}(t.meta),bl,wl,...t.children.flatMap(e=>El(e))])]}var t,r}const Tl=["address","description","name","open","visibility","phoneNumber"];function Sl(e){var t=e["id"],t=["string","number"].includes(typeof t)?{id:t}:{};return[bl,T("Placemark",t,[bl,...function(e){if(!e)return[];const{name:t,description:r,visibility:n,...i}=e;return[t&&T("name",[el("text",Cl(t))]),r&&T("description",[el("text",function(e){if(e&&"object"==typeof e&&"@type"in e&&"html"===e["@type"]&&"value"in e&&"string"==typeof e.value)return el("cdata",e.value);return Cl(e)}(r))]),void 0!==n&&T("visibility",[el("text",n?"1":"0")]),T("ExtendedData",Object.entries(i).flatMap(([e,t])=>[bl,wl,T("Data",{name:e},[T("value",[el("text","string"==typeof t?t:JSON.stringify(t))])])]))].filter(Boolean)}(e.properties),bl,wl,...e.geometry?[Il(e.geometry)]:[]])]}function Ml(e){return e[0]+","+e[1]}function kl(e){return T("coordinates",[el("text",e.map(Ml).join("\n"))])}function Cl(e){switch(typeof e){case"string":return e;case"boolean":case"number":return String(e);case"object":try{return JSON.stringify(e)}catch(e){return""}}return""}const Al=e=>T("LinearRing",[kl(e)]);function Il(e){switch(e.type){case"Point":return T("Point",[(n=e.coordinates,T("coordinates",[el("text",Ml(n))]))]);case"MultiPoint":return n=e,T("MultiGeometry",n.coordinates.flatMap(e=>[bl,Il({type:"Point",coordinates:e})]));case"LineString":return T("LineString",[kl(e.coordinates)]);case"MultiLineString":return t=e,T("MultiGeometry",t.coordinates.flatMap(e=>[bl,Il({type:"LineString",coordinates:e})]));case"Polygon":var[t,...r]=(t=e).coordinates;return T("Polygon",[bl,T("outerBoundaryIs",[bl,wl,Al(t)]),...r.flatMap(e=>[bl,T("innerBoundaryIs",[bl,wl,Al(e)])])]);case"MultiPolygon":return r=e,T("MultiGeometry",r.coordinates.flatMap(e=>[bl,Il({type:"Polygon",coordinates:e})]));case"GeometryCollection":return T("MultiGeometry",e.geometries.flatMap(e=>[bl,Il(e)]))}var n}l.foldersToKML=function(e){return xl(el("root",[T("kml",{xmlns:"http://www.opengis.net/kml/2.2"},T("Document",e.children.flatMap(e=>El(e))))]))},l.toKML=function(e){return xl(el("root",[T("kml",{xmlns:"http://www.opengis.net/kml/2.2"},T("Document",e.features.flatMap(e=>Sl(e))))]))};var u={exports:{}},Xi=(u.exports=Pl,u.exports.parse=Pl,u.exports.stringify=function e(t){"Feature"===t.type&&(t=t.geometry);function r(e){return e.join(" ")}function n(e){return e.map(r).join(", ")}function i(e){return e.map(n).map(a).join(", ")}function o(e){return e.map(i).map(a).join(", ")}function a(e){return"("+e+")"}switch(t.type){case"Point":return"POINT ("+r(t.coordinates)+")";case"LineString":return"LINESTRING ("+n(t.coordinates)+")";case"Polygon":return"POLYGON ("+i(t.coordinates)+")";case"MultiPoint":return"MULTIPOINT ("+n(t.coordinates)+")";case"MultiPolygon":return"MULTIPOLYGON ("+o(t.coordinates)+")";case"MultiLineString":return"MULTILINESTRING ("+i(t.coordinates)+")";case"GeometryCollection":return"GEOMETRYCOLLECTION ("+t.geometries.map(e).join(", ")+")";default:throw new Error("stringify requires a valid GeoJSON Feature or geometry object as input")}},/[-+]?([0-9]*\.[0-9]+|[0-9]+)([eE][-+]?[0-9]+)?/),Ll=new RegExp("^"+Xi.source+"(\\s"+Xi.source+"){1,}");function Pl(e){var t,e=e.split(";"),r=e.pop(),e=(e.shift()||"").split("=").pop(),n=0;function o(e){e=r.substring(n).match(e);return e?(n+=e[0].length,e[0]):null}function a(){o(/^\s*/)}function i(){a();for(var e,t=0,r=[],n=[r],i=r;e=o(/^(\()/)||o(/^(\))/)||o(/^(,)/)||o(Ll);){if("("===e)n.push(i),n[n.length-1].push(i=[]),t++;else if(")"===e){if(0===i.length)return null;if(!(i=n.pop()))return null;if(0===--t)break}else if(","===e)n[n.length-1].push(i=[]);else{if(e.split(/\s/g).some(isNaN))return null;Array.prototype.push.apply(i,e.split(/\s/g).map(parseFloat))}a()}return 0!==t?null:r}function s(){for(var e,t,r=[];t=o(Ll)||o(/^(,)/);)","===t?(r.push(e),e=[]):t.split(/\s/g).some(isNaN)||(e=e||[],Array.prototype.push.apply(e,t.split(/\s/g).map(parseFloat))),a();return e&&(r.push(e),r.length)?r:null}function l(){return(o(/^(point(\sz)?)/i)&&(a(),o(/^(\()/)&&(t=s())&&(a(),o(/^(\))/)))?{type:"Point",coordinates:t[0]}:null)||(o(/^(linestring(\sz)?)/i)&&(a(),o(/^(\()/)&&(e=s())&&o(/^(\))/))?{type:"LineString",coordinates:e}:null)||function(){if(!o(/^(polygon(\sz)?)/i))return null;a();var e=i();return e?{type:"Polygon",coordinates:e}:null}()||function(){if(!o(/^(multipoint)/i))return null;a(),r="MULTIPOINT ("+r.substring(r.indexOf("(")+1,r.length-1).replace(/\(/g,"").replace(/\)/g,"")+")";var e=i();return e?(a(),{type:"MultiPoint",coordinates:e}):null}()||function(){if(!o(/^(multilinestring)/i))return null;a();var e=i();return e?(a(),{type:"MultiLineString",coordinates:e}):null}()||function(){if(!o(/^(multipolygon)/i))return null;a();var e=i();return e?{type:"MultiPolygon",coordinates:e}:null}()||function(){var e,t=[];if(!o(/^(geometrycollection)/i))return null;if(a(),!o(/^(\()/))return null;for(;e=l();)t.push(e),a(),o(/^(,)/),a();return o(/^(\))/)?{type:"GeometryCollection",geometries:t}:null}();var e,t}return(t=l())&&e.match(/\d+/)&&(t.crs={type:"name",properties:{name:"urn:ogc:def:crs:EPSG::"+e}}),t}o={};function zl(e){return e}function Dl(e){var o,a,s,l,u,c;return null==e?zl:(s=e.scale[0],l=e.scale[1],u=e.translate[0],c=e.translate[1],function(e,t){t||(o=a=0);var r=2,n=e.length,i=new Array(n);for(i[0]=(o+=e[0])*s+u,i[1]=(a+=e[1])*l+c;r<n;)i[r]=e[r],++r;return i})}function Ol(e){var t,i=Dl(e.transform),o=1/0,a=o,s=-o,l=-o;function r(e){(e=i(e))[0]<o&&(o=e[0]),e[0]>s&&(s=e[0]),e[1]<a&&(a=e[1]),e[1]>l&&(l=e[1])}function n(e){switch(e.type){case"GeometryCollection":e.geometries.forEach(n);break;case"Point":r(e.coordinates);break;case"MultiPoint":e.coordinates.forEach(r)}}for(t in e.arcs.forEach(function(e){for(var t,r=-1,n=e.length;++r<n;)(t=i(e[r],r))[0]<o&&(o=t[0]),t[0]>s&&(s=t[0]),t[1]<a&&(a=t[1]),t[1]>l&&(l=t[1])}),e.objects)n(e.objects[t]);return[o,a,s,l]}function Rl(e,t){var r=t.id,n=t.bbox,i=null==t.properties?{}:t.properties,e=Fl(e,t);return null==r&&null==n?{type:"Feature",properties:i,geometry:e}:null==n?{type:"Feature",id:r,properties:i,geometry:e}:{type:"Feature",id:r,bbox:n,properties:i,geometry:e}}function Fl(e,t){var d=Dl(e.transform),p=e.arcs;function i(e){return d(e)}function o(e){for(var t=[],r=0,n=e.length;r<n;++r){f=h=u=i=c=l=s=a=o=i=void 0;var i=e[r],o=t;o.length&&o.pop();for(var a=p[i<0?~i:i],s=0,l=a.length;s<l;++s)o.push(d(a[s],s));if(i<0)for(var u,c=o,i=l,h=c.length,f=h-i;f<--h;)u=c[f],c[f++]=c[h],c[h]=u}return t.length<2&&t.push(t[0]),t}function r(e){for(var t=o(e);t.length<4;)t.push(t[0]);return t}function a(e){return e.map(r)}return function e(t){var r,n=t.type;switch(n){case"GeometryCollection":return{type:n,geometries:t.geometries.map(e)};case"Point":r=i(t.coordinates);break;case"MultiPoint":r=t.coordinates.map(i);break;case"LineString":r=o(t.arcs);break;case"MultiLineString":r=t.arcs.map(o);break;case"Polygon":r=a(t.arcs);break;case"MultiPolygon":r=t.arcs.map(a);break;default:return null}return{type:n,coordinates:r}}(t)}function Bl(a,n){var i={},s={},l={},o=[],u=-1;function e(e,t){for(var r in e){r=e[r];delete t[r.start],delete r.start,delete r.end,r.forEach(function(e){i[e<0?~e:e]=1}),o.push(r)}}return n.forEach(function(e,t){var r=a.arcs[e<0?~e:e];r.length<3&&!r[1][0]&&!r[1][1]&&(r=n[++u],n[u]=e,n[t]=r)}),n.forEach(function(e){var t,r,n,i=function(e){var t,r=a.arcs[e<0?~e:e],n=r[0];a.transform?(t=[0,0],r.forEach(function(e){t[0]+=e[0],t[1]+=e[1]})):t=r[r.length-1];return e<0?[t,n]:[n,t]}(e),o=i[0],i=i[1];(t=l[o])?(delete l[t.end],t.push(e),t.end=i,(r=s[i])?(delete s[r.start],n=r===t?t:t.concat(r),s[n.start=t.start]=l[n.end=r.end]=n):s[t.start]=l[t.end]=t):(t=s[i])?(delete s[t.start],t.unshift(e),t.start=o,(r=l[o])?(delete l[r.end],n=r===t?t:r.concat(t),s[n.start=r.start]=l[n.end=t.end]=n):s[t.start]=l[t.end]=t):s[(t=[e]).start=o]=l[t.end=i]=t}),e(l,s),e(s,l),n.forEach(function(e){i[e<0?~e:e]||o.push([e])}),o}function Nl(e,t,r){var n,i,o,a,s,l,u;if(1<arguments.length)a=r,l=[],u=[],function e(t){switch((s=t).type){case"GeometryCollection":t.geometries.forEach(e);break;case"LineString":h(t.arcs);break;case"MultiLineString":case"Polygon":f(t.arcs);break;case"MultiPolygon":t.arcs.forEach(f)}}(t),u.forEach(null==a?function(e){l.push(e[0].i)}:function(e){a(e[0].g,e[e.length-1].g)&&l.push(e[0].i)}),n=l;else for(i=0,n=new Array(o=e.arcs.length);i<o;++i)n[i]=i;function c(e){var t=e<0?~e:e;(u[t]||(u[t]=[])).push({i:e,g:s})}function h(e){e.forEach(c)}function f(e){e.forEach(h)}return{type:"MultiLineString",arcs:Bl(e,n)}}function jl(s,e){var l={},r=[],n=[];function i(t){t.forEach(function(e){e.forEach(function(e){(l[e=e<0?~e:e]||(l[e]=[])).push(t)})}),r.push(t)}function u(e){for(var t,r=Fl(s,{type:"Polygon",arcs:[e]}).coordinates[0],n=-1,i=r.length,o=r[i-1],a=0;++n<i;)t=o,o=r[n],a+=t[0]*o[1]-t[1]*o[0];return Math.abs(a)}return e.forEach(function e(t){switch(t.type){case"GeometryCollection":t.geometries.forEach(e);break;case"Polygon":i(t.arcs);break;case"MultiPolygon":t.arcs.forEach(i)}}),r.forEach(function(e){if(!e._){var t=[],r=[e];for(e._=1,n.push(t);e=r.pop();)t.push(e),e.forEach(function(e){e.forEach(function(e){l[e<0?~e:e].forEach(function(e){e._||(e._=1,r.push(e))})})})}}),r.forEach(function(e){delete e._}),{type:"MultiPolygon",arcs:n.map(function(e){var t,r=[];if(e.forEach(function(e){e.forEach(function(e){e.forEach(function(e){l[e<0?~e:e].length<2&&r.push(e)})})}),1<(t=(r=Bl(s,r)).length))for(var n,i,o=1,a=u(r[0]);o<t;++o)(n=u(r[o]))>a&&(i=r[0],r[0]=r[o],r[o]=i,a=n);return r}).filter(function(e){return 0<e.length})}}function Ul(e,t){for(var r=0,n=e.length;r<n;){var i=r+n>>>1;e[i]<t?r=1+i:n=i}return r}function Vl(e){var a,s,l,u,c,h;return null==e?zl:(l=e.scale[0],u=e.scale[1],c=e.translate[0],h=e.translate[1],function(e,t){t||(a=s=0);var r=2,n=e.length,i=new Array(n),t=Math.round((e[0]-c)/l),o=Math.round((e[1]-h)/u);for(i[0]=t-a,a=t,i[1]=o-s,s=o;r<n;)i[r]=e[r],++r;return i})}g=O(Object.freeze({__proto__:null,bbox:Ol,feature:function(t,e){return"GeometryCollection"===(e="string"==typeof e?t.objects[e]:e).type?{type:"FeatureCollection",features:e.geometries.map(function(e){return Rl(t,e)})}:Rl(t,e)},mesh:function(e){return Fl(e,Nl.apply(this,arguments))},meshArcs:Nl,merge:function(e){return Fl(e,jl.apply(this,arguments))},mergeArcs:jl,neighbors:function(e){var n={},t=e.map(function(){return[]});function r(e,r){e.forEach(function(e){var t=n[e=e<0?~e:e];t?t.push(r):n[e]=[r]})}function i(e,t){e.forEach(function(e){r(e,t)})}var o,a={LineString:r,MultiLineString:i,Polygon:i,MultiPolygon:function(e,t){e.forEach(function(e){i(e,t)})}};for(o in e.forEach(function t(e,r){"GeometryCollection"===e.type?e.geometries.forEach(function(e){t(e,r)}):e.type in a&&a[e.type](e.arcs,r)}),n)for(var s=n[o],l=s.length,u=0;u<l;++u)for(var c=u+1;c<l;++c){var h,f=s[u],d=s[c];(h=t[f])[o=Ul(h,d)]!==d&&h.splice(o,0,d),(h=t[d])[o=Ul(h,f)]!==f&&h.splice(o,0,f)}return t},quantize:function(e,t){if(e.transform)throw new Error("already quantized");if(t&&t.scale)s=e.bbox;else{if(!(2<=(r=Math.floor(t))))throw new Error("n must be ≥2");var r,n=(s=e.bbox||Ol(e))[0],i=s[1],o=s[2],a=s[3];t={scale:[o-n?(o-n)/(r-1):1,a-i?(a-i)/(r-1):1],translate:[n,i]}}var s,l,u=Vl(t),c=e.objects,h={};function f(e){return u(e)}function d(e){var t;switch(e.type){case"GeometryCollection":t={type:"GeometryCollection",geometries:e.geometries.map(d)};break;case"Point":t={type:"Point",coordinates:f(e.coordinates)};break;case"MultiPoint":t={type:"MultiPoint",coordinates:e.coordinates.map(f)};break;default:return e}return null!=e.id&&(t.id=e.id),null!=e.bbox&&(t.bbox=e.bbox),null!=e.properties&&(t.properties=e.properties),t}for(l in c)h[l]=d(c[l]);return{type:"Topology",bbox:s,transform:t,objects:h,arcs:e.arcs.map(function(e){var t,r=0,n=1,i=e.length,o=new Array(i);for(o[0]=u(e[0],0);++r<i;)((t=u(e[r],r))[0]||t[1])&&(o[n++]=t);return 1===n&&(o[n++]=[0,0]),o.length=n,o})}},transform:Dl,untransform:Vl})),t={};function S(e,t){return Array.from(e.getElementsByTagName(t))}function Gl(e){return"#"===e[0]?e:"#"+e}function M(e){return e?.normalize(),e&&e.textContent||""}function Wl(e,t,r){e=e.getElementsByTagName(t),t=e.length?e[0]:null;return t&&r&&r(t),t}function Zl(e,t,r){var n={};return e&&(t=(e=e.getElementsByTagName(t)).length?e[0]:null)&&r?r(t,n):n}function ql(e,t,r){e=M(Wl(e,t));return e&&r&&r(e)||{}}function Hl(e,t,r){e=parseFloat(M(Wl(e,t)));if(!isNaN(e))return e&&r&&r(e)||{}}function $l(e,t,r){e=parseFloat(M(Wl(e,t)));if(!isNaN(e))return e&&r&&r(e),e}function Xl(e,t){const r={};for(const n of t)ql(e,n,e=>{r[n]=e});return r}function Yl(e){return 1===e?.nodeType}function Jl(e){return Zl(e,"line",e=>{return Object.assign({},ql(e,"color",e=>({stroke:"#"+e})),Hl(e,"opacity",e=>({"stroke-opacity":e})),Hl(e,"width",e=>({"stroke-width":96*e/25.4})))})}function Kl(e){let t=[];var r,n;if(null!==e)for(const i of Array.from(e.childNodes))Yl(i)&&(r=i.nodeName,"gpxtpx:TrackPointExtension"===(r=["heart","gpxtpx:hr","hr"].includes(r)?"heart":r)?t=t.concat(Kl(i)):(n=M(i),t.push([r,(r=n,n=void 0,n=parseFloat(r),isNaN(n)?r:n)])));return t}function Ql(e){const t=[parseFloat(e.getAttribute("lon")||""),parseFloat(e.getAttribute("lat")||"")];if(isNaN(t[0])||isNaN(t[1]))return null;$l(e,"ele",e=>{t.push(e)});var r=Wl(e,"time");return{coordinates:t,time:r?M(r):null,extendedValues:Kl(Wl(e,"extensions"))}}function eu(e){var t=Xl(e,["name","cmt","desc","type","time","keywords"]);for(const n of Array.from(e.getElementsByTagNameNS("http://www.garmin.com/xmlschemas/GpxExtensions/v3","*")))n.parentNode?.parentNode===e&&(t[n.tagName.replace(":","_")]=M(n));var r=S(e,"link");return r.length&&(t.links=r.map(e=>Object.assign({href:e.getAttribute("href")},Xl(e,["text","type"])))),t}function tu(e,t){var r=S(e,t),n=[],i=[],o={};for(let e=0;e<r.length;e++){var a=Ql(r[e]);if(a){n.push(a.coordinates),a.time&&i.push(a.time);for(var[s,l]of a.extendedValues){s="heart"===s?s:s.replace("gpxtpx:","")+"s";o[s]||(o[s]=Array(r.length).fill(null)),o[s][e]=l}}}if(!(n.length<2))return{line:n,times:i,extendedValues:o}}function*ru(e){for(const o of S(e,"trk")){var t=function(e){var t=[],r=[],n=[];for(const h of S(e,"trkseg")){var i=tu(h,"trkpt");i&&(n.push(i),i.times&&i.times.length&&r.push(i.times))}if(0===n.length)return null;var o=1<n.length,a=Object.assign({_gpxType:"trk"},eu(e),Jl(Wl(e,"extensions")),r.length?{coordinateProperties:{times:o?r:r[0]}}:{});for(const f of n){t.push(f.line),a.coordinateProperties||(a.coordinateProperties={});var s=a.coordinateProperties,l=Object.entries(f.extendedValues);for(let e=0;e<l.length;e++){var[u,c]=l[e];o?(s[u]||(s[u]=n.map(e=>new Array(e.line.length).fill(null))),s[u][e]=c):s[u]=c}}return{type:"Feature",properties:a,geometry:o?{type:"MultiLineString",coordinates:t}:{type:"LineString",coordinates:t[0]}}}(o);t&&(yield t)}for(const a of S(e,"rte")){var r=function(e){var t=tu(e,"rtept");if(t)return{type:"Feature",properties:Object.assign({_gpxType:"rte"},eu(e),Jl(Wl(e,"extensions"))),geometry:{type:"LineString",coordinates:t.line}}}(a);r&&(yield r)}for(const s of S(e,"wpt")){n=s,i=void 0,i=Object.assign(eu(n),Xl(n,["sym"]));i=(n=Ql(n))?{type:"Feature",properties:i,geometry:{type:"Point",coordinates:n.coordinates}}:null;i&&(yield i)}var n,i}Object.defineProperty(t,"__esModule",{value:!0});const nu=[["heartRate","heartRates"],["Cadence","cadences"],["Speed","speeds"],["Watts","watts"]],iu=[["TotalTimeSeconds","totalTimeSeconds"],["DistanceMeters","distanceMeters"],["MaximumSpeed","maxSpeed"],["AverageHeartRateBpm","avgHeartRate"],["MaximumHeartRateBpm","maxHeartRate"],["AvgSpeed","avgSpeed"],["AvgWatts","avgWatts"],["MaxWatts","maxWatts"]];function ou(t,e){var r,n,i=[];for([r,n]of e){let e=Wl(t,r);e||(o=t.getElementsByTagNameNS("http://www.garmin.com/xmlschemas/ActivityExtension/v2",r)).length&&(e=o[0]);var o=parseFloat(M(e));isNaN(o)||i.push([n,o])}return i}function au(e){var t=S(e,"Trackpoint"),r=[],n=[],i=[];if(t.length<2)return null;var o={},e={extendedProperties:o};for(let e=0;e<t.length;e++){var a=function(e){const t=[$l(e,"LongitudeDegrees"),$l(e,"LatitudeDegrees")];var r,n;return void 0===t[0]||isNaN(t[0])||void 0===t[1]||isNaN(t[1])?null:(r=Wl(e,"HeartRateBpm"),n=M(Wl(e,"Time")),Wl(e,"AltitudeMeters",e=>{e=parseFloat(M(e));isNaN(e)||t.push(e)}),{coordinates:t,time:n||null,heartRate:r?parseFloat(M(r)):null,extensions:ou(e,nu)})}(t[e]);if(null!==a){r.push(a.coordinates);var s,l,{time:a,heartRate:u,extensions:c}=a;a&&n.push(a),u&&i.push(u);for([s,l]of c)o[s]||(o[s]=Array(t.length).fill(null)),o[s][e]=l}}return r.length<2?null:Object.assign(e,{line:r,times:n,heartRates:i})}function su(e){var t=S(e,"Track"),r=[],n=[],i=[],o=[];let a;var s=Object.assign(Object.fromEntries(ou(e,iu)),Zl(e,"Name",e=>({name:M(e)})));for(const u of t)(a=au(u))&&(r.push(a.line),a.times.length&&n.push(a.times),a.heartRates.length&&i.push(a.heartRates),o.push(a.extendedProperties));for(let e=0;e<o.length;e++){var l=o[e];for(const c in l)1===t.length?a&&(s[c]=a.extendedProperties[c]):(s[c]||(s[c]=r.map(e=>Array(e.length).fill(null))),s[c][e]=l[c])}return 0===r.length?null:((n.length||i.length)&&(s.coordinateProperties=Object.assign(n.length?{times:1===r.length?n[0]:n}:{},i.length?{heart:1===r.length?i[0]:i}:{})),{type:"Feature",properties:s,geometry:1===r.length?{type:"LineString",coordinates:r[0]}:{type:"MultiLineString",coordinates:r}})}function*lu(e){for(const n of S(e,"Lap")){var t=su(n);t&&(yield t)}for(const i of S(e,"Courses")){var r=su(i);r&&(yield r)}}function uu(e,t){var r={},n="stroke"==t||"fill"===t?t:t+"-color";return 6===(e="#"===e[0]?e.substring(1):e).length||3===e.length?r[n]="#"+e:8===e.length&&(r[t+"-opacity"]=parseInt(e.substring(0,2),16)/255,r[n]="#"+e.substring(6,8)+e.substring(4,6)+e.substring(2,4)),r}function cu(e,t,r){const n={};return $l(e,t,e=>{n[r]=e}),n}function hu(e,t){return Zl(e,"color",e=>uu(M(e),t))}function fu(e){return Object.assign({},Zl(e,"PolyStyle",(e,t)=>Object.assign(t,Zl(e,"color",e=>uu(M(e),"fill")),ql(e,"fill",e=>{if("0"===e)return{"fill-opacity":0}}),ql(e,"outline",e=>{if("0"===e)return{"stroke-opacity":0}}))),Zl(e,"LineStyle",e=>Object.assign(hu(e,"stroke"),cu(e,"width","stroke-width"))),Zl(e,"LabelStyle",e=>Object.assign(hu(e,"label"),cu(e,"scale","label-scale"))),Zl(e,"IconStyle",e=>Object.assign(hu(e,"icon"),cu(e,"scale","icon-scale"),cu(e,"heading","icon-heading"),Zl(e,"hotSpot",e=>{var t=parseFloat(e.getAttribute("x")||""),r=parseFloat(e.getAttribute("y")||""),n=e.getAttribute("xunits")||"",e=e.getAttribute("yunits")||"";return isNaN(t)||isNaN(r)?{}:{"icon-offset":[t,r],"icon-offset-units":[n,e]}}),Zl(e,"Icon",(e,t)=>(ql(e,"href",e=>{t.icon=e}),t)))))}const du=/\s*/g,pu=/^\s*|\s*$/g,mu=/\s+/;function gu(e){return e.replace(du,"").split(",").map(parseFloat).filter(e=>!isNaN(e)).slice(0,3)}function yu(e){return e.replace(pu,"").split(mu).map(gu).filter(e=>2<=e.length)}function vu(e){let t=S(e,"coord");var r,n=(t=0===t.length?(r="coord",n="*",Array.from(e.getElementsByTagNameNS(n,r))):t).map(e=>M(e).split(" ").map(parseFloat));return 0===n.length?null:{geometry:2<n.length?{type:"LineString",coordinates:n}:{type:"Point",coordinates:n[0]},times:S(e,"when").map(e=>M(e))}}const _u=["Polygon","LineString","Point","Track","gx:Track"];function xu(e){return M(Wl(e,"coordinates"))}function bu(e){var t=[],r=[];for(const u of["MultiGeometry","MultiTrack","gx:MultiTrack"]){var n=Wl(e,u);if(n)return bu(n)}for(const c of _u)for(const h of S(e,c))switch(c){case"Point":var i=gu(xu(h));2<=i.length&&t.push({type:"Point",coordinates:i});break;case"LineString":i=yu(xu(h));2<=i.length&&t.push({type:"LineString",coordinates:i});break;case"Polygon":var o=[];for(const f of S(h,"LinearRing")){var a=function(e){if(0===e.length)return e;var t=e[0],r=e[e.length-1];let n=!0;for(let e=0;e<Math.max(t.length,r.length);e++)if(t[e]!==r[e]){n=!1;break}return n?e:e.concat([e[0]])}(yu(xu(f)));4<=a.length&&o.push(a)}o.length&&t.push({type:"Polygon",coordinates:o});break;case"Track":case"gx:Track":var s,l=vu(h);l&&({times:l,geometry:s}=l,t.push(s),l.length&&r.push(l))}return{geometries:t,coordTimes:r}}function wu(e,t){var r,{coordTimes:n,geometries:i}=bu(e),i={type:"Feature",geometry:0===(i=i).length?null:1===i.length?i[0]:{type:"GeometryCollection",geometries:i},properties:Object.assign(Xl(e,["name","address","visibility","open","phoneNumber","description"]),function(e){e=Wl(e,"description");for(const t of Array.from(e?.childNodes||[]))if(4===t.nodeType)return{description:{"@type":"html",value:M(t)}};return{}}(e),(r=t,ql(e,"styleUrl",e=>(e=Gl(e),r[e]?Object.assign({styleUrl:e},r[e]):{styleUrl:e}))),fu(e),Zl(e,"ExtendedData",(e,t)=>{for(const r of S(e,"Data"))t[r.getAttribute("name")||""]=M(Wl(r,"value"));for(const n of S(e,"SimpleData"))t[n.getAttribute("name")||""]=M(n);return t}),Zl(e,"TimeSpan",e=>({timespan:{begin:M(Wl(e,"begin")),end:M(Wl(e,"end"))}})),Zl(e,"TimeStamp",e=>({timestamp:M(Wl(e,"when"))})),n.length?{coordinateProperties:{times:1===n.length?n[0]:n}}:{})},t=(void 0!==i.properties?.visibility&&(i.properties.visibility="0"!==i.properties.visibility),e.getAttribute("id"));return null!==t&&""!==t&&(i.id=t),i}function Eu(e){const t={};for(const r of S(e,"Style"))t[function(e){let t=e.getAttribute("id");return e=e.parentNode,Gl((t=!t&&Yl(e)&&"CascadingStyle"===e.localName?e.getAttribute("kml:id")||e.getAttribute("id"):t)||"")}(r)]=fu(r);for(const n of S(e,"StyleMap")){const i=Gl(n.getAttribute("id")||"");ql(n,"styleUrl",e=>{e=Gl(e),t[e]&&(t[i]=t[e])})}return t}const Tu=["name","visibility","open","address","description","phoneNumber","visibility"];function*Su(e){var t=Eu(e);for(const n of S(e,"Placemark")){var r=wu(n,t);r&&(yield r)}}function Mu(e){return new Function("d","return {"+e.map(function(e,t){return JSON.stringify(e)+": d["+t+"]"}).join(",")+"}")}function ku(o){var t=new RegExp('["'+o+"\n]"),f=o.charCodeAt(0);function r(i,e){var t,o,a={},s={},r=[],l=i.length,u=0,n=0;function c(){if(l<=u)return s;if(o)return o=!1,a;var e=u;if(34===i.charCodeAt(e)){for(var t=e;t++<l;)if(34===i.charCodeAt(t)){if(34!==i.charCodeAt(t+1))break;++t}return u=t+2,13===(r=i.charCodeAt(t+1))?(o=!0,10===i.charCodeAt(t+2)&&++u):10===r&&(o=!0),i.slice(e+1,t).replace(/""/g,'"')}for(;u<l;){var r,n=1;if(10===(r=i.charCodeAt(u++)))o=!0;else if(13===r)o=!0,10===i.charCodeAt(u)&&(++u,++n);else if(r!==f)continue;return i.slice(e,u-n)}return i.slice(e)}for(;(t=c())!==s;){for(var h=[];t!==a&&t!==s;)h.push(t),t=c();e&&null==(h=e(h,n++))||r.push(h)}return r}function n(e){return e.map(a).join(o)}function a(e){return null==e?"":t.test(e+="")?'"'+e.replace(/\"/g,'""')+'"':e}return{parse:function(e,o){var a,s;return(e=r(e,function(e,t){if(a)return a(e,t-1);var r,n,i;s=e,a=o?(n=o,i=Mu(r=e),function(e,t){return n(i(e),t,r)}):Mu(e)})).columns=s,e},parseRows:r,format:function(e,r){var t,n,i;return null==r&&(t=e,n=Object.create(null),i=[],t.forEach(function(e){for(var t in e)t in n||i.push(n[t]=t)}),r=i),[r.map(a).join(o)].concat(e.map(function(t){return r.map(function(e){return a(t[e])}).join(o)})).join("\n")},formatRows:function(e){return e.map(n).join("\n")}}}t.gpx=function(e){return{type:"FeatureCollection",features:Array.from(ru(e))}},t.gpxGen=ru,t.kml=function(e){return{type:"FeatureCollection",features:Array.from(Su(e))}},t.kmlGen=Su,t.kmlWithFolders=function(e){const i=Eu(e);var t={type:"root",children:[]};return function t(r,n){if(Yl(r))switch(r.tagName){case"Placemark":var e=wu(r,i);e&&n.children.push(e);break;case"Folder":e=function(e){var t={};for(const r of Array.from(e.childNodes))Yl(r)&&Tu.includes(r.tagName)&&(t[r.tagName]=M(r));return{type:"folder",meta:t,children:[]}}(r),n.children.push(e),n=e}if(r.childNodes)for(let e=0;e<r.childNodes.length;e++)t(r.childNodes[e],n)}(e,t),t},t.tcx=function(e){return{type:"FeatureCollection",features:Array.from(lu(e))}},t.tcxGen=lu;e=ku(","),a=e.parse,y=e.parseRows,d=e.format,s=e.formatRows,i=ku("\t"),f=i.parse,c=i.parseRows,h=i.format,Xi=i.formatRows,e=O(Object.freeze({__proto__:null,dsvFormat:ku,csvParse:a,csvParseRows:y,csvFormat:d,csvFormatRows:s,tsvParse:f,tsvParseRows:c,tsvFormat:h,tsvFormatRows:Xi}));const Cu=e.csvParse;i=O(Object.freeze({__proto__:null,default:{lines:function(e){const t=Cu(e).reduce((e,t)=>(e[t.shape_id]=(e[t.shape_id]||[]).concat(t),e),{});return{type:"FeatureCollection",features:Object.keys(t).map(e=>({type:"Feature",id:e,properties:{shape_id:e},geometry:{type:"LineString",coordinates:t[e].sort((e,t)=>+e.shape_pt_sequence-t.shape_pt_sequence).map(e=>[parseFloat(e.shape_pt_lon),parseFloat(e.shape_pt_lat)])}}))}},stops:function(e){const t=Cu(e);return{type:"FeatureCollection",features:Object.keys(t).map(e=>({type:"Feature",id:t[e].stop_id,properties:{stop_id:t[e].stop_id,stop_name:t[e].stop_name},geometry:{type:"Point",coordinates:[parseFloat(t[e].stop_lon),parseFloat(t[e].stop_lat)]}}))}}}})),a={exports:{}};function Au(e,t){e=Iu(e,t);return e.whole+"° "+(e.minutes?e.minutes+"' ":"")+(e.seconds?e.seconds+'" ':"")+e.dir}function Iu(e,t){var t=({lat:["N","S"],lon:["E","W"]}[t]||"")[0<=e?0:1],e=Math.abs(e),r=Math.floor(e),e=60*(e-r),n=Math.floor(e);return{whole:r,minutes:n,seconds:Math.floor(60*(e-n)),dir:t}}function Lu(e,t){var r,n,i,o,a;return t=t||"NSEW","string"!=typeof e||!(o=(e=e.toUpperCase()).match(/^[\s\,]*([NSEW])?\s*([\-|\—|\―]?[0-9.]+)[°º˚]?\s*(?:([0-9.]+)['’′‘]\s*)?(?:([0-9.]+)(?:''|"|”|″)\s*)?([NSEW])?/))||(r=o[0],o[1]&&o[5]?(n=o[1],r=r.slice(0,-1)):n=o[1]||o[5],n&&-1===t.indexOf(n))?null:(t=o[2]?parseFloat(o[2]):0,i=o[3]?parseFloat(o[3])/60:0,o=o[4]?parseFloat(o[4])/3600:0,a=t<0?-1:1,"S"!==n&&"W"!==n||(a*=-1),{val:(Math.abs(t)+i+o)*a,dim:n,matched:r,remain:e.slice(r.length)})}a.exports=function(e,t){e=Lu(e,t);return null===e?null:e.val},a.exports.pair=function(e,t){var r=Lu(e=e.trim(),t);if(!r)return null;e=Lu(e=r.remain.trim(),t);if(!e||e.remain)return null;return r.dim?function(e,t,r){return"N"===r||"S"===r?[e,t]:"W"===r||"E"===r?[t,e]:void 0}(r.val,e.val,r.dim):[r.val,e.val]},a.exports.format=Au,a.exports.formatPair=function(e){return Au(e.lat,"lat")+" "+Au(e.lon,"lon")},a.exports.coordToDMS=Iu;var Pu=e,zu=a.exports,Du=/(Lat)(itude)?/gi,Ou=/(L)(on|ng)(gitude)?/i;function Ru(e,t){var r,n,i,o;for(o in e)(n=o.match(t))&&(!r||n[0].length/o.length>i)&&(i=n[0].length/o.length,r=o);return r}function Fu(e){return Ru(e,Du)}function Bu(e){return Ru(e,Ou)}function Nu(e){return"object"==typeof e?Object.keys(e).length:0}function ju(i){var o=[];return[",",";","\t","|"].forEach(function(e){var t=Pu.dsvFormat(e).parse(i);if(1<=t.length){for(var r=Nu(t[0]),n=0;n<t.length;n++)if(Nu(t[n])!==r)return;o.push({delimiter:e,arity:Object.keys(t[0]).length})}}),o.length?o.sort(function(e,t){return t.arity-e.arity})[0].delimiter:null}function Uu(e,t){var r,n=e&&e.type;if("FeatureCollection"===n)for(r=0;r<e.features.length;r++)Uu(e.features[r],t);else if("GeometryCollection"===n)for(r=0;r<e.geometries.length;r++)Uu(e.geometries[r],t);else if("Feature"===n)Uu(e.geometry,t);else if("Polygon"===n)Wu(e.coordinates,t);else if("MultiPolygon"===n)for(r=0;r<e.coordinates.length;r++)Wu(e.coordinates[r],t);return e}var Vu,Gu,y={isLon:function(e){return!!e.match(Ou)},isLat:function(e){return!!e.match(Du)},guessLatHeader:Fu,guessLonHeader:Bu,csv:Pu.csvParse,tsv:Pu.tsvParse,dsv:Pu,auto:function(e){var t=ju(e);return t?(delete(t=Pu.dsvFormat(t).parse(e)).columns,t):null},csv2geojson:function(e,t,r){r||(r=t,t={}),t.delimiter=t.delimiter||",";var n=t.latfield||"",i=t.lonfield||"",o=t.crs||"",a=[],s={type:"FeatureCollection",features:a};if(""!==o&&(s.crs={type:"name",properties:{name:o}}),"auto"!==t.delimiter||"string"!=typeof e||(t.delimiter=ju(e),t.delimiter)){var l=t.numericFields?t.numericFields.split(","):null,u="string"==typeof e?Pu.dsvFormat(t.delimiter).parse(e,function(e){if(l)for(var t in e)l.includes(t)&&(e[t]=+e[t]);return e}):e;if(u.length){var c,h,f,d,p=[],n=n||Fu(u[0]),i=i||Bu(u[0]);if(!n||!i)for(c=0;c<u.length;c++)a.push({type:"Feature",properties:u[c],geometry:null});else for(c=0;c<u.length;c++)void 0!==u[c][i]&&void 0!==u[c][n]&&(f=u[c][i],h=u[c][n],(d=zu(f,"EW"))&&(f=d),(d=zu(h,"NS"))&&(h=d),d=parseFloat(f),f=parseFloat(h),isNaN(d)||isNaN(f)?p.push({message:"A row contained an invalid value for latitude or longitude",row:u[c],index:c}):(t.includeLatLon||(delete u[c][i],delete u[c][n]),a.push({type:"Feature",properties:u[c],geometry:{type:"Point",coordinates:[parseFloat(d),parseFloat(f)]}})));r(p.length?p:null,s)}else r(null,s)}else r({type:"Error",message:"Could not autodetect delimiter"})},toLine:function(e){for(var t=e.features,r={type:"Feature",geometry:{type:"LineString",coordinates:[]}},n=0;n<t.length;n++)r.geometry.coordinates.push(t[n].geometry.coordinates);return r.properties=t.reduce(function(e,t){for(var r in t.properties)e[r]||(e[r]=[]),e[r].push(t.properties[r]);return e},{}),{type:"FeatureCollection",features:[r]}},toPolygon:function(e){for(var t=e.features,r={type:"Feature",geometry:{type:"Polygon",coordinates:[[]]}},n=0;n<t.length;n++)r.geometry.coordinates[0].push(t[n].geometry.coordinates);return r.properties=t.reduce(function(e,t){for(var r in t.properties)e[r]||(e[r]=[]),e[r].push(t.properties[r]);return e},{}),{type:"FeatureCollection",features:[r]}}},d={exports:{}};Gu=(Vu=d).exports,function(){var R,g="__lodash_hash_undefined__",F=1,B=2,y=1/0,x=9007199254740991,N="[object Arguments]",ee="[object Array]",te="[object Boolean]",re="[object Date]",ne="[object Error]",b="[object Function]",w="[object GeneratorFunction]",j="[object Map]",ie="[object Number]",U="[object Object]",E="[object Promise]",oe="[object RegExp]",V="[object Set]",ae="[object String]",se="[object Symbol]",T="[object WeakMap]",le="[object ArrayBuffer]",G="[object DataView]",S="[object Float32Array]",M="[object Float64Array]",k="[object Int8Array]",C="[object Int16Array]",A="[object Int32Array]",I="[object Uint8Array]",L="[object Uint8ClampedArray]",P="[object Uint16Array]",z="[object Uint32Array]",D=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,O=/^\w*$/,ue=/^\./,ce=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,he=/\\(\\)?/g,fe=/\w*$/,de=/^\[object .+?Constructor\]$/,pe=/^(?:0|[1-9]\d*)$/,t={},p=(t[S]=t[M]=t[k]=t[C]=t[A]=t[I]=t[L]=t[P]=t[z]=!0,t[N]=t[ee]=t[le]=t[te]=t[G]=t[re]=t[ne]=t[b]=t[j]=t[ie]=t[U]=t[oe]=t[V]=t[ae]=t[T]=!1,{}),e=(p[N]=p[ee]=p[le]=p[G]=p[te]=p[re]=p[S]=p[M]=p[k]=p[C]=p[A]=p[j]=p[ie]=p[U]=p[oe]=p[V]=p[ae]=p[se]=p[I]=p[L]=p[P]=p[z]=!0,p[ne]=p[b]=p[T]=!1,"object"==typeof Ht&&Ht&&Ht.Object===Object&&Ht),r="object"==typeof self&&self&&self.Object===Object&&self,r=e||r||Function("return this")(),me=Gu&&!Gu.nodeType&&Gu,ge=me&&!Vu.nodeType&&Vu,ye=ge&&ge.exports===me,ve=ye&&e.process,e=function(){try{return ve&&ve.binding("util")}catch(e){}}(),e=e&&e.isTypedArray;function _e(e,t){return e.set(t[0],t[1]),e}function xe(e,t){return e.add(t),e}function be(e,t){for(var r=-1,n=e?e.length:0;++r<n&&!1!==t(e[r],r,e););return e}function we(e,t,r,n){var i=-1,o=e?e.length:0;for(n&&o&&(r=e[++i]);++i<o;)r=t(r,e[i],i,e);return r}function W(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function Ee(e){var r=-1,n=Array(e.size);return e.forEach(function(e,t){n[++r]=[t,e]}),n}function Te(t,r){return function(e){return t(r(e))}}function Se(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}var Me=Array.prototype,n=Function.prototype,ke=Object.prototype,i=r["__core-js_shared__"],Ce=(i=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"",Ae=n.toString,Z=ke.hasOwnProperty,Ie=Ae.call(Object),o=ke.toString,Le=RegExp("^"+Ae.call(Z).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),i=ye?r.Buffer:R,n=r.Symbol,Pe=r.Uint8Array,ze=Te(Object.getPrototypeOf,Object),De=Object.create,Oe=ke.propertyIsEnumerable,Re=Me.splice,ye=Object.getOwnPropertySymbols,Me=i?i.isBuffer:R,Fe=Te(Object.keys,Object),Be=Math.max,i=f(r,"DataView"),a=f(r,"Map"),Ne=f(r,"Promise"),je=f(r,"Set"),r=f(r,"WeakMap"),s=f(Object,"create"),Ue=!Oe.call({valueOf:1},"valueOf"),Ve=d(i),Ge=d(a),We=d(Ne),Ze=d(je),qe=d(r),n=n?n.prototype:R,q=n?n.valueOf:R,He=n?n.toString:R;function l(){}function u(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function c(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function h(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function $e(e){var t=-1,r=e?e.length:0;for(this.__data__=new h;++t<r;)this.add(e[t])}function H(e){this.__data__=new c(e)}function Xe(e,t){var r,n=Y(e)||_(e)?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],i=n.length,o=!!i;for(r in e)!t&&!Z.call(e,r)||o&&("length"==r||_t(r,i))||n.push(r);return n}function Ye(e,t,r){(r===R||X(e[t],r))&&("number"!=typeof t||r!==R||t in e)||(e[t]=r)}function Je(e,t,r){var n=e[t];Z.call(e,t)&&X(n,r)&&(r!==R||t in e)||(e[t]=r)}function Ke(e,t){for(var r=e.length;r--;)if(X(e[r][0],t))return r;return-1}function v(r,n,i,o,e,t,a){var s;if((s=o?t?o(r,e,t,a):o(r):s)===R){if(!J(r))return r;e=Y(r);if(e){if(s=function(e){var t=e.length,r=e.constructor(t);t&&"string"==typeof e[0]&&Z.call(e,"index")&&(r.index=e.index,r.input=e.input);return r}(r),!n)return pt(r,s)}else{var l,u,c=$(r),h=c==b||c==w;if(At(r))return l=r,(u=n)?l.slice():(u=new l.constructor(l.length),l.copy(u),u);if(c==U||c==N||h&&!t){if(W(r))return t?r:{};if(s="function"!=typeof(l=h?{}:r).constructor||bt(l)?{}:function(e){return J(e)?De(e):{}}(ze(l)),!n)return h=u=r,h=(d=s)&&mt(h,Q(h),d),mt(u,vt(u),h)}else{if(!p[c])return t?r:{};s=function(e,t,r,n){var i=e.constructor;switch(t){case le:return dt(e);case te:case re:return new i(+e);case G:return function(e,t){t=t?dt(e.buffer):e.buffer;return new e.constructor(t,e.byteOffset,e.byteLength)}(e,n);case S:case M:case k:case C:case A:case I:case L:case P:case z:return function(e,t){t=t?dt(e.buffer):e.buffer;return new e.constructor(t,e.byteOffset,e.length)}(e,n);case j:return function(e,t,r){return we(t?r(Ee(e),!0):Ee(e),_e,new e.constructor)}(e,n,r);case ie:case ae:return new i(e);case oe:return function(e){var t=new e.constructor(e.source,fe.exec(e));return t.lastIndex=e.lastIndex,t}(e);case V:return function(e,t,r){return we(t?r(Se(e),!0):Se(e),xe,new e.constructor)}(e,n,r);case se:return function(e){return q?Object(q.call(e)):{}}(e)}}(r,c,v,n)}}var f,d=(a=a||new H).get(r);if(d)return d;a.set(r,s),be((f=e?f:i?function(e,t,r){t=t(e);return Y(e)?t:function(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}(t,r(e))}(r,Q,vt):Q(r))||r,function(e,t){f&&(e=r[t=e]),Je(s,t,v(e,n,i,o,t,r,a))})}return s}u.prototype.clear=function(){this.__data__=s?s(null):{}},u.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},u.prototype.get=function(e){var t,r=this.__data__;return s?(t=r[e])===g?R:t:Z.call(r,e)?r[e]:R},u.prototype.has=function(e){var t=this.__data__;return s?t[e]!==R:Z.call(t,e)},u.prototype.set=function(e,t){return this.__data__[e]=s&&t===R?g:t,this},c.prototype.clear=function(){this.__data__=[]},c.prototype.delete=function(e){var t=this.__data__;return!((e=Ke(t,e))<0)&&(e==t.length-1?t.pop():Re.call(t,e,1),!0)},c.prototype.get=function(e){var t=this.__data__;return(e=Ke(t,e))<0?R:t[e][1]},c.prototype.has=function(e){return-1<Ke(this.__data__,e)},c.prototype.set=function(e,t){var r=this.__data__,n=Ke(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},h.prototype.clear=function(){this.__data__={hash:new u,map:new(a||c),string:new u}},h.prototype.delete=function(e){return yt(this,e).delete(e)},h.prototype.get=function(e){return yt(this,e).get(e)},h.prototype.has=function(e){return yt(this,e).has(e)},h.prototype.set=function(e,t){return yt(this,e).set(e,t),this},$e.prototype.add=$e.prototype.push=function(e){return this.__data__.set(e,g),this},$e.prototype.has=function(e){return this.__data__.has(e)},H.prototype.clear=function(){this.__data__=new c},H.prototype.delete=function(e){return this.__data__.delete(e)},H.prototype.get=function(e){return this.__data__.get(e)},H.prototype.has=function(e){return this.__data__.has(e)},H.prototype.set=function(e,t){var r=this.__data__;if(r instanceof c){var n=r.__data__;if(!a||n.length<199)return n.push([e,t]),this;r=this.__data__=new h(n)}return r.set(e,t),this};function Qe(e,t){if(null!=e){if(!m(e))return et(e,t);for(var r=e.length,n=tt?r:-1,i=Object(e);(tt?n--:++n<r)&&!1!==t(i[n],n,i););}return e}et=function(e,t){return e&&nt(e,t,Q)};var et,tt,rt,nt=function(e,t,r){for(var n=-1,i=Object(e),o=r(e),a=o.length;a--;){var s=o[rt?a:++n];if(!1===t(i[s],s,i))break}return e};function it(e,t){for(var r=0,n=(t=xt(t,e)?[t]:ft(t)).length;null!=e&&r<n;)e=e[St(t[r++])];return r&&r==n?e:R}function ot(e,t){return null!=e&&t in Object(e)}function at(e,t,r,n,i){if(e===t)return!0;if(null==e||null==t||!J(e)&&!K(t))return e!=e&&t!=t;var o=at,a=Y(e),s=Y(t),l=ee,u=ee,s=(a||(l=(l=$(e))==N?U:l),s||(u=(u=$(t))==N?U:u),l==U&&!W(e)),c=u==U&&!W(t);if((u=l==u)&&!s){i=i||new H;if(a||Ot(e))return gt(e,t,o,r,n,i);else{var h=e;var f=t;var d=l;var p=o;var m=r;var g=n;var y=i;switch(d){case G:if(h.byteLength!=f.byteLength||h.byteOffset!=f.byteOffset)return!1;h=h.buffer,f=f.buffer;case le:return h.byteLength==f.byteLength&&p(new Pe(h),new Pe(f))?!0:!1;case te:case re:case ie:return X(+h,+f);case ne:return h.name==f.name&&h.message==f.message;case oe:case ae:return h==f+"";case j:var v=Ee;case V:var _=g&B;if(v=v||Se,h.size!=f.size&&!_)return!1;_=y.get(h);if(_)return _==f;g|=F,y.set(h,f);_=gt(v(h),v(f),p,m,g,y);return y.delete(h),_;case se:if(q)return q.call(h)==q.call(f)}return!1;return}}if(!(n&B)){var a=s&&Z.call(e,"__wrapped__"),l=c&&Z.call(t,"__wrapped__");if(a||l)return s=a?e.value():e,c=l?t.value():t,i=i||new H,o(s,c,r,n,i)}if(u){i=i||new H;var x=e,b=t,w=o,E=r,T=n,S=i,M=T&B,k=Q(x),C=k.length,a=Q(b).length;if(C!=a&&!M)return!1;for(var A=C;A--;){var I=k[A];if(!(M?I in b:Z.call(b,I)))return!1}if((a=S.get(x))&&S.get(b))return a==b;for(var L=!0,P=(S.set(x,b),S.set(b,x),M);++A<C;){I=k[A];var z,D=x[I],O=b[I];if(!((z=E?M?E(O,D,I,b,x,S):E(D,O,I,x,b,S):z)===R?D===O||w(D,O,E,T,S):z)){L=!1;break}P=P||"constructor"==I}return L&&!P&&(a=x.constructor,l=b.constructor,a!=l&&"constructor"in x&&"constructor"in b&&!("function"==typeof a&&a instanceof a&&"function"==typeof l&&l instanceof l)&&(L=!1)),S.delete(x),S.delete(b),L}return!1}function st(e){var t;return J(e)&&(t=e,!(Ce&&Ce in t))&&(It(e)||W(e)?Le:de).test(d(e))}function lt(e){if("function"==typeof e)return e;if(null==e)return Vt;if("object"==typeof e)if(Y(e)){var r=e[0],n=e[1];return xt(r)&&wt(n)?Et(St(r),n):function(e){var t=Bt(e,r);return t===R&&t===n?Nt(e,r):at(n,t,R,F|B)}}else{var t=e,i=function(e){var t=Q(e),r=t.length;for(;r--;){var n=t[r],i=e[n];t[r]=[n,i,wt(i)]}return t}(t);return 1==i.length&&i[0][2]?Et(i[0][0],i[0][1]):function(e){return e===t||function(e,t,r,n){var i=r.length,o=i,a=!n;if(null==e)return!o;for(e=Object(e);i--;){var s=r[i];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<o;){var l=(s=r[i])[0],u=e[l],c=s[1];if(a&&s[2]){if(u===R&&!(l in e))return!1}else{var h,f=new H;if(!((h=n?n(u,c,l,e,t,f):h)===R?at(c,u,n,F|B,f):h))return!1}}return!0}(e,t,i)}}return Wt(e)}function ut(e){if(!J(e)){var t=e,r=[];if(null!=t)for(var n in Object(t))r.push(n);return r}var i,o=bt(e),a=[];for(i in e)("constructor"!=i||!o&&Z.call(e,i))&&a.push(i);return a}function ct(f,d,p,m,g){var y;f!==d&&be((y=Y(d)||Ot(d)?y:ut(d))||d,function(e,t){var r,n,i,o,a,s,l,u,c,h;J(e=y?d[t=e]:e)?(g=g||new H,n=d,o=p,a=ct,s=m,l=g,u=(r=f)[i=t],c=n[i],(h=l.get(c))?Ye(r,i,h):(h=s?s(u,c,i+"",r,n,l):R,(n=h===R)&&(Y(h=c)||Ot(c)?h=Y(u)?u:Ct(u)?pt(u):v(c,!(n=!1)):Pt(c)||_(c)?h=_(u)?Rt(u):!J(u)||o&&It(u)?v(c,!(n=!1)):u:n=!1),n&&(l.set(c,h),a(h,c,o,s,l),l.delete(c)),Ye(r,i,h))):(u=m?m(f[t],e,t+"",f,d,g):R,Ye(f,t,u=u===R?e:u))})}function ht(l,u){return u=Be(u===R?l.length-1:u,0),function(){for(var e=arguments,t=-1,r=Be(e.length-u,0),n=Array(r);++t<r;)n[t]=e[u+t];for(var t=-1,i=Array(u+1);++t<u;)i[t]=e[t];i[u]=n;var o=l,a=this,s=i;switch(s.length){case 0:return o.call(a);case 1:return o.call(a,s[0]);case 2:return o.call(a,s[0],s[1]);case 3:return o.call(a,s[0],s[1],s[2])}return o.apply(a,s)}}function ft(e){return Y(e)?e:Tt(e)}function dt(e){var t=new e.constructor(e.byteLength);return new Pe(t).set(new Pe(e)),t}function pt(e,t){var r=-1,n=e.length;for(t=t||Array(n);++r<n;)t[r]=e[r];return t}function mt(e,t,r,n){r=r||{};for(var i=-1,o=t.length;++i<o;){var a=t[i],s=n?n(r[a],e[a],a,r,e):R;Je(r,a,s===R?e[a]:s)}return r}function gt(e,t,r,n,i,o){var a=i&B,s=e.length,l=t.length;if(s!=l&&!(a&&s<l))return!1;l=o.get(e);if(l&&o.get(t))return l==t;var u=-1,c=!0,h=i&F?new $e:R;for(o.set(e,t),o.set(t,e);++u<s;){var f,d=e[u],p=t[u];if((f=n?a?n(p,d,u,t,e,o):n(d,p,u,e,t,o):f)!==R){if(f)continue;c=!1;break}if(h){if(!function(e,t){for(var r=-1,n=e?e.length:0;++r<n;)if(t(e[r],r,e))return 1}(t,function(e,t){return!h.has(t)&&(d===e||r(d,e,n,i,o))&&h.add(t)})){c=!1;break}}else if(d!==p&&!r(d,p,n,i,o)){c=!1;break}}return o.delete(e),o.delete(t),c}function yt(e,t){var r,n,e=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?e["string"==typeof t?"string":"hash"]:e.map}function f(e,t){t=t;e=null==(e=e)?R:e[t];return st(e)?e:R}var vt=ye?Te(ye,Object):Zt,$=function(e){return o.call(e)};function _t(e,t){return!!(t=null==t?x:t)&&("number"==typeof e||pe.test(e))&&-1<e&&e%1==0&&e<t}function xt(e,t){var r;if(!Y(e))return"number"==(r=typeof e)||"symbol"==r||"boolean"==r||null==e||zt(e)||(O.test(e)||!D.test(e)||null!=t&&e in Object(t))}function bt(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||ke)}function wt(e){return e==e&&!J(e)}function Et(t,r){return function(e){return null!=e&&(e[t]===r&&(r!==R||t in Object(e)))}}(i&&$(new i(new ArrayBuffer(1)))!=G||a&&$(new a)!=j||Ne&&$(Ne.resolve())!=E||je&&$(new je)!=V||r&&$(new r)!=T)&&($=function(e){var t=o.call(e),e=t==U?e.constructor:R,e=e?d(e):R;if(e)switch(e){case Ve:return G;case Ge:return j;case We:return E;case Ze:return V;case qe:return T}return t});var Tt=kt(function(e){e=Ft(e);var i=[];return ue.test(e)&&i.push(""),e.replace(ce,function(e,t,r,n){i.push(r?n.replace(he,"$1"):t||e)}),i});function St(e){var t;return"string"==typeof e||zt(e)?e:"0"==(t=e+"")&&1/e==-y?"-0":t}function d(e){if(null!=e){try{return Ae.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Mt(e,t){return(Y(e)?be:Qe)(e,function(e,t){var r=(r=l.iteratee||Gt)===Gt?lt:r;return arguments.length?r(e,t):r}(t,3))}function kt(n,i){if("function"!=typeof n||i&&"function"!=typeof i)throw new TypeError("Expected a function");function o(){var e=arguments,t=i?i.apply(this,e):e[0],r=o.cache;return r.has(t)?r.get(t):(e=n.apply(this,e),o.cache=r.set(t,e),e)}return o.cache=new(kt.Cache||h),o}function X(e,t){return e===t||e!=e&&t!=t}function _(e){return Ct(e)&&Z.call(e,"callee")&&(!Oe.call(e,"callee")||o.call(e)==N)}kt.Cache=h;var Y=Array.isArray;function m(e){return null!=e&&Lt(e.length)&&!It(e)}function Ct(e){return K(e)&&m(e)}var At=Me||qt;function It(e){e=J(e)?o.call(e):"";return e==b||e==w}function Lt(e){return"number"==typeof e&&-1<e&&e%1==0&&e<=x}function J(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function K(e){return!!e&&"object"==typeof e}function Pt(e){return!(!K(e)||o.call(e)!=U||W(e))&&(null===(e=ze(e))||"function"==typeof(e=Z.call(e,"constructor")&&e.constructor)&&e instanceof e&&Ae.call(e)==Ie)}function zt(e){return"symbol"==typeof e||K(e)&&o.call(e)==se}var Dt,Ot=e?(Dt=e,function(e){return Dt(e)}):function(e){return K(e)&&Lt(e.length)&&!!t[o.call(e)]};function Rt(e){return mt(e,jt(e))}function Ft(e){return null==e?"":"string"==typeof(e=e)?e:zt(e)?He?He.call(e):"":"0"==(t=e+"")&&1/e==-y?"-0":t;var t}function Bt(e,t,r){e=null==e?R:it(e,t);return e===R?r:e}function Nt(e,t){return null!=e&&function(e,t,r){for(var n,i=-1,o=(t=xt(t,e)?[t]:ft(t)).length;++i<o;){var a=St(t[i]);if(!(n=null!=e&&r(e,a)))break;e=e[a]}return n||!!(o=e?e.length:0)&&Lt(o)&&_t(a,o)&&(Y(e)||_(e))}(e,t,ot)}function Q(e){return(m(e)?Xe:function(e){if(!bt(e))return Fe(e);var t,r=[];for(t in Object(e))Z.call(e,t)&&"constructor"!=t&&r.push(t);return r})(e)}function jt(e){return m(e)?Xe(e,!0):ut(e)}Ut=function(e,t,r){ct(e,t,r)};var Ut,n=ht(function(e,t){var r=-1,n=t.length,i=1<n?t[n-1]:R,o=2<n?t[2]:R,i=3<Ut.length&&"function"==typeof i?(n--,i):R;for(o&&function(e,t,r){if(J(r)){var n=typeof t;if("number"==n?m(r)&&_t(t,r.length):"string"==n&&t in r)return X(r[t],e)}return}(t[0],t[1],o)&&(i=n<3?R:i,n=1),e=Object(e);++r<n;){var a=t[r];a&&Ut(e,a,r,i)}return e});function Vt(e){return e}function Gt(e){return lt("function"==typeof e?e:v(e,!0))}function Wt(e){return xt(e)?(r=St(e),function(e){return null==e?R:e[r]}):(t=e,function(e){return it(e,t)});var t,r}function Zt(){return[]}function qt(){return!1}l.compact=function(e){for(var t=-1,r=e?e.length:0,n=0,i=[];++t<r;){var o=e[t];o&&(i[n++]=o)}return i},l.iteratee=Gt,l.keys=Q,l.keysIn=jt,l.memoize=kt,l.merge=n,l.property=Wt,l.toPlainObject=Rt,l.clone=function(e){return v(e,!1,!0)},l.eq=X,l.forEach=Mt,l.get=Bt,l.hasIn=Nt,l.identity=Vt,l.isArguments=_,l.isArray=Y,l.isArrayLike=m,l.isArrayLikeObject=Ct,l.isBuffer=At,l.isEmpty=function(e){if(m(e)&&(Y(e)||"string"==typeof e||"function"==typeof e.splice||At(e)||_(e)))return!e.length;var t,r=$(e);if(r==j||r==V)return!e.size;if(Ue||bt(e))return!Fe(e).length;for(t in e)if(Z.call(e,t))return!1;return!0},l.isFunction=It,l.isLength=Lt,l.isObject=J,l.isObjectLike=K,l.isPlainObject=Pt,l.isSymbol=zt,l.isTypedArray=Ot,l.stubArray=Zt,l.stubFalse=qt,l.toString=Ft,l.each=Mt,l.VERSION="4.15.0",ge&&((ge.exports=l)._=l,me._=l)}.call(Ht);function Wu(e,t){if(0!==e.length){Zu(e[0],t);for(var r=1;r<e.length;r++)Zu(e[r],!t)}}function Zu(e,t){for(var r=0,n=0,i=0,o=e.length,a=o-1;i<o;a=i++){var s=(e[i][0]-e[a][0])*(e[a][1]+e[i][1]),l=r+s;n+=Math.abs(r)>=Math.abs(s)?r-l+s:s-l+r,r=l}0<=r+n!=!!t&&e.reverse()}var s={exports:{}},z=(s.exports=[{key:"building",polygon:"all"},{key:"highway",polygon:"whitelist",values:["services","rest_area","escape","elevator"]},{key:"natural",polygon:"blacklist",values:["coastline","cliff","ridge","arete","tree_row"]},{key:"landuse",polygon:"all"},{key:"waterway",polygon:"whitelist",values:["riverbank","dock","boatyard","dam"]},{key:"amenity",polygon:"all"},{key:"leisure",polygon:"all"},{key:"barrier",polygon:"whitelist",values:["city_wall","ditch","hedge","retaining_wall","wall","spikes"]},{key:"railway",polygon:"whitelist",values:["station","turntable","roundhouse","platform"]},{key:"area",polygon:"all"},{key:"boundary",polygon:"all"},{key:"man_made",polygon:"blacklist",values:["cutline","embankment","pipeline"]},{key:"power",polygon:"whitelist",values:["plant","substation","generator","transformer"]},{key:"place",polygon:"all"},{key:"shop",polygon:"all"},{key:"aeroway",polygon:"blacklist",values:["taxiway"]},{key:"tourism",polygon:"all"},{key:"historic",polygon:"all"},{key:"public_transport",polygon:"all"},{key:"office",polygon:"all"},{key:"building:part",polygon:"all"},{key:"military",polygon:"all"},{key:"ruins",polygon:"all"},{key:"area:highway",polygon:"all"},{key:"craft",polygon:"all"},{key:"golf",polygon:"all"},{key:"indoor",polygon:"all"}],d.exports),qu=Uu,Hu={};function $u(e,t){return(e.version||t.version)&&e.version!==t.version?(+e.version||0)>(+t.version||0)?e:t:z.merge(e,t)}s.exports.forEach(function(e){var t,r;"all"===e.polygon?Hu[e.key]=!0:(t="whitelist"===e.polygon?"included_values":"excluded_values",r={},e.values.forEach(function(e){r[e]=!0}),Hu[e.key]={},Hu[e.key][t]=r)});function Xu(e){function t(e){return e[e.length-1]}function r(e,t){return void 0!==e&&void 0!==t&&e.id===t.id}for(var n,i,o,a,s,l,u=[];e.length;)for(n=e.pop().nodes.slice(),u.push(n);e.length&&!r(n[0],t(n));){for(i=n[0],o=t(n),a=0;a<e.length;a++){if(r(o,(l=e[a].nodes)[0])){s=n.push,l=l.slice(1);break}if(r(o,t(l))){s=n.push,l=l.slice(0,-1).reverse();break}if(r(i,t(l))){s=n.unshift,l=l.slice(0,-1);break}if(r(i,l[0])){s=n.unshift,l=l.slice(1).reverse();break}l=s=null}if(!l)break;e.splice(a,1),s.apply(n,l)}return u}const Yu=g,Ju=t,Ku=i.default,Qu=y,ec=(f=function(e,L,P){var t,a,s,l,u,c;function h(e,t,r){e.hasAttribute(r)&&(t[r]=e.getAttribute(r))}function f(e,t){e=z.clone(e);h(t,e,"lat"),h(t,e,"lon"),e.__is_center_placeholder=!0,l.push(e)}function d(e,t){var n=z.clone(e);function r(e,t,r){r={type:"node",id:"_"+n.type+"/"+n.id+"bounds"+r,lat:e,lon:t};n.nodes.push(r.id),l.push(r)}n.nodes=[],r(t.getAttribute("minlat"),t.getAttribute("minlon"),1),r(t.getAttribute("maxlat"),t.getAttribute("minlon"),2),r(t.getAttribute("maxlat"),t.getAttribute("maxlon"),3),r(t.getAttribute("minlat"),t.getAttribute("maxlon"),4),n.nodes.push(n.nodes[0]),n.__is_bounds_placeholder=!0,u.push(n)}function p(n,e){z.isArray(n.nodes)||(n.nodes=[],z.each(e,function(e,t){n.nodes.push("_anonymous@"+e.getAttribute("lat")+"/"+e.getAttribute("lon"))})),z.each(e,function(e,t){var r;e.getAttribute("lat")&&(r=e.getAttribute("lat"),e=e.getAttribute("lon"),t={type:"node",id:t=n.nodes[t],lat:r,lon:e},l.push(t))})}function m(o,e){function a(e,t){var r;u.some(function(e){return"way"==e.type&&e.id==t})||(r={type:"way",id:t,nodes:[]},z.each(e,function(e){var t;e.getAttribute("lat")?(t=e.getAttribute("lat"),e=e.getAttribute("lon"),t={type:"node",id:"_anonymous@"+t+"/"+e,lat:t,lon:e},r.nodes.push(t.id),l.push(t)):r.nodes.push(void 0)}),u.push(r))}z.each(e,function(e,t){var r,n,i;"node"==o.members[t].type?e.getAttribute("lat")&&(r=e.getAttribute("lat"),n=e.getAttribute("lon"),i=o.members[t].ref,l.push({type:"node",id:i,lat:r,lon:n})):"way"==o.members[t].type&&0<e.getElementsByTagName("nd").length&&(o.members[t].ref="_fullGeom"+o.members[t].ref,a(e.getElementsByTagName("nd"),o.members[t].ref))})}return L=z.merge({verbose:!1,flatProperties:!0,uninterestingTags:{source:!0,source_ref:!0,"source:ref":!0,history:!0,attribution:!0,created_by:!0,"tiger:county":!0,"tiger:tlid":!0,"tiger:upload_uuid":!0},polygonFeatures:Hu,deduplicator:$u},L),"undefined"!=typeof XMLDocument&&e instanceof XMLDocument||"undefined"==typeof XMLDocument&&e.childNodes?(t=e,l=new Array,u=new Array,c=new Array,z.each(t.getElementsByTagName("node"),function(e,t){var r={},n=(z.each(e.getElementsByTagName("tag"),function(e){r[e.getAttribute("k")]=e.getAttribute("v")}),{type:"node"});h(e,n,"id"),h(e,n,"lat"),h(e,n,"lon"),h(e,n,"version"),h(e,n,"timestamp"),h(e,n,"changeset"),h(e,n,"uid"),h(e,n,"user"),z.isEmpty(r)||(n.tags=r),l.push(n)}),z.each(t.getElementsByTagName("way"),function(e,t){var r={},n=[],i=(z.each(e.getElementsByTagName("tag"),function(e){r[e.getAttribute("k")]=e.getAttribute("v")}),!1),o=(z.each(e.getElementsByTagName("nd"),function(e,t){var r;(r=e.getAttribute("ref"))&&(n[t]=r),!i&&e.getAttribute("lat")&&(i=!0)}),{type:"way"});h(e,o,"id"),h(e,o,"version"),h(e,o,"timestamp"),h(e,o,"changeset"),h(e,o,"uid"),h(e,o,"user"),0<n.length&&(o.nodes=n),z.isEmpty(r)||(o.tags=r),(a=e.getElementsByTagName("center")[0])&&f(o,a),i?p(o,e.getElementsByTagName("nd")):(s=e.getElementsByTagName("bounds")[0])&&d(o,s),u.push(o)}),z.each(t.getElementsByTagName("relation"),function(e,t){var r={},n=[],i=(z.each(e.getElementsByTagName("tag"),function(e){r[e.getAttribute("k")]=e.getAttribute("v")}),!1),o=(z.each(e.getElementsByTagName("member"),function(e,t){n[t]={},h(e,n[t],"ref"),h(e,n[t],"role"),h(e,n[t],"type"),(!i&&"node"==n[t].type&&e.getAttribute("lat")||"way"==n[t].type&&0<e.getElementsByTagName("nd").length)&&(i=!0)}),{type:"relation"});h(e,o,"id"),h(e,o,"version"),h(e,o,"timestamp"),h(e,o,"changeset"),h(e,o,"uid"),h(e,o,"user"),0<n.length&&(o.members=n),z.isEmpty(r)||(o.tags=r),(a=e.getElementsByTagName("center")[0])&&f(o,a),i?m(o,e.getElementsByTagName("member")):(s=e.getElementsByTagName("bounds")[0])&&d(o,s),c.push(o)}),g(l,u,c)):function(e){var a=new Array,i=new Array,t=new Array;function r(e){var t=z.clone(e);t.lat=e.center.lat,t.lon=e.center.lon,t.__is_center_placeholder=!0,a.push(t)}function n(e){var n=z.clone(e);function t(e,t,r){r={type:"node",id:"_"+n.type+"/"+n.id+"bounds"+r,lat:e,lon:t};n.nodes.push(r.id),a.push(r)}n.nodes=[],t(n.bounds.minlat,n.bounds.minlon,1),t(n.bounds.maxlat,n.bounds.minlon,2),t(n.bounds.maxlat,n.bounds.maxlon,3),t(n.bounds.minlat,n.bounds.maxlon,4),n.nodes.push(n.nodes[0]),n.__is_bounds_placeholder=!0,i.push(n)}function o(n){z.isArray(n.nodes)||(n.nodes=n.geometry.map(function(e){return null!==e?"_anonymous@"+e.lat+"/"+e.lon:"_anonymous@unknown_location"})),n.geometry.forEach(function(e,t){var r;e&&(r=e.lat,e=e.lon,t=n.nodes[t],a.push({type:"node",id:t,lat:r,lon:e}))})}function s(e){function o(e,t){var r;i.some(function(e){return"way"==e.type&&e.id==t})||(r={type:"way",id:t,nodes:[]},e.forEach(function(e){var t;e?(t=e.lat,e=e.lon,t={type:"node",id:"_anonymous@"+t+"/"+e,lat:t,lon:e},r.nodes.push(t.id),a.push(t)):r.nodes.push(void 0)}),i.push(r))}e.members.forEach(function(e,t){var r,n,i;"node"==e.type?e.lat&&(r=e.lat,n=e.lon,i=e.ref,a.push({type:"node",id:i,lat:r,lon:n})):"way"==e.type&&e.geometry&&(e.ref="_fullGeom"+e.ref,o(e.geometry,e.ref))})}for(var l=0;l<e.elements.length;l++)switch(e.elements[l].type){case"node":var u=e.elements[l];a.push(u);break;case"way":u=z.clone(e.elements[l]);u.nodes=z.clone(u.nodes),i.push(u),u.center&&r(u),u.geometry?o(u):u.bounds&&n(u);break;case"relation":var c=z.clone(e.elements[l]),h=(c.members=z.clone(c.members),t.push(c),c.members&&c.members.some(function(e){return"node"==e.type&&e.lat||"way"==e.type&&e.geometry&&0<e.geometry.length}));c.center&&r(c),h?s(c):c.bounds&&n(c)}return g(a,i,t)}(e);function g(e,t,r){function n(e,t){if("object"!=typeof t&&(t={}),"function"==typeof L.uninterestingTags)return!L.uninterestingTags(e,t);for(var r in e)if(!0!==L.uninterestingTags[r]&&!0!==t[r]&&t[r]!==e[r])return 1}function f(e){var t,r={timestamp:e.timestamp,version:e.version,changeset:e.changeset,user:e.user,uid:e.uid};for(t in r)void 0===r[t]&&delete r[t];return r}for(var i=new Object,o=new Object,a=0;a<e.length;a++)void 0!==(i[(h=void 0!==i[(h=e[a]).id]?L.deduplicator(h,i[h.id]):h).id]=h).tags&&n(h.tags)&&(o[h.id]=!0);for(a=0;a<r.length;a++)if(z.isArray(r[a].members))for(var s=0;s<r[a].members.length;s++)"node"==r[a].members[s].type&&(o[r[a].members[s].ref]=!0);for(var d=new Object,l=new Object,a=0;a<t.length;a++){var u=t[a];if(d[u.id]&&(u=L.deduplicator(u,d[u.id])),d[u.id]=u,z.isArray(u.nodes))for(s=0;s<u.nodes.length;s++)"object"!=typeof u.nodes[s]&&(l[u.nodes[s]]=!0,u.nodes[s]=i[u.nodes[s]])}var c=new Array;for(m in i){var h=i[m];l[m]&&!o[m]||c.push(h)}for(var p=new Array,a=0;a<r.length;a++)p[(v=p[(v=r[a]).id]?L.deduplicator(v,p[v.id]):v).id]=v;var m,g,y={node:{},way:{},relation:{}};for(m in p){var v=p[m];if(z.isArray(v.members))for(s=0;s<v.members.length;s++){var _=v.members[s].type,x=v.members[s].ref;"number"!=typeof x&&(x=x.replace("_fullGeom","")),y[_]?(void 0===y[_][x]&&(y[_][x]=[]),y[_][x].push({role:v.members[s].role,rel:v.id,reltags:v.tags})):L.verbose&&console.warn("Relation",v.type+"/"+v.id,"member",_+"/"+x,"ignored because it has an invalid type")}else L.verbose&&console.warn("Relation",v.type+"/"+v.id,"ignored because it has no members")}var b=[];for(a=0;a<c.length;a++)void 0===c[a].lon||void 0===c[a].lat?L.verbose&&console.warn("POI",c[a].type+"/"+c[a].id,"ignored because it lacks coordinates"):(M={type:"Feature",id:c[a].type+"/"+c[a].id,properties:{type:c[a].type,id:c[a].id,tags:c[a].tags||{},relations:y.node[c[a].id]||[],meta:f(c[a])},geometry:{type:"Point",coordinates:[+c[a].lon,+c[a].lat]}},c[a].__is_center_placeholder&&(M.properties.geometry="center"),P?P(M):b.push(M));for(var w=[],E=[],a=0;a<r.length;a++)if(p[r[a].id]===r[a]){if(void 0!==r[a].tags&&("route"==r[a].tags.type||"waterway"==r[a].tags.type)){if(!z.isArray(r[a].members)){L.verbose&&console.warn("Route",r[a].type+"/"+r[a].id,"ignored because it has no members");continue}if(r[a].members.forEach(function(e){d[e.ref]&&!n(d[e.ref].tags)&&(d[e.ref].is_skippablerelationmember=!0)}),!1===(M=function(r){var n=!1,e=(t=(t=r.members.filter(function(e){return"way"===e.type})).map(function(t){var e=d[t.ref];if(void 0!==e&&void 0!==e.nodes)return{id:t.ref,role:t.role,way:e,nodes:e.nodes.filter(function(e){return void 0!==e||(n=!0,L.verbose&&console.warn("Route",r.type+"/"+r.id,"tainted by a way",t.type+"/"+t.ref,"with a missing node"),!1)})};L.verbose&&console.warn("Route "+r.type+"/"+r.id,"tainted by a missing or incomplete  way",t.type+"/"+t.ref),n=!0}),t=z.compact(t),t=Xu(t),[]);if(0==(e=z.compact(t.map(function(e){return z.compact(e.map(function(e){return[+e.lon,+e.lat]}))}))).length)return L.verbose&&console.warn("Route",r.type+"/"+r.id,"contains no coordinates"),!1;var t={type:"Feature",id:r.type+"/"+r.id,properties:{type:r.type,id:r.id,tags:r.tags||{},relations:y[r.type][r.id]||[],meta:f(r)},geometry:{type:1===e.length?"LineString":"MultiLineString",coordinates:1===e.length?e[0]:e}};n&&(L.verbose&&console.warn("Route",r.type+"/"+r.id,"is tainted"),t.properties.tainted=!0);return t}(r[a]))){L.verbose&&console.warn("Route relation",r[a].type+"/"+r[a].id,"ignored because it has invalid geometry");continue}P?P(qu(M)):E.push(M)}if(void 0!==r[a].tags&&("multipolygon"==r[a].tags.type||"boundary"==r[a].tags.type)){if(z.isArray(r[a].members)){for(var T=0,s=0;s<r[a].members.length;s++)"outer"==r[a].members[s].role?T++:L.verbose&&"inner"!=r[a].members[s].role&&console.warn("Multipolygon",r[a].type+"/"+r[a].id,"member",r[a].members[s].type+"/"+r[a].members[s].ref,'ignored because it has an invalid role: "'+r[a].members[s].role+'"');if(r[a].members.forEach(function(e){d[e.ref]&&("outer"!==e.role||n(d[e.ref].tags,r[a].tags)||(d[e.ref].is_skippablerelationmember=!0),"inner"!==e.role||n(d[e.ref].tags)||(d[e.ref].is_skippablerelationmember=!0))}),0==T)L.verbose&&console.warn("Multipolygon relation",r[a].type+"/"+r[a].id,"ignored because it has no outer ways");else{var S=!1,M=null;if(S=1!=T||n(r[a].tags,{type:!0})?S:!0){var k=r[a].members.filter(function(e){return"outer"===e.role})[0];if(void 0===(k=d[k.ref])){L.verbose&&console.warn("Multipolygon relation",r[a].type+"/"+r[a].id,"ignored because outer way",k.type+"/"+k.ref,"is missing");continue}k.is_skippablerelationmember=!0,M=C(k,r[a])}else M=C(r[a],r[a]);!1===M?L.verbose&&console.warn("Multipolygon relation",r[a].type+"/"+r[a].id,"ignored because it has invalid geometry"):P?P(qu(M)):E.push(M)}}else L.verbose&&console.warn("Multipolygon",r[a].type+"/"+r[a].id,"ignored because it has no members");function C(e,t){var r=!1,n=S?"way":"relation",i="number"==typeof e.id?e.id:+e.id.replace("_fullGeom","");function o(e){function t(e){return e.map(function(e){return[+e.lat,+e.lon]})}var r;for(e=t(e),r=0;r<a.length;r++)if(function(e,t){for(var r=0;r<t.length;r++)if(function(e,t){for(var r=e[0],n=e[1],i=false,o=0,a=t.length-1;o<t.length;a=o++){var s=t[o][0],l=t[o][1];var u=t[a][0],c=t[a][1];var h=l>n!=c>n&&r<(u-s)*(n-l)/(c-l)+s;if(h)i=!i}return i}(t[r],e))return!0;return!1}(t(a[r]),e))return r}t=(t=t.members.filter(function(e){return"way"===e.type})).map(function(t){var e=d[t.ref];if(void 0!==e&&void 0!==e.nodes)return{id:t.ref,role:t.role||"outer",way:e,nodes:e.nodes.filter(function(e){return void 0!==e||(r=!0,L.verbose&&console.warn("Multipolygon",n+"/"+i,"tainted by a way",t.type+"/"+t.ref,"with a missing node"),!1)})};L.verbose&&console.warn("Multipolygon",n+"/"+i,"tainted by a missing or incomplete way",t.type+"/"+t.ref),r=!0});for(var a=Xu((t=z.compact(t)).filter(function(e){return"outer"===e.role})),s=Xu(t.filter(function(e){return"inner"===e.role})),l=a.map(function(e){return[e]}),u=0;u<s.length;u++){var c=o(s[u]);void 0!==c?l[c].push(s[u]):L.verbose&&console.warn("Multipolygon",n+"/"+i,"contains an inner ring with no containing outer")}var h,t=[];return 0==(t=z.compact(l.map(function(e){e=z.compact(e.map(function(e){if(!(e.length<4))return z.compact(e.map(function(e){return[+e.lon,+e.lat]}));L.verbose&&console.warn("Multipolygon",n+"/"+i,"contains a ring with less than four nodes")}));if(0!=e.length)return e;L.verbose&&console.warn("Multipolygon",n+"/"+i,"contains an empty ring cluster")}))).length?(L.verbose&&console.warn("Multipolygon",n+"/"+i,"contains no coordinates"),!1):(h="MultiPolygon",1===t.length&&(h="Polygon",t=t[0]),e={type:"Feature",id:e.type+"/"+i,properties:{type:e.type,id:i,tags:e.tags||{},relations:y[e.type][e.id]||[],meta:f(e)},geometry:{type:h,coordinates:t}},r&&(L.verbose&&console.warn("Multipolygon",n+"/"+i,"is tainted"),e.properties.tainted=!0),e)}}}for(a=0;a<t.length;a++)if(d[t[a].id]===t[a])if(z.isArray(t[a].nodes)){if(!t[a].is_skippablerelationmember){"number"!=typeof t[a].id&&(t[a].id=+t[a].id.replace("_fullGeom","")),t[a].tainted=!1,t[a].hidden=!1;var A,I=new Array;for(s=0;s<t[a].nodes.length;s++)"object"==typeof t[a].nodes[s]?I.push([+t[a].nodes[s].lon,+t[a].nodes[s].lat]):(L.verbose&&console.warn("Way",t[a].type+"/"+t[a].id,"is tainted by an invalid node"),t[a].tainted=!0);I.length<=1?L.verbose&&console.warn("Way",t[a].type+"/"+t[a].id,"ignored because it contains too few nodes"):(A="LineString",void 0!==t[a].nodes[0]&&void 0!==t[a].nodes[t[a].nodes.length-1]&&t[a].nodes[0].id===t[a].nodes[t[a].nodes.length-1].id&&(void 0!==t[a].tags&&function(e){var t=L.polygonFeatures;if("function"==typeof t)return t(e);if("no"!==e.area)for(var r in e){var n=e[r],r=t[r];if(void 0!==r&&"no"!==n){if(!0===r)return 1;if(r.included_values&&!0===r.included_values[n])return 1;if(r.excluded_values&&!0!==r.excluded_values[n])return 1}}return}(t[a].tags)||t[a].__is_bounds_placeholder)&&(A="Polygon",I=[I]),M={type:"Feature",id:t[a].type+"/"+t[a].id,properties:{type:t[a].type,id:t[a].id,tags:t[a].tags||{},relations:y.way[t[a].id]||[],meta:f(t[a])},geometry:{type:A,coordinates:I}},t[a].tainted&&(L.verbose&&console.warn("Way",t[a].type+"/"+t[a].id,"is tainted"),M.properties.tainted=!0),t[a].__is_bounds_placeholder&&(M.properties.geometry="bounds"),P?P(qu(M)):("LineString"==A?w:E).push(M))}}else L.verbose&&console.warn("Way",t[a].type+"/"+t[a].id,"ignored because it has no nodes");return!!P||((g={type:"FeatureCollection",features:[]}).features=g.features.concat(E),g.features=g.features.concat(w),g.features=g.features.concat(b),L.flatProperties&&g.features.forEach(function(e){e.properties=z.merge(e.properties.meta,e.properties.tags,{id:e.properties.type+"/"+e.properties.id})}),qu(g))}}).toGeojson=f,tc=function(e){for(var t,r,n=e.split("\n"),i=!0,o=!1,a=[],s=[],l=[],e={type:"FeatureCollection",features:[]},u=1;u<n.length;u++)if(0===n[u].indexOf("END")){if(!o){a.push(s);break}i=!(o=!1),0<l.length&&(s.push(l),l=[])}else i?(o=!(i=!1),t=0===n[u].indexOf("!"),0<s.length&&!t&&(a.push(s),s=[])):l.push(function(e){e=e.replace(/^\s*|\s*$/g,"").split(/\s+/);return[parseFloat(e[0]),parseFloat(e[1])]}(n[u]));return e.features.push({type:"Feature",properties:{},geometry:{type:1===a.length?"Polygon":"MultiPolygon",coordinates:1===(r=a).length?r[0]:r}}),e},rc=Zt;function nc(e,t){try{var r=new FileReader;r.readAsText(e),r.onload=function(e){e.target&&e.target.result?t(null,e.target.result):t({message:"Dropped file could not be loaded"})},r.onerror=function(){t({message:"Dropped file was unreadable"})}}catch(e){t({message:"Dropped file was unreadable"})}}function ic(e,r,n){e=function(e,t){const r=e.name?e.name.toLowerCase():"";function n(e){return-1!==r.indexOf(e)}if("application/vnd.google-earth.kml+xml"===e.type||n(".kml"))return"kml";if(n(".gpx"))return"gpx";if(n(".geojson")||n(".json")||n(".topojson"))return"geojson";if("text/csv"===e.type||n(".csv")||n(".tsv")||n(".dsv"))return"dsv";if(n(".xml")||n(".osm"))return"xml";if(n(".poly"))return"poly";if(t&&-1!==t.indexOf("shape_id,shape_pt_lat,shape_pt_lon")||t&&-1!==t.indexOf('"shape_id","shape_pt_lat","shape_pt_lon"'))return"gtfs-shapes";if(t&&-1!==t.indexOf("stop_id,stop_code,stop_name,stop_desc,stop_lat,stop_lon")||t&&-1!==t.indexOf('"stop_id","stop_code","stop_name","stop_desc","stop_lat","stop_lon"'))return"gtfs-stops"}(e,r);if(!e)return n({message:"Could not detect file type"});if("kml"===e){var t=s(r);if(!t)return n({message:"Invalid KML file: not valid XML"});let e;t.getElementsByTagName("NetworkLink").length&&(e={message:"The KML file you uploaded included NetworkLinks: some content may not display. Please export and upload KML without NetworkLinks for optimal performance"}),n(null,Ju.kml(t),e)}else if("xml"===e){t=s(r);if(!t)return n({message:"Invalid XML file: not valid XML"});t=ec.toGeojson(t);t.features.forEach(e=>{e.properties=e.properties.tags}),n(null,t)}else if("gpx"===e)n(null,Ju.gpx(s(r)));else if("geojson"===e)try{var i=JSON.parse(r);if(i&&"Topology"===i.type&&i.objects){var o={type:"FeatureCollection",features:[]};for(const l in i.objects){var a=Yu.feature(i,i.objects[l]);a.features?o.features=o.features.concat(a.features):o.features=o.features.concat([a])}return n(null,o)}return n(null,i)}catch(e){alert("Invalid JSON file: "+e)}else if("dsv"===e)Qu.csv2geojson(r,{delimiter:"auto"},(e,t)=>e?n({type:"geocode",result:t,raw:r}):n(null,t));else if("gtfs-shapes"===e)try{return n(null,Ku.lines(r))}catch(e){return n({message:"Invalid GTFS shapes.txt file"})}else if("gtfs-stops"===e)try{return n(null,Ku.stops(r))}catch(e){return n({message:"Invalid GTFS stops.txt file"})}else"poly"===e&&n(null,tc(r));function s(e){return(new DOMParser).parseFromString(e,"text/xml")}}o.readDrop=function(n){return function(){const i=[],o=[];if(!(d3.event.dataTransfer&&d3.event.dataTransfer&&d3.event.dataTransfer.files&&d3.event.dataTransfer.files.length))return n({message:"No files were dropped"});{d3.event.stopPropagation(),d3.event.preventDefault();let n=d3.event.dataTransfer.files.length;[].forEach.call(d3.event.dataTransfer.files,r=>{nc(r,(e,t)=>{e?(o.push(e),--n||a(o,i)):ic(r,t,(e,t,r)=>{e&&o.push(e),t&&i.push(t),r&&i.push(r),--n||a(o,i,r)})})})}function a(e,t,r){if(!t.length&&e.length)return n(e[0],null,r);n(null,{type:"FeatureCollection",features:t.reduce((e,t)=>e=(t=rc(t))?e.concat(t.features):e,[])},r)}}},o.readAsText=nc,o.readFile=ic;function oc(e){var t,r=""+e;if(!(e=ac.exec(r)))return r;var n="",i=0,o=0;for(i=e.index;i<r.length;i++){switch(r.charCodeAt(i)){case 34:t="&quot;";break;case 38:t="&amp;";break;case 39:t="&#39;";break;case 60:t="&lt;";break;case 62:t="&gt;";break;default:continue}o!==i&&(n+=r.substring(o,i)),o=i+1,n+=t}return o!==i?n+r.substring(o,i):n}var c={},ac=/["'&<>]/;function sc(){return Math.random()-.5}h={exports:{}};var lc=Zt,uc=O(Object.freeze({__proto__:null,default:function r(t){switch(t&&t.type||null){case"FeatureCollection":return t.features=t.features.reduce(function(e,t){return e.concat(r(t))},[]),t;case"Feature":return t.geometry?r(t.geometry).map(function(e){return e={type:"Feature",properties:JSON.parse(JSON.stringify(t.properties)),geometry:e},void 0!==t.id&&(e.id=t.id),e}):[t];case"MultiPoint":return t.coordinates.map(function(e){return{type:"Point",coordinates:e}});case"MultiPolygon":return t.coordinates.map(function(e){return{type:"Polygon",coordinates:e}});case"MultiLineString":return t.coordinates.map(function(e){return{type:"LineString",coordinates:e}});case"GeometryCollection":return t.geometries.map(r).reduce(function(e,t){return e.concat(t)},[]);case"Point":case"Polygon":case"LineString":return[t]}}})),cc=function(e){return function r(e){if(Array.isArray(e)&&e.length&&"number"==typeof e[0])return[e];return e.reduce(function(e,t){return Array.isArray(t)&&Array.isArray(t[0])?e.concat(r(t)):(e.push(t),e)},[])}(e)},Xi=(uc instanceof Function||(uc=uc.default),{exports:{}}),hc=Xi.exports=function(e){return new fc(e)};function fc(e){this.value=e}function dc(e,s,l){var u=[],c=[],h=!0;return function n(t){var e=l?pc(t):t,i={},r=!0,o={node:e,node_:t,path:[].concat(u),parent:c[c.length-1],parents:c,key:u.slice(-1)[0],isRoot:0===u.length,level:u.length,circular:null,update:function(e,t){o.isRoot||(o.parent.node[o.key]=e),o.node=e,t&&(r=!1)},delete:function(e){delete o.parent.node[o.key],e&&(r=!1)},remove:function(e){yc(o.parent.node)?o.parent.node.splice(o.key,1):delete o.parent.node[o.key],e&&(r=!1)},keys:null,before:function(e){i.before=e},after:function(e){i.after=e},pre:function(e){i.pre=e},post:function(e){i.post=e},stop:function(){h=!1},block:function(){r=!1}};return h&&(a(),void 0!==(e=s.call(o,o.node))&&o.update&&o.update(e),i.before&&i.before.call(o,o.node),r&&("object"!=typeof o.node||null===o.node||o.circular||(c.push(o),a(),vc(o.keys,function(e,t){u.push(e),i.pre&&i.pre.call(o,o.node[e],e);var r=n(o.node[e]);l&&_c.call(o.node,e)&&(o.node[e]=r.node),r.isLast=t==o.keys.length-1,r.isFirst=0==t,i.post&&i.post.call(o,r),u.pop()}),c.pop()),i.after&&i.after.call(o,o.node))),o;function a(){if("object"==typeof o.node&&null!==o.node){o.keys&&o.node_===o.node||(o.keys=mc(o.node)),o.isLeaf=0==o.keys.length;for(var e=0;e<c.length;e++)if(c[e].node_===t){o.circular=c[e];break}}else o.isLeaf=!0,o.keys=null;o.notLeaf=!o.isLeaf,o.notRoot=!o.isRoot}}(e).node}function pc(t){var e,r,n;return"object"==typeof t&&null!==t?(n=yc(t)?[]:"[object Date]"===gc(t)?new Date(t.getTime?t.getTime():t):"[object RegExp]"===gc(t)?new RegExp(t):"[object Error]"===gc(t)?{message:t.message}:"[object Boolean]"===gc(t)?new Boolean(t):"[object Number]"===gc(t)?new Number(t):"[object String]"===gc(t)?new String(t):Object.create&&Object.getPrototypeOf?Object.create(Object.getPrototypeOf(t)):t.constructor===Object?{}:(e=t.constructor&&t.constructor.prototype||t.__proto__||{},(r=function(){}).prototype=e,new r),vc(mc(t),function(e){n[e]=t[e]}),n):t}fc.prototype.get=function(e){for(var t=this.value,r=0;r<e.length;r++){var n=e[r];if(!t||!_c.call(t,n)){t=void 0;break}t=t[n]}return t},fc.prototype.has=function(e){for(var t=this.value,r=0;r<e.length;r++){var n=e[r];if(!t||!_c.call(t,n))return!1;t=t[n]}return!0},fc.prototype.set=function(e,t){for(var r=this.value,n=0;n<e.length-1;n++){var i=e[n];_c.call(r,i)||(r[i]={}),r=r[i]}return r[e[n]]=t},fc.prototype.map=function(e){return dc(this.value,e,!0)},fc.prototype.forEach=function(e){return this.value=dc(this.value,e,!1),this.value},fc.prototype.reduce=function(t,e){var r=1===arguments.length,n=r?this.value:e;return this.forEach(function(e){this.isRoot&&r||(n=t.call(this,n,e))}),n},fc.prototype.paths=function(){var t=[];return this.forEach(function(e){t.push(this.path)}),t},fc.prototype.nodes=function(){var t=[];return this.forEach(function(e){t.push(this.node)}),t},fc.prototype.clone=function(){var i=[],o=[];return function t(r){for(var n,e=0;e<i.length;e++)if(i[e]===r)return o[e];return"object"==typeof r&&null!==r?(n=pc(r),i.push(r),o.push(n),vc(mc(r),function(e){n[e]=t(r[e])}),i.pop(),o.pop(),n):r}(this.value)};var mc=Object.keys||function(e){var t,r=[];for(t in e)r.push(t);return r};function gc(e){return Object.prototype.toString.call(e)}var yc=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},vc=function(e,t){if(e.forEach)return e.forEach(t);for(var r=0;r<e.length;r++)t(e[r],r,e)},_c=(vc(mc(fc.prototype),function(n){hc[n]=function(e){var t=[].slice.call(arguments,1),r=new fc(e);return r[n].apply(r,t)}}),Object.hasOwnProperty||function(e,t){return t in e}),e=xc;function xc(e){if(!(this instanceof xc))return new xc(e);this._bbox=e||[1/0,1/0,-1/0,-1/0],this._valid=!!e}xc.prototype.include=function(e){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],e[0]),this._bbox[1]=Math.min(this._bbox[1],e[1]),this._bbox[2]=Math.max(this._bbox[2],e[0]),this._bbox[3]=Math.max(this._bbox[3],e[1]),this},xc.prototype.equals=function(e){e=e instanceof xc?e.bbox():e;return this._bbox[0]==e[0]&&this._bbox[1]==e[1]&&this._bbox[2]==e[2]&&this._bbox[3]==e[3]},xc.prototype.center=function(e){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},xc.prototype.union=function(e){return this._valid=!0,e=e instanceof xc?e.bbox():e,this._bbox[0]=Math.min(this._bbox[0],e[0]),this._bbox[1]=Math.min(this._bbox[1],e[1]),this._bbox[2]=Math.max(this._bbox[2],e[2]),this._bbox[3]=Math.max(this._bbox[3],e[3]),this},xc.prototype.bbox=function(){return this._valid?this._bbox:null},xc.prototype.contains=function(e){var t;return e?this._valid?(t=e[0],e=e[1],this._bbox[0]<=t&&this._bbox[1]<=e&&this._bbox[2]>=t&&this._bbox[3]>=e):null:this._fastContains()},xc.prototype.intersect=function(e){return this._valid?(e=e instanceof xc?e.bbox():e,!(this._bbox[0]>e[2]||this._bbox[2]<e[0]||this._bbox[3]<e[1]||this._bbox[1]>e[3])):null},xc.prototype._fastContains=function(){var e;return this._valid?(e="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]",new Function("ll",e)):new Function("return null;")},xc.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var bc=function(e){var t;return e?(e=uc(lc(e)),t=[],e.features.forEach(function(e){e.geometry&&(t=t.concat(cc(e.geometry.coordinates)))}),t):[]},wc=Xi.exports,Ec=e,Tc={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Sc=Object.keys(Tc);function Mc(e){for(var t=Ec(),r=bc(e),n=0;n<r.length;n++)t.include(r[n]);return t}h.exports=function(e){return Mc(e).bbox()},h.exports.polygon=function(e){return Mc(e).polygon()},h.exports.bboxify=function(e){return wc(e).map(function(t){t&&Sc.some(function(e){return!!t[e]&&-1!==Tc[e].indexOf(t.type)})&&(t.bbox=Mc(t).bbox(),this.update(t))})};var kc,a=O(Object.freeze({__proto__:null,default:function r(t){switch(t&&t.type||null){case"FeatureCollection":return t.features=t.features.reduce(function(e,t){return e.concat(r(t))},[]),t;case"Feature":return t.geometry?r(t.geometry).map(function(e){return e={type:"Feature",properties:JSON.parse(JSON.stringify(t.properties)),geometry:e},void 0!==t.id&&(e.id=t.id),e}):[t];case"MultiPoint":return t.coordinates.map(function(e){return{type:"Point",coordinates:e}});case"MultiPolygon":return t.coordinates.map(function(e){return{type:"Polygon",coordinates:e}});case"MultiLineString":return t.coordinates.map(function(e){return{type:"LineString",coordinates:e}});case"GeometryCollection":return t.geometries.map(r).reduce(function(e,t){return e.concat(t)},[]);case"Point":case"Polygon":case"LineString":return[t]}}})),d={exports:{}};function Cc(e){return Math.floor(Math.abs(e)+.5)*(0<=e?1:-1)}function Ac(e,t,r){for(var n=(e=Cc(e*r))-(t=Cc(t*r)),i=(n<<=1,e-t<0&&(n=~n),"");32<=n;)i+=String.fromCharCode(63+(32|31&n)),n>>=5;return i+=String.fromCharCode(n+63)}function Ic(e){for(var t=[],r=0;r<e.length;r++){var n=e[r].slice();t.push([n[1],n[0]])}return t}kc={decode:function(e,t){for(var r,n=0,i=0,o=0,a=[],s=0,l=0,u=null,c=Math.pow(10,Number.isInteger(t)?t:5);n<e.length;){for(u=null,l=s=0;l|=(31&(u=e.charCodeAt(n++)-63))<<s,s+=5,32<=u;);for(r=1&l?~(l>>1):l>>1,s=l=0;l|=(31&(u=e.charCodeAt(n++)-63))<<s,s+=5,32<=u;);a.push([(i+=r)/c,(o+=1&l?~(l>>1):l>>1)/c])}return a},encode:function(e,t){if(!e.length)return"";for(var r=Math.pow(10,Number.isInteger(t)?t:5),n=Ac(e[0][0],0,r)+Ac(e[0][1],0,r),i=1;i<e.length;i++)var o=e[i],a=e[i-1],n=(n+=Ac(o[0],a[0],r))+Ac(o[1],a[1],r);return n},fromGeoJSON:function(e,t){if((e=e&&"Feature"===e.type?e.geometry:e)&&"LineString"===e.type)return kc.encode(Ic(e.coordinates),t);throw new Error("Input must be a GeoJSON LineString")},toGeoJSON:function(e,t){return{type:"LineString",coordinates:Ic(kc.decode(e,t))}}},(s=d).exports&&(s.exports=kc);var g={},Lc={wkt:{Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION"},wkb:{Point:1,LineString:2,Polygon:3,MultiPoint:4,MultiLineString:5,MultiPolygon:6,GeometryCollection:7},geoJSON:{Point:"Point",LineString:"LineString",Polygon:"Polygon",MultiPoint:"MultiPoint",MultiLineString:"MultiLineString",MultiPolygon:"MultiPolygon",GeometryCollection:"GeometryCollection"}},Pc=O(m),zc=Dc;function Dc(e,t){this.buffer=new b(e),this.position=0,this.allowResize=t}function Oc(r,n){return function(e,t){this.ensureSize(n),r.call(this.buffer,e,this.position,t),this.position+=n}}Dc.prototype.writeUInt8=Oc(b.prototype.writeUInt8,1),Dc.prototype.writeUInt16LE=Oc(b.prototype.writeUInt16LE,2),Dc.prototype.writeUInt16BE=Oc(b.prototype.writeUInt16BE,2),Dc.prototype.writeUInt32LE=Oc(b.prototype.writeUInt32LE,4),Dc.prototype.writeUInt32BE=Oc(b.prototype.writeUInt32BE,4),Dc.prototype.writeInt8=Oc(b.prototype.writeInt8,1),Dc.prototype.writeInt16LE=Oc(b.prototype.writeInt16LE,2),Dc.prototype.writeInt16BE=Oc(b.prototype.writeInt16BE,2),Dc.prototype.writeInt32LE=Oc(b.prototype.writeInt32LE,4),Dc.prototype.writeInt32BE=Oc(b.prototype.writeInt32BE,4),Dc.prototype.writeFloatLE=Oc(b.prototype.writeFloatLE,4),Dc.prototype.writeFloatBE=Oc(b.prototype.writeFloatBE,4),Dc.prototype.writeDoubleLE=Oc(b.prototype.writeDoubleLE,8),Dc.prototype.writeDoubleBE=Oc(b.prototype.writeDoubleBE,8),Dc.prototype.writeBuffer=function(e){this.ensureSize(e.length),e.copy(this.buffer,this.position,0,e.length),this.position+=e.length},Dc.prototype.writeVarInt=function(e){for(var t=1;0!=(4294967168&e);)this.writeUInt8(127&e|128),e>>>=7,t++;return this.writeUInt8(127&e),t},Dc.prototype.ensureSize=function(e){if(this.buffer.length<this.position+e){if(!this.allowResize)throw new RangeError("index out of range");e=new b(this.position+e);this.buffer.copy(e,0,0,this.buffer.length),this.buffer=e}};var Rc,Fc,Bc,Nc,jc,Uc,Vc,Gc,Wc,Zc,qc,Hc,$c,Xc,Yc={encode:function(e){return e<<1^e>>31},decode:function(e){return e>>1^-(1&e)}};function Jc(){var e,o,n,i,a;return Fc||(Fc=1,Rc=s,e=Pc,o=hh(),n=Lc,i=zc,a=Yc,e.inherits(s,o),s.Z=function(e,t,r,n){e=new s(e,t,r,void 0,n);return e.hasZ=!0,e},s.M=function(e,t,r,n){e=new s(e,t,void 0,r,n);return e.hasM=!0,e},s.ZM=function(e,t,r,n,i){e=new s(e,t,r,n,i);return e.hasZ=!0,e.hasM=!0,e},s._parseWkt=function(e,t){var r=new s;return r.srid=t.srid,r.hasZ=t.hasZ,r.hasM=t.hasM,e.isMatch(["EMPTY"])||(e.expectGroupStart(),t=e.matchCoordinate(t),r.x=t.x,r.y=t.y,r.z=t.z,r.m=t.m,e.expectGroupEnd()),r},s._parseWkb=function(e,t){e=s._readWkbPoint(e,t);return e.srid=t.srid,e},s._readWkbPoint=function(e,t){return new s(e.readDouble(),e.readDouble(),t.hasZ?e.readDouble():void 0,t.hasM?e.readDouble():void 0)},s._parseTwkb=function(e,t){var r=new s;return r.hasZ=t.hasZ,r.hasM=t.hasM,t.isEmpty||(r.x=a.decode(e.readVarInt())/t.precisionFactor,r.y=a.decode(e.readVarInt())/t.precisionFactor,r.z=t.hasZ?a.decode(e.readVarInt())/t.zPrecisionFactor:void 0,r.m=t.hasM?a.decode(e.readVarInt())/t.mPrecisionFactor:void 0),r},s._readTwkbPoint=function(e,t,r){return r.x+=a.decode(e.readVarInt())/t.precisionFactor,r.y+=a.decode(e.readVarInt())/t.precisionFactor,t.hasZ&&(r.z+=a.decode(e.readVarInt())/t.zPrecisionFactor),t.hasM&&(r.m+=a.decode(e.readVarInt())/t.mPrecisionFactor),new s(r.x,r.y,r.z,r.m)},s._parseGeoJSON=function(e){return s._readGeoJSONPoint(e.coordinates)},s._readGeoJSONPoint=function(e){return 0===e.length?new s:2<e.length?new s(e[0],e[1],e[2]):new s(e[0],e[1])},s.prototype.toWkt=function(){return void 0===this.x&&void 0===this.y&&void 0===this.z&&void 0===this.m?this._getWktType(n.wkt.Point,!0):this._getWktType(n.wkt.Point,!1)+"("+this._getWktCoordinate(this)+")"},s.prototype.toWkb=function(e){var t=new i(this._getWkbSize());return t.writeInt8(1),this._writeWkbType(t,n.wkb.Point,e),void 0===this.x&&void 0===this.y?(t.writeDoubleLE(NaN),t.writeDoubleLE(NaN),this.hasZ&&t.writeDoubleLE(NaN),this.hasM&&t.writeDoubleLE(NaN)):this._writeWkbPoint(t),t.buffer},s.prototype._writeWkbPoint=function(e){e.writeDoubleLE(this.x),e.writeDoubleLE(this.y),this.hasZ&&e.writeDoubleLE(this.z),this.hasM&&e.writeDoubleLE(this.m)},s.prototype.toTwkb=function(){var e=new i(0,!0),t=o.getTwkbPrecision(5,0,0),r=void 0===this.x&&void 0===this.y;return this._writeTwkbHeader(e,n.wkb.Point,t,r),r||this._writeTwkbPoint(e,t,new s(0,0,0,0)),e.buffer},s.prototype._writeTwkbPoint=function(e,t,r){var n=this.x*t.xyFactor,i=this.y*t.xyFactor,o=this.z*t.zFactor,t=this.m*t.mFactor;e.writeVarInt(a.encode(n-r.x)),e.writeVarInt(a.encode(i-r.y)),this.hasZ&&e.writeVarInt(a.encode(o-r.z)),this.hasM&&e.writeVarInt(a.encode(t-r.m)),r.x=n,r.y=i,r.z=o,r.m=t},s.prototype._getWkbSize=function(){var e=21;return this.hasZ&&(e+=8),this.hasM&&(e+=8),e},s.prototype.toGeoJSON=function(e){e=o.prototype.toGeoJSON.call(this,e);return e.type=n.geoJSON.Point,void 0===this.x&&void 0===this.y?e.coordinates=[]:void 0!==this.z?e.coordinates=[this.x,this.y,this.z]:e.coordinates=[this.x,this.y],e}),Rc;function s(e,t,r,n,i){o.call(this),this.x=e,this.y=t,this.z=r,this.m=n,this.srid=i,this.hasZ=void 0!==this.z,this.hasM=void 0!==this.m}}function Kc(){var e,o,a,s,l;return Nc||(Nc=1,Bc=u,e=Pc,o=hh(),a=Lc,s=Jc(),l=zc,e.inherits(u,o),u.Z=function(e,t){e=new u(e,t);return e.hasZ=!0,e},u.M=function(e,t){e=new u(e,t);return e.hasM=!0,e},u.ZM=function(e,t){e=new u(e,t);return e.hasZ=!0,e.hasM=!0,e},u._parseWkt=function(e,t){var r=new u;return r.srid=t.srid,r.hasZ=t.hasZ,r.hasM=t.hasM,e.isMatch(["EMPTY"])||(e.expectGroupStart(),r.points.push.apply(r.points,e.matchCoordinates(t)),e.expectGroupEnd()),r},u._parseWkb=function(e,t){for(var r=new u,n=(r.srid=t.srid,r.hasZ=t.hasZ,r.hasM=t.hasM,e.readUInt32()),i=0;i<n;i++)r.points.push(s._readWkbPoint(e,t));return r},u._parseTwkb=function(e,t){var r=new u;if(r.hasZ=t.hasZ,r.hasM=t.hasM,!t.isEmpty)for(var n=new s(0,0,t.hasZ?0:void 0,t.hasM?0:void 0),i=e.readVarInt(),o=0;o<i;o++)r.points.push(s._readTwkbPoint(e,t,n));return r},u._parseGeoJSON=function(e){var t=new u;0<e.coordinates.length&&(t.hasZ=2<e.coordinates[0].length);for(var r=0;r<e.coordinates.length;r++)t.points.push(s._readGeoJSONPoint(e.coordinates[r]));return t},u.prototype.toWkt=function(){return 0===this.points.length?this._getWktType(a.wkt.LineString,!0):this._getWktType(a.wkt.LineString,!1)+this._toInnerWkt()},u.prototype._toInnerWkt=function(){for(var e="(",t=0;t<this.points.length;t++)e+=this._getWktCoordinate(this.points[t])+",";return e=e.slice(0,-1),e+=")"},u.prototype.toWkb=function(e){var t=new l(this._getWkbSize());t.writeInt8(1),this._writeWkbType(t,a.wkb.LineString,e),t.writeUInt32LE(this.points.length);for(var r=0;r<this.points.length;r++)this.points[r]._writeWkbPoint(t);return t.buffer},u.prototype.toTwkb=function(){var e=new l(0,!0),t=o.getTwkbPrecision(5,0,0),r=0===this.points.length;if(this._writeTwkbHeader(e,a.wkb.LineString,t,r),0<this.points.length){e.writeVarInt(this.points.length);for(var n=new s(0,0,0,0),i=0;i<this.points.length;i++)this.points[i]._writeTwkbPoint(e,t,n)}return e.buffer},u.prototype._getWkbSize=function(){var e=16;return this.hasZ&&(e+=8),this.hasM&&(e+=8),9+this.points.length*e},u.prototype.toGeoJSON=function(e){var t=o.prototype.toGeoJSON.call(this,e);t.type=a.geoJSON.LineString,t.coordinates=[];for(var r=0;r<this.points.length;r++)this.hasZ?t.coordinates.push([this.points[r].x,this.points[r].y,this.points[r].z]):t.coordinates.push([this.points[r].x,this.points[r].y]);return t}),Bc;function u(e,t){o.call(this),this.points=e||[],this.srid=t,0<this.points.length&&(this.hasZ=this.points[0].hasZ,this.hasM=this.points[0].hasM)}}function Qc(){var e,s,l,c,a;return Uc||(Uc=1,jc=h,e=Pc,s=hh(),l=Lc,c=Jc(),a=zc,e.inherits(h,s),h.Z=function(e,t,r){e=new h(e,t,r);return e.hasZ=!0,e},h.M=function(e,t,r){e=new h(e,t,r);return e.hasM=!0,e},h.ZM=function(e,t,r){e=new h(e,t,r);return e.hasZ=!0,e.hasM=!0,e},h._parseWkt=function(e,t){var r=new h;if(r.srid=t.srid,r.hasZ=t.hasZ,r.hasM=t.hasM,!e.isMatch(["EMPTY"])){for(e.expectGroupStart(),e.expectGroupStart(),r.exteriorRing.push.apply(r.exteriorRing,e.matchCoordinates(t)),e.expectGroupEnd();e.isMatch([","]);)e.expectGroupStart(),r.interiorRings.push(e.matchCoordinates(t)),e.expectGroupEnd();e.expectGroupEnd()}return r},h._parseWkb=function(e,t){var r=new h,n=(r.srid=t.srid,r.hasZ=t.hasZ,r.hasM=t.hasM,e.readUInt32());if(0<n){for(var i=e.readUInt32(),o=0;o<i;o++)r.exteriorRing.push(c._readWkbPoint(e,t));for(o=1;o<n;o++){for(var a=[],s=e.readUInt32(),l=0;l<s;l++)a.push(c._readWkbPoint(e,t));r.interiorRings.push(a)}}return r},h._parseTwkb=function(e,t){var r=new h;if(r.hasZ=t.hasZ,r.hasM=t.hasM,!t.isEmpty){for(var n=new c(0,0,t.hasZ?0:void 0,t.hasM?0:void 0),i=e.readVarInt(),o=e.readVarInt(),a=0;a<o;a++)r.exteriorRing.push(c._readTwkbPoint(e,t,n));for(a=1;a<i;a++){for(var s=[],l=e.readVarInt(),u=0;u<l;u++)s.push(c._readTwkbPoint(e,t,n));r.interiorRings.push(s)}}return r},h._parseGeoJSON=function(e){var t=new h;0<e.coordinates.length&&0<e.coordinates[0].length&&(t.hasZ=2<e.coordinates[0][0].length);for(var r=0;r<e.coordinates.length;r++){0<r&&t.interiorRings.push([]);for(var n=0;n<e.coordinates[r].length;n++)(0===r?t.exteriorRing:t.interiorRings[r-1]).push(c._readGeoJSONPoint(e.coordinates[r][n]))}return t},h.prototype.toWkt=function(){return 0===this.exteriorRing.length?this._getWktType(l.wkt.Polygon,!0):this._getWktType(l.wkt.Polygon,!1)+this._toInnerWkt()},h.prototype._toInnerWkt=function(){for(var e="((",t=0;t<this.exteriorRing.length;t++)e+=this._getWktCoordinate(this.exteriorRing[t])+",";for(e=e.slice(0,-1),e+=")",t=0;t<this.interiorRings.length;t++){e+=",(";for(var r=0;r<this.interiorRings[t].length;r++)e+=this._getWktCoordinate(this.interiorRings[t][r])+",";e=e.slice(0,-1),e+=")"}return e+=")"},h.prototype.toWkb=function(e){var t=new a(this._getWkbSize());t.writeInt8(1),this._writeWkbType(t,l.wkb.Polygon,e),0<this.exteriorRing.length?(t.writeUInt32LE(1+this.interiorRings.length),t.writeUInt32LE(this.exteriorRing.length)):t.writeUInt32LE(0);for(var r=0;r<this.exteriorRing.length;r++)this.exteriorRing[r]._writeWkbPoint(t);for(r=0;r<this.interiorRings.length;r++){t.writeUInt32LE(this.interiorRings[r].length);for(var n=0;n<this.interiorRings[r].length;n++)this.interiorRings[r][n]._writeWkbPoint(t)}return t.buffer},h.prototype.toTwkb=function(){var e=new a(0,!0),t=s.getTwkbPrecision(5,0,0),r=0===this.exteriorRing.length;if(this._writeTwkbHeader(e,l.wkb.Polygon,t,r),0<this.exteriorRing.length){e.writeVarInt(1+this.interiorRings.length),e.writeVarInt(this.exteriorRing.length);for(var n=new c(0,0,0,0),i=0;i<this.exteriorRing.length;i++)this.exteriorRing[i]._writeTwkbPoint(e,t,n);for(i=0;i<this.interiorRings.length;i++){e.writeVarInt(this.interiorRings[i].length);for(var o=0;o<this.interiorRings[i].length;o++)this.interiorRings[i][o]._writeTwkbPoint(e,t,n)}}return e.buffer},h.prototype._getWkbSize=function(){var e=16,t=(this.hasZ&&(e+=8),this.hasM&&(e+=8),9);0<this.exteriorRing.length&&(t+=4+this.exteriorRing.length*e);for(var r=0;r<this.interiorRings.length;r++)t+=4+this.interiorRings[r].length*e;return t},h.prototype.toGeoJSON=function(e){var t=s.prototype.toGeoJSON.call(this,e);if(t.type=l.geoJSON.Polygon,t.coordinates=[],0<this.exteriorRing.length){for(var r=[],n=0;n<this.exteriorRing.length;n++)this.hasZ?r.push([this.exteriorRing[n].x,this.exteriorRing[n].y,this.exteriorRing[n].z]):r.push([this.exteriorRing[n].x,this.exteriorRing[n].y]);t.coordinates.push(r)}for(var i=0;i<this.interiorRings.length;i++){for(var o=[],a=0;a<this.interiorRings[i].length;a++)this.hasZ?o.push([this.interiorRings[i][a].x,this.interiorRings[i][a].y,this.interiorRings[i][a].z]):o.push([this.interiorRings[i][a].x,this.interiorRings[i][a].y]);t.coordinates.push(o)}return t}),jc;function h(e,t,r){s.call(this),this.exteriorRing=e||[],this.interiorRings=t||[],this.srid=r,0<this.exteriorRing.length&&(this.hasZ=this.exteriorRing[0].hasZ,this.hasM=this.exteriorRing[0].hasM)}}function eh(){var e,o,a,s,l;return Gc||(Gc=1,Vc=u,e=Pc,o=Lc,a=hh(),s=Jc(),l=zc,e.inherits(u,a),u.Z=function(e,t){e=new u(e,t);return e.hasZ=!0,e},u.M=function(e,t){e=new u(e,t);return e.hasM=!0,e},u.ZM=function(e,t){e=new u(e,t);return e.hasZ=!0,e.hasM=!0,e},u._parseWkt=function(e,t){var r=new u;return r.srid=t.srid,r.hasZ=t.hasZ,r.hasM=t.hasM,e.isMatch(["EMPTY"])||(e.expectGroupStart(),r.points.push.apply(r.points,e.matchCoordinates(t)),e.expectGroupEnd()),r},u._parseWkb=function(e,t){for(var r=new u,n=(r.srid=t.srid,r.hasZ=t.hasZ,r.hasM=t.hasM,e.readUInt32()),i=0;i<n;i++)r.points.push(a.parse(e,t));return r},u._parseTwkb=function(e,t){var r=new u;if(r.hasZ=t.hasZ,r.hasM=t.hasM,!t.isEmpty)for(var n=new s(0,0,t.hasZ?0:void 0,t.hasM?0:void 0),i=e.readVarInt(),o=0;o<i;o++)r.points.push(s._readTwkbPoint(e,t,n));return r},u._parseGeoJSON=function(e){var t=new u;0<e.coordinates.length&&(t.hasZ=2<e.coordinates[0].length);for(var r=0;r<e.coordinates.length;r++)t.points.push(s._parseGeoJSON({coordinates:e.coordinates[r]}));return t},u.prototype.toWkt=function(){if(0===this.points.length)return this._getWktType(o.wkt.MultiPoint,!0);for(var e=this._getWktType(o.wkt.MultiPoint,!1)+"(",t=0;t<this.points.length;t++)e+=this._getWktCoordinate(this.points[t])+",";return e=e.slice(0,-1),e+=")"},u.prototype.toWkb=function(){var e=new l(this._getWkbSize());e.writeInt8(1),this._writeWkbType(e,o.wkb.MultiPoint),e.writeUInt32LE(this.points.length);for(var t=0;t<this.points.length;t++)e.writeBuffer(this.points[t].toWkb({srid:this.srid}));return e.buffer},u.prototype.toTwkb=function(){var e=new l(0,!0),t=a.getTwkbPrecision(5,0,0),r=0===this.points.length;if(this._writeTwkbHeader(e,o.wkb.MultiPoint,t,r),0<this.points.length){e.writeVarInt(this.points.length);for(var n=new s(0,0,0,0),i=0;i<this.points.length;i++)this.points[i]._writeTwkbPoint(e,t,n)}return e.buffer},u.prototype._getWkbSize=function(){var e=16;return this.hasZ&&(e+=8),this.hasM&&(e+=8),9+this.points.length*(e+=5)},u.prototype.toGeoJSON=function(e){var t=a.prototype.toGeoJSON.call(this,e);t.type=o.geoJSON.MultiPoint,t.coordinates=[];for(var r=0;r<this.points.length;r++)t.coordinates.push(this.points[r].toGeoJSON().coordinates);return t}),Vc;function u(e,t){a.call(this),this.points=e||[],this.srid=t,0<this.points.length&&(this.hasZ=this.points[0].hasZ,this.hasM=this.points[0].hasM)}}function th(){var e,a,s,u,c,l;return Zc||(Zc=1,Wc=h,e=Pc,a=Lc,s=hh(),u=Jc(),c=Kc(),l=zc,e.inherits(h,s),h.Z=function(e,t){e=new h(e,t);return e.hasZ=!0,e},h.M=function(e,t){e=new h(e,t);return e.hasM=!0,e},h.ZM=function(e,t){e=new h(e,t);return e.hasZ=!0,e.hasM=!0,e},h._parseWkt=function(e,t){var r=new h;if(r.srid=t.srid,r.hasZ=t.hasZ,r.hasM=t.hasM,!e.isMatch(["EMPTY"])){for(e.expectGroupStart();e.expectGroupStart(),r.lineStrings.push(new c(e.matchCoordinates(t))),e.expectGroupEnd(),e.isMatch([","]););e.expectGroupEnd()}return r},h._parseWkb=function(e,t){for(var r=new h,n=(r.srid=t.srid,r.hasZ=t.hasZ,r.hasM=t.hasM,e.readUInt32()),i=0;i<n;i++)r.lineStrings.push(s.parse(e,t));return r},h._parseTwkb=function(e,t){var r=new h;if(r.hasZ=t.hasZ,r.hasM=t.hasM,!t.isEmpty)for(var n=new u(0,0,t.hasZ?0:void 0,t.hasM?0:void 0),i=e.readVarInt(),o=0;o<i;o++){for(var a=new c,s=(a.hasZ=t.hasZ,a.hasM=t.hasM,e.readVarInt()),l=0;l<s;l++)a.points.push(u._readTwkbPoint(e,t,n));r.lineStrings.push(a)}return r},h._parseGeoJSON=function(e){var t=new h;0<e.coordinates.length&&0<e.coordinates[0].length&&(t.hasZ=2<e.coordinates[0][0].length);for(var r=0;r<e.coordinates.length;r++)t.lineStrings.push(c._parseGeoJSON({coordinates:e.coordinates[r]}));return t},h.prototype.toWkt=function(){if(0===this.lineStrings.length)return this._getWktType(a.wkt.MultiLineString,!0);for(var e=this._getWktType(a.wkt.MultiLineString,!1)+"(",t=0;t<this.lineStrings.length;t++)e+=this.lineStrings[t]._toInnerWkt()+",";return e=e.slice(0,-1),e+=")"},h.prototype.toWkb=function(){var e=new l(this._getWkbSize());e.writeInt8(1),this._writeWkbType(e,a.wkb.MultiLineString),e.writeUInt32LE(this.lineStrings.length);for(var t=0;t<this.lineStrings.length;t++)e.writeBuffer(this.lineStrings[t].toWkb({srid:this.srid}));return e.buffer},h.prototype.toTwkb=function(){var e=new l(0,!0),t=s.getTwkbPrecision(5,0,0),r=0===this.lineStrings.length;if(this._writeTwkbHeader(e,a.wkb.MultiLineString,t,r),0<this.lineStrings.length){e.writeVarInt(this.lineStrings.length);for(var n=new u(0,0,0,0),i=0;i<this.lineStrings.length;i++){e.writeVarInt(this.lineStrings[i].points.length);for(var o=0;o<this.lineStrings[i].points.length;o++)this.lineStrings[i].points[o]._writeTwkbPoint(e,t,n)}}return e.buffer},h.prototype._getWkbSize=function(){for(var e=9,t=0;t<this.lineStrings.length;t++)e+=this.lineStrings[t]._getWkbSize();return e},h.prototype.toGeoJSON=function(e){var t=s.prototype.toGeoJSON.call(this,e);t.type=a.geoJSON.MultiLineString,t.coordinates=[];for(var r=0;r<this.lineStrings.length;r++)t.coordinates.push(this.lineStrings[r].toGeoJSON().coordinates);return t}),Wc;function h(e,t){s.call(this),this.lineStrings=e||[],this.srid=t,0<this.lineStrings.length&&(this.hasZ=this.lineStrings[0].hasZ,this.hasM=this.lineStrings[0].hasM)}}function rh(){var e,s,l,d,p,u;return Hc||(Hc=1,qc=m,e=Pc,s=Lc,l=hh(),d=Jc(),p=Qc(),u=zc,e.inherits(m,l),m.Z=function(e,t){e=new m(e,t);return e.hasZ=!0,e},m.M=function(e,t){e=new m(e,t);return e.hasM=!0,e},m.ZM=function(e,t){e=new m(e,t);return e.hasZ=!0,e.hasM=!0,e},m._parseWkt=function(e,t){var r=new m;if(r.srid=t.srid,r.hasZ=t.hasZ,r.hasM=t.hasM,!e.isMatch(["EMPTY"])){e.expectGroupStart();do{e.expectGroupStart();var n=[],i=[];for(e.expectGroupStart(),n.push.apply(n,e.matchCoordinates(t)),e.expectGroupEnd();e.isMatch([","]);)e.expectGroupStart(),i.push(e.matchCoordinates(t)),e.expectGroupEnd()}while(r.polygons.push(new p(n,i)),e.expectGroupEnd(),e.isMatch([","]));e.expectGroupEnd()}return r},m._parseWkb=function(e,t){for(var r=new m,n=(r.srid=t.srid,r.hasZ=t.hasZ,r.hasM=t.hasM,e.readUInt32()),i=0;i<n;i++)r.polygons.push(l.parse(e,t));return r},m._parseTwkb=function(e,t){var r=new m;if(r.hasZ=t.hasZ,r.hasM=t.hasM,!t.isEmpty)for(var n=new d(0,0,t.hasZ?0:void 0,t.hasM?0:void 0),i=e.readVarInt(),o=0;o<i;o++){for(var a=new p,s=(a.hasZ=t.hasZ,a.hasM=t.hasM,e.readVarInt()),l=e.readVarInt(),u=0;u<l;u++)a.exteriorRing.push(d._readTwkbPoint(e,t,n));for(u=1;u<s;u++){for(var c=[],h=e.readVarInt(),f=0;f<h;f++)c.push(d._readTwkbPoint(e,t,n));a.interiorRings.push(c)}r.polygons.push(a)}return r},m._parseGeoJSON=function(e){var t=new m;0<e.coordinates.length&&0<e.coordinates[0].length&&0<e.coordinates[0][0].length&&(t.hasZ=2<e.coordinates[0][0][0].length);for(var r=0;r<e.coordinates.length;r++)t.polygons.push(p._parseGeoJSON({coordinates:e.coordinates[r]}));return t},m.prototype.toWkt=function(){if(0===this.polygons.length)return this._getWktType(s.wkt.MultiPolygon,!0);for(var e=this._getWktType(s.wkt.MultiPolygon,!1)+"(",t=0;t<this.polygons.length;t++)e+=this.polygons[t]._toInnerWkt()+",";return e=e.slice(0,-1),e+=")"},m.prototype.toWkb=function(){var e=new u(this._getWkbSize());e.writeInt8(1),this._writeWkbType(e,s.wkb.MultiPolygon),e.writeUInt32LE(this.polygons.length);for(var t=0;t<this.polygons.length;t++)e.writeBuffer(this.polygons[t].toWkb({srid:this.srid}));return e.buffer},m.prototype.toTwkb=function(){var e=new u(0,!0),t=l.getTwkbPrecision(5,0,0),r=0===this.polygons.length;if(this._writeTwkbHeader(e,s.wkb.MultiPolygon,t,r),0<this.polygons.length){e.writeVarInt(this.polygons.length);for(var n=new d(0,0,0,0),i=0;i<this.polygons.length;i++){e.writeVarInt(1+this.polygons[i].interiorRings.length),e.writeVarInt(this.polygons[i].exteriorRing.length);for(var o=0;o<this.polygons[i].exteriorRing.length;o++)this.polygons[i].exteriorRing[o]._writeTwkbPoint(e,t,n);for(o=0;o<this.polygons[i].interiorRings.length;o++){e.writeVarInt(this.polygons[i].interiorRings[o].length);for(var a=0;a<this.polygons[i].interiorRings[o].length;a++)this.polygons[i].interiorRings[o][a]._writeTwkbPoint(e,t,n)}}}return e.buffer},m.prototype._getWkbSize=function(){for(var e=9,t=0;t<this.polygons.length;t++)e+=this.polygons[t]._getWkbSize();return e},m.prototype.toGeoJSON=function(e){var t=l.prototype.toGeoJSON.call(this,e);t.type=s.geoJSON.MultiPolygon,t.coordinates=[];for(var r=0;r<this.polygons.length;r++)t.coordinates.push(this.polygons[r].toGeoJSON().coordinates);return t}),qc;function m(e,t){l.call(this),this.polygons=e||[],this.srid=t,0<this.polygons.length&&(this.hasZ=this.polygons[0].hasZ,this.hasM=this.polygons[0].hasM)}}function nh(){var e,i,o,a;return Xc||(Xc=1,$c=s,e=Pc,i=Lc,o=hh(),a=zc,e.inherits(s,o),s.Z=function(e,t){e=new s(e,t);return e.hasZ=!0,e},s.M=function(e,t){e=new s(e,t);return e.hasM=!0,e},s.ZM=function(e,t){e=new s(e,t);return e.hasZ=!0,e.hasM=!0,e},s._parseWkt=function(e,t){var r=new s;if(r.srid=t.srid,r.hasZ=t.hasZ,r.hasM=t.hasM,!e.isMatch(["EMPTY"])){for(e.expectGroupStart();r.geometries.push(o.parse(e)),e.isMatch([","]););e.expectGroupEnd()}return r},s._parseWkb=function(e,t){for(var r=new s,n=(r.srid=t.srid,r.hasZ=t.hasZ,r.hasM=t.hasM,e.readUInt32()),i=0;i<n;i++)r.geometries.push(o.parse(e,t));return r},s._parseTwkb=function(e,t){var r=new s;if(r.hasZ=t.hasZ,r.hasM=t.hasM,!t.isEmpty)for(var n=e.readVarInt(),i=0;i<n;i++)r.geometries.push(o.parseTwkb(e));return r},s._parseGeoJSON=function(e){for(var t=new s,r=0;r<e.geometries.length;r++)t.geometries.push(o._parseGeoJSON(e.geometries[r],!0));return 0<t.geometries.length&&(t.hasZ=t.geometries[0].hasZ),t},s.prototype.toWkt=function(){if(0===this.geometries.length)return this._getWktType(i.wkt.GeometryCollection,!0);for(var e=this._getWktType(i.wkt.GeometryCollection,!1)+"(",t=0;t<this.geometries.length;t++)e+=this.geometries[t].toWkt()+",";return e=e.slice(0,-1),e+=")"},s.prototype.toWkb=function(){var e=new a(this._getWkbSize());e.writeInt8(1),this._writeWkbType(e,i.wkb.GeometryCollection),e.writeUInt32LE(this.geometries.length);for(var t=0;t<this.geometries.length;t++)e.writeBuffer(this.geometries[t].toWkb({srid:this.srid}));return e.buffer},s.prototype.toTwkb=function(){var e=new a(0,!0),t=o.getTwkbPrecision(5,0,0),r=0===this.geometries.length;if(this._writeTwkbHeader(e,i.wkb.GeometryCollection,t,r),0<this.geometries.length){e.writeVarInt(this.geometries.length);for(var n=0;n<this.geometries.length;n++)e.writeBuffer(this.geometries[n].toTwkb())}return e.buffer},s.prototype._getWkbSize=function(){for(var e=9,t=0;t<this.geometries.length;t++)e+=this.geometries[t]._getWkbSize();return e},s.prototype.toGeoJSON=function(e){var t=o.prototype.toGeoJSON.call(this,e);t.type=i.geoJSON.GeometryCollection,t.geometries=[];for(var r=0;r<this.geometries.length;r++)t.geometries.push(this.geometries[r].toGeoJSON());return t}),$c;function s(e,t){o.call(this),this.geometries=e||[],this.srid=t,0<this.geometries.length&&(this.hasZ=this.geometries[0].hasZ,this.hasM=this.geometries[0].hasM)}}var ih,oh,ah,sh,lh=uh;function uh(e,t){this.buffer=e,this.position=0,this.isBigEndian=t||!1}function ch(t,r,n){return function(){var e=(this.isBigEndian?r:t).call(this.buffer,this.position);return this.position+=n,e}}function hh(){var s,l,u,c,h,f,d,p,m,r,o,t,n,g;return sh||(sh=1,ah=i,s=Lc,l=Jc(),u=Kc(),c=Qc(),h=eh(),f=th(),d=rh(),p=nh(),m=lh,r=zc,oh||(oh=1,ih=e,t=Lc,n=Jc(),e.prototype.match=function(e){this.skipWhitespaces();for(var t=0;t<e.length;t++)if(0===this.value.substring(this.position).indexOf(e[t]))return this.position+=e[t].length,e[t];return null},e.prototype.matchRegex=function(e){this.skipWhitespaces();for(var t=0;t<e.length;t++){var r=this.value.substring(this.position).match(e[t]);if(r)return this.position+=r[0].length,r}return null},e.prototype.isMatch=function(e){this.skipWhitespaces();for(var t=0;t<e.length;t++)if(0===this.value.substring(this.position).indexOf(e[t]))return this.position+=e[t].length,!0;return!1},e.prototype.matchType=function(){var e=this.match([t.wkt.Point,t.wkt.LineString,t.wkt.Polygon,t.wkt.MultiPoint,t.wkt.MultiLineString,t.wkt.MultiPolygon,t.wkt.GeometryCollection]);if(e)return e;throw new Error("Expected geometry type")},e.prototype.matchDimension=function(){switch(this.match(["ZM","Z","M"])){case"ZM":return{hasZ:!0,hasM:!0};case"Z":return{hasZ:!0,hasM:!1};case"M":return{hasZ:!1,hasM:!0};default:return{hasZ:!1,hasM:!1}}},e.prototype.expectGroupStart=function(){if(!this.isMatch(["("]))throw new Error("Expected group start")},e.prototype.expectGroupEnd=function(){if(!this.isMatch([")"]))throw new Error("Expected group end")},e.prototype.matchCoordinate=function(e){var t=e.hasZ&&e.hasM?this.matchRegex([/^(\S*)\s+(\S*)\s+(\S*)\s+([^\s,)]*)/]):e.hasZ||e.hasM?this.matchRegex([/^(\S*)\s+(\S*)\s+([^\s,)]*)/]):this.matchRegex([/^(\S*)\s+([^\s,)]*)/]);if(t)return e.hasZ&&e.hasM?new n(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4])):e.hasZ?new n(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])):e.hasM?new n(parseFloat(t[1]),parseFloat(t[2]),void 0,parseFloat(t[3])):new n(parseFloat(t[1]),parseFloat(t[2]));throw new Error("Expected coordinates")},e.prototype.matchCoordinates=function(e){var t=[];do{var r=this.isMatch(["("])}while(t.push(this.matchCoordinate(e)),r&&this.expectGroupEnd(),this.isMatch([","]));return t},e.prototype.skipWhitespaces=function(){for(;this.position<this.value.length&&" "===this.value[this.position];)this.position++}),o=ih,g=Yc,i.parse=function(e,t){if("string"==typeof e||e instanceof o)return i._parseWkt(e);if(b.isBuffer(e)||e instanceof m)return i._parseWkb(e,t);throw new Error("first argument must be a string or Buffer")},i._parseWkt=function(e){var t,r=e instanceof o?e:new o(e),e=r.matchRegex([/^SRID=(\d+);/]),e=(e&&(t=parseInt(e[1],10)),r.matchType()),n=r.matchDimension(),i={srid:t,hasZ:n.hasZ,hasM:n.hasM};switch(e){case s.wkt.Point:return l._parseWkt(r,i);case s.wkt.LineString:return u._parseWkt(r,i);case s.wkt.Polygon:return c._parseWkt(r,i);case s.wkt.MultiPoint:return h._parseWkt(r,i);case s.wkt.MultiLineString:return f._parseWkt(r,i);case s.wkt.MultiPolygon:return d._parseWkt(r,i);case s.wkt.GeometryCollection:return p._parseWkt(r,i)}},i._parseWkb=function(e,t){var r,n={},i=e instanceof m?e:new m(e);switch(i.isBigEndian=!i.readInt8(),e=i.readUInt32(),n.hasSrid=536870912==(536870912&e),n.isEwkb=536870912&e||1073741824&e||2147483648&e,n.hasSrid&&(n.srid=i.readUInt32()),n.hasZ=!1,n.hasM=!1,r=n.isEwkb||t&&t.isEwkb?(2147483648&e&&(n.hasZ=!0),1073741824&e&&(n.hasM=!0),15&e):1e3<=e&&e<2e3?(n.hasZ=!0,e-1e3):2e3<=e&&e<3e3?(n.hasM=!0,e-2e3):3e3<=e&&e<4e3?(n.hasZ=!0,n.hasM=!0,e-3e3):e){case s.wkb.Point:return l._parseWkb(i,n);case s.wkb.LineString:return u._parseWkb(i,n);case s.wkb.Polygon:return c._parseWkb(i,n);case s.wkb.MultiPoint:return h._parseWkb(i,n);case s.wkb.MultiLineString:return f._parseWkb(i,n);case s.wkb.MultiPolygon:return d._parseWkb(i,n);case s.wkb.GeometryCollection:return p._parseWkb(i,n);default:throw new Error("GeometryType "+r+" not supported")}},i.parseTwkb=function(e){var t={},r=e instanceof m?e:new m(e),e=r.readUInt8(),n=r.readUInt8(),i=15&e;if(t.precision=g.decode(e>>4),t.precisionFactor=Math.pow(10,t.precision),t.hasBoundingBox=n>>0&1,t.hasSizeAttribute=n>>1&1,t.hasIdList=n>>2&1,t.hasExtendedPrecision=n>>3&1,t.isEmpty=n>>4&1,t.hasExtendedPrecision?(e=r.readUInt8(),t.hasZ=1==(1&e),t.hasM=2==(2&e),t.zPrecision=g.decode((28&e)>>2),t.zPrecisionFactor=Math.pow(10,t.zPrecision),t.mPrecision=g.decode((224&e)>>5),t.mPrecisionFactor=Math.pow(10,t.mPrecision)):(t.hasZ=!1,t.hasM=!1),t.hasSizeAttribute&&r.readVarInt(),t.hasBoundingBox){var o=2;t.hasZ&&o++,t.hasM&&o++;for(var a=0;a<o;a++)r.readVarInt(),r.readVarInt()}switch(i){case s.wkb.Point:return l._parseTwkb(r,t);case s.wkb.LineString:return u._parseTwkb(r,t);case s.wkb.Polygon:return c._parseTwkb(r,t);case s.wkb.MultiPoint:return h._parseTwkb(r,t);case s.wkb.MultiLineString:return f._parseTwkb(r,t);case s.wkb.MultiPolygon:return d._parseTwkb(r,t);case s.wkb.GeometryCollection:return p._parseTwkb(r,t);default:throw new Error("GeometryType "+i+" not supported")}},i.parseGeoJSON=function(e){return i._parseGeoJSON(e)},i._parseGeoJSON=function(e,t){var r;switch(e.type){case s.geoJSON.Point:r=l._parseGeoJSON(e);break;case s.geoJSON.LineString:r=u._parseGeoJSON(e);break;case s.geoJSON.Polygon:r=c._parseGeoJSON(e);break;case s.geoJSON.MultiPoint:r=h._parseGeoJSON(e);break;case s.geoJSON.MultiLineString:r=f._parseGeoJSON(e);break;case s.geoJSON.MultiPolygon:r=d._parseGeoJSON(e);break;case s.geoJSON.GeometryCollection:r=p._parseGeoJSON(e);break;default:throw new Error("GeometryType "+e.type+" not supported")}if(e.crs&&e.crs.type&&"name"===e.crs.type&&e.crs.properties&&e.crs.properties.name){var n=e.crs.properties.name;if(0===n.indexOf("EPSG:"))r.srid=parseInt(n.substring(5));else{if(0!==n.indexOf("urn:ogc:def:crs:EPSG::"))throw new Error("Unsupported crs: "+n);r.srid=parseInt(n.substring(22))}}else t||(r.srid=4326);return r},i.prototype.toEwkt=function(){return"SRID="+this.srid+";"+this.toWkt()},i.prototype.toEwkb=function(){var e=new r(this._getWkbSize()+4),t=this.toWkb();return e.writeInt8(1),e.writeUInt32LE((536870912|t.slice(1,5).readUInt32LE(0))>>>0,!0),e.writeUInt32LE(this.srid),e.writeBuffer(t.slice(5)),e.buffer},i.prototype._getWktType=function(e,t){return this.hasZ&&this.hasM?e+=" ZM ":this.hasZ?e+=" Z ":this.hasM&&(e+=" M "),!t||this.hasZ||this.hasM||(e+=" "),t&&(e+="EMPTY"),e},i.prototype._getWktCoordinate=function(e){var t=e.x+" "+e.y;return this.hasZ&&(t+=" "+e.z),this.hasM&&(t+=" "+e.m),t},i.prototype._writeWkbType=function(e,t,r){var n=0;void 0!==this.srid||r&&void 0!==r.srid?(this.hasZ&&(n|=2147483648),this.hasM&&(n|=1073741824)):this.hasZ&&this.hasM?n+=3e3:this.hasZ?n+=1e3:this.hasM&&(n+=2e3),e.writeUInt32LE(n+t>>>0,!0)},i.getTwkbPrecision=function(e,t,r){return{xy:e,z:t,m:r,xyFactor:Math.pow(10,e),zFactor:Math.pow(10,t),mFactor:Math.pow(10,r)}},i.prototype._writeTwkbHeader=function(e,t,r,n){r=(g.encode(r.xy)<<4)+t,t=(this.hasZ||this.hasM)<<3;t+=n<<4,e.writeUInt8(r),e.writeUInt8(t),(this.hasZ||this.hasM)&&(n=0,this.hasZ&&(n|=1),this.hasM&&(n|=2),e.writeUInt8(n))},i.prototype.toGeoJSON=function(e){var t={};return this.srid&&e&&(e.shortCrs?t.crs={type:"name",properties:{name:"EPSG:"+this.srid}}:e.longCrs&&(t.crs={type:"name",properties:{name:"urn:ogc:def:crs:EPSG::"+this.srid}})),t}),ah;function e(e){this.value=e,this.position=0}function i(){this.srid=void 0,this.hasZ=!1,this.hasM=!1}}uh.prototype.readUInt8=ch(b.prototype.readUInt8,b.prototype.readUInt8,1),uh.prototype.readUInt16=ch(b.prototype.readUInt16LE,b.prototype.readUInt16BE,2),uh.prototype.readUInt32=ch(b.prototype.readUInt32LE,b.prototype.readUInt32BE,4),uh.prototype.readInt8=ch(b.prototype.readInt8,b.prototype.readInt8,1),uh.prototype.readInt16=ch(b.prototype.readInt16LE,b.prototype.readInt16BE,2),uh.prototype.readInt32=ch(b.prototype.readInt32LE,b.prototype.readInt32BE,4),uh.prototype.readFloat=ch(b.prototype.readFloatLE,b.prototype.readFloatBE,4),uh.prototype.readDouble=ch(b.prototype.readDoubleLE,b.prototype.readDoubleBE,8),uh.prototype.readVarInt=function(){for(var e,t=0,r=0;t+=(127&(e=this.buffer[this.position+r]))<<7*r,r++,128<=e;);return this.position+=r,t},g.Types=Lc,g.Geometry=hh(),g.Point=Jc(),g.LineString=Kc(),g.Polygon=Qc(),g.MultiPoint=eh(),g.MultiLineString=th(),g.MultiPolygon=rh(),g.GeometryCollection=nh();const fh=oc,dh=function(e,t){if("point"===t){for(var r=[],n=0;n<e;n++)r.push({type:"Feature",geometry:{type:"Point",coordinates:[360*sc(),180*sc()]},properties:{}});return{type:"FeatureCollection",features:r}}},ph=h.exports,mh=a,gh=d.exports,yh=g,vh=$r,_h=(c.adduserlayer=function(e,t,r){const n=fh(t),i=fh(r);function o(){e.map.setStyle({name:"user-layer",version:8,sources:{"user-layer":{type:"raster",tiles:[n],tileSize:256}},layers:[{id:"user-layer",type:"raster",source:"user-layer",minzoom:0,maxzoom:22}]}),d3.select(".layer-switch .active").classed("active",!1),d3.select(".user-layer-button").classed("active",!0),e.data.set({mapStyleLoaded:!0})}d3.select(".user-layer-button").remove(),d3.select(".layer-switch").append("button").attr("class","pad0x user-layer-button").on("click",o).text(i),o()},c.zoomextent=function(e){vh(e)},c.clear=function(e){e.data.clear()},c.random=function(e,t,r){e.data.mergeFeatures(dh(t,r).features,"meta")},c.bboxify=function(e){e.data.set({map:ph.bboxify(e.data.get("map"))})},c.flatten=function(e){e.data.set({map:mh(e.data.get("map"))})},c.polyline=function(e){var t=prompt("Enter your polyline");try{var r=gh.toGeoJSON(t);e.data.set({map:r})}catch(e){alert("Sorry, we were unable to decode that polyline")}},c.polyline6=function(e){var t=prompt("Enter your polyline");try{var r=gh.toGeoJSON(t,6);e.data.set({map:r})}catch(e){alert("Sorry, we were unable to decode that polyline")}},c.wkxBase64=function(e){var t=prompt("Enter your Base64 encoded WKB/EWKB");try{var r=yh.Geometry.parse(Buffer.from(t,"base64"));e.data.set({map:r.toGeoJSON()}),vh(e)}catch(e){console.error(e),alert("Sorry, we were unable to decode that Base64 encoded WKX data")}},c.wkxHex=function(e){var t=prompt("Enter your Hex encoded WKB/EWKB");try{var r=yh.Geometry.parse(Buffer.from(t,"hex"));e.data.set({map:r.toGeoJSON()}),vh(e)}catch(e){console.error(e),alert("Sorry, we were unable to decode that Hex encoded WKX data")}},c.wkxString=function(e){var t=prompt("Enter your WKT/EWKT String");try{var r=yh.Geometry.parse(t);e.data.set({map:r.toGeoJSON()}),vh(e)}catch(e){console.error(e),alert("Sorry, we were unable to decode that WKT data")}},Dt),xh=qe.exports,bh=As,wh=p,Eh=v.exports,Th=l,Sh=Zt,Mh=u.exports,kh=Yr,Ch=$r,Ah=o,Ih=c;const Lh=o.readDrop,Ph=Yr,zh=$r;t=[{title:"Streets",style:"mapbox://styles/mapbox/streets-v12"},{title:"Satellite Streets",style:"mapbox://styles/mapbox/satellite-streets-v12"},{title:"Outdoors",style:"mapbox://styles/mapbox/outdoors-v12"},{title:"Light",style:"mapbox://styles/mapbox/light-v11"},{title:"Dark",style:"mapbox://styles/mapbox/dark-v11"},{title:"OSM",style:{name:"osm",version:8,sources:{"osm-raster-tiles":{type:"raster",tiles:["https://a.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a>'}},layers:[{id:"osm-raster-layer",type:"raster",source:"osm-raster-tiles",minzoom:0,maxzoom:22}]}}],i={DEFAULT_PROJECTION:"globe",DEFAULT_STYLE:"Streets",DEFAULT_DARK_FEATURE_COLOR:"#555",DEFAULT_LIGHT_FEATURE_COLOR:"#e8e8e8",DEFAULT_SATELLITE_FEATURE_COLOR:"#00f900"};const Dh=t,Oh=i["DEFAULT_STYLE"];const Rh=i["DEFAULT_PROJECTION"];const Fh=function(i,o){return function(e){let r=null;var t=[{icon:"code",title:" JSON",alt:"JSON Source",behavior:ln},{icon:"table",title:" Table",alt:"Edit feature properties in a table",behavior:sn},{icon:"question",title:" Help",alt:"Help",behavior:un}];const n=e.selectAll("button").data(t,e=>e.icon);e=n.enter().append("button").attr("class","grow").attr("title",e=>e.alt).on("click",function(t){n.classed("active",e=>t.icon===e.icon),r&&r.off();r=t.behavior(i),o.call(r)});e.append("i").attr("class",e=>"fa-solid fa-"+e.icon),e.append("span").text(e=>e.title),d3.select(n.node()).trigger("click")}},Bh=function(i){var e="undefined"!=typeof ArrayBuffer;const o=[{title:"GeoJSON",action:function(){d3.event&&d3.event.preventDefault();var e=JSON.stringify(i.data.get("map")),t=i.data.get("meta");Eh(new Blob([e],{type:"text/plain;charset=utf-8"}),t&&t.name||"map.geojson")}},{title:"TopoJSON",action:function(){var e=JSON.stringify(wh.topology({collection:xh(i.data.get("map"))},{"property-transform":t}));Eh(new Blob([e],{type:"text/plain;charset=utf-8"}),"map.topojson")}},{title:"CSV",action:function(){d3.event&&d3.event.preventDefault();var e=bh(i.data.get("map"));Eh(new Blob([e],{type:"text/plain;charset=utf-8"}),"points.csv")}},{title:"KML",action:function(){d3.event&&d3.event.preventDefault();var e=Th.toKML(i.data.get("map"));Eh(new Blob([e],{type:"text/plain;charset=utf-8"}),"map.kml")}},{title:"WKT",action:function(){d3.event&&d3.event.preventDefault();var e=i.data.get("map").features;0!==e.length&&(e=e.map(Mh.stringify).join("\n"),Eh(new Blob([e],{type:"text/plain;charset=utf-8"}),"map.wkt"))}}];function t(e,t,r){return e[t]=r,!0}return e&&o.push({title:"Shapefile",action:function(){d3.event&&d3.event.preventDefault();d3.select(".map").classed("loading",!0);try{_h.download(i.data.get("map"))}finally{d3.select(".map").classed("loading",!1)}}}),function(e){var t=[{title:"Open",alt:"CSV, GTFS, KML, GPX, and other filetypes",action:r},{title:"Save",children:o},{title:"New",action:function(){window.open(window.location.origin+window.location.pathname+"#new")}},{title:"Meta",action:function(){},children:[{title:"Add raster tile layer",alt:"Add a custom tile layer",action:function(){var e,t=prompt("Layer URL\ne.g. https://stamen-tiles-b.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.jpg");null!==t&&null!==(e=prompt("Layer name"))&&Ih.adduserlayer(i,t,e)}},{title:"Zoom to features",alt:"Zoom to the extent of all features",action:function(){Ih.zoomextent(i)}},{title:"Clear",alt:"Delete all features from the map",action:function(){confirm("Are you sure you want to delete all features from this map?")&&Ih.clear(i)}},{title:"Random: Points",alt:"Add random points to your map",action:function(){var t=prompt("Number of points (default: 100)");if(null!==t){let e=parseInt(t,10);isNaN(e)&&(e=100),Ih.random(i,e,"point")}}},{title:"Add bboxes",alt:"Add bounding box members to all applicable GeoJSON objects",action:function(){Ih.bboxify(i)}},{title:"Flatten Multi Features",alt:"Flatten MultiPolygons, MultiLines, and GeometryCollections into simple geometries",action:function(){Ih.flatten(i)}},{title:"Load encoded polyline (precision 5)",alt:"Decode and show an encoded precision 5 polyline.",action:function(){Ih.polyline(i)}},{title:"Load encoded polyline (precision 6)",alt:"Decode and show an encoded precision 6 polyline.",action:function(){Ih.polyline6(i)}},{title:"Load WKB Base64 Encoded String",alt:"Decode and show WKX data",action:function(){Ih.wkxBase64(i)}},{title:"Load WKB Hex Encoded String",alt:"Decode and show WKX data",action:function(){Ih.wkxHex(i)}},{title:"Load WKT String",alt:"Decode and show WKX data",action:function(){Ih.wkxString(i)}}]}];function r(){const e=d3.select("body").append("input").attr("type","file").style("visibility","hidden").style("position","absolute").style("height","0").on("change",function(){const r=this.files;r&&r[0]&&(Ah.readAsText(r[0],(e,t)=>{Ah.readFile(r[0],t,n),r[0].path&&i.data.set({path:r[0].path})}),e.remove())});e.node().click()}function n(e,t,r){(t=Sh(t))&&(i.data.mergeFeatures(t.features),r?kh(i.container,r.message):kh(i.container,"Imported "+t.features.length+" features.").classed("success","true"),Ch(i))}(e=e.append("div").attr("class","inline").selectAll("div.item").data(t).enter().append("div").attr("class","item")).append("a").attr("class","parent").on("click",function(e){e.action&&e.action.apply(this,e)}).text(e=>" "+e.title),e.each(function(e){var t;e.children&&d3.select(this).append("div").attr("class","children").call((t=e.children,function(e){e.selectAll("a").data(t).enter().append("a").attr("title",e=>{if("File"===e.title||"GitHub"===e.title||"Gist"===e.title||"Add map layer"===e.title||"Zoom to features"===e.title||"Clear"===e.title||"Random: Points"===e.title||"Add bboxes"===e.title||"Flatten Multi Features"===e.title)return e.alt}).text(e=>e.title).on("click",function(e){e.action.apply(this,e)})}))}),d3.select(document).call(d3.keybinding("file_bar").on("⌘+o",()=>{r(),d3.event.preventDefault()}))}},Nh=function(n){function e(){d3.event.stopPropagation(),d3.event.preventDefault(),d3.event.dataTransfer.dropEffect="copy",d3.select("body").classed("dragover",!0)}d3.select("body").attr("dropzone","copy").on("drop.import",Lh((e,t,r)=>{e&&e.message&&Ph(n.container,e.message).classed("error","true"),t&&t.features&&(n.data.mergeFeatures(t.features),r?Ph(n.container,r.message):Ph(n.container,"Imported "+t.features.length+" features.").classed("success","true"),zh(n)),d3.select("body").classed("dragover",!1)})).on("dragenter.import",e).on("dragleave.import",function(){d3.event.stopPropagation(),d3.event.preventDefault(),d3.event.dataTransfer.dropEffect="copy",d3.select("body").classed("dragover",!1)}).on("dragover.import",e)},jh=function(i){return function(e){const n=e.append("div").attr("class","layer-switch absolute left-0 bottom-0 mb-9 text-xs z-10").selectAll("button").data(Dh);function t(){const e=this instanceof d3.selection?this.node():this;var t,r;n.classed("active",function(){return e===this}),d3.select(".user-layer-button").classed("active",!1),i.map._loaded&&({title:t,style:r}=d3.select(e).datum(),i.map.setStyle(r),i.storage.set("style",t),i.data.set({mapStyleLoaded:!0}))}n.enter().append("button").attr("class","pad0x").on("click",t).text(e=>e.title);const r=i.storage.get("style")||Oh;n.filter(({title:e})=>e===r).call(t)}},Uh=function(i){return function(e){const r=e.append("div").attr("class","projection-switch absolute left-0 bottom-0 mb-16 text-xs transition-all duration-200 z-10").selectAll("button").data([{label:"Globe",value:"globe"},{label:"Mercator",value:"mercator"}]);function t(){const e=this instanceof d3.selection?this.node():this;var t;r.classed("active",function(){return e===this}),i.map._loaded&&(t=d3.select(e).datum()["value"],i.map.setProjection(t),i.storage.set("projection",t))}r.enter().append("button").attr("class","pad0x").on("click",t).text(e=>e.label);const n=i.storage.get("projection")||Rh;r.filter(({value:e})=>e===n).call(t)}};function Vh(n){function i(e){e=e.append("div").attr("class","ui-container grow flex-shrink-0 flex flex-col md:flex-row w-full relative overflow-x-hidden");return e.append("div").attr("id","map").attr("class","map grow shrink-0 top-0 bottom-0 left-0 basis-0 transition-all duration-300").call(jh(n)).call(Uh(n)).append("div").attr("class","sidebar-handle absolute right-0 bottom-9 px-4 bg-white cursor-pointer hidden md:block z-10").attr("title","Toggle Sidebar").on("click",()=>{var e=!d3.select(".map").classed("md:basis-full");d3.select(".map").classed("md:basis-0",!e),d3.select(".map").classed("md:basis-full",e),d3.select(".sidebar-handle-icon").classed("fa-caret-left",e).classed("fa-caret-right",!e),setTimeout(()=>{n.map.resize()},300)}).append("i").attr("class","sidebar-handle-icon fa-solid fa-caret-right"),n.container=e}return{read:i,write:function(e){var e=i(e),t=(r=e.append("div").attr("class","right flex flex-col overflow-x-hidden bottom-0 top-0 right-0 box-border bg-white relative grow-0 shrink-0 w-full md:w-2/5 md:max-w-md h-2/5 md:h-auto")).append("div").attr("class","top border-b border-solid border-gray-200"),r=r.append("div").attr("class","pane group");t.append("div").attr("class","buttons flex").call(Fh(n,r)),e.append("div").attr("class","file-bar hidden md:block").call(Bh(n)),Nh(n),n.map()}}}var Gh,Wh,Zh,qh,Hh,$h,Xh,Yh,Jh,Kh,Qh,ef,tf,rf,nf,of,af,sf,lf,uf,cf,hf,ff,df,pf,k,mf,gf,yf,vf,_f,xf,bf,wf,Ef,Tf,Sf,Mf,kf,Cf,Af,If,Lf,Pf,zf,Df,Of,Rf,Ff,Bf,Nf,jf,Uf,Vf,Gf,Wf,Zf,qf,Hf,$f,Xf,Yf,Jf,Kf,Qf,ed,td,rd,nd,id,od,ad,sd,ld,y={exports:{}},f=(y.exports=function(){var i,o,a;function e(e,t){var r,n;i?o?(r="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+i+")(sharedChunk); ("+o+")(sharedChunk); self.onerror = null;",i(n={}),a=t(n),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(a.workerUrl=window.URL.createObjectURL(new Blob([r],{type:"text/javascript"})))):o=t:i=t}return e(0,function(l){var p="undefined"!=typeof self?self:{},z="2.13.0";let s;const o={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==s){var t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{s=null!=$d.env.API_URL_REGEX?new RegExp($d.env.API_URL_REGEX):t}catch(e){s=t}}return s},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},D={supported:!1,testSupport:function(e){!F&&R&&(B?N(e):O=e)}};let O,R,F=!1,B=!1;function N(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,R),e.isContextLost())return;D.supported=!0}catch(e){}e.deleteTexture(t),F=!0}p.document&&((R=p.document.createElement("img")).onload=function(){O&&N(O),O=null,B=!0},R.onerror=function(){F=!0,O=null},R.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var j=U;function U(e,t,r,n){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=r,this.p2y=n}U.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(1<e)return 1;for(var r=e,n=0;n<8;n++){var i=this.sampleCurveX(r)-e;if(Math.abs(i)<t)return r;var o=this.sampleCurveDerivativeX(r);if(Math.abs(o)<1e-6)break;r-=i/o}for(var a=0,s=1,r=e,n=0;n<20&&(i=this.sampleCurveX(r),!(Math.abs(i-e)<t));n++)i<e?a=r:s=r,r=.5*(s-a)+a;return r},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var I=V;function V(e,t){this.x=e,this.y=t}V.prototype={clone:function(){return new V(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,e=e.y-this.y;return t*t+e*e},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),e=Math.sin(e),r=e*this.x+t*this.y;return this.x=t*this.x-e*this.y,this.y=r,this},_rotateAround:function(e,t){var r=Math.cos(e),e=Math.sin(e),n=t.y+e*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-e*(this.y-t.y),this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},V.convert=function(e){return!(e instanceof V)&&Array.isArray(e)?new V(e[0],e[1]):e};const G=Math.PI/180,W=180/Math.PI;function M(e){return e*G}function T(e){return e*W}const Z=[[0,0],[1,0],[1,1],[0,1]];function q(e){var t,r;return e<=0?0:1<=e?1:(r=(t=e*e)*e,4*(e<.5?r:3*(e-t)+r-.75))}function H(e,t,r,n){const i=new j(e,t,r,n);return function(e){return i.solve(e)}}var $=H(.25,.1,.25,1);function S(e,t,r){return Math.min(r,Math.max(t,e))}function X(e,t,r){return(r=S((r-e)/(t-e),0,1))*r*(3-2*r)}function Y(e,t,r){var n=r-t,e=((e-t)%n+n)%n+t;return e===t?r:e}function J(e,t,n){if(!e.length)return n(null,[]);let i=e.length;const o=new Array(e.length);let a=null;e.forEach((e,r)=>{t(e,(e,t)=>{e&&(a=e),o[r]=t,0==--i&&n(a,o)})})}function K(e){var t=[];for(const r in e)t.push(e[r]);return t}function _(e,...t){for(const r of t)for(const t in r)e[t]=r[t];return e}let Q=1;function ee(){return Q++}function te(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function re(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function ne(e){return e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function ie(e,t){e.forEach(e=>{t[e]&&(t[e]=t[e].bind(t))})}function oe(e,t){return-1!==e.indexOf(t,e.length-t.length)}function ue(e,t,r){var n={};for(const i in e)n[i]=t.call(r||this,e[i],i,e);return n}function ce(e,t,r){var n={};for(const i in e)t.call(r||this,e[i],i,e)&&(n[i]=e[i]);return n}function he(e){return Array.isArray(e)?e.map(he):"object"==typeof e&&e?ue(e,he):e}const fe={};function ae(e){fe[e]||("undefined"!=typeof console&&console.warn(e),fe[e]=!0)}function de(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function pe(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function me(e){const i={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(e,t,r,n)=>{r=r||n;return i[t]=!r||r.toLowerCase(),""}),i["max-age"]){const e=parseInt(i["max-age"],10);isNaN(e)?delete i["max-age"]:i["max-age"]=e}return i}let ge=null;function ye(e){var t;return null==ge&&(t=e.navigator?e.navigator.userAgent:null,ge=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))),ge}function ve(e){try{var t=p[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(e){return!1}}function _e(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}const xe="mapbox-tiles";let be,we,Te=500,Se=50;function Me(){try{return p.caches}catch(e){}}function ke(){Me()&&!be&&(be=p.caches.open(xe))}function Ce(e){var t,r,n=e.indexOf("?");return n<0?e:(t=(0<(r=(t=e).indexOf("?"))?t.slice(r+1).split("&"):[]).filter(e=>{e=e.split("=");return"language"===e[0]||"worldview"===e[0]})).length?e.slice(0,n)+"?"+t.join("&"):e.slice(0,n)}let Ae=1/0;const Ie={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Ie);class Le extends Error{constructor(e,t,r){401===t&&Ue(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): `+this.url}}function Pe(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test(De())&&!/^\w+:/.test(r))){if(p.fetch&&p.Request&&p.AbortController&&p.Request.prototype.hasOwnProperty("signal")){var i=e;var f=t;const a=new p.AbortController,d=new p.Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:De(),signal:a.signal});let c=!1,h=!1;const s=0<(r=d.url).indexOf("sku=")&&Ue(r);"json"===i.type&&d.headers.set("Accept","application/json");const l=(e,t,r)=>{if(!h){if(e&&"SecurityError"!==e.message&&ae(e),t&&r)return u(t);const n=Date.now();p.fetch(d).then(e=>{if(e.ok){const i=s?e.clone():null;return u(e,i,n)}return f(new Le(e.statusText,e.status,i.url))}).catch(e=>{"AbortError"!==e.name&&f(new Error(e.message+" "+i.url))})}},u=(s,l,u)=>{("arrayBuffer"===i.type?s.arrayBuffer():"json"===i.type?s.json():s.text()).then(e=>{if(!h){if(l&&u){var r=d,t=l,n=u;if(ke(),be){const a={status:t.status,statusText:t.statusText,headers:new p.Headers};t.headers.forEach((e,t)=>a.headers.set(t,e));var i=me(t.headers.get("Cache-Control")||"");if(!i["no-store"]){i["max-age"]&&a.headers.set("Expires",new Date(n+1e3*i["max-age"]).toUTCString());i=a.headers.get("Expires");if(i&&!(new Date(i).getTime()-n<42e4)){var o=t,i=e=>{const t=new p.Response(e,a);ke(),be&&be.then(e=>e.put(Ce(r.url),t)).catch(e=>ae(e.message))};if(void 0===we)try{new Response(new ReadableStream),we=!0}catch(o){we=!1}we?i(o.body):o.blob().then(i)}}}}c=!0,f(null,e,s.headers.get("Cache-Control"),s.headers.get("Expires"))}}).catch(e=>{h||f(new Error(e.message))})};return s?function(e,i){if(ke(),!be)return i(null);const o=Ce(e.url);be.then(n=>{n.match(o).then(e=>{var t,r=!!(t=e)&&(r=new Date(t.headers.get("Expires")||0),t=me(t.headers.get("Cache-Control")||""),r>Date.now()&&!t["no-cache"]);n.delete(o),r&&n.put(o,e.clone()),i(null,e,r)}).catch(i)}).catch(i)}(d,l):l(null,null),{cancel:()=>{h=!0,c||a.abort()}};return}if(pe()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;{var n=e,o=t;const c=new p.XMLHttpRequest;c.open(n.method||"GET",n.url,!0),"arrayBuffer"===n.type&&(c.responseType="arraybuffer");for(const p in n.headers)c.setRequestHeader(p,n.headers[p]);return"json"===n.type&&(c.responseType="text",c.setRequestHeader("Accept","application/json")),c.withCredentials="include"===n.credentials,c.onerror=()=>{o(new Error(c.statusText))},c.onload=()=>{if((200<=c.status&&c.status<300||0===c.status)&&null!==c.response){let e=c.response;if("json"===n.type)try{e=JSON.parse(c.response)}catch(e){return o(e)}o(null,e,c.getResponseHeader("Cache-Control"),c.getResponseHeader("Expires"))}else o(new Le(c.statusText,c.status,n.url))},c.send(n.body),{cancel:()=>c.abort()}}}function ze(e,t){return Pe(_(e,{type:"arrayBuffer"}),t)}const De=pe()?()=>self.worker&&self.worker.referrer:()=>("blob:"===p.location.protocol?p.parent:p).location.href;const Oe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Re,Fe;Re=[],Fe=0;function Be(e,l){if(D.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Fe>=o.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:e,callback:l,cancelled:!1,cancel(){this.cancelled=!0}};return Re.push(p),p}Fe++;let n=!1;const u=()=>{if(!n)for(n=!0,Fe--;Re.length&&Fe<o.MAX_PARALLEL_IMAGE_REQUESTS;){const e=Re.shift(),{requestParameters:t,callback:r,cancelled:n}=e;n||(e.cancel=Be(t,r).cancel)}},t=ze(e,(e,t,r,n)=>{if(u(),e)l(e);else if(t)if(p.createImageBitmap)o=(e,t)=>l(e,t,r,n),e=new p.Blob([new Uint8Array(t)],{type:"image/png"}),p.createImageBitmap(e).then(e=>{o(null,e)}).catch(e=>{o(new Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))});else{e=t;var i=(e,t)=>l(e,t,r,n);const a=new p.Image,s=p.URL;a.onload=()=>{i(null,a),s.revokeObjectURL(a.src),a.onload=null,p.requestAnimationFrame(()=>{a.src=Oe})},a.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),t=new p.Blob([new Uint8Array(e)],{type:"image/png"}),a.src=e.byteLength?s.createObjectURL(t):Oe}var o});return{cancel:()=>{t.cancel(),u()}}}const Ne="NO_ACCESS_TOKEN";function je(e){return 0===e.indexOf("mapbox:")}function Ue(e){return o.API_URL_REGEX.test(e)}function Ve(e){return o.API_CDN_URL_REGEX.test(e)}function Ge(e){return o.API_STYLE_REGEX.test(e)&&!We(e)}function We(e){return o.API_SPRITE_REGEX.test(e)}const Ze=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function qe(e){e=e.match(Ze);if(e)return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]};throw new Error("Unable to parse URL object")}function He(e){var t=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+t}function $e(e){if(!e)return null;var t=e.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(p.atob(t[1]).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(e){return null}}class Xe{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){var t=$e(o.ACCESS_TOKEN),t=t&&t.u?p.btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,(e,t)=>String.fromCharCode(Number("0x"+t)))):o.ACCESS_TOKEN||"";return e?`mapbox.eventData.${e}:`+t:"mapbox.eventData:"+t}fetchEventData(){const e=ve("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{const e=p.localStorage.getItem(t);e&&(this.eventData=JSON.parse(e));var n=p.localStorage.getItem(r);n&&(this.anonId=n)}catch(e){ae("Unable to read from LocalStorage")}}saveEventData(){var e=ve("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{p.localStorage.setItem(r,this.anonId),1<=Object.keys(this.eventData).length&&p.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(e){ae("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,r,n){var i;o.EVENTS_URL&&((i=qe(o.EVENTS_URL)).params.push("access_token="+(n||o.ACCESS_TOKEN||"")),e={event:this.type,created:new Date(e).toISOString()},t=t?_(e,t):e,e={url:He(i),headers:{"Content-Type":"text/plain"},body:JSON.stringify([t])},this.pendingRequest=(i=e,t=e=>{this.pendingRequest=null,r(e),this.saveEventData(),this.processRequests(n)},Pe(_(i,{method:"POST"}),t)))}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const Ye=new class extends Xe{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){o.EVENTS_URL&&o.ACCESS_TOKEN&&Array.isArray(e)&&e.some(e=>je(e)||Ue(e))&&this.queueRequest(Date.now(),t)}processRequests(t){if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=$e(o.ACCESS_TOKEN),n=r?r.u:o.ACCESS_TOKEN;let e=n!==this.eventData.tokenU;ne(this.anonId)||(this.anonId=te(),e=!0);const i=this.queue.shift();if(this.eventData.lastSuccess){const t=new Date(this.eventData.lastSuccess),r=new Date(i),z=(i-this.eventData.lastSuccess)/864e5;e=e||1<=z||z<-1||t.getDate()!==r.getDate()}else e=!0;e?this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:z,skuId:"01","enabled.telemetry":!1,userId:this.anonId},e=>{e||(this.eventData.lastSuccess=i,this.eventData.tokenU=n)},t):this.processRequests()}}},Je=Ye.postTurnstileEvent.bind(Ye),Ke=new class extends Xe{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,r,n){this.skuToken=t,this.errorCb=n,o.EVENTS_URL&&(r||o.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},r):this.errorCb(new Error(Ne)))}processRequests(e){if(!this.pendingRequest&&0!==this.queue.length){const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),ne(this.anonId)||(this.anonId=te()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:z,skuId:"01",skuToken:this.skuToken,userId:this.anonId},e=>{e?this.errorCb(e):t&&(this.success[t]=!0)},e))}}},Qe=Ke.postMapLoadEvent.bind(Ke),et=new class extends Xe{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){o.EVENTS_URL&&(e||o.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(!this.pendingRequest&&0!==this.queue.length){var{timestamp:t,performanceData:r}=this.queue.shift(),r=function(e){var t=p.performance.getEntriesByType("resource"),r=p.performance.getEntriesByType("mark"),n=function(e){const t={};if(e)for(const n in e)if("other"!==n)for(const i of e[n]){const e=n+"ResolveRangeMin",o=n+"ResolveRangeMax",a=n+"RequestCount",s=n+"RequestCachedCount";t[e]=Math.min(t[e]||1/0,i.startTime),t[o]=Math.max(t[o]||-1/0,i.responseEnd);var r=e=>{void 0===t[e]&&(t[e]=0),++t[e]};void 0!==i.transferSize&&0===i.transferSize&&r(s),r(a)}return t}(function(e,t){var r={};if(e)for(const n of e){const e=t(n);void 0===r[e]&&(r[e]=[]),r[e].push(n)}return r}(t,st)),i=p.devicePixelRatio,o=p.navigator.connection||p.navigator.mozConnection||p.navigator.webkitConnection,a={counters:[],metadata:[],attributes:[]},s=(e,t,r)=>{null!=r&&e.push({name:t,value:r.toString()})};for(const e in n)s(a.counters,e,n[e]);if(e.interactionRange[0]!==1/0&&e.interactionRange[1]!==-1/0&&(s(a.counters,"interactionRangeMin",e.interactionRange[0]),s(a.counters,"interactionRangeMax",e.interactionRange[1])),r)for(const e of Object.keys(ot)){const p=ot[e],z=r.find(e=>e.name===p);z&&s(a.counters,p,z.startTime)}return s(a.counters,"visibilityHidden",e.visibilityHidden),s(a.attributes,"style",function(e){if(e)for(const r of e){const e=r.name.split("?")[0];if(Ge(e)){var t=e.split("/").slice(-2);if(2===t.length)return`mapbox://styles/${t[0]}/`+t[1]}}}(t)),s(a.attributes,"terrainEnabled",e.terrainEnabled?"true":"false"),s(a.attributes,"fogEnabled",e.fogEnabled?"true":"false"),s(a.attributes,"projection",e.projection),s(a.attributes,"zoom",e.zoom),s(a.metadata,"devicePixelRatio",i),s(a.metadata,"connectionEffectiveType",o?o.effectiveType:void 0),s(a.metadata,"navigatorUserAgent",p.navigator.userAgent),s(a.metadata,"screenWidth",p.screen.width),s(a.metadata,"screenHeight",p.screen.height),s(a.metadata,"windowWidth",p.innerWidth),s(a.metadata,"windowHeight",p.innerHeight),s(a.metadata,"mapWidth",e.width/i),s(a.metadata,"mapHeight",e.height/i),s(a.metadata,"webglRenderer",e.renderer),s(a.metadata,"webglVendor",e.vendor),s(a.metadata,"sdkVersion",z),s(a.metadata,"sdkIdentifier","mapbox-gl-js"),a}(r);for(const e of r.metadata);for(const e of r.counters);for(const e of r.attributes);this.postEvent(t,r,()=>{},e)}}},tt=et.postPerformanceEvent.bind(et),rt=new class extends Xe{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,r,n){var i;o.API_URL&&o.SESSION_PATH&&((i=qe(o.API_URL+o.SESSION_PATH)).params.push("sku="+(t||"")),i.params.push("access_token="+(n||o.ACCESS_TOKEN||"")),t={url:He(i),headers:{"Content-Type":"text/plain"}},this.pendingRequest=(i=t,t=e=>{this.pendingRequest=null,r(e),this.saveEventData(),this.processRequests(n)},Pe(_(i,{method:"GET"}),t)))}getSessionAPI(e,t,r,n){this.skuToken=t,this.errorCb=n,o.SESSION_PATH&&o.API_URL&&(r||o.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},r):this.errorCb(new Error(Ne)))}processRequests(e){if(!this.pendingRequest&&0!==this.queue.length){const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||this.getSession(r,this.skuToken,e=>{e?this.errorCb(e):t&&(this.success[t]=!0)},e)}}},nt=rt.getSessionAPI.bind(rt),it=new Set,ot={create:"create",load:"load",fullLoad:"fullLoad"},at={mark(e){p.performance.mark(e)},measure(e,t,r){p.performance.measure(e,t,r)}};function st(e){var t,e=e.name.split("?")[0];return Ve(e)&&e.includes("mapbox-gl.js")?"javascript":Ve(e)&&e.includes("mapbox-gl.css")?"css":(t=e,o.API_FONTS_REGEX.test(t)?"fontRange":We(e)?"sprite":Ge(e)?"style":(t=e,o.API_TILEJSON_REGEX.test(t)?"tilejson":"other"))}const lt=p.performance;function ut(e){e=e?e.url.toString():void 0;return lt.getEntriesByName(e)}let ct,ht,ft,dt;const pt={now:()=>void 0!==ft?ft:p.performance.now(),setNow(e){ft=e},restoreNow(){ft=void 0},frame(e){const t=p.requestAnimationFrame(e);return{cancel:()=>p.cancelAnimationFrame(t)}},getImageData(e,t=0){var{width:r,height:n}=e,i=(dt=dt||p.document.createElement("canvas")).getContext("2d",{willReadFrequently:!0});if(i)return(r>dt.width||n>dt.height)&&(dt.width=r,dt.height=n),i.clearRect(-t,-t,r+2*t,n+2*t),i.drawImage(e,0,0,r,n),i.getImageData(-t,-t,r+2*t,n+2*t);throw new Error("failed to create canvas 2d context")},resolveURL:e=>((ct=ct||p.document.createElement("a")).href=e,ct.href),get devicePixelRatio(){return p.devicePixelRatio},get prefersReducedMotion(){return!!p.matchMedia&&(ht=null==ht?p.matchMedia("(prefers-reduced-motion: reduce)"):ht).matches}};function mt(e,t,r){r[e]&&-1!==r[e].indexOf(t)||(r[e]=r[e]||[],r[e].push(t))}function gt(e,t,r){r&&r[e]&&(-1!==(t=r[e].indexOf(t))&&r[e].splice(t,1))}class yt{constructor(e,t={}){_(this,t),this.type=e}}class vt extends yt{constructor(e,t={}){super("error",_({error:e},t))}}class _t{on(e,t){return this._listeners=this._listeners||{},mt(e,t,this._listeners),this}off(e,t){return gt(e,t,this._listeners),gt(e,t,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},mt(t,e,this._oneTimeListeners),this):new Promise(e=>this.once(t,e))}fire(e,t){const r=(e="string"==typeof e?new yt(e,t||{}):e).type;if(this.listens(r)){const t=(e.target=this)._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const r of t)r.call(this,e);for(const t of this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[])gt(r,t,this._oneTimeListeners),t.call(this,e);var n=this._eventedParent;n&&(_(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),n.fire(e))}else e instanceof vt&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&0<this._listeners[e].length||this._oneTimeListeners&&this._oneTimeListeners[e]&&0<this._oneTimeListeners[e].length||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var c=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function xt(e,...t){for(const r of t)for(const t in r)e[t]=r[t];return e}function d(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function bt(e){if(Array.isArray(e))return e.map(bt);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(const r in e)t[r]=bt(e[r]);return t}return d(e)}class wt extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var Et=wt;var Tt=class Cd{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,r]of t)this.bindings[e]=r}concat(e){return new Cd(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}};const St={kind:"null"},h={kind:"number"},u={kind:"string"},f={kind:"boolean"},Mt={kind:"color"},kt={kind:"object"},m={kind:"value"},Ct={kind:"collator"},At={kind:"formatted"},It={kind:"resolvedImage"};function Lt(e,t){return{kind:"array",itemType:e,N:t}}function g(e){var t;return"array"===e.kind?(t=g(e.itemType),"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`):e.kind}const Pt=[St,h,u,f,Mt,At,kt,Lt(m),It];function zt(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!zt(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of Pt)if(!zt(e,t))return null}return`Expected ${g(e)} but found ${g(t)} instead.`}function Dt(t,e){return e.some(e=>e.kind===t.kind)}function Ot(t,e){return e.some(e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t)}var Rt,Ft={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Bt(e){return(e=Math.round(e))<0?0:255<e?255:e}function Nt(e){return Bt("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function jt(e){return(e="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:1<e?1:e}function Ut(e,t,r){return r<0?r+=1:1<r&&--r,6*r<1?e+(t-e)*r*6:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}try{Rt={}.parseCSSColor=function(e){e=e.replace(/ /g,"").toLowerCase();if(e in Ft)return Ft[e].slice();if("#"===e[0])return 4===e.length?0<=(t=parseInt(e.substr(1),16))&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===e.length&&0<=(t=parseInt(e.substr(1),16))&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var t=e.indexOf("("),r=e.indexOf(")");if(-1!==t&&r+1===e.length){var n,i,o,a=e.substr(0,t),s=e.substr(t+1,r-(t+1)).split(","),l=1;switch(a){case"rgba":if(4!==s.length)return null;l=jt(s.pop());case"rgb":return 3!==s.length?null:[Nt(s[0]),Nt(s[1]),Nt(s[2]),l];case"hsla":if(4!==s.length)return null;l=jt(s.pop());case"hsl":return 3!==s.length?null:(n=(parseFloat(s[0])%360+360)%360/360,o=jt(s[1]),[Bt(255*Ut(o=2*(i=jt(s[2]))-(i=i<=.5?i*(o+1):i+o-i*o),i,n+1/3)),Bt(255*Ut(o,i,n)),Bt(255*Ut(o,i,n-1/3)),l]);default:return null}}return null}}catch(l){}class Vt{constructor(e,t,r,n=1){this.r=e,this.g=t,this.b=r,this.a=n}static parse(e){if(e)return e instanceof Vt?e:"string"==typeof e&&(e=Rt(e))?new Vt(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3]):void 0}toString(){var[e,t,r,n]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(r)},${n})`}toArray(){var{r:e,g:t,b:r,a:n}=this;return 0===n?[0,0,0,0]:[255*e/n,255*t/n,255*r/n,n]}toArray01(){var{r:e,g:t,b:r,a:n}=this;return 0===n?[0,0,0,0]:[e/n,t/n,r/n,n]}toArray01PremultipliedAlpha(){var{r:e,g:t,b:r,a:n}=this;return[e,t,r,n]}}Vt.black=new Vt(0,0,0,1),Vt.white=new Vt(1,1,1,1),Vt.transparent=new Vt(0,0,0,0),Vt.red=new Vt(1,0,0,1),Vt.blue=new Vt(0,0,1,1);var y=Vt;class Gt{constructor(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale||[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale||[]).resolvedOptions().locale}}class Wt{constructor(e,t,r,n,i){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=r,this.fontStack=n,this.textColor=i}}class Zt{constructor(e){this.sections=e}static fromString(e){return new Zt([new Wt(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof Zt?e:Zt.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){var e,t=["format"];for(const r of this.sections)r.image?t.push(["image",r.image.name]):(t.push(r.text),e={},r.fontStack&&(e["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(e["font-scale"]=r.scale),r.textColor&&(e["text-color"]=["rgba"].concat(r.textColor.toArray())),t.push(e));return t}}class qt{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new qt({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Ht(e,t,r,n){return"number"==typeof e&&0<=e&&e<=255&&"number"==typeof t&&0<=t&&t<=255&&"number"==typeof r&&0<=r&&r<=255?void 0===n||"number"==typeof n&&0<=n&&n<=1?null:`Invalid rgba value [${[e,t,r,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof n?[e,t,r,n]:[e,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function $t(e){if(null===e)return 1;if("string"==typeof e)return 1;if("boolean"==typeof e)return 1;if("number"==typeof e)return 1;if(e instanceof y)return 1;if(e instanceof Gt)return 1;if(e instanceof Zt)return 1;if(e instanceof qt)return 1;if(Array.isArray(e)){for(const t of e)if(!$t(t))return;return 1}if("object"==typeof e){for(const r in e)if(!$t(e[r]))return;return 1}}function v(t){if(null===t)return St;if("string"==typeof t)return u;if("boolean"==typeof t)return f;if("number"==typeof t)return h;if(t instanceof y)return Mt;if(t instanceof Gt)return Ct;if(t instanceof Zt)return At;if(t instanceof qt)return It;if(Array.isArray(t)){var r=t.length;let e;for(const n of t){const t=v(n);if(e){if(e===t)continue;e=m;break}e=t}return Lt(e||m,r)}return kt}function Xt(e){var t=typeof e;return null===e?"":"string"==t||"number"==t||"boolean"==t?String(e):e instanceof y||e instanceof Zt||e instanceof qt?e.toString():JSON.stringify(e)}var Yt=class Ad{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!$t(e[1]))return t.error("invalid value");let r=v(e=e[1]);return t=t.expectedType,"array"!==r.kind||0!==r.N||!t||"array"!==t.kind||"number"==typeof t.N&&0!==t.N||(r=t),new Ad(r,e)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof y?["rgba"].concat(this.value.toArray()):this.value instanceof Zt?this.value.serialize():this.value}},Jt=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const Kt={string:u,number:h,boolean:f,object:kt};var Qt=class Id{constructor(e,t){this.type=e,this.args=t}static parse(r,n){if(r.length<2)return n.error("Expected at least one argument.");let i,o=1;var e=r[0];if("array"===e){let e,t;if(2<r.length){const i=r[1];if("string"!=typeof i||!(i in Kt)||"object"===i)return n.error('The item type argument of "array" must be one of string, number, boolean',1);e=Kt[i],o++}else e=m;if(3<r.length){if(null!==r[2]&&("number"!=typeof r[2]||r[2]<0||r[2]!==Math.floor(r[2])))return n.error('The length argument to "array" must be a positive integer literal',2);t=r[2],o++}i=Lt(e,t)}else i=Kt[e];for(var t=[];o<r.length;o++){const i=n.parse(r[o],o,m);if(!i)return null;t.push(i)}return new Id(i,t)}evaluate(t){for(let e=0;e<this.args.length;e++){var r=this.args[e].evaluate(t);if(!zt(this.type,v(r)))return r;if(e===this.args.length-1)throw new Jt(`Expected value to be of type ${g(this.type)}, but found ${g(v(r))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){var e,t=this.type,r=[t.kind];return"array"!==t.kind||"string"!==(e=t.itemType).kind&&"number"!==e.kind&&"boolean"!==e.kind||(r.push(e.kind),("number"==typeof(e=t.N)||1<this.args.length)&&r.push(e)),r.concat(this.args.map(e=>e.serialize()))}};class er{constructor(e){this.type=At,this.sections=e}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");var e=t[1];if(!Array.isArray(e)&&"object"==typeof e)return n.error("First argument must be an image or text section.");var i=[];let o=!1;for(let e=1;e<=t.length-1;++e){var a=t[e];if(o&&"object"==typeof a&&!Array.isArray(a)){o=!1;let e=null;if(a["font-scale"]&&!(e=n.parse(a["font-scale"],1,h)))return null;let t=null;if(a["text-font"]&&!(t=n.parse(a["text-font"],1,Lt(u))))return null;let r=null;if(a["text-color"]&&!(r=n.parse(a["text-color"],1,Mt)))return null;a=i[i.length-1];a.scale=e,a.font=t,a.textColor=r}else{a=n.parse(t[e],1,m);if(!a)return null;var r=a.type.kind;if("string"!==r&&"value"!==r&&"null"!==r&&"resolvedImage"!==r)return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");o=!0,i.push({content:a,scale:null,font:null,textColor:null})}}return new er(i)}evaluate(r){return new Zt(this.sections.map(e=>{var t=e.content.evaluate(r);return v(t)===It?new Wt("",t,null,null,null):new Wt(Xt(t),null,e.scale?e.scale.evaluate(r):null,e.font?e.font.evaluate(r).join(","):null,e.textColor?e.textColor.evaluate(r):null)}))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){var e=["format"];for(const r of this.sections){e.push(r.content.serialize());var t={};r.scale&&(t["font-scale"]=r.scale.serialize()),r.font&&(t["text-font"]=r.font.serialize()),r.textColor&&(t["text-color"]=r.textColor.serialize()),e.push(t)}return e}}class tr{constructor(e){this.type=It,this.input=e}static parse(e,t){return 2!==e.length?t.error("Expected two arguments."):(e=t.parse(e[1],1,u))?new tr(e):t.error("No image name provided.")}evaluate(e){var t=this.input.evaluate(e),r=qt.fromString(t);return r&&e.availableImages&&(r.available=-1<e.availableImages.indexOf(t)),r}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const rr={"to-boolean":f,"to-color":Mt,"to-number":h,"to-string":u};var nr=class Ld{constructor(e,t){this.type=e,this.args=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");var e=t[0];if(("to-boolean"===e||"to-string"===e)&&2!==t.length)return r.error("Expected one argument.");const n=rr[e],i=[];for(let e=1;e<t.length;e++){const n=r.parse(t[e],e,m);if(!n)return null;i.push(n)}return new Ld(n,i)}evaluate(r){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(r));if("color"===this.type.kind){let e,t;for(const i of this.args){if(e=i.evaluate(r),t=null,e instanceof y)return e;if("string"==typeof e){var n=r.parseColor(e);if(n)return n}else if(Array.isArray(e)&&!(t=e.length<3||4<e.length?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:Ht(e[0],e[1],e[2],e[3])))return new y(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new Jt(t||`Could not parse color from value '${"string"==typeof e?e:String(JSON.stringify(e))}'`)}if("number"!==this.type.kind)return"formatted"===this.type.kind?Zt.fromString(Xt(this.args[0].evaluate(r))):"resolvedImage"===this.type.kind?qt.fromString(Xt(this.args[0].evaluate(r))):Xt(this.args[0].evaluate(r));{let e=null;for(const o of this.args){if(null===(e=o.evaluate(r)))return 0;var t=Number(e);if(!isNaN(t))return t}throw new Jt(`Could not convert ${JSON.stringify(e)} to number.`)}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new er([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new tr(this.args[0]).serialize();const t=["to-"+this.type.kind];return this.eachChild(e=>{t.push(e.serialize())}),t}};const ir=["Unknown","Point","LineString","Polygon"];var or=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?ir[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){var e,t,r,n;return this.featureTileCoord&&this.featureDistanceData?(e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:r,y:n}=this.featureTileCoord,this.featureDistanceData.bearing[0]*(r*t-e[0])+this.featureDistanceData.bearing[1]*(n*t-e[1])):0}parseColor(e){let t=this._parseColorCache[e];return t=t||(this._parseColorCache[e]=y.parse(e))}};class ar{constructor(e,t,r,n){this.name=e,this.type=t,this._evaluate=r,this.args=n}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(r,n){const i=r[0],o=ar.definitions[i];if(!o)return n.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const a=Array.isArray(o)?o[0]:o.type,s=Array.isArray(o)?[[o[1],o[2]]]:o.overloads,l=s.filter(([e])=>!Array.isArray(e)||e.length===r.length-1);let u=null;for(const[o,s]of l){u=new kr(n.registry,n.path,null,n.scope);const l=[];let t=!1;for(let e=1;e<r.length;e++){const i=r[e],a=Array.isArray(o)?o[e-1]:o.type,s=u.parse(i,1+l.length,a);if(!s){t=!0;break}l.push(s)}if(!t)if(Array.isArray(o)&&o.length!==l.length)u.error(`Expected ${o.length} arguments, but found ${l.length} instead.`);else{for(let e=0;e<l.length;e++){const n=Array.isArray(o)?o[e]:o.type,i=l[e];u.concat(e+1).checkSubtype(n,i.type)}if(0===u.errors.length)return new ar(i,a,s,l)}}if(1===l.length)n.errors.push(...u.errors);else{const i=(l.length?l:s).map(([e])=>{return e=e,Array.isArray(e)?`(${e.map(g).join(", ")})`:`(${g(e.type)}...)`}).join(" | "),o=[];for(let e=1;e<r.length;e++){const a=n.parse(r[e],1+o.length);if(!a)return null;o.push(g(a.type))}n.error(`Expected arguments of type ${i}, but found (${o.join(", ")}) instead.`)}return null}static register(e,t){for(const r in ar.definitions=t)e[r]=ar}}var sr=ar;class lr{constructor(e,t,r){this.type=Ct,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");e=e[1];if("object"!=typeof e||Array.isArray(e))return t.error("Collator options argument must be an object.");var r=t.parse(void 0!==e["case-sensitive"]&&e["case-sensitive"],1,f);if(!r)return null;var n=t.parse(void 0!==e["diacritic-sensitive"]&&e["diacritic-sensitive"],1,f);if(!n)return null;let i=null;return e.locale&&!(i=t.parse(e.locale,1,u))?null:new lr(r,n,i)}evaluate(e){return new Gt(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const ur=8192;function cr(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function hr(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function fr(r,n){let i=!1;for(let e=0,t=n.length;e<t;e++){var o=n[e];for(let e=0,t=o.length;e<t-1;e++){if(a=r,s=o[e],u=o[e+1],l=c=void 0,c=a[0]-s[0],s=a[1]-s[1],l=a[0]-u[0],a=a[1]-u[1],c*a-l*s==0&&c*l<=0&&s*a<=0)return;(u=o[e])[1]>r[1]!=(c=o[e+1])[1]>r[1]&&r[0]<(c[0]-u[0])*(r[1]-u[1])/(c[1]-u[1])+u[0]&&(i=!i)}}var a,s,l,u,c;return i}function dr(t,r){for(let e=0;e<r.length;e++)if(fr(t,r[e]))return 1}function pr(e,t,r,n){var i=n[0]-r[0],n=n[1]-r[1],e=(e[0]-r[0])*n-i*(e[1]-r[1]),n=(t[0]-r[0])*n-i*(t[1]-r[1]);return 0<e&&n<0||e<0&&0<n}function mr(t,r){for(let e=0;e<t.length;++e)if(!fr(t[e],r))return;for(let e=0;e<t.length-1;++e)if(function(t,r,e){for(const u of e)for(let e=0;e<u.length-1;++e)if(0!=(s=[(a=u[e+1])[0]-(o=u[e])[0],a[1]-o[1]])[0]*(l=[(i=r)[0]-(n=t)[0],i[1]-n[1]])[1]-s[1]*l[0]&&pr(n,i,o,a)&&pr(o,a,n,i))return 1;var n,i,o,a,s,l}(t[e],t[e+1],r))return;return 1}function gr(t,r){for(let e=0;e<r.length;e++)if(mr(t,r[e]))return 1}function yr(r,n,i){var o,a,e=[];for(let t=0;t<r.length;t++){var s=[];for(let e=0;e<r[t].length;e++){o=r[t][e],a=i,l=void 0,l=(180+o[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,a=Math.pow(2,a.z);var l=[Math.round(l*a*ur),Math.round(o*a*ur)];cr(n,l),s.push(l)}e.push(s)}return e}function vr(t,r,n){var i=[];for(let e=0;e<t.length;e++){var o=yr(t[e],r,n);i.push(o)}return i}function _r(t,r,n,i){if(t[0]<n[0]||t[0]>n[2]){const r=.5*i;let e=t[0]-n[0]>r?-i:n[0]-t[0]>r?i:0;0===e&&(e=t[0]-n[2]>r?-i:n[2]-t[0]>r?i:0),t[0]+=e}cr(r,t)}function xr(e,t,r,n){var i=Math.pow(2,n.z)*ur,o=[n.x*ur,n.y*ur],a=[];if(e)for(const n of e)for(const e of n){const n=[e.x+o[0],e.y+o[1]];_r(n,t,r,i),a.push(n)}return a}function br(e,t,r,n){var i=Math.pow(2,n.z)*ur,o=[n.x*ur,n.y*ur],a=[];if(e){for(const r of e){const e=[];for(const n of r){const r=[n.x+o[0],n.y+o[1]];cr(t,r),e.push(r)}a.push(e)}if(t[2]-t[0]<=i/2){(n=t)[0]=n[1]=1/0,n[2]=n[3]=-1/0;for(const e of a)for(const n of e)_r(n,t,r,i)}}return a}var wr=class Pd{constructor(e,t){this.type=f,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if($t(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){var r=t.features[e].geometry.type;if("Polygon"===r||"MultiPolygon"===r)return new Pd(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new Pd(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new Pd(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType()){var t=e,r=this.geometries,n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],o=t.canonicalID();if(!o)return!1;if("Polygon"===r.type){var a=yr(r.coordinates,i,o),s=xr(t.geometry(),n,i,o);if(!hr(n,i))return!1;for(const t of s)if(!fr(t,a))return!1}if("MultiPolygon"===r.type){var l=vr(r.coordinates,i,o),s=xr(t.geometry(),n,i,o);if(!hr(n,i))return!1;for(const t of s)if(!dr(t,l))return!1}return!0}if("LineString"===e.geometryType()){var u=e;if(r=this.geometries,t=[1/0,1/0,-1/0,-1/0],o=[1/0,1/0,-1/0,-1/0],!(n=u.canonicalID()))return!1;if("Polygon"===r.type){var c=yr(r.coordinates,o,n),h=br(u.geometry(),t,o,n);if(!hr(t,o))return!1;for(const u of h)if(!mr(u,c))return!1}if("MultiPolygon"===r.type){var f=vr(r.coordinates,o,n),h=br(u.geometry(),t,o,n);if(!hr(t,o))return!1;for(const u of h)if(!gr(u,f))return!1}return!0}}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}};function Er(e){if(e instanceof sr){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof wr)return!1;let t=!0;return e.eachChild(e=>{t&&!Er(e)&&(t=!1)}),t}function Tr(e){if(!(e instanceof sr&&"feature-state"===e.name)){let t=!0;return e.eachChild(e=>{t&&!Tr(e)&&(t=!1)}),t}}function Sr(e,t){if(e instanceof sr&&0<=t.indexOf(e.name))return!1;let r=!0;return e.eachChild(e=>{r&&!Sr(e,t)&&(r=!1)}),r}var Mr=class zd{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){return 2!==e.length||"string"!=typeof e[1]?t.error("'var' expression requires exactly one string literal argument."):(e=e[1],t.scope.has(e)?new zd(e,t.scope.get(e)):t.error(`Unknown variable "${e}". Make sure "${e}" has been bound in an enclosing "let" expression before using it.`,1))}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}};var kr=class Dd{constructor(e,t=[],r,n=new Tt,i=[]){this.registry=e,this.path=t,this.key=t.map(e=>`[${e}]`).join(""),this.scope=n,this.errors=i,this.expectedType=r}parse(e,t,r,n,i={}){return(t?this.concat(t,r,n):this)._parse(e,i)}_parse(t,r){function n(e,t,r){return"assert"===r?new Qt(t,[e]):"coerce"===r?new nr(t,[e]):e}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var e=t[0];if("string"!=typeof e)return this.error(`Expression name must be a string, but found ${typeof e} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;var i=this.registry[e];if(i){let e=i.parse(t,this);if(!e)return null;if(this.expectedType){const t=this.expectedType,o=e.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==o.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==o.kind&&"string"!==o.kind){if(this.checkSubtype(t,o))return null}else e=n(e,t,r.typeAnnotation||"coerce");else e=n(e,t,r.typeAnnotation||"assert")}if(!(e instanceof Yt)&&"resolvedImage"!==e.type.kind&&Cr(e)){const t=new or;try{e=new Yt(e.type,e.evaluate(t))}catch(t){return this.error(t.message),null}}return e}return this.error(`Unknown expression "${e}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(e,t,r){return e="number"==typeof e?this.path.concat(e):this.path,r=r?this.scope.concat(r):this.scope,new Dd(this.registry,e,t||null,r,this.errors)}error(e,...t){t=""+this.key+t.map(e=>`[${e}]`).join(""),this.errors.push(new Et(t,e))}checkSubtype(e,t){return(e=zt(e,t))&&this.error(e),e}};function Cr(e){if(e instanceof Mr)return Cr(e.boundExpression);if(e instanceof sr&&"error"===e.name)return!1;if(e instanceof lr)return!1;if(e instanceof wr)return!1;const t=e instanceof nr||e instanceof Qt;let r=!0;return e.eachChild(e=>{r=t?r&&Cr(e):r&&e instanceof Yt}),!!r&&Er(e)&&Sr(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ar(e,t){var r=e.length-1;let n,i,o=0,a=r,s;for(;o<=a;)if(n=e[s=Math.floor((o+a)/2)],i=e[s+1],n<=t){if(s===r||t<i)return s;o=s+1}else{if(!(t<n))throw new Jt("Input is not a number.");a=s-1}return 0}var Ir=class Od{constructor(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of r)this.labels.push(e),this.outputs.push(t)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");var e=r.parse(t[1],1,h);if(!e)return null;var n=[];let i=null;r.expectedType&&"value"!==r.expectedType.kind&&(i=r.expectedType);for(let e=1;e<t.length;e+=2){var o=1===e?-1/0:t[e],a=t[e+1],s=e,l=e+1;if("number"!=typeof o)return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(n.length&&n[n.length-1][0]>=o)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',s);if(!(s=r.parse(a,l,i)))return null;i=i||s.type,n.push([o,s])}return new Od(i,e,n)}evaluate(e){var t,r,n=this.labels,i=this.outputs;return(1===n.length||(t=this.input.evaluate(e))<=n[0]?i[0]:t>=n[(r=n.length)-1]?i[r-1]:i[Ar(n,t)]).evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){var t=["step",this.input.serialize()];for(let e=0;e<this.labels.length;e++)0<e&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t}};function k(e,t,r){return e*(1-r)+t*r}var Lr=Object.freeze({__proto__:null,number:k,color:function(e,t,r){return new y(k(e.r,t.r,r),k(e.g,t.g,r),k(e.b,t.b,r),k(e.a,t.a,r))},array:function(e,r,n){return e.map((e,t)=>k(e,r[t],n))}});const Pr=4/29,zr=6/29,Dr=3*zr*zr,Or=Math.PI/180,Rr=180/Math.PI;function Fr(e){return.008856451679035631<e?Math.pow(e,1/3):e/Dr+Pr}function Br(e){return e>zr?e*e*e:Dr*(e-Pr)}function Nr(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function jr(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Ur(e){var t=jr(e.r),r=jr(e.g),n=jr(e.b),i=Fr((.4124564*t+.3575761*r+.1804375*n)/.95047),o=Fr(.2126729*t+.7151522*r+.072175*n);return{l:116*o-16,a:500*(i-o),b:200*(o-Fr((.0193339*t+.119192*r+.9503041*n)/1.08883)),alpha:e.a}}function Vr(e){var t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,n=isNaN(e.b)?t:t-e.b/200,t=+Br(t),r=.95047*Br(r),n=1.08883*Br(n);return new y(Nr(3.2404542*r-1.5371385*t-.4985314*n),Nr(-.969266*r+1.8760108*t+.041556*n),Nr(.0556434*r-.2040259*t+1.0572252*n),e.alpha)}const Gr={forward:Ur,reverse:Vr,interpolate:function(e,t,r){return{l:k(e.l,t.l,r),a:k(e.a,t.a,r),b:k(e.b,t.b,r),alpha:k(e.alpha,t.alpha,r)}}},Wr={forward:function(e){var{l:t,a:r,b:n}=Ur(e),i=Math.atan2(n,r)*Rr;return{h:i<0?360+i:i,c:Math.sqrt(r*r+n*n),l:t,alpha:e.a}},reverse:function(e){var t=e.h*Or,r=e.c;return Vr({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:(n=e.h,i=t.h,n+r*(180<(i-=n)||i<-180?i-360*Math.round(i/360):i)),c:k(e.c,t.c,r),l:k(e.l,t.l,r),alpha:k(e.alpha,t.alpha,r)};var n,i}};var Zr=Object.freeze({__proto__:null,lab:Gr,hcl:Wr});class qr{constructor(e,t,r,n,i){this.type=e,this.operator=t,this.interpolation=r,this.input=n,this.labels=[],this.outputs=[];for(const[e,t]of i)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,r,n){let i=0;return"exponential"===e.name?i=Hr(t,e.base,r,n):"linear"===e.name?i=Hr(t,1,r,n):"cubic-bezier"===e.name&&(e=e.controlPoints,i=new j(e[0],e[1],e[2],e[3]).solve(Hr(t,1,r,n))),i}static parse(e,t){let[r,n,i,...o]=e;if(!Array.isArray(n)||0===n.length)return t.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const e=n[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:e}}else{if("cubic-bezier"!==n[0])return t.error("Unknown interpolation type "+String(n[0]),1,0);{const e=n.slice(1);if(4!==e.length||e.some(e=>"number"!=typeof e||e<0||1<e))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(i=t.parse(i,2,h)))return null;var a=[];let s=null;"interpolate-hcl"===r||"interpolate-lab"===r?s=Mt:t.expectedType&&"value"!==t.expectedType.kind&&(s=t.expectedType);for(let e=0;e<o.length;e+=2){const r=o[e],n=o[e+1],i=e+3,u=e+4;if("number"!=typeof r)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',i);if(a.length&&a[a.length-1][0]>=r)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',i);var l=t.parse(n,u,s);if(!l)return null;s=s||l.type,a.push([r,l])}return"number"===s.kind||"color"===s.kind||"array"===s.kind&&"number"===s.itemType.kind&&"number"==typeof s.N?new qr(s,r,n,i,a):t.error(`Type ${g(s)} is not interpolatable.`)}evaluate(e){var t,r,n=this.labels,i=this.outputs;return 1===n.length||(r=this.input.evaluate(e))<=n[0]?i[0].evaluate(e):r>=n[(t=n.length)-1]?i[t-1].evaluate(e):(t=Ar(n,r),r=qr.interpolationFactor(this.interpolation,r,n[t],n[t+1]),n=i[t].evaluate(e),i=i[t+1].evaluate(e),"interpolate"===this.operator?Lr[this.type.kind.toLowerCase()](n,i,r):"interpolate-hcl"===this.operator?Wr.reverse(Wr.interpolate(Wr.forward(n),Wr.forward(i),r)):Gr.reverse(Gr.interpolate(Gr.forward(n),Gr.forward(i),r)))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){var e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints),t=[this.operator,e,this.input.serialize()];for(let e=0;e<this.labels.length;e++)t.push(this.labels[e],this.outputs[e].serialize());return t}}function Hr(e,t,r,n){n-=r,e-=r;return 0==n?0:1===t?e/n:(Math.pow(t,e)-1)/(Math.pow(t,n)-1)}var $r=qr;var Xr=class Rd{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let r=null;const n=t.expectedType;n&&"value"!==n.kind&&(r=n);var i=[];for(const n of e.slice(1)){const e=t.parse(n,1+i.length,r,void 0,{typeAnnotation:"omit"});if(!e)return null;r=r||e.type,i.push(e)}return e=n&&i.some(e=>zt(n,e.type)),new Rd(e?m:r,i)}evaluate(e){let t,r=null,n=0;for(const i of this.args){if(n++,(r=i.evaluate(e))&&r instanceof qt&&!r.available&&(t=t||r,r=null,n===this.args.length))return t;if(null!==r)break}return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(e=>{t.push(e.serialize())}),t}};var Yr=class Fd{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);var n=[];for(let e=1;e<t.length-1;e+=2){var i=t[e];if("string"!=typeof i)return r.error(`Expected string, but found ${typeof i} instead.`,e);if(/[^a-zA-Z0-9_]/.test(i))return r.error("Variable names must contain only alphanumeric characters or '_'.",e);var o=r.parse(t[e+1],e+1);if(!o)return null;n.push([i,o])}var e=r.parse(t[t.length-1],t.length-1,r.expectedType,n);return e?new Fd(n,e):null}outputDefined(){return this.result.outputDefined()}serialize(){var e,t,r=["let"];for([e,t]of this.bindings)r.push(e,t.serialize());return r.push(this.result.serialize()),r}};var Jr=class Bd{constructor(e,t,r){this.type=e,this.index=t,this.input=r}static parse(e,t){var r;return 3!==e.length?t.error(`Expected 2 arguments, but found ${e.length-1} instead.`):(r=t.parse(e[1],1,h),e=t.parse(e[2],2,Lt(t.expectedType||m)),r&&e?new Bd(e.type.itemType,r,e):null)}evaluate(e){var t=this.index.evaluate(e),e=this.input.evaluate(e);if(t<0)throw new Jt(`Array index out of bounds: ${t} < 0.`);if(t>=e.length)throw new Jt(`Array index out of bounds: ${t} > ${e.length-1}.`);if(t!==Math.floor(t))throw new Jt(`Array index must be an integer, but found ${t} instead.`);return e[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}};var Kr=class Nd{constructor(e,t){this.type=f,this.needle=e,this.haystack=t}static parse(e,t){var r;return 3!==e.length?t.error(`Expected 2 arguments, but found ${e.length-1} instead.`):(r=t.parse(e[1],1,m),e=t.parse(e[2],2,m),r&&e?Dt(r.type,[f,u,h,St,m])?new Nd(r,e):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${g(r.type)} instead`):null)}evaluate(e){var t=this.needle.evaluate(e);if(null==(e=this.haystack.evaluate(e)))return!1;if(!Ot(t,["boolean","string","number","null"]))throw new Jt(`Expected first argument to be of type boolean, string, number or null, but found ${g(v(t))} instead.`);if(Ot(e,["string","array"]))return 0<=e.indexOf(t);throw new Jt(`Expected second argument to be of type array or string, but found ${g(v(e))} instead.`)}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}};var Qr=class jd{constructor(e,t,r){this.type=h,this.needle=e,this.haystack=t,this.fromIndex=r}static parse(e,t){var r,n;return e.length<=2||5<=e.length?t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`):(r=t.parse(e[1],1,m),n=t.parse(e[2],2,m),r&&n?Dt(r.type,[f,u,h,St,m])?4===e.length?(e=t.parse(e[3],3,h))?new jd(r,n,e):null:new jd(r,n):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${g(r.type)} instead`):null)}evaluate(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!Ot(t,["boolean","string","number","null"]))throw new Jt(`Expected first argument to be of type boolean, string, number or null, but found ${g(v(t))} instead.`);if(Ot(r,["string","array"]))return this.fromIndex?(e=this.fromIndex.evaluate(e),r.indexOf(t,e)):r.indexOf(t);throw new Jt(`Expected second argument to be of type array or string, but found ${g(v(r))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){var e;return null!=this.fromIndex&&void 0!==this.fromIndex?(e=this.fromIndex.serialize(),["index-of",this.needle.serialize(),this.haystack.serialize(),e]):["index-of",this.needle.serialize(),this.haystack.serialize()]}};var en=class Ud{constructor(e,t,r,n,i,o){this.inputType=e,this.type=t,this.input=r,this.cases=n,this.outputs=i,this.otherwise=o}static parse(r,n){if(r.length<5)return n.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return n.error("Expected an even number of arguments.");let i,o;n.expectedType&&"value"!==n.expectedType.kind&&(o=n.expectedType);var a={},s=[];for(let t=2;t<r.length-1;t+=2){let e=r[t];var l=r[t+1],u=(Array.isArray(e)||(e=[e]),n.concat(t));if(0===e.length)return u.error("Expected at least one branch label.");for(const r of e){if("number"!=typeof r&&"string"!=typeof r)return u.error("Branch labels must be numbers or strings.");if("number"==typeof r&&Math.abs(r)>Number.MAX_SAFE_INTEGER)return u.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof r&&Math.floor(r)!==r)return u.error("Numeric branch labels must be integer values.");if(i){if(u.checkSubtype(i,v(r)))return null}else i=v(r);if(void 0!==a[String(r)])return u.error("Branch labels must be unique.");a[String(r)]=s.length}if(!(l=n.parse(l,t,o)))return null;o=o||l.type,s.push(l)}var e,t=n.parse(r[1],1,m);return!t||!(e=n.parse(r[r.length-1],r.length-1,o))||"value"!==t.type.kind&&n.concat(1).checkSubtype(i,t.type)?null:new Ud(i,o,t,a,s,e)}evaluate(e){var t=this.input.evaluate(e);return(v(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),r=[],n={};for(const e of t){const t=n[this.cases[e]];void 0===t?(n[this.cases[e]]=r.length,r.push([this.cases[e],[e]])):r[t][1].push(e)}var i=e=>"number"===this.inputType.kind?Number(e):e;for(const[t,n]of r)e.push(1===n.length?i(n[0]):n.map(i)),e.push(this.outputs[t].serialize());return e.push(this.otherwise.serialize()),e}};var tn=class Vd{constructor(e,t,r){this.type=e,this.branches=t,this.otherwise=r}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let n;r.expectedType&&"value"!==r.expectedType.kind&&(n=r.expectedType);var i=[];for(let e=1;e<t.length-1;e+=2){var o=r.parse(t[e],e,f);if(!o)return null;var a=r.parse(t[e+1],e+1,n);if(!a)return null;i.push([o,a]),n=n||a.type}var e=r.parse(t[t.length-1],t.length-1,n);return e?new Vd(n,i,e):null}evaluate(e){for(var[t,r]of this.branches)if(t.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(var[t,r]of this.branches)e(t),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([,e])=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(e=>{t.push(e.serialize())}),t}};var rn=class Gd{constructor(e,t,r,n){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=n}static parse(e,t){var r,n;return e.length<=2||5<=e.length?t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`):(r=t.parse(e[1],1,m),n=t.parse(e[2],2,h),r&&n?Dt(r.type,[Lt(m),u,m])?4===e.length?(e=t.parse(e[3],3,h))?new Gd(r.type,r,n,e):null:new Gd(r.type,r,n):t.error(`Expected first argument to be of type array or string, but found ${g(r.type)} instead`):null)}evaluate(e){var t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(Ot(t,["string","array"]))return this.endIndex?(e=this.endIndex.evaluate(e),t.slice(r,e)):t.slice(r);throw new Jt(`Expected first argument to be of type array or string, but found ${g(v(t))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){var e;return null!=this.endIndex&&void 0!==this.endIndex?(e=this.endIndex.serialize(),["slice",this.input.serialize(),this.beginIndex.serialize(),e]):["slice",this.input.serialize(),this.beginIndex.serialize()]}};function nn(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function on(e,t,r,n){return 0===n.compare(t,r)}function an(n,i,o){const a="=="!==n&&"!="!==n;return class s{constructor(e,t,r){this.type=f,this.lhs=e,this.rhs=t,this.collator=r,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");var r=e[0];let n=t.parse(e[1],1,m);if(!n)return null;if(!nn(r,n.type))return t.concat(1).error(`"${r}" comparisons are not supported for type '${g(n.type)}'.`);let i=t.parse(e[2],2,m);if(!i)return null;if(!nn(r,i.type))return t.concat(2).error(`"${r}" comparisons are not supported for type '${g(i.type)}'.`);if(n.type.kind!==i.type.kind&&"value"!==n.type.kind&&"value"!==i.type.kind)return t.error(`Cannot compare types '${g(n.type)}' and '${g(i.type)}'.`);a&&("value"===n.type.kind&&"value"!==i.type.kind?n=new Qt(i.type,[n]):"value"!==n.type.kind&&"value"===i.type.kind&&(i=new Qt(n.type,[i])));let o=null;if(4===e.length){if("string"!==n.type.kind&&"string"!==i.type.kind&&"value"!==n.type.kind&&"value"!==i.type.kind)return t.error("Cannot use collator to compare non-string types.");if(!(o=t.parse(e[3],3,Ct)))return null}return new s(n,i,o)}evaluate(e){var t=this.lhs.evaluate(e),r=this.rhs.evaluate(e);if(a&&this.hasUntypedArgument){const i=v(t),o=v(r);if(i.kind!==o.kind||"string"!==i.kind&&"number"!==i.kind)throw new Jt(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${i.kind}, ${o.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const n=v(t),o=v(r);if("string"!==n.kind||"string"!==o.kind)return i(e,t,r)}return this.collator?o(e,t,r,this.collator.evaluate(e)):i(e,t,r)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[n];return this.eachChild(e=>{t.push(e.serialize())}),t}}}var sn=an("==",function(e,t,r){return t===r},on),ln=an("!=",function(e,t,r){return t!==r},function(e,t,r,n){return!on(0,t,r,n)}),un=an("<",function(e,t,r){return t<r},function(e,t,r,n){return n.compare(t,r)<0}),cn=an(">",function(e,t,r){return r<t},function(e,t,r,n){return 0<n.compare(t,r)}),hn=an("<=",function(e,t,r){return t<=r},function(e,t,r,n){return n.compare(t,r)<=0}),fn=an(">=",function(e,t,r){return r<=t},function(e,t,r,n){return 0<=n.compare(t,r)});sn={"==":sn,"!=":ln,">":cn,"<":un,">=":fn,"<=":hn,array:Qt,at:Jr,boolean:Qt,case:tn,coalesce:Xr,collator:lr,format:er,image:tr,in:Kr,"index-of":Qr,interpolate:$r,"interpolate-hcl":$r,"interpolate-lab":$r,length:class Wd{constructor(e){this.type=h,this.input=e}static parse(e,t){return 2!==e.length?t.error(`Expected 1 argument, but found ${e.length-1} instead.`):(e=t.parse(e[1],1))?"array"!==e.type.kind&&"string"!==e.type.kind&&"value"!==e.type.kind?t.error(`Expected argument of type string or array, but found ${g(e.type)} instead.`):new Wd(e):null}evaluate(e){if("string"==typeof(e=this.input.evaluate(e)))return e.length;if(Array.isArray(e))return e.length;throw new Jt(`Expected value to be of type string or array, but found ${g(v(e))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(e=>{t.push(e.serialize())}),t}},let:Yr,literal:Yt,match:en,number:Qt,"number-format":class Zd{constructor(e,t,r,n,i,o){this.type=u,this.number=e,this.locale=t,this.currency=r,this.unit=n,this.minFractionDigits=i,this.maxFractionDigits=o}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");var r=t.parse(e[1],1,h);if(!r)return null;if("object"!=typeof(e=e[2])||Array.isArray(e))return t.error("NumberFormat options argument must be an object.");let n=null;if(e.locale&&!(n=t.parse(e.locale,1,u)))return null;let i=null;if(e.currency&&!(i=t.parse(e.currency,1,u)))return null;let o=null;if(e.unit&&!(o=t.parse(e.unit,1,u)))return null;let a=null;if(e["min-fraction-digits"]&&!(a=t.parse(e["min-fraction-digits"],1,h)))return null;let s=null;return e["max-fraction-digits"]&&!(s=t.parse(e["max-fraction-digits"],1,h))?null:new Zd(r,n,i,o,a,s)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}},object:Qt,slice:rn,step:Ir,string:Qt,"to-boolean":nr,"to-color":nr,"to-number":nr,"to-string":nr,var:Mr,within:wr};function dn(e,[t,r,n,i]){t=t.evaluate(e),r=r.evaluate(e),n=n.evaluate(e);i=i?i.evaluate(e):1,e=Ht(t,r,n,i);if(e)throw new Jt(e);return new y(t/255*i,r/255*i,n/255*i,i)}function pn(e,t){t=t[e];return void 0===t?null:t}function mn(e){return{type:e}}sr.register(sn,{error:[{kind:"error"},[u],(e,[t])=>{throw new Jt(t.evaluate(e))}],typeof:[u,[m],(e,[t])=>g(v(t.evaluate(e)))],"to-rgba":[Lt(h,4),[Mt],(e,[t])=>t.evaluate(e).toArray()],rgb:[Mt,[h,h,h],dn],rgba:[Mt,[h,h,h,h],dn],has:{type:f,overloads:[[[u],(e,[t])=>t.evaluate(e)in e.properties()],[[u,kt],(e,[t,r])=>t.evaluate(e)in r.evaluate(e)]]},get:{type:m,overloads:[[[u],(e,[t])=>pn(t.evaluate(e),e.properties())],[[u,kt],(e,[t,r])=>pn(t.evaluate(e),r.evaluate(e))]]},"feature-state":[m,[u],(e,[t])=>pn(t.evaluate(e),e.featureState||{})],properties:[kt,[],e=>e.properties()],"geometry-type":[u,[],e=>e.geometryType()],id:[m,[],e=>e.id()],zoom:[h,[],e=>e.globals.zoom],pitch:[h,[],e=>e.globals.pitch||0],"distance-from-center":[h,[],e=>e.distanceFromCenter()],"heatmap-density":[h,[],e=>e.globals.heatmapDensity||0],"line-progress":[h,[],e=>e.globals.lineProgress||0],"sky-radial-progress":[h,[],e=>e.globals.skyRadialProgress||0],accumulated:[m,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[h,mn(h),(e,t)=>{let r=0;for(const n of t)r+=n.evaluate(e);return r}],"*":[h,mn(h),(e,t)=>{let r=1;for(const n of t)r*=n.evaluate(e);return r}],"-":{type:h,overloads:[[[h,h],(e,[t,r])=>t.evaluate(e)-r.evaluate(e)],[[h],(e,[t])=>-t.evaluate(e)]]},"/":[h,[h,h],(e,[t,r])=>t.evaluate(e)/r.evaluate(e)],"%":[h,[h,h],(e,[t,r])=>t.evaluate(e)%r.evaluate(e)],ln2:[h,[],()=>Math.LN2],pi:[h,[],()=>Math.PI],e:[h,[],()=>Math.E],"^":[h,[h,h],(e,[t,r])=>Math.pow(t.evaluate(e),r.evaluate(e))],sqrt:[h,[h],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[h,[h],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[h,[h],(e,[t])=>Math.log(t.evaluate(e))],log2:[h,[h],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[h,[h],(e,[t])=>Math.sin(t.evaluate(e))],cos:[h,[h],(e,[t])=>Math.cos(t.evaluate(e))],tan:[h,[h],(e,[t])=>Math.tan(t.evaluate(e))],asin:[h,[h],(e,[t])=>Math.asin(t.evaluate(e))],acos:[h,[h],(e,[t])=>Math.acos(t.evaluate(e))],atan:[h,[h],(e,[t])=>Math.atan(t.evaluate(e))],min:[h,mn(h),(t,e)=>Math.min(...e.map(e=>e.evaluate(t)))],max:[h,mn(h),(t,e)=>Math.max(...e.map(e=>e.evaluate(t)))],abs:[h,[h],(e,[t])=>Math.abs(t.evaluate(e))],round:[h,[h],(e,[t])=>{t=t.evaluate(e);return t<0?-Math.round(-t):Math.round(t)}],floor:[h,[h],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[h,[h],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[f,[u,m],(e,[t,r])=>e.properties()[t.value]===r.value],"filter-id-==":[f,[m],(e,[t])=>e.id()===t.value],"filter-type-==":[f,[u],(e,[t])=>e.geometryType()===t.value],"filter-<":[f,[u,m],(e,[t,r])=>{e=e.properties()[t.value],t=r.value;return typeof e==typeof t&&e<t}],"filter-id-<":[f,[m],(e,[t])=>{e=e.id(),t=t.value;return typeof e==typeof t&&e<t}],"filter->":[f,[u,m],(e,[t,r])=>{e=e.properties()[t.value],t=r.value;return typeof e==typeof t&&t<e}],"filter-id->":[f,[m],(e,[t])=>{e=e.id(),t=t.value;return typeof e==typeof t&&t<e}],"filter-<=":[f,[u,m],(e,[t,r])=>{e=e.properties()[t.value],t=r.value;return typeof e==typeof t&&e<=t}],"filter-id-<=":[f,[m],(e,[t])=>{e=e.id(),t=t.value;return typeof e==typeof t&&e<=t}],"filter->=":[f,[u,m],(e,[t,r])=>{e=e.properties()[t.value],t=r.value;return typeof e==typeof t&&t<=e}],"filter-id->=":[f,[m],(e,[t])=>{e=e.id(),t=t.value;return typeof e==typeof t&&t<=e}],"filter-has":[f,[m],(e,[t])=>t.value in e.properties()],"filter-has-id":[f,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[f,[Lt(u)],(e,[t])=>0<=t.value.indexOf(e.geometryType())],"filter-id-in":[f,[Lt(m)],(e,[t])=>0<=t.value.indexOf(e.id())],"filter-in-small":[f,[u,Lt(m)],(e,[t,r])=>0<=r.value.indexOf(e.properties()[t.value])],"filter-in-large":[f,[u,Lt(m)],(e,[t,r])=>{for(var n=e.properties()[t.value],i=r.value,o=0,a=r.value.length-1;o<=a;){var s=o+a>>1;if(i[s]===n)return!0;i[s]>n?a=s-1:o=1+s}return!1}],all:{type:f,overloads:[[[f,f],(e,[t,r])=>t.evaluate(e)&&r.evaluate(e)],[mn(f),(e,t)=>{for(const r of t)if(!r.evaluate(e))return!1;return!0}]]},any:{type:f,overloads:[[[f,f],(e,[t,r])=>t.evaluate(e)||r.evaluate(e)],[mn(f),(e,t)=>{for(const r of t)if(r.evaluate(e))return!0;return!1}]]},"!":[f,[f],(e,[t])=>!t.evaluate(e)],"is-supported-script":[f,[u],(e,[t])=>{var r=e.globals&&e.globals.isSupportedScript;return!r||r(t.evaluate(e))}],upcase:[u,[u],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[u,[u],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[u,mn(m),(t,e)=>e.map(e=>Xt(e.evaluate(t))).join("")],"resolved-locale":[u,[Ct],(e,[t])=>t.evaluate(e).resolvedLocale()]});var gn=sn;function yn(e){return{result:"success",value:e}}function vn(e){return{result:"error",value:e}}function _n(e){return"data-driven"===e["property-type"]}function xn(e){return e.expression&&-1<e.expression.parameters.indexOf("zoom")}function bn(e){return e.expression&&e.expression.interpolated}function x(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function wn(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function En(e){return e}function Tn(r,n){const t="color"===n.type,i=r.stops&&"object"==typeof r.stops[0][0],o=i||!(i||void 0!==r.property),a=r.type||(bn(n)?"exponential":"interval");if(t&&((r=xt({},r)).stops&&(r.stops=r.stops.map(e=>[e[0],y.parse(e[1])])),r.default=y.parse(r.default||n.default)),r.colorSpace&&"rgb"!==r.colorSpace&&!Zr[r.colorSpace])throw new Error("Unknown color space: "+r.colorSpace);let s,l,u;if("exponential"===a)s=Cn;else if("interval"===a)s=kn;else if("categorical"===a){s=Mn,l=Object.create(null);for(const n of r.stops)l[n[0]]=n[1];u=typeof r.stops[0][0]}else{if("identity"!==a)throw new Error(`Unknown function type "${a}"`);s=An}if(i){const t={},i=[];for(let e=0;e<r.stops.length;e++){const o=r.stops[e],a=o[0].zoom;void 0===t[a]&&(t[a]={zoom:a,type:r.type,property:r.property,default:r.default,stops:[]},i.push(a)),t[a].stops.push([o[0].value,o[1]])}const o=[];for(const r of i)o.push([t[r].zoom,Tn(t[r],n)]);const a={name:"linear"};return{kind:"composite",interpolationType:a,interpolationFactor:$r.interpolationFactor.bind(void 0,a),zoomStops:o.map(e=>e[0]),evaluate:({zoom:e},t)=>Cn({stops:o,base:r.base},n,e).evaluate(e,t)}}if(o){const t="exponential"===a?{name:"exponential",base:void 0!==r.base?r.base:1}:null;return{kind:"camera",interpolationType:t,interpolationFactor:$r.interpolationFactor.bind(void 0,t),zoomStops:r.stops.map(e=>e[0]),evaluate:({zoom:e})=>s(r,n,e,l,u)}}return{kind:"source",evaluate(e,t){t=t&&t.properties?t.properties[r.property]:void 0;return void 0===t?Sn(r.default,n.default):s(r,n,t,l,u)}}}function Sn(e,t,r){return void 0!==e?e:void 0!==t?t:void 0!==r?r:void 0}function Mn(e,t,r,n,i){return Sn(typeof r===i?n[r]:void 0,e.default,t.default)}function kn(e,t,r){return"number"!==x(r)?Sn(e.default,t.default):(1===(t=e.stops.length)||r<=e.stops[0][0]?e.stops[0]:r>=e.stops[t-1][0]?e.stops[t-1]:(t=Ar(e.stops.map(e=>e[0]),r),e.stops[t]))[1]}function Cn(e,r,t){var n=void 0!==e.base?e.base:1;if("number"!==x(t))return Sn(e.default,r.default);var i,o=e.stops.length;if(1===o)return e.stops[0][1];if(t<=e.stops[0][0])return e.stops[0][1];if(t>=e.stops[o-1][0])return e.stops[o-1][1];const a=Ar(e.stops.map(e=>e[0]),t),s=(o=t,t=n,n=e.stops[a][0],i=e.stops[a+1][0]-n,o-=n,0==i?0:1===t?o/i:(Math.pow(t,o)-1)/(Math.pow(t,i)-1)),l=e.stops[a][1],u=e.stops[a+1][1];let c=Lr[r.type]||En;if(e.colorSpace&&"rgb"!==e.colorSpace){const r=Zr[e.colorSpace];c=(e,t)=>r.reverse(r.interpolate(r.forward(e),r.forward(t),s))}return"function"==typeof l.evaluate?{evaluate(...e){var t=l.evaluate.apply(void 0,e),e=u.evaluate.apply(void 0,e);if(void 0!==t&&void 0!==e)return c(t,e,s)}}:c(l,u,s)}function An(e,t,r){return"color"===t.type?r=y.parse(r):"formatted"===t.type?r=Zt.fromString(r.toString()):"resolvedImage"===t.type?r=qt.fromString(r.toString()):x(r)===t.type||"enum"===t.type&&t.values[r]||(r=void 0),Sn(r,e.default,t.default)}class In{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new or,this._defaultValue=t?"color"===(e=t).type&&(wn(e.default)||Array.isArray(e.default))?new y(0,0,0,0):"color"===e.type?y.parse(e.default)||null:void 0===e.default?null:e.default:null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,r,n,i,o,a,s){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=n||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=s||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,r,n,i,o,a,s){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=n||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=s||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(!this._enumValues||e in this._enumValues)return e;throw new Jt(`Expected value to be one of ${Object.keys(this._enumValues).map(e=>JSON.stringify(e)).join(", ")}, but found ${JSON.stringify(e)} instead.`)}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function Ln(e){return Array.isArray(e)&&0<e.length&&"string"==typeof e[0]&&e[0]in gn}function Pn(e,t){var r=new kr(gn,[],t?(n=t,r={color:Mt,string:u,number:h,enum:u,boolean:f,formatted:At,resolvedImage:It},"array"===n.type?Lt(r[n.value]||m,n.length):r[n.type]):void 0),n=r.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return n?yn(new In(n,t)):vn(r.errors)}class zn{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!Tr(t.expression)}evaluateWithoutErrorHandling(e,t,r,n,i,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,n,i,o)}evaluate(e,t,r,n,i,o){return this._styleExpression.evaluate(e,t,r,n,i,o)}}class Dn{constructor(e,t,r,n){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent="camera"!==e&&!Tr(t.expression),this.interpolationType=n}evaluateWithoutErrorHandling(e,t,r,n,i,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,n,i,o)}evaluate(e,t,r,n,i,o){return this._styleExpression.evaluate(e,t,r,n,i,o)}interpolationFactor(e,t,r){return this.interpolationType?$r.interpolationFactor(this.interpolationType,e,t,r):0}}function On(e,t){var r,n,i;return"error"===(e=Pn(e,t)).result?e:(r=Er(i=e.value.expression))||_n(t)?(n=Sr(i,["zoom","pitch","distance-from-center"]))||xn(t)?(i=function r(e){let n=null;if(e instanceof Yr)n=r(e.result);else if(e instanceof Xr){for(const t of e.args)if(n=r(t),n)break}else(e instanceof Ir||e instanceof $r)&&e.input instanceof sr&&"zoom"===e.input.name&&(n=e);return n instanceof Et||e.eachChild(e=>{const t=r(e);t instanceof Et?n=t:!n&&t?n=new Et("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&t&&n!==t&&(n=new Et("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}(i))||n?i instanceof Et?vn([i]):i instanceof $r&&!bn(t)?vn([new Et("",'"interpolate" expressions cannot be used with this property')]):yn(i?new Dn(r?"camera":"composite",e.value,i.labels,i instanceof $r?i.interpolation:void 0):new zn(r?"constant":"source",e.value)):vn([new Et("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]):vn([new Et("","zoom expressions not supported")]):vn([new Et("","data expressions not supported")])}class Rn{constructor(e,t){this._parameters=e,this._specification=t,xt(this,Tn(this._parameters,this._specification))}static deserialize(e){return new Rn(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}class b{constructor(e,t,r,n){this.message=(e?e+": ":"")+r,n&&(this.identifier=n),null!=t&&t.__line__&&(this.line=t.__line__)}}function Fn(t){var r=t.key,n=t.value,i=t.valueSpec||{},o=t.objectElementValidators||{},a=t.style,s=t.styleSpec;let l=[];const u=x(n);if("object"!==u)return[new b(r,n,`object expected, ${u} found`)];for(const t in n){const u=t.split(".")[0],c=i[u]||i["*"];let e;o[u]?e=o[u]:i[u]?e=hi:o["*"]?e=o["*"]:i["*"]&&(e=hi),e?l=l.concat(e({key:(r&&r+".")+t,value:n[t],valueSpec:c,style:a,styleSpec:s,object:n,objectKey:t},n)):l.push(new b(r,n[t],`unknown property "${t}"`))}for(const t in i)o[t]||i[t].required&&void 0===i[t].default&&void 0===n[t]&&l.push(new b(r,n,`missing required property "${t}"`));return l}function Bn(e){var t=e.value,r=e.valueSpec,n=e.style,i=e.styleSpec,o=e.key,a=e.arrayElementValidator||hi;if("array"!==x(t))return[new b(o,t,`array expected, ${x(t)} found`)];if(r.length&&t.length!==r.length)return[new b(o,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new b(o,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let s={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0},l=(i.$version<7&&(s.function=r.function),"object"===x(r.value)&&(s=r.value),[]);for(let e=0;e<t.length;e++)l=l.concat(a({array:t,arrayIndex:e,value:t[e],valueSpec:s,style:n,styleSpec:i,key:`${o}[${e}]`}));return l}function Nn(t){var r=t.key,n=t.value,i=t.valueSpec;let e=x(n);if("number"!==(e="number"===e&&n!=n?"NaN":e))return[new b(r,n,`number expected, ${e} found`)];if("minimum"in i){let e=i.minimum;if(n<(e="array"===x(i.minimum)?i.minimum[t.arrayIndex]:e))return[new b(r,n,n+" is less than the minimum value "+e)]}if("maximum"in i){let e=i.maximum;if(n>(e="array"===x(i.maximum)?i.maximum[t.arrayIndex]:e))return[new b(r,n,n+" is greater than the maximum value "+e)]}return[]}function jn(e){const i=e.valueSpec,o=d(e.value.type);let a,s,l,u={};const t="categorical"!==o&&void 0===e.value.property,r=!t,c="array"===x(e.value.stops)&&"array"===x(e.value.stops[0])&&"object"===x(e.value.stops[0][0]),n=Fn({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===o)return[new b(e.key,e.value,'identity function may not have a "stops" property')];let t=[];var r=e.value;return t=t.concat(Bn({key:e.key,value:r,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===x(r)&&0===r.length&&t.push(new b(e.key,r,"array must have at least one stop")),t},default:function(e){return hi({key:e.key,value:e.value,valueSpec:i,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===o&&t&&n.push(new b(e.key,e.value,'missing required property "property"')),"identity"===o||e.value.stops||n.push(new b(e.key,e.value,'missing required property "stops"')),"exponential"===o&&e.valueSpec.expression&&!bn(e.valueSpec)&&n.push(new b(e.key,e.value,"exponential functions not supported")),8<=e.styleSpec.$version&&(r&&!_n(e.valueSpec)?n.push(new b(e.key,e.value,"property functions not supported")):t&&!xn(e.valueSpec)&&n.push(new b(e.key,e.value,"zoom functions not supported"))),"categorical"!==o&&!c||void 0!==e.value.property||n.push(new b(e.key,e.value,'"property" property is required')),n;function h(e){let t=[];var r=e.value,n=e.key;if("array"!==x(r))return[new b(n,r,`array expected, ${x(r)} found`)];if(2!==r.length)return[new b(n,r,`array length 2 expected, length ${r.length} found`)];if(c){if("object"!==x(r[0]))return[new b(n,r,`object expected, ${x(r[0])} found`)];if(void 0===r[0].zoom)return[new b(n,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new b(n,r,"object stop key must have value")];const i=d(r[0].zoom);if("number"!=typeof i)return[new b(n,r[0].zoom,"stop zoom values must be numbers")];if(l&&l>i)return[new b(n,r[0].zoom,"stop zoom values must appear in ascending order")];i!==l&&(l=i,s=void 0,u={}),t=t.concat(Fn({key:n+"[0]",value:r[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:Nn,value:f}}))}else t=t.concat(f({key:n+"[0]",value:r[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},r));return Ln(bt(r[1]))?t.concat([new b(n+"[1]",r[1],"expressions are not allowed in function stops.")]):t.concat(hi({key:n+"[1]",value:r[1],valueSpec:i,style:e.style,styleSpec:e.styleSpec}))}function f(t,r){var n=x(t.value),e=d(t.value),r=null!==t.value?t.value:r;if(a){if(n!==a)return[new b(t.key,r,n+" stop domain type must match previous stop domain type "+a)]}else a=n;if("number"!==n&&"string"!==n&&"boolean"!==n&&"number"!=typeof e&&"string"!=typeof e&&"boolean"!=typeof e)return[new b(t.key,r,"stop domain value must be a number, string, or boolean")];if("number"===n||"categorical"===o)return"categorical"!==o||"number"!==n||"number"==typeof e&&isFinite(e)&&Math.floor(e)===e?"categorical"!==o&&"number"===n&&"number"==typeof e&&"number"==typeof s&&void 0!==s&&e<s?[new b(t.key,r,"stop domain values must appear in ascending order")]:(s=e,"categorical"===o&&e in u?[new b(t.key,r,"stop domain values must be unique")]:(u[e]=!0,[])):[new b(t.key,r,"integer expected, found "+String(e))];{let e=`number expected, ${n} found`;return _n(i)&&void 0===o&&(e+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new b(t.key,r,e)]}}}function Un(t){var e=("property"===t.expressionContext?On:Pn)(bt(t.value),t.valueSpec);if("error"===e.result)return e.value.map(e=>new b(""+t.key+e.key,t.value,e.message));e=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!e.outputDefined())return[new b(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Tr(e))return[new b(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return function t(e,r){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const e of r.valueSpec.expression.parameters)n.delete(e);if(0===n.size)return[];const i=[];return e instanceof sr&&n.has(e.name)?[new b(r.key,r.value,`["${e.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: `+r.object.id)]:(e.eachChild(e=>{i.push(...t(e,r))}),i)}(e,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Sr(e,["zoom","feature-state"]))return[new b(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Er(e))return[new b(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Vn(e){var t=e.key,r=e.value,e=e.valueSpec,n=[];return Array.isArray(e.values)?-1===e.values.indexOf(d(r))&&n.push(new b(t,r,`expected one of [${e.values.join(", ")}], ${JSON.stringify(r)} found`)):-1===Object.keys(e.values).indexOf(d(r))&&n.push(new b(t,r,`expected one of [${Object.keys(e.values).join(", ")}], ${JSON.stringify(r)} found`)),n}function Gn(e){if(!0===e||!1===e)return 1;if(Array.isArray(e)&&0!==e.length)switch(e[0]){case"has":return 2<=e.length&&"$id"!==e[1]&&"$type"!==e[1];case"in":return 3<=e.length&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Gn(t)&&"boolean"!=typeof t)return;return 1;default:return 1}}function Wn(o,e="fill"){if(null==o)return{filter:()=>!0,needGeometry:!1,needFeature:!1};var t,r=o=Gn(o)?o:$n(o);let n=!0;try{n=Zn(t=r)?(function t(r){let n=!1;const i=[];if("case"===r[0]){for(let e=1;e<r.length-1;e+=2)n=n||Zn(r[e]),i.push(r[e+1]);i.push(r[r.length-1])}else if("match"===r[0]){n=n||Zn(r[1]);for(let e=2;e<r.length-1;e+=2)i.push(r[e+1]);i.push(r[r.length-1])}else if("step"===r[0]){n=n||Zn(r[1]);for(let e=1;e<r.length-1;e+=2)i.push(r[e+1])}n&&(r.length=0,r.push("any",...i));for(let e=1;e<r.length;e++)t(r[e])}(s=bt(t)),function t(e){if(!Array.isArray(e))return e;const r=function(t){if(qn.has(t[0]))for(let e=1;e<t.length;e++)if(Zn(t[e]))return!0;return t}(e);return!0===r?r:r.map(e=>t(e))}(s)):t}catch(o){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}const i=c["filter_"+e],a=Pn(n,i);var s;if("error"===a.result)throw new Error(a.value.map(e=>e.key+": "+e.message).join(", "));s=(e,t,r)=>a.value.evaluate(e,t,{},r);let l=null,u=null;if(n!==r){const o=Pn(r,i);if("error"===o.result)throw new Error(o.value.map(e=>e.key+": "+e.message).join(", "));l=(e,t,r,n,i)=>o.value.evaluate(e,t,{},r,void 0,void 0,n,i),u=!Er(o.value.expression)}return{filter:s,dynamicFilter:l||void 0,needGeometry:function t(r){if(!Array.isArray(r))return!1;if("within"===r[0])return!0;for(let e=1;e<r.length;e++)if(t(r[e]))return!0;return!1}(n),needFeature:!!u}}function Zn(t){if(Array.isArray(t)){if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let e=1;e<t.length;e++)if(Zn(t[e]))return!0}return!1}const qn=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Hn(e,t){return e<t?-1:t<e?1:0}function $n(e){var t,r;return!e||(t=e[0],e.length<=1?"any"!==t:"=="===t?Xn(e[1],e[2],"=="):"!="===t?Kn(Xn(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?Xn(e[1],e[2],t):"any"===t?(r=e.slice(1),["any"].concat(r.map($n))):"all"===t?["all"].concat(e.slice(1).map($n)):"none"===t?["all"].concat(e.slice(1).map($n).map(Kn)):"in"===t?Yn(e[1],e.slice(2)):"!in"===t?Kn(Yn(e[1],e.slice(2))):"has"===t?Jn(e[1]):"!has"===t?Kn(Jn(e[1])):"within"!==t||e)}function Xn(e,t,r){switch(e){case"$type":return["filter-type-"+r,t];case"$id":return["filter-id-"+r,t];default:return["filter-"+r,e,t]}}function Yn(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return 200<t.length&&!t.some(e=>typeof e!=typeof t[0])?["filter-in-large",e,["literal",t.sort(Hn)]]:["filter-in-small",e,["literal",t]]}}function Jn(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Kn(e){return["!",e]}function Qn(e){return Gn(bt(e.value))?Un(xt({},e,{expressionContext:"filter",valueSpec:e.styleSpec["filter_"+(e.layerType||"fill")]})):function t(r){const n=r.value,i=r.key;if("array"!==x(n))return[new b(i,n,`array expected, ${x(n)} found`)];const o=r.styleSpec;let a,s=[];if(n.length<1)return[new b(i,n,"filter array must have at least 1 element")];switch(s=s.concat(Vn({key:i+"[0]",value:n[0],valueSpec:o.filter_operator,style:r.style,styleSpec:r.styleSpec})),d(n[0])){case"<":case"<=":case">":case">=":2<=n.length&&"$type"===d(n[1])&&s.push(new b(i,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":3!==n.length&&s.push(new b(i,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":2<=n.length&&("string"!==(a=x(n[1]))&&s.push(new b(i+"[1]",n[1],`string expected, ${a} found`)));for(let e=2;e<n.length;e++)a=x(n[e]),"$type"===d(n[1])?s=s.concat(Vn({key:`${i}[${e}]`,value:n[e],valueSpec:o.geometry_type,style:r.style,styleSpec:r.styleSpec})):"string"!==a&&"number"!==a&&"boolean"!==a&&s.push(new b(`${i}[${e}]`,n[e],`string, number, or boolean expected, ${a} found`));break;case"any":case"all":case"none":for(let e=1;e<n.length;e++)s=s.concat(t({key:`${i}[${e}]`,value:n[e],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":a=x(n[1]),2!==n.length?s.push(new b(i,n,`filter array for "${n[0]}" operator must have 2 elements`)):"string"!==a&&s.push(new b(i+"[1]",n[1],`string expected, ${a} found`));break;case"within":a=x(n[1]),2!==n.length?s.push(new b(i,n,`filter array for "${n[0]}" operator must have 2 elements`)):"object"!==a&&s.push(new b(i+"[1]",n[1],`object expected, ${a} found`))}return s}(e)}function ei(e,t){var r=e.key,n=e.style,i=e.styleSpec,o=e.value,a=e.objectKey,s=i[t+"_"+e.layerType];if(!s)return[];var l=a.match(/^(.*)-transition$/);if("paint"===t&&l&&s[l[1]]&&s[l[1]].transition)return hi({key:r,value:o,valueSpec:i.transition,style:n,styleSpec:i});l=e.valueSpec||s[a];if(!l)return[new b(r,o,`unknown property "${a}"`)];let u;return"string"===x(o)&&_n(l)&&!l.tokens&&(u=/^{([^}]+)}$/.exec(o))?[new b(r,o,`"${a}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(u[1])} }\`.`)]:(s=[],"symbol"===e.layerType&&("text-field"===a&&n&&!n.glyphs&&s.push(new b(r,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&wn(bt(o))&&"identity"===d(o.type)&&s.push(new b(r,o,'"text-font" does not support identity functions'))),s.concat(hi({key:e.key,value:o,valueSpec:l,style:n,styleSpec:i,expressionContext:"property",propertyType:t,propertyKey:a})))}function ti(e){return ei(e,"paint")}function ri(e){return ei(e,"layout")}function ni(t){let r=[];const n=t.value,i=t.key,o=t.style,a=t.styleSpec;n.type||n.ref||r.push(new b(i,n,'either "type" or "ref" is required'));let s=d(n.type);const l=d(n.ref);if(n.id){const a=d(n.id);for(let e=0;e<t.arrayIndex;e++){const t=o.layers[e];d(t.id)===a&&r.push(new b(i,n.id,`duplicate layer id "${n.id}", previously used at line `+t.id.__line__))}}if("ref"in n){let t;["type","source","source-layer","filter","layout"].forEach(e=>{e in n&&r.push(new b(i,n[e],`"${e}" is prohibited for ref layers`))}),o.layers.forEach(e=>{d(e.id)===l&&(t=e)}),t?t.ref?r.push(new b(i,n.ref,"ref cannot reference another ref layer")):s=d(t.type):"string"==typeof l&&r.push(new b(i,n.ref,`ref layer "${l}" not found`))}else if("background"!==s&&"sky"!==s)if(n.source){const t=o.sources&&o.sources[n.source],a=t&&d(t.type);t?"vector"===a&&"raster"===s?r.push(new b(i,n.source,`layer "${n.id}" requires a raster source`)):"raster"===a&&"raster"!==s?r.push(new b(i,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==a||n["source-layer"]?"raster-dem"===a&&"hillshade"!==s?r.push(new b(i,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||"geojson"===a&&t.lineMetrics||r.push(new b(i,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new b(i,n,`layer "${n.id}" must specify a "source-layer"`)):r.push(new b(i,n.source,`source "${n.source}" not found`))}else r.push(new b(i,n,'missing required property "source"'));return r=r.concat(Fn({key:i,value:n,valueSpec:a.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>hi({key:i+".type",value:n.type,valueSpec:a.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:e=>Qn(xt({layerType:s},e)),layout:e=>Fn({layer:n,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>ri(xt({layerType:s},e))}}),paint:e=>Fn({layer:n,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>ti(xt({layerType:s},e))}})}}))}function ii(e){var t=e.value,e=e.key,r=x(t);return"string"!==r?[new b(e,t,`string expected, ${r} found`)]:[]}const oi={promoteId:function({key:e,value:t}){if("string"===x(t))return ii({key:e,value:t});var r=[];for(const n in t)r.push(...ii({key:e+"."+n,value:t[n]}));return r}};function ai(e){const t=e.value,r=e.key,n=e.styleSpec,i=e.style;if(!t.type)return[new b(r,t,'"type" is required')];const o=d(t.type);let a;switch(o){case"vector":case"raster":case"raster-dem":return a=Fn({key:r,value:t,valueSpec:n["source_"+o.replace("-","_")],style:e.style,styleSpec:n,objectElementValidators:oi});case"geojson":if(a=Fn({key:r,value:t,valueSpec:n.source_geojson,style:i,styleSpec:n,objectElementValidators:oi}),t.cluster)for(const e in t.clusterProperties){const[n,i]=t.clusterProperties[e],o="string"==typeof n?[n,["accumulated"],["get",e]]:n;a.push(...Un({key:`${r}.${e}.map`,value:i,expressionContext:"cluster-map"})),a.push(...Un({key:`${r}.${e}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return a;case"video":return Fn({key:r,value:t,valueSpec:n.source_video,style:i,styleSpec:n});case"image":return Fn({key:r,value:t,valueSpec:n.source_image,style:i,styleSpec:n});case"canvas":return[new b(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Vn({key:r+".type",value:t.type,valueSpec:{values:(s=n).source.reduce((e,t)=>{t=s[t];return e="enum"===t.type.type?e.concat(Object.keys(t.type.values)):e},[])},style:i,styleSpec:n})}var s}function si(e){var t=e.value,r=e.styleSpec,n=r.light,i=e.style;let o=[];const a=x(t);if(void 0!==t)if("object"!==a)o=o.concat([new b("light",t,`object expected, ${a} found`)]);else for(const e in t){const a=e.match(/^(.*)-transition$/);o=o.concat(a&&n[a[1]]&&n[a[1]].transition?hi({key:e,value:t[e],valueSpec:r.transition,style:i,styleSpec:r}):n[e]?hi({key:e,value:t[e],valueSpec:n[e],style:i,styleSpec:r}):[new b(e,t[e],`unknown property "${e}"`)])}return o}function li(e){const t=e.value,r=e.key,n=e.style,i=e.styleSpec,o=i.terrain;let a=[];e=x(t);if(void 0!==t)if("object"!==e)a=a.concat([new b("terrain",t,`object expected, ${e} found`)]);else{for(const e in t){const r=e.match(/^(.*)-transition$/);a=a.concat(r&&o[r[1]]&&o[r[1]].transition?hi({key:e,value:t[e],valueSpec:i.transition,style:n,styleSpec:i}):o[e]?hi({key:e,value:t[e],valueSpec:o[e],style:n,styleSpec:i}):[new b(e,t[e],`unknown property "${e}"`)])}if(t.source){const e=n.sources&&n.sources[t.source],i=e&&d(e.type);e?"raster-dem"!==i&&a.push(new b(r,t.source,`terrain cannot be used with a source of type ${String(i)}, it only be used with a "raster-dem" source type`)):a.push(new b(r,t.source,`source "${t.source}" not found`))}else a.push(new b(r,t,'terrain is missing required property "source"'))}return a}function ui(e){var t=e.value,r=e.style,n=e.styleSpec,i=n.fog;let o=[];const a=x(t);if(void 0!==t)if("object"!==a)o=o.concat([new b("fog",t,`object expected, ${a} found`)]);else for(const e in t){const a=e.match(/^(.*)-transition$/);o=o.concat(a&&i[a[1]]&&i[a[1]].transition?hi({key:e,value:t[e],valueSpec:n.transition,style:r,styleSpec:n}):i[e]?hi({key:e,value:t[e],valueSpec:i[e],style:r,styleSpec:n}):[new b(e,t[e],`unknown property "${e}"`)])}return o}const ci={"*":()=>[],array:Bn,boolean:function(e){var t=e.value,e=e.key,r=x(t);return"boolean"!==r?[new b(e,t,`boolean expected, ${r} found`)]:[]},number:Nn,color:function(e){var t=e.key,e=e.value,r=x(e);return"string"!==r?[new b(t,e,`color expected, ${r} found`)]:null===Rt(e)?[new b(t,e,`color expected, "${e}" found`)]:[]},enum:Vn,filter:Qn,function:jn,layer:ni,object:Fn,source:ai,light:si,terrain:li,fog:ui,string:ii,formatted:function(e){return 0===ii(e).length?[]:Un(e)},resolvedImage:function(e){return 0===ii(e).length?[]:Un(e)},projection:function(e){var t=e.value,r=e.styleSpec,n=r.projection,i=e.style;let o=[];e=x(t);if("object"===e)for(const e in t)o=o.concat(hi({key:e,value:t[e],valueSpec:n[e],style:i,styleSpec:r}));else"string"!==e&&(o=o.concat([new b("projection",t,`object or string expected, ${e} found`)]));return o}};function hi(e){var t=e.value,r=e.valueSpec,n=e.styleSpec;return r.expression&&wn(d(t))?jn(e):r.expression&&Ln(bt(t))?Un(e):r.type&&ci[r.type]?ci[r.type](e):Fn(xt({},e,{valueSpec:r.type?n[r.type]:r}))}function fi(e){var t=e.value,r=e.key,e=ii(e);return e.length||(-1===t.indexOf("{fontstack}")&&e.push(new b(r,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&e.push(new b(r,t,'"glyphs" url must include a "{range}" token'))),e}function di(e,t=c){return gi(hi({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:fi,"*":()=>[]}}))}const pi=e=>gi(ti(e)),mi=e=>gi(ri(e));function gi(e){return e.slice().sort((e,t)=>e.line&&t.line?e.line-t.line:0)}function yi(e,t){let r=!1;if(t&&t.length)for(const n of t)e.fire(new vt(new Error(n.message))),r=!0;return r}var vi=_i;function _i(e,t,r){var n=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var i=new Int32Array(this.arrayBuffer);e=i[0],this.d=(t=i[1])+2*(r=i[2]);for(var o=0;o<this.d*this.d;o++){var a=i[3+o],s=i[3+o+1];n.push(a===s?null:i.subarray(a,s))}var l=i[3+n.length+1];this.keys=i.subarray(i[3+n.length],l),this.bboxes=i.subarray(l),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var u=0;u<this.d*this.d;u++)n.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;l=r/t*e;this.min=-l,this.max=e+l}_i.prototype.insert=function(e,t,r,n,i){this._forEachCell(t,r,n,i,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)},_i.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},_i.prototype._insertCell=function(e,t,r,n,i,o){this.cells[i].push(o)},_i.prototype.query=function(e,t,r,n,i){var o=this.min,a=this.max;return e<=o&&t<=o&&a<=r&&a<=n&&!i?Array.prototype.slice.call(this.keys):(this._forEachCell(e,t,r,n,this._queryCell,o=[],{},i),o)},_i.prototype._queryCell=function(e,t,r,n,i,o,a,s){var l=this.cells[i];if(null!==l)for(var u=this.keys,c=this.bboxes,h=0;h<l.length;h++){var f,d=l[h];void 0===a[d]&&(f=4*d,(s?s(c[0+f],c[1+f],c[2+f],c[3+f]):e<=c[2+f]&&t<=c[3+f]&&r>=c[0+f]&&n>=c[1+f])?(a[d]=!0,o.push(u[d])):a[d]=!1)}},_i.prototype._forEachCell=function(e,t,r,n,i,o,a,s){for(var l=this._convertToCellCoord(e),u=this._convertToCellCoord(t),c=this._convertToCellCoord(r),h=this._convertToCellCoord(n),f=l;f<=c;f++)for(var d=u;d<=h;d++){var p=this.d*d+f;if((!s||s(this._convertFromCellCoord(f),this._convertFromCellCoord(d),this._convertFromCellCoord(f+1),this._convertFromCellCoord(d+1)))&&i.call(this,e,t,r,n,p,o,a,s))return}},_i.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},_i.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},_i.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,r=0,n=0;n<this.cells.length;n++)r+=this.cells[n].length;var i=new Int32Array(t+r+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var o=t,a=0;a<e.length;a++){var s=e[a];i[3+a]=o,i.set(s,o),o+=s.length}return i[3+e.length]=o,i.set(this.keys,o),i[3+e.length+1]=o+=this.keys.length,i.set(this.bboxes,o),o+=this.bboxes.length,i.buffer};const xi={};function e(e,t,r={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),xi[t]={klass:e,omit:r.omit||[]}}e(Object,"Object"),vi.serialize=function(e,t){e=e.toArrayBuffer();return t&&t.push(e),{buffer:e}},vi.deserialize=function(e){return new vi(e.buffer)},Object.defineProperty(vi,"name",{value:"Grid"}),e(vi,"Grid"),e(y,"Color"),e(Error,"Error"),e(Le,"AJAXError"),e(qt,"ResolvedImage"),e(Rn,"StylePropertyFunction"),e(In,"StyleExpression",{omit:["_evaluator"]}),e(Dn,"ZoomDependentExpression"),e(zn,"ZoomConstantExpression"),e(sr,"CompoundExpression",{omit:["_evaluate"]});for(const l in gn)xi[gn[l]._classRegistryKey]||e(gn[l],"Expression"+l);function bi(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function wi(e){return p.ImageBitmap&&e instanceof p.ImageBitmap}function Ei(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(bi(e)||wi(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){const p=e;return t&&t.push(p.buffer),p}if(e instanceof p.ImageData)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){const p=[];for(const n of e)p.push(Ei(n,t));return p}if("object"!=typeof e)throw new Error("can't serialize object of type "+typeof e);{const p=e.constructor,i=p._classRegistryKey;if(!i)throw new Error("can't serialize object of unregistered class "+i);var r=p.serialize?p.serialize(e,t):{};if(!p.serialize){for(const p in e)!e.hasOwnProperty(p)||0<=xi[i].omit.indexOf(p)||(r[p]=Ei(e[p],t));e instanceof Error&&(r.message=e.message)}if(r.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==i&&(r.$name=i),r}}function Ti(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||bi(e)||wi(e)||ArrayBuffer.isView(e)||e instanceof p.ImageData)return e;if(Array.isArray(e))return e.map(Ti);if("object"!=typeof e)throw new Error("can't deserialize object of type "+typeof e);{const p=e.$name||"Object",r=xi[p]["klass"];if(!r)throw new Error("can't deserialize unregistered class "+p);if(r.deserialize)return r.deserialize(e);var t=Object.create(r.prototype);for(const p of Object.keys(e))"$name"!==p&&(t[p]=Ti(e[p]));return t}}const Si=e=>1536<=e&&e<=1791,Mi=e=>1872<=e&&e<=1919,ki=e=>2208<=e&&e<=2303,Ci=e=>11904<=e&&e<=12031,Ai=e=>12032<=e&&e<=12255,Ii=e=>12272<=e&&e<=12287,Li=e=>12288<=e&&e<=12351,Pi=e=>12352<=e&&e<=12447,zi=e=>12448<=e&&e<=12543,Di=e=>12544<=e&&e<=12591,Oi=e=>12704<=e&&e<=12735,Ri=e=>12736<=e&&e<=12783,Fi=e=>12784<=e&&e<=12799,Bi=e=>12800<=e&&e<=13055,Ni=e=>13056<=e&&e<=13311,ji=e=>13312<=e&&e<=19903,Ui=e=>19968<=e&&e<=40959,Vi=e=>40960<=e&&e<=42127,Gi=e=>42128<=e&&e<=42191,Wi=e=>44032<=e&&e<=55215,Zi=e=>63744<=e&&e<=64255,qi=e=>64336<=e&&e<=65023,Hi=e=>65040<=e&&e<=65055,$i=e=>65072<=e&&e<=65103,Xi=e=>65104<=e&&e<=65135,Yi=e=>65136<=e&&e<=65279,Ji=e=>65280<=e&&e<=65519;function Ki(e){for(const t of e)if(eo(t.charCodeAt(0)))return!0;return!1}function Qi(e){for(const r of e)if(t=r.charCodeAt(0),Si(t)||Mi(t)||ki(t)||qi(t)||Yi(t))return;var t;return 1}function eo(e){return 746===e||747===e||!(e<4352)&&(Oi(e)||Di(e)||$i(e)&&!(65097<=e&&e<=65103)||Zi(e)||Ni(e)||Ci(e)||Ri(e)||!(!Li(e)||12296<=e&&e<=12305||12308<=e&&e<=12319||12336===e)||ji(e)||Ui(e)||Bi(e)||12592<=e&&e<=12687||43360<=e&&e<=43391||55216<=e&&e<=55295||4352<=e&&e<=4607||Wi(e)||Pi(e)||Ii(e)||12688<=e&&e<=12703||Ai(e)||Fi(e)||zi(e)&&12540!==e||!(!Ji(e)||65288===e||65289===e||65293===e||65306<=e&&e<=65310||65339===e||65341===e||65343===e||65371<=e&&e<=65503||65507===e||65512<=e&&e<=65519)||!(!Xi(e)||65112<=e&&e<=65118||65123<=e&&e<=65126)||5120<=e&&e<=5759||6320<=e&&e<=6399||Hi(e)||19904<=e&&e<=19967||Vi(e)||Gi(e))}function to(e){return!(eo(e)||(128<=(e=e)&&e<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||8192<=e&&e<=8303&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||8448<=e&&e<=8527||8528<=e&&e<=8591||8960<=e&&e<=9215&&(8960<=e&&e<=8967||8972<=e&&e<=8991||8996<=e&&e<=9e3||9003===e||9085<=e&&e<=9114||9150<=e&&e<=9165||9167===e||9169<=e&&e<=9179||9186<=e&&e<=9215)||9216<=e&&e<=9279&&9251!==e||9280<=e&&e<=9311||9312<=e&&e<=9471||9632<=e&&e<=9727||9728<=e&&e<=9983&&!(9754<=e&&e<=9759)||11008<=e&&e<=11263&&(11026<=e&&e<=11055||11088<=e&&e<=11097||11192<=e&&e<=11243)||Li(e)||zi(e)||57344<=e&&e<=63743||$i(e)||Xi(e)||Ji(e)||8734===e||8756===e||8757===e||9984<=e&&e<=10087||10102<=e&&e<=10131||65532===e||65533===e))}function ro(e){return 1424<=e&&e<=2303||qi(e)||Yi(e)}function no(e,t){return!(!t&&ro(e)||2304<=e&&e<=3583||3840<=e&&e<=4255||6016<=e&&e<=6143)}const io="deferred",oo="loading",ao="loaded";let so=null,lo="unavailable",uo=null;function co(e){e&&"string"==typeof e&&-1<e.indexOf("NetworkError")&&(lo="error"),so&&so(e)}function ho(){mo.fire(new yt("pluginStateChange",{pluginStatus:lo,pluginURL:uo}))}function fo(){return lo}function po(){if(lo!==io||!uo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");lo=oo,ho(),uo&&ze({url:uo},e=>{e?co(e):(lo=ao,ho())})}const mo=new _t,go={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>lo===ao||null!=go.applyArabicShaping,isLoading:()=>lo===oo,setState(e){lo=e.pluginStatus,uo=e.pluginURL},isParsed:()=>null!=go.applyArabicShaping&&null!=go.processBidirectionalText&&null!=go.processStyledBidirectionalText,getPluginURL:()=>uo};class C{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.transition=t.transition,this.pitch=t.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){var t=go.isLoaded();for(const r of e)if(!no(r.charCodeAt(0),t))return!1;return!0}}class yo{constructor(e,t){this.property=e,this.value=t,this.expression=function(t,r){if(wn(t))return new Rn(t,r);if(Ln(t)){var e=On(t,r);if("error"===e.result)throw new Error(e.value.map(e=>e.key+": "+e.message).join(", "));return e.value}{let e=t;return"string"==typeof t&&"color"===r.type&&(e=y.parse(t)),{kind:"constant",evaluate:()=>e}}}(void 0===t?e.specification.default:t,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)}}class vo{constructor(e){this.property=e,this.value=new yo(e,void 0)}transitioned(e,t){return new xo(this.property,this.value,t,_({},e.transition,this.transition),e.now)}untransitioned(){return new xo(this.property,this.value,null,{},0)}}class _o{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return he(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new vo(this._values[e].property)),this._values[e].value=new yo(this._values[e].property,null===t?void 0:he(t))}getTransition(e){return he(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new vo(this._values[e].property)),this._values[e].transition=he(t)||void 0}serialize(){var e={};for(const r of Object.keys(this._values)){var t=this.getValue(r),t=(void 0!==t&&(e[r]=t),this.getTransition(r));void 0!==t&&(e[r+"-transition"]=t)}return e}transitioned(e,t){var r=new bo(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].transitioned(e,t._values[n]);return r}untransitioned(){var e=new bo(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class xo{constructor(e,t,r,n,i){var o=n.delay||0,a=n.duration||0;i=i||0,this.property=e,this.value=t,this.begin=i+o,this.end=this.begin+a,e.specification.transition&&(n.delay||n.duration)&&(this.prior=r)}possiblyEvaluate(e,t,r){var n=e.now||0,i=this.value.possiblyEvaluate(e,t,r),o=this.prior;return o?n>this.end||this.value.isDataDriven()?(this.prior=null,i):n<this.begin?o.possiblyEvaluate(e,t,r):(n=(n-this.begin)/(this.end-this.begin),this.property.interpolate(o.possiblyEvaluate(e,t,r),i,q(n))):i}}class bo{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,r){var n=new To(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].possiblyEvaluate(e,t,r);return n}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class wo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return he(this._values[e].value)}setValue(e,t){this._values[e]=new yo(this._values[e].property,null===t?void 0:he(t))}serialize(){var e={};for(const r of Object.keys(this._values)){var t=this.getValue(r);void 0!==t&&(e[r]=t)}return e}possiblyEvaluate(e,t,r){var n=new To(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].possiblyEvaluate(e,t,r);return n}}class Eo{constructor(e,t,r){this.property=e,this.value=t,this.parameters=r}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,r,n){return this.property.evaluate(this.value,this.parameters,e,t,r,n)}}class To{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class t{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,r){var n=Lr[this.specification.type];return n?n(e,t,r):e}}class r{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,r,n){return new Eo(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},r,n)}:e.expression,t)}interpolate(e,t,r){var n;return"constant"!==e.value.kind||"constant"!==t.value.kind?e:void 0===e.value.value||void 0===t.value.value?new Eo(this,{kind:"constant",value:void 0},e.parameters):(n=Lr[this.specification.type])?new Eo(this,{kind:"constant",value:n(e.value.value,t.value.value,r)},e.parameters):e}evaluate(e,t,r,n,i,o){return"constant"===e.kind?e.value:e.evaluate(t,r,n,i,o)}}class So{constructor(e){this.specification=e}possiblyEvaluate(e,t,r,n){return!!e.expression.evaluate(t,null,{},r,n)}interpolate(){return!1}}class Mo{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];var t=new C(0,{});for(const i in e){var r=e[i],n=(r.specification.overridable&&this.overridableProperties.push(i),this.defaultPropertyValues[i]=new yo(r,void 0)),r=this.defaultTransitionablePropertyValues[i]=new vo(r);this.defaultTransitioningPropertyValues[i]=r.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=n.possiblyEvaluate(t)}}}function ko(e,t){return 256*(e=S(Math.floor(e),0,255))+S(Math.floor(t),0,255)}e(r,"DataDrivenProperty"),e(t,"DataConstantProperty"),e(So,"ColorRampProperty");const Co={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ao{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class n{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){e>this.capacity&&(this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement),e=this.uint8,this._refreshViews(),e&&this.uint8.set(e))}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function i(e,i=1){let o=0,a=0;return{members:e.map(e=>{var t=Co[e.type].BYTES_PER_ELEMENT,r=o=Io(o,Math.max(i,t)),n=e.components||1;return a=Math.max(a,t),o+=t*n,{name:e.name,type:e.type,components:n,offset:r}}),size:Io(o,Math.max(a,i)),alignment:i}}function Io(e,t){return Math.ceil(e/t)*t}class Lo extends n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){var r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){var n=2*e;return this.int16[0+n]=t,this.int16[1+n]=r,e}}Lo.prototype.bytesPerElement=4,e(Lo,"StructArrayLayout2i4");class Po extends n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r){var n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){var i=3*e;return this.int16[0+i]=t,this.int16[1+i]=r,this.int16[2+i]=n,e}}Po.prototype.bytesPerElement=6,e(Po,"StructArrayLayout3i6");class zo extends n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){var o=4*e;return this.int16[0+o]=t,this.int16[1+o]=r,this.int16[2+o]=n,this.int16[3+o]=i,e}}zo.prototype.bytesPerElement=8,e(zo,"StructArrayLayout4i8");class Do extends n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,a){var s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,n,i,o,a)}emplace(e,t,r,n,i,o,a,s){var l=6*e,u=12*e,c=3*e;return this.int16[0+l]=t,this.int16[1+l]=r,this.uint8[4+u]=n,this.uint8[5+u]=i,this.uint8[6+u]=o,this.uint8[7+u]=a,this.float32[2+c]=s,e}}Do.prototype.bytesPerElement=12,e(Do,"StructArrayLayout2i4ub1f12");class Oo extends n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){var o=4*e;return this.float32[0+o]=t,this.float32[1+o]=r,this.float32[2+o]=n,this.float32[3+o]=i,e}}Oo.prototype.bytesPerElement=16,e(Oo,"StructArrayLayout4f16");class Ro extends n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i){var o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,n,i)}emplace(e,t,r,n,i,o){var a=6*e,s=3*e;return this.uint16[0+a]=t,this.uint16[1+a]=r,this.uint16[2+a]=n,this.uint16[3+a]=i,this.float32[2+s]=o,e}}Ro.prototype.bytesPerElement=12,e(Ro,"StructArrayLayout4ui1f12");class Fo extends n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){var o=4*e;return this.uint16[0+o]=t,this.uint16[1+o]=r,this.uint16[2+o]=n,this.uint16[3+o]=i,e}}Fo.prototype.bytesPerElement=8,e(Fo,"StructArrayLayout4ui8");class Bo extends n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i,o)}emplace(e,t,r,n,i,o,a){var s=6*e;return this.int16[0+s]=t,this.int16[1+s]=r,this.int16[2+s]=n,this.int16[3+s]=i,this.int16[4+s]=o,this.int16[5+s]=a,e}}Bo.prototype.bytesPerElement=12,e(Bo,"StructArrayLayout6i12");class No extends n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,a,s,l,u,c,h){var f=this.length;return this.resize(f+1),this.emplace(f,e,t,r,n,i,o,a,s,l,u,c,h)}emplace(e,t,r,n,i,o,a,s,l,u,c,h,f){var d=12*e;return this.int16[0+d]=t,this.int16[1+d]=r,this.int16[2+d]=n,this.int16[3+d]=i,this.uint16[4+d]=o,this.uint16[5+d]=a,this.uint16[6+d]=s,this.uint16[7+d]=l,this.int16[8+d]=u,this.int16[9+d]=c,this.int16[10+d]=h,this.int16[11+d]=f,e}}No.prototype.bytesPerElement=24,e(No,"StructArrayLayout4i4ui4i24");class jo extends n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i,o)}emplace(e,t,r,n,i,o,a){var s=10*e,l=5*e;return this.int16[0+s]=t,this.int16[1+s]=r,this.int16[2+s]=n,this.float32[2+l]=i,this.float32[3+l]=o,this.float32[4+l]=a,e}}jo.prototype.bytesPerElement=20,e(jo,"StructArrayLayout3i3f20");class Uo extends n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[+e+0]=t,e}}Uo.prototype.bytesPerElement=4,e(Uo,"StructArrayLayout1ul4");class Vo extends n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,a,s,l,u,c,h,f){var d=this.length;return this.resize(d+1),this.emplace(d,e,t,r,n,i,o,a,s,l,u,c,h,f)}emplace(e,t,r,n,i,o,a,s,l,u,c,h,f,d){var p=20*e,m=10*e;return this.int16[0+p]=t,this.int16[1+p]=r,this.int16[2+p]=n,this.int16[3+p]=i,this.int16[4+p]=o,this.float32[3+m]=a,this.float32[4+m]=s,this.float32[5+m]=l,this.float32[6+m]=u,this.int16[14+p]=c,this.uint32[8+m]=h,this.uint16[18+p]=f,this.uint16[19+p]=d,e}}Vo.prototype.bytesPerElement=40,e(Vo,"StructArrayLayout5i4f1i1ul2ui40");class Go extends n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,a){var s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,n,i,o,a)}emplace(e,t,r,n,i,o,a,s){var l=8*e;return this.int16[0+l]=t,this.int16[1+l]=r,this.int16[2+l]=n,this.int16[4+l]=i,this.int16[5+l]=o,this.int16[6+l]=a,this.int16[7+l]=s,e}}Go.prototype.bytesPerElement=16,e(Go,"StructArrayLayout3i2i2i16");class Wo extends n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i){var o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,n,i)}emplace(e,t,r,n,i,o){var a=4*e,s=8*e;return this.float32[0+a]=t,this.float32[1+a]=r,this.float32[2+a]=n,this.int16[6+s]=i,this.int16[7+s]=o,e}}Wo.prototype.bytesPerElement=16,e(Wo,"StructArrayLayout2f1f2i16");class Zo extends n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){var o=12*e,a=3*e;return this.uint8[0+o]=t,this.uint8[1+o]=r,this.float32[1+a]=n,this.float32[2+a]=i,e}}Zo.prototype.bytesPerElement=12,e(Zo,"StructArrayLayout2ub2f12");class qo extends n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r){var n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){var i=3*e;return this.float32[0+i]=t,this.float32[1+i]=r,this.float32[2+i]=n,e}}qo.prototype.bytesPerElement=12,e(qo,"StructArrayLayout3f12");class Ho extends n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r){var n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){var i=3*e;return this.uint16[0+i]=t,this.uint16[1+i]=r,this.uint16[2+i]=n,e}}Ho.prototype.bytesPerElement=6,e(Ho,"StructArrayLayout3ui6");class $o extends n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,a,s,l,u,c,h,f,d,p,m,g,y,v,_,x){var b=this.length;return this.resize(b+1),this.emplace(b,e,t,r,n,i,o,a,s,l,u,c,h,f,d,p,m,g,y,v,_,x)}emplace(e,t,r,n,i,o,a,s,l,u,c,h,f,d,p,m,g,y,v,_,x,b){var w=30*e,E=15*e,T=60*e;return this.int16[0+w]=t,this.int16[1+w]=r,this.int16[2+w]=n,this.float32[2+E]=i,this.float32[3+E]=o,this.uint16[8+w]=a,this.uint16[9+w]=s,this.uint32[5+E]=l,this.uint32[6+E]=u,this.uint32[7+E]=c,this.uint16[16+w]=h,this.uint16[17+w]=f,this.uint16[18+w]=d,this.float32[10+E]=p,this.float32[11+E]=m,this.uint8[48+T]=g,this.uint8[49+T]=y,this.uint8[50+T]=v,this.uint32[13+E]=_,this.int16[28+w]=x,this.uint8[58+T]=b,e}}$o.prototype.bytesPerElement=60,e($o,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Xo extends n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,a,s,l,u,c,h,f,d,p,m,g,y,v,_,x,b,w,E,T,S,M,k,C,A){var I=this.length;return this.resize(I+1),this.emplace(I,e,t,r,n,i,o,a,s,l,u,c,h,f,d,p,m,g,y,v,_,x,b,w,E,T,S,M,k,C,A)}emplace(e,t,r,n,i,o,a,s,l,u,c,h,f,d,p,m,g,y,v,_,x,b,w,E,T,S,M,k,C,A,I){var L=38*e,P=19*e;return this.int16[0+L]=t,this.int16[1+L]=r,this.int16[2+L]=n,this.float32[2+P]=i,this.float32[3+P]=o,this.int16[8+L]=a,this.int16[9+L]=s,this.int16[10+L]=l,this.int16[11+L]=u,this.int16[12+L]=c,this.int16[13+L]=h,this.uint16[14+L]=f,this.uint16[15+L]=d,this.uint16[16+L]=p,this.uint16[17+L]=m,this.uint16[18+L]=g,this.uint16[19+L]=y,this.uint16[20+L]=v,this.uint16[21+L]=_,this.uint16[22+L]=x,this.uint16[23+L]=b,this.uint16[24+L]=w,this.uint16[25+L]=E,this.uint16[26+L]=T,this.uint16[27+L]=S,this.uint16[28+L]=M,this.uint32[15+P]=k,this.float32[16+P]=C,this.float32[17+P]=A,this.float32[18+P]=I,e}}Xo.prototype.bytesPerElement=76,e(Xo,"StructArrayLayout3i2f6i15ui1ul3f76");class Yo extends n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[+e+0]=t,e}}Yo.prototype.bytesPerElement=4,e(Yo,"StructArrayLayout1f4");class Jo extends n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i){var o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,n,i)}emplace(e,t,r,n,i,o){var a=5*e;return this.float32[0+a]=t,this.float32[1+a]=r,this.float32[2+a]=n,this.float32[3+a]=i,this.float32[4+a]=o,e}}Jo.prototype.bytesPerElement=20,e(Jo,"StructArrayLayout5f20");class Ko extends n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){var o=6*e;return this.uint32[3*e+0]=t,this.uint16[2+o]=r,this.uint16[3+o]=n,this.uint16[4+o]=i,e}}Ko.prototype.bytesPerElement=12,e(Ko,"StructArrayLayout1ul3ui12");class Qo extends n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){var r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){var n=2*e;return this.uint16[0+n]=t,this.uint16[1+n]=r,e}}Qo.prototype.bytesPerElement=4,e(Qo,"StructArrayLayout2ui4");class ea extends n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[+e+0]=t,e}}ea.prototype.bytesPerElement=2,e(ea,"StructArrayLayout1ui2");class ta extends n{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){var r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){var n=2*e;return this.float32[0+n]=t,this.float32[1+n]=r,e}}ta.prototype.bytesPerElement=8,e(ta,"StructArrayLayout2f8");class ra extends Ao{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ra.prototype.size=40;class na extends Vo{get(e){return new ra(this,e)}}e(na,"CollisionBoxArray");class ia extends Ao{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}ia.prototype.size=60;class oa extends $o{get(e){return new ia(this,e)}}e(oa,"PlacedSymbolArray");class aa extends Ao{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}aa.prototype.size=76;class sa extends Xo{get(e){return new aa(this,e)}}e(sa,"SymbolInstanceArray");class la extends Yo{getoffsetX(e){return this.float32[+e+0]}}e(la,"GlyphOffsetArray");class ua extends Lo{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}e(ua,"SymbolLineVertexArray");class ca extends Ao{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ca.prototype.size=12;class ha extends Ko{get(e){return new ca(this,e)}}e(ha,"FeatureIndexArray");class fa extends Qo{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}e(fa,"FillExtrusionCentroidArray");const da=i([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),pa=i([{name:"a_dash",components:4,type:"Uint16"}]);var ma={},ln={get exports(){return ma},set exports(e){ma=e}},ga={},ya=({get exports(){return ga},set exports(e){ga=e}}.exports=function(e,t){for(var r,n,i,o=e.length-(r=3&e.length),a=t,s=3432918353,l=461845907,u=0;u<o;)i=255&e.charCodeAt(u)|(255&e.charCodeAt(++u))<<8|(255&e.charCodeAt(++u))<<16|(255&e.charCodeAt(++u))<<24,++u,a=27492+(65535&(n=5*(65535&(a=(a^=i=(65535&(i=(i=(65535&i)*s+(((i>>>16)*s&65535)<<16)&4294967295)<<15|i>>>17))*l+(((i>>>16)*l&65535)<<16)&4294967295)<<13|a>>>19))+((5*(a>>>16)&65535)<<16)&4294967295))+((58964+(n>>>16)&65535)<<16);switch(i=0,r){case 3:i^=(255&e.charCodeAt(u+2))<<16;case 2:i^=(255&e.charCodeAt(u+1))<<8;case 1:a^=i=(65535&(i=(i=(65535&(i^=255&e.charCodeAt(u)))*s+(((i>>>16)*s&65535)<<16)&4294967295)<<15|i>>>17))*l+(((i>>>16)*l&65535)<<16)&4294967295}return a=2246822507*(65535&(a=(a^=e.length)^a>>>16))+((2246822507*(a>>>16)&65535)<<16)&4294967295,((a=3266489909*(65535&(a^=a>>>13))+((3266489909*(a>>>16)&65535)<<16)&4294967295)^a>>>16)>>>0},{}),cn=({get exports(){return ya},set exports(e){ya=e}}.exports=function(e,t){for(var r,n=e.length,i=t^n,o=0;4<=n;)r=1540483477*(65535&(r=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(r>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16),n-=4,++o;switch(n){case 3:i^=(255&e.charCodeAt(o+2))<<16;case 2:i^=(255&e.charCodeAt(o+1))<<8;case 1:i=1540483477*(65535&(i^=255&e.charCodeAt(o)))+((1540483477*(i>>>16)&65535)<<16)}return((i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16))^i>>>15)>>>0},ga),un=ya;ln.exports=cn,ma.murmur3=cn,ma.murmur2=un;class va{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,r,n){this.ids.push(_a(e)),this.positions.push(t,r,n)}getPositions(e){var t=_a(e);let r=0,n=this.ids.length-1;for(;r<n;){const e=r+n>>1;this.ids[e]>=t?n=e:r=1+e}for(var i=[];this.ids[r]===t;)i.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return i}static serialize(e,t){var r=new Float64Array(e.ids),e=new Uint32Array(e.positions);return xa(r,e,0,r.length-1),t&&t.push(r.buffer,e.buffer),{ids:r,positions:e}}static deserialize(e){var t=new va;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function _a(e){var t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:ma(String(e))}function xa(r,n,i,o){for(;i<o;){var a=r[i+o>>1];let e=i-1,t=o+1;for(;;){for(;r[++e]<a;);for(;r[--t]>a;);if(e>=t)break;ba(r,e,t),ba(n,3*e,3*t),ba(n,3*e+1,3*t+1),ba(n,3*e+2,3*t+2)}t-i<o-t?(xa(r,n,i,t),i=t+1):(xa(r,n,t+1,o),o=t)}}function ba(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}e(va,"FeaturePositionMap");class wa{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}}class Ea extends wa{constructor(e){super(e),this.current=0}set(e,t,r){this.fetchUniformLocation(e,t)&&this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class Ta extends wa{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,r){!this.fetchUniformLocation(e,t)||r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class Sa extends wa{constructor(e){super(e),this.current=y.transparent}set(e,t,r){!this.fetchUniformLocation(e,t)||r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const Ma=new Float32Array(16),ka=new Float32Array(9),Ca=new Float32Array(4);function Aa(e){return[ko(255*e.r,255*e.g),ko(255*e.b,255*e.a)]}class Ia{constructor(e,t,r){this.value=e,this.uniformNames=t.map(e=>"u_"+e),this.type=r}setUniform(e,t,r,n,i){t.set(e,i,n.constantOr(this.value))}getBinding(e,t){return new("color"===this.type?Sa:Ea)(e)}}class La{constructor(e,t){this.uniformNames=t.map(e=>"u_"+e),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,t,r,n,i){var o="u_pattern"===i||"u_dash"===i?this.pattern:"u_pixel_ratio"===i?this.pixelRatio:null;o&&t.set(e,i,o)}getBinding(e,t){return new("u_pattern"===t||"u_dash"===t?Ta:Ea)(e)}}class Pa{constructor(e,t,r,n){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:"a_"+e,type:"Float32",components:"color"===r?2:1,offset:0})),this.paintVertexArray=new n}populatePaintArray(e,t,r,n,i,o){var a=this.paintVertexArray.length,t=this.expression.evaluate(new C(0),t,{},i,n,o);this.paintVertexArray.resize(e),this._setPaintValue(a,e,t)}updatePaintArray(e,t,r,n,i){r=this.expression.evaluate({zoom:0},r,n,void 0,i);this._setPaintValue(e,t,r)}_setPaintValue(t,r,n){if("color"===this.type){var i=Aa(n);for(let e=t;e<r;e++)this.paintVertexArray.emplace(e,i[0],i[1])}else{for(let e=t;e<r;e++)this.paintVertexArray.emplace(e,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class za{constructor(e,t,r,n,i,o){this.expression=e,this.uniformNames=t.map(e=>`u_${e}_t`),this.type=r,this.useIntegerZoom=n,this.zoom=i,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:"a_"+e,type:"Float32",components:"color"===r?4:2,offset:0})),this.paintVertexArray=new o}populatePaintArray(e,t,r,n,i,o){var a=this.expression.evaluate(new C(this.zoom),t,{},i,n,o),t=this.expression.evaluate(new C(this.zoom+1),t,{},i,n,o),i=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(i,e,a,t)}updatePaintArray(e,t,r,n,i){var o=this.expression.evaluate({zoom:this.zoom},r,n,void 0,i),r=this.expression.evaluate({zoom:this.zoom+1},r,n,void 0,i);this._setPaintValue(e,t,o,r)}_setPaintValue(t,r,n,i){if("color"===this.type){var o=Aa(n),a=Aa(i);for(let e=t;e<r;e++)this.paintVertexArray.emplace(e,o[0],o[1],a[0],a[1])}else{for(let e=t;e<r;e++)this.paintVertexArray.emplace(e,n,i);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,r,n,i){r=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,r=S(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);t.set(e,i,r)}getBinding(e,t){return new Ea(e)}}class Da{constructor(e,t,r,n,i){this.expression=e,this.layerId=i,this.paintVertexAttributes=("array"===r?pa:da).members;for(let e=0;e<t.length;++e);this.paintVertexArray=new n}populatePaintArray(e,t,r){var n=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(n,e,t.patterns&&t.patterns[this.layerId],r)}updatePaintArray(e,t,r,n,i,o){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],o)}_setPaintValues(t,r,e,n){if(n&&e){n=n[e];if(n){var{tl:i,br:o,pixelRatio:a}=n;for(let e=t;e<r;e++)this.paintVertexArray.emplace(e,i[0],i[1],o[0],o[1],a)}}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Oa{constructor(e,t,r=()=>!0){this.binders={},this._buffers=[];var n=[];for(const c in e.paint._values)if(r(c)){var i=e.paint.get(c);if(i instanceof Eo&&_n(i.property.specification)){var o=Ba(c,e.type),a=i.value,s=i.property.specification.type,i=i.property.useIntegerZoom,l="line-dasharray"===c||c.endsWith("pattern"),u="line-dasharray"===c&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==a.kind||u)if("source"===a.kind||u||l){const t=Ua(c,s,"source");this.binders[c]=l?new Da(a,o,s,t,e.id):new Pa(a,o,s,t),n.push("/a_"+c)}else{const e=Ua(c,s,"composite");this.binders[c]=new za(a,o,s,i,t,e),n.push("/z_"+c)}else this.binders[c]=l?new La(a.value,o):new Ia(a.value,o,s),n.push("/u_"+c)}}this.cacheKey=n.sort().join("")}getMaxValue(e){e=this.binders[e];return e instanceof Pa||e instanceof za?e.maxValue:0}populatePaintArrays(e,t,r,n,i,o){for(const s in this.binders){var a=this.binders[s];(a instanceof Pa||a instanceof za||a instanceof Da)&&a.populatePaintArray(e,t,r,n,i,o)}}setConstantPatternPositions(e){for(const r in this.binders){var t=this.binders[r];t instanceof La&&t.setConstantPatternPositions(e)}}updatePaintArrays(e,t,r,n,i,o){let a=!1;for(const h in e){var s=t.getPositions(h);for(const t of s){var l=r.feature(t.index);for(const r in this.binders){var u,c=this.binders[r];(c instanceof Pa||c instanceof za||c instanceof Da)&&!0===c.expression.isStateDependent&&(u=n.paint.get(r),c.expression=u.value,c.updatePaintArray(t.start,t.end,l,e[h],i,o),a=!0)}}}return a}defines(){var e=[];for(const r in this.binders){var t=this.binders[r];(t instanceof Ia||t instanceof La)&&e.push(...t.uniformNames.map(e=>"#define HAS_UNIFORM_"+e))}return e}getBinderAttributes(){var t=[];for(const e in this.binders){var r=this.binders[e];if(r instanceof Pa||r instanceof za||r instanceof Da)for(let e=0;e<r.paintVertexAttributes.length;e++)t.push(r.paintVertexAttributes[e].name)}return t}getBinderUniforms(){var e=[];for(const r in this.binders){var t=this.binders[r];if(t instanceof Ia||t instanceof La||t instanceof za)for(const n of t.uniformNames)e.push(n)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){var t=[];for(const n in this.binders){var r=this.binders[n];if(r instanceof Ia||r instanceof La||r instanceof za)for(const i of r.uniformNames)t.push({name:i,property:n,binding:r.getBinding(e,i)})}return t}setUniforms(e,t,r,n,i){for(const{name:t,property:o,binding:a}of r)this.binders[o].setUniform(e,a,i,n.get(o),t)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){var e=this.binders[t];(e instanceof Pa||e instanceof za||e instanceof Da)&&e.paintVertexBuffer&&this._buffers.push(e.paintVertexBuffer)}}upload(e){for(const r in this.binders){var t=this.binders[r];(t instanceof Pa||t instanceof za||t instanceof Da)&&t.upload(e)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){var e=this.binders[t];(e instanceof Pa||e instanceof za||e instanceof Da)&&e.destroy()}}}class Ra{constructor(e,t,r=()=>!0){this.programConfigurations={};for(const n of e)this.programConfigurations[n.id]=new Oa(n,t,r);this.needsUpload=!1,this._featureMap=new va,this._bufferOffset=0}populatePaintArrays(e,t,r,n,i,o,a){for(const r in this.programConfigurations)this.programConfigurations[r].populatePaintArrays(e,t,n,i,o,a);void 0!==t.id&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,r,n,i){for(const o of r)this.needsUpload=this.programConfigurations[o.id].updatePaintArrays(e,this._featureMap,t,o,n,i)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Fa={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Ba(e,t){return Fa[e]||[e.replace(t+"-","").replace(/-/g,"_")]}const Na={"line-pattern":{source:Ro,composite:Ro},"fill-pattern":{source:Ro,composite:Ro},"fill-extrusion-pattern":{source:Ro,composite:Ro},"line-dasharray":{source:Fo,composite:Fo}},ja={color:{source:ta,composite:Oo},number:{source:Yo,composite:ta}};function Ua(e,t,r){e=Na[e];return e&&e[r]||ja[t][r]}e(Ia,"ConstantBinder"),e(La,"PatternConstantBinder"),e(Pa,"SourceExpressionBinder"),e(Da,"PatternCompositeBinder"),e(za,"CompositeExpressionBinder"),e(Oa,"ProgramConfiguration",{omit:["_buffers"]}),e(Ra,"ProgramConfigurationSet");const Va="-transition";class Ga extends _t{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new wo(t.layout)),t.paint)){this._transitionablePaint=new _o(t.paint);for(const t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(const t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new To(t.paint)}}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,r={}){null!=t&&this._validate(mi,`layers.${this.id}.layout.`+e,e,t,r)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return oe(e,Va)?this._transitionablePaint.getTransition(e.slice(0,-Va.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,r={}){if(null!=t&&this._validate(pi,`layers.${this.id}.paint.`+e,e,t,r))return!1;if(oe(e,Va))return this._transitionablePaint.setTransition(e.slice(0,-Va.length),t||void 0),!1;{const r=this._transitionablePaint._values[e],o=r.value.isDataDriven(),a=r.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);var t=this._transitionablePaint._values[e].value,n=t.isDataDriven(),i=oe(e,"pattern")||"line-dasharray"===e;return n||o||i||this._handleOverridablePaintPropertyUpdate(e,a,t)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,t,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){var e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ce(e,(e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length))}_validate(e,t,r,n,i={}){return(!i||!1!==i.validate)&&yi(this,e.call(di,{key:t,layerType:this.type,objectKey:r,value:n,styleSpec:c,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){var e=this.paint.get(t);if(e instanceof Eo&&_n(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Wn(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Wa=i([{name:"a_pos",components:2,type:"Int16"}],4),Za=i([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class w{constructor(e=[]){this.segments=e}prepareSegment(e,t,r,n){let i=this.segments[this.segments.length-1];return e>w.MAX_VERTEX_ARRAY_LENGTH&&ae(`Max vertices per segment is ${w.MAX_VERTEX_ARRAY_LENGTH}: bucket requested `+e),(!i||i.vertexLength+e>w.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==n)&&(i={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},void 0!==n&&(i.sortKey=n),this.segments.push(i)),i}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,r,n){return new w([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:n,vaos:{},sortKey:0}])}}w.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,e(w,"SegmentVector");var se=8192;class qa{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof A?new A(e.lng,e.lat):A.convert(e),this}setSouthWest(e){return this._sw=e instanceof A?new A(e.lng,e.lat):A.convert(e),this}extend(e){var t=this._sw,r=this._ne;let n,i;if(e instanceof A)n=e,i=e;else{if(!(e instanceof qa))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(qa.convert(e)):this.extend(A.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&e.hasOwnProperty("lon")?this.extend(A.convert(e)):this;if(n=e._sw,i=e._ne,!n||!i)return this}return t||r?(t.lng=Math.min(n.lng,t.lng),t.lat=Math.min(n.lat,t.lat),r.lng=Math.max(i.lng,r.lng),r.lat=Math.max(i.lat,r.lat)):(this._sw=new A(n.lng,n.lat),this._ne=new A(i.lng,i.lat)),this}getCenter(){return new A((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new A(this.getWest(),this.getNorth())}getSouthEast(){return new A(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){var{lng:e,lat:t}=A.convert(e);let r=this._sw.lng<=e&&e<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=e&&e>=this._ne.lng),this._sw.lat<=t&&t<=this._ne.lat&&r}static convert(e){return!e||e instanceof qa?e:new qa(e)}}var Ha=1e-6,$a="undefined"!=typeof Float32Array?Float32Array:Array;function Xa(){var e=new $a(9);return $a!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function Ya(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],u=t[6],c=t[7],t=t[8],h=r[0],f=r[1],d=r[2],p=r[3],m=r[4],g=r[5],y=r[6],v=r[7],r=r[8];return e[0]=h*n+f*a+d*u,e[1]=h*i+f*s+d*c,e[2]=h*o+f*l+d*t,e[3]=p*n+m*a+g*u,e[4]=p*i+m*s+g*c,e[5]=p*o+m*l+g*t,e[6]=y*n+v*a+r*u,e[7]=y*i+v*s+r*c,e[8]=y*o+v*l+r*t,e}function Ja(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ka(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],u=t[7],c=t[8],h=t[9],f=t[10],d=t[11],p=t[12],m=t[13],g=t[14],t=t[15],y=r*s-n*a,v=r*l-i*a,_=r*u-o*a,x=n*l-i*s,b=n*u-o*s,w=i*u-o*l,E=c*m-h*p,T=c*g-f*p,S=c*t-d*p,M=h*g-f*m,k=h*t-d*m,C=f*t-d*g,A=y*C-v*k+_*M+x*S-b*T+w*E;return A?(e[0]=(s*C-l*k+u*M)*(A=1/A),e[1]=(i*k-n*C-o*M)*A,e[2]=(m*w-g*b+t*x)*A,e[3]=(f*b-h*w-d*x)*A,e[4]=(l*S-a*C-u*T)*A,e[5]=(r*C-i*S+o*T)*A,e[6]=(g*_-p*w-t*v)*A,e[7]=(c*w-f*_+d*v)*A,e[8]=(a*k-s*S+u*E)*A,e[9]=(n*S-r*k-o*E)*A,e[10]=(p*b-m*_+t*y)*A,e[11]=(h*_-c*b-d*y)*A,e[12]=(s*T-a*M-l*E)*A,e[13]=(r*M-n*T+i*E)*A,e[14]=(m*v-p*x-g*y)*A,e[15]=(c*x-h*v+f*y)*A,e):null}function Qa(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],f=t[9],d=t[10],p=t[11],m=t[12],g=t[13],y=t[14],t=t[15],v=r[0],_=r[1],x=r[2],b=r[3];return e[0]=v*n+_*s+x*h+b*m,e[1]=v*i+_*l+x*f+b*g,e[2]=v*o+_*u+x*d+b*y,e[3]=v*a+_*c+x*p+b*t,e[4]=(v=r[4])*n+(_=r[5])*s+(x=r[6])*h+(b=r[7])*m,e[5]=v*i+_*l+x*f+b*g,e[6]=v*o+_*u+x*d+b*y,e[7]=v*a+_*c+x*p+b*t,e[8]=(v=r[8])*n+(_=r[9])*s+(x=r[10])*h+(b=r[11])*m,e[9]=v*i+_*l+x*f+b*g,e[10]=v*o+_*u+x*d+b*y,e[11]=v*a+_*c+x*p+b*t,e[12]=(v=r[12])*n+(_=r[13])*s+(x=r[14])*h+(b=r[15])*m,e[13]=v*i+_*l+x*f+b*g,e[14]=v*o+_*u+x*d+b*y,e[15]=v*a+_*c+x*p+b*t,e}function es(e,t,r){var n,i,o,a,s,l,u,c,h,f,d,p,m=r[0],g=r[1],r=r[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*r+t[12],e[13]=t[1]*m+t[5]*g+t[9]*r+t[13],e[14]=t[2]*m+t[6]*g+t[10]*r+t[14],e[15]=t[3]*m+t[7]*g+t[11]*r+t[15]):(i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],f=t[9],d=t[10],p=t[11],e[0]=n=t[0],e[1]=i,e[2]=o,e[3]=a,e[4]=s,e[5]=l,e[6]=u,e[7]=c,e[8]=h,e[9]=f,e[10]=d,e[11]=p,e[12]=n*m+s*g+h*r+t[12],e[13]=i*m+l*g+f*r+t[13],e[14]=o*m+u*g+d*r+t[14],e[15]=a*m+c*g+p*r+t[15]),e}function ts(e,t,r){var n=r[0],i=r[1],r=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function rs(e,t,r){var n=Math.sin(r),r=Math.cos(r),i=t[4],o=t[5],a=t[6],s=t[7],l=t[8],u=t[9],c=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*r+l*n,e[5]=o*r+u*n,e[6]=a*r+c*n,e[7]=s*r+h*n,e[8]=l*r-i*n,e[9]=u*r-o*n,e[10]=c*r-a*n,e[11]=h*r-s*n,e}function ns(e,t,r){var n=Math.sin(r),r=Math.cos(r),i=t[0],o=t[1],a=t[2],s=t[3],l=t[8],u=t[9],c=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*r-l*n,e[1]=o*r-u*n,e[2]=a*r-c*n,e[3]=s*r-h*n,e[8]=i*n+l*r,e[9]=o*n+u*r,e[10]=a*n+c*r,e[11]=s*n+h*r,e}function is(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function os(e,t,r){var n,i=r[0],o=r[1],r=r[2],a=Math.hypot(i,o,r);return a<Ha?null:(i*=a=1/a,o*=a,r*=a,a=Math.sin(t),t=Math.cos(t),e[0]=i*i*(n=1-t)+t,e[1]=o*i*n+r*a,e[2]=r*i*n-o*a,e[3]=0,e[4]=i*o*n-r*a,e[5]=o*o*n+t,e[6]=r*o*n+i*a,e[7]=0,e[8]=i*r*n+o*a,e[9]=o*r*n-i*a,e[10]=r*r*n+t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});fn=Qa;function as(){var e=new $a(3);return $a!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function ss(e){var t=new $a(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ls(e){return Math.hypot(e[0],e[1],e[2])}function us(e,t,r){var n=new $a(3);return n[0]=e,n[1]=t,n[2]=r,n}function cs(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function hs(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function fs(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function ds(e,t,r){e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2])}function ps(e,t,r){e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2])}function ms(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function gs(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}function ys(e,t){var r=t[0],n=t[1],i=t[2],r=r*r+n*n+i*i;return 0<r&&(r=1/Math.sqrt(r)),e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function vs(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function _s(e,t,r){var n=t[0],i=t[1],t=t[2],o=r[0],a=r[1],r=r[2];return e[0]=i*r-t*a,e[1]=t*o-n*r,e[2]=n*a-i*o,e}function Ee(e,t,r){var n=t[0],i=t[1],t=t[2],o=r[3]*n+r[7]*i+r[11]*t+r[15];return e[0]=(r[0]*n+r[4]*i+r[8]*t+r[12])/(o=o||1),e[1]=(r[1]*n+r[5]*i+r[9]*t+r[13])/o,e[2]=(r[2]*n+r[6]*i+r[10]*t+r[14])/o,e}function xs(e,t,r){var n=r[0],i=r[1],o=r[2],a=t[0],s=t[1],t=t[2],l=i*t-o*s,u=o*a-n*t,c=n*s-i*a,h=i*c-o*u,o=o*l-n*c,n=n*u-i*l,i=2*r[3];return u*=i,c*=i,o*=2,n*=2,e[0]=a+(l*=i)+(h*=2),e[1]=s+u+o,e[2]=t+c+n,e}var bs=hs,hn=fs,Jr=ls;function ws(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function Es(e,t){var r=t[0],n=t[1],i=t[2],t=t[3],o=r*r+n*n+i*i+t*t;return 0<o&&(o=1/Math.sqrt(o)),e[0]=r*o,e[1]=n*o,e[2]=i*o,e[3]=t*o,e}function Ts(e,t,r){var n=t[0],i=t[1],o=t[2],t=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*t,e[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*t,e[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*t,e[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*t,e}function Ss(){var e=new $a(4);$a!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1}function Ms(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function ks(e,t,r){r*=.5;var n=t[0],i=t[1],o=t[2],t=t[3],a=Math.sin(r),r=Math.cos(r);return e[0]=n*r+t*a,e[1]=i*r+o*a,e[2]=o*r-i*a,e[3]=t*r-n*a,e}function Cs(e,t,r){r*=.5;var n=t[0],i=t[1],o=t[2],t=t[3],a=Math.sin(r),r=Math.cos(r);return e[0]=n*r-o*a,e[1]=i*r+t*a,e[2]=o*r+n*a,e[3]=t*r-i*a,e}as(),tn=new $a(4),$a!=Float32Array&&(tn[0]=0,tn[1]=0,tn[2]=0,tn[3]=0);Kr=Es;as(),us(1,0,0),us(0,1,0),Ss(),Ss(),Xa();const As=i([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),Is=As["members"],Ls=i([{name:"a_pos_3",components:3,type:"Int16"}]);var Ps=i([{name:"a_pos",type:"Int16",components:2}]);class zs{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,r){var n=vs(t,this.dir);return!(Math.abs(n)<1e-6)&&(e=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/n,r[0]=this.pos[0]+this.dir[0]*e,r[1]=this.pos[1]+this.dir[1]*e,r[2]=this.pos[2]+this.dir[2]*e,!0)}closestPointOnSphere(e,t,r){if(n=this.pos,i=n[0],o=n[1],n=n[2],a=e[0],s=e[1],l=e[2],Math.abs(i-a)<=Ha*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(o-s)<=Ha*Math.max(1,Math.abs(o),Math.abs(s))&&Math.abs(n-l)<=Ha*Math.max(1,Math.abs(n),Math.abs(l))||0===t)return r[0]=r[1]=r[2]=0,!1;var n,i,o,a,s,l;const[u,c,h]=this.dir,f=this.pos[0]-e[0],d=this.pos[1]-e[1],p=this.pos[2]-e[2],m=u*u+c*c+h*h,g=2*(f*u+d*c+p*h),y=g*g-4*m*(f*f+d*d+p*p-t*t);if(y<0){const e=Math.max(-g/2,0),m=f+u*e,y=d+c*e,v=p+h*e,_=Math.hypot(m,y,v);return r[0]=m*t/_,r[1]=y*t/_,r[2]=v*t/_,!1}{const e=(-g-Math.sqrt(y))/(2*m);if(e<0){const e=Math.hypot(f,d,p);return r[0]=f*t/e,r[1]=d*t/e,r[2]=p*t/e,!1}return r[0]=f+u*e,r[1]=d+c*e,r[2]=p+h*e,!0}}}class Ds{static fromPoints(e){var t=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];for(const n of e)ds(t,t,n),ps(r,r,n);return new Ds(t,r)}static applyTransform(e,t){var r=e.getCorners();for(let e=0;e<r.length;++e)Ee(r[e],r[e],t);return Ds.fromPoints(r)}constructor(e,t){this.min=e,this.max=t,this.center=ms([],cs([],this.min,this.max),.5)}quadrant(e){var t=[e%2==0,e<2],r=ss(this.min),n=ss(this.max);for(let e=0;e<t.length;e++)r[e]=(t[e]?this.min:this.center)[e],n[e]=(t[e]?this.center:this.max)[e];return n[2]=this.max[2],new Ds(r,n)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){var e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(i){var r=this.getCorners();let n=!0;for(let e=0;e<i.planes.length;e++){var o=i.planes[e];let t=0;for(let e=0;e<r.length;e++)t+=0<=vs(o,r[e])+o[3];if(0===t)return 0;t!==r.length&&(n=!1)}if(n)return 2;for(let n=0;n<3;n++){let t=Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let e=0;e<i.points.length;e++){var a=i.points[e][n]-this.min[n];t=Math.min(t,a),r=Math.max(r,a)}if(r<0||t>this.max[n]-this.min[n])return 0}return 1}}const Os=se/Math.PI/2,Rs=[64,32,16],Fs=-Os,Bs=Os,Ns=[new Ds([Fs,Fs,Fs],[Bs,Bs,Bs]),new Ds([Fs,Fs,Fs],[0,0,Bs]),new Ds([0,Fs,Fs],[Bs,0,Bs]),new Ds([Fs,0,Fs],[0,Bs,Bs]),new Ds([0,0,Fs],[Bs,Bs,Bs])];function js(e){return e*Os/cl}function Us(e,t,r,n=!0){var i=ms([],e._camera.position,e.worldSize),t=[t,r,1,1],r=(Ts(t,t,e.pixelMatrixInverse),ws(t,t,1/t[3]),ys([],bs([],t,i))),t=e.globeMatrix,o=[t[12],t[13],t[14]],a=bs([],o,i),s=ls(a),l=ys([],a),u=e.worldSize/(2*Math.PI),l=vs(l,r),c=Math.asin(u/s);if(c<Math.acos(l)){if(!n)return null;const e=[],t=[];ms(e,r,s/l),ys(t,bs(t,e,a)),ys(r,cs(r,a,ms(r,t,Math.tan(c)*s)))}var n=[],l=(new zs(i,r).closestPointOnSphere(o,u,n),ys([],_e(t,0))),a=ys([],_e(t,1)),c=ys([],_e(t,2)),s=vs(l,n),i=vs(a,n),r=vs(c,n),o=T(Math.asin(-i/u)),h=T(Math.atan2(s,r)),t=dl(e.center.lng+function(e){e=(h-e+180)%360-180;return e<-180?360+e:e}(e.center.lng)),l=S(pl(o),0,1);return new _l(t,l)}class Vs{constructor(e,t,r){this.a=bs([],e,r),this.b=bs([],t,r),this.center=r;e=ys([],this.a),t=ys([],this.b);this.angle=Math.acos(vs(e,t))}}function Gs(e,t){var r,n,i,o,a;return 0===e.angle||(o=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)))<0||1<o?null:(r=e.a[t],n=e.b[t],i=e.angle,o=S(o,0,1),a=Math.sin(i),r*(Math.sin((1-o)*i)/a)+n*(Math.sin(o*i)/a)+e.center[t])}function Ws(e){return e.z<=1?Ns[e.z+2*e.y+e.x]:(e=Xs($s(e)),Ds.fromPoints(e))}function Zs(e,t,r){return ms(e,e,1-r),gs(e,e,t,r)}function qs(e,t){var r,n,i,o,a,s,l=il(t.zoom);return 0===l?Ws(e):(r=Xs(e=$s(e)),s=dl(e.getWest())*t.worldSize,i=[a=dl(e.getEast())*t.worldSize,n=pl(e.getNorth())*t.worldSize,0],o=[s,e=pl(e.getSouth())*t.worldSize,0],a=[a,e,0],Ee(e=[s,n,0],e,s=Ka([],t.globeMatrix)),Ee(i,i,s),Ee(o,o,s),Ee(a,a,s),r[0]=Zs(r[0],o,l),r[1]=Zs(r[1],a,l),r[2]=Zs(r[2],i,l),r[3]=Zs(r[3],e,l),Ds.fromPoints(r))}function Hs(e,t,r){for(const n of e)Ee(n,n,t),ms(n,n,r)}function $s({x:e,y:t,z:r}){var r=1/(1<<r),n=new A(gl(e*r),E((t+1)*r)),e=new A(gl((e+1)*r),E(t*r));return new qa(n,e)}function Xs(e){var t=M(e.getNorth()),r=M(e.getSouth()),n=Math.cos(t),i=Math.cos(r),t=Math.sin(t),r=Math.sin(r),o=e.getWest(),e=e.getEast();return[Ys(i,r,o),Ys(i,r,e),Ys(n,t,e),Ys(n,t,o)]}function Ys(e,t,r,n=Os){return r=M(r),[e*Math.sin(r)*n,-t*n,e*Math.cos(r)*n]}function Js(e,t,r){return Ys(Math.cos(M(e)),Math.sin(M(e)),t,r)}function Ks(e,t,r,n){var i=1<<r.z,e=(e/se+r.x)/i;return Js(E((t/se+r.y)/i),gl(e),n)}function Qs({min:e,max:t}){return 16383/Math.max(t[0]-e[0],t[1]-e[1],t[2]-e[2])}const el=new Float64Array(16);function tl(e){var t=Qs(e),t=is(el,[t,t,t]);return es(t,t,((t=[])[0]=-(e=e.min)[0],t[1]=-e[1],t[2]=-e[2],t))}function rl(e){t=e.min,(r=el)[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1;var t=r,r=1/Qs(e);return ts(t,t,[r,r,r])}function nl(e,t,r,n,i){o=se/(2*Math.PI);var o=r/(2*Math.PI)/o,e=[e,t,-r/(2*Math.PI)],t=Ja(new Float64Array(16));return es(t,t,e),ts(t,t,[o,o,o]),rs(t,t,M(-i)),ns(t,t,M(-n)),t}function il(e){return X(5,6,e)}function ol(e,t){t=Js(t.lat,t.lng);n=Js((e=e)._center.lat,e._center.lng),i=_s([],us(0,1,0),n),r=os([],-e.angle,n),i=Ee(i,i,r),os(r,-e._pitch,i),ms(i=ys([],n),i,js(e.cameraToCenterDistance/e.pixelsPerMeter)),Ee(i,i,r);var r=(e=hs([],cs([],n,i),t))[0],n=e[1],i=e[2],o=(t=t)[0],a=t[1],s=t[2],n=(r=Math.sqrt(r*r+n*n+i*i)*Math.sqrt(o*o+a*a+s*s))&&vs(e,t)/r;return Math.acos(Math.min(Math.max(n,-1),1))}function al(e,t){return ol(e,t)>Math.PI/2*1.01}const sl=85*G,ll=Math.cos(sl),ul=Math.sin(sl),cl=6371008.8,hl=2*Math.PI*cl;class A{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,90<this.lat||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new A(Y(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){var t=Math.PI/180,r=this.lat*t,n=e.lat*t,r=Math.sin(r)*Math.sin(n)+Math.cos(r)*Math.cos(n)*Math.cos((e.lng-this.lng)*t);return cl*Math.acos(Math.min(r,1))}toBounds(e=0){var e=360*e/40075017,t=e/Math.cos(Math.PI/180*this.lat);return new qa(new A(this.lng-t,this.lat-e),new A(this.lng+t,this.lat+e))}toEcef(e){e=js(e);return Js(this.lat,this.lng,Os+e)}static convert(e){if(e instanceof A)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new A(Number(e[0]),Number(e[1]));if(Array.isArray(e)||"object"!=typeof e||null===e)throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]");return new A(Number("lng"in e?e.lng:e.lon),Number(e.lat))}}function fl(e){return hl*Math.cos(e*Math.PI/180)}function dl(e){return(180+e)/360}function pl(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function ml(e,t){return e/fl(t)}function gl(e){return 360*e-180}function E(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function yl(e,t){return e*fl(E(t))}const L=85.051129;function vl(e){return 1/Math.cos(e*Math.PI/180)}class _l{constructor(e,t,r=0){this.x=+e,this.y=+t,this.z=+r}static fromLngLat(e,t=0){e=A.convert(e);return new _l(dl(e.lng),pl(e.lat),ml(t,e.lat))}toLngLat(){return new A(gl(this.x),E(this.y))}toAltitude(){return yl(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/hl*vl(E(this.y))}}function xl(t,r,n){let i=t[0],o=i.x,a=i.y;r(i);var s=[i];for(let e=1;e<t.length;e++){var l=t[e],{x:u,y:c}=l;r(l),function e(t,r,n,i,o,a,s,l,u){var c,h,f,d,p,m,g=(r+i)/2,y=(n+o)/2,v=new I(g,y);l(v),c=v.x,h=v.y,f=a.x,d=a.y,p=f-s.x,m=d-s.y,Math.abs((d-h)*p-(f-c)*m)/Math.hypot(p,m)>=u?(e(t,r,n,g,y,a,v,l,u),e(t,g,y,i,o,v,s,l,u)):t.push(s)}(s,o,a,u,c,i,l,r,n),o=u,a=c,i=l}return s}function bl(t,r){let n=t[0];var i=[n];for(let e=1;e<t.length;e++){var o=t[e];(function e(t,r,n,i){var o;i(r,n)?(o=r.add(n)._mult(.5),e(t,r,o,i),e(t,o,n,i)):t.push(n)})(i,n,o,r),n=o}return i}const wl=Math.pow(2,14)-1,El=-wl-1;function Tl(t,n,r){const i=t.loadGeometry(),o=t.extent,a=se/o;if(n&&r&&r.projection.isReprojectedInTileSpace){const a=1<<n.z,{scale:u,x:c,y:h,projection:f}=r,d=e=>{var t=gl((n.x+e.x/o)/a),r=E((n.y+e.y/o)/a),t=f.project(t,r);e.x=(t.x*u-c)*o,e.y=(t.y*u-h)*o};for(let e=0;e<i.length;e++)if(1!==t.type)i[e]=xl(i[e],d,1);else{const t=[];for(const r of i[e])r.x<0||r.x>=o||r.y<0||r.y>=o||(d(r),t.push(r));i[e]=t}}for(const t of i)for(const n of t)e=n,s=a,l=void 0,l=Math.round(e.x*s),s=Math.round(e.y*s),e.x=S(l,El,wl),e.y=S(s,El,wl),(l<e.x||l>e.x+1||s<e.y||s>e.y+1)&&ae("Geometry exceeds allowed extent, reduce your vector tile buffer size");var e,s,l;return i}function Sl(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Tl(e):[]}}function Ml(e,t,r,n,i){e.emplaceBack(2*t+(n+1)/2,2*r+(i+1)/2)}function kl(e,t,r){e.emplaceBack(t.x,t.y,t.z,16384*r[0],16384*r[1],16384*r[2])}class Cl{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Lo,this.indexArray=new Ho,this.segments=new w,this.programConfigurations=new Ra(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,r,n){const i=this.layers[0],o=[];let a=null;"circle"===i.type&&(a=i.layout.get("circle-sort-key"));for(const{feature:t,id:i,index:l,sourceLayerIndex:u}of e){const e=this.layers[0]._featureFilter.needGeometry,c=Sl(t,e);var s;this.layers[0]._featureFilter.filter(new C(this.zoom),c,r)&&(s=a?a.evaluate(c,{},r):void 0,s={id:i,properties:t.properties,type:t.type,sourceLayerIndex:u,index:l,geometry:e?c.geometry:Tl(t,r,n),patterns:{},sortKey:s},o.push(s))}a&&o.sort((e,t)=>e.sortKey-t.sortKey);let l=null;"globe"===n.projection.name&&(this.globeExtVertexArray=new Bo,l=n.projection);for(const n of o){const{geometry:i,index:o,sourceLayerIndex:a}=n,h=e[o].feature;this.addFeature(n,i,o,t.availableImages,r,l),t.featureIndex.insert(h,i,o,a,this.index)}}update(e,t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Wa.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Za.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,r,n,i,o){for(const r of t)for(const t of r){const r=t.x,n=t.y;if(!(r<0||r>=se||n<0||n>=se)){if(o){const e=o.projectTilePoint(r,n,i),t=o.upVector(i,r,n),l=this.globeExtVertexArray;kl(l,e,t),kl(l,e,t),kl(l,e,t),kl(l,e,t)}var a=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),s=a.vertexLength;Ml(this.layoutVertexArray,r,n,-1,-1),Ml(this.layoutVertexArray,r,n,1,-1),Ml(this.layoutVertexArray,r,n,1,1),Ml(this.layoutVertexArray,r,n,-1,1),this.indexArray.emplaceBack(s,s+1,s+2),this.indexArray.emplaceBack(s,s+2,s+3),a.vertexLength+=4,a.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},n,i)}}function Al(t,r){for(let e=0;e<t.length;e++)if(Rl(r,t[e]))return!0;for(let e=0;e<r.length;e++)if(Rl(t,r[e]))return!0;return!!Pl(t,r)}function Il(t,r){if(1===t.length)return Ol(r,t[0]);for(let e=0;e<r.length;e++){var n=r[e];for(let e=0;e<n.length;e++)if(Rl(t,n[e]))return!0}for(let e=0;e<t.length;e++)if(Ol(r,t[e]))return!0;for(let e=0;e<r.length;e++)if(Pl(t,r[e]))return!0;return!1}function Ll(t,r,n){if(1<t.length){if(Pl(t,r))return 1;for(let e=0;e<r.length;e++)if(zl(r[e],t,n))return 1}for(let e=0;e<t.length;e++)if(zl(t[e],r,n))return 1}function Pl(t,r){var n,i,o,a;if(0!==t.length&&0!==r.length)for(let e=0;e<t.length-1;e++){var s=t[e],l=t[e+1];for(let e=0;e<r.length-1;e++)if(n=s,i=l,o=r[e],a=r[e+1],de(n,o,a)!==de(i,o,a)&&de(n,i,o)!==de(n,i,a))return 1}}function zl(t,r,e){var n=e*e;if(1===r.length)return t.distSqr(r[0])<n;for(let e=1;e<r.length;e++)if(Dl(t,r[e-1],r[e])<n)return 1}function Dl(e,t,r){var n=t.distSqr(r);return 0===n?e.distSqr(t):(n=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/n,e.distSqr(n<0?t:1<n?r:r.sub(t)._mult(n)._add(t)))}function Ol(n,i){let o,a,s,l=!1;for(let r=0;r<n.length;r++)for(let e=0,t=(o=n[r]).length-1;e<o.length;t=e++)a=o[e],s=o[t],a.y>i.y!=s.y>i.y&&i.x<(s.x-a.x)*(i.y-a.y)/(s.y-a.y)+a.x&&(l=!l);return l}function Rl(r,n){let i=!1;for(let e=0,t=r.length-1;e<r.length;t=e++){var o=r[e],a=r[t];o.y>n.y!=a.y>n.y&&n.x<(a.x-o.x)*(n.y-o.y)/(a.y-o.y)+o.x&&(i=!i)}return i}function Fl(t,e,r,n,i){for(const o of t)if(e<=o.x&&r<=o.y&&n>=o.x&&i>=o.y)return!0;const o=[new I(e,r),new I(e,i),new I(n,i),new I(n,r)];if(2<t.length)for(const e of o)if(Rl(t,e))return!0;for(let e=0;e<t.length-1;e++)if(function(e,t,r){var n=r[0],i=r[2];if(e.x<n.x&&t.x<n.x||e.x>i.x&&t.x>i.x||e.y<n.y&&t.y<n.y||e.y>i.y&&t.y>i.y)return;n=de(e,t,r[0]);return n!==de(e,t,r[1])||n!==de(e,t,r[2])||n!==de(e,t,r[3])}(t[e],t[e+1],o))return!0;return!1}function Bl(e,t,r){var n=t.paint.get(e).value;return"constant"===n.kind?n.value:r.programConfigurations.get(t.id).getMaxValue(e)}function Nl(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function jl(t,e,r,n,i){if(!e[0]&&!e[1])return t;var o=I.convert(e)._mult(i),a=("viewport"===r&&o._rotate(-n),[]);for(let e=0;e<t.length;e++)a.push(t[e].sub(o));return a}function Ul(e,t,r,n){e=I.convert(e)._mult(n);return"viewport"===t&&e._rotate(-r),e}e(Cl,"CircleBucket",{omit:["layers"]});var Qr=new Mo({"circle-sort-key":new r(c.layout_circle["circle-sort-key"])}),Vl={paint:new Mo({"circle-radius":new r(c.paint_circle["circle-radius"]),"circle-color":new r(c.paint_circle["circle-color"]),"circle-blur":new r(c.paint_circle["circle-blur"]),"circle-opacity":new r(c.paint_circle["circle-opacity"]),"circle-translate":new t(c.paint_circle["circle-translate"]),"circle-translate-anchor":new t(c.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new t(c.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new t(c.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new r(c.paint_circle["circle-stroke-width"]),"circle-stroke-color":new r(c.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new r(c.paint_circle["circle-stroke-opacity"])}),layout:Qr};function Gl(e,t,r,n,i,o,a,s,l){if(!o||!e.queryGeometry.isAboveHorizon){o&&(l*=e.pixelToTileUnitsFactor);var u=e.tileID.canonical,c=r.projection.upVectorScale(u,r.center.lat,r.worldSize).metersToTile;for(const p of t)for(const t of p){const m=t.add(s),g=i&&r.elevation?r.elevation.exaggeration()*i.getElevationAt(m.x,m.y,!0):0,y=r.projection.projectTilePoint(m.x,m.y,u);if(0<g){const e=r.projection.upVector(u,m.x,m.y);y.x+=e[0]*c*g,y.y+=e[1]*c*g,y.z+=e[2]*c*g}var h=o?m:function(e,t,r,n){e=Ts([],[e,t,r,1],n);return new I(e[0]/e[3],e[1]/e[3])}(y.x,y.y,y.z,n),f=o?e.tilespaceRays.map(e=>{return e=e,t=g,r=as(),Wl[2]=t,e.intersectsPlane(Wl,Zl,r),new I(r[0],r[1]);var t,r}):e.queryGeometry.screenGeometry,d=Ts([],[y.x,y.y,y.z,1],n);if(!a&&o?l*=d[3]/r.cameraToCenterDistance:a&&!o&&(l*=r.cameraToCenterDistance/d[3]),o){const e=E((t.y/se+u.y)/(1<<u.z));l/=r.projection.pixelsPerMeter(e,1)/ml(1,e)}if(d=l,Rl(f=f,h=h)||zl(h,f,d))return!0}}return!1}const Wl=us(0,0,0),Zl=us(0,0,1);class ql extends Cl{}function Hl(e,{width:t,height:r},n,i){if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==t*r*n)throw new RangeError("mismatched image size")}else i=new Uint8Array(t*r*n);e.width=t,e.height=r,e.data=i}function $l(e,t,r){var{width:n,height:i}=t;n===e.width&&i===e.height||(Xl(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,n),height:Math.min(e.height,i)},r),e.width=n,e.height=i,e.data=t.data)}function Xl(t,r,n,i,o,a){if(0!==o.width&&0!==o.height){if(o.width>t.width||o.height>t.height||n.x>t.width-o.width||n.y>t.height-o.height)throw new RangeError("out of range source coordinates for image copy");if(o.width>r.width||o.height>r.height||i.x>r.width-o.width||i.y>r.height-o.height)throw new RangeError("out of range destination coordinates for image copy");var s=t.data,l=r.data;for(let e=0;e<o.height;e++){var u=((n.y+e)*t.width+n.x)*a,c=((i.y+e)*r.width+i.x)*a;for(let e=0;e<o.width*a;e++)l[c+e]=s[u+e]}}}e(ql,"HeatmapBucket",{omit:["layers"]});class Yl{constructor(e,t){Hl(this,e,1,t)}resize(e){$l(this,new Yl(e),1)}clone(){return new Yl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,n,i){Xl(e,t,r,n,i,1)}}class Jl{constructor(e,t){Hl(this,e,4,t)}resize(e){$l(this,new Jl(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Jl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,n,i){Xl(e,t,r,n,i,4)}}e(Yl,"AlphaImage"),e(Jl,"RGBAImage");var Kl={paint:new Mo({"heatmap-radius":new r(c.paint_heatmap["heatmap-radius"]),"heatmap-weight":new r(c.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new t(c.paint_heatmap["heatmap-intensity"]),"heatmap-color":new So(c.paint_heatmap["heatmap-color"]),"heatmap-opacity":new t(c.paint_heatmap["heatmap-opacity"])})};function Ql(i){const n={},o=i.resolution||256,e=i.clips?i.clips.length:1,a=i.image||new Jl({width:o,height:e}),s=(e,t,r)=>{n[i.evaluationKey]=r;r=i.expression.evaluate(n);a.data[e+t+0]=Math.floor(255*r.r/r.a),a.data[e+t+1]=Math.floor(255*r.g/r.a),a.data[e+t+2]=Math.floor(255*r.b/r.a),a.data[e+t+3]=Math.floor(255*r.a)};if(i.clips)for(let r=0,n=0;r<e;++r,n+=4*o)for(let e=0,t=0;e<o;e++,t+=4){var l=e/(o-1),{start:u,end:c}=i.clips[r];s(n,t,u*(1-l)+c*l)}else for(let e=0,t=0;e<o;e++,t+=4)s(0,t,e/(o-1));return a}var eu={paint:new Mo({"hillshade-illumination-direction":new t(c.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new t(c.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new t(c.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new t(c.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new t(c.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new t(c.paint_hillshade["hillshade-accent-color"])})};const tu=i([{name:"a_pos",components:2,type:"Int16"}],4),ru=tu["members"];var nu={};function iu(e,t,r){r=r||2;var n,i,o,a,s,l=t&&t.length,u=l?t[0]*r:e.length,c=ou(e,0,u,r,!0),h=[];if(c&&c.next!==c.prev){if(l&&(c=function(e,t,r,n){for(var i,o,a,s,l=[],u=0,c=t.length;u<c;u++)(i=ou(e,t[u]*n,u<c-1?t[u+1]*n:e.length,n,!1))===i.next&&(i.steiner=!0),l.push(function(e){var t=e,r=e;for(;(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next,t!==e;);return r}(i));for(l.sort(lu),u=0;u<l.length;u++)s=void 0,r=(s=function(e,t){var r,n=t,i=e.x,o=e.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&a<s&&(r=n.x<n.next.x?n:n.next,(a=s)===i))return r}}while((n=n.next)!==t);if(!r)return null;for(var l,u,c,h=r,f=r.x,d=r.y,p=1/0,n=r;i>=n.x&&n.x>=f&&i!==n.x&&cu(o<d?i:a,o,f,d,o<d?a:i,o,n.x,n.y)&&(l=Math.abs(o-n.y)/(i-n.x),mu(n,e)&&(l<p||l===p&&(n.x>r.x||n.x===r.x&&(c=n,P((u=r).prev,u,c.prev)<0&&P(c.next,u,u.next)<0)))&&(r=n,p=l)),(n=n.next)!==h;);return r}(o=l[u],a=r))?(au(o=gu(s,o),o.next),au(s,s.next)):a;return r}(e,t,c,r)),e.length>80*r){for(var f=n=e[0],d=i=e[1],p=r;p<u;p+=r)(o=e[p])<f&&(f=o),(a=e[p+1])<d&&(d=a),n<o&&(n=o),i<a&&(i=a);s=0!==(s=Math.max(n-f,i-d))?32767/s:0}su(c,h,r,f,d,s,0)}return h}function ou(e,t,r,n,i){var o,a;if(i===0<xu(e,t,r,n))for(o=t;o<r;o+=n)a=yu(o,e[o],e[o+1],a);else for(o=r-n;t<=o;o-=n)a=yu(o,e[o],e[o+1],a);return a&&hu(a,a.next)&&(vu(a),a=a.next),a}function au(e,t){if(!e)return e;t=t||e;var r,n=e;do{if(r=!1,n.steiner||!hu(n,n.next)&&0!==P(n.prev,n,n.next))n=n.next;else{if(vu(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function su(e,t,r,n,i,o,a){if(e){if(!a&&o){var s=e;var l=n;var u=i;var c=o;for(var h=s;0===h.z&&(h.z=uu(h.x,h.y,l,u,c)),h.prevZ=h.prev,h.nextZ=h.next,(h=h.next)!==s;);h.prevZ.nextZ=null,h.prevZ=null;var f,d,p,m,g,y,v,_,x=h,b=1;do{for(d=x,g=x=null,y=0;d;){for(y++,p=d,f=v=0;f<b&&(v++,p=p.nextZ);f++);for(_=b;0<v||0<_&&p;)0!==v&&(0===_||!p||d.z<=p.z)?(d=(m=d).nextZ,v--):(p=(m=p).nextZ,_--),g?g.nextZ=m:x=m,m.prevZ=g,g=m;d=p}}while(g.nextZ=null,b*=2,1<y)}for(var w,E,T=e;e.prev!==e.next;)if(w=e.prev,E=e.next,o?function(e,t,r,n){var i=e.prev,o=e,a=e.next;if(0<=P(i,o,a))return;for(var s=i.x,l=o.x,u=a.x,c=i.y,h=o.y,f=a.y,d=s<l?s<u?s:u:l<u?l:u,p=c<h?c<f?c:f:h<f?h:f,m=l<s?u<s?s:u:u<l?l:u,g=h<c?f<c?c:f:f<h?h:f,y=uu(d,p,t,r,n),v=uu(m,g,t,r,n),_=e.prevZ,x=e.nextZ;_&&_.z>=y&&x&&x.z<=v;){if(_.x>=d&&_.x<=m&&_.y>=p&&_.y<=g&&_!==i&&_!==a&&cu(s,c,l,h,u,f,_.x,_.y)&&0<=P(_.prev,_,_.next))return;if(_=_.prevZ,x.x>=d&&x.x<=m&&x.y>=p&&x.y<=g&&x!==i&&x!==a&&cu(s,c,l,h,u,f,x.x,x.y)&&0<=P(x.prev,x,x.next))return;x=x.nextZ}for(;_&&_.z>=y;){if(_.x>=d&&_.x<=m&&_.y>=p&&_.y<=g&&_!==i&&_!==a&&cu(s,c,l,h,u,f,_.x,_.y)&&0<=P(_.prev,_,_.next))return;_=_.prevZ}for(;x&&x.z<=v;){if(x.x>=d&&x.x<=m&&x.y>=p&&x.y<=g&&x!==i&&x!==a&&cu(s,c,l,h,u,f,x.x,x.y)&&0<=P(x.prev,x,x.next))return;x=x.nextZ}return 1}(e,n,i,o):function(e){var t=e.prev,r=e,e=e.next;if(0<=P(t,r,e))return;for(var n=t.x,i=r.x,o=e.x,a=t.y,s=r.y,l=e.y,u=n<i?n<o?n:o:i<o?i:o,c=a<s?a<l?a:l:s<l?s:l,h=i<n?o<n?n:o:o<i?i:o,f=s<a?l<a?a:l:l<s?s:l,d=e.next;d!==t;){if(d.x>=u&&d.x<=h&&d.y>=c&&d.y<=f&&cu(n,a,i,s,o,l,d.x,d.y)&&0<=P(d.prev,d,d.next))return;d=d.next}return 1}(e))t.push(w.i/r|0),t.push(e.i/r|0),t.push(E.i/r|0),vu(e),e=E.next,T=E.next;else if((e=E)===T){a?1===a?su(e=function(e,t,r){var n=e;do{var i=n.prev,o=n.next.next}while(!hu(i,o)&&fu(i,n,n.next,o)&&mu(i,o)&&mu(o,i)&&(t.push(i.i/r|0),t.push(n.i/r|0),t.push(o.i/r|0),vu(n),vu(n.next),n=e=o),n=n.next,n!==e);return au(n)}(au(e),t,r),t,r,n,i,o,2):2===a&&function(e,t,r,n,i,o){var a=e;do{for(var s,l=a.next.next;l!==a.prev;){if(a.i!==l.i&&function(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&fu(r,r.next,e,t))return 1}while((r=r.next)!==e)}(e,t)&&(mu(e,t)&&mu(t,e)&&function(e,t){for(var r=e,n=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),(r=r.next)!==e;);return n}(e,t)&&(P(e.prev,e,t.prev)||P(e,t.prev,t))||hu(e,t)&&0<P(e.prev,e,e.next)&&0<P(t.prev,t,t.next))}(a,l))return s=gu(a,l),a=au(a,a.next),s=au(s,s.next),su(a,t,r,n,i,o,0),su(s,t,r,n,i,o,0);l=l.next}}while(a=a.next,a!==e)}(e,t,r,n,i,o):su(au(e),t,r,n,i,o,1);break}}}function lu(e,t){return e.x-t.x}function uu(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function cu(e,t,r,n,i,o,a,s){return(e-a)*(o-s)<=(i-a)*(t-s)&&(r-a)*(t-s)<=(e-a)*(n-s)&&(i-a)*(n-s)<=(r-a)*(o-s)}function P(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function hu(e,t){return e.x===t.x&&e.y===t.y}function fu(e,t,r,n){var i=pu(P(e,t,r)),o=pu(P(e,t,n)),a=pu(P(r,n,e)),s=pu(P(r,n,t));return i!==o&&a!==s||0===i&&du(e,r,t)||0===o&&du(e,n,t)||0===a&&du(r,e,n)||0===s&&du(r,t,n)}function du(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function pu(e){return 0<e?1:e<0?-1:0}function mu(e,t){return P(e.prev,e,e.next)<0?0<=P(e,t,e.next)&&0<=P(e,e.prev,t):P(e,t,e.prev)<0||P(e,e.next,t)<0}function gu(e,t){var r=new _u(e.i,e.x,e.y),n=new _u(t.i,t.x,t.y),i=e.next,o=t.prev;return(e.next=t).prev=e,(r.next=i).prev=r,(n.next=r).prev=n,(o.next=n).prev=o,n}function yu(e,t,r,n){e=new _u(e,t,r);return n?(e.next=n.next,(e.prev=n).next.prev=e,n.next=e):(e.prev=e).next=e,e}function vu(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function _u(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function xu(e,t,r,n){for(var i=0,o=t,a=r-n;o<r;o+=n)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}function bu(e,t,r,n,i){!function e(t,r,n,i,o){for(;n<i;){600<i-n&&(a=i-n+1,s=r-n+1,u=Math.log(a),l=.5*Math.exp(2*u/3),u=.5*Math.sqrt(u*l*(a-l)/a)*(s-a/2<0?-1:1),e(t,r,Math.max(n,Math.floor(r-s*l/a+u)),Math.min(i,Math.floor(r+(a-s)*l/a+u)),o));var a,s,l,u,c=t[r],h=n,f=i;for(wu(t,n,r),0<o(t[i],c)&&wu(t,n,i);h<f;){for(wu(t,h,f),h++,f--;o(t[h],c)<0;)h++;for(;0<o(t[f],c);)f--}0===o(t[n],c)?wu(t,n,f):wu(t,++f,i),f<=r&&(n=f+1),r<=f&&(i=f-1)}}(e,t,r||0,n||e.length-1,i||Eu)}function wu(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function Eu(e,t){return e<t?-1:t<e?1:0}function Tu(t,r){const n=t.length;if(n<=1)return[t];var i=[];let o,a;for(let e=0;e<n;e++){const n=function(o){let a=0;for(let e,t,r=0,n=o.length,i=n-1;r<n;i=r++)e=o[r],t=o[i],a+=(t.x-e.x)*(e.y+t.y);return a}(t[e]);0!==n&&(t[e].area=Math.abs(n),(a=void 0===a?n<0:a)===n<0?(o&&i.push(o),o=[t[e]]):o.push(t[e]))}if(o&&i.push(o),1<r)for(let e=0;e<i.length;e++)i[e].length<=r||(bu(i[e],r,1,i[e].length-1,Su),i[e]=i[e].slice(0,r));return i}function Su(e,t){return t.area-e.area}function Mu(e,t,r){var n=r.patternDependencies;let i=!1;for(const r of t){const t=r.paint.get(e+"-pattern");t.isConstant()||(i=!0);var o=t.constantOr(null);o&&(i=!0,n[o]=!0)}return i}function ku(e,t,r,n,i){var o,a=i.patternDependencies;for(const s of t){const t=s.paint.get(e+"-pattern").value;"constant"!==t.kind&&(a[o=(o=t.evaluate({zoom:n},r,{},i.availableImages))&&o.name?o.name:o]=!0,r.patterns[s.id]=o)}return r}({get exports(){return nu},set exports(e){nu=e}}).exports=iu,(nu.default=iu).deviation=function(e,t,r,n){var i=t&&t.length,o=Math.abs(xu(e,0,i?t[0]*r:e.length,r));if(i)for(var a=0,s=t.length;a<s;a++)o-=Math.abs(xu(e,t[a]*r,a<s-1?t[a+1]*r:e.length,r));for(var l=0,a=0;a<n.length;a+=3){var u=n[a]*r,c=n[a+1]*r,h=n[a+2]*r;l+=Math.abs((e[u]-e[h])*(e[1+c]-e[1+u])-(e[u]-e[c])*(e[1+h]-e[1+u]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},iu.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)r.vertices.push(e[i][o][a]);0<i&&r.holes.push(n+=e[i-1].length)}return r};class Cu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Lo,this.indexArray=new Ho,this.indexArray2=new Qo,this.programConfigurations=new Ra(e.layers,e.zoom),this.segments=new w,this.segments2=new w,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.projection=e.projection}populate(e,t,r,n){this.hasPattern=Mu("fill",this.layers,t);const i=this.layers[0].layout.get("fill-sort-key"),o=[];for(var{feature:a,id:s,index:l,sourceLayerIndex:u}of e){const e=this.layers[0]._featureFilter.needGeometry,h=Sl(a,e);var c;this.layers[0]._featureFilter.filter(new C(this.zoom),h,r)&&(c=i?i.evaluate(h,{},r,t.availableImages):void 0,s={id:s,properties:a.properties,type:a.type,sourceLayerIndex:u,index:l,geometry:e?h.geometry:Tl(a,r,n),patterns:{},sortKey:c},o.push(s))}i&&o.sort((e,t)=>e.sortKey-t.sortKey);for(const n of o){const{geometry:i,index:o,sourceLayerIndex:f}=n;if(this.hasPattern){const e=ku("fill",this.layers,n,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(n,i,o,r,{},t.availableImages);t.featureIndex.insert(e[o].feature,i,o,f,this.index)}}update(e,t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,n)}addFeatures(e,t,r,n,i){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ru),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,n,i,o,a=[]){for(const t of Tu(r,500)){let e=0;for(const n of t)e+=n.length;const n=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray),i=n.vertexLength,o=[],a=[];for(const r of t)if(0!==r.length){r!==t[0]&&a.push(o.length/2);const n=this.segments2.prepareSegment(r.length,this.layoutVertexArray,this.indexArray2),i=n.vertexLength;this.layoutVertexArray.emplaceBack(r[0].x,r[0].y),this.indexArray2.emplaceBack(i+r.length-1,i),o.push(r[0].x),o.push(r[0].y);for(let e=1;e<r.length;e++)this.layoutVertexArray.emplaceBack(r[e].x,r[e].y),this.indexArray2.emplaceBack(i+e-1,i+e),o.push(r[e].x),o.push(r[e].y);n.vertexLength+=r.length,n.primitiveLength+=r.length}var s=nu(o,a);for(let e=0;e<s.length;e+=3)this.indexArray.emplaceBack(i+s[e],i+s[e+1],i+s[e+2]);n.vertexLength+=e,n.primitiveLength+=s.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,o,a,i)}}e(Cu,"FillBucket",{omit:["layers","patternFeatures"]});var en=new Mo({"fill-sort-key":new r(c.layout_fill["fill-sort-key"])}),Au={paint:new Mo({"fill-antialias":new t(c.paint_fill["fill-antialias"]),"fill-opacity":new r(c.paint_fill["fill-opacity"]),"fill-color":new r(c.paint_fill["fill-color"]),"fill-outline-color":new r(c.paint_fill["fill-outline-color"]),"fill-translate":new t(c.paint_fill["fill-translate"]),"fill-translate-anchor":new t(c.paint_fill["fill-translate-anchor"]),"fill-pattern":new r(c.paint_fill["fill-pattern"])}),layout:en};const Iu=i([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Lu=i([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Pu=i([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),zu=Iu["members"];var rn={},Du=I,sn=Ou;function Ou(e,t,r,n,i){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=i,e.readFields(Ru,this,t)}function Ru(e,t,r){if(1==e)t.id=r.readVarint();else if(2!=e)3==e?t.type=r.readVarint():4==e&&(t._geometry=r.pos);else for(var n=r,i=t,o=n.readVarint()+n.pos;n.pos<o;){var a=i._keys[n.readVarint()],s=i._values[n.readVarint()];i.properties[a]=s}}Ou.types=["Unknown","Point","LineString","Polygon"],Ou.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r,n=e.readVarint()+e.pos,i=1,o=0,a=0,s=0,l=[];e.pos<n;)if(o<=0&&(i=7&(r=e.readVarint()),o=r>>3),o--,1===i||2===i)a+=e.readSVarint(),s+=e.readSVarint(),1===i&&(t&&l.push(t),t=[]),t.push(new Du(a,s));else{if(7!==i)throw new Error("unknown command "+i);t&&t.push(t[0].clone())}return t&&l.push(t),l},Ou.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,n=1,i=0,o=0,a=0,s=1/0,l=-1/0,u=1/0,c=-1/0;e.pos<r;)if(i<=0&&(n=7&(t=e.readVarint()),i=t>>3),i--,1===n||2===n)(o+=e.readSVarint())<s&&(s=o),l<o&&(l=o),(a+=e.readSVarint())<u&&(u=a),c<a&&(c=a);else if(7!==n)throw new Error("unknown command "+n);return[s,u,l,c]},Ou.prototype.toGeoJSON=function(e,t,r){var n,i=this.extent*Math.pow(2,r),o=this.extent*e,a=this.extent*t,s=this.loadGeometry(),r=Ou.types[this.type];function l(e){for(var t=0;t<e.length;t++){var r=e[t];e[t]=[360*(r.x+o)/i-180,360/Math.PI*Math.atan(Math.exp((180-360*(r.y+a)/i)*Math.PI/180))-90]}}switch(this.type){case 1:for(var u=[],c=0;c<s.length;c++)u[c]=s[c][0];l(s=u);break;case 2:for(c=0;c<s.length;c++)l(s[c]);break;case 3:for(s=function(e){var t=e.length;if(t<=1)return[e];for(var r,n,i=[],o=0;o<t;o++){var a=function(e){for(var t,r,n=0,i=0,o=e.length,a=o-1;i<o;a=i++)n+=((r=e[a]).x-(t=e[i]).x)*(t.y+r.y);return n}(e[o]);0!==a&&((n=void 0===n?a<0:n)===a<0?(r&&i.push(r),r=[e[o]]):r.push(e[o]))}return r&&i.push(r),i}(s),c=0;c<s.length;c++)for(n=0;n<s[c].length;n++)l(s[c][n])}1===s.length?s=s[0]:r="Multi"+r;e={type:"Feature",geometry:{type:r,coordinates:s},properties:this.properties};return"id"in this&&(e.id=this.id),e};var Fu=sn,ln=Bu;function Bu(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Nu,this,t),this.length=this._features.length}function Nu(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(function(e){for(var t=null,r=e.readVarint()+e.pos;e.pos<r;)var n=e.readVarint()>>3,t=1==n?e.readString():2==n?e.readFloat():3==n?e.readDouble():4==n?e.readVarint64():5==n?e.readVarint():6==n?e.readSVarint():7==n?e.readBoolean():null;return t}(r))}Bu.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];e=this._pbf.readVarint()+this._pbf.pos;return new Fu(this._pbf,e,this.extent,this._keys,this._values)};var ju=ln;function Uu(e,t,r){3===e&&(e=new ju(r,r.readVarint()+r.pos)).length&&(t[e.name]=e)}var Vu=rn.VectorTile=function(e,t){this.layers=e.readFields(Uu,{},t)},cn=rn.VectorTileFeature=sn;function Gu(e,t,r,n){const i=[],o=0===n?(e,t,r,n,i,o)=>{e.push(new I(o,r+(o-t)/(n-t)*(i-r)))}:(e,t,r,n,i,o)=>{e.push(new I(t+(o-r)/(i-r)*(n-t),o))};for(const m of e){const e=[];for(const i of m)if(!(i.length<=2)){var a=[];for(let e=0;e<i.length-1;e++){var s=i[e].x,l=i[e].y,u=i[e+1].x,c=i[e+1].y,h=0===n?s:l,f=0===n?u:c;h<t?t<f&&o(a,s,l,u,c,t):r<h?f<r&&o(a,s,l,u,c,r):a.push(i[e]),f<t&&t<=h&&o(a,s,l,u,c,t),r<f&&h<=r&&o(a,s,l,u,c,r)}var d=i[i.length-1],p=0===n?d.x:d.y;t<=p&&p<=r&&a.push(d),a.length&&(d=a[a.length-1],a[0].x===d.x&&a[0].y===d.y||a.push(a[0]),e.push(a))}e.length&&i.push(e)}return i}rn.VectorTileLayer=ln;const Wu=cn.types,Zu=Math.pow(2,13);function qu(e,t,r,n,i,o,a,s){e.emplaceBack((t<<1)+a,(r<<1)+o,(Math.floor(n*Zu)<<1)+i,Math.round(s))}function Hu(e,t,r){e.emplaceBack(t.x,t.y,t.z,16384*r[0],16384*r[1],16384*r[2])}class $u{constructor(){this.acc=new I(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new I(e.x,e.y),this.max=new I(e.x,e.y))}append(e,t){this.currentPolyCount.edges++,this.acc._add(e);var r=this.min,n=this.max;e.x<r.x?r.x=e.x:e.x>n.x&&(n.x=e.x),e.y<r.y?r.y=e.y:e.y>n.y&&(n.y=e.y),((0===e.x||e.x===se)&&e.x===t.x)!=((0===e.y||e.y===se)&&e.y===t.y)&&this.processBorderOverlap(e,t),t.x<0!=e.x<0&&this.addBorderIntersection(0,k(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>se!=e.x>se&&this.addBorderIntersection(1,k(t.y,e.y,(se-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,k(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>se!=e.y>se&&this.addBorderIntersection(3,k(t.x,e.x,(se-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);e=this.borders[e];t<e[0]&&(e[0]=t),t>e[1]&&(e[1]=t)}processBorderOverlap(e,t){var r;e.x===t.x?e.y!==t.y&&(r=0===e.x?0:1,this.addBorderIntersection(r,t.y),this.addBorderIntersection(r,e.y)):(r=0===e.y?2:3,this.addBorderIntersection(r,t.x),this.addBorderIntersection(r,e.x))}centroid(){var e=this.polyCount.reduce((e,t)=>e+t.edges,0);return 0!==e?this.acc.div(e)._round():new I(0,0)}span(){return new I(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,t)=>e+ +(t[0]!==Number.MAX_VALUE),0)}}class Xu{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new zo,this.centroidVertexArray=new fa,this.indexArray=new Ho,this.programConfigurations=new Ra(e.layers,e.zoom),this.segments=new w,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.enableTerrain=e.enableTerrain}populate(e,t,r,n){var i,o,a,s,l,u,c,h;this.features=[],this.hasPattern=Mu("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=(i=r,80150034*(o=Math.exp(Math.PI*(1-i.y/(1<<i.z)*2)))/(o*o+1)/se/(1<<i.z)),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for({feature:a,id:s,index:l,sourceLayerIndex:u}of e){const e=this.layers[0]._featureFilter.needGeometry,f=Sl(a,e);this.layers[0]._featureFilter.filter(new C(this.zoom),f,r)&&(c={id:s,sourceLayerIndex:u,index:l,geometry:e?f.geometry:Tl(a,r,n),properties:a.properties,type:a.type,patterns:{}},h=this.layoutVertexArray.length,this.hasPattern?this.features.push(ku("fill-extrusion",this.layers,c,this.zoom,t)):this.addFeature(c,c.geometry,l,r,{},t.availableImages,n),t.featureIndex.insert(a,c.geometry,l,u,this.index,h))}this.sortBorders()}addFeatures(e,t,r,n,i){for(const e of this.features){var o=e["geometry"];this.addFeature(e,o,e.index,t,r,n,i)}this.sortBorders()}update(e,t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zu),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Pu.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Lu.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(h,f,d,p,m,g,y){const e=[new I(0,0),new I(se,se)],v=y.projection,_="globe"===v.name,x=this.enableTerrain&&!_?new $u:null,b="Polygon"===Wu[h.type];_&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Bo);var t,r=Tu(f,500);for(let e=r.length-1;0<=e;e--){const f=r[e];(0===f.length||(t=f[0]).every(e=>e.x<=0)||t.every(e=>e.x>=se)||t.every(e=>e.y<=0)||t.every(e=>e.y>=se))&&r.splice(e,1)}let n;if(_)n=nc(r,e,p);else{n=[];for(const h of r)n.push({polygon:h,bounds:e})}var w=b?this.edgeRadius:0;for(const{polygon:h,bounds:f}of n){let c=0,e=0;for(const f of h)b&&!f[0].equals(f[f.length-1])&&f.push(f[0]),e+=b?f.length-1:f.length;const g=this.segments.prepareSegment((b?5:4)*e,this.layoutVertexArray,this.indexArray);if(b){const f=[],m=[];c=g.vertexLength;for(const d of h){let n,i;d.length&&d!==h[0]&&m.push(f.length/2),n=d[1].sub(d[0])._perp()._unit();for(let r=1;r<d.length;r++){const m=d[r],x=d[r===d.length-1?1:r+1];let{x:e,y:t}=m;if(w){i=x.sub(m)._perp()._unit();const h=n.add(i)._unit(),f=w*Math.min(4,1/(n.x*h.x+n.y*h.y));e+=f*h.x,t+=f*h.y,n=i}qu(this.layoutVertexArray,e,t,0,0,1,1,0),g.vertexLength++,f.push(m.x,m.y),_&&Hu(this.layoutVertexExtArray,v.projectTilePoint(e,t,p),v.upVector(p,e,t))}}const y=nu(f,m);for(let e=0;e<y.length;e+=3)this.indexArray.emplaceBack(c+y[e],c+y[e+2],c+y[e+1]),g.primitiveLength++}for(const m of h){x&&m.length&&x.startRing(m[0]);let i,o,a,s=4<m.length&&ec(m[m.length-2],m[0],m[1]),l=w?Ju(m[m.length-2],m[0],m[1],w):0,u=(o=m[1].sub(m[0])._perp()._unit(),!0);for(let e=1,n=0;e<m.length;e++){let t=m[e-1],r=m[e];var E=m[e===m.length-1?1:e+1];if(x&&b&&x.currentPolyCount.top++,Qu(r,t,f))w&&(o=E.sub(r)._perp()._unit(),u=!u);else{x&&x.append(r,t);var T=r.sub(t)._perp(),S=T.x/(Math.abs(T.x)+Math.abs(T.y)),T=0<T.y?1:0,M=t.dist(r);if(32768<n+M&&(n=0),w){a=E.sub(r)._perp()._unit();let e=Ku(t,r,E,Yu(o,a),w);isNaN(e)&&(e=0);const f=r.sub(t)._unit();t=t.add(f.mult(l))._round(),r=r.add(f.mult(-e))._round(),l=e,o=a}var k=g.vertexLength,C=4<m.length&&ec(t,r,E),A=tc(n,s,u);if(qu(this.layoutVertexArray,t.x,t.y,S,T,0,0,A),qu(this.layoutVertexArray,t.x,t.y,S,T,0,1,A),A=tc(n+=M,C,!u),s=C,qu(this.layoutVertexArray,r.x,r.y,S,T,0,0,A),qu(this.layoutVertexArray,r.x,r.y,S,T,0,1,A),g.vertexLength+=4,this.indexArray.emplaceBack(k+0,k+1,k+2),this.indexArray.emplaceBack(k+1,k+3,k+2),g.primitiveLength+=2,w){const p=c+(1===e?m.length-2:e-2),y=1===e?c:p+1;if(this.indexArray.emplaceBack(k+1,p,k+3),this.indexArray.emplaceBack(p,y,k+3),g.primitiveLength+=2,void 0===i&&(i=k),!Qu(E,m[e],f)){const f=e===m.length-1?i:g.vertexLength;this.indexArray.emplaceBack(k+2,k+3,f),this.indexArray.emplaceBack(k+3,f+1,f),this.indexArray.emplaceBack(k+3,y,f+1),g.primitiveLength+=3}u=!u}if(_){const h=this.layoutVertexExtArray,f=v.projectTilePoint(t.x,t.y,p),d=v.projectTilePoint(r.x,r.y,p),m=v.upVector(p,t.x,t.y),g=v.upVector(p,r.x,r.y);Hu(h,f,m),Hu(h,f,m),Hu(h,d,g),Hu(h,d,g)}}}b&&(c+=m.length-1)}}if(x&&0<x.polyCount.length){if(x.borders){x.vertexArrayOffset=this.centroidVertexArray.length;const h=x.borders,f=this.featuresOnBorder.push(x)-1;for(let e=0;e<4;e++)h[e][0]!==Number.MAX_VALUE&&this.borders[e].push(f)}this.encodeCentroid(x.borders?void 0:x.centroid(),x)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,h,d,m,g,p)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort((e,t)=>this.featuresOnBorder[e].borders[r][0]-this.featuresOnBorder[t].borders[r][0])}encodeCentroid(t,e,r=!0){let n,i;if(t)if(0!==t.y){const r=e.span()._mult(this.tileToMeter);n=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(r.x/10)),i=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(r.y/10))}else n=Math.ceil(7*(t.x+450)),i=0;else n=0,i=+r;let o=r?this.centroidVertexArray.length:e.vertexArrayOffset;for(const t of e.polyCount){r&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*t.edges+t.top);for(let e=0;e<t.top;e++)this.centroidVertexArray.emplace(o++,n,i);for(let e=0;e<2*t.edges;e++)this.centroidVertexArray.emplace(o++,0,i),this.centroidVertexArray.emplace(o++,n,i)}}}function Yu(e,t){t=e.add(t)._unit();return e.x*t.x+e.y*t.y}function Ju(e,t,r,n){var i=t.sub(e)._perp()._unit(),o=r.sub(t)._perp()._unit();return Ku(e,t,r,Yu(i,o),n)}function Ku(e,t,r,n,i){var o=Math.sqrt(1-n*n);return Math.min(e.dist(t)/3,t.dist(r)/3,i*o/n)}function Qu(e,t,r){return e.x<r[0].x&&t.x<r[0].x||e.x>r[1].x&&t.x>r[1].x||e.y<r[0].y&&t.y<r[0].y||e.y>r[1].y&&t.y>r[1].y}function ec(e,t,r){var n;return!(e.x<0||e.x>=se||t.x<0||t.x>=se||r.x<0||r.x>=se)&&(n=(r=r.sub(t)).perp(),e=e.sub(t),-.866<(r.x*e.x+r.y*e.y)/Math.sqrt((r.x*r.x+r.y*r.y)*(e.x*e.x+e.y*e.y))&&n.x*e.x+n.y*e.y<0)}function tc(e,t,r){t=t?2|e:-3&e;return r?1|t:-2&t}function rc(){var e=Math.PI/32,e=Math.tan(e);cl;return 6371008.8*Math.sqrt(1+2*e*e)-6371008.8}function nc(e,t,n){const i=1<<n.z,r=gl(n.x/i),o=gl((n.x+1)/i),a=E(n.y/i),s=E((n.y+1)/i);{var l=e,u=t,c=Math.ceil((o-r)/11.25),h=Math.ceil((a-s)/11.25),f=(e,t,r)=>{if(0===e)return.5*(t+r);{const e=E((n.y+t/se)/i);return(pl(.5*(E((n.y+r/se)/i)+e))*i-n.y)*se}};const p=[];if(l.length&&c&&h){const m=(e,t)=>{for(const r of e)p.push({polygon:r,bounds:t})},g=Math.ceil(Math.log2(c)),y=Math.ceil(Math.log2(h)),v=g-y,_=[];for(let e=0;e<Math.abs(v);e++)_.push(0<v?0:1);for(let e=0;e<Math.min(g,y);e++)_.push(0),_.push(1);let e=l;if(e=Gu(e,u[0].y-1,u[1].y+1,1),(e=Gu(e,u[0].x-1,u[1].x+1,0)).length){var d=[];for(_.length?d.push({polygons:e,bounds:u,depth:0}):m(e,u);d.length;){const l=d.pop(),u=l.depth,c=_[u],h=l.bounds[0],p=l.bounds[1],g=0===c?h.x:h.y,y=0===c?p.x:p.y,v=f(c,g,y),e=Gu(l.polygons,g-1,v+1,c),x=Gu(l.polygons,v-1,y+1,c);if(e.length){const l=[h,new I(0===c?v:p.x,1===c?v:p.y)];_.length>u+1?d.push({polygons:e,bounds:l,depth:u+1}):m(e,l)}if(x.length){const l=[new I(0===c?v:h.x,1===c?v:h.y),p];_.length>u+1?d.push({polygons:x,bounds:l,depth:u+1}):m(x,l)}}}}return p}}e(Xu,"FillExtrusionBucket",{omit:["layers","features"]}),e($u,"PartMetadata");var un=new Mo({"fill-extrusion-edge-radius":new t(c["layout_fill-extrusion"]["fill-extrusion-edge-radius"])}),ic={paint:new Mo({"fill-extrusion-opacity":new t(c["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new r(c["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new t(c["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new t(c["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new r(c["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new r(c["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new r(c["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new t(c["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new t(c["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new t(c["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:un};function oc(e,t,r){r=2*Math.PI*6378137/256/Math.pow(2,r);return[e*r-2*Math.PI*6378137/2,t*r-2*Math.PI*6378137/2]}class ac{constructor(e,t,r){this.z=e,this.x=t,this.y=r,this.key=uc(0,e,e,t,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){r=this.x,i=this.y,o=this.z,n=oc(256*r,256*(i=Math.pow(2,o)-i-1),o),r=oc(256*(r+1),256*(1+i),o);var r,n,i=n[0]+","+n[1]+","+r[0]+","+r[1],o=function(t,r,n){let i,o="";for(let e=t;0<e;e--)i=1<<e-1,o+=(r&i?1:0)+(n&i?2:0);return o}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",o).replace("{bbox-epsg-3857}",i)}toString(){return`${this.z}/${this.x}/`+this.y}}class sc{constructor(e,t){this.wrap=e,this.canonical=t,this.key=uc(e,t.z,t.z,t.x,t.y)}}class lc{constructor(e,t,r,n,i){this.overscaledZ=e,this.wrap=t,this.canonical=new ac(r,+n,+i),this.key=0===t&&e===r?this.canonical.key:uc(t,e,r,n,i)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){var t=this.canonical.z-e;return e>this.canonical.z?new lc(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new lc(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){var r;return this.overscaledZ===e&&t?this.key:e>this.canonical.z?uc(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):(r=this.canonical.z-e,uc(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r))}isChildOf(e){var t;return e.wrap===this.wrap&&(t=this.canonical.z-e.canonical.z,0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t)}children(e){var t,r;return this.overscaledZ>=e?[new lc(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)]:(e=this.canonical.z+1,t=2*this.canonical.x,r=2*this.canonical.y,[new lc(e,this.wrap,e,t,r),new lc(e,this.wrap,e,1+t,r),new lc(e,this.wrap,e,t,1+r),new lc(e,this.wrap,e,1+t,1+r)])}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new lc(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new lc(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new sc(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/`+this.canonical.y}}function uc(e,t,r,n,i){var o=1<<Math.min(r,22);let a=i%o*o+n%o;return e&&r<22&&(a+=o*o*((e<0?-2*e-1:2*e)%(1<<2*(22-r)))),16*(32*a+r)+(t-r)}e(ac,"CanonicalTileID"),e(lc,"OverscaledTileID",{omit:["projMatrix"]});class cc extends I{constructor(e,t,r){super(e,t),this.z=r}}function hc(e,t){return e.x*t.x+e.y*t.y}function fc(r,n){if(1===r.length){let e=0;var i=n[e++];let t;for(;!t||i.equals(t);)if(!(t=n[e++]))return 1/0;for(;e<n.length;e++){var o=n[e],a=r[0],s=t.sub(i),l=o.sub(i),a=a.sub(i),u=hc(s,s),c=hc(s,l),h=hc(l,l),s=hc(a,s),a=hc(a,l),l=u*h-c*c,h=(h*s-c*a)/l,u=(u*a-c*s)/l,a=i.z*(1-h-u)+t.z*h+o.z*u;if(isFinite(a))return a}return 1/0}{let e=1/0;for(const t of n)e=Math.min(e,t.z);return e}}function dc(e,t,r,n,i,o,a,s){var l,u,c,h,f,d,e=a*i.getElevationAt(e,t,!0,!0),t=0!==o[0],p=t?0===o[1]?a*(o[0]/7-450):a*(a=i,i=o,o=s,s=Math.floor(i[0]/8),l=Math.floor(i[1]/8),u=10*(i[0]-8*s),i=10*(i[1]-8*l),c=a.getElevationAt(s,l,!0,!0),o=a.getMeterToDEM(o),p=Math.floor(.5*(u*o-1)),h=Math.floor(.5*(i*o-1)),s=a.tileCoordToPixel(s,l),l=2*p+1,f=2*h+1,a=a,p=s.x-p,s=s.y-h,h=l,d=f,a=[a.getElevationAtPixel(p,s,!0),a.getElevationAtPixel(p+d,s,!0),a.getElevationAtPixel(p,s+d,!0),a.getElevationAtPixel(p+h,s+d,!0)],p=Math.abs(a[0]-a[1]),h=Math.abs(a[2]-a[3]),s=Math.abs(a[0]-a[2])+Math.abs(a[1]-a[3]),d=Math.min(.25,.5*o*(p+h)/l),a=Math.min(.25,.5*o*s/f),c+Math.max(d*u,a*i)):e;return{base:e+(0===r)?-1:r,top:t?Math.max(p+n,e+r+2):e+n}}const pc=i([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),mc=pc["members"],gc=i([{name:"a_packed",components:4,type:"Float32"}]),yc=gc["members"],vc=cn.types,_c=Math.cos(Math.PI/180*37.5);class xc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(e=>{this.gradients[e.id]={}}),this.layoutVertexArray=new Do,this.layoutVertexArray2=new Oo,this.indexArray=new Ho,this.programConfigurations=new Ra(e.layers,e.zoom),this.segments=new w,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id)}populate(e,t,r,n){this.hasPattern=Mu("line",this.layers,t);const i=this.layers[0].layout.get("line-sort-key"),o=[];for(const{feature:t,id:s,index:l,sourceLayerIndex:u}of e){const e=this.layers[0]._featureFilter.needGeometry,c=Sl(t,e);var a;this.layers[0]._featureFilter.filter(new C(this.zoom),c,r)&&(a=i?i.evaluate(c,{},r):void 0,a={id:s,properties:t.properties,type:t.type,sourceLayerIndex:u,index:l,geometry:e?c.geometry:Tl(t,r,n),patterns:{},sortKey:a},o.push(a))}i&&o.sort((e,t)=>e.sortKey-t.sortKey);const{lineAtlas:s,featureIndex:l}=t,u=this.addConstantDashes(s);for(const n of o){const{geometry:i,index:o,sourceLayerIndex:h}=n;if(u&&this.addFeatureDashes(n,s),this.hasPattern){const e=ku("line",this.layers,n,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(n,i,o,r,s.positions,t.availableImages);l.insert(e[o].feature,i,o,h,this.index)}}addConstantDashes(e){let t=!1;for(const i of this.layers){var r=i.paint.get("line-dasharray").value,n=i.layout.get("line-cap").value;if("constant"!==r.kind||"constant"!==n.kind)t=!0;else{const t=n.value,o=r.value;o&&e.addDash(o,t)}}return t}addFeatureDashes(r,n){var i=this.zoom;for(const s of this.layers){var o=s.paint.get("line-dasharray").value,a=s.layout.get("line-cap").value;if("constant"!==o.kind||"constant"!==a.kind){let e,t;if("constant"===o.kind){if(!(e=o.value))continue}else e=o.evaluate({zoom:i},r);t="constant"===a.kind?a.value:a.evaluate({zoom:i},r),n.addDash(e,t),r.patterns[s.id]=n.getKey(e,t)}}}update(e,t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,n)}addFeatures(e,t,r,n,i){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,yc)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mc),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,r,n,i,o){var a=this.layers[0].layout,s=a.get("line-join").evaluate(e,{}),l=a.get("line-cap").evaluate(e,{}),u=a.get("line-miter-limit"),c=a.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const r of t)this.addLine(r,e,s,l,u,c);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,i,o,n)}addLine(l,u,c,h,f,d){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<l.length-1;e++)this.totalDistance+=l[e].dist(l[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}var p="Polygon"===vc[u.type];let m=l.length;for(;2<=m&&l[m-1].equals(l[m-2]);)m--;let g=0;for(;g<m-1&&l[g].equals(l[g+1]);)g++;if(!(m<(p?3:2))){"bevel"===c&&(f=1.05);var y=this.overscaling<=16?122880/(512*this.overscaling):0,v=this.segments.prepareSegment(10*m,this.layoutVertexArray,this.indexArray);let n,i,o,a,s;this.e1=this.e2=-1,p&&(n=l[m-2],s=l[g].sub(n)._unit()._perp());for(let r=g;r<m;r++)if(!(o=r===m-1?p?l[g+1]:void 0:l[r+1])||!l[r].equals(o)){s&&(a=s),n&&(i=n),n=l[r],s=o?o.sub(n)._unit()._perp():a;let e=(a=a||s).add(s);0===e.x&&0===e.y||e._unit();var _=a.x*s.x+a.y*s.y,x=e.x*s.x+e.y*s.y,b=0!=x?1/x:1/0,w=2*Math.sqrt(2-2*x),x=x<_c&&i&&o,E=0<a.x*s.y-a.y*s.x;if(x&&r>g){const l=n.dist(i);if(l>2*y){const u=n.sub(n.sub(i)._mult(y/l)._round());this.updateDistance(i,u),this.addCurrentVertex(u,a,0,0,v),i=u}}var T=i&&o;let t=T?c:p?"butt":h;if(T&&"round"===t&&(b<d?t="miter":b<=2&&(t="fakeround")),"bevel"===(t="miter"===t&&f<b?"bevel":t)&&(2<b&&(t="flipbevel"),b<f&&(t="miter")),i&&this.updateDistance(i,n),"miter"===t)e._mult(b),this.addCurrentVertex(n,e,0,0,v);else if("flipbevel"===t){if(100<b)e=s.mult(-1);else{const l=b*a.add(s).mag()/a.sub(s).mag();e._perp()._mult(l*(E?-1:1))}this.addCurrentVertex(n,e,0,0,v),this.addCurrentVertex(n,e.mult(-1),0,0,v)}else if("bevel"===t||"fakeround"===t){const l=-Math.sqrt(b*b-1),u=E?l:0,c=E?0:l;if(i&&this.addCurrentVertex(n,a,u,c,v),"fakeround"===t){const l=Math.round(180*w/Math.PI/20);for(let t=1;t<l;t++){let e=t/l;if(.5!==e){const l=e-.5;e+=e*l*(e-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*l*l+(.848013+_*(.215638*_-1.06021)))}const h=s.sub(a)._mult(e)._add(a)._unit()._mult(E?-1:1);this.addHalfVertex(n,h.x,h.y,!1,E,0,v)}}o&&this.addCurrentVertex(n,s,-u,-c,v)}else if("butt"===t)this.addCurrentVertex(n,e,0,0,v);else if("square"===t){const l=i?1:-1;i||this.addCurrentVertex(n,e,l,l,v),this.addCurrentVertex(n,e,0,0,v),i&&this.addCurrentVertex(n,e,l,l,v)}else"round"===t&&(i&&(this.addCurrentVertex(n,a,0,0,v),this.addCurrentVertex(n,a,1,1,v,!0)),o&&(this.addCurrentVertex(n,s,-1,-1,v,!0),this.addCurrentVertex(n,s,0,0,v)));if(x&&r<m-1){const l=n.dist(o);if(l>2*y){const u=n.add(o.sub(n)._mult(y/l)._round());this.updateDistance(n,u),this.addCurrentVertex(u,s,0,0,v),n=u}}}}}addCurrentVertex(e,t,r,n,i,o=!1){var a=t.y*n-t.x,s=-t.y-t.x*n;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,o,!1,r,i),this.addHalfVertex(e,a,s,o,!0,-n,i)}addHalfVertex({x:e,y:t},r,n,i,o,a,s){this.layoutVertexArray.emplaceBack((e<<1)+(i?1:0),(t<<1)+(o?1:0),Math.round(63*r)+128,Math.round(63*n)+128,1+(0===a?0:a<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);e=s.vertexLength++;0<=this.e1&&0<=this.e2&&(this.indexArray.emplaceBack(this.e1,this.e2,e),s.primitiveLength++),o?this.e2=e:this.e1=e}updateScaledDistance(){var e;this.lineClips?(e=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}e(xc,"LineBucket",{omit:["layers","patternFeatures"]});var tn=new Mo({"line-cap":new r(c.layout_line["line-cap"]),"line-join":new r(c.layout_line["line-join"]),"line-miter-limit":new t(c.layout_line["line-miter-limit"]),"line-round-limit":new t(c.layout_line["line-round-limit"]),"line-sort-key":new r(c.layout_line["line-sort-key"])}),bc={paint:new Mo({"line-opacity":new r(c.paint_line["line-opacity"]),"line-color":new r(c.paint_line["line-color"]),"line-translate":new t(c.paint_line["line-translate"]),"line-translate-anchor":new t(c.paint_line["line-translate-anchor"]),"line-width":new r(c.paint_line["line-width"]),"line-gap-width":new r(c.paint_line["line-gap-width"]),"line-offset":new r(c.paint_line["line-offset"]),"line-blur":new r(c.paint_line["line-blur"]),"line-dasharray":new r(c.paint_line["line-dasharray"]),"line-pattern":new r(c.paint_line["line-pattern"]),"line-gradient":new So(c.paint_line["line-gradient"]),"line-trim-offset":new t(c.paint_line["line-trim-offset"])}),layout:tn};const wc=new class extends r{possiblyEvaluate(e,t){return t=new C(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,r,n){return t=_({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,r,n)}}(bc.paint.properties["line-width"].specification);function Ec(e,t){return 0<t?t+2*e:e}wc.useIntegerZoom=!0;const Tc=i([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Sc=i([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Mc=i([{name:"a_projected_pos",components:4,type:"Float32"}],4),kc=(i([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),i([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Cc=i([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]),Ac=(i([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),i([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Ic=i([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);i([{name:"triangle",components:3,type:"Uint16"}]),i([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),i([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),i([{type:"Float32",name:"offsetX"}]),i([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var le=24;const Lc=128;function Pc(r,n){var i=n["expression"];if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new C(r+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:n,interpolationType:s}=i;let e=0;for(;e<n.length&&n[e]<=r;)e++;let t=e=Math.max(0,e-1);for(;t<n.length&&n[t]<r+1;)t++;t=Math.min(n.length-1,t);var o=n[e],a=n[t];return"composite"===i.kind?{kind:"composite",minZoom:o,maxZoom:a,interpolationType:s}:{kind:"camera",minZoom:o,maxZoom:a,minSize:i.evaluate(new C(o)),maxSize:i.evaluate(new C(a)),interpolationType:s}}}function zc(e,{uSize:t,uSizeT:r},{lowerSize:n,upperSize:i}){return"source"===e.kind?n/Lc:"composite"===e.kind?k(n/Lc,i/Lc,r):t}function Dc(e,t){let r=0,n=0;var i,o,a;return"constant"===e.kind?n=e.layoutSize:"source"!==e.kind&&({interpolationType:a,minZoom:i,maxZoom:o}=e,a=a?S($r.interpolationFactor(a,t,i,o),0,1):0,"camera"===e.kind?n=k(e.minSize,e.maxSize,a):r=a),{uSizeT:r,uSize:n}}Qr=Object.freeze({__proto__:null,getSizeData:Pc,evaluateSizeForFeature:zc,evaluateSizeForZoom:Dc,SIZE_PACK_FACTOR:Lc});function Oc(e,r,t){return e.sections.forEach(e=>{e.text=function(e,t){t=r.layout.get("text-transform").evaluate(t,{});return"uppercase"===t?e=e.toLocaleUpperCase():"lowercase"===t&&(e=e.toLocaleLowerCase()),e=go.applyArabicShaping?go.applyArabicShaping(e):e}(e.text,t)}),e}const Rc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};function Fc(e,t,r,n,i){var o,a,s=8*i-n-1,l=(1<<s)-1,u=l>>1,c=-7,h=r?i-1:0,f=r?-1:1,i=e[t+h];for(h+=f,o=i&(1<<-c)-1,i>>=-c,c+=s;0<c;o=256*o+e[t+h],h+=f,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=n;0<c;a=256*a+e[t+h],h+=f,c-=8);if(0===o)o=1-u;else{if(o===l)return a?NaN:1/0*(i?-1:1);a+=Math.pow(2,n),o-=u}return(i?-1:1)*a*Math.pow(2,o-n)}function Bc(e,t,r,n,i,o){var a,s,l=8*o-i-1,u=(1<<l)-1,c=u>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:o-1,d=n?1:-1,o=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(n=Math.pow(2,-a))<1&&(a--,n*=2),2<=(t+=1<=a+c?h/n:h*Math.pow(2,1-c))*n&&(a++,n/=2),u<=a+c?(s=0,a=u):1<=a+c?(s=(t*n-1)*Math.pow(2,i),a+=c):(s=t*Math.pow(2,c-1)*Math.pow(2,i),a=0));8<=i;e[r+f]=255&s,f+=d,s/=256,i-=8);for(a=a<<i|s,l+=i;0<l;e[r+f]=255&a,f+=d,a/=256,l-=8);e[r+f-d]|=128*o}var Nc=a;function a(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}a.Varint=0,a.Fixed64=1,a.Bytes=2,a.Fixed32=5;var jc=4294967296,Uc=1/jc,Vc="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Gc(e){return e.type===a.Bytes?e.readVarint()+e.pos:e.pos+1}function Wc(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Zc(e,t,r){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;e<=i;i--)r.buf[i+n]=r.buf[i]}function qc(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function Hc(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function $c(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function Xc(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function Yc(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function Jc(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function Kc(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function Qc(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function eh(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function th(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function rh(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function nh(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function ih(e,t,r){t.glyphs=[],1===e&&r.readMessage(oh,t)}function oh(e,t,r){if(3===e){const{id:e,bitmap:n,width:i,height:o,left:a,top:s,advance:l}=r.readMessage(ah,{});t.glyphs.push({id:e,bitmap:new Yl({width:i+6,height:o+6},n),metrics:{width:i,height:o,left:a,top:s,advance:l}})}else 4===e?t.ascender=r.readSVarint():5===e&&(t.descender=r.readSVarint())}function ah(e,t,r){1===e?t.id=r.readVarint():2===e?t.bitmap=r.readBytes():3===e?t.width=r.readVarint():4===e?t.height=r.readVarint():5===e?t.left=r.readSVarint():6===e?t.top=r.readSVarint():7===e&&(t.advance=r.readVarint())}function sh(e){let t=0,r=0;for(const n of e)t+=n.w*n.h,r=Math.max(r,n.w);e.sort((e,t)=>t.h-e.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let i=0,o=0;for(const t of e)for(let e=n.length-1;0<=e;e--){const r=n[e];if(!(t.w>r.w||t.h>r.h)){if(t.x=r.x,t.y=r.y,o=Math.max(o,t.y+t.h),i=Math.max(i,t.x+t.w),t.w===r.w&&t.h===r.h){const t=n.pop();e<n.length&&(n[e]=t)}else t.h===r.h?(r.x+=t.w,r.w-=t.w):(t.w!==r.w&&n.push({x:r.x+t.w,y:r.y,w:r.w-t.w,h:t.h}),r.y+=t.h,r.h-=t.h);break}}return{w:i,h:o,fill:t/(i*o)||0}}a.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,o=this.pos;this.type=7&n,e(i,t,this),this.pos===o&&this.skip(n)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=th(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=nh(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=th(this.buf,this.pos)+th(this.buf,this.pos+4)*jc;return this.pos+=8,e},readSFixed64:function(){var e=th(this.buf,this.pos)+nh(this.buf,this.pos+4)*jc;return this.pos+=8,e},readFloat:function(){var e=Fc(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Fc(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t=this.buf,r=127&(i=t[this.pos++]);if(i<128||(r|=(127&(i=t[this.pos++]))<<7,i<128||(r|=(127&(i=t[this.pos++]))<<14,i<128||(r|=(127&(i=t[this.pos++]))<<21,i<128))))return r;var n,i=r|=(15&t[this.pos])<<28,t=e,r=this,e=r.buf,o=(112&(n=e[r.pos++]))>>4;if(n<128)return Wc(i,o,t);if(o|=(127&(n=e[r.pos++]))<<3,n<128)return Wc(i,o,t);if(o|=(127&(n=e[r.pos++]))<<10,n<128)return Wc(i,o,t);if(o|=(127&(n=e[r.pos++]))<<17,n<128)return Wc(i,o,t);if(o|=(127&(n=e[r.pos++]))<<24,n<128)return Wc(i,o,t);if(o|=(1&(n=e[r.pos++]))<<31,n<128)return Wc(i,o,t);throw new Error("Expected varint not more than 10 bytes")},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e,t=this.readVarint()+this.pos,r=this.pos;if(12<=(this.pos=t)-r&&Vc)return e=this.buf,Vc.decode(e.subarray(r,t));for(var n=this.buf,i=t,o="",a=r;a<i;){var s,l,u,c=n[a],h=null,f=239<c?4:223<c?3:191<c?2:1;if(i<a+f)break;1===f?c<128&&(h=c):2===f?128==(192&(s=n[a+1]))&&(h=(31&c)<<6|63&s)<=127&&(h=null):3===f?(l=n[a+2],128==(192&(s=n[a+1]))&&128==(192&l)&&((h=(15&c)<<12|(63&s)<<6|63&l)<=2047||55296<=h&&h<=57343)&&(h=null)):4===f&&(l=n[a+2],u=n[a+3],128==(192&(s=n[a+1]))&&128==(192&l)&&128==(192&u)&&((h=(15&c)<<18|(63&s)<<12|(63&l)<<6|63&u)<=65535||1114112<=h)&&(h=null)),null===h?(h=65533,f=1):65535<h&&(h-=65536,o+=String.fromCharCode(h>>>10&1023|55296),h=56320|1023&h),o+=String.fromCharCode(h),a+=f}return o},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==a.Bytes)return e.push(this.readVarint(t));var r=Gc(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==a.Bytes)return e.push(this.readSVarint());var t=Gc(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==a.Bytes)return e.push(this.readBoolean());var t=Gc(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==a.Bytes)return e.push(this.readFloat());var t=Gc(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==a.Bytes)return e.push(this.readDouble());var t=Gc(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==a.Bytes)return e.push(this.readFixed32());var t=Gc(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==a.Bytes)return e.push(this.readSFixed32());var t=Gc(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==a.Bytes)return e.push(this.readFixed64());var t=Gc(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==a.Bytes)return e.push(this.readSFixed64());var t=Gc(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){e&=7;if(e===a.Varint)for(;127<this.buf[this.pos++];);else if(e===a.Bytes)this.pos=this.readVarint()+this.pos;else if(e===a.Fixed32)this.pos+=4;else{if(e!==a.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t,r=this.length||16;r<this.pos+e;)r*=2;r!==this.length&&((t=new Uint8Array(r)).set(this.buf),this.buf=t,this.length=r)},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),rh(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),rh(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),rh(this.buf,-1&e,this.pos),rh(this.buf,Math.floor(e*Uc),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),rh(this.buf,-1&e,this.pos),rh(this.buf,Math.floor(e*Uc),this.pos+4),this.pos+=8},writeVarint:function(e){if(268435455<(e=+e||0)||e<0){var t,r,n,i,o=this;if(0<=e?(n=e%4294967296|0,t=e/4294967296|0):(t=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:t=t+1|(n=0)),0x10000000000000000<=e||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),n=n,(i=o).buf[i.pos++]=127&n|128,n>>>=7,i.buf[i.pos++]=127&n|128,n>>>=7,i.buf[i.pos++]=127&n|128,n>>>=7,i.buf[i.pos++]=127&n|128,i.buf[i.pos]=127&(n>>>=7),r=(7&(i=t))<<4,(o=o).buf[o.pos++]|=r|((i>>>=3)?128:0),i&&(o.buf[o.pos++]=127&i|((i>>>=7)?128:0),i&&(o.buf[o.pos++]=127&i|((i>>>=7)?128:0),i&&(o.buf[o.pos++]=127&i|((i>>>=7)?128:0),i&&(o.buf[o.pos++]=127&i|((i>>>=7)?128:0),i&&(o.buf[o.pos++]=127&i)))))}else this.realloc(4),this.buf[this.pos++]=127&e|(127<e?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(127<e?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(127<e?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127)))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos,e=(this.pos=function(e,t,r){for(var n,i,o=0;o<t.length;o++){if(55295<(n=t.charCodeAt(o))&&n<57344){if(!i){56319<n||o+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):i=n;continue}if(n<56320){e[r++]=239,e[r++]=191,e[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(e[r++]=239,e[r++]=191,e[r++]=189,i=null);n<128?e[r++]=n:(n<2048?e[r++]=n>>6|192:(n<65536?e[r++]=n>>12|224:(e[r++]=n>>18|240,e[r++]=n>>12&63|128),e[r++]=n>>6&63|128),e[r++]=63&n|128)}return r}(this.buf,e,this.pos),this.pos-t);128<=e&&Zc(t,e,this),this.pos=t-1,this.writeVarint(e),this.pos+=e},writeFloat:function(e){this.realloc(4),Bc(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Bc(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos,e=(e(t,this),this.pos-r);128<=e&&Zc(r,e,this),this.pos=r-1,this.writeVarint(e),this.pos+=e},writeMessage:function(e,t,r){this.writeTag(e,a.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,qc,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Hc,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Yc,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,$c,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Xc,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,Jc,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Kc,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Qc,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,eh,t)},writeBytesField:function(e,t){this.writeTag(e,a.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,a.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,a.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,a.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,a.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,a.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,a.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,a.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,a.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,a.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};class lh{constructor(e,{pixelRatio:t,version:r,stretchX:n,stretchY:i,content:o}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=n,this.stretchY=i,this.content=o,this.version=r}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class uh{constructor(e,t){const r={},n={},i=(this.haveRenderCallbacks=[],[]),{w:o,h:a}=(this.addImages(e,r,i),this.addImages(t,n,i),sh(i)),s=new Jl({width:o||1,height:a||1});for(const t in e){const n=e[t],i=r[t].paddedRect;Jl.copy(n.data,s,{x:0,y:0},{x:i.x+1,y:i.y+1},n.data)}for(const e in t){const r=t[e],i=n[e].paddedRect,o=i.x+1,a=i.y+1,l=r.data.width,u=r.data.height;Jl.copy(r.data,s,{x:0,y:0},{x:o,y:a},r.data),Jl.copy(r.data,s,{x:0,y:u-1},{x:o,y:a-1},{width:l,height:1}),Jl.copy(r.data,s,{x:0,y:0},{x:o,y:a+u},{width:l,height:1}),Jl.copy(r.data,s,{x:l-1,y:0},{x:o-1,y:a},{width:1,height:u}),Jl.copy(r.data,s,{x:0,y:0},{x:o+l,y:a},{width:1,height:u})}this.image=s,this.iconPositions=r,this.patternPositions=n}addImages(e,t,r){for(const o in e){var n=e[o],i={x:0,y:0,w:n.data.width+2,h:n.data.height+2};r.push(i),t[o]=new lh(i,n),n.hasRenderCallback&&this.haveRenderCallbacks.push(o)}}patchUpdatedImages(t,e){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(e=>t.hasImage(e)),t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const r in t.updatedImages)this.patchUpdatedImage(this.iconPositions[r],t.getImage(r),e),this.patchUpdatedImage(this.patternPositions[r],t.getImage(r),e)}patchUpdatedImage(e,t,r){var n;e&&t&&e.version!==t.version&&(e.version=t.version,[e,n]=e.tl,r.update(t.data,void 0,{x:e,y:n}))}}e(lh,"ImagePosition"),e(uh,"ImageAtlas");const ch={horizontal:1,vertical:2,horizontalOnly:3};class hh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){var r=new hh;return r.scale=e||1,r.fontStack=t,r}static forImage(e){var t=new hh;return t.imageName=e,t}}class fh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){var n=new fh;for(let e=0;e<t.sections.length;e++){var i=t.sections[e];i.image?n.addImageSection(i):n.addTextSection(i,r)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(t,r){let n="";for(let e=0;e<t.length;e++){var i=t.charCodeAt(e+1)||null,o=t.charCodeAt(e-1)||null;n+=!r&&(i&&to(i)&&!Rc[t[e+1]]||o&&to(o)&&!Rc[t[e-1]])||!Rc[t[e]]?t[e]:Rc[t[e]]}return n}(this.text,e)}trim(){let t=0;for(let e=0;e<this.text.length&&ph[this.text.charCodeAt(e)];e++)t++;let r=this.text.length;for(let e=this.text.length-1;0<=e&&e>=t&&ph[this.text.charCodeAt(e)];e--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(e,t){var r=new fh;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,t)=>Math.max(e,this.sections[t].scale),0)}addTextSection(t,e){this.text+=t.text,this.sections.push(hh.forText(t.scale,t.fontStack||e));var r=this.sections.length-1;for(let e=0;e<t.text.length;++e)this.sectionIndex.push(r)}addImageSection(e){var t,e=e.image?e.image.name:"";0===e.length?ae("Can't add FormattedSection with an empty image."):(t=this.getNextImageSectionCharCode())?(this.text+=String.fromCharCode(t),this.sections.push(hh.forImage(e)),this.sectionIndex.push(this.sections.length-1)):ae("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?63743<=this.imageSectionID?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function dh(r,n,i,o,e,d,a,s,l,u,t,c,p,h,m){var f=fh.fromFeature(r,e);c===ch.vertical&&f.verticalizePunctuation(p);let g=[];var y=function(t,r,n,i,o){if(!t)return[];var a,s=[],l=function(t,r,e,n,i,o){let a=0;for(let e=0;e<t.length();e++){var s=t.getSection(e);a+=gh(t.getCharCode(e),s,n,i,r,o)}return a/Math.max(1,Math.ceil(a/e))}(t,r,d,n,i,o),u=0<=t.text.indexOf("​");let c=0;for(let e=0;e<t.length();e++){var h=t.getSection(e),f=t.getCharCode(e);if(ph[f]||(c+=gh(f,h,n,i,r,o)),e<t.length()-1){const r=!((a=f)<11904||!(Oi(a)||Di(a)||$i(a)||Zi(a)||Ni(a)||Ci(a)||Ri(a)||Li(a)||ji(a)||Ui(a)||Bi(a)||Ji(a)||Pi(a)||Ii(a)||Ai(a)||Fi(a)||zi(a)||Hi(a)||Gi(a)||Vi(a)));(mh[f]||r||h.imageName)&&s.push(vh(e+1,c,l,s,function(e,t,r){let n=0;return 10===e&&(n-=1e4),r&&(n+=150),40!==e&&65288!==e||(n+=50),41!==t&&65289!==t||(n+=50),n}(f,t.getCharCode(e+1),r&&u),!1))}}return function e(t){return t?e(t.priorBreak).concat(t.index):[]}(vh(t.length(),c,l,s,0,!0))}(f,u,n,o,h),{processBidirectionalText:e,processStyledBidirectionalText:h}=go;if(e&&1===f.sections.length){const r=e(f.toString(),y);for(const n of r){const r=new fh;r.text=n,r.sections=f.sections;for(let e=0;e<n.length;e++)r.sectionIndex.push(0);g.push(r)}}else if(h){const r=h(f.text,f.sectionIndex,y);for(const n of r){const r=new fh;r.text=n[0],r.sectionIndex=n[1],r.sections=f.sections,g.push(r)}}else g=function(e){const t=[],r=e.text;let n=0;for(const r of y)t.push(e.substring(n,r)),n=r;return n<r.length&&t.push(e.substring(n,r.length)),t}(f);var v,_=[],r={positionedLines:_,text:f.toString(),top:t[1],bottom:t[1],left:t[0],right:t[0],writingMode:c,iconsInText:!1,verticalizable:!1,hasBaseline:!1};{var x=r,b=n,w=i,E=o,T=g,S=a,M=s,k=l,R=c,C=u,A=p,F=m;let h=0,f=0,e=0;const P="right"===k?1:"left"===k?0:.5;let d=!1;for(const x of T){const w=x.getSections();for(const x of w)if(!x.imageName){const w=b[x.fontStack];if(w&&!(d=void 0!==w.ascender&&void 0!==w.descender))break}if(!d)break}let t=0;for(const M of T){M.trim();const T=M.getMaxScale(),k=(T-1)*le,z={positionedGlyphs:[],lineOffset:0},D=(x.positionedLines[t]=z).positionedGlyphs;let c=0;if(M.length()){let l=0,u=0;for(let s=0;s<M.length();s++){const k=M.getSection(s),e=M.getSectionIndex(s),P=M.getCharCode(s);let t=k.scale,r=null,n=null,i=null,o=le,a=0;v=!(R===ch.horizontal||!A&&!eo(P)||A&&(ph[P]||(v=P,Si(v)||Mi(v)||ki(v)||qi(v)||Yi(v))));if(k.imageName){const b=E[k.imageName];if(!b)continue;i=k.imageName,x.iconsInText=x.iconsInText||!0,n=b.paddedRect;const w=b.displaySize,S=(t=t*le/F,r={width:w[0],height:w[1],left:1,top:-3,advance:v?w[1]:w[0],localGlyph:!1},a=d?-r.height*t:T*le-17-w[1]*t,o=r.advance,(v?w[0]:w[1])*t-le*T);0<S&&S>c&&(c=S)}else{const x=w[k.fontStack];if(!x)continue;x[P]&&(n=x[P]);const E=b[k.fontStack];if(!E)continue;const S=E.glyphs[P];if(!S)continue;if(r=S.metrics,o=8203!==P?le:0,d){const x=void 0!==E.ascender?Math.abs(E.ascender):0,b=void 0!==E.descender?Math.abs(E.descender):0,w=(x+b)*t;l<w&&(l=w,u=(x-b)/2*t),a=-x*t}else a=(T-t)*le-17}v?(x.verticalizable=!0,D.push({glyph:P,imageName:i,x:h,y:f+a,vertical:v,scale:t,localGlyph:r.localGlyph,fontStack:k.fontStack,sectionIndex:e,metrics:r,rect:n}),h+=o*t+C):(D.push({glyph:P,imageName:i,x:h,y:f+a,vertical:v,scale:t,localGlyph:r.localGlyph,fontStack:k.fontStack,sectionIndex:e,metrics:r,rect:n}),h+=r.advance*t+C)}0!==D.length&&(e=Math.max(h-C,e),d?xh(D,P,c,u,S*T/2):xh(D,P,c,0,S/2)),h=0;var B=S*T+c;z.lineOffset=Math.max(c,k),f+=B}else f+=S;++t}const z=f,{horizontalAlign:D,verticalAlign:O}=_h(M);var I=x.positionedLines,L=P,k=D,N=(L-k)*e,j=-z*O;for(const L of I)for(const I of L.positionedGlyphs)I.x+=N,I.y+=j;x.top+=-O*z,x.bottom=x.top+z,x.left+=-D*e,x.right=x.left+e,x.hasBaseline=d}return!function(){for(const e of _)if(0!==e.positionedGlyphs.length)return;return 1}()&&r}const ph={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},mh={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function gh(e,t,r,n,i,o){if(t.imageName){const e=n[t.imageName];return e?e.displaySize[0]*t.scale*le/o+i:0}{const n=r[t.fontStack],o=n&&n.glyphs[e];return o?o.metrics.advance*t.scale+i:0}}function yh(e,t,r,n){var i=Math.pow(e-t,2);return n?e<t?i/2:2*i:i+Math.abs(r)*r}function vh(e,t,r,n,i,o){let a=null,s=yh(t,r,i,o);for(const e of n){const n=yh(t-e.x,r,i,o)+e.badness;n<=s&&(a=e,s=n)}return{index:e,x:t,priorBreak:a,badness:s}}function _h(e){let t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function xh(t,e,r,n,i){if(e||r||n||i){var o=t.length-1,a=t[o],s=(a.x+a.metrics.advance*a.scale)*e;for(let e=0;e<=o;e++)t[e].x-=s,t[e].y+=r+n+i}}function bh(e,t,r,n,i,o){var a=e.image;let s;if(a.content){const e=a.content,t=a.pixelRatio||1;s=[e[0]/t,e[1]/t,a.displaySize[0]-e[2]/t,a.displaySize[1]-e[3]/t]}var e=t.left*o,l=t.right*o;let u,c,h,f;c="width"===r||"both"===r?(f=i[0]+e-n[3],i[0]+l+n[1]):(f=i[0]+(e+l-a.displaySize[0])/2)+a.displaySize[0];e=t.top*o,l=t.bottom*o;return h="height"===r||"both"===r?(u=i[1]+e-n[0],i[1]+l+n[2]):(u=i[1]+(e+l-a.displaySize[1])/2)+a.displaySize[1],{image:a,top:u,right:c,bottom:h,left:f,collisionPadding:s}}class wh extends I{constructor(e,t,r,n,i){super(e,t),this.angle=n,this.z=r,void 0!==i&&(this.segment=i)}clone(){return new wh(this.x,this.y,this.z,this.angle,this.segment)}}function Eh(i,o,a,s,l){if(void 0!==o.segment){let e=o,t=o.segment+1,r=0;for(;r>-a/2;){if(--t<0)return;r-=i[t].dist(e),e=i[t]}r+=i[t].dist(i[t+1]),t++;var u=[];let n=0;for(;r<a/2;){const o=i[t],a=i[t+1];if(!a)return;var c=i[t-1].angleTo(o)-o.angleTo(a),c=Math.abs((c+3*Math.PI)%(2*Math.PI)-Math.PI);for(u.push({distance:r,angleDelta:c}),n+=c;r-u[0].distance>s;)n-=u.shift().angleDelta;if(n>l)return;t++,r+=o.dist(a)}}return 1}function Th(t){let r=0;for(let e=0;e<t.length-1;e++)r+=t[e].dist(t[e+1]);return r}function Sh(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Mh(e,t,r,n,i,o,a,s,l){var u=n?.6*o*a:0,n=Sh(n,i),i=n*a,c=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-i<t/4&&(t=i+t/4),function e(t,r,n,i,o,a,s,l,u){const c=a/2,h=Th(t);let f=0,d=r-n,p=[];for(let e=0;e<t.length-1;e++){const s=t[e],l=t[e+1],m=s.dist(l),g=l.angleTo(s);for(;d+n<f+m;){const y=((d+=n)-f)/m,v=k(s.x,l.x,y),_=k(s.y,l.y,y);if(0<=v&&v<u&&0<=_&&_<u&&0<=d-c&&d+c<=h){const n=new wh(v,_,0,g,e);n._round(),i&&!Eh(t,n,a,i,o)||p.push(n)}}f+=m}return l||p.length||s||(p=e(t,f/2,n,i,o,a,s,!0,u)),p}(e,c?t/2*s%t:(n/2+2*o)*a*s%t,t,u,r,i,c,!1,l)}function kh(t,i,o,a,s){var l=[];for(let e=0;e<t.length;e++){var u=t[e];let n;for(let r=0;r<u.length-1;r++){let e=u[r],t=u[r+1];e.x<i&&t.x<i||(e.x<i?e=new I(i,e.y+(i-e.x)/(t.x-e.x)*(t.y-e.y))._round():t.x<i&&(t=new I(i,e.y+(i-e.x)/(t.x-e.x)*(t.y-e.y))._round()),e.y<o&&t.y<o||(e.y<o?e=new I(e.x+(o-e.y)/(t.y-e.y)*(t.x-e.x),o)._round():t.y<o&&(t=new I(e.x+(o-e.y)/(t.y-e.y)*(t.x-e.x),o)._round()),e.x>=a&&t.x>=a||(e.x>=a?e=new I(a,e.y+(a-e.x)/(t.x-e.x)*(t.y-e.y))._round():t.x>=a&&(t=new I(a,e.y+(a-e.x)/(t.x-e.x)*(t.y-e.y))._round()),e.y>=s&&t.y>=s||(e.y>=s?e=new I(e.x+(s-e.y)/(t.y-e.y)*(t.x-e.x),s)._round():t.y>=s&&(t=new I(e.x+(s-e.y)/(t.y-e.y)*(t.x-e.x),s)._round()),n&&e.equals(n[n.length-1])||(n=[e],l.push(n)),n.push(t)))))}}return l}e(wh,"Anchor");const Ch=1e20;function Ah(t,r,n,i,o,a,s,l,u){for(let e=r;e<r+i;e++)Ih(t,n*a+e,a,o,s,l,u);for(let e=n;e<n+o;e++)Ih(t,e*a+r,1,i,s,l,u)}function Ih(n,i,o,a,s,l,u){u[l[0]=0]=-Ch,u[1]=Ch,s[0]=n[i];for(let e=1,t=0,r=0;e<a;e++){s[e]=n[i+e*o];const a=e*e;do{const n=l[t];r=(s[e]-s[n]+a-n*n)/(e-n)/2}while(r<=u[t]&&-1<--t);l[++t]=e,u[t]=r,u[t+1]=Ch}for(let e=0,t=0;e<a;e++){for(;u[t+1]<e;)t++;const a=l[t],r=e-a;n[i+e*o]=s[a]+r*r}}const Lh={none:0,ideographs:1,all:2};class Ph{constructor(e,t,r){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=r,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){var t=[];for(const i in e)for(const r of e[i])t.push({stack:i,id:r});J(t,({stack:r,id:i},o)=>{let a=this.entries[r];var e=(a=a||(this.entries[r]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0})).glyphs[i];if(void 0!==e)o(null,{stack:r,id:i,glyph:e});else if(e=this._tinySDF(a,r,i))a.glyphs[i]=e,o(null,{stack:r,id:i,glyph:e});else{const s=Math.floor(i/256);if(65535<256*s)o(new Error("glyphs > 65535 not supported"));else if(a.ranges[s])o(null,{stack:r,id:i,glyph:e});else{let n=a.requests[s];n||(n=a.requests[s]=[],Ph.loadGlyphRange(r,s,this.url,this.requestManager,(e,t)=>{if(t){a.ascender=t.ascender,a.descender=t.descender;for(const e in t.glyphs)this._doesCharSupportLocalGlyph(+e)||(a.glyphs[+e]=t.glyphs[+e]);a.ranges[s]=!0}for(const r of n)r(e,t);delete a.requests[s]})),n.push((e,t)=>{e?o(e):t&&o(null,{stack:r,id:i,glyph:t.glyphs[i]||null})})}}},(e,t)=>{if(e)i(e);else if(t){const e={};for(const{stack:i,id:r,glyph:n}of t)void 0===e[i]&&(e[i]={}),void 0===e[i].glyphs&&(e[i].glyphs={}),e[i].glyphs[r]=n&&{id:n.id,bitmap:n.bitmap.clone(),metrics:n.metrics},e[i].ascender=this.entries[i].ascender,e[i].descender=this.entries[i].descender;i(null,e)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Lh.none&&(this.localGlyphMode===Lh.all?!!this.localFontFamily:!!this.localFontFamily&&(Ui(e)||Wi(e)||Pi(e)||zi(e)||Li(e)))}_tinySDF(r,n,e){var i,o,a,s,l,u=this.localFontFamily;if(u&&this._doesCharSupportLocalGlyph(e)){let t=r.tinySDF;if(!t){let e="400";/bold/i.test(n)?e="900":/medium/i.test(n)?e="500":/light/i.test(n)&&(e="200"),(t=r.tinySDF=new Ph.TinySDF({fontFamily:u,fontWeight:e,fontSize:48,buffer:6,radius:16})).fontWeight=e}return this.localGlyphs[t.fontWeight][e]||(n=String.fromCharCode(e),{data:r,width:u,height:n,glyphWidth:i,glyphHeight:o,glyphLeft:a,glyphTop:s,glyphAdvance:l}=t.draw(n),this.localGlyphs[t.fontWeight][e]={id:e,bitmap:new Yl({width:u,height:n},r),metrics:{width:i/2,height:o/2,left:a/2,top:s/2-27,advance:l/2,localGlyph:!0}})}}}function zh(d,p,m,t){const r=[],g=d.image,y=g.pixelRatio,e=g.paddedRect.w-2,n=g.paddedRect.h-2,v=d.right-d.left,_=d.bottom-d.top,i=g.stretchX||[[0,e]],o=g.stretchY||[[0,n]],a=(e,t)=>e+t[1]-t[0],x=i.reduce(a,0),b=o.reduce(a,0),s=e-x,l=n-b;let w=0,E=x,T=0,S=b,M=0,k=s,C=0,A=l;if(g.content&&t){const d=g.content;w=Dh(i,0,d[0]),T=Dh(o,0,d[1]),E=Dh(i,d[0],d[2]),S=Dh(o,d[1],d[3]),M=d[0]-w,C=d[1]-T,k=d[2]-d[0]-E,A=d[3]-d[1]-S}var u=(e,t,r,n)=>{var i=(e.stretch-w)/E*v+d.left,o=e.fixed-M-k*e.stretch/x,a=(t.stretch-T)/S*_+d.top,s=t.fixed-C-A*t.stretch/b,l=(r.stretch-w)/E*v+d.left,u=r.fixed-M-k*r.stretch/x,c=(n.stretch-T)/S*_+d.top,h=n.fixed-C-A*n.stretch/b,f=new I(i,a),a=new I(l,a),l=new I(l,c),i=new I(i,c),c=new I(o/y,s/y),o=new I(u/y,h/y),s=p*Math.PI/180;if(s){const d=Math.sin(s),p=Math.cos(s),m=[p,-d,d,p];f._matMult(m),a._matMult(m),i._matMult(m),l._matMult(m)}u=e.stretch+e.fixed,h=t.stretch+t.fixed;return{tl:f,tr:a,bl:i,br:l,tex:{x:g.paddedRect.x+1+u,y:g.paddedRect.y+1+h,w:r.stretch+r.fixed-u,h:n.stretch+n.fixed-h},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:c,pixelOffsetBR:o,minFontScaleX:k/y/v,minFontScaleY:A/y/_,isSDF:m}};if(t&&(g.stretchX||g.stretchY)){const d=Oh(i,s,x),p=Oh(o,l,b);for(let e=0;e<d.length-1;e++){const t=d[e],g=d[e+1];for(let e=0;e<p.length-1;e++)r.push(u(t,p[e],g,p[e+1]))}}else r.push(u({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:1+e},{fixed:0,stretch:1+n}));return r}function Dh(e,t,r){let n=0;for(const i of e)n+=Math.max(t,Math.min(r,i[1]))-Math.max(t,Math.min(r,i[0]));return n}function Oh(e,t,r){var n=[{fixed:-1,stretch:0}];for(const[t,r]of e){const e=n[n.length-1];n.push({fixed:t-e.stretch,stretch:e.stretch}),n.push({fixed:t-e.stretch,stretch:e.stretch+(r-t)})}return n.push({fixed:t+1,stretch:r}),n}Ph.loadGlyphRange=function(e,t,r,n,i){var t=256*t,o=255+t,n=n.transformRequest(n.normalizeGlyphsURL(r).replace("{fontstack}",e).replace("{range}",t+"-"+o),Ie.Glyphs);ze(n,(e,t)=>{if(e)i(e);else if(t){const e={},r=new Nc(t).readFields(ih,{});for(const t of r.glyphs)e[t.id]=t;i(null,{glyphs:e,ascender:r.ascender,descender:r.descender})}})},Ph.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:r=8,cutoff:n=.25,fontFamily:i="sans-serif",fontWeight:o="normal",fontStyle:a="normal"}={}){this.buffer=t,this.cutoff=n,this.radius=r;n=this.size=e+4*t,r=this._createCanvas(n),t=this.ctx=r.getContext("2d",{willReadFrequently:!0});t.font=a+` ${o} ${e}px `+i,t.textBaseline="alphabetic",t.textAlign="left",t.fillStyle="black",this.gridOuter=new Float64Array(n*n),this.gridInner=new Float64Array(n*n),this.f=new Float64Array(n),this.z=new Float64Array(n+1),this.v=new Uint16Array(n)}_createCanvas(e){var t=document.createElement("canvas");return t.width=t.height=e,t}draw(r){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:e,actualBoundingBoxRight:o}=this.ctx.measureText(r),a=Math.ceil(n),s=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-e))),l=Math.min(this.size-this.buffer,a+Math.ceil(i)),u=s+2*this.buffer,c=l+2*this.buffer,h=Math.max(u*c,0),f=new Uint8ClampedArray(h),d={data:f,width:u,height:c,glyphWidth:s,glyphHeight:l,glyphTop:a,glyphLeft:0,glyphAdvance:t};if(0!==s&&0!==l){var{ctx:p,buffer:m,gridInner:g,gridOuter:y}=this,v=(p.clearRect(m,m,s,l),p.fillText(r,m,m+a),p.getImageData(m,m,s,l));y.fill(Ch,0,h),g.fill(0,0,h);for(let t=0;t<l;t++)for(let e=0;e<s;e++){const n=v.data[4*(t*s+e)+3]/255;if(0!=n){const i=(t+m)*u+e+m;if(1==n)y[i]=0,g[i]=Ch;else{const r=.5-n;y[i]=0<r?r*r:0,g[i]=r<0?r*r:0}}}Ah(y,0,0,u,c,u,this.f,this.v,this.z),Ah(g,m,m,s,l,u,this.f,this.v,this.z);for(let e=0;e<h;e++){const t=Math.sqrt(y[e])-Math.sqrt(g[e]);f[e]=Math.round(255-255*(t/this.radius+this.cutoff))}}return d}};class Rh{constructor(e=[],t=Fh){if(this.data=e,this.length=this.data.length,this.compare=t,0<this.length)for(let e=(this.length>>1)-1;0<=e;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){var e,t;if(0!==this.length)return e=this.data[0],t=this.data.pop(),this.length--,0<this.length&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){for(var{data:t,compare:r}=this,n=t[e];0<e;){var i=e-1>>1,o=t[i];if(0<=r(n,o))break;t[e]=o,e=i}t[e]=n}_down(r){for(var{data:n,compare:i}=this,e=this.length>>1,o=n[r];r<e;){let e=1+(r<<1),t=n[e];var a=e+1;if(a<this.length&&i(n[a],t)<0&&(e=a,t=n[a]),0<=i(t,o))break;n[r]=t,r=e}n[r]=o}}function Fh(e,t){return e<t?-1:t<e?1:0}function Bh(e,t){return t.max-e.max}function Nh(e,t,r,n){this.p=new I(e,t),this.h=r,this.d=function(n,t){let i=!1,o=1/0;for(let e=0;e<t.length;e++){var a=t[e];for(let e=0,t=a.length,r=t-1;e<t;r=e++){var s=a[e],l=a[r];s.y>n.y!=l.y>n.y&&n.x<(l.x-s.x)*(n.y-s.y)/(l.y-s.y)+s.x&&(i=!i),o=Math.min(o,Dl(n,s,l))}}return(i?1:-1)*Math.sqrt(o)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}const jh=Number.POSITIVE_INFINITY,Uh=Math.sqrt(2);function Vh(e,[t,r]){let n=0,i=0;if(r===jh){const r=(t=t<0?0:t)/Uh;switch(e){case"top-right":case"top-left":i=r-7;break;case"bottom-right":case"bottom-left":i=7-r;break;case"bottom":i=7-t;break;case"top":i=t-7}switch(e){case"top-right":case"bottom-right":n=-r;break;case"top-left":case"bottom-left":n=r;break;case"left":n=t;break;case"right":n=-t}}else{switch(t=Math.abs(t),r=Math.abs(r),e){case"top-right":case"top-left":case"top":i=r-7;break;case"bottom-right":case"bottom-left":case"bottom":i=7-r}switch(e){case"top-right":case"bottom-right":case"right":n=-t;break;case"top-left":case"bottom-left":case"left":n=t}}return[n,i]}function Gh(n,i,o,a,s,l,u,c,h,f){n.createArrays(),n.tilePixelRatio=se/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const d=n.layers[0].layout,p=n.layers[0]._unevaluatedLayout._values,m={};if("composite"===n.textSizeData.kind){const{minZoom:i,maxZoom:o}=n.textSizeData;m.compositeTextSizes=[p["text-size"].possiblyEvaluate(new C(i),c),p["text-size"].possiblyEvaluate(new C(o),c)]}if("composite"===n.iconSizeData.kind){const{minZoom:i,maxZoom:o}=n.iconSizeData;m.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new C(i),c),p["icon-size"].possiblyEvaluate(new C(o),c)]}m.layoutTextSize=p["text-size"].possiblyEvaluate(new C(h+1),c),m.layoutIconSize=p["icon-size"].possiblyEvaluate(new C(h+1),c),m.textMaxSize=p["text-size"].possiblyEvaluate(new C(18),c);const g="map"===d.get("text-rotation-alignment")&&"point"!==d.get("symbol-placement"),y=d.get("text-size");for(const l of n.features){const h=d.get("text-font").evaluate(l,{},c).join(","),p=y.evaluate(l,{},c),_=m.layoutTextSize.evaluate(l,{},c),x=(m.layoutIconSize.evaluate(l,{},c),{horizontal:{},vertical:void 0}),b=l.text;let e,r=[0,0];if(b){const a=b.toString(),u=d.get("text-letter-spacing").evaluate(l,{},c)*le,f=d.get("text-line-height").evaluate(l,{},c)*le,m=Qi(a)?u:0,y=d.get("text-anchor").evaluate(l,{},c),w=d.get("text-variable-anchor");if(!w){const n=d.get("text-radial-offset").evaluate(l,{},c);r=n?Vh(y,[n*le,jh]):d.get("text-offset").evaluate(l,{},c).map(e=>e*le)}let e=g?"center":d.get("text-justify").evaluate(l,{},c);const E="point"===d.get("symbol-placement"),T=E?d.get("text-max-width").evaluate(l,{},c)*le:1/0,S=e=>{n.allowVerticalPlacement&&Ki(a)&&(x.vertical=dh(b,i,o,s,h,T,f,y,e,m,r,ch.vertical,!0,_,p))};if(!g&&w){const n="auto"===e?w.map(e=>Wh(e)):[e];let t=!1;for(let e=0;e<n.length;e++){const u=n[e];if(!x.horizontal[u])if(t)x.horizontal[u]=x.horizontal[0];else{const n=dh(b,i,o,s,h,T,f,"center",u,m,r,ch.horizontal,!1,_,p);n&&(x.horizontal[u]=n,t=1===n.positionedLines.length)}}S("left")}else{if("auto"===e&&(e=Wh(y)),E||0<=d.get("text-writing-mode").indexOf("horizontal")||!Ki(a)){const n=dh(b,i,o,s,h,T,f,y,e,m,r,ch.horizontal,!1,_,p);n&&(x.horizontal[e]=n)}S(E?"left":e)}}let t=!1;if(l.icon&&l.icon.name){const i=a[l.icon.name];i&&(e=function(e,t,r){var{horizontalAlign:r,verticalAlign:n}=_h(r),r=t[0]-e.displaySize[0]*r,t=t[1]-e.displaySize[1]*n;return{image:e,top:t,bottom:t+e.displaySize[1],left:r,right:r+e.displaySize[0]}}(s[l.icon.name],d.get("icon-offset").evaluate(l,{},c),d.get("icon-anchor").evaluate(l,{},c)),t=i.sdf,void 0===n.sdfIcons?n.sdfIcons=i.sdf:n.sdfIcons!==i.sdf&&ae("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),i.pixelRatio===n.pixelRatio&&0===d.get("icon-rotate").constantOr(1)||(n.iconsNeedLinear=!0))}var v=Hh(x.horizontal)||x.vertical;n.iconsInText||(n.iconsInText=!!v&&v.iconsInText),(v||e)&&function(W,Z,q,H,$,X,e,Y,J,K,Q,t){let r=X.textMaxSize.evaluate(Z,{},Q);void 0===r&&(r=e);const n=W.layers[0].layout,ee=n.get("icon-offset").evaluate(Z,{},Q),i=Hh(q.horizontal)||q.vertical,o="globe"===t.name,a=e/24,s=W.tilePixelRatio*r/24,l=(e=W.overscaling,18<W.zoom&&2<e&&(e>>=1),Math.max(se/(512*e),1)*n.get("symbol-spacing")),te=n.get("text-padding")*W.tilePixelRatio,re=n.get("icon-padding")*W.tilePixelRatio,u=M(n.get("text-max-angle")),ne="map"===n.get("text-rotation-alignment")&&"point"!==n.get("symbol-placement"),ie="map"===n.get("icon-rotation-alignment")&&"point"!==n.get("symbol-placement"),c=n.get("symbol-placement"),h=l/2;e=n.get("icon-text-fit");let oe;H&&"none"!==e&&(W.allowVerticalPlacement&&q.vertical&&(oe=bh(H,q.vertical,e,n.get("icon-text-fit-padding"),ee,a)),i&&(H=bh(H,i,e,n.get("icon-text-fit-padding"),ee,a)));var f=(y,v,_)=>{if(!(v.x<0||v.x>=se||v.y<0||v.y>=se)){let g=null;if(o){const{x:W,y:Z,z:q}=t.projectTilePoint(v.x,v.y,_);g={anchor:new wh(W,Z,q,0,void 0),up:t.upVector(_,v.x,v.y)}}{var x=W;var b=v;var w=g;var E=y;var T=q;var S=H;var M=$;var k=oe;var C=W.layers[0];var A=W.collisionBoxArray;var I=Z.index;var L=Z.sourceLayerIndex;var P=W.index;var z=te;var D=ne;var O=Y;_=re;v=ie;y=ee;var R=Z;var F=X;var B=J;var N=K;var j=Q;var U=x.addToLineVertexArray(b,E);let e,t,r,n,i,o,a,s=0,l=0,u=0,c=0,h=-1,f=-1;var V={};let d=ma("");var G=w?w.anchor:b;let p=0,m=0;if(void 0===C._unevaluatedLayout.getValue("text-radial-offset")?[p,m]=C.layout.get("text-offset").evaluate(R,{},j).map(e=>e*le):(p=C.layout.get("text-radial-offset").evaluate(R,{},j)*le,m=jh),x.allowVerticalPlacement&&T.vertical){const x=T.vertical;if(D)o=Xh(x),k&&(a=Xh(k));else{const w=C.layout.get("text-rotate").evaluate(R,{},j)+90;r=$h(A,G,b,I,L,P,x,z,w,O),k&&(n=$h(A,G,b,I,L,P,k,_,w))}}if(S){const E=C.layout.get("icon-rotate").evaluate(R,{},j),T="none"!==C.layout.get("icon-text-fit"),M=zh(S,E,B,T),z=k?zh(k,E,B,T):void 0,D=(t=$h(A,G,b,I,L,P,S,_,E),s=4*M.length,x.iconSizeData);let e=null;"source"===D.kind?(e=[Lc*C.layout.get("icon-size").evaluate(R,{},j)])[0]>Zh&&ae(x.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):"composite"===D.kind&&(((e=[Lc*F.compositeIconSizes[0].evaluate(R,{},j),Lc*F.compositeIconSizes[1].evaluate(R,{},j)])[0]>Zh||e[1]>Zh)&&ae(x.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".')),x.addSymbols(x.icon,M,e,y,v,R,!1,w,b,U.lineStartIndex,U.lineLength,-1,N,j),h=x.icon.placedSymbolArray.length-1,z&&(l=4*z.length,x.addSymbols(x.icon,z,e,y,v,R,ch.vertical,w,b,U.lineStartIndex,U.lineLength,-1,N,j),f=x.icon.placedSymbolArray.length-1)}for(const E in T.horizontal){const S=T.horizontal[E],k=(e||(d=ma(S.text),D?i=Xh(S):e=$h(A,G,b,I,L,P,S,z,C.layout.get("text-rotate").evaluate(R,{},j),O)),1===S.positionedLines.length);if(u+=qh(x,w,b,S,M,C,D,R,O,U,T.vertical?ch.horizontal:ch.horizontalOnly,k?Object.keys(T.horizontal):[E],V,h,F,N,j),k)break}T.vertical&&(c+=qh(x,w,b,T.vertical,M,C,D,R,O,U,ch.vertical,["vertical"],V,f,F,N,j));E=(e,t)=>e?Math.max(e,t):t,k=E(i,-1),k=E(o,k),B=-1<(k=E(a,k))?1:0;x.glyphOffsetArray.length>=Cf.MAX_GLYPHS&&ae("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==R.sortKey&&x.addToSortKeyRanges(x.symbolInstances.length,R.sortKey),x.symbolInstances.emplaceBack(G.x,G.y,G.z,b.x,b.y,0<=V.right?V.right:-1,0<=V.center?V.center:-1,0<=V.left?V.left:-1,0<=V.vertical?V.vertical:-1,h,f,d,void 0!==e?e:x.collisionBoxArray.length,void 0!==e?e+1:x.collisionBoxArray.length,void 0!==r?r:x.collisionBoxArray.length,void 0!==r?r+1:x.collisionBoxArray.length,void 0!==t?t:x.collisionBoxArray.length,void 0!==t?t+1:x.collisionBoxArray.length,n||x.collisionBoxArray.length,n?n+1:x.collisionBoxArray.length,I,u,c,s,l,B,0,p,m,k)}}};if("line"===c)for(const $ of kh(Z.geometry,0,0,se,se)){const Z=Mh($,l,u,q.vertical||i,H,24,s,W.overscaling,se);for(const q of Z){const Z=i;Z&&function(t,e,r,n){var i=t.compareText;if(e in i){const t=i[e];for(let e=t.length-1;0<=e;e--)if(n.dist(t[e])<r)return 1}else i[e]=[];return i[e].push(n),0}(W,Z.text,h,q)||f($,q,Q)}}else if("line-center"===c){for(const W of Z.geometry)if(1<W.length){const Z=function(t,r,e,n,i,o){var a=e?.6*i*o:0,s=Sh(e,n)*o;let l=0;var u,c,h=Th(t)/2;for(let e=0;e<t.length-1;e++){const n=t[e],i=t[e+1],o=n.dist(i);if(l+o>h)return u=(h-l)/o,c=k(n.x,i.x,u),u=k(n.y,i.y,u),c=new wh(c,u,0,i.angleTo(n),e),!a||Eh(t,c,s,a,r)?c:void 0;l+=o}}(W,u,q.vertical||i,H,24,s);Z&&f(W,Z,Q)}}else if("Polygon"===Z.type)for(const W of Tu(Z.geometry,0)){const Z=function(r,t,e=!1){let n=1/0,i=1/0,o=-1/0,a=-1/0;var s=r[0];for(let e=0;e<s.length;e++){const t=s[e];(!e||t.x<n)&&(n=t.x),(!e||t.y<i)&&(i=t.y),(!e||t.x>o)&&(o=t.x),(!e||t.y>a)&&(a=t.y)}var l=Math.min(o-n,a-i);let u=l/2;var c=new Rh([],Bh);if(0===l)return new I(n,i);for(let t=n;t<o;t+=l)for(let e=i;e<a;e+=l)c.push(new Nh(t+u,e+u,u,r));let h=function(e){let n=0,i=0,o=0;var a=e[0];for(let e=0,t=a.length,r=t-1;e<t;r=e++){var s=a[e],l=a[r],u=s.x*l.y-l.x*s.y;i+=(s.x+l.x)*u,o+=(s.y+l.y)*u,n+=3*u}return new Nh(i/n,o/n,0,e)}(r),f=c.length;for(;c.length;){const n=c.pop();(n.d>h.d||!h.d)&&(h=n,e&&console.log("found best %d after %d probes",Math.round(1e4*n.d)/1e4,f)),n.max-h.d<=t||(u=n.h/2,c.push(new Nh(n.p.x-u,n.p.y-u,u,r)),c.push(new Nh(n.p.x+u,n.p.y-u,u,r)),c.push(new Nh(n.p.x-u,n.p.y+u,u,r)),c.push(new Nh(n.p.x+u,n.p.y+u,u,r)),f+=4)}return e&&(console.log("num probes: "+f),console.log("best distance: "+h.d)),h.p}(W,16);f(W[0],new wh(Z.x,Z.y,0,0,void 0),Q)}else if("LineString"===Z.type)for(const W of Z.geometry)f(W,new wh(W[0].x,W[0].y,0,0,void 0),Q);else if("Point"===Z.type)for(const W of Z.geometry)for(const Z of W)f([Z],new wh(Z.x,Z.y,0,0,void 0),Q)}(n,l,x,e,a,m,_,r,t,u,c,f)}l&&n.generateCollisionDebugBuffers(h,n.collisionBoxArray)}function Wh(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}const Zh=32640;function qh(e,t,r,n,i,o,a,s,l,u,c,h,f,d,p,m,g){n=function(f,d,p,m,t,g,y){var v=[];if(0!==f.positionedLines.length){var r,_=p.layout.get("text-rotate").evaluate(t,{})*Math.PI/180,x=(p=d[0],t=d[1],0<(r=p*t)?[p,-t]:r<0?[-p,t]:0===p?[t,p]:[t,-p]);let e=Math.abs(f.top-f.bottom);for(const C of f.positionedLines)e-=C.lineOffset;var n,i,o,a,s,l=f.positionedLines.length,u=e/l;let h=f.top-d[1];for(let e=0;e<l;++e){const p=f.positionedLines[e];h=(n=f,i=u,o=h,a=e,s=void 0,s=i+n.positionedLines[a].lineOffset,0===a?o+s/2:o+(s+(i+n.positionedLines[a-1].lineOffset))/2);for(const C of p.positionedGlyphs)if(C.rect){const p=C.rect||{};let s=4,l=!0,u=1,c=0;if(C.imageName){const f=g[C.imageName];if(!f)continue;if(f.sdf){ae("SDF images are not supported in formatted text and will be ignored.");continue}l=!1,u=f.pixelRatio,s=1/u}var b=(m||y)&&C.vertical,w=C.metrics.advance*C.scale/2,E=C.metrics,T=C.rect;if(null!==T){y&&f.verticalizable&&(c=C.imageName?w-C.metrics.width*C.scale/2:0);var S=m?[C.x+w,C.y]:[0,0];let e=[0,0],t=[0,0],r=!1;m||(b?(t=[C.x+w+x[0],C.y+x[1]-c],r=!0):e=[C.x+w+d[0],C.y+d[1]-c]);var M=T.w*C.scale/(u*(C.localGlyph?2:1)),k=T.h*C.scale/(u*(C.localGlyph?2:1));let n,i,o,a;if(b){const f=C.y-h,d=new I(-w,w-f),p=-Math.PI/2,m=new I(...t),g=((n=new I(-w+e[0],e[1]))._rotateAround(p,d)._add(m),n.x+=-f+w,n.y-=(E.left-s)*C.scale,C.imageName?E.advance*C.scale:le*C.scale),y=String.fromCharCode(C.glyph);"︶"===(b=y)||"﹈"===b||"︸"===b||"﹄"===b||"﹂"===b||"︾"===b||"︼"===b||"︺"===b||"︘"===b||"﹀"===b||"︐"===b||"︓"===b||"︔"===b||"｀"===b||"￣"===b||"︑"===b||"︒"===b?n.x+=(1-s)*C.scale:(b=y,n.x+="︵"===b||"﹇"===b||"︷"===b||"﹃"===b||"﹁"===b||"︽"===b||"︻"===b||"︹"===b||"︗"===b||"︿"===b?g-E.height*C.scale+(-s-1)*C.scale:C.imageName||E.width+2*s===T.w&&E.height+2*s===T.h?(g-k)/2:(g-(E.height+2*s)*C.scale)/2),i=new I(n.x,n.y-M),o=new I(n.x+k,n.y),a=new I(n.x+k,n.y-M)}else{const f=(E.left-s)*C.scale-w+e[0],d=(-E.top-s)*C.scale+e[1],p=f+M,m=d+k;n=new I(f,d),i=new I(p,d),o=new I(f,m),a=new I(p,m)}_&&(b=m?new I(0,0):r?new I(x[0],x[1]):new I(d[0],d[1]),n._rotateAround(_,b),i._rotateAround(_,b),o._rotateAround(_,b),a._rotateAround(_,b));T=new I(0,0),w=new I(0,0);v.push({tl:n,tr:i,bl:o,br:a,tex:p,writingMode:f.writingMode,glyphOffset:S,sectionIndex:C.sectionIndex,isSDF:l,pixelOffsetTL:T,pixelOffsetBR:w,minFontScaleX:0,minFontScaleY:0})}}}}return v}(n,l,o,a,s,i,e.allowVerticalPlacement),i=e.textSizeData;let y=null;"source"===i.kind?(y=[Lc*o.layout.get("text-size").evaluate(s,{},g)])[0]>Zh&&ae(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):"composite"===i.kind&&((y=[Lc*p.compositeTextSizes[0].evaluate(s,{},g),Lc*p.compositeTextSizes[1].evaluate(s,{},g)])[0]>Zh||y[1]>Zh)&&ae(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),e.addSymbols(e.text,n,y,l,a,s,c,t,r,u.lineStartIndex,u.lineLength,d,m,g);for(const t of h)f[t]=e.text.placedSymbolArray.length-1;return 4*n.length}function Hh(e){for(const t in e)return e[t];return null}function $h(t,r,n,i,o,e,a,s,l,u){let c=a.top,h=a.bottom,f=a.left,d=a.right;a=a.collisionPadding;if(a&&(f-=a[0],c-=a[1],d+=a[2],h+=a[3]),l){const t=new I(f,c),r=new I(d,c),n=new I(f,h),i=new I(d,h),o=M(l);let e=new I(0,0);u&&(e=new I(u[0],u[1])),t._rotateAround(o,e),r._rotateAround(o,e),n._rotateAround(o,e),i._rotateAround(o,e),f=Math.min(t.x,r.x,n.x,i.x),d=Math.max(t.x,r.x,n.x,i.x),c=Math.min(t.y,r.y,n.y,i.y),h=Math.max(t.y,r.y,n.y,i.y)}return t.emplaceBack(r.x,r.y,r.z,n.x,n.y,f,c,d,h,s,i,o,e),t.length-1}function Xh(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);e=e.bottom-e.top;return 0<e?Math.max(10,e):null}function Yh(e,t){var r=e.fovAboveCenter,t=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,t=(e._camera.position[2]*e.worldSize-t)/Math.cos(e._pitch),r=Math.sin(r)*t/Math.sin(Math.max(Math.PI/2-e._pitch-r,.01)),r=Math.sin(e._pitch)*r+t;return Math.min(1.01*r,t*(1/e._horizonShift))}function Jh(e,c){if(!c.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:c};var t=Math.pow(2,-e.z),r=e.x*t,n=(e.x+1)*t,i=e.y*t,e=(e.y+1)*t,o=gl(r),a=gl(n),s=E(i),l=E(e),u=c.project(o,s),s=c.project(a,s),a=c.project(a,l),o=c.project(o,l);let h=Math.min(u.x,s.x,a.x,o.x),f=Math.min(u.y,s.y,a.y,o.y),d=Math.max(u.x,s.x,a.x,o.x),p=Math.max(u.y,s.y,a.y,o.y);const m=t/16;function g(e,t,r,n,i,o){var a=(r+i)/2,s=(n+o)/2,l=c.project(gl(a),E(s)),u=Math.max(0,h-l.x,f-l.y,l.x-d,l.y-p);h=Math.min(h,l.x),d=Math.max(d,l.x),f=Math.min(f,l.y),p=Math.max(p,l.y),u>m&&(g(e,l,r,n,a,s),g(l,t,a,s,i,o))}g(u,s,r,i,n,i),g(s,a,n,i,n,e),g(a,o,n,e,r,e),g(o,u,r,e,r,i),h-=m,f-=m,d+=m,p+=m;l=1/Math.max(d-h,p-f);return{scale:l,x:h*l,y:f*l,x2:d*l,y2:p*l,projection:c}}const Kh=Ja(new Float32Array(16));class Qh{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new A(0,0)}projectTilePoint(e,t,r){return{x:e,y:t,z:0}}locationPoint(e,t,r=!0){return e._coordinatePoint(e.locationCoordinate(t),r)}pixelsPerMeter(e,t){return ml(1,e)*t}pixelSpaceConversion(e,t,r){return 1}farthestPixelDistance(e){return Yh(e,e.pixelsPerMeter)}pointCoordinate(e,t,r,n){var i=e.horizonLineFromTop(!1),t=new I(t,Math.max(i,r));return e.rayIntersectionCoordinate(e.pointRayIntersection(t,n))}pointCoordinate3D(e,t,r){r=new I(t,r);if(e.elevation)return e.elevation.pointCoordinate(r);{const t=this.pointCoordinate(e,r.x,r.y,0);return[t.x,t.y,t.z]}}isPointAboveHorizon(e,t){return e.elevation?!this.pointCoordinate3D(e,t.x,t.y):(e=e.horizonLineFromTop(),t.y<e)}createInversionMatrix(e,t){return Kh}createTileMatrix(e,t,r){let n,i,o;var a,s=r.canonical,l=Ja(new Float64Array(16));return this.isReprojectedInTileSpace?(a=Jh(s,this),n=1,i=a.x+r.wrap*a.scale,o=a.y,ts(l,l,[n/a.scale,n/a.scale,e.pixelsPerMeter/t])):(n=t/e.zoomScale(s.z),i=(s.x+Math.pow(2,s.z)*r.wrap)*n,o=s.y*n),es(l,l,[i,o,0]),ts(l,l,[n/se,n/se,1]),l}upVector(e,t,r){return[0,0,1]}upVectorScale(e,t,r){return{metersToTile:1}}}class ef extends Qh{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];var[e,t]=this.parallels=e.parallels||[29.5,45.5],e=Math.sin(M(e));this.n=(e+Math.sin(M(t)))/2,this.c=1+e*(2*this.n-e),this.r0=Math.sqrt(this.c)/this.n}project(e,t){var{n:r,c:n,r0:i}=this,e=M(e-this.center[0]),t=M(t),n=Math.sqrt(n-2*r*Math.sin(t))/r;return{x:n*Math.sin(e*r),y:n*Math.cos(e*r)-i,z:0}}unproject(e,t){var{n:r,c:n,r0:i}=this,i=i+t;let o=Math.atan2(e,Math.abs(i))*Math.sign(i);i*r<0&&(o-=Math.PI*Math.sign(e)*Math.sign(i));t=M(this.center[0])*r,t=S(T((o=Y(o,-Math.PI-t,Math.PI-t))/r)+this.center[0],-180,180),n=Math.asin(S((n-(e*e+i*i)*r*r)/(2*r),-1,1)),e=S(T(n),-L,L);return new A(t,e)}}const tf=1.340264,rf=-.081106,nf=893e-6,of=.003796,af=Math.sqrt(3)/2;class sf extends Qh{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;var t=Math.asin(af*Math.sin(t)),r=t*t,n=r*r*r;return{x:.5*(e*Math.cos(t)/(af*(tf+3*rf*r+n*(7*nf+9*of*r)))/Math.PI+.5),y:1-.5*(t*(tf+rf*r+n*(nf+of*r))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let n=r=(2*(1-r)-1)*Math.PI,i=n*n,o=i*i*i;for(let e,t=0;t<12&&(e=(n*(tf+rf*i+o*(nf+of*i))-r)/(tf+3*rf*i+o*(7*nf+9*of*i)),n=S(n-e,-Math.PI/3,Math.PI/3),i=n*n,o=i*i*i,!(Math.abs(e)<1e-12));++t);var e=af*e*(tf+3*rf*i+o*(7*nf+9*of*i))/Math.cos(n),t=Math.asin(Math.sin(n)/af),e=S(180*e/Math.PI,-180,180),t=S(180*t/Math.PI,-L,L);return new A(e,t)}}class lf extends Qh{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){e=360*(e-.5),t=S(360*(.5-t),-L,L);return new A(e,t)}}const uf=Math.PI/2;function cf(e){return Math.tan((uf+e)/2)}class hf extends Qh{constructor(e){super(e),this.center=e.center||[0,30];var[e,t]=this.parallels=e.parallels||[30,30];let r=M(e),n=M(t);this.southernCenter=r+n<0,this.southernCenter&&(r=-r,n=-n);e=Math.cos(r),t=cf(r);this.n=r===n?Math.sin(r):Math.log(e/Math.cos(n))/Math.log(cf(n)/t),this.f=e*Math.pow(cf(r),this.n)/this.n}project(e,t){t=M(t),this.southernCenter&&(t=-t),e=M(e-this.center[0]);var{n:r,f:n}=this,t=(0<n?t<1e-6-uf&&(t=1e-6-uf):t>uf-1e-6&&(t=uf-1e-6),n/Math.pow(cf(t),r)),i=t*Math.sin(r*e),n=n-t*Math.cos(r*e),i=.5*(i/Math.PI+.5),n=.5*(n/Math.PI+.5);return{x:i,y:this.southernCenter?n:1-n,z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;var{n:r,f:n}=this,t=n-(t=(2*(1-(t=this.southernCenter?1-t:t))-.5)*Math.PI),i=Math.sign(t),o=Math.sign(r)*Math.sqrt(e*e+t*t);let a=Math.atan2(e,Math.abs(t))*i;t*r<0&&(a-=Math.PI*Math.sign(e)*i);t=S(T(a/r)+this.center[0],-180,180),e=S(T(2*Math.atan(Math.pow(n/o,1/r))-uf),-L,L);return new A(t,this.southernCenter?-e:e)}}class ff extends Qh{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:dl(e),y:pl(t),z:0}}unproject(e,t){e=gl(e),t=E(t);return new A(e,t)}}const df=M(L);class pf extends Qh{project(e,t){var r=(t=M(t))*t,n=r*r;return{x:.5*((e=M(e))*(.8707-.131979*r+n*(n*(.003971*r-.001529*n)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+r*(.015085+n*(.028874*r-.044475-.005916*n)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let r=t=(2*(1-t)-1)*Math.PI,n=25,i,o=r*r;do{const e=(o=r*r)*o;i=(r*(1.007226+o*(.015085+e*(.028874*o-.044475-.005916*e)))-t)/(1.007226+o*(.045255+e*(.259866*o-.311325-.005916*11*e))),r=S(r-i,-df,df)}while(1e-6<Math.abs(i)&&0<--n);var e=S(T(e/(.8707+(o=r*r)*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979))),-180,180),a=T(r);return new A(e,a)}}const mf=M(L);class gf extends Qh{project(e,t){t=M(t),e=M(e);var r=Math.cos(t),n=2/Math.PI,i=Math.acos(r*Math.cos(e/2)),i=Math.sin(i)/i,n=.5*(e*n+2*r*Math.sin(e/2)/i)||0,r=.5*(t+Math.sin(t)/i)||0;return{x:.5*(n/Math.PI+.5),y:1-.5*(r/Math.PI+1),z:0}}unproject(e,t){let r=e=(2*e-.5)*Math.PI,n=t=(2*(1-t)-1)*Math.PI,i=25;const o=1e-6;var a,s;do{const i=Math.cos(n),o=Math.sin(n),l=2*o*i,u=o*o,c=i*i,h=Math.cos(r/2),f=Math.sin(r/2),d=2*h*f,p=f*f,m=1-c*h*h,g=m?1/m:0,y=m?Math.acos(i*h)*Math.sqrt(1/m):0,v=.5*(2*y*i*f+2*r/Math.PI)-e,T=.5*(y*o+n)-t,_=.5*g*(c*p+y*i*h*u)+1/Math.PI,x=g*(d*l/4-y*o*f),b=.125*g*(l*f-y*o*c*d),w=.5*g*(u*h+y*p*i)+.5,E=x*b-w*_;a=(T*x-v*w)/E,s=(v*b-T*_)/E,r=S(r-a,-Math.PI,Math.PI),n=S(n-s,-mf,mf)}while((Math.abs(a)>o||Math.abs(s)>o)&&0<--i);return new A(T(r),T(n))}}class yf extends Qh{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(M(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){var{scale:r,cosPhi:n}=this;return{x:M(e)*n*r+.5,y:-Math.sin(M(t))/n*r+.5,z:0}}unproject(e,t){var{scale:r,cosPhi:n}=this,t=-(t-.5)/r,e=S(T((e-.5)/r)/n,-180,180),r=Math.asin(S(t*n,-1,1)),t=S(T(r),-L,L);return new A(e,t)}}class vf extends ff{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,t,r){e=Ks(e,t,r);return Ee(e,e,tl(Ws(r))),{x:e[0],y:e[1],z:e[2]}}locationPoint(e,t){var r=Js(t.lat,t.lng),n=ys([],r),t=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude,n=(gs(r,r,n,ml(1,0)*se*t),Ja(new Float64Array(16)));return Qa(n,e.pixelMatrix,e.globeMatrix),Ee(r,r,n),new I(r[0],r[1])}pixelsPerMeter(e,t){return ml(1,0)*t}pixelSpaceConversion(e,t,r){var n=ml(1,e)*t,n=k(ml(1,45)*t,n,r);return this.pixelsPerMeter(e,t)/n}createTileMatrix(e,t,r){r=rl(Ws(r.canonical));return Qa(new Float64Array(16),e.globeMatrix,r)}createInversionMatrix(e,t){var r=e["center"],t=tl(Ws(t));return ns(t,t,M(r.lng)),rs(t,t,M(r.lat)),ts(t,t,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(t)}pointCoordinate(e,t,r,n){return Us(e,t,r,!0)||new _l(0,0)}pointCoordinate3D(e,t,r){e=this.pointCoordinate(e,t,r,0);return[e.x,e.y,e.z]}isPointAboveHorizon(e,t){return!Us(e,t.x,t.y,!1)}farthestPixelDistance(e){var t,r,n=function(e,t){const r=e.cameraToCenterDistance,n=e._centerAltitude*t,i=e._camera,o=e._camera.forward(),a=cs([],ms([],o,-r),[0,0,n]),s=e.worldSize/(2*Math.PI),l=[0,0,-s],u=e.width/e.height,c=Math.tan(e.fovAboveCenter),h=ms([],i.up(),c),f=ms([],i.right(),c*u),d=ys([],cs([],cs([],o,h),f)),p=[];let m;if(new zs(a,d).closestPointOnSphere(l,s,p)){const t=cs([],p,l),r=bs([],t,a);m=Math.cos(e.fovAboveCenter)*ls(r)}else{const e=bs([],a,l),t=bs([],l,a),r=(ys(t,t),ls(e)-s),n=(m=Math.sqrt(r*(r+2*s)),Math.acos(m/(s+r))-Math.acos(vs(o,t)));m*=Math.cos(n)}return 1.01*m}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),i=il(e.zoom);return 0<i?(t=Yh(e,ml(1,e.center.lat)*e.worldSize),r=e.worldSize/(2*Math.PI),e=Math.max(e.width,e.height)/e.worldSize*Math.PI,k(n,t+r*(1-Math.cos(e)),Math.pow(i,10))):n}upVector(e,t,r){return Ks(t,r,e,1)}upVectorScale(e){return{metersToTile:js(Qs(Ws(e)))}}}function _f(e){var t=e.parallels,r=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new ff(e);case"equirectangular":return new lf(e);case"naturalEarth":return new pf(e);case"equalEarth":return new sf(e);case"winkelTripel":return new gf(e);case"albers":return new(r?yf:ef)(e);case"lambertConformalConic":return new(r?yf:hf)(e);case"globe":return new vf(e)}throw new Error("Invalid projection name: "+e.name)}const xf=cn.types,bf=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function wf(e,t,r,n,i,o,a,s,l,u,c,h,f){var d=s?Math.min(Zh,Math.round(s[0])):0,s=s?Math.min(Zh,Math.round(s[1])):0;e.emplaceBack(t,r,Math.round(32*n),Math.round(32*i),o,a,(d<<1)+(l?1:0),s,16*u,16*c,256*h,256*f)}function Ef(e,t,r,n,i,o,a){e.emplaceBack(t,r,n,i,o,a)}function Tf(e,t,r,n,i){e.emplaceBack(t,r,n,i),e.emplaceBack(t,r,n,i),e.emplaceBack(t,r,n,i),e.emplaceBack(t,r,n,i)}function Sf(e){for(const t of e.sections)if(function(e){for(const t of e)if(ro(t.charCodeAt(0)))return 1}(t.text))return 1}class Mf{constructor(e){this.layoutVertexArray=new No,this.indexArray=new Ho,this.programConfigurations=e,this.segments=new w,this.dynamicLayoutVertexArray=new Oo,this.opacityVertexArray=new Uo,this.placedSymbolArray=new oa,this.globeExtVertexArray=new jo}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,t,r,n){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Tc.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Mc.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,bf,!0),0<this.globeExtVertexArray.length&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Sc.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||n)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}e(Mf,"SymbolBuffers");class kf{constructor(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new w,this.collisionVertexArray=new Zo,this.collisionVertexArrayExt=new qo}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,kc.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Cc.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}e(kf,"CollisionBuffers");class Cf{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ja([]),this.placementViewportMatrix=Ja([]);var t=this.layers[0]._unevaluatedLayout._values,t=(this.textSizeData=Pc(this.zoom,t["text-size"]),this.iconSizeData=Pc(this.zoom,t["icon-size"]),this.layers[0].layout),r=t.get("symbol-sort-key"),n=t.get("symbol-z-order");this.canOverlap=t.get("text-allow-overlap")||t.get("icon-allow-overlap")||t.get("text-ignore-placement")||t.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==n&&void 0!==r.constantOr(1),this.sortFeaturesByY=("viewport-y"===n||"auto"===n&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=t.get("text-writing-mode").map(e=>ch[e]),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Mf(new Ra(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Mf(new Ra(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new la,this.lineVertexArray=new ua,this.symbolInstances=new sa}calculateGlyphDependencies(t,r,e,n,i){for(let e=0;e<t.length;e++)if(r[t.charCodeAt(e)]=!0,n&&i){const n=Rc[t.charAt(e)];n&&(r[n.charCodeAt(0)]=!0)}}populate(r,n,i,o){const a=this.layers[0],s=a.layout,l="globe"===this.projection.name,u=s.get("text-font"),c=s.get("text-field"),h=s.get("icon-image"),f=("constant"!==c.value.kind||c.value.value instanceof Zt&&!c.value.value.isEmpty()||0<c.value.value.toString().length)&&("constant"!==u.value.kind||0<u.value.value.length),d="constant"!==h.value.kind||!!h.value.value||0<Object.keys(h.parameters).length,p=s.get("symbol-sort-key");if(this.features=[],f||d){var m=n.iconDependencies,g=n.glyphDependencies,y=n.availableImages,e=new C(this.zoom);for(const{feature:n,id:c,index:h,sourceLayerIndex:_}of r){const r=a._featureFilter.needGeometry,x=Sl(n,r);if(a._featureFilter.filter(e,x,i)){if(r||(x.geometry=Tl(n,i,o)),l&&1!==n.type&&i.z<=5){const r=x.geometry,n=.98078528056,o=(e,t)=>vs(Ks(e.x,e.y,i,1),Ks(t.x,t.y,i,1))<n;for(let e=0;e<r.length;e++)r[e]=bl(r[e],o)}let e,t;if(f){const r=a.getValueAndResolveTokens("text-field",x,i,y),n=Zt.factory(r);Sf(n)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===fo()||this.hasRTLText&&go.isParsed())&&(e=Oc(n,a,x))}if(d){const r=a.getValueAndResolveTokens("icon-image",x,i,y);t=r instanceof qt?r:qt.fromString(r)}if(e||t){var v=this.sortFeaturesByKey?p.evaluate(x,{},i):void 0;if(this.features.push({id:c,text:e,icon:t,index:h,sourceLayerIndex:_,geometry:x.geometry,properties:n.properties,type:xf[n.type],sortKey:v}),t&&(m[t.name]=!0),e){const r=u.evaluate(x,{},i).join(","),n="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&0<=this.writingModes.indexOf(ch.vertical);for(const i of e.sections)if(i.image)m[i.image.name]=!0;else{const o=Ki(e.toString()),a=i.fontStack||r,s=g[a]=g[a]||{};this.calculateGlyphDependencies(i.text,s,n,this.allowVerticalPlacement,o)}}}}}"line"===s.get("symbol-placement")&&(this.features=function(t){const i={},o={},a=[];let r=0;function n(e){a.push(t[e]),r++}function s(e,t,r){var n=o[e];return delete o[e],o[t]=n,a[n].geometry[0].pop(),a[n].geometry[0]=a[n].geometry[0].concat(r[0]),n}function l(e,t,r){var n=i[t];return delete i[t],i[e]=n,a[n].geometry[0].shift(),a[n].geometry[0]=r[0].concat(a[n].geometry[0]),n}function u(e,t,r){r=r?t[0][t[0].length-1]:t[0][0];return`${e}:${r.x}:`+r.y}for(let e=0;e<t.length;e++){var c=t[e],h=c.geometry,c=c.text?c.text.toString():null;if(c){var f=u(c,h),d=u(c,h,!0);if(f in o&&d in i&&o[f]!==i[d]){const t=l(f,d,h),r=s(f,d,a[t].geometry);delete i[f],delete o[d],o[u(c,a[r].geometry,!0)]=r,a[t].geometry=null}else f in o?s(f,d,h):d in i?l(f,d,h):(n(e),i[f]=r-1,o[d]=r-1)}else n(e)}return a.filter(e=>e.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((e,t)=>e.sortKey-t.sortKey)}}update(e,t,r,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r,n),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r,n))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=_f(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const r=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:e,y:r}of t)this.lineVertexArray.emplaceBack(e,r);return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(t,r,n,i,o,a,s,l,u,c,h,f,d,p){const m=t.indexArray,g=t.layoutVertexArray,y=t.globeExtVertexArray,v=t.segments.prepareSegment(4*r.length,g,m,this.canOverlap?a.sortKey:void 0),_=this.glyphOffsetArray.length,x=v.vertexLength,b=this.allowVerticalPlacement&&s===ch.vertical?Math.PI/2:0,w=a.text&&a.text.sections;for(let e=0;e<r.length;e++){const{tl:o,tr:s,bl:c,br:h,tex:f,pixelOffsetTL:_,pixelOffsetBR:x,minFontScaleX:E,minFontScaleY:T,glyphOffset:S,isSDF:M,sectionIndex:k}=r[e],C=v.vertexLength,A=S[1];if(wf(g,u.x,u.y,o.x,A+o.y,f.x,f.y,n,M,_.x,_.y,E,T),wf(g,u.x,u.y,s.x,A+s.y,f.x+f.w,f.y,n,M,x.x,_.y,E,T),wf(g,u.x,u.y,c.x,A+c.y,f.x,f.y+f.h,n,M,_.x,x.y,E,T),wf(g,u.x,u.y,h.x,A+h.y,f.x+f.w,f.y+f.h,n,M,x.x,x.y,E,T),l){const{x:r,y:n,z:i}=l.anchor,[o,a,s]=l.up;Ef(y,r,n,i,o,a,s),Ef(y,r,n,i,o,a,s),Ef(y,r,n,i,o,a,s),Ef(y,r,n,i,o,a,s),Tf(t.dynamicLayoutVertexArray,r,n,i,b)}else Tf(t.dynamicLayoutVertexArray,u.x,u.y,u.z,b);m.emplaceBack(C,C+1,C+2),m.emplaceBack(C+1,C+2,C+3),v.vertexLength+=4,v.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(S[0]),e!==r.length-1&&k===r[e+1].sectionIndex||t.programConfigurations.populatePaintArrays(g.length,a,a.index,{},d,p,w&&w[k])}const E=l?l.anchor:u;t.placedSymbolArray.emplaceBack(E.x,E.y,E.z,u.x,u.y,_,this.glyphOffsetArray.length-_,x,c,h,u.segment,n?n[0]:0,n?n[1]:0,i[0],i[1],s,0,!1,0,f,0)}_commitLayoutVertex(e,t,r,n,i,o,a){e.emplaceBack(t,r,n,i,o,Math.round(a.x),Math.round(a.y))}_addCollisionDebugVertices(e,t,r,n,i,o,a){var s=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),l=s.vertexLength,u=a.tileAnchorX,a=a.tileAnchorY;for(let e=0;e<4;e++)r.collisionVertexArray.emplaceBack(0,0,0,0);r.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),r.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(r.layoutVertexArray,n,i,o,u,a,new I(e.x1,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,n,i,o,u,a,new I(e.x2,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,n,i,o,u,a,new I(e.x2,e.y2)),this._commitLayoutVertex(r.layoutVertexArray,n,i,o,u,a,new I(e.x1,e.y2)),s.vertexLength+=4;t=r.indexArray;t.emplaceBack(l,l+1),t.emplaceBack(l+1,l+2),t.emplaceBack(l+2,l+3),t.emplaceBack(l+3,l),s.primitiveLength+=4}_addTextDebugCollisionBoxes(t,r,n,i,o,a){for(let e=i;e<o;e++){const i=n.get(e),o=this.getSymbolInstanceTextSize(t,a,r,e);this._addCollisionDebugVertices(i,o,this.textCollisionBox,i.projectedAnchorX,i.projectedAnchorY,i.projectedAnchorZ,a)}}_addIconDebugCollisionBoxes(t,r,n,i,o,a){for(let e=i;e<o;e++){const i=n.get(e),o=this.getSymbolInstanceIconSize(t,r,a.placedIconSymbolIndex);this._addCollisionDebugVertices(i,o,this.iconCollisionBox,i.projectedAnchorX,i.projectedAnchorY,i.projectedAnchorZ,a)}}generateCollisionDebugBuffers(t,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new kf(Go,Ac.members,Qo),this.iconCollisionBox=new kf(Go,Ac.members,Qo);var n=Dc(this.iconSizeData,t),i=Dc(this.textSizeData,t);for(let e=0;e<this.symbolInstances.length;e++){var o=this.symbolInstances.get(e);this._addTextDebugCollisionBoxes(i,t,r,o.textBoxStartIndex,o.textBoxEndIndex,o),this._addTextDebugCollisionBoxes(i,t,r,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._addIconDebugCollisionBoxes(n,t,r,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._addIconDebugCollisionBoxes(n,t,r,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}}getSymbolInstanceTextSize(e,t,r,n){t=this.text.placedSymbolArray.get(0<=t.rightJustifiedTextSymbolIndex?t.rightJustifiedTextSymbolIndex:0<=t.centerJustifiedTextSymbolIndex?t.centerJustifiedTextSymbolIndex:0<=t.leftJustifiedTextSymbolIndex?t.leftJustifiedTextSymbolIndex:0<=t.verticalPlacedTextSymbolIndex?t.verticalPlacedTextSymbolIndex:n),n=zc(this.textSizeData,e,t)/le;return this.tilePixelRatio*n}getSymbolInstanceIconSize(e,t,r){r=this.icon.placedSymbolArray.get(r),e=zc(this.iconSizeData,e,r);return this.tilePixelRatio*e}_commitDebugCollisionVertexUpdate(e,t,r){e.emplaceBack(t,-r,-r),e.emplaceBack(t,r,-r),e.emplaceBack(t,r,r),e.emplaceBack(t,-r,r)}_updateTextDebugCollisionBoxes(t,r,n,i,o,a){for(let e=i;e<o;e++){const i=n.get(e),o=this.getSymbolInstanceTextSize(t,a,r,e);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,o,i.padding)}}_updateIconDebugCollisionBoxes(t,r,n,i,o,a){for(let e=i;e<o;e++){const i=n.get(e),o=this.getSymbolInstanceIconSize(t,r,a);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,o,i.padding)}}updateCollisionDebugBuffers(t,r){if(this.hasDebugData()){this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();var n=Dc(this.iconSizeData,t),i=Dc(this.textSizeData,t);for(let e=0;e<this.symbolInstances.length;e++){var o=this.symbolInstances.get(e);this._updateTextDebugCollisionBoxes(i,t,r,o.textBoxStartIndex,o.textBoxEndIndex,o),this._updateTextDebugCollisionBoxes(i,t,r,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._updateIconDebugCollisionBoxes(n,t,r,o.iconBoxStartIndex,o.iconBoxEndIndex,o.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(n,t,r,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}}_deserializeCollisionBoxesForSymbol(e,t,r,n,i,o,a,s,l){var u={};if(t<r){const{x1:r,y1:n,x2:i,y2:o,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:c,tileAnchorX:h,tileAnchorY:f,featureIndex:d}=e.get(t);u.textBox={x1:r,y1:n,x2:i,y2:o,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:c,tileAnchorX:h,tileAnchorY:f},u.textFeatureIndex=d}if(n<i){const{x1:t,y1:r,x2:i,y2:o,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:p,tileAnchorX:m,tileAnchorY:g,featureIndex:y}=e.get(n);u.verticalTextBox={x1:t,y1:r,x2:i,y2:o,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:p,tileAnchorX:m,tileAnchorY:g},u.verticalTextFeatureIndex=y}if(o<a){const{x1:t,y1:r,x2:n,y2:i,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:v,tileAnchorX:_,tileAnchorY:x,featureIndex:b}=e.get(o);u.iconBox={x1:t,y1:r,x2:n,y2:i,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:v,tileAnchorX:_,tileAnchorY:x},u.iconFeatureIndex=b}if(s<l){const{x1:t,y1:r,x2:n,y2:i,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:w,tileAnchorX:E,tileAnchorY:T,featureIndex:S}=e.get(s);u.verticalIconBox={x1:t,y1:r,x2:n,y2:i,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:w,tileAnchorX:E,tileAnchorY:T},u.verticalIconFeatureIndex=S}return u}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){var r=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return 0<this.text.segments.get().length}hasIconData(){return 0<this.icon.segments.get().length}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&0<this.textCollisionBox.segments.get().length}hasIconCollisionBoxData(){return this.hasDebugData()&&0<this.iconCollisionBox.segments.get().length}addIndicesForPlacedSymbol(t,r){var r=t.placedSymbolArray.get(r),n=r.vertexStartIndex+4*r.numGlyphs;for(let e=r.vertexStartIndex;e<n;e+=4)t.indexArray.emplaceBack(e,e+1,e+2),t.indexArray.emplaceBack(e+1,e+2,e+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),r=Math.cos(e),n=[],i=[],o=[];for(let e=0;e<this.symbolInstances.length;++e){o.push(e);var a=this.symbolInstances.get(e);n.push(0|Math.round(t*a.tileAnchorX+r*a.tileAnchorY)),i.push(a.featureIndex)}return o.sort((e,t)=>n[e]-n[t]||i[t]-i[e]),o}addToSortKeyRanges(e,t){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(1<this.text.segments.get().length||1<this.icon.segments.get().length)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){var t=this.symbolInstances.get(e),{rightJustifiedTextSymbolIndex:t,centerJustifiedTextSymbolIndex:r,leftJustifiedTextSymbolIndex:n,verticalPlacedTextSymbolIndex:i,placedIconSymbolIndex:o,verticalPlacedIconSymbolIndex:a}=(this.featureSortOrder.push(t.featureIndex),t);0<=t&&this.addIndicesForPlacedSymbol(this.text,t),0<=r&&r!==t&&this.addIndicesForPlacedSymbol(this.text,r),0<=n&&n!==r&&n!==t&&this.addIndicesForPlacedSymbol(this.text,n),0<=i&&this.addIndicesForPlacedSymbol(this.text,i),0<=o&&this.addIndicesForPlacedSymbol(this.icon,o),0<=a&&this.addIndicesForPlacedSymbol(this.icon,a)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}e(Cf,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Cf.MAX_GLYPHS=65535,Cf.addDynamicAttributes=Tf;var en=new Mo({"symbol-placement":new t(c.layout_symbol["symbol-placement"]),"symbol-spacing":new t(c.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new t(c.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new r(c.layout_symbol["symbol-sort-key"]),"symbol-z-order":new t(c.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new t(c.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new t(c.layout_symbol["icon-ignore-placement"]),"icon-optional":new t(c.layout_symbol["icon-optional"]),"icon-rotation-alignment":new t(c.layout_symbol["icon-rotation-alignment"]),"icon-size":new r(c.layout_symbol["icon-size"]),"icon-text-fit":new t(c.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new t(c.layout_symbol["icon-text-fit-padding"]),"icon-image":new r(c.layout_symbol["icon-image"]),"icon-rotate":new r(c.layout_symbol["icon-rotate"]),"icon-padding":new t(c.layout_symbol["icon-padding"]),"icon-keep-upright":new t(c.layout_symbol["icon-keep-upright"]),"icon-offset":new r(c.layout_symbol["icon-offset"]),"icon-anchor":new r(c.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new t(c.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new t(c.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new t(c.layout_symbol["text-rotation-alignment"]),"text-field":new r(c.layout_symbol["text-field"]),"text-font":new r(c.layout_symbol["text-font"]),"text-size":new r(c.layout_symbol["text-size"]),"text-max-width":new r(c.layout_symbol["text-max-width"]),"text-line-height":new r(c.layout_symbol["text-line-height"]),"text-letter-spacing":new r(c.layout_symbol["text-letter-spacing"]),"text-justify":new r(c.layout_symbol["text-justify"]),"text-radial-offset":new r(c.layout_symbol["text-radial-offset"]),"text-variable-anchor":new t(c.layout_symbol["text-variable-anchor"]),"text-anchor":new r(c.layout_symbol["text-anchor"]),"text-max-angle":new t(c.layout_symbol["text-max-angle"]),"text-writing-mode":new t(c.layout_symbol["text-writing-mode"]),"text-rotate":new r(c.layout_symbol["text-rotate"]),"text-padding":new t(c.layout_symbol["text-padding"]),"text-keep-upright":new t(c.layout_symbol["text-keep-upright"]),"text-transform":new r(c.layout_symbol["text-transform"]),"text-offset":new r(c.layout_symbol["text-offset"]),"text-allow-overlap":new t(c.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new t(c.layout_symbol["text-ignore-placement"]),"text-optional":new t(c.layout_symbol["text-optional"])}),Af={paint:new Mo({"icon-opacity":new r(c.paint_symbol["icon-opacity"]),"icon-color":new r(c.paint_symbol["icon-color"]),"icon-halo-color":new r(c.paint_symbol["icon-halo-color"]),"icon-halo-width":new r(c.paint_symbol["icon-halo-width"]),"icon-halo-blur":new r(c.paint_symbol["icon-halo-blur"]),"icon-translate":new t(c.paint_symbol["icon-translate"]),"icon-translate-anchor":new t(c.paint_symbol["icon-translate-anchor"]),"text-opacity":new r(c.paint_symbol["text-opacity"]),"text-color":new r(c.paint_symbol["text-color"],{runtimeType:Mt,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new r(c.paint_symbol["text-halo-color"]),"text-halo-width":new r(c.paint_symbol["text-halo-width"]),"text-halo-blur":new r(c.paint_symbol["text-halo-blur"]),"text-translate":new t(c.paint_symbol["text-translate"]),"text-translate-anchor":new t(c.paint_symbol["text-translate-anchor"])}),layout:en};class If{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:St,this.defaultValue=e}evaluate(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}e(If,"FormatSectionOverride",{omit:["defaultValue"]});class Lf extends Ga{constructor(e){super(e,Af)}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));var r=this.layout.get("text-writing-mode");if(r){const e=[];for(const t of r)e.indexOf(t)<0&&e.push(t);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,r,n){var i,r=this.layout.get(e).evaluate(t,{},r,n),n=this._unevaluatedLayout._values[e];return n.isDataDriven()||Ln(n.value)||!r?r:(i=t.properties,r.replace(/{([^{}]+)}/g,(e,t)=>t in i?String(i[t]):""))}createBucket(e){return new Cf(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const n of Af.paint.overridableProperties){var e,t,r;Lf.hasPaintOverride(this.layout,n)&&(e=this.paint.get(n),t=new If(e),t=new In(t,e.property.specification),r=null,r="constant"===e.value.kind||"source"===e.value.kind?new zn("source",t):new Dn("composite",t,e.value.zoomStops,e.value._interpolationType),this.paint._values[n]=new Eo(e.property,r,e.parameters))}}_handleOverridablePaintPropertyUpdate(e,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven())&&Lf.hasPaintOverride(this.layout,e)}static hasPaintOverride(t,e){const r=t.get("text-field"),n=Af.paint.properties[e];let i=!1;const o=e=>{for(const t of e)if(n.overrides&&n.overrides.hasOverride(t))return void(i=!0)};if("constant"===r.value.kind&&r.value.value instanceof Zt)o(r.value.value.sections);else if("source"===r.value.kind){const t=e=>{i||(e instanceof Yt&&v(e.value)===At?o(e.value.sections):e instanceof er?o(e.sections):e.eachChild(t))},e=r.value;e._styleExpression&&t(e._styleExpression.expression)}return i}getProgramConfiguration(e){return new Oa(this,e)}}var Pf={paint:new Mo({"background-color":new t(c.paint_background["background-color"]),"background-pattern":new t(c.paint_background["background-pattern"]),"background-opacity":new t(c.paint_background["background-opacity"])})},zf={paint:new Mo({"raster-opacity":new t(c.paint_raster["raster-opacity"]),"raster-hue-rotate":new t(c.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new t(c.paint_raster["raster-brightness-min"]),"raster-brightness-max":new t(c.paint_raster["raster-brightness-max"]),"raster-saturation":new t(c.paint_raster["raster-saturation"]),"raster-contrast":new t(c.paint_raster["raster-contrast"]),"raster-resampling":new t(c.paint_raster["raster-resampling"]),"raster-fade-duration":new t(c.paint_raster["raster-fade-duration"])})};class Df extends Ga{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Of={paint:new Mo({"sky-type":new t(c.paint_sky["sky-type"]),"sky-atmosphere-sun":new t(c.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new t(c.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new t(c.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new t(c.paint_sky["sky-gradient-radius"]),"sky-gradient":new So(c.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new t(c.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new t(c.paint_sky["sky-atmosphere-color"]),"sky-opacity":new t(c.paint_sky["sky-opacity"])})};function Rf(e,t,r){var n=[0,0,1],i=Ms([]);return Cs(i,i,r?-M(e)+Math.PI:M(e)),ks(i,i,-M(t)),xs(n,n,i),ys(n,n)}const Ff={circle:class extends Ga{constructor(e){super(e,Vl)}createBucket(e){return new Cl(e)}queryRadius(e){return Bl("circle-radius",this,e)+Bl("circle-stroke-width",this,e)+Nl(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,r,n,i,o,a,s){var l=Ul(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),t=this.paint.get("circle-radius").evaluate(t,r)+this.paint.get("circle-stroke-width").evaluate(t,r);return Gl(e,n,o,a,s,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,t)}getProgramIds(){return["circle"]}getProgramConfiguration(e){return new Oa(this,e)}},heatmap:class extends Ga{createBucket(e){return new ql(e)}constructor(e){super(e,Kl),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ql({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return Bl("heatmap-radius",this,e)}queryIntersectsFeature(e,t,r,n,i,o,a,s){t=this.paint.get("heatmap-radius").evaluate(t,r);return Gl(e,n,o,a,s,!0,!0,new I(0,0),t)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(e){return new Oa(this,e)}},hillshade:class extends Ga{constructor(e){super(e,eu)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Ga{constructor(e){super(e,Au)}getProgramIds(){var e=this.paint.get("fill-pattern"),e=e&&e.constantOr(1),t=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&t.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),t}getProgramConfiguration(e){return new Oa(this,e)}recalculate(e,t){super.recalculate(e,t);e=this.paint._values["fill-outline-color"];"constant"===e.value.kind&&void 0===e.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Cu(e)}queryRadius(){return Nl(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,r,n,i,o){return!e.queryGeometry.isAboveHorizon&&Il(jl(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends Ga{constructor(e){super(e,ic)}createBucket(e){return new Xu(e)}queryRadius(){return Nl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(e){return new Oa(this,e)}queryIntersectsFeature(e,t,r,n,i,o,a,s,l){var u=Ul(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),c=this.paint.get("fill-extrusion-height").evaluate(t,r),t=this.paint.get("fill-extrusion-base").evaluate(t,r),r=[0,0],h=s&&o.elevation,f=o.elevation?o.elevation.exaggeration():1,d=e.tile.getBucket(this);if(h&&d instanceof Xu){const e=d.centroidVertexArray,t=l+1;t<e.length&&(r[0]=e.geta_centroid_pos0(t),r[1]=e.geta_centroid_pos1(t))}if(0===r[0]&&1===r[1])return!1;var[d,l]=function(R,e,t,r,n,i,o,F,B,N,j){if("globe"===R.projection.name){var a=R,s=e,l=t,u=r,U=n,V=i,G=o,W=F,Z=B,q=N,c=j;const g=[],y=[],v=a.projection.upVectorScale(c,a.center.lat,a.worldSize).metersToTile,_=[0,0,0,1],x=[0,0,0,1],b=(e,t,r,n)=>{e[0]=t,e[1]=r,e[2]=n,e[3]=1},w=rc();0<l&&(l+=w),u+=w;for(const w of s){const s=[],E=[];for(const g of w){const y=g.x+U.x,w=g.y+U.y,T=a.projection.projectTilePoint(y,w,c),S=a.projection.upVector(c,g.x,g.y);let e=l,t=u;if(G){const a=dc(y,w,l,u,G,W,Z,q);e+=a.base,t+=a.top}0!==l?b(_,T.x+S[0]*v*e,T.y+S[1]*v*e,T.z+S[2]*v*e):b(_,T.x,T.y,T.z),b(x,T.x+S[0]*v*t,T.y+S[1]*v*t,T.z+S[2]*v*t),Ee(_,_,V),Ee(x,x,V),s.push(new cc(_[0],_[1],_[2])),E.push(new cc(x[0],x[1],x[2]))}g.push(s),y.push(E)}return[g,y]}if(o){var h=e,H=t,$=r,X=n,Y=i,J=o,K=F,Q=B,ee=N;const M=[],k=[],C=[0,0,0,1];for(const ie of h){const h=[],A=[];for(const M of ie){const k=M.x+X.x,I=M.y+X.y,L=dc(k,I,H,$,J,K,Q,ee);C[0]=k,C[1]=I,C[2]=L.base,C[3]=1,Ts(C,C,Y),C[3]=Math.max(C[3],1e-5);var te=new cc(C[0]/C[3],C[1]/C[3],C[2]/C[3]),re=(C[0]=k,C[1]=I,C[2]=L.top,C[3]=1,Ts(C,C,Y),C[3]=Math.max(C[3],1e-5),new cc(C[0]/C[3],C[1]/C[3],C[2]/C[3]));h.push(te),A.push(re)}M.push(h),k.push(A)}return[M,k]}{var f=e,d=t,p=r,ne=n,m=i;const P=[],z=[],oe=m[8]*d,ae=m[9]*d,se=m[10]*d,le=m[11]*d,ue=m[8]*p,ce=m[9]*p,he=m[10]*p,fe=m[11]*p;for(const d of f){const f=[],p=[];for(const P of d){const d=P.x+ne.x,z=P.y+ne.y,de=m[0]*d+m[4]*z+m[12],pe=m[1]*d+m[5]*z+m[13],me=m[2]*d+m[6]*z+m[14],ge=m[3]*d+m[7]*z+m[15],ye=de+oe,ve=pe+ae,_e=me+se,D=Math.max(ge+le,1e-5),xe=de+ue,be=pe+ce,we=me+he,O=Math.max(ge+fe,1e-5);f.push(new cc(ye/D,ve/D,_e/D)),p.push(new cc(xe/O,be/O,we/O))}P.push(f),z.push(p)}return[P,z]}}(o,n="globe"===o.projection.name?nc([n],[new I(0,0),new I(se,se)],e.tileID.canonical).map(e=>e.polygon).flat():n,t,c,u,a,h?s:null,r,f,o.center.lat,e.tileID.canonical),n=e.queryGeometry;{var p=d,m=l,g=n.isPointQuery()?n.screenBounds:n.screenGeometry;let t=1/0;Il(g,m)&&(t=fc(g,m[0]));for(let e=0;e<m.length;e++){var y=m[e],v=p[e];for(let e=0;e<y.length-1;e++){const m=y[e],_=[m,y[e+1],v[e+1],v[e],m];Al(g,_)&&(t=Math.min(t,fc(g,_)))}}return t!==1/0&&t}}},line:class extends Ga{constructor(e){super(e,bc),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ir,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=wc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new xc(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(e){return new Oa(this,e)}queryRadius(e){var t=Ec(Bl("line-width",this,e),Bl("line-gap-width",this,e)),e=Bl("line-offset",this,e);return t/2+Math.abs(e)+Nl(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,r,n,i,o){if(!e.queryGeometry.isAboveHorizon){var o=jl(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),a=e.pixelToTileUnitsFactor/2*Ec(this.paint.get("line-width").evaluate(t,r),this.paint.get("line-gap-width").evaluate(t,r)),t=this.paint.get("line-offset").evaluate(t,r),s=(t&&(n=function(t,r){const n=[],i=new I(0,0);for(let e=0;e<t.length;e++){var o=t[e],a=[];for(let e=0;e<o.length;e++){const n=o[e-1],s=o[e],l=o[e+1],u=0===e?i:s.sub(n)._unit()._perp(),c=e===o.length-1?i:l.sub(s)._unit()._perp(),h=u._add(c)._unit();h._mult(1/(h.x*c.x+h.y*c.y)),a.push(h._mult(r)._add(s))}n.push(a)}return n}(n,t*e.pixelToTileUnitsFactor)),o),l=n,u=a;for(let e=0;e<l.length;e++){var c=l[e];if(3<=s.length)for(let e=0;e<c.length;e++)if(Rl(s,c[e]))return!0;if(Ll(s,c,u))return!0}}return!1}isTileClipped(){return!0}},symbol:Lf,background:class extends Ga{constructor(e){super(e,Pf)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ga{constructor(e){super(e,zf)}getProgramIds(){return["raster"]}},sky:class extends Ga{constructor(e){super(e,Of),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ql({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){return!(!this._skyboxInvalidated&&this.skyboxTexture&&this.skyboxGeometry)||!this.paint.get("sky-atmosphere-sun")&&(e=e.style.light.properties.get("position"),this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar)}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const r=this.paint.get("sky-atmosphere-sun"),n=!r,i=e.style.light,o=i.properties.get("position");return n&&"viewport"===i.properties.get("anchor")&&ae("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),n?Rf(o.azimuthal,90-o.polar,t):Rf(r[0],90-r[1],t)}const r=this.paint.get("sky-gradient-center");return Rf(r[0],90-r[1],t)}is3D(){return!1}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){var e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}}};class Bf{constructor(e,t,r,n){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(t,n)}update(e,t,r){var{width:n,height:i}=e,o=this["context"],a=o["gl"],{HTMLImageElement:s,HTMLCanvasElement:l,HTMLVideoElement:u,ImageData:c,ImageBitmap:h}=p;if(a.bindTexture(a.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===a.RGBA&&(!t||!1!==t.premultiply)),r||this.size&&this.size[0]===n&&this.size[1]===i){const{x:p,y:t}=r||{x:0,y:0};e instanceof s||e instanceof l||e instanceof u||e instanceof c||h&&e instanceof h?a.texSubImage2D(a.TEXTURE_2D,0,p,t,a.RGBA,a.UNSIGNED_BYTE,e):a.texSubImage2D(a.TEXTURE_2D,0,p,t,n,i,a.RGBA,a.UNSIGNED_BYTE,e.data)}else this.size=[n,i],e instanceof s||e instanceof l||e instanceof u||e instanceof c||h&&e instanceof h?a.texImage2D(a.TEXTURE_2D,0,this.format,this.format,a.UNSIGNED_BYTE,e):a.texImage2D(a.TEXTURE_2D,0,this.format,n,i,0,this.format,a.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(t&&t.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&a.generateMipmap(a.TEXTURE_2D)}bind(e,t){var r=this["context"],r=r["gl"];r.bindTexture(r.TEXTURE_2D,this.texture),e!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,this.useMipmap?e===r.NEAREST?r.NEAREST_MIPMAP_NEAREST:r.LINEAR_MIPMAP_NEAREST:e),this.filter=e),t!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){var e=this.context["gl"];e.deleteTexture(this.texture),this.texture=null}}class Nf{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class jf{constructor(){this.tasks={},this.taskQueue=[],ie(["process"],this),this.invoker=new Nf(this.process),this.nextId=0}add(e,t){const r=this.nextId++,n=({type:i,isSymbolTile:o,zoom:a}=[t][0],a=a||0,"message"===i?0:"maybePrepare"!==i||o?"parseTile"!==i||o?"parseTile"===i&&o?300-a:"maybePrepare"===i&&o?400-a:500:200-a:100-a);var i,o,a;return 0==n?(pe(),e(),{cancel:()=>{}}):(this.tasks[r]={fn:e,metadata:t,priority:n,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}})}process(){var e,t;pe(),this.taskQueue=this.taskQueue.filter(e=>!!this.tasks[e]),this.taskQueue.length&&null!==(e=this.pick())&&(t=this.tasks[e],delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t&&t.fn())}pick(){let t=null,r=1/0;for(let e=0;e<this.taskQueue.length;e++){var n=this.tasks[this.taskQueue[e]];n.priority<r&&(r=n.priority,t=e)}var e;return null===t?null:(e=this.taskQueue[t],this.taskQueue.splice(t,1),e)}remove(){this.invoker.remove()}}class Uf{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){var r=t[e];this._stringToNumber[r]=e,this._numberToString[e]=r}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Vf=["tile","layer","source","sourceLayer","state"];class Gf{constructor(e,t,r,n,i){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=r,this._y=n,this.properties=e.properties,this.id=i}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){var e={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const t of Vf)void 0!==this[t]&&(e[t]=this[t]);return e}}const Wf=new Uint16Array(8184);for(let s=0;s<2046;s++){let e=s+2,t=0,r=0,n=0,i=0,o=0,a=0;for(1&e?n=i=o=32:t=r=a=32;1<(e>>=1);){const l=t+n>>1,F=r+i>>1;1&e?(n=t,i=r,t=o,r=a):(t=n,r=i,n=o,i=a),o=l,a=F}const F=4*s;Wf[0+F]=t,Wf[1+F]=r,Wf[2+F]=n,Wf[3+F]=i}const Zf=new Uint16Array(2178),qf=new Uint8Array(1089),Hf=new Uint16Array(1089);function $f(e){return 0===e?-.03125:32===e?.03125:0}var Xf=i([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Yf={type:2,extent:se,loadGeometry:()=>[[new I(0,0),new I(8193,0),new I(8193,8193),new I(0,8193),new I(0,0)]]};class Jf{constructor(e,t,r,n,i){this.tileID=e,this.uid=ee(),this.uses=0,this.tileSize=t,this.tileZoom=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=i,this.expiredRequestCount=0,this.state="loading",n&&n.transform&&(this.projection=n.transform.projection)}registerFadeDuration(e){e+=this.timeAdded;e<pt.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Jh(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,r){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){var r={};if(t)for(const n of e){const e=n.layerIds.map(e=>t.getLayer(e)).filter(Boolean);if(0!==e.length){n.layers=e,n.stateDependentLayerIds&&(n.stateDependentLayers=n.stateDependentLayerIds.map(t=>e.filter(e=>e.id===t)[0]));for(const t of e)r[t.id]=n}}return r}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const t=this.buckets[e];if(t instanceof Cf){if(this.hasSymbolBuckets=!0,!r)break;t.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const t=this.buckets[e];if(t instanceof Cf&&t.hasRTLText){this.hasRTLText=!0,go.isLoading()||go.isLoaded()||"deferred"!==fo()||po();break}}this.queryPadding=0;for(const e in this.buckets){const r=this.buckets[e];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(e).queryRadius(r))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new na}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const r in this.buckets){var t=this.buckets[r];t.uploadPending()&&t.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Bf(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Bf(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Bf(e,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,r,n,i,o,a,s){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:n,pixelPosMatrix:a,transform:o,params:i,tileTransform:this.tileTransform},e,t,r):{}}querySourceFeatures(t,e){var r=this.latestFeatureIndex;if(r&&r.rawTileData){const u=r.loadVTLayers(),c=e?e.sourceLayer:"",h=u._geojsonTileLayer||u[c];if(h){var n=Wn(e&&e.filter),{z:i,x:o,y:a}=this.tileID.canonical,s={z:i,x:o,y:a};for(let e=0;e<h.length;e++){const u=h.feature(e);if(n.needGeometry){const t=Sl(u,!0);if(!n.filter(new C(this.tileID.overscaledZ),t,this.tileID.canonical))continue}else if(!n.filter(new C(this.tileID.overscaledZ),u))continue;var l=r.getId(u,c),l=new Gf(u,i,o,a,l);l.tile=s,t.push(l)}}}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const r=me(t.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const t=Date.now();let e=!1;var n;this.expirationTime>t?e=!1:r&&!(this.expirationTime<r)&&(n=this.expirationTime-r)?this.expirationTime=t+Math.max(n,3e4):e=!0,e?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(e).length&&t){var r=this.latestFeatureIndex.loadVTLayers(),n=t.style.listImages();for(const s in this.buckets)if(t.style.hasLayer(s)){var i=this.buckets[s],o=i.layers[0].sourceLayer||"_geojsonTileLayer",a=r[o],o=e[o];if(a&&o&&0!==Object.keys(o).length){if(i.update(o,a,n,this.imageAtlas&&this.imageAtlas.patternPositions||{}),i instanceof xc||i instanceof Cu){const e=t.style._getSourceCache(i.layers[0].source);t._terrain&&t._terrain.enabled&&e&&i.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(e.id,this.tileID)}o=t&&t.style&&t.style.getLayer(s);o&&(this.queryPadding=Math.max(this.queryPadding,o.queryRadius(i)))}}}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<pt.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=pt.now()+e}setTexture(e,t){var r=t.context,n=r.gl;this.texture=this.texture||t.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Bf(r,e,n.RGBA,{useMipmap:!0}),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),r.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax))}setDependencies(e,t){var r={};for(const e of t)r[e]=!0;this.dependencies[e]=r}hasDependency(e,t){for(const r of e){const e=this.dependencies[r];if(e)for(const n of t)if(e[n])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,t){if(t&&"mercator"!==t.name&&!this._tileDebugBuffer){var r=Tl(Yf,this.tileID.canonical,this.tileTransform)[0],n=new Lo,i=new ea;for(let e=0;e<r.length;e++){const{x:t,y:o}=r[e];n.emplaceBack(t,o),i.emplaceBack(e)}i.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(i),this._tileDebugBuffer=e.createVertexBuffer(n,Ps.members),this._tileDebugSegments=w.simpleSegment(0,0,n.length,i.length)}}_makeTileBoundsBuffers(r,n){if(!this._tileBoundsBuffer&&n&&"mercator"!==n.name){var i=Tl(Yf,this.tileID.canonical,this.tileTransform)[0];let e,t;if(this.isRaster){const r=function(r,n){const i=Jh(r,n),o=Math.pow(2,r.z);for(let t=0;t<33;t++)for(let e=0;e<33;e++){const s=gl((r.x+(e+$f(e))/32)/o),u=E((r.y+(t+$f(t))/32)/o),c=n.project(s,u),h=33*t+e;Zf[2*h+0]=Math.round((c.x*i.scale-i.x)*se),Zf[2*h+1]=Math.round((c.y*i.scale-i.y)*se)}qf.fill(0),Hf.fill(0);for(let e=2045;0<=e;e--){const n=4*e,i=Wf[0+n],o=Wf[1+n],a=Wf[2+n],l=Wf[3+n],s=i+a>>1,u=o+l>>1,c=s+u-o,t=u+i-s,f=33*o+i,d=33*l+a,p=33*u+s,m=16<=Math.hypot((Zf[2*f+0]+Zf[2*d+0])/2-Zf[2*p+0],(Zf[2*f+1]+Zf[2*d+1])/2-Zf[2*p+1]);if(qf[p]=qf[p]||(m?1:0),e<1022){const r=33*(o+t>>1)+(i+c>>1),n=33*(l+t>>1)+(a+c>>1);qf[p]=qf[p]||qf[r]||qf[n]}}const a=new zo,l=new Ho;let s=0;function u(e,t){var r=33*t+e;return 0===Hf[r]&&(a.emplaceBack(Zf[2*r+0],Zf[2*r+1],e*se/32,t*se/32),Hf[r]=++s),Hf[r]-1}function c(e,t,r,n,i,o){const a=e+r>>1,s=t+n>>1;if(1<Math.abs(e-i)+Math.abs(t-o)&&qf[33*s+a])c(i,o,e,t,a,s),c(r,n,i,o,a,s);else{const c=u(e,t),a=u(r,n),s=u(i,o);l.emplaceBack(c,a,s)}}return c(0,0,32,32,32,0),c(32,32,0,0,0,32),{vertices:a,indices:l}}(this.tileID.canonical,n);e=r.vertices,t=r.indices}else{e=new zo,t=new Ho;for(const{x:r,y:n}of i)e.emplaceBack(r,n,0,0);const r=nu(e.int16,void 0,4);for(let e=0;e<r.length;e+=3)t.emplaceBack(r[e],r[e+1],r[e+2])}this._tileBoundsBuffer=r.createVertexBuffer(e,Xf.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(t),this._tileBoundsSegments=w.simpleSegment(0,0,e.length,t.length)}}_makeGlobeTileDebugBuffers(t,r){var n=r.projection;if(n&&"globe"===n.name&&!r.freezeTileCoverage){var n=this.tileID.canonical,i=tl(qs(n,r)),o=il(r.zoom);let e;0<o&&(e=Ka(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,n,r,i,e,o),this._makeGlobeTileDebugTextBuffer(t,n,r,i,e,o)}}_globePoint(t,r,n,i,o,a,s){let l=Ks(t,r,n);if(a){const o=1<<n.z,u=dl(i.center.lng),c=pl(i.center.lat),h=(n.x+.5)/o-u;let e=0;.5<h?e=-1:h<-.5&&(e=1);t=(t/se+n.x)/o+e,r=(r/se+n.y)/o,t=(t-u)*i._pixelsPerMercatorPixel+u,r=(r-c)*i._pixelsPerMercatorPixel+c,n=[t*i.worldSize,r*i.worldSize,0];Ee(n,n,a),l=Zs(l,n,s)}return Ee(l,l,o)}_makeGlobeTileDebugBorderBuffer(e,u,c,h,f,d){const p=new Lo,m=new ea,g=new Po,t=(t,r,e,n,i)=>{var o=(e-t)/(i-1),a=(n-r)/(i-1),s=p.length;for(let e=0;e<i;e++){const n=t+e*o,i=r+e*a;p.emplaceBack(n,i);var l=this._globePoint(n,i,u,c,h,f,d);g.emplaceBack(l[0],l[1],l[2]),m.emplaceBack(s+e)}},r=se;t(0,0,r,0,16),t(r,0,r,r,16),t(r,r,0,r,16),t(0,r,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(m),this._tileDebugBuffer=e.createVertexBuffer(p,Ps.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(g,Ls.members),this._tileDebugSegments=w.simpleSegment(0,0,p.length,m.length)}_makeGlobeTileDebugTextBuffer(e,t,r,n,i,o){const a=new Lo,s=new Ho,l=new Po,u=25,c=(s.reserve(32),a.reserve(u),l.reserve(u),(e,t)=>u*e+t);for(let e=0;e<u;e++){const s=2048*e;for(let e=0;e<u;e++){const u=2048*e,c=(a.emplaceBack(u,s),this._globePoint(u,s,t,r,n,i,o));l.emplaceBack(c[0],c[1],c[2])}}for(let t=0;t<4;t++)for(let e=0;e<4;e++){const r=c(t,e),n=c(t,e+1),i=c(t+1,e),o=c(t+1,e+1);s.emplaceBack(r,n,i),s.emplaceBack(i,n,o)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(s),this._tileDebugTextBuffer=e.createVertexBuffer(a,Ps.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(l,Ls.members),this._tileDebugTextSegments=w.simpleSegment(0,0,u,32)}}class Kf{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,r){var n=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][n]=this.stateChanges[e][n]||{},_(this.stateChanges[e][n],r),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==n&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][n]){this.deletedStates[e][n]={};for(const t in this.state[e][n])r[t]||(this.deletedStates[e][n][t]=null)}else for(const t in r)this.deletedStates[e]&&this.deletedStates[e][n]&&null===this.deletedStates[e][n][t]&&delete this.deletedStates[e][n][t]}removeFeatureState(e,t,r){if(null!==this.deletedStates[e]){var n=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&void 0!==t)null!==this.deletedStates[e][n]&&(this.deletedStates[e][n]=this.deletedStates[e][n]||{},this.deletedStates[e][n][r]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][n])for(r in this.deletedStates[e][n]={},this.stateChanges[e][n])this.deletedStates[e][n][r]=null;else this.deletedStates[e][n]=null;else this.deletedStates[e]=null}}getState(e,t){const r=String(t),n=_({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const r=this.deletedStates[e][t];if(null===r)return{};for(const e in r)delete n[e]}return n}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const r={};for(const e in this.stateChanges){this.state[e]=this.state[e]||{};const t={};for(const r in this.stateChanges[e])this.state[e][r]||(this.state[e][r]={}),_(this.state[e][r],this.stateChanges[e][r]),t[r]=this.state[e][r];r[e]=t}for(const e in this.deletedStates){this.state[e]=this.state[e]||{};const t={};if(null===this.deletedStates[e])for(const r in this.state[e])t[r]={},this.state[e][r]={};else for(const r in this.deletedStates[e]){if(null===this.deletedStates[e][r])this.state[e][r]={};else if(this.state[e][r])for(const t of Object.keys(this.deletedStates[e][r]))delete this.state[e][r][t];t[r]=this.state[e][r]}r[e]=r[e]||{},_(r[e],t)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(const n in e)e[n].setFeatureState(r,t)}}class Qf{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){e=this.toIdx(e,t);return{min:this.minimums[e],max:this.maximums[e]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function ed(n,i,o,a){let s=0,l=Number.MAX_VALUE;for(let r=0;r<3;r++)if(Math.abs(a[r])<1e-15){if(o[r]<n[r]||o[r]>i[r])return null}else{var u=1/a[r];let e=(n[r]-o[r])*u,t=(i[r]-o[r])*u;if(e>t){const n=e;e=t,t=n}if(e>s&&(s=e),t<l&&(l=t),s>l)return null}return s}function td(e,t,r,n,i,o,a,s,l,u,c){var n=n-e,i=i-t,o=o-r,a=a-e,s=s-t,l=l-r,h=c[1]*l-c[2]*s,f=c[2]*a-c[0]*l,d=c[0]*s-c[1]*a,p=n*h+i*f+o*d;return Math.abs(p)<1e-15||(u=((e=u[0]-e)*h+(h=u[1]-t)*f+(t=u[2]-r)*d)*(f=1/p))<0||1<u||(t=(c[0]*(r=h*o-t*i)+c[1]*(d=t*n-e*o)+c[2]*(p=e*i-h*n))*f)<0||1<u+t?null:(a*r+s*d+l*p)*f}function rd(e,t,r){return(e-t)/(r-t)}function nd(e,t,r,n,i,o,a,s,l){var r=1<<r,o=o-n,a=a-i,u=(e+1)/r*o+n,c=(t+0)/r*a+i,t=(t+1)/r*a+i;s[0]=(e+0)/r*o+n,s[1]=c,l[0]=u,l[1]=t}class id{constructor(e){var t,r;this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],this.dem&&(r=(e=function(t){const e=Math.ceil(Math.log2(t.dim/8)),r=[];let n=Math.ceil(Math.pow(2,e));const i=1/n,o=(e,t,r,n,i)=>{var n=n?1:0,o=(e+1)*r-n,a=t*r,t=(t+1)*r-n;i[0]=e*r,i[1]=a,i[2]=o,i[3]=t};let a=new Qf(n);var s=[];for(let e=0;e<n*n;e++){o(e%n,Math.floor(e/n),i,!1,s);const r=ad(s[0],s[1],t),l=ad(s[2],s[1],t),u=ad(s[2],s[3],t),c=ad(s[0],s[3],t);a.minimums.push(Math.min(r,l,u,c)),a.maximums.push(Math.max(r,l,u,c)),a.leaves.push(1)}for(r.push(a),n/=2;1<=n;n/=2){const t=r[r.length-1];a=new Qf(n);for(let e=0;e<n*n;e++){o(e%n,Math.floor(e/n),2,!0,s);const r=t.getElevation(s[0],s[1]),i=t.getElevation(s[2],s[1]),h=t.getElevation(s[2],s[3]),f=t.getElevation(s[0],s[3]),d=t.isLeaf(s[0],s[1]),p=t.isLeaf(s[2],s[1]),m=t.isLeaf(s[2],s[3]),g=t.isLeaf(s[0],s[3]),y=Math.min(r.min,i.min,h.min,f.min),v=Math.max(r.max,i.max,h.max,f.max),_=d&&p&&m&&g;a.maximums.push(v),a.minimums.push(y),a.leaves.push(v-y<=5&&_?1:0)}r.push(a)}return r}(this.dem))[t=e.length-1],this._addNode(r.minimums[0],r.maximums[0],r.leaves[0]),this._construct(e,0,0,t,0))}raycastRoot(e,t,r,n,i,o,a=1){return ed([e,t,-100],[r,n,this.maximums[0]*a],i,o)}raycast(i,t,e,o,a,s,l=1){if(this.nodeCount){const c=this.raycastRoot(i,t,e,o,a,s,l);if(null!=c){const h=[],f=[],d=[],p=[],r=[{idx:0,t:c,nodex:0,nodey:0,depth:0}];for(;0<r.length;){const{idx:c,t:n,nodex:m,nodey:g,depth:y}=r.pop();if(this.leaves[c]){nd(m,g,y,i,t,e,o,d,p);const c=1<<y,h=(m+0)/c,f=(m+1)/c,r=(g+0)/c,v=(g+1)/c,_=ad(h,r,this.dem)*l,x=ad(f,r,this.dem)*l,b=ad(f,v,this.dem)*l,w=ad(h,v,this.dem)*l,E=td(d[0],d[1],_,p[0],d[1],x,p[0],p[1],b,a,s),T=td(p[0],p[1],b,d[0],p[1],w,d[0],d[1],_,a,s),S=Math.min(null!==E?E:Number.MAX_VALUE,null!==T?T:Number.MAX_VALUE);if(S!==Number.MAX_VALUE)return S;{const i=gs([],a,s,n);if(od(_,x,w,b,rd(i[0],d[0],p[0]),rd(i[1],d[1],p[1]))>=i[2])return n}}else{let n=0;for(let r=0;r<this._siblingOffset.length;r++){nd((m<<1)+this._siblingOffset[r][0],(g<<1)+this._siblingOffset[r][1],y+1,i,t,e,o,d,p),d[2]=-100,p[2]=this.maximums[this.childOffsets[c]+r]*l;var u=ed(d,p,a,s);if(null!=u){const i=u;h[r]=i;let t=!1;for(let e=0;e<n&&!t;e++)i>=h[f[e]]&&(f.splice(e,0,r),t=!0);t||(f[n]=r),n++}}for(let e=0;e<n;e++){const t=f[e];r.push({idx:this.childOffsets[c]+t,t:h[t],nodex:(m<<1)+this._siblingOffset[t][0],nodey:(g<<1)+this._siblingOffset[t][1],depth:y+1})}}}}}return null}_addNode(e,t,r){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(n,i,o,a,s){if(1!==n[a].isLeaf(i,o)){this.childOffsets[s]||(this.childOffsets[s]=this.nodeCount);const l=a-1,u=n[l];let t=0,r=0;for(let e=0;e<this._siblingOffset.length;e++){const a=2*i+this._siblingOffset[e][0],s=2*o+this._siblingOffset[e][1],l=u.getElevation(a,s),c=u.isLeaf(a,s),h=this._addNode(l.min,l.max,c);c&&(t|=1<<e),r=r||h}for(let e=0;e<this._siblingOffset.length;e++)t&1<<e||this._construct(n,2*i+this._siblingOffset[e][0],2*o+this._siblingOffset[e][1],l,r+e)}}}function od(e,t,r,n,i,o){return k(k(e,r,o),k(t,n,o),i)}function ad(e,t,r){var n=r.dim,e=S(e*n-.5,0,n-1),t=S(t*n-.5,0,n-1),i=Math.floor(e),o=Math.floor(t),a=Math.min(i+1,n-1),n=Math.min(o+1,n-1);return od(r.get(i,o),r.get(a,o),r.get(i,n),r.get(a,n),e-i,t-o)}const sd={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class ld{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,r,n=!1,i=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return ae(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;var o=this.dim=t.height-2,a=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.encoding=r||"mapbox",!(this.borderReady=n)){for(let e=0;e<o;e++)a[this._idx(-1,e)]=a[this._idx(0,e)],a[this._idx(o,e)]=a[this._idx(o-1,e)],a[this._idx(e,-1)]=a[this._idx(e,0)],a[this._idx(e,o)]=a[this._idx(e,o-1)];a[this._idx(-1,-1)]=a[this._idx(0,0)],a[this._idx(o,-1)]=a[this._idx(o-1,0)],a[this._idx(-1,o)]=a[this._idx(0,o-1)],a[this._idx(o,o)]=a[this._idx(o-1,o-1)],i&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new id(this)}get(e,t,r=!1){r&&(e=S(e,-1,this.dim),t=S(t,-1,this.dim));r=4*this._idx(e,t);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[r],this.pixels[1+r],this.pixels[2+r])}static getUnpackVector(e){return sd[e]}get unpackVector(){return sd[this.encoding]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}_unpackMapbox(e,t,r){return(256*e*256+256*t+r)/10-1e4}_unpackTerrarium(e,t,r){return 256*e+t+r/256-32768}static pack(e,t){var r=[0,0,0,0],t=ld.getUnpackVector(t),e=Math.floor((e+t[3])/t[2]);return r[2]=e%256,e=Math.floor(e/256),r[1]=e%256,e=Math.floor(e/256),r[0]=e,r}getPixels(){return new Jl({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,e,t){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let n=e*this.dim,i=e*this.dim+this.dim,o=t*this.dim,a=t*this.dim+this.dim;switch(e){case-1:n=i-1;break;case 1:i=n+1}switch(t){case-1:o=a-1;break;case 1:a=o+1}var s=-e*this.dim,l=-t*this.dim;for(let t=o;t<a;t++)for(let e=n;e<i;e++){const n=4*this._idx(e,t),i=4*this._idx(e+s,t+l);this.pixels[0+n]=r.pixels[0+i],this.pixels[1+n]=r.pixels[1+i],this.pixels[2+n]=r.pixels[2+i],this.pixels[3+n]=r.pixels[3+i]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}e(ld,"DEMData"),e(id,"DemMinMaxQuadTree",{omit:["dem"]});class ud{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,r){var n=e.wrapped().key;void 0===this.data[n]&&(this.data[n]=[]);const i={value:t,timeout:void 0};if(void 0!==r&&(i.timeout=setTimeout(()=>{this.remove(e,i)},r)),this.data[n].push(i),this.order.push(n),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){var t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){e=this.data[e];return e?e[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){var r;return this.has(e)&&(e=e.wrapped().key,t=void 0===t?0:this.data[e].indexOf(t),r=this.data[e][t],this.data[e].splice(t,1),r.timeout&&clearTimeout(r.timeout),0===this.data[e].length&&delete this.data[e],this.onRemove(r.value),this.order.splice(this.order.indexOf(e),1)),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){var t=[];for(const r in this.data)for(const n of this.data[r])e(n.value)||t.push(n);for(const e of t)this.remove(e.value.tileID,e)}}class cd{constructor(e,t,r){this.func=e,this.mask=t,this.range=r}}cd.ReadOnly=!1,cd.ReadWrite=!0,cd.disabled=new cd(519,cd.ReadOnly,[0,1]);class hd{constructor(e,t,r,n,i,o){this.test=e,this.ref=t,this.mask=r,this.fail=n,this.depthFail=i,this.pass=o}}hd.disabled=new hd({func:519,mask:0},0,0,7680,7680,7680);class fd{constructor(e,t,r){this.blendFunction=e,this.blendColor=t,this.mask=r}}fd.disabled=new fd(fd.Replace=[1,0],y.transparent,[!1,!1,!1,!1]),fd.unblended=new fd(fd.Replace,y.transparent,[!0,!0,!0,!0]),fd.alphaBlended=new fd([1,771],y.transparent,[!0,!0,!0,!0]);class dd{constructor(e,t,r){this.enable=e,this.mode=t,this.frontFace=r}}dd.disabled=new dd(!1,1029,2305),dd.backCCW=new dd(!0,1029,2305),dd.backCW=new dd(!0,1029,2304),dd.frontCW=new dd(!0,1028,2304),dd.frontCCW=new dd(!0,1028,2305);class pd extends _t{constructor(e,t,r){super(),this.id=e,this._onlySymbols=r,t.on("data",e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),t.on("error",()=>{this._sourceErrored=!0}),this._source=t,this._tiles={},this._cache=new ud(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Kf,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=(void 0===this._minTileCacheSize&&e?e:this)._minTileCacheSize,this._maxTileCacheSize=(void 0===this._maxTileCacheSize&&e?e:this)._maxTileCacheSize}loaded(){if(!this._sourceErrored){if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){var e;this._paused&&(e=this._shouldReloadOnResume,this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform))}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){var t=this._tiles[r];t.upload(e),t.prepare(this.map.style.imageManager)}}getIds(){return K(this._tiles).map(e=>e.tileID).sort(md).map(e=>e.key)}getRenderableIds(e){var t=[];for(const r in this._tiles)this._isIdRenderable(+r,e)&&t.push(this._tiles[r]);return e?t.sort((e,t)=>{var e=e.tileID,t=t.tileID,r=new I(e.canonical.x,e.canonical.y)._rotate(this.transform.angle),n=new I(t.canonical.x,t.canonical.y)._rotate(this.transform.angle);return e.overscaledZ-t.overscaledZ||n.y-r.y||n.x-r.x}).map(e=>e.tileID.key):t.map(e=>e.tileID).sort(md).map(e=>e.key)}hasRenderableParent(e){e=this.findLoadedParent(e,0);return!!e&&this._isIdRenderable(e.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){var r=this._tiles[e];r&&("loading"!==r.state&&(r.state=t),this._loadTile(r,this._tileLoaded.bind(this,r,e,t)))}_tileLoaded(e,t,r,n){if(n)if(e.state="errored",404!==n.status)this._source.fire(new vt(n,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const e=this.map.painter.terrain;this.update(this.transform,e.getScaledDemTileSize(),!0),e.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=pt.now(),"expired"===r&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new yt("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const r=this.getRenderableIds();for(let e=0;e<r.length;e++){var n=r[e];if(t.neighboringTiles&&t.neighboringTiles[n]){const r=this.getTileByID(n);i(t,r),i(r,t)}}function i(t,r){if(t.dem&&!t.dem.borderReady){t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0;let e=r.tileID.canonical.x-t.tileID.canonical.x;var n=r.tileID.canonical.y-t.tileID.canonical.y,i=Math.pow(2,t.tileID.canonical.z),o=r.tileID.key;0===e&&0==n||1<Math.abs(n)||(1<Math.abs(e)&&(1===Math.abs(e+i)?e+=i:1===Math.abs(e-i)&&(e-=i)),r.dem&&t.dem&&(t.dem.backfillBorder(r.dem,e,n),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(n,i,e,o){for(const t in this._tiles){let r=this._tiles[t];if(!(o[t]||!r.hasData()||r.tileID.overscaledZ<=i||r.tileID.overscaledZ>e)){let e=r.tileID;for(;r&&r.tileID.overscaledZ>i+1;){const n=r.tileID.scaledTo(r.tileID.overscaledZ-1);(r=this._tiles[n.key])&&r.hasData()&&(e=n)}let t=e;for(;t.overscaledZ>i;)if(n[(t=t.scaledTo(t.overscaledZ-1)).key]){o[e.key]=e;break}}}}findLoadedParent(t,r){var e;if(t.key in this._loadedParentTiles)return(e=this._loadedParentTiles[t.key])&&e.tileID.overscaledZ>=r?e:null;for(let e=t.overscaledZ-1;e>=r;e--){const r=t.scaledTo(e),n=this._getLoadedTile(r);if(n)return n}}_getLoadedTile(e){var t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey((this._source.reparseOverscaled?e.wrapped():e.canonical).key)}updateCacheSize(e,t){t=t||this._source.tileSize;var r=Math.ceil(e.width/t)+1,e=Math.ceil(e.height/t)+1,t=Math.floor(r*e*5),r="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,t):t,e="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(e)}handleWrapJump(e){var t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const n in this._tiles){var r=this._tiles[n];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),e[r.tileID.key]=r}this._tiles=e;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(+e,this._tiles[e])}}update(t,r,n){if(this.transform=t,this._sourceLoaded&&!this._paused&&!this.transform.freezeTileCoverage&&(!this.usedForTerrain||n)){let e;this.updateCacheSize(t,r),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?e=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(e=>new lc(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)):(e=t.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(e=e.filter(e=>this._source.hasTile(e)))):e=[];var i,o=this._updateRetainedTiles(e);if(gd(this._source.type)&&0!==e.length){const t={},r={},n=Object.keys(o);for(const e of n){const n=o[e],a=this._tiles[e];!a||a.fadeEndTime&&a.fadeEndTime<=pt.now()||((i=this.findLoadedParent(n,Math.max(n.overscaledZ-pd.maxOverzooming,this._source.minzoom)))&&(this._addTile(i.tileID),t[i.tileID.key]=i.tileID),r[e]=n)}const a=e[e.length-1].overscaledZ;for(const t in this._tiles){const n=this._tiles[t];if(!o[t]&&n.hasData()){let e=n.tileID;for(;e.overscaledZ>a;){e=e.scaledTo(e.overscaledZ-1);const a=this._tiles[e.key];if(a&&a.hasData()&&r[e.key]){o[t]=n.tileID;break}}}}for(const r in t)o[r]||(this._coveredTiles[r]=!0,o[r]=t[r])}for(const t in o)this._tiles[t].clearFadeHold();const a=function(e,t){var r=[];for(const n in e)n in t||r.push(n);return r}(this._tiles,o);for(const t of a){const r=this._tiles[t];r.hasSymbolBuckets&&!r.holdingForFade()?r.setHoldDuration(this.map._fadeDuration):r.hasSymbolBuckets&&!r.symbolFadeFinished()||this._removeTile(+t)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){var n={};if(0!==e.length){const i={},o=e.reduce((e,t)=>Math.min(e,t.overscaledZ),1/0),t=e[0].overscaledZ,a=Math.max(t-pd.maxOverzooming,this._source.minzoom),r=Math.max(t+pd.maxUnderzooming,this._source.minzoom),s={};for(const i of e){const e=this._addTile(i);n[i.key]=i,e.hasData()||o<this._source.maxzoom&&(s[i.key]=i)}this._retainLoadedChildren(s,o,r,n);for(const o of e){let r=this._tiles[o.key];if(!r.hasData()){if(o.canonical.z>=this._source.maxzoom){const e=o.children(this._source.maxzoom)[0],i=this.getTile(e);if(i&&i.hasData()){n[e.key]=e;continue}}else{const e=o.children(this._source.maxzoom);if(n[e[0].key]&&n[e[1].key]&&n[e[2].key]&&n[e[3].key])continue}let t=r.wasRequested();for(let e=o.overscaledZ-1;e>=a;--e){const a=o.scaledTo(e);if(i[a.key])break;if(i[a.key]=!0,(r=!(r=this.getTile(a))&&t?this._addTile(a):r)&&(n[a.key]=a,t=r.wasRequested(),r.hasData()))break}}}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){var r=[];let e,t=this._tiles[i].tileID;for(;0<t.overscaledZ;){if(t.key in this._loadedParentTiles){e=this._loadedParentTiles[t.key];break}r.push(t.key);var n=t.scaledTo(t.overscaledZ-1);if(e=this._getLoadedTile(n))break;t=n}for(const o of r)this._loadedParentTiles[o]=e}}_addTile(e){let t=this._tiles[e.key];if(t)return t;(t=this._cache.getAndRemove(e))&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const r=Boolean(t);if(!r){const r=this.map?this.map.painter:null;t=new Jf(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,r,this._isRaster),this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,r||this._source.fire(new yt("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);t=t.getExpiryTimeout();t&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},t))}_removeTile(e){var t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),0<t.uses||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,r,n){var i=[],o=this.transform;if(o){const s="globe"===o.projection.name,l=dl(o.center.lng);for(const e in this._tiles){var a=this._tiles[e];if(n&&a.clearQueryDebugViz(),!a.holdingForFade()){let e;if(s){const t=a.tileID.canonical;if(0===t.z){const r=[Math.abs(S(l,...yd(t,-1))-l),Math.abs(S(l,...yd(t,1))-l)];e=[0,2*r.indexOf(Math.min(...r))-1]}else{const r=[Math.abs(S(l,...yd(t,-1))-l),Math.abs(S(l,...yd(t,0))-l),Math.abs(S(l,...yd(t,1))-l)];e=[r.indexOf(Math.min(...r))-1]}}else e=[0];for(const n of e){const s=t.containsTile(a,o,r,n);s&&i.push(s)}}}}return i}getVisibleCoordinates(e){var t=this.getRenderableIds(e).map(e=>this._tiles[e].tileID);for(const e of t)e.projMatrix=this.transform.calculateProjMatrix(e.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return!0;if(gd(this._source.type))for(const t in this._tiles){var e=this._tiles[t];if(void 0!==e.fadeEndTime&&e.fadeEndTime>=pt.now())return!0}return!1}setFeatureState(e,t,r){this._state.updateState(e=e||"_geojsonTileLayer",t,r)}removeFeatureState(e,t,r){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,r)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,r){e=this._tiles[e];e&&e.setDependencies(t,r)}reloadTilesForDependencies(t,r){for(const e in this._tiles)this._tiles[e].hasDependency(t,r)&&this._reloadTile(+e,"reloading");this._cache.filter(e=>!e.hasDependency(t,r))}_preloadTiles(e,t){var r=new Map,n=Array.isArray(e)?e:[e],e=this.map.painter.terrain,i=this.usedForTerrain&&e?e.getScaledDemTileSize():this._source.tileSize;for(const e of n){const t=e.coveringTiles({tileSize:i,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const e of t)r.set(e.key,e);this.usedForTerrain&&e.updateElevation(!1)}J(Array.from(r.values()),(e,t)=>{const r=new Jf(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(r,e=>{"raster-dem"===this._source.type&&r.dem&&this._backfillDEM(r),t(e,r)})},t)}}function md(e,t){var r=Math.abs(2*e.wrap)-(e.wrap<0),n=Math.abs(2*t.wrap)-(t.wrap<0);return e.overscaledZ-t.overscaledZ||n-r||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function gd(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function yd(e,t){var r=1<<e.z;return[e.x/r+t,(e.x+1)/r+t]}pd.maxOverzooming=10,pd.maxUnderzooming=3;class vd{constructor(e,t,r){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=r}static create(e,t,r){var n,i,r=r||e.findDEMTileFor(t);if(r&&r.dem)return e=r.dem,n=r.tileID,i=1<<t.canonical.z-n.canonical.z,new vd(r,r.tileSize/se/i,[(t.canonical.x/i-n.canonical.x)*e.dim,(t.canonical.y/i-n.canonical.y)*e.dim])}tileCoordToPixel(e,t){t=t*this._scale+this._offset[1],e=Math.floor(e*this._scale+this._offset[0]),t=Math.floor(t);return new I(e,t)}getElevationAt(e,t,r,n){var e=e*this._scale+this._offset[0],t=t*this._scale+this._offset[1],i=Math.floor(e),o=Math.floor(t),a=this._dem;return n=!!n,r?k(k(a.get(i,o,n),a.get(i,o+1,n),t-o),k(a.get(i+1,o,n),a.get(i+1,o+1,n),t-o),e-i):a.get(i,o,n)}getElevationAtPixel(e,t,r){return this._dem.get(e,t,!!r)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ml(1,e)*this._dem.stride}}class _d{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new vi(se,16,0),this.featureIndexArray=new ha,this.promoteId=t}insert(e,t,r,n,i,o=0){var a=this.featureIndexArray.length,s=(this.featureIndexArray.emplaceBack(r,n,i,o),this.grid);for(let e=0;e<t.length;e++){const r=t[e],n=[1/0,1/0,-1/0,-1/0];for(let e=0;e<r.length;e++){const t=r[e];n[0]=Math.min(n[0],t.x),n[1]=Math.min(n[1],t.y),n[2]=Math.max(n[2],t.x),n[3]=Math.max(n[3],t.y)}n[0]<se&&n[1]<se&&0<=n[2]&&0<=n[3]&&s.insert(a,n[0],n[1],n[2],n[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Vu(new Nc(this.rawTileData)).layers,this.sourceLayerCoder=new Uf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(o,t,r,n){this.loadVTLayers();const a=o.params||{},s=Wn(a.filter),l=o.tileResult,e=o.transform,u=l.bufferedTilespaceBounds,i=this.grid.query(u.min.x,u.min.y,u.max.x,u.max.y,(e,t,r,n)=>Fl(l.bufferedTilespaceGeometry,e,t,r,n));i.sort(bd);let c=null;e.elevation&&0<i.length&&(c=vd.create(e.elevation,this.tileID));var h={};let f;for(let e=0;e<i.length;e++){const u=i[e];if(u!==f){f=u;var d=this.featureIndexArray.get(u);let i=null;this.loadMatchingFeature(h,d,s,a.layers,a.availableImages,t,r,n,(e,t,r,n=0)=>(i=i||Tl(e,this.tileID.canonical,o.tileTransform),t.queryIntersectsFeature(l,e,r,i,this.z,o.transform,o.pixelPosMatrix,c,n)))}}return h}loadMatchingFeature(t,e,r,n,i,o,a,s,l){const{featureIndex:u,bucketIndex:c,sourceLayerIndex:h,layoutVertexArrayOffset:f}=e,d=this.bucketLayerIDs[c];if(!n||function(t,r){for(let e=0;e<t.length;e++)if(0<=r.indexOf(t[e]))return 1}(n,d)){const y=this.sourceLayerCoder.decode(h),v=this.vtLayers[y].feature(u);if(r.needGeometry){const t=Sl(v,!0);if(!r.filter(new C(this.tileID.overscaledZ),t,this.tileID.canonical))return}else if(!r.filter(new C(this.tileID.overscaledZ),v))return;var p=this.getId(v,y);for(let e=0;e<d.length;e++){const r=d[e];if(!(n&&n.indexOf(r)<0)){const c=o[r];if(c){let e={};void 0!==p&&s&&(e=s.getState(c.sourceLayer||"_geojsonTileLayer",p));const y=_({},a[r]);y.paint=xd(y.paint,c.paint,v,e,i),y.layout=xd(y.layout,c.layout,v,e,i);var m=!l||l(v,c,e,f);if(m){var g=new Gf(v,this.z,this.x,this.y,p);g.layer=y;let e=t[r];(e=void 0===e?t[r]=[]:e).push({featureIndex:u,feature:g,intersectionZ:m})}}}}}}lookupSymbolFeatures(e,t,r,n,i,o,a,s){var l={},u=(this.loadVTLayers(),Wn(i));for(const i of e)this.loadMatchingFeature(l,{bucketIndex:r,sourceLayerIndex:n,featureIndex:i,layoutVertexArrayOffset:0},u,o,a,s,t);return l}loadFeature(e){var{featureIndex:e,sourceLayerIndex:t}=e,t=(this.loadVTLayers(),this.sourceLayerCoder.decode(t)),r=this.vtFeatures[t];return r[e]||(t=this.vtLayers[t].feature(e),r[e]=t)}hasLayer(e){for(const t of this.bucketLayerIDs)for(const r of t)if(e===r)return!0;return!1}getId(e,t){let r=e.id;return this.promoteId&&(t="string"==typeof this.promoteId?this.promoteId:this.promoteId[t],"boolean"==typeof(r=null!=t?e.properties[t]:r)&&(r=Number(r))),r}}function xd(e,r,n,i,o){return ue(e,(e,t)=>{t=r instanceof To?r.get(t):null;return t&&t.evaluate?t.evaluate(n,i,o):t})}function bd(e,t){return t-e}e(_d,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class wd{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new Yl({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){e=this.getKey(e,t);return this.positions[e]}trim(){var e=this.width,t=this.height=re(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(t,e,r){var n=[];let i=t.length%2==1?-t[t.length-1]*r:0,o=t[0]*r,a=!0,s=(n.push({left:i,right:o,isDash:a,zeroLength:0===t[0]}),t[0]);for(let e=1;e<t.length;e++){a=!a;var l=t[e];i=s*r,o=(s+=l)*r,n.push({left:i,right:o,isDash:a,zeroLength:0===l})}return n}addRoundDash(o,e,a){var s=e/2;for(let i=-a;i<=a;i++){var l=this.width*(this.nextRow+a+i);let r=0,n=o[r];for(let t=0;t<this.width;t++){1<t/n.right&&(n=o[++r]);var u=Math.abs(t-n.left),c=Math.abs(t-n.right),u=Math.min(u,c);let e;c=i/a*(1+s);if(n.isDash){const o=s-Math.abs(c);e=Math.sqrt(u*u+o*o)}else e=s-Math.sqrt(u*u+c*c);this.image.data[l+t]=Math.max(0,Math.min(255,e+128))}}}addRegularDash(t,r){for(let e=t.length-1;0<=e;--e){const n=t[e],i=t[e+1];n.zeroLength?t.splice(e,1):i&&i.isDash===n.isDash&&(i.left=n.left,t.splice(e,1))}const n=t[0],i=t[t.length-1];n.isDash===i.isDash&&(n.left=i.left-this.width,i.right=n.right+this.width);var o=this.width*this.nextRow;let a=0,s=t[a];for(let e=0;e<this.width;e++){1<e/s.right&&(s=t[++a]);const i=Math.abs(e-s.left),l=Math.abs(e-s.right),u=Math.min(i,l);this.image.data[o+e]=Math.max(0,Math.min(255,(s.isDash?u:-u)+r+128))}}addDash(t,e){const r=this.getKey(t,e);if(this.positions[r])return this.positions[r];const n="round"===e,i=n?7:0,o=2*i+1;if(this.nextRow+o>this.height)return ae("LineAtlas out of space"),null;0===t.length&&t.push(1);let a=0;for(let e=0;e<t.length;e++)t[e]<0&&(ae("Negative value is found in line dasharray, replacing values with 0"),t[e]=0),a+=t[e];if(0!==a){const r=this.width/a,o=this.getDashRanges(t,this.width,r);n?this.addRoundDash(o,r,i):this.addRegularDash(o,"square"===e?.5*r:0)}e=this.nextRow+i,this.nextRow+=o,e={tl:[e,i],br:[a,0]};return this.positions[r]=e}}e(wd,"LineAtlas");class Ed{constructor(e){const t={},r=[];for(const n in e){const i=e[n],o=t[n]={};for(const e in i.glyphs){const t=i.glyphs[+e];if(t&&0!==t.bitmap.width&&0!==t.bitmap.height){const n=t.metrics.localGlyph?2:1,l={x:0,y:0,w:t.bitmap.width+2*n,h:t.bitmap.height+2*n};r.push(l),o[e]=l}}}const{w:n,h:i}=sh(r),o=new Yl({width:n||1,height:i||1});for(const r in e){const n=e[r];for(const e in n.glyphs){const i=n.glyphs[+e];var a,s;i&&0!==i.bitmap.width&&0!==i.bitmap.height&&(a=t[r][e],s=i.metrics.localGlyph?2:1,Yl.copy(i.bitmap,o,{x:0,y:0},{x:a.x+s,y:a.y+s},i.bitmap))}}this.image=o,this.positions=t}}e(Ed,"GlyphAtlas");class Td{constructor(e){this.tileID=new lc(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Jh(e.tileID.canonical,e.projection),this.projection=e.projection}parse(r,n,i,o,a){this.status="parsing",this.data=r,this.collisionBoxArray=new na;const s=new Uf(Object.keys(r.layers).sort()),l=new _d(this.tileID,this.promoteId),u=(l.bucketLayerIDs=[],{}),c=new wd(256,256),h={featureIndex:l,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:c,availableImages:i},f=n.familiesBySource[this.source];for(const n in f){const o=r.layers[n];if(o){let e=!1,t=!1;for(const r of f[n])"symbol"===r[0].type?e=!0:t=!0;if((!0!==this.isSymbolTile||e)&&(!1!==this.isSymbolTile||t)){1===o.version&&ae(`Vector tile source "${this.source}" layer "${n}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const d=s.encode(n),p=[];for(let e=0;e<o.length;e++){const i=o.feature(e),a=l.getId(i,n);p.push({feature:i,id:a,index:e,sourceLayerIndex:d})}for(const r of f[n]){const n=r[0];void 0!==this.isSymbolTile&&"symbol"===n.type!==this.isSymbolTile||n.minzoom&&this.zoom<Math.floor(n.minzoom)||n.maxzoom&&this.zoom>=n.maxzoom||"none"!==n.visibility&&(Sd(r,this.zoom,i),(u[n.id]=n.createBucket({index:l.bucketLayerIDs.length,layers:r,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:d,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:i})).populate(p,h,this.tileID.canonical,this.tileTransform),l.bucketLayerIDs.push(r.map(e=>e.id)))}}}}let d,p,m,g;c.trim();var n={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},e=ue(h.glyphDependencies,e=>Object.keys(e).map(Number)),e=(Object.keys(e).length?o.send("getGlyphs",{uid:this.uid,stacks:e},(e,t)=>{d||(d=e,p=t,y.call(this))},void 0,!1,n):p={},Object.keys(h.iconDependencies)),e=(e.length?o.send("getImages",{icons:e,source:this.source,tileID:this.tileID,type:"icons"},(e,t)=>{d||(d=e,m=t,y.call(this))},void 0,!1,n):m={},Object.keys(h.patternDependencies));function y(){if(d)return a(d);if(p&&m&&g){var e=new Ed(p),t=new uh(m,g);for(const r in u){const a=u[r];a instanceof Cf?(Sd(a.layers,this.zoom,i),Gh(a,p,e.positions,m,t.iconPositions,this.showCollisionBoxes,i,this.tileID.canonical,this.tileZoom,this.projection)):a.hasPattern&&(a instanceof xc||a instanceof Cu||a instanceof Xu)&&(Sd(a.layers,this.zoom,i),a.addFeatures(h,this.tileID.canonical,t.patternPositions,i,this.tileTransform))}this.status="done",a(null,{buckets:K(u).filter(e=>!e.isEmpty()),featureIndex:l,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,lineAtlas:c,imageAtlas:t,glyphMap:this.returnDependencies?p:null,iconMap:this.returnDependencies?m:null,glyphPositions:this.returnDependencies?e.positions:null})}}e.length?o.send("getImages",{icons:e,source:this.source,tileID:this.tileID,type:"patterns"},(e,t)=>{d||(d=e,g=t,y.call(this))},void 0,!1,n):g={},y.call(this)}}function Sd(e,t,r){var n=new C(t);for(const t of e)t.recalculate(n,r)}class Md{constructor(e){this.entries={},this.scheduler=e}request(r,n,e,t){const i=this.entries[r]=this.entries[r]||{callbacks:[]};if(i.result){const[r,e]=i.result;return this.scheduler?this.scheduler.add(()=>{t(r,e)},n):t(r,e),()=>{}}return i.callbacks.push(t),i.cancel||(i.cancel=e((e,t)=>{i.result=[e,t];for(const r of i.callbacks)this.scheduler?this.scheduler.add(()=>{r(e,t)},n):r(e,t);setTimeout(()=>delete this.entries[r],3e3)})),()=>{i.result||(i.callbacks=i.callbacks.filter(e=>e!==t),i.callbacks.length||(i.cancel(),delete this.entries[r]))}}}function kd(t,e,o){var r=JSON.stringify(t.request);return t.data&&(this.deduped.entries[r]={result:[null,t.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},i=>{const e=ze(t.request,(e,t,r,n)=>{e?i(e):t&&i(null,{vectorTile:o?void 0:new Vu(new Nc(t)),rawData:t,cacheControl:r,expires:n})});return()=>{e.cancel(),i()}},e)}l.ARRAY_TYPE=$a,l.AUTH_ERR_MSG=Ne,l.Aabb=Ds,l.Actor=class{constructor(e,t,r){this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.cancelCallbacks={},ie(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=pe()?e:p,this.scheduler=new jf}send(e,t,r,n,i=!1,o){const a=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=o,this.callbacks[a]=r);o=ye(this.globalScope)?void 0:[];return this.target.postMessage({id:a,type:e,hasCallback:!!r,targetMapId:n,mustQueue:i,sourceMapId:this.mapId,data:Ei(t,o)},o),{cancel:()=>{r&&delete this.callbacks[a],this.target.postMessage({id:a,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(e){const t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[r];delete this.cancelCallbacks[r],e&&e.cancel()}else if(t.mustQueue||pe()){const e=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,t),e&&e.metadata||{type:"message"})}else this.processTask(r,t)}processTask(r,e){if("<response>"===e.type){var t=this.callbacks[r];delete this.callbacks[r],t&&(e.error?t(Ti(e.error)):t(null,Ti(e.data)))}else{const n=ye(this.globalScope)?void 0:[],i=e.hasCallback?(e,t)=>{delete this.cancelCallbacks[r],this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:e?Ei(e):null,data:Ei(t,n)},n)}:e=>{},o=Ti(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,o,i);else if(this.parent.getWorkerSource){const r=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,r[0],o.source)[r[1]](o,i)}else i(new Error("Could not find function "+e.type))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.CanonicalTileID=ac,l.Color=y,l.ColorMode=fd,l.CullFaceMode=dd,l.DEMData=ld,l.DataConstantProperty=t,l.DedupedRequest=Md,l.DepthMode=cd,l.EXTENT=se,l.Elevation=class{isDataAvailableAtPoint(e){var t,r,n,i=this._source();return!(this.isUsingMockSource()||!i||e.y<0||1<e.y)&&(n=1<<(i=i.getSource().maxzoom),t=Math.floor(e.x),r=Math.floor((e.x-t)*n),e=Math.floor(e.y*n),!(!(n=this.findDEMTileFor(new lc(i,t,i,r,e)))||!n.dem))}getAtPointOrZero(e,t=0){return this.getAtPoint(e,t)||0}getAtPoint(e,t,r=!0){if(this.isUsingMockSource())return null;null==t&&(t=null);var n,i,o,a=this._source();return a&&!(e.y<0||1<e.y)&&(n=1<<(a=a.getSource().maxzoom),o=Math.floor(e.x),i=e.x-o,o=new lc(a,o,a,Math.floor(i*n),Math.floor(e.y*n)),(a=this.findDEMTileFor(o))&&a.dem)?(n=a.dem,i=(i*(o=1<<a.tileID.canonical.z)-a.tileID.canonical.x)*n.dim,e=(e.y*o-a.tileID.canonical.y)*n.dim,o=Math.floor(i),a=Math.floor(e),(r?this.exaggeration():1)*k(k(n.get(o,a),n.get(o,a+1),e-a),k(n.get(o+1,a),n.get(o+1,a+1),e-a),i-o)):t}getAtTileOffset(e,t,r){var n=1<<e.canonical.z;return this.getAtPointOrZero(new _l(e.wrap+(e.canonical.x+t/se)/n,(e.canonical.y+r/se)/n))}getAtTileOffsetFunc(r,n,i,o){return e=>{var t=this.getAtTileOffset(r,e.x,e.y),e=o.upVector(r.canonical,e.x,e.y);return ms(e,e,t*o.upVectorScale(r.canonical,n,i).metersToTile),e}}getForTilePoints(e,t,r,n){if(this.isUsingMockSource())return!1;const i=vd.create(this,e,n);return!!i&&(t.forEach(e=>{e[2]=this.exaggeration()*i.getElevationAt(e[0],e[1],r)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;var e=this.findDEMTileFor(t);if(!e||!e.dem)return null;var r=e.dem.tree,n=e.tileID,e=1<<t.canonical.z-n.canonical.z;let i=t.canonical.x/e-n.canonical.x,o=t.canonical.y/e-n.canonical.y,a=0;for(let e=0;e<t.canonical.z-n.canonical.z&&!r.leaves[a];e++){i*=2,o*=2;const t=2*Math.floor(o)+Math.floor(i);a=r.childOffsets[a]+t,i%=1,o%=1}return{min:this.exaggeration()*r.minimums[a],max:this.exaggeration()*r.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,r){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},l.ErrorEvent=vt,l.EvaluationParameters=C,l.Event=yt,l.Evented=_t,l.FillExtrusionBucket=Xu,l.Frustum=class qd{constructor(e,t){this.points=e,this.planes=t}static fromInvProjectionMatrix(i,o,e,a){const s=Math.pow(2,e),r=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(e=>{var t,r,n=1/(e=Ts([],e,i))[3]/o*s;return r=t=e,e=[n,n,a?1/e[3]:n,n],t[0]=r[0]*e[0],t[1]=r[1]*e[1],t[2]=r[2]*e[2],t[3]=r[3]*e[3],t}),t=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(e=>{var t=ys([],_s([],bs([],r[e[0]],r[e[1]]),bs([],r[e[2]],r[e[1]]))),e=-vs(t,r[e[1]]);return t.concat(e)});return new qd(r,t)}},l.FrustumCorners=class Hd{constructor(e,t,r,n,i){this.TL=e,this.TR=t,this.BR=r,this.BL=n,this.horizon=i}static fromInvProjectionMatrix(e,t,r){var n=[1,1,1],i=[1,-1,1],o=[-1,-1,1],a=Ee(a=[-1,1,1],a,e),n=Ee(n,n,e),i=Ee(i,i,e),o=Ee(o,o,e);return new Hd(a,n,i,o,t/r)}},l.GLOBE_RADIUS=Os,l.GLOBE_SCALE_MATCH_LATITUDE=45,l.GLOBE_ZOOM_THRESHOLD_MAX=6,l.GLOBE_ZOOM_THRESHOLD_MIN=5,l.GlobeSharedBuffers=class{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const r of this._wireframeSegments)r.destroy()}}_fillGridMeshWithLods(e,r){const n=new Lo,i=new Ho,o=[],a=e+1+2,s=r[0]+1,l=r[0]+1+(1+r.length),u=(e,t,r)=>{e=e===a-1?e-2:0===e?e:e-1;return[e+=r?24575:0,t]};for(let e=0;e<a;++e)n.emplaceBack(...u(e,0,!0));for(let t=0;t<s;++t)for(let e=0;e<a;++e)n.emplaceBack(...u(e,t,(0===e||e===a-1)&&!0));for(let e=0;e<r.length;++e){const i=r[e];for(let e=0;e<a;++e)n.emplaceBack(...u(e,i,!0))}for(let e=0;e<r.length;++e){const s=i.length,u=r[e]+1+2,h=new Ho;for(let t=0;t<u-1;t++){const o=t===u-2,s=o?a*(l-r.length+e-t):a;for(let e=0;e<a-1;e++){const r=t*a+e;(0===t||o||0===e||e===a-2?(h.emplaceBack(r+1,r,r+s),h):(i.emplaceBack(r+1,r,r+s),i)).emplaceBack(r+s,r+s+1,r+1)}}var t=w.simpleSegment(0,s,n.length,i.length-s);for(let e=0;e<h.uint16.length;e+=3)i.emplaceBack(h.uint16[e],h.uint16[e+1],h.uint16[e+2]);var c=w.simpleSegment(0,s,n.length,i.length-s);o.push({withoutSkirts:t,withSkirts:c})}return{vertices:n,indices:i,segments:o}}_createGrid(e){var t=this._fillGridMeshWithLods(64,Rs);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,Ps.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}_createPoles(e){const r=new Ho;for(let e=0;e<=64;e++)r.emplaceBack(0,e+1,e+2);this._poleIndexBuffer=e.createIndexBuffer(r,!0);var n=new Jo,i=new Jo;this._poleSegments=[];for(let e=0,t=0;e<5;e++){var o=360/(1<<e);n.emplaceBack(0,-Os,0,.5,0),i.emplaceBack(0,-Os,0,.5,1);for(let e=0;e<=64;e++){const r=e/64,a=k(0,o,r),[s,l,u]=Ys(ll,ul,a,Os);n.emplaceBack(s,l,u,r,0),i.emplaceBack(s,l,u,r,1)}this._poleSegments.push(w.simpleSegment(t,0,66,64)),t+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(n,Is,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(i,Is,!1)}getGridBuffers(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}getWirefameBuffers(e,r){if(!this._wireframeSegments){const r=new Qo;this._wireframeSegments=[];for(let e=0,t=0;e<Rs.length;e++){var n=Rs[e];for(let t=1;t<n+1;t++)for(let e=1;e<65;e++){var i=67*t+e;r.emplaceBack(i,i+1),r.emplaceBack(i,i+67),r.emplaceBack(i,i+67+1)}var o=64*n*3;this._wireframeSegments.push(w.simpleSegment(0,t,67*(n+1),o)),t+=o}this._wireframeIndexBuffer=e.createIndexBuffer(r)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[r]]}},l.GlyphManager=Ph,l.ImagePosition=lh,l.LivePerformanceUtils=at,l.LngLat=A,l.LngLatBounds=qa,l.LocalGlyphMode=Lh,l.MAX_MERCATOR_LATITUDE=L,l.MercatorCoordinate=_l,l.ONE_EM=le,l.OverscaledTileID=lc,l.PerformanceMarkers=ot,l.Properties=Mo,l.RGBAImage=Jl,l.Ray=zs,l.RequestManager=class{constructor(e,t,r){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){var e=function(){let t="";for(let e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1","01",t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,t){var r;return je(e)?((r=qe(e)).path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)):e}normalizeGlyphsURL(e,t){var r;return je(e)?((r=qe(e)).path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)):e}normalizeSourceURL(e,t,r,n){var i;return je(e)?((i=qe(e)).path=`/v4/${i.authority}.json`,i.params.push("secure"),r&&i.params.push("language="+r),n&&i.params.push("worldview="+n),this._makeAPIURL(i,this._customAccessToken||t)):e}normalizeSpriteURL(e,t,r,n){var i=qe(e);return je(e)?(i.path=`/styles/v1${i.path}/sprite`+t+r,this._makeAPIURL(i,this._customAccessToken||n)):(i.path+=""+t+r,He(i))}normalizeTileURL(e,t,r){return this._isSkuTokenExpired()&&this._createSkuToken(),e&&!je(e)?e:((e=qe(e)).path=e.path.replace(/(\.(png|jpg)\d*)(?=$)/,(t||r&&"raster"!==e.authority&&512===r?"@2x":"")+(D.supported?".webp":"$1")),"raster"===e.authority?e.path="/"+o.RASTER_URL_PREFIX+e.path:(e.path=e.path.replace(/^.+\/v4\//,"/"),e.path="/"+o.TILE_URL_VERSION+e.path),t=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(e.params)||o.ACCESS_TOKEN,o.REQUIRE_ACCESS_TOKEN&&t&&this._skuToken&&e.params.push("sku="+this._skuToken),this._makeAPIURL(e,t))}canonicalizeTileURL(e,t){var r=qe(e);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return e;let n="mapbox://",i=(r.path.match(/^\/raster\/v1\//)?n+="raster/"+r.path.replace(`/${o.RASTER_URL_PREFIX}/`,""):n+="tiles/"+r.path.replace(`/${o.TILE_URL_VERSION}/`,""),r.params);return(i=t?i.filter(e=>!e.match(/^access_token=/)):i).length&&(n+="?"+i.join("&")),n}canonicalizeTileset(e,t){var r=!!t&&je(t),n=[];for(const t of e.tiles||[])Ue(t)?n.push(this.canonicalizeTileURL(t,r)):n.push(t);return n}_makeAPIURL(e,t){var r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",n=qe(o.API_URL);if(e.protocol=n.protocol,e.authority=n.authority,"http"===e.protocol){const t=e.params.indexOf("secure");0<=t&&e.params.splice(t,1)}if("/"!==n.path&&(e.path=""+n.path+e.path),o.REQUIRE_ACCESS_TOKEN){if(t=t||o.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error("An API access token is required to use Mapbox GL. "+r);if("s"===t[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r)}e.params=e.params.filter(e=>-1===e.indexOf("access_token")),e.params.push("access_token="+(t||""))}return He(e)}},l.ResourceType=Ie,l.SegmentVector=w,l.SourceCache=pd,l.StencilMode=hd,l.StructArrayLayout1ui2=ea,l.StructArrayLayout2f1f2i16=Wo,l.StructArrayLayout2i4=Lo,l.StructArrayLayout2ui4=Qo,l.StructArrayLayout3f12=qo,l.StructArrayLayout3ui6=Ho,l.StructArrayLayout4i8=zo,l.StructArrayLayout5f20=Jo,l.Texture=Bf,l.Tile=Jf,l.Transitionable=_o,l.Uniform1f=Ea,l.Uniform1i=class extends wa{constructor(e){super(e),this.current=0}set(e,t,r){this.fetchUniformLocation(e,t)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},l.Uniform2f=class extends wa{constructor(e){super(e),this.current=[0,0]}set(e,t,r){!this.fetchUniformLocation(e,t)||r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},l.Uniform3f=class extends wa{constructor(e){super(e),this.current=[0,0,0]}set(e,t,r){!this.fetchUniformLocation(e,t)||r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},l.Uniform4f=Ta,l.UniformColor=Sa,l.UniformMatrix2f=class extends wa{constructor(e){super(e),this.current=Ca}set(e,t,r){if(this.fetchUniformLocation(e,t))for(let e=0;e<4;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}},l.UniformMatrix3f=class extends wa{constructor(e){super(e),this.current=ka}set(e,t,r){if(this.fetchUniformLocation(e,t))for(let e=0;e<9;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}},l.UniformMatrix4f=class extends wa{constructor(e){super(e),this.current=Ma}set(e,t,r){if(this.fetchUniformLocation(e,t))if(r[12]!==this.current[12]||r[0]!==this.current[0])this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);else for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},l.UnwrappedTileID=sc,l.ValidationError=b,l.VectorTileFeature=cn,l.VectorTileWorkerSource=class extends _t{constructor(e,t,r,n,i){super(),this.actor=e,this.layerIndex=t,this.availableImages=r,this.loadVectorData=i||kd,this.loading={},this.loaded={},this.deduped=new Md(e.scheduler),this.isSpriteLoaded=n,this.scheduler=e.scheduler}loadTile(a,s){const l=a.uid,u=a&&a.request,c=u&&u.collectResourceTiming,h=this.loading[l]=new Td(a);h.abort=this.loadVectorData(a,(e,t)=>{var r=!this.loading[l];if(delete this.loading[l],r||e||!t)return h.status="done",r||(this.loaded[l]=h),s(e);const n=t.rawData,i={},o=(t.expires&&(i.expires=t.expires),t.cacheControl&&(i.cacheControl=t.cacheControl),h.vectorTile=t.vectorTile||new Vu(new Nc(n)),()=>{h.parse(h.vectorTile,this.layerIndex,this.availableImages,this.actor,(e,t)=>{if(e||!t)return s(e);var r={};if(c){const e=ut(u);0<e.length&&(r.resourceTiming=JSON.parse(JSON.stringify(e)))}s(null,_({rawTileData:n.slice(0)},t,i,r))})});this.isSpriteLoaded?o():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(o,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom}):o()}),this.loaded=this.loaded||{},this.loaded[l]=h})}reloadTile(e,n){const t=this.loaded,r=e.uid,i=this;if(t&&t[r]){const o=t[r];o.showCollisionBoxes=e.showCollisionBoxes,o.enableTerrain=!!e.enableTerrain,o.projection=e.projection,o.tileTransform=Jh(e.tileID.canonical,e.projection);e=(e,t)=>{var r=o.reloadCallback;r&&(delete o.reloadCallback,o.parse(o.vectorTile,i.layerIndex,this.availableImages,i.actor,r)),n(e,t)};"parsing"===o.status?o.reloadCallback=e:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,e):e())}}abortTile(e,t){var e=e.uid,r=this.loading[e];r&&(r.abort&&r.abort(),delete this.loading[e]),t()}removeTile(e,t){var r=this.loaded,e=e.uid;r&&r[e]&&delete r[e],t()}},l.WritingMode=ch,l.ZoomDependentExpression=Dn,l.add=cs,l.addDynamicAttributes=Tf,l.adjoint=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],u=t[7],t=t[8];return e[0]=a*t-s*u,e[1]=i*u-n*t,e[2]=n*s-i*a,e[3]=s*l-o*t,e[4]=r*t-i*l,e[5]=i*o-r*s,e[6]=o*u-a*l,e[7]=n*l-r*u,e[8]=r*a-n*o,e},l.asyncAll=J,l.bezier=H,l.bindAll=ie,l.boundsAttributes=Xf,l.bufferConvexPolygon=function(t,r){var n=[];for(let e=0;e<t.length;e++){var i=Y(e-1,-1,t.length-1),o=Y(e+1,-1,t.length-1),a=t[e],o=t[o],i=t[i].sub(a).unit(),o=o.sub(a).unit(),s=o.angleWithSep(i.x,i.y),i=i.add(o).unit().mult(-1*r/Math.sin(s/2));n.push(a.add(i))}return n},l.cacheEntryPossiblyAdded=function(e){++Ae>Se&&(e.getActor().send("enforceCacheSizeLimit",Te),Ae=0)},l.calculateGlobeLabelMatrix=function(e,t){var{x:r,y:n}=e.point,r=nl(r,n,e.worldSize/e._pixelsPerMercatorPixel,0,0);return Qa(r,r,rl(Ws(t)))},l.calculateGlobeMatrix=function(e){var{x:t,y:r}=e.point,{lng:n,lat:i}=e._center;return nl(t,r,e.worldSize,n,i)},l.calculateGlobeMercatorMatrix=function(e){var t=e.pixelsPerMeter,r=t/ml(1,e.center.lat),n=Ja(new Float64Array(16));return es(n,n,[e.point.x,e.point.y,0]),ts(n,n,[r,r,t]),Float32Array.from(n)},l.circumferenceAtLatitude=fl,l.clamp=S,l.clearTileCache=function(e){var t;Me()&&(t=p.caches.delete(xe),e&&t.catch(e).then(()=>e()))},l.clipLine=kh,l.clone=function(e){var t=new $a(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},l.clone$1=he,l.collisionCircleLayout=Ic,l.config=o,l.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},l.create=function(){var e=new $a(16);return $a!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},l.create$1=Xa,l.createExpression=Pn,l.createLayout=i,l.createStyleLayer=function(e){return new("custom"===e.type?Df:Ff[e.type])(e)},l.cross=_s,l.degToRad=M,l.distance=function(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])},l.div=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e},l.dot=vs,l.earthRadius=cl,l.ease=$,l.easeCubicInOut=q,l.ecefToLatLng=function([e,t,r]){var n=Math.hypot(e,t,r),e=Math.atan2(e,r),r=.5*Math.PI-Math.acos(-t/n);return new A(T(e),T(r))},l.emitValidationErrors=yi,l.endsWith=oe,l.enforceCacheSizeLimit=function(n){ke(),be&&be.then(r=>{r.keys().then(t=>{for(let e=0;e<t.length-n;e++)r.delete(t[e])})})},l.evaluateSizeForFeature=zc,l.evaluateSizeForZoom=Dc,l.evaluateVariableOffset=Vh,l.evented=mo,l.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},l.exactEquals$1=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},l.exported=pt,l.exported$1=D,l.extend=_,l.extend$1=xt,l.fillExtrusionHeightLift=rc,l.filterObject=ce,l.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},l.fromQuat=function(e,t){var r=t[0],n=t[1],i=t[2],t=t[3],o=r+r,a=n+n,s=i+i,r=r*o,l=n*o,n=n*a,u=i*o,c=i*a,i=i*s,o=t*o,a=t*a,t=t*s;return e[0]=1-n-i,e[1]=l+t,e[2]=u-a,e[3]=0,e[4]=l-t,e[5]=1-r-i,e[6]=c+o,e[7]=0,e[8]=u+a,e[9]=c-o,e[10]=1-r-n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},l.fromRotation=function(e,t){var r=Math.sin(t),t=Math.cos(t);return e[0]=t,e[1]=r,e[2]=0,e[3]=-r,e[4]=t,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},l.fromScaling=is,l.furthestTileCorner=function(e){e=Math.round((e+45+360)%360/90)%4;return Z[e]},l.getAABBPointSquareDist=function(t,r,n){let i=0;for(let e=0;e<2;++e){var o=n?n[e]:0;t[e]>o&&(i+=(t[e]-o)*(t[e]-o)),r[e]<o&&(i+=(o-r[e])*(o-r[e]))}return i},l.getAnchorAlignment=_h,l.getAnchorJustification=Wh,l.getBounds=function(e){let t=1/0,r=1/0,n=-1/0,i=-1/0;for(const o of e)t=Math.min(t,o.x),r=Math.min(r,o.y),n=Math.max(n,o.x),i=Math.max(i,o.y);return{min:new I(t,r),max:new I(n,i)}},l.getColumn=_e,l.getGridMatrix=function(e,t,r,n){var i=t.getNorth(),o=t.getSouth(),a=t.getWest(),t=t.getEast(),s=1<<e.z,t=t-a,o=i-o,l=t/64,r=-o/Rs[r],i=[0,l,0,r,0,0,i,a,0];if(0<e.z){const e=180/n;Ya(i,i,[e/t+1,0,0,0,e/o+1,0,-.5*e/l,.5*e/r,1])}return i[2]=s,i[5]=e.x,i[8]=e.y,i},l.getImage=Be,l.getJSON=function(e,t){return Pe(_(e,{type:"json"}),t)},l.getLatitudinalLod=function(e){var t=L-5,t=(e=S(e,-t,t)/t*90,Math.pow(Math.abs(Math.sin(M(e))),3));return Math.round(t*(Rs.length-1))},l.getMapSessionAPI=nt,l.getPerformanceMeasurement=ut,l.getProjection=_f,l.getRTLTextPluginStatus=fo,l.getReferrer=De,l.getTilePoint=function(e,{x:t,y:r},n=0){return new I(((t-n)*e.scale-e.x)*se,(r*e.scale-e.y)*se)},l.getTileVec3=function(e,t,r=0){return us(((t.x-r)*e.scale-e.x)*se,(t.y*e.scale-e.y)*se,yl(t.z,t.y))},l.getVideo=function(t,e){const r=p.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let e=0;e<t.length;e++){var n=p.document.createElement("source");i=t[e],o=void 0,(o=p.document.createElement("a")).href=i,o.protocol===p.document.location.protocol&&o.host===p.document.location.host||(r.crossOrigin="Anonymous"),n.src=t[e],r.appendChild(n)}var i,o;return{cancel:()=>{}}},l.globeCenterToScreenPoint=function(e){var t=[0,0,0],r=Ja(new Float64Array(16));return Qa(r,e.pixelMatrix,e.globeMatrix),Ee(t,t,r),new I(t[0],t[1])},l.globeDenormalizeECEF=rl,l.globeECEFOrigin=function(e,t){var r=[0,0,0];return Ee(r,r,tl(Ws(t.canonical))),Ee(r,r,e),r},l.globeMetersToEcef=js,l.globeNormalizeECEF=tl,l.globePixelsToTileUnits=function(e,t){return se/(512*Math.pow(2,e))*Qs(Ws(t))},l.globePoleMatrixForTile=function(e,t,r){var n=Ja(new Float64Array(16)),t=(t/(1<<e)-.5)*Math.PI*2;return ns(n,r.globeMatrix,t),Float32Array.from(n)},l.globeTileBounds=Ws,l.globeTiltAtLngLat=ol,l.globeToMercatorTransition=il,l.globeUseCustomAntiAliasing=function(e,t,r){var r=il(r.zoom),n=e.style.map._antialias,i=!!t.extStandardDerivatives,t=t.extStandardDerivativesForceOff||e.terrain&&0<e.terrain.exaggeration();return 0===r&&!n&&!t&&i},l.identity=Ja,l.identity$1=Ms,l.invert=Ka,l.isFullscreen=function(){return!!p.document.fullscreenElement||!!p.document.webkitFullscreenElement},l.isLngLatBehindGlobe=al,l.isMapAuthenticated=function(e){return it.has(e)},l.isMapboxURL=je,l.isSafariWithAntialiasingBug=function(e){var t=e.navigator?e.navigator.userAgent:null;return!!ye(e)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},l.latFromMercatorY=E,l.latLngToECEF=Js,l.len=Jr,l.length=ls,l.length$1=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},l.lngFromMercatorX=gl,l.loadVectorTile=kd,l.makeRequest=Pe,l.mapValue=function(e,t,r,n,i){return S((e-t)/(r-t)*(i-n)+n,n,i)},l.mercatorScale=vl,l.mercatorXfromLng=dl,l.mercatorYfromLat=pl,l.mercatorZfromAltitude=ml,l.mul=fn,l.mul$1=hn,l.multiply=Qa,l.multiply$1=Ya,l.multiply$2=fs,l.nextPowerOfTwo=re,l.normalize=ys,l.normalize$1=Kr,l.normalize$2=Es,l.number=k,l.ortho=function(e,t,r,n,i,o,a){var s=1/(t-r),l=1/(n-i),u=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+r)*s,e[13]=(i+n)*l,e[14]=(a+o)*u,e[15]=1,e},l.pbf=Nc,l.perspective=function(e,t,r,n,i){t=1/Math.tan(t/2);return e[0]=t/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(e[10]=(i+n)*(r=1/(n-i)),e[14]=2*i*n*r):(e[10]=-1,e[14]=-2*n),e},l.pick=function(t,r){var n={};for(let e=0;e<r.length;e++){var i=r[e];i in t&&(n[i]=t[i])}return n},l.plugin=go,l.pointGeometry=I,l.polesInViewport=function(e){var t=Ja(new Float64Array(16)),r=(Qa(t,e.pixelMatrix,e.globeMatrix),[0,Fs,0]),n=[0,Bs,0];return Ee(r,r,t),Ee(n,n,t),[0<r[0]&&r[0]<=e.width&&0<r[1]&&r[1]<=e.height&&!al(e,new A(e.center.lat,90)),0<n[0]&&n[0]<=e.width&&0<n[1]&&n[1]<=e.height&&!al(e,new A(e.center.lat,-90))]},l.polygonContainsPoint=Rl,l.polygonIntersectsBox=Fl,l.polygonIntersectsPolygon=Al,l.polygonizeBounds=function(e,t,r=0,n=!0){r=new I(r,r),e=e.sub(r),t=t.add(r),r=[e,new I(t.x,e.y),t,new I(e.x,t.y)];return n&&r.push(e.clone()),r},l.posAttributes=Ps,l.postMapLoadEvent=Qe,l.postPerformanceEvent=tt,l.postTurnstileEvent=Je,l.potpack=sh,l.prevPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},l.radToDeg=T,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.registerForPluginStateChange=function(e){return e({pluginStatus:lo,pluginURL:uo}),mo.on("pluginStateChange",e),e},l.removeAuthState=function(e){it.delete(e)},l.renderColorRamp=Ql,l.resample=xl,l.rotateX=rs,l.rotateX$1=ks,l.rotateY=ns,l.rotateY$1=Cs,l.rotateZ=function(e,t,r){var n=Math.sin(r),r=Math.cos(r),i=t[0],o=t[1],a=t[2],s=t[3],l=t[4],u=t[5],c=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*r+l*n,e[1]=o*r+u*n,e[2]=a*r+c*n,e[3]=s*r+h*n,e[4]=l*r-i*n,e[5]=u*r-o*n,e[6]=c*r-a*n,e[7]=h*r-s*n,e},l.rotateZ$1=function(e,t,r){r*=.5;var n=t[0],i=t[1],o=t[2],t=t[3],a=Math.sin(r),r=Math.cos(r);return e[0]=n*r+i*a,e[1]=i*r-n*a,e[2]=o*r+t*a,e[3]=t*r-o*a,e},l.scale=ts,l.scale$1=ws,l.scale$2=ms,l.scaleAndAdd=gs,l.set=function(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e},l.setCacheLimits=function(e,t){Te=e,Se=t},l.setColumn=function(e,t,r){e[4*t+0]=r[0],e[4*t+1]=r[1],e[4*t+2]=r[2],e[4*t+3]=r[3]},l.setRTLTextPlugin=function(e,t,r=!1){if(lo===io||lo===oo||lo===ao)throw new Error("setRTLTextPlugin cannot be called multiple times.");uo=pt.resolveURL(e),lo=io,so=t,ho(),r||po()},l.smoothstep=X,l.spec=c,l.squaredLength=function(e){var t=e[0],r=e[1],e=e[2];return t*t+r*r+e*e},l.storeAuthState=function(e,t){t?it.add(e):it.delete(e)},l.sub=bs,l.subtract=hs,l.symbolSize=Qr,l.tileAABB=function(r,n,e,t,i,o,a,s,l){if("globe"!==l.name)return l=Jh({z:e,x:t,y:i},l),new Ds([(o+l.x/l.scale)*n,n*(l.y/l.scale),a],[(o+l.x2/l.scale)*n,n*(l.y2/l.scale),s]);{var u=r,c=n,h=new ac(e,t,i);const g=c/u.worldSize,y=u.globeMatrix;if(h.z<=1){const u=Ws(h).getCorners();return Hs(u,y,g),Ds.fromPoints(u)}var f=Xs(a=$s(h)),d=(Hs(f,y,g),[-(o=Number.MAX_VALUE),-o,-o]),p=[o,o,o];if(a.contains(u.center)){for(const u of f)ds(p,p,u),ps(d,d,u);d[2]=0;const c=u.point,h=[c.x*g,c.y*g,0];ds(p,p,h),ps(d,d,h)}else{o=[y[12]*g,y[13]*g,y[14]*g],l=a.getCenter(),s=S(u.center.lat,-L,L),r=S(l.lat,-L,L),n=dl(u.center.lng),s=pl(s);let e=n-dl(l.lng);l=s-pl(r);.5<e?--e:e<-.5&&(e+=1);let t=0;Math.abs(e)>Math.abs(l)?t=0<=e?1:3:(t=0<=l?0:2,gs(o,o,[y[4]*g,y[5]*g,y[6]*g],-Math.sin(M(0<=l?a.getSouth():a.getNorth()))*Os));var r=f[t],l=f[(t+1)%4],a=new Vs(r,l,o),o=[Gs(a,0)||r[0],Gs(a,1)||r[1],Gs(a,2)||r[2]],m=il(u.zoom);if(0<m){const g=function({x:e,y:t,z:r},n,i,o,a){r=1/(1<<r);let s=e*r,l=s+r,u=t*r,c=u+r,h=0;e=(s+l)/2-o;return.5<e?h=-1:e<-.5&&(h=1),u=(u*n-(a*=n))*i+a,[[s=((s+h)*n-(o*=n))*i+o,c=(c*n-a)*i+a,0],[l=((l+h)*n-o)*i+o,c,0],[l,u,0],[s,u,0]]}(h,c,u._pixelsPerMercatorPixel,n,s);for(let e=0;e<f.length;e++)Zs(f[e],g[e],m);const y=cs([],g[t],g[(t+1)%4]);ms(y,y,.5),Zs(o,y,m)}for(const u of f)ds(p,p,u),ps(d,d,u);p[2]=Math.min(r[2],l[2]),ds(p,p,o),ps(d,d,o)}return new Ds(p,d)}},l.tileCornersToBounds=$s,l.tileTransform=Jh,l.transformMat3=function(e,t,r){var n=t[0],i=t[1],t=t[2];return e[0]=n*r[0]+i*r[3]+t*r[6],e[1]=n*r[1]+i*r[4]+t*r[7],e[2]=n*r[2]+i*r[5]+t*r[8],e},l.transformMat4=Ee,l.transformMat4$1=Ts,l.transformQuat=xs,l.transitionTileAABBinECEF=qs,l.translate=es,l.transpose=function(e,t){var r,n,i;return e===t?(r=t[1],n=t[2],i=t[5],e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=i):(e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8]),e},l.triggerPluginCompletionEvent=co,l.uniqueId=ee,l.updateGlobeVertexNormal=function(e,t,r,n,i){t=5*t+2;e.float32[t]=r,e.float32[1+t]=n,e.float32[2+t]=i},l.validateCustomStyleLayer=function(e){var t=[],r=e.id;return void 0===r&&t.push({message:`layers.${r}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${r}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},l.validateFilter=e=>gi(Qn(e)),l.validateFog=e=>gi(ui(e)),l.validateLayer=e=>gi(ni(e)),l.validateLight=e=>gi(si(e)),l.validateSource=e=>gi(ai(e)),l.validateStyle=di,l.validateTerrain=e=>gi(li(e)),l.values=K,l.vectorTile=rn,l.version=z,l.warnOnce=ae,l.window=p,l.wrap=Y}),e(0,function(l){function a(e){let t="";for(const r of l.refProperties)t+="/"+function t(r){if("number"==typeof r||"boolean"==typeof r||"string"==typeof r||null==r)return JSON.stringify(r);if(Array.isArray(r)){let e="[";for(const n of r)e+=t(n)+",";return e+"]"}let e="{";for(const i of Object.keys(r).sort())e+=`${i}:${t(r[i])},`;return e+"}"}(e[r]);return t}class R{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e){this._layerConfigs={},this._layers={},this.update(e,[])}update(r,n){for(const a of r)this._layerConfigs[a.id]=a,(this._layers[a.id]=l.createStyleLayer(a)).compileFilter(),this.keyCache[a.id]&&delete this.keyCache[a.id];for(const l of n)delete this.keyCache[l],delete this._layerConfigs[l],delete this._layers[l];this.familiesBySource={};r=function(r,n){var i={};for(let t=0;t<r.length;t++){var o=n&&n[r[t].id]||a(r[t]);n&&(n[r[t].id]=o);let e=i[o];(e=e||(i[o]=[])).push(r[t])}var e=[];for(const r in i)e.push(i[r]);return e}(l.values(this._layerConfigs),this.keyCache);for(const l of r){const r=l.map(e=>this._layers[e.id]),a=r[0];if("none"!==a.visibility){const n=a.source||"";let e=this.familiesBySource[n];e=e||(this.familiesBySource[n]={});var i=a.sourceLayer||"_geojsonTileLayer";let t=e[i];(t=t||(e[i]=[])).push(r)}}}}class F{loadTile(e,t){var{uid:e,encoding:r,rawImageData:n,padding:i,buildQuadTree:o}=e,n=l.window.ImageBitmap&&n instanceof l.window.ImageBitmap?this.getImageData(n,i):n;t(null,new l.DEMData(e,n,r,i<1,o))}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);e=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),e}}function s(e,t){var r,n=e&&e.type;if("FeatureCollection"===n)for(r=0;r<e.features.length;r++)s(e.features[r],t);else if("GeometryCollection"===n)for(r=0;r<e.geometries.length;r++)s(e.geometries[r],t);else if("Feature"===n)s(e.geometry,t);else if("Polygon"===n)i(e.coordinates,t);else if("MultiPolygon"===n)for(r=0;r<e.coordinates.length;r++)i(e.coordinates[r],t);return e}function i(e,t){if(0!==e.length){n(e[0],t);for(var r=1;r<e.length;r++)n(e[r],!t)}}function n(e,t){for(var r=0,n=0,i=0,o=e.length,a=o-1;i<o;a=i++){var s=(e[i][0]-e[a][0])*(e[a][1]+e[i][1]),l=r+s;n+=Math.abs(r)>=Math.abs(s)?r-l+s:s-l+r,r=l}0<=r+n!=!!t&&e.reverse()}const B=l.VectorTileFeature.prototype.toGeoJSON;class N{constructor(e){this._feature=e,this.extent=l.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){var e=[];for(const n of this._feature.geometry)e.push([new l.pointGeometry(n[0],n[1])]);return e}var t=[];for(const i of this._feature.geometry){var r=[];for(const o of i)r.push(new l.pointGeometry(o[0],o[1]));t.push(r)}return t}toGeoJSON(e,t,r){return B.call(this,e,t,r)}}class j{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=e.length,this._features=e}feature(e){return new N(this._features[e])}}var o={},U={get exports(){return o},set exports(e){o=e}},V=l.pointGeometry,G=l.vectorTile.VectorTileFeature,W=e;function e(e,t){this.options=t||{},this.features=e,this.length=e.length}function t(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}e.prototype.feature=function(e){return new t(this.features[e],this.options.extent)},t.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var r=e[t],n=[],i=0;i<r.length;i++)n.push(new V(r[i][0],r[i][1]));this.geometry.push(n)}return this.geometry},t.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,r=-1/0,n=1/0,i=-1/0,o=0;o<e.length;o++)for(var a=e[o],s=0;s<a.length;s++)var l=a[s],t=Math.min(t,l.x),r=Math.max(r,l.x),n=Math.min(n,l.y),i=Math.max(i,l.y);return[t,n,r,i]},t.prototype.toGeoJSON=G.prototype.toGeoJSON;var r,Z=l.pbf,u=W;function c(e){var t,r=new Z,n=e,i=r;for(t in n.layers)i.writeMessage(3,q,n.layers[t]);return r.finish()}function q(e,t){t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);for(var r={keys:[],values:[],keycache:{},valuecache:{}},n=0;n<e.length;n++)r.feature=e.feature(n),t.writeMessage(2,H,r);var i=r.keys;for(n=0;n<i.length;n++)t.writeStringField(3,i[n]);var o=r.values;for(n=0;n<o.length;n++)t.writeMessage(4,Y,o[n])}function H(e,t){var r=e.feature;void 0!==r.id&&t.writeVarintField(1,r.id),t.writeMessage(2,$,e),t.writeVarintField(3,r.type),t.writeMessage(4,X,r)}function $(e,t){var r,n=e.feature,i=e.keys,o=e.values,a=e.keycache,s=e.valuecache;for(r in n.properties){var l,u=n.properties[r],c=a[r];null!==u&&(void 0===c&&(i.push(r),a[r]=c=i.length-1),t.writeVarint(c),void 0===(l=s[c=(c=typeof u)+":"+(u="string"!=c&&"boolean"!=c&&"number"!=c?JSON.stringify(u):u)])&&(o.push(u),s[c]=l=o.length-1),t.writeVarint(l))}}function p(e,t){return(t<<3)+(7&e)}function m(e){return e<<1^e>>31}function X(e,t){for(var r=e.loadGeometry(),n=e.type,i=0,o=0,a=r.length,s=0;s<a;s++){var l=r[s],u=1;1===n&&(u=l.length),t.writeVarint(p(1,u));for(var c=3===n?l.length-1:l.length,h=0;h<c;h++){1===h&&1!==n&&t.writeVarint(p(2,c-1));var f=l[h].x-i,d=l[h].y-o;t.writeVarint(m(f)),t.writeVarint(m(d)),i+=f,o+=d}3===n&&t.writeVarint(15)}}function Y(e,t){var r=typeof e;"string"==r?t.writeStringField(1,e):"boolean"==r?t.writeBooleanField(7,e):"number"==r&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}function h(e,t,r,n,i,o){var a;i-n<=r||(function r(n,i,o,a,s,l){for(;a<s;){if(600<s-a){const c=s-a+1,h=o-a+1,f=Math.log(c),d=.5*Math.exp(2*f/3),p=.5*Math.sqrt(f*d*(c-d)/c)*(h-c/2<0?-1:1);r(n,i,o,Math.max(a,Math.floor(o-h*d/c+p)),Math.min(s,Math.floor(o+(c-h)*d/c+p)),l)}const u=i[2*o+l];let e=a,t=s;for(g(n,i,a,o),i[2*s+l]>u&&g(n,i,a,s);e<t;){for(g(n,i,e,t),e++,t--;i[2*e+l]<u;)e++;for(;i[2*t+l]>u;)t--}i[2*a+l]===u?g(n,i,a,t):(t++,g(n,i,t,s)),t<=o&&(a=t+1),o<=t&&(s=t-1)}}(e,t,a=n+i>>1,n,i,o%2),h(e,t,r,n,a-1,o+1),h(e,t,r,1+a,i,o+1))}function g(e,t,r,n){f(e,r,n),f(t,2*r,2*n),f(t,2*r+1,2*n+1)}function f(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function _(e,t,r,n){e-=r,r=t-n;return e*e+r*r}U.exports=c,o.fromVectorTileJs=c,o.fromGeojsonVt=function(e,t){t=t||{};var r,n={};for(r in e)n[r]=new u(e[r].features,t),n[r].name=r,n[r].version=t.version,n[r].extent=t.extent;return c({layers:n})},o.GeoJSONWrapper=u;const J=e=>e[0],K=e=>e[1];class d{constructor(t,r=J,n=K,e=64,i=Float64Array){this.nodeSize=e;var o=(this.points=t).length<65536?Uint16Array:Uint32Array,a=this.ids=new o(t.length),s=this.coords=new i(2*t.length);for(let e=0;e<t.length;e++)s[2*(a[e]=e)]=r(t[e]),s[2*e+1]=n(t[e]);h(a,s,e,0,a.length-1,0)}range(e,n,i,o){{var a=this.ids,s=this.coords,l=e,u=n,c=i,h=o,f=this.nodeSize,d=[0,a.length-1,0],p=[];let t,r;for(;d.length;){var m=d.pop(),g=d.pop(),y=d.pop();if(g-y<=f)for(let e=y;e<=g;e++)t=s[2*e],r=s[2*e+1],t>=l&&t<=c&&r>=u&&r<=h&&p.push(a[e]);else{var v=Math.floor((y+g)/2),_=(t=s[2*v],r=s[2*v+1],t>=l&&t<=c&&r>=u&&r<=h&&p.push(a[v]),(m+1)%2);(0===m?l<=t:u<=r)&&(d.push(y),d.push(v-1),d.push(_)),(0===m?c>=t:h>=r)&&(d.push(v+1),d.push(g),d.push(_))}}return p}}within(e,t,r){for(var n=this.ids,i=this.coords,o=e,a=t,s=r,l=this.nodeSize,u=[0,n.length-1,0],c=[],h=s*s;u.length;){var f=u.pop(),d=u.pop(),p=u.pop();if(d-p<=l)for(let e=p;e<=d;e++)_(i[2*e],i[2*e+1],o,a)<=h&&c.push(n[e]);else{var m=Math.floor((p+d)/2),g=i[2*m],y=i[2*m+1],v=(_(g,y,o,a)<=h&&c.push(n[m]),(f+1)%2);(0===f?o-s<=g:a-s<=y)&&(u.push(p),u.push(m-1),u.push(v)),(0===f?g<=o+s:y<=a+s)&&(u.push(m+1),u.push(d),u.push(v))}}return c}}const Q={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},y=Math.fround||(r=new Float32Array(1),e=>(r[0]=+e,r[0]));class ee{constructor(e){this.options=w(Object.create(Q),e),this.trees=new Array(this.options.maxZoom+1)}load(t){const{log:r,minZoom:n,maxZoom:i,nodeSize:o}=this.options;r&&console.time("total time");var e=`prepare ${t.length} points`;r&&console.time(e),this.points=t;let a=[];for(let e=0;e<t.length;e++)t[e].geometry&&a.push(re(t[e],e));this.trees[i+1]=new d(a,ie,oe,o,Float32Array),r&&console.timeEnd(e);for(let e=i;e>=n;e--){const n=+Date.now();a=this._cluster(a,e),this.trees[e]=new d(a,ie,oe,o,Float32Array),r&&console.log("z%d: %d clusters in %dms",e,a.length,+Date.now()-n)}return r&&console.timeEnd("total time"),this}getClusters(e,t){let r=((e[0]+180)%360+360)%360-180;var n=Math.max(-90,Math.min(90,e[1]));let i=180===e[2]?180:((e[2]+180)%360+360)%360-180;var o=Math.max(-90,Math.min(90,e[3]));if(360<=e[2]-e[0])r=-180,i=180;else if(r>i){const e=this.getClusters([r,n,180,o],t),a=this.getClusters([-180,n,i,o],t);return e.concat(a)}const a=this.trees[this._limitZoom(t)],s=a.range(x(r),b(o),x(i),b(n)),l=[];for(const e of s){const t=a.points[e];l.push(t.numPoints?v(t):this.points[t.index])}return l}getChildren(e){const t=this._getOriginId(e),r=this._getOriginZoom(e),n="No cluster with the specified id.",i=this.trees[r];if(!i)throw new Error(n);var o=i.points[t];if(!o)throw new Error(n);var a=this.options.radius/(this.options.extent*Math.pow(2,r-1)),s=[];for(const t of i.within(o.x,o.y,a)){const r=i.points[t];r.parentId===e&&s.push(r.numPoints?v(r):this.points[r.index])}if(0===s.length)throw new Error(n);return s}getLeaves(e,t,r){var n=[];return this._appendLeaves(n,e,t=t||10,r=r||0,0),n}getTile(e,t,r){var n=this.trees[this._limitZoom(e)],e=Math.pow(2,e),{extent:i,radius:o}=this.options,o=o/i,i=(r-o)/e,a=(r+1+o)/e,s={features:[]};return this._addTileFeatures(n.range((t-o)/e,i,(t+1+o)/e,a),n.points,t,r,e,s),0===t&&this._addTileFeatures(n.range(1-o/e,i,1,a),n.points,e,r,e,s),t===e-1&&this._addTileFeatures(n.range(0,i,o/e,a),n.points,-1,r,e,s),s.features.length?s:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){var r=this.getChildren(e);if(t++,1!==r.length)break;e=r[0].properties.cluster_id}return t}_appendLeaves(e,t,r,n,i){const o=this.getChildren(t);for(const t of o){const o=t.properties;if(o&&o.cluster?i+o.point_count<=n?i+=o.point_count:i=this._appendLeaves(e,o.cluster_id,r,n,i):i<n?i++:e.push(t),e.length===r)break}return i}_addTileFeatures(i,o,a,s,l,u){for(const h of i){const i=o[h],f=i.numPoints;let e,t,r;if(f)e=ne(i),t=i.x,r=i.y;else{const o=this.points[i.index];e=o.properties,t=x(o.geometry.coordinates[0]),r=b(o.geometry.coordinates[1])}var c={type:1,geometry:[[Math.round(this.options.extent*(t*l-a)),Math.round(this.options.extent*(r*l-s))]],tags:e};let n;f?n=i.id:this.options.generateId?n=i.index:this.points[i.index].id&&(n=this.points[i.index].id),void 0!==n&&(c.id=n),u.features.push(c)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,o){const a=[],{radius:s,extent:l,reduce:u,minPoints:t}=this.options,r=s/(l*Math.pow(2,o));for(let i=0;i<e.length;i++){const l=e[i];if(!(l.zoom<=o)){l.zoom=o;var c=this.trees[o+1],h=c.within(l.x,l.y,r),f=l.numPoints||1;let n=f;for(const e of h){const a=c.points[e];a.zoom>o&&(n+=a.numPoints||1)}if(n>f&&n>=t){let e=l.x*f,t=l.y*f,r=u&&1<f?this._map(l,!0):null;var d,p=(i<<5)+(o+1)+this.points.length;for(const a of h){const s=c.points[a];s.zoom<=o||(s.zoom=o,d=s.numPoints||1,e+=s.x*d,t+=s.y*d,s.parentId=p,u&&(r=r||this._map(l,!0),u(r,this._map(s))))}l.parentId=p,a.push(te(e/n,t/n,p,n,r))}else if(a.push(l),1<n)for(const e of h){const s=c.points[e];s.zoom<=o||(s.zoom=o,a.push(s))}}}return a}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t){var r;return e.numPoints?t?w({},e.properties):e.properties:(e=this.points[e.index].properties,r=this.options.map(e),t&&r===e?w({},r):r)}}function te(e,t,r,n,i){return{x:y(e),y:y(t),zoom:1/0,id:r,parentId:-1,numPoints:n,properties:i}}function re(e,t){var[e,r]=e.geometry.coordinates;return{x:y(x(e)),y:y(b(r)),zoom:1/0,index:t,parentId:-1}}function v(e){return{type:"Feature",id:e.id,properties:ne(e),geometry:{type:"Point",coordinates:[360*(e.x-.5),function(e){e=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}(e.y)]}}}function ne(e){var t=e.numPoints,r=1e4<=t?Math.round(t/1e3)+"k":1e3<=t?Math.round(t/100)/10+"k":t;return w(w({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:r})}function x(e){return e/360+.5}function b(e){e=Math.sin(e*Math.PI/180),e=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return e<0?0:1<e?1:e}function w(e,t){for(const r in t)e[r]=t[r];return e}function ie(e){return e.x}function oe(e){return e.y}function E(e,t,r,n){for(var i,o=n,a=r-t>>1,s=r-t,l=e[t],u=e[t+1],c=e[r],h=e[r+1],f=t+3;f<r;f+=3){var d=function(e,t,r,n,i,o){var a=i-r,s=o-n;{var l;0==a&&0==s||(1<(l=((e-r)*a+(t-n)*s)/(a*a+s*s))?(r=i,n=o):0<l&&(r+=a*l,n+=s*l))}return(a=e-r)*a+(s=t-n)*s}(e[f],e[f+1],l,u,c,h);o<d?(i=f,o=d):d===o&&(d=Math.abs(f-a))<s&&(i=f,s=d)}n<o&&(3<i-t&&E(e,t,i,n),e[i+2]=o,3<r-i&&E(e,i,r,n))}function S(e,t,r,n){var e={id:void 0===e?null:e,type:t,geometry:r,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},i=e,o=i.geometry,t=i.type;if("Point"===t||"MultiPoint"===t||"LineString"===t)T(i,o);else if("Polygon"===t||"MultiLineString"===t)for(var a=0;a<o.length;a++)T(i,o[a]);else if("MultiPolygon"===t)for(a=0;a<o.length;a++)for(var s=0;s<o[a].length;s++)T(i,o[a][s]);return e}function T(e,t){for(var r=0;r<t.length;r+=3)e.minX=Math.min(e.minX,t[r]),e.minY=Math.min(e.minY,t[r+1]),e.maxX=Math.max(e.maxX,t[r]),e.maxY=Math.max(e.maxY,t[r+1])}function M(e,t,r,n){if(t.geometry){var i=t.geometry.coordinates,o=t.geometry.type,a=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),s=[],l=t.id;if(r.promoteId?l=t.properties[r.promoteId]:r.generateId&&(l=n||0),"Point"===o)ae(i,s);else if("MultiPoint"===o)for(var u=0;u<i.length;u++)ae(i[u],s);else if("LineString"===o)k(i,s,a,!1);else if("MultiLineString"===o){if(r.lineMetrics){for(u=0;u<i.length;u++)k(i[u],s=[],a,!1),e.push(S(l,"LineString",s,t.properties));return}C(i,s,a,!1)}else if("Polygon"===o)C(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"!==o)throw new Error("Input data is not a valid GeoJSON object.");for(u=0;u<t.geometry.geometries.length;u++)M(e,{id:l,geometry:t.geometry.geometries[u],properties:t.properties},r,n);return}for(u=0;u<i.length;u++){var c=[];C(i[u],c,a,!0),s.push(c)}}e.push(S(l,o,s,t.properties))}}function ae(e,t){t.push(se(e[0])),t.push(le(e[1])),t.push(0)}function k(e,t,r,n){for(var i,o,a=0,s=0;s<e.length;s++){var l=se(e[s][0]),u=le(e[s][1]);t.push(l),t.push(u),t.push(0),0<s&&(a+=n?(i*u-l*o)/2:Math.sqrt(Math.pow(l-i,2)+Math.pow(u-o,2))),i=l,o=u}var c=t.length-3;t[2]=1,E(t,0,c,r),t[2+c]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function C(e,t,r,n){for(var i=0;i<e.length;i++){var o=[];k(e[i],o,r,n),t.push(o)}}function se(e){return e/360+.5}function le(e){e=Math.sin(e*Math.PI/180),e=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return e<0?0:1<e?1:e}function A(e,t,r,n,i,o,a,s){if(n/=t,o>=(r/=t)&&a<n)return e;if(a<r||n<=o)return null;for(var l=[],u=0;u<e.length;u++){var c=e[u],h=c.geometry,f=c.type,d=0===i?c.minX:c.minY,p=0===i?c.maxX:c.maxY;if(r<=d&&p<n)l.push(c);else if(!(p<r||n<=d)){var m=[];if("Point"===f||"MultiPoint"===f){g=void 0;y=void 0;v=void 0;_=void 0;x=void 0;b=void 0;w=void 0;var g=h;var y=m;var v=r;var _=n;var x=i;for(var b=0;b<g.length;b+=3){var w=g[b+x];v<=w&&w<=_&&(y.push(g[b]),y.push(g[b+1]),y.push(g[b+2]))}}else if("LineString"===f)ue(h,m,r,n,i,!1,s.lineMetrics);else if("MultiLineString"===f)I(h,m,r,n,i,!1);else if("Polygon"===f)I(h,m,r,n,i,!0);else if("MultiPolygon"===f)for(var E=0;E<h.length;E++){var T=[];I(h[E],T,r,n,i,!0),T.length&&m.push(T)}if(m.length)if(s.lineMetrics&&"LineString"===f)for(E=0;E<m.length;E++)l.push(S(c.id,f,m[E],c.tags));else"LineString"!==f&&"MultiLineString"!==f||(1===m.length?(f="LineString",m=m[0]):f="MultiLineString"),"Point"!==f&&"MultiPoint"!==f||(f=3===m.length?"Point":"MultiPoint"),l.push(S(c.id,f,m,c.tags))}}return l.length?l:null}function ue(e,t,r,n,i,o,a){for(var s,l,u=ce(e),c=0===i?he:fe,h=e.start,f=0;f<e.length-3;f+=3){var d=e[f],p=e[f+1],m=e[f+2],g=e[f+3],y=e[f+4],v=0===i?d:p,_=0===i?g:y,x=!1;a&&(s=Math.sqrt(Math.pow(d-g,2)+Math.pow(p-y,2))),v<r?r<_&&(l=c(u,d,p,g,y,r),a&&(u.start=h+s*l)):n<v?_<n&&(l=c(u,d,p,g,y,n),a&&(u.start=h+s*l)):L(u,d,p,m),_<r&&r<=v&&(l=c(u,d,p,g,y,r),x=!0),n<_&&v<=n&&(l=c(u,d,p,g,y,n),x=!0),!o&&x&&(a&&(u.end=h+s*l),t.push(u),u=ce(e)),a&&(h+=s)}var b=e.length-3,d=e[b],p=e[1+b],m=e[2+b];(v=0===i?d:p)>=r&&v<=n&&L(u,d,p,m),b=u.length-3,o&&3<=b&&(u[b]!==u[0]||u[1+b]!==u[1])&&L(u,u[0],u[1],u[2]),u.length&&t.push(u)}function ce(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function I(e,t,r,n,i,o){for(var a=0;a<e.length;a++)ue(e[a],t,r,n,i,o,!1)}function L(e,t,r,n){e.push(t),e.push(r),e.push(n)}function he(e,t,r,n,i,o){n=(o-t)/(n-t);return e.push(o),e.push(r+(i-r)*n),e.push(1),n}function fe(e,t,r,n,i,o){i=(o-r)/(i-r);return e.push(t+(n-t)*i),e.push(o),e.push(1),i}function de(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n],o=i.type;if("Point"===o||"MultiPoint"===o||"LineString"===o)a=P(i.geometry,t);else if("MultiLineString"===o||"Polygon"===o)for(var a=[],s=0;s<i.geometry.length;s++)a.push(P(i.geometry[s],t));else if("MultiPolygon"===o)for(a=[],s=0;s<i.geometry.length;s++){for(var l=[],u=0;u<i.geometry[s].length;u++)l.push(P(i.geometry[s][u],t));a.push(l)}r.push(S(i.id,o,a,i.tags))}return r}function P(e,t){var r=[];r.size=e.size,void 0!==e.start&&(r.start=e.start,r.end=e.end);for(var n=0;n<e.length;n+=3)r.push(e[n]+t,e[n+1],e[n+2]);return r}function pe(e,t){if(!e.transformed){for(var r,n=1<<e.z,i=e.x,o=e.y,a=0;a<e.features.length;a++){var s=e.features[a],l=s.geometry,u=s.type;if(s.geometry=[],1===u)for(r=0;r<l.length;r+=2)s.geometry.push(me(l[r],l[r+1],t,n,i,o));else for(r=0;r<l.length;r++){for(var c=[],h=0;h<l[r].length;h+=2)c.push(me(l[r][h],l[r][h+1],t,n,i,o));s.geometry.push(c)}}e.transformed=!0}return e}function me(e,t,r,n,i,o){return[Math.round(r*(e*n-i)),Math.round(r*(t*n-o))]}function ge(e,t,r,n,i){for(var o=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){a.numFeatures++,h=_=v=y=g=m=p=d=f=h=c=u=l=void 0;var l=a,u=e[s],c=o,h=i,f=u.geometry,d=u.type,p=[];if("Point"===d||"MultiPoint"===d)for(var m=0;m<f.length;m+=3)p.push(f[m]),p.push(f[m+1]),l.numPoints++,l.numSimplified++;else if("LineString"===d)z(p,f,l,c,!1,!1);else if("MultiLineString"===d||"Polygon"===d)for(m=0;m<f.length;m++)z(p,f[m],l,c,"Polygon"===d,0===m);else if("MultiPolygon"===d)for(var g=0;g<f.length;g++){var y=f[g];for(m=0;m<y.length;m++)z(p,y[m],l,c,!0,0===m)}if(p.length){var v=u.tags||null;if("LineString"===d&&h.lineMetrics){for(var _ in v={},u.tags)v[_]=u.tags[_];v.mapbox_clip_start=f.start/f.size,v.mapbox_clip_end=f.end/f.size}h={geometry:p,type:"Polygon"===d||"MultiPolygon"===d?3:"LineString"===d||"MultiLineString"===d?2:1,tags:v};null!==u.id&&(h.id=u.id),l.features.push(h)}var h=e[s].minX,x=e[s].minY,b=e[s].maxX,w=e[s].maxY;h<a.minX&&(a.minX=h),x<a.minY&&(a.minY=x),a.maxX<b&&(a.maxX=b),a.maxY<w&&(a.maxY=w)}return a}function z(e,t,r,n,i,o){var a=n*n;if(0<n&&t.size<(i?a:n))r.numPoints+=t.length/3;else{for(var s=[],l=0;l<t.length;l+=3)(0===n||t[l+2]>a)&&(r.numSimplified++,s.push(t[l]),s.push(t[l+1])),r.numPoints++;if(i){var u=s;i=o;for(var c=0,h=0,f=u.length,d=f-2;h<f;d=h,h+=2)c+=(u[h]-u[d])*(u[h+1]+u[d+1]);if(0<c===i)for(h=0,f=u.length;h<f/2;h+=2){var p=u[h],m=u[h+1];u[h]=u[f-2-h],u[h+1]=u[f-1-h],u[f-2-h]=p,u[f-1-h]=m}}e.push(s)}}function D(e,t){var r=(t=this.options=function(e,t){for(var r in t)e[r]=t[r];return e}(Object.create(this.options),t)).debug;if(r&&console.time("preprocess data"),t.maxZoom<0||24<t.maxZoom)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var n,i,o,a,s,e=function(e,t){var r=[];if("FeatureCollection"===e.type)for(var n=0;n<e.features.length;n++)M(r,e.features[n],t,n);else M(r,"Feature"===e.type?e:{geometry:e},t);return r}(e,t);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=e,i=(t=t).buffer/t.extent,a=A(o=n,1,-1-i,i,0,-1,2,t),s=A(n,1,1-i,2+i,0,-1,2,t),(a||s)&&(o=A(n,1,-i,1+i,0,-1,2,t)||[],a&&(o=de(a,1).concat(o)),s&&(o=o.concat(de(s,-1)))),(e=o).length&&this.splitTile(e,0,0,0),r&&(e.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function O(e,t,r){return 32*((1<<e)*r+t)+e}function ye(e,t){e=e.tileID.canonical;if(!this._geoJSONIndex)return t(null,null);e=this._geoJSONIndex.getTile(e.z,e.x,e.y);if(!e)return t(null,null);e=new j(e.features);let r=o(e);t(null,{vectorTile:e,rawData:(r=0===r.byteOffset&&r.byteLength===r.buffer.byteLength?r:new Uint8Array(r)).buffer})}D.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},D.prototype.splitTile=function(e,t,r,n,i,o,a){for(var s=[e,t,r,n],l=this.options,u=l.debug;s.length;){n=s.pop(),r=s.pop(),t=s.pop(),e=s.pop();var c,h,f,d,p,m,g,y,v,_=1<<t,x=O(t,r,n),b=this.tiles[x];if(b||(1<u&&console.time("creation"),b=this.tiles[x]=ge(e,t,r,n,l),this.tileCoords.push({z:t,x:r,y:n}),u&&(1<u&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,r,n,b.numFeatures,b.numPoints,b.numSimplified),console.timeEnd("creation")),this.stats[x="z"+t]=(this.stats[x]||0)+1,this.total++)),b.source=e,i){if(t===l.maxZoom||t===i)continue;var x=1<<i-t;if(r!==Math.floor(o/x)||n!==Math.floor(a/x))continue}else if(t===l.indexMaxZoom||b.numPoints<=l.indexMaxPoints)continue;b.source=null,0!==e.length&&(1<u&&console.time("clipping"),d=.5-(x=.5*l.buffer/l.extent),m=1+x,g=c=h=f=null,y=A(e,_,r-x,r+(p=.5+x),0,b.minX,b.maxX,l),v=A(e,_,r+d,r+m,0,b.minX,b.maxX,l),e=null,y&&(g=A(y,_,n-x,n+p,1,b.minY,b.maxY,l),c=A(y,_,n+d,n+m,1,b.minY,b.maxY,l),y=null),v&&(h=A(v,_,n-x,n+p,1,b.minY,b.maxY,l),f=A(v,_,n+d,n+m,1,b.minY,b.maxY,l),v=null),1<u&&console.timeEnd("clipping"),s.push(g||[],t+1,2*r,2*n),s.push(c||[],t+1,2*r,2*n+1),s.push(h||[],t+1,2*r+1,2*n),s.push(f||[],t+1,2*r+1,2*n+1))}},D.prototype.getTile=function(e,t,r){var n=this.options,i=n.extent,n=n.debug;if(e<0||24<e)return null;var o=1<<e,o=O(e,t=(t%o+o)%o,r);if(this.tiles[o])return pe(this.tiles[o],i);1<n&&console.log("drilling down to z%d-%d-%d",e,t,r);for(var a,s=e,l=t,u=r;!a&&0<s;)s--,l=Math.floor(l/2),u=Math.floor(u/2),a=this.tiles[O(s,l,u)];return a&&a.source&&(1<n&&console.log("found parent tile z%d-%d-%d",s,l,u),1<n&&console.time("drilling down"),this.splitTile(a.source,s,l,u,e,t,r),1<n&&console.timeEnd("drilling down"),this.tiles[o])?pe(this.tiles[o],i):null};class ve extends l.VectorTileWorkerSource{constructor(e,t,r,n,i){super(e,t,r,n,ye),i&&(this.loadGeoJSON=i)}loadData(r,n){const i=r&&r.request,o=i&&i.collectResourceTiming;this.loadGeoJSON(r,(e,t)=>{if(e||!t)return n(e);if("object"!=typeof t)return n(new Error(`Input data given to '${r.source}' is not a valid GeoJSON object.`));s(t,!0);try{if(r.filter){const n=l.createExpression(r.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===n.result)throw new Error(n.value.map(e=>e.key+": "+e.message).join(", "));const i=t.features.filter(e=>n.value.evaluate({zoom:0},e));t={type:"FeatureCollection",features:i}}this._geoJSONIndex=r.cluster?new ee(function({superclusterOptions:e,clusterProperties:t}){if(t&&e){const r={},n={},i={accumulated:null,zoom:0},o={properties:null},a=Object.keys(t);for(const e of a){const[i,o]=t[e],a=l.createExpression(o),s=l.createExpression("string"==typeof i?[i,["accumulated"],["get",e]]:i);r[e]=a.value,n[e]=s.value}e.map=e=>{o.properties=e;var t={};for(const e of a)t[e]=r[e].evaluate(i,o);return t},e.reduce=(e,t)=>{o.properties=t;for(const t of a)i.accumulated=e[t],e[t]=n[t].evaluate(i,o)}}return e}(r)).load(t.features):new D(t,r.geojsonVtOptions)}catch(e){return n(e)}this.loaded={};t={};if(o){const n=l.getPerformanceMeasurement(i);n&&(t.resourceTiming={},t.resourceTiming[r.source]=JSON.parse(JSON.stringify(n)))}n(null,t)})}reloadTile(e,t){var r=this.loaded;return r&&r[e.uid]?super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,r){if(t.request)l.getJSON(t.request,r);else{if("string"!=typeof t.data)return r(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`));try{return r(null,JSON.parse(t.data))}catch(e){return r(new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class _e{constructor(e){this.self=e,this.actor=new l.Actor(e,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=l.getProjection({name:"mercator"}),this.workerSourceTypes={vector:l.VectorTileWorkerSource,geojson:ve},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=e=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=e.applyArabicShaping,l.plugin.processBidirectionalText=e.processBidirectionalText,l.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText}}clearCaches(e,t,r){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e],r()}checkIfReady(e,t,r){r()}setReferrer(e,t){this.referrer=t}spriteLoaded(e,t){this.isSpriteLoaded[e]=t;for(const n in this.workerSources[e]){var r=this.workerSources[e][n];for(const e in r)r[e]instanceof l.VectorTileWorkerSource&&(r[e].isSpriteLoaded=t,r[e].fire(new l.Event("isSpriteLoaded")))}}setImages(e,t,r){this.availableImages[e]=t;for(const r in this.workerSources[e]){var n=this.workerSources[e][r];for(const e in n)n[e].availableImages=t}r()}enableTerrain(e,t,r){this.terrain=t,r()}setProjection(e,t){this.projections[e]=l.getProjection(t)}setLayers(e,t,r){this.getLayerIndex(e).replace(t),r()}updateLayers(e,t,r){this.getLayerIndex(e).update(t.layers,t.removedIds),r()}loadTile(e,t,r){var n=this.enableTerrain?l.extend({enableTerrain:this.terrain},t):t;n.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source).loadTile(n,r)}loadDEMTile(e,t,r){var n=this.enableTerrain?l.extend({buildQuadTree:this.terrain},t):t;this.getDEMWorkerSource(e,t.source).loadTile(n,r)}reloadTile(e,t,r){var n=this.enableTerrain?l.extend({enableTerrain:this.terrain},t):t;n.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source).reloadTile(n,r)}abortTile(e,t,r){this.getWorkerSource(e,t.type,t.source).abortTile(t,r)}removeTile(e,t,r){this.getWorkerSource(e,t.type,t.source).removeTile(t,r)}removeSource(e,t,r){var n;this.workerSources[e]&&this.workerSources[e][t.type]&&this.workerSources[e][t.type][t.source]&&(n=this.workerSources[e][t.type][t.source],delete this.workerSources[e][t.type][t.source],void 0!==n.removeSource?n.removeSource(t,r):r())}loadWorkerSource(e,t,r){try{this.self.importScripts(t.url),r()}catch(e){r(e.toString())}}syncRTLPluginState(e,t,r){try{l.plugin.setState(t);const e=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&null!=e){this.self.importScripts(e);const t=l.plugin.isParsed();r(t?void 0:new Error("RTL Text Plugin failed to import scripts from "+e),t)}}catch(e){r(e.toString())}}getAvailableImages(e){let t=this.availableImages[e];return t=t||[]}getLayerIndex(e){let t=this.layerIndexes[e];return t=t||(this.layerIndexes[e]=new R)}getWorkerSource(a,e,t){var r;return this.workerSources[a]||(this.workerSources[a]={}),this.workerSources[a][e]||(this.workerSources[a][e]={}),this.workerSources[a][e][t]||(r={send:(e,t,r,n,i,o)=>{this.actor.send(e,t,r,a,i,o)},scheduler:this.actor.scheduler},this.workerSources[a][e][t]=new this.workerSourceTypes[e](r,this.getLayerIndex(a),this.getAvailableImages(a),this.isSpriteLoaded[a])),this.workerSources[a][e][t]}getDEMWorkerSource(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new F),this.demWorkerSources[e][t]}enforceCacheSizeLimit(e,t){l.enforceCacheSizeLimit(t)}getWorkerPerformanceMetrics(e,t,r){r(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new _e(self)),_e}),e(0,function(se){function x(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return;for(let e=0;e<t.length;e++)if(!x(t[e],r[e]))return;return 1}if("object"!=typeof t||null===t||null===r)return t===r;if("object"==typeof r&&Object.keys(t).length===Object.keys(r).length){for(const e in t)if(!x(t[e],r[e]))return;return 1}}var A=P;function P(e){return e=e,!("undefined"==typeof window||"undefined"==typeof document||(!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||(!Function.prototype||!Function.prototype.bind||(!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||(!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||(!function(){if("Worker"in window&&"Blob"in window&&"URL"in window){var e,t,r=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(r);try{t=new Worker(r),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(r),e}}()||(!("Uint8ClampedArray"in window)||(!ArrayBuffer.isView||(!function(){var e=document.createElement("canvas"),t=(e.width=e.height=1,e.getContext("2d"));if(t)return(t=t.getImageData(0,0,1,1))&&t.width===e.width}()||(void 0===z[i=e&&e.failIfMajorPerformanceCaveat]&&(z[i]=function(){n=i,t=document.createElement("canvas"),(r=Object.create(P.webGLContextAttributes)).failIfMajorPerformanceCaveat=n;var e,t,r,n=t.getContext("webgl",r)||t.getContext("experimental-webgl",r);if(!n)return!1;try{e=n.createShader(n.VERTEX_SHADER)}catch(e){return!1}return!(!e||n.isContextLost())&&(n.shaderSource(e,"void main() {}"),n.compileShader(e),!0===n.getShaderParameter(e,n.COMPILE_STATUS))}()),!z[i]||!!document.documentMode))))))))));var i}var z={};function l(e,t,r){e=se.window.document.createElement(e);return void 0!==t&&(e.className=t),r&&r.appendChild(e),e}function o(e,t,r){var n=se.window.document.createElementNS("http://www.w3.org/2000/svg",e);for(const se of Object.keys(t))n.setAttributeNS(null,se,t[se]);return r&&r.appendChild(n),n}P.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const e=se.window.document&&se.window.document.documentElement.style,t=e&&void 0!==e.userSelect?"userSelect":"WebkitUserSelect";let D;function F(){e&&t&&(D=e[t],e[t]="none")}function B(){e&&t&&(e[t]=D)}function N(e){e.preventDefault(),e.stopPropagation(),se.window.removeEventListener("click",N,!0)}function j(){se.window.addEventListener("click",N,!0),se.window.setTimeout(()=>{se.window.removeEventListener("click",N,!0)},0)}function f(e,t){var r=e.getBoundingClientRect();return G(e,r,t)}function d(t,r){var n=t.getBoundingClientRect(),i=[];for(let e=0;e<r.length;e++)i.push(G(t,n,r[e]));return i}function V(e){return void 0!==se.window.InstallTrigger&&2===e.button&&e.ctrlKey&&0<=se.window.navigator.platform.toUpperCase().indexOf("MAC")?0:e.button}function G(e,t,r){e=e.offsetWidth===t.width?1:e.offsetWidth/t.width;return new se.pointGeometry((r.clientX-t.left)*e,(r.clientY-t.top)*e)}function W(e,t){var r=t[0],n=t[1],i=t[2],t=t[3],o=r*t-i*n;return o?(e[0]=t*(o=1/o),e[1]=-n*o,e[2]=-i*o,e[3]=r*o,e):null}function Z(e){var t=e["userImage"];return t&&t.render&&t.render()&&(e.data.replace(new Uint8Array(t.data.buffer)),1)}class q extends se.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new se.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e)){for(const{ids:e,callback:t}of this.requestors)this._notify(e,t);this.requestors=[]}}hasImage(e){return!!this.getImage(e)}getImage(e){return this.images[e]}addImage(e,t){this._validate(e,t)&&(this.images[e]=t)}_validate(e,t){let r=!0;return this._validateStretch(t.stretchX,t.data&&t.data.width)||(this.fire(new se.ErrorEvent(new Error(`Image "${e}" has invalid "stretchX" value`))),r=!1),this._validateStretch(t.stretchY,t.data&&t.data.height)||(this.fire(new se.ErrorEvent(new Error(`Image "${e}" has invalid "stretchY" value`))),r=!1),this._validateContent(t.content,t)||(this.fire(new se.ErrorEvent(new Error(`Image "${e}" has invalid "content" value`))),r=!1),r}_validateStretch(t,r){if(t){let e=0;for(const n of t){if(n[0]<e||n[1]<n[0]||r<n[1])return!1;e=n[1]}}return!0}_validateContent(e,t){return!(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,t){t.version=this.images[e].version+1,this.images[e]=t,this.updatedImages[e]=!0}removeImage(e){var t=this.images[e];delete this.images[e],delete this.patterns[e],t.userImage&&t.userImage.onRemove&&t.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e,t){let r=!0;if(!this.isLoaded())for(const t of e)this.images[t]||(r=!1);this.isLoaded()||r?this._notify(e,t):this.requestors.push({ids:e,callback:t})}_notify(e,t){var r={};for(const t of e){this.images[t]||this.fire(new se.Event("styleimagemissing",{id:t}));const e=this.images[t];e?r[t]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:se.warnOnce(`Image "${t}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}t(null,r)}getPixelSize(){var{width:e,height:t}=this.atlasImage;return{width:e,height:t}}getPattern(e){const t=this.patterns[e],r=this.getImage(e);if(!r)return null;if(t&&t.position.version===r.version)return t.position;if(t)t.position.version=r.version;else{const t={w:r.data.width+2,h:r.data.height+2,x:0,y:0},n=new se.ImagePosition(t,r);this.patterns[e]={bin:t,position:n}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){var t=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new se.Texture(e,this.atlasImage,t.RGBA),this.atlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const se in this.patterns)e.push(this.patterns[se].bin);const{w:t,h:r}=se.potpack(e),n=this.atlasImage;n.resize({width:t||1,height:r||1});for(const e in this.patterns){const t=this.patterns[e]["bin"],r=t.x+1,i=t.y+1,o=this.images[e].data,a=o.width,s=o.height;se.RGBAImage.copy(o,n,{x:0,y:0},{x:r,y:i},{width:a,height:s}),se.RGBAImage.copy(o,n,{x:0,y:s-1},{x:r,y:i-1},{width:a,height:1}),se.RGBAImage.copy(o,n,{x:0,y:0},{x:r,y:i+s},{width:a,height:1}),se.RGBAImage.copy(o,n,{x:a-1,y:0},{x:r-1,y:i},{width:1,height:s}),se.RGBAImage.copy(o,n,{x:0,y:0},{x:r+a,y:i},{width:1,height:s})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const t of e)if(!this.callbackDispatchedThisFrame[t]){this.callbackDispatchedThisFrame[t]=!0;const e=this.images[t];Z(e)&&this.updateImage(t,e)}}}const H=new se.Properties({anchor:new se.DataConstantProperty(se.spec.light.anchor),position:new class{constructor(){this.specification=se.spec.light.position}possiblyEvaluate(e,t){return[e,t,r]=[e.expression.evaluate(t)][0],n=se.degToRad(t+90),i=se.degToRad(r),{x:e*Math.cos(n)*Math.sin(i),y:e*Math.sin(n)*Math.sin(i),z:e*Math.cos(i),azimuthal:t,polar:r};var r,n,i}interpolate(e,t,r){return{x:se.number(e.x,t.x,r),y:se.number(e.y,t.y,r),z:se.number(e.z,t.z,r),azimuthal:se.number(e.azimuthal,t.azimuthal,r),polar:se.number(e.polar,t.polar,r)}}},color:new se.DataConstantProperty(se.spec.light.color),intensity:new se.DataConstantProperty(se.spec.light.intensity)}),$="-transition";class X extends se.Evented{constructor(e){super(),this._transitionable=new se.Transitionable(H),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,t={}){if(!this._validate(se.validateLight,e,t))for(const t in e){var r=e[t];se.endsWith(t,$)?this._transitionable.setTransition(t.slice(0,-$.length),r):this._transitionable.setValue(t,r)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,t,r){return(!r||!1!==r.validate)&&se.emitValidationErrors(this,e.call(se.validateStyle,se.extend({value:t,style:{glyphs:!0,sprite:!0},styleSpec:se.spec})))}}const Y=new se.Properties({source:new se.DataConstantProperty(se.spec.terrain.source),exaggeration:new se.DataConstantProperty(se.spec.terrain.exaggeration)}),J="-transition";class K extends se.Evented{constructor(e,t){super(),this._transitionable=new se.Transitionable(Y),this.set(e),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(e){for(const r in e){var t=e[r];se.endsWith(r,J)?this._transitionable.setTransition(r.slice(0,-J.length),t):this._transitionable.setValue(r,t)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}}function Q(e,t,r,n){var r=se.smoothstep(45,65,r),[n,i]=ee(e,n),t=se.length(t),t=1-Math.min(1,Math.exp((t-n)/(i-n)*-6));return t*=t*t,Math.min(1,1.00747*t)*r*e.alpha}function ee(e,t){t=.5/Math.tan(.5*t);return[e.range[0]+t,e.range[1]+t]}const te=new se.Properties({range:new se.DataConstantProperty(se.spec.fog.range),color:new se.DataConstantProperty(se.spec.fog.color),"high-color":new se.DataConstantProperty(se.spec.fog["high-color"]),"space-color":new se.DataConstantProperty(se.spec.fog["space-color"]),"horizon-blend":new se.DataConstantProperty(se.spec.fog["horizon-blend"]),"star-intensity":new se.DataConstantProperty(se.spec.fog["star-intensity"])}),re="-transition";class ne extends se.Evented{constructor(e,t){super(),this._transitionable=new se.Transitionable(te),this.set(e),this._transitioning=this._transitionable.untransitioned(),this._transform=t}get state(){var e=this._transform,t="globe"===e.projection.name,e=se.globeToMercatorTransition(e.zoom),r=this.properties.get("range"),n=[.5,3];return{range:t?[se.number(n[0],r[0],e),se.number(n[1],r[1],e)]:r,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e,t={}){if(!this._validate(se.validateFog,e,t)){for(const t of Object.keys(se.spec.fog))e&&void 0===e[t]&&(e[t]=se.spec.fog[t].default);for(const t in e){var r=e[t];se.endsWith(t,re)?this._transitionable.setTransition(t.slice(0,-re.length),r):this._transitionable.setValue(t,r)}}}getOpacity(e){var t;return this._transform.projection.supportsFog?(t=this.properties&&this.properties.get("color")||1,("globe"===this._transform.projection.name?1:se.smoothstep(45,65,e))*t.a):0}getOpacityAtLatLng(e,t){return this._transform.projection.supportsFog?(r=this.state,t=t,e=se.MercatorCoordinate.fromLngLat(e),n=t.elevation?t.elevation.getAtPointOrZero(e):0,e=[e.x,e.y,n],se.transformMat4(e,e,t.mercatorFogMatrix),Q(r,e,t.pitch,t._fov)):0;var r,n}getFovAdjustedRange(e){return this._transform.projection.supportsFog?ee(this.state,e):[0,1]}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,t,r){return(!r||!1!==r.validate)&&se.emitValidationErrors(this,e.call(se.validateStyle,se.extend({value:t,style:{glyphs:!0,sprite:!0},styleSpec:se.spec})))}}class i{constructor(t,r){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=se.uniqueId();var n=this.workerPool.acquire(this.id);for(let e=0;e<n.length;e++){const t=new i.Actor(n[e],r,this.id);t.name="Worker "+e,this.actors.push(t)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,n,e){se.asyncAll(this.actors,(e,t)=>{e.send(r,n,t)},e=e||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}function I(e,t,r){return t*(se.EXTENT/(e.tileSize*Math.pow(2,r-e.tileID.overscaledZ)))}i.Actor=se.Actor;class ie{constructor(e,t,r,n){this.screenBounds=e,this.cameraPoint=t,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=r,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,n)}static createFromScreenPoints(e,t){let r,n;var i;return n=e instanceof se.pointGeometry||"number"==typeof e[0]?(i=se.pointGeometry.convert(e),r=[i],t.isPointAboveHorizon(i)):(i=se.pointGeometry.convert(e[0]),e=se.pointGeometry.convert(e[1]),r=[i,e],se.polygonizeBounds(i,e).every(e=>t.isPointAboveHorizon(e))),new ie(r,t.getCameraPoint(),n,t)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(e){return se.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){var t=this.screenBounds[0],r=1===this.screenBounds.length?this.screenBounds[0].add(new se.pointGeometry(1,1)):this.screenBounds[1],n=se.polygonizeBounds(t,r,0,!1);return this.cameraPoint.y>r.y&&(this.cameraPoint.x>t.x&&this.cameraPoint.x<r.x?n.splice(3,0,this.cameraPoint):this.cameraPoint.x>=r.x?n[2]=this.cameraPoint:this.cameraPoint.x<=t.x&&(n[3]=this.cameraPoint)),se.bufferConvexPolygon(n,e)}bufferedCameraGeometryGlobe(e){var t=this.screenBounds[0],r=1===this.screenBounds.length?this.screenBounds[0].add(new se.pointGeometry(1,1)):this.screenBounds[1],n=se.polygonizeBounds(t,r,e),i=this.cameraPoint.clone();switch(3*((i.y>t.y)+(i.y>r.y))+((i.x>t.x)+(i.x>r.x))){case 0:n[0]=i,n[4]=i.clone();break;case 1:n.splice(1,0,i);break;case 2:n[1]=i;break;case 3:n.splice(4,0,i);break;case 5:n.splice(2,0,i);break;case 6:n[3]=i;break;case 7:n.splice(3,0,i);break;case 8:n[2]=i}return n}containsTile(t,e,r,n=0){var i=t.queryPadding/e._pixelsPerMercatorPixel+1,r=r?this._bufferedCameraMercator(i,e):this._bufferedScreenMercator(i,e);let o=t.tileID.wrap+(r.unwrapped?n:0);i=r.polygon.map(e=>se.getTilePoint(t.tileTransform,e,o));if(se.polygonIntersectsBox(i,0,0,se.EXTENT,se.EXTENT)){o=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?n:0);const a=this.screenGeometryMercator.polygon.map(e=>se.getTileVec3(t.tileTransform,e,o)),s=a.map(e=>new se.pointGeometry(e[0],e[1])),l=e.getFreeCameraOptions().position||new se.MercatorCoordinate(0,0,0),u=se.getTileVec3(t.tileTransform,l,o),c=a.map(e=>{e=se.sub(e,e,u);return se.normalize(e,e),new se.Ray(u,e)}),h=I(t,1,e.zoom)*e._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:s,tilespaceRays:c,bufferedTilespaceGeometry:i,bufferedTilespaceBounds:((r=se.getBounds(i)).min.x=se.clamp(r.min.x,0,se.EXTENT),r.min.y=se.clamp(r.min.y,0,se.EXTENT),r.max.x=se.clamp(r.max.x,0,se.EXTENT),r.max.y=se.clamp(r.max.y,0,se.EXTENT),r),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:h}}}_bufferedScreenMercator(e,t){var r=ae(e);return this._screenRaycastCache[r]||(e="globe"===t.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),t):{polygon:this.bufferedScreenGeometry(e).map(e=>t.pointCoordinate3D(e)),unwrapped:!0},this._screenRaycastCache[r]=e)}_bufferedCameraMercator(e,t){var r=ae(e);return this._cameraRaycastCache[r]||(e="globe"===t.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),t):{polygon:this.bufferedCameraGeometry(e).map(e=>t.pointCoordinate3D(e)),unwrapped:!0},this._cameraRaycastCache[r]=e)}_projectAndResample(e,t){var r=function(e,t){var r=se.multiply([],t.pixelMatrix,t.globeMatrix),n=[0,-se.GLOBE_RADIUS,0,1],i=[0,se.GLOBE_RADIUS,0,1],o=[0,0,0,1],r=(se.transformMat4$1(n,n,r),se.transformMat4$1(i,i,r),se.transformMat4$1(o,o,r),new se.pointGeometry(n[0]/n[3],n[1]/n[3])),a=new se.pointGeometry(i[0]/i[3],i[1]/i[3]),r=se.polygonContainsPoint(e,r)&&n[3]<o[3],n=se.polygonContainsPoint(e,a)&&i[3]<o[3];if(!r&&!n)return null;a=function(t,r,n){for(let e=1;e<t.length;e++){var i=u(r.pointCoordinate3D(t[e-1]).x),o=u(r.pointCoordinate3D(t[e]).x);if(n<0){if(i<o)return{idx:e,t:-i/(o-1-i)}}else if(o<i)return{idx:e,t:(1-i)/(o+1-i)}}return null}(e,t,r?-1:1);if(!a)return null;var{idx:i,t:o}=a;let s=1<i?oe(e.slice(0,i),t):[],l=i<e.length?oe(e.slice(i),t):[];s=s.map(e=>new se.pointGeometry(u(e.x),e.y)),l=l.map(e=>new se.pointGeometry(u(e.x),e.y));n=[...s],0===n.length&&n.push(l[l.length-1]),a=se.number(n[n.length-1].y,(0===l.length?s:l)[0].y,o),e=r?[new se.pointGeometry(0,a),new se.pointGeometry(0,0),new se.pointGeometry(1,0),new se.pointGeometry(1,a)]:[new se.pointGeometry(1,a),new se.pointGeometry(1,1),new se.pointGeometry(0,1),new se.pointGeometry(0,a)];return n.push(...e),0===l.length?n.push(s[0]):n.push(...l),{polygon:n.map(e=>new se.MercatorCoordinate(e.x,e.y)),unwrapped:!1}}(e,t);return r||{polygon:(r=function(t,r){let n=!1,i=-1/0,o=0;for(let e=0;e<t.length-1;e++)t[e].x>i&&(i=t[e].x,o=e);for(let e=0;e<t.length-1;e++){const r=(o+e)%(t.length-1),i=t[r],a=t[1+r];.5<Math.abs(i.x-a.x)&&(i.x<a.x?(i.x+=1,0==r&&(t[t.length-1].x+=1)):(a.x+=1,1+r==t.length-1&&(t[0].x+=1)),n=!0)}const a=se.mercatorXfromLng(r.center.lng);return n&&a<Math.abs(a-1)&&t.forEach(e=>{--e.x}),{polygon:t,unwrapped:n}}(oe(e,t).map(e=>new se.pointGeometry(u(e.x),e.y)),t)).polygon.map(e=>new se.MercatorCoordinate(e.x,e.y)),unwrapped:r.unwrapped}}}function oe(e,r){return se.resample(e,e=>{var t=r.pointCoordinate3D(e);e.x=t.x,e.y=t.y},1/256)}function u(e){return e<0?1+e%1:e%1}function ae(e){return 100*e|0}function ue(r,n,e,t,i){function o(e,t){if(e)return i(e);if(t){r.url&&t.tiles&&r.tiles&&delete r.tiles;const e=se.pick(se.extend(t,r),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);t.vector_layers&&(e.vectorLayers=t.vector_layers,e.vectorLayerIds=e.vectorLayers.map(e=>e.id)),e.tiles=n.canonicalizeTileset(e,r.url),i(null,e)}}return r.url?se.getJSON(n.transformRequest(n.normalizeSourceURL(r.url,null,e,t),se.ResourceType.Source),o):se.exported.frame(()=>o(null,r))}class ce{constructor(e,t,r){this.bounds=se.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=t||0,this.maxzoom=r||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){var t=Math.pow(2,e.z),r=Math.floor(se.mercatorXfromLng(this.bounds.getWest())*t),n=Math.floor(se.mercatorYfromLat(this.bounds.getNorth())*t),i=Math.ceil(se.mercatorXfromLng(this.bounds.getEast())*t),t=Math.ceil(se.mercatorYfromLat(this.bounds.getSouth())*t);return e.x>=r&&e.x<i&&e.y>=n&&e.y<t}}class he{constructor(e,t,r){var n=(this.context=e).gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(r),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||t.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){var t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const fe={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class de{constructor(e,t,r,n){this.length=t.length,this.attributes=r,this.itemSize=t.bytesPerElement,this.dynamicDraw=n;r=(this.context=e).gl;this.buffer=r.createBuffer(),e.bindVertexBuffer.set(this.buffer),r.bufferData(r.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||t.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){var t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(t,r){for(let e=0;e<this.attributes.length;e++){var n=r.attributes[this.attributes[e].name];void 0!==n&&t.enableVertexAttribArray(n)}}setVertexAttribPointers(t,r,n){for(let e=0;e<this.attributes.length;e++){var i=this.attributes[e],o=r.attributes[i.name];void 0!==o&&t.vertexAttribPointer(o,i.components,t[fe[i.type]],!1,this.itemSize,i.offset+this.itemSize*(n||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class r{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class pe extends r{getDefault(){return se.Color.transparent}set(e){var t=this.current;e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a&&!this.dirty||(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class me extends r{getDefault(){return 1}set(e){e===this.current&&!this.dirty||(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class ge extends r{getDefault(){return 0}set(e){e===this.current&&!this.dirty||(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class ye extends r{getDefault(){return[!0,!0,!0,!0]}set(e){var t=this.current;e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&!this.dirty||(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ve extends r{getDefault(){return!0}set(e){e===this.current&&!this.dirty||(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class _e extends r{getDefault(){return 255}set(e){e===this.current&&!this.dirty||(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class xe extends r{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){var t=this.current;e.func===t.func&&e.ref===t.ref&&e.mask===t.mask&&!this.dirty||(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class be extends r{getDefault(){var e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){var t=this.current;e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&!this.dirty||(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class we extends r{getDefault(){return!1}set(e){var t;e===this.current&&!this.dirty||(t=this.gl,e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1)}}class Ee extends r{getDefault(){return[0,1]}set(e){var t=this.current;e[0]===t[0]&&e[1]===t[1]&&!this.dirty||(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Te extends r{getDefault(){return!1}set(e){var t;e===this.current&&!this.dirty||(t=this.gl,e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1)}}class Se extends r{getDefault(){return this.gl.LESS}set(e){e===this.current&&!this.dirty||(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Me extends r{getDefault(){return!1}set(e){var t;e===this.current&&!this.dirty||(t=this.gl,e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1)}}class ke extends r{getDefault(){var e=this.gl;return[e.ONE,e.ZERO]}set(e){var t=this.current;e[0]===t[0]&&e[1]===t[1]&&!this.dirty||(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Ce extends r{getDefault(){return se.Color.transparent}set(e){var t=this.current;e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a&&!this.dirty||(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ae extends r{getDefault(){return this.gl.FUNC_ADD}set(e){e===this.current&&!this.dirty||(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Ie extends r{getDefault(){return!1}set(e){var t;e===this.current&&!this.dirty||(t=this.gl,e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1)}}class Le extends r{getDefault(){return this.gl.BACK}set(e){e===this.current&&!this.dirty||(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Pe extends r{getDefault(){return this.gl.CCW}set(e){e===this.current&&!this.dirty||(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class ze extends r{getDefault(){return null}set(e){e===this.current&&!this.dirty||(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class De extends r{getDefault(){return this.gl.TEXTURE0}set(e){e===this.current&&!this.dirty||(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Oe extends r{getDefault(){var e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){var t=this.current;e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&!this.dirty||(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Re extends r{getDefault(){return null}set(e){var t;e===this.current&&!this.dirty||((t=this.gl).bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1)}}class Fe extends r{getDefault(){return null}set(e){var t;e===this.current&&!this.dirty||((t=this.gl).bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1)}}class Be extends r{getDefault(){return null}set(e){var t;e===this.current&&!this.dirty||((t=this.gl).bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1)}}class Ne extends r{getDefault(){return null}set(e){var t;e===this.current&&!this.dirty||((t=this.gl).bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1)}}class je extends r{getDefault(){return null}set(e){var t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ue extends r{constructor(e){super(e),this.vao=e.extVertexArrayObject}getDefault(){return null}set(e){this.vao&&(e!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(e),this.current=e,this.dirty=!1)}}class Ve extends r{getDefault(){return 4}set(e){var t;e===this.current&&!this.dirty||((t=this.gl).pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1)}}class Ge extends r{getDefault(){return!1}set(e){var t;e===this.current&&!this.dirty||((t=this.gl).pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1)}}class We extends r{getDefault(){return!1}set(e){var t;e===this.current&&!this.dirty||((t=this.gl).pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1)}}class Ze extends r{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class qe extends Ze{setDirty(){this.dirty=!0}set(e){var t;e===this.current&&!this.dirty||(this.context.bindFramebuffer.set(this.parent),(t=this.gl).framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1)}}class He extends Ze{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){var t;e===this.current&&!this.dirty||(this.context.bindFramebuffer.set(this.parent),(t=this.gl).framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1)}}class $e extends He{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Xe{constructor(e,t,r,n){this.context=e,this.width=t,this.height=r;t=this.framebuffer=e.gl.createFramebuffer();this.colorAttachment=new qe(e,t),n&&(this.depthAttachment=new He(e,t))}destroy(){const e=this.context.gl,t=this.colorAttachment.get();if(t&&e.deleteTexture(t),this.depthAttachment){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}e.deleteFramebuffer(this.framebuffer)}}class Ye{constructor(e,t=!1){if(this.gl=e,this.isWebGL2=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),t){const t=e;this.extVertexArrayObject={createVertexArrayOES:t.createVertexArray.bind(e),deleteVertexArrayOES:t.deleteVertexArray.bind(e),bindVertexArrayOES:t.bindVertexArray.bind(e)}}this.clearColor=new pe(this),this.clearDepth=new me(this),this.clearStencil=new ge(this),this.colorMask=new ye(this),this.depthMask=new ve(this),this.stencilMask=new _e(this),this.stencilFunc=new xe(this),this.stencilOp=new be(this),this.stencilTest=new we(this),this.depthRange=new Ee(this),this.depthTest=new Te(this),this.depthFunc=new Se(this),this.blend=new Me(this),this.blendFunc=new ke(this),this.blendColor=new Ce(this),this.blendEquation=new Ae(this),this.cullFace=new Ie(this),this.cullFaceSide=new Le(this),this.frontFace=new Pe(this),this.program=new ze(this),this.activeTexture=new De(this),this.viewport=new Oe(this),this.bindFramebuffer=new Re(this),this.bindRenderbuffer=new Fe(this),this.bindTexture=new Be(this),this.bindVertexBuffer=new Ne(this),this.bindElementBuffer=new je(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ue(this),this.pixelStoreUnpack=new Ve(this),this.pixelStoreUnpackPremultiplyAlpha=new Ge(this),this.pixelStoreUnpackFlipY=new We(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),t||(this.extTextureHalfFloat=e.getExtension("OES_texture_half_float")),(t||this.extTextureHalfFloat&&e.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=t||e.getExtension("OES_standard_derivatives"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t){return new he(this,e,t)}createVertexBuffer(e,t,r){return new de(this,e,t,r)}createRenderbuffer(e,t,r){var n=this.gl,i=n.createRenderbuffer();return this.bindRenderbuffer.set(i),n.renderbufferStorage(n.RENDERBUFFER,e,t,r),this.bindRenderbuffer.set(null),i}createFramebuffer(e,t,r){return new Xe(this,e,t,r)}clear({color:e,depth:t,stencil:r}){var n=this.gl;let i=0;e&&(i|=n.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==t&&(i|=n.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(t),this.depthMask.set(!0)),void 0!==r&&(i|=n.STENCIL_BUFFER_BIT,this.clearStencil.set(r),this.stencilMask.set(255)),n.clear(i)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){x(e.blendFunction,se.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Je extends se.Evented{constructor(e,t,r,n){if(super(),this.id=e,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,se.extend(this,se.pick(t,["url","scheme","tileSize","promoteId"])),this._options=se.extend({type:"vector"},t),this._collectResourceTiming=t.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(n),this._tileWorkers={},this._deduped=new se.DedupedRequest}load(r){this._loaded=!1,this.fire(new se.Event("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map._worldview;this._tileJSONRequest=ue(this._options,this.map._requestManager,n,i,(e,t)=>{this._tileJSONRequest=null,this._loaded=!0,e?(n&&console.warn("Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: "+n),i&&2!==i.length&&console.warn("Requested worldview strings must be a valid ISO alpha-2 code. Found: "+i),this.fire(new se.ErrorEvent(e))):t&&(se.extend(this,t),t.bounds&&(this.tileBounds=new ce(t.bounds,this.minzoom,this.maxzoom)),se.postTurnstileEvent(t.tiles,this.map._requestManager._customAccessToken),this.fire(new se.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new se.Event("data",{dataType:"source",sourceDataType:"content"}))),r&&r(e)})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return se.extend({},this._options)}loadTile(r,n){const e=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme)),i={request:this.map._requestManager.transformRequest(e,se.ResourceType.Tile),data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:se.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile};if(i.request.collectResourceTiming=this._collectResourceTiming,r.actor&&"expired"!==r.state)"loading"===r.state?r.reloadCallback=n:r.request=r.actor.send("reloadTile",i,o.bind(this));else if(r.actor=this._tileWorkers[e]=this._tileWorkers[e]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",i,o.bind(this),void 0,!0);else{const n=se.loadVectorTile.call({deduped:this._deduped},i,(e,t)=>{e||!t?o.call(this,e):(i.data={cacheControl:t.cacheControl,expires:t.expires,rawData:t.rawData.slice(0)},r.actor&&r.actor.send("loadTile",i,o.bind(this),void 0,!0))},!0);r.request={cancel:n}}function o(e,t){return delete r.request,r.aborted?n(null):e&&404!==e.status?n(e):(t&&t.resourceTiming&&(r.resourceTiming=t.resourceTiming),this.map._refreshExpiredTiles&&t&&r.setExpiryData(t),r.loadVectorData(t,this.map.painter),se.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id})}unloadTile(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class a extends se.Evented{constructor(e,t,r,n){super(),this.id=e,this.dispatcher=r,this.setEventedParent(n),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=se.extend({type:"raster"},t),se.extend(this,se.pick(t,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new se.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ue(this._options,this.map._requestManager,null,null,(e,t)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new se.ErrorEvent(e)):t&&(se.extend(this,t),t.bounds&&(this.tileBounds=new ce(t.bounds,this.minzoom,this.maxzoom)),se.postTurnstileEvent(t.tiles),this.fire(new se.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new se.Event("data",{dataType:"source",sourceDataType:"content"}))),r&&r(e)})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return se.extend({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(i,o){var e=2<=se.exported.devicePixelRatio,e=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),e,this.tileSize);i.request=se.getImage(this.map._requestManager.transformRequest(e,se.ResourceType.Tile),(e,t,r,n)=>(delete i.request,i.aborted?(i.state="unloaded",o(null)):e?(i.state="errored",o(e)):t?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:r,expires:n}),i.setTexture(t,this.map.painter),i.state="loaded",se.cacheEntryPossiblyAdded(this.dispatcher),void o(null)):o(null)))}static loadTileData(e,t,r){e.setTexture(t,r)}static unloadTileData(e,t){e.texture&&t.saveTileTexture(e.texture)}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t()}unloadTile(e,t){e.texture&&this.map.painter.saveTileTexture(e.texture),t()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let Ke;function Qe(e,t,r,n,i,o,a,s){var e=[e,r,i,t,n,o,1,1,1],r=[a,s,1],i=se.adjoint([],e),[t,n,o]=se.transformMat3(r,r,se.transpose(i,i));return se.multiply$1(e,[t,0,0,0,n,0,0,0,o],e)}class E extends se.Evented{constructor(e,t,r,n){super(),this.id=e,this.dispatcher=r,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(n),this.options=t,this._dirty=!1}load(r,e){this._loaded=e||!1,this.fire(new se.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=se.getImage(this.map._requestManager.transformRequest(this.url,se.ResourceType.Image),(e,t)=>{if(this._imageRequest=null,this._loaded=!0,e)this.fire(new se.ErrorEvent(e));else if(t){const e=se.window["HTMLImageElement"];this.image=t instanceof e?se.exported.getImageData(t):t,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(e){return this.image&&e.url&&(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded)),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new se.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(e){this.coordinates=e,this._boundsArray=void 0;var a=e.map(se.MercatorCoordinate.fromLngLat);return this.tileID=function(){let e=1/0,t=1/0,r=-1/0,n=-1/0;for(const se of a)e=Math.min(e,se.x),t=Math.min(t,se.y),r=Math.max(r,se.x),n=Math.max(n,se.y);var i=Math.max(r-e,n-t),i=Math.max(0,Math.floor(-Math.log(i)/Math.LN2)),o=Math.pow(2,i);return new se.CanonicalTileID(i,Math.floor((e+r)/2*o),Math.floor((t+n)/2*o))}(),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new se.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(e){for(const se in this.tiles){const e=this.tiles[se];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}if(!this._boundsArray){const f=se.tileTransform(this.tileID,this.map.transform.projection),[d,p,m,g]=this.coordinates.map(e=>{e=f.projection.project(e[0],e[1]);return se.getTilePoint(f,e)._round()});this.perspectiveTransform=(t=this.width,r=this.height,n=d.x,h=d.y,i=p.x,o=p.y,a=g.x,s=g.y,l=m.x,u=m.y,c=Qe(0,0,t,0,0,r,t,r),n=Qe(n,h,i,o,a,s,l,u),se.multiply$1(n,se.adjoint(c,c),n),[n[6]/n[8]*t/se.EXTENT,n[7]/n[8]*r/se.EXTENT]);var t,r,n,i,o,a,s,l,u,c,h=this._boundsArray=new se.StructArrayLayout4i8;h.emplaceBack(d.x,d.y,0,0),h.emplaceBack(p.x,p.y,se.EXTENT,0),h.emplaceBack(g.x,g.y,0,se.EXTENT),h.emplaceBack(m.x,m.y,se.EXTENT,se.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=e.createVertexBuffer(h,se.boundsAttributes.members),this.boundsSegments=se.SegmentVector.simpleSegment(0,0,4,2)}}prepare(){var e,t;0!==Object.keys(this.tiles).length&&this.image&&(t=(e=this.map.painter.context).gl,this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new se.Texture(e,this.image,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(e))}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e).buckets={}:e.state="errored",t(null)}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}function et(e,t,r,n){if((t=new tt[t.type](e,t,r,n)).id!==e)throw new Error(`Expected Source id to be ${e} instead of `+t.id);return se.bindAll(["load","abort","unload","serialize","prepare"],t),t}const tt={vector:Je,raster:a,"raster-dem":class extends a{constructor(e,t,r,n){super(e,t,r,n),this.type="raster-dem",this.maxzoom=22,this._options=se.extend({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(i,o){var e=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function a(e,t){e&&(i.state="errored",o(e)),t&&(i.dem=t,i.dem.onDeserialize(),i.needsHillshadePrepare=!0,i.needsDEMTextureUpload=!0,i.state="loaded",o(null))}i.request=se.getImage(this.map._requestManager.transformRequest(e,se.ResourceType.Tile),function(e,t,r,n){if(delete i.request,i.aborted)i.state="unloaded",o(null);else if(e)i.state="errored",o(e);else if(t){this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:r,expires:n});const o=se.window.ImageBitmap&&t instanceof se.window.ImageBitmap&&(Ke=null==Ke?se.window.OffscreenCanvas&&new se.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof se.window.createImageBitmap:Ke),e=1-(t.width-se.prevPowerOfTwo(t.width))/2;e<1||i.neighboringTiles||(i.neighboringTiles=this._getNeighboringTiles(i.tileID));r=o?t:se.exported.getImageData(t,e),n={uid:i.uid,coord:i.tileID,source:this.id,rawImageData:r,encoding:this.encoding,padding:e};i.actor&&"expired"!==i.state||(i.actor=this.dispatcher.getActor(),i.actor.send("loadDEMTile",n,a.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(e){var t=e.canonical,r=Math.pow(2,t.z),n=(t.x-1+r)%r,i=0===t.x?e.wrap-1:e.wrap,o=(t.x+1+r)%r,a=t.x+1===r?e.wrap+1:e.wrap,s={};return s[new se.OverscaledTileID(e.overscaledZ,i,t.z,n,t.y).key]={backfilled:!1},s[new se.OverscaledTileID(e.overscaledZ,a,t.z,o,t.y).key]={backfilled:!1},0<t.y&&(s[new se.OverscaledTileID(e.overscaledZ,i,t.z,n,t.y-1).key]={backfilled:!1},s[new se.OverscaledTileID(e.overscaledZ,e.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},s[new se.OverscaledTileID(e.overscaledZ,a,t.z,o,t.y-1).key]={backfilled:!1}),t.y+1<r&&(s[new se.OverscaledTileID(e.overscaledZ,i,t.z,n,t.y+1).key]={backfilled:!1},s[new se.OverscaledTileID(e.overscaledZ,e.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},s[new se.OverscaledTileID(e.overscaledZ,a,t.z,o,t.y+1).key]={backfilled:!1}),s}unloadTile(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded"}},geojson:class extends se.Evented{constructor(e,t,r,n){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(n),this._data=t.data,this._options=se.extend({},t),this._collectResourceTiming=t.collectResourceTiming,void 0!==t.maxzoom&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;e=se.EXTENT/this.tileSize;this.workerOptions=se.extend({source:this.id,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(void 0!==t.buffer?t.buffer:128)*e,tolerance:(void 0!==t.tolerance?t.tolerance:.375)*e,extent:se.EXTENT,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:void 0!==t.clusterMaxZoom?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:se.EXTENT,radius:(void 0!==t.clusterRadius?t.clusterRadius:50)*e,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id},t),this}getClusterLeaves(e,t,r,n){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:t,offset:r},n),this}_updateWorkerData(){var e,t;this._pendingLoad?this._coalesce=!0:(this.fire(new se.Event("dataloading",{dataType:"source"})),this._loaded=!1,e=se.extend({},this.workerOptions),"string"==typeof(t=this._data)?(e.request=this.map._requestManager.transformRequest(se.exported.resolveURL(t),se.ResourceType.Source),e.request.collectResourceTiming=this._collectResourceTiming):e.data=JSON.stringify(t),this._pendingLoad=this.actor.send(this.type+".loadData",e,(e,t)=>{if(this._loaded=!0,this._pendingLoad=null,e)this.fire(new se.ErrorEvent(e));else{const e={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&t&&t.resourceTiming&&t.resourceTiming[this.id]&&(e.resourceTiming=t.resourceTiming[this.id]),this.fire(new se.Event("data",e)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(r,n){const i=r.actor?"reloadTile":"loadTile";r.actor=this.actor,r.request=this.actor.send(i,{type:this.type,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:se.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(e,t)=>(delete r.request,r.unloadVectorData(),r.aborted?n(null):e?n(e):(r.loadVectorData(t,this.map.painter,"reloadTile"==i),n(null))),void 0,"loadTile"==i)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return se.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends E{constructor(e,t,r,n){super(e,t,r,n),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;var e=this.options;this.urls=[];for(const t of e.urls)this.urls.push(this.map._requestManager.transformRequest(t,se.ResourceType.Source).url);se.getVideo(this.urls,(e,t)=>{this._loaded=!0,e?this.fire(new se.ErrorEvent(e)):t&&(this.video=t,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){var t;this.video&&(e<(t=this.video.seekable).start(0)||e>t.end(0)?this.fire(new se.ErrorEvent(new se.ValidationError("sources."+this.id,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=e)}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){var e,t;0===Object.keys(this.tiles).length||this.video.readyState<2||(t=(e=this.map.painter.context).gl,this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new se.Texture(e,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(e))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:E,canvas:class extends E{constructor(e,t,r,n){super(e,t,r,n),t.coordinates?Array.isArray(t.coordinates)&&4===t.coordinates.length&&!t.coordinates.some(e=>!Array.isArray(e)||2!==e.length||e.some(e=>"number"!=typeof e))||this.fire(new se.ErrorEvent(new se.ValidationError("sources."+e,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new se.ErrorEvent(new se.ValidationError("sources."+e,null,'missing required property "coordinates"'))),t.animate&&"boolean"!=typeof t.animate&&this.fire(new se.ErrorEvent(new se.ValidationError("sources."+e,null,'optional "animate" property must be a boolean value'))),t.canvas?"string"==typeof t.canvas||t.canvas instanceof se.window.HTMLCanvasElement||this.fire(new se.ErrorEvent(new se.ValidationError("sources."+e,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new se.ErrorEvent(new se.ValidationError("sources."+e,null,'missing required property "canvas"'))),this.options=t,this.animate=void 0===t.animate||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof se.window.HTMLCanvasElement?this.options.canvas:se.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new se.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;var t;this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||0!==Object.keys(this.tiles).length&&(t=this.map.painter.context,this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new se.Texture(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends se.Evented{constructor(e,t,r,n){super(),this.id=e,this.type="custom",this._dataType="raster",this._dispatcher=r,this._implementation=t,this.setEventedParent(n),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new se.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new se.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ce(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),se.extend(this,se.pick(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return se.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new se.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new se.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(e){this._map=e,this._loaded=!1,this.fire(new se.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(e),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){var t,r,n;return this._implementation.hasTile?({x:t,y:r,z:n}=e.canonical,this._implementation.hasTile({x:t,y:r,z:n})):!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(r,n){const{x:e,y:t,z:i}=r.tileID.canonical,o=new se.window.AbortController;r.request=Promise.resolve(this._implementation.loadTile({x:e,y:t,z:i},{signal:o.signal})).then(function(e){return delete r.request,r.aborted?(r.state="unloaded",n(null)):void 0===e?(r.state="errored",n(null)):null===e?(this.loadTileData(r,{width:this.tileSize,height:this.tileSize,data:null}),r.state="loaded",n(null)):(t=e)instanceof se.window.ImageData||t instanceof se.window.HTMLCanvasElement||t instanceof se.window.ImageBitmap||t instanceof se.window.HTMLImageElement?(this.loadTileData(r,e),r.state="loaded",void n(null)):(r.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var t}.bind(this)).catch(e=>{20!==e.code&&(r.state="errored",n(e))}),r.request.cancel=()=>o.abort()}loadTileData(e,t){a.loadTileData(e,t,this._map.painter)}unloadTileData(e){a.unloadTileData(e,this._map.painter)}unloadTile(e,t){if(this.unloadTileData(e),this._implementation.unloadTile){const{x:t,y:r,z:n}=e.tileID.canonical;this._implementation.unloadTile({x:t,y:r,z:n})}t()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new se.Event("data",{dataType:"source",sourceDataType:"content"}))}}};function rt(r,e,t,n,i,o,a,s=!1){var l,u,c,a=r.tilesIn(n,a,s),h=(a.sort(it),[]);for(const n of a)h.push({wrappedTileID:n.tile.tileID.wrapped().key,queryResults:n.tile.queryRenderedFeatures(e,t,r._state,n,i,o,(l=r.transform,u=n.tile.tileID,c=void 0,c=se.identity([]),se.scale(c,c,[.5*l.width,.5*-l.height,1]),se.translate(c,c,[1,-1,0]),se.multiply(c,c,l.calculateProjMatrix(u.toUnwrapped())),Float32Array.from(c)),s)});var f=function(e){const t={},r={};for(const a of e){const e=a.queryResults,s=a.wrappedTileID,l=r[s]=r[s]||{};for(const r in e){var n=e[r],i=l[r]=l[r]||{},o=t[r]=t[r]||[];for(const e of n)i[e.featureIndex]||(i[e.featureIndex]=!0,o.push(e))}}return t}(h);for(const e in f)f[e].forEach(e=>{var e=e.feature,t=e.layer;t&&"background"!==t.type&&"sky"!==t.type&&(e.source=t.source,t["source-layer"]&&(e.sourceLayer=t["source-layer"]),e.state=void 0!==e.id?r.getFeatureState(t["source-layer"],e.id):{})});return f}function nt(t,r){var n=t.getRenderableIds().map(e=>t.getTileByID(e)),i=[],o={};for(let e=0;e<n.length;e++){var a=n[e],s=a.tileID.canonical.key;o[s]||(o[s]=!0,a.querySourceFeatures(i,r))}return i}function it(e,t){e=e.tileID,t=t.tileID;return e.overscaledZ-t.overscaledZ||e.canonical.y-t.canonical.y||e.wrap-t.wrap||e.canonical.x-t.canonical.x}function ot(){return null!=Hi.workerClass?new Hi.workerClass:new se.window.Worker(Hi.workerUrl)}const at="mapboxgl_preloaded_worker_pool";class n{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<n.workerCount;)this.workers.push(new ot);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],0===this.numActive()&&(this.workers.forEach(e=>{e.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[at]}numActive(){return Object.keys(this.active).length}}let s;function c(){return s=s||new n}function st(t){t=t.slice();var r=Object.create(null);for(let e=0;e<t.length;e++)r[t[e].id]=t[e];for(let e=0;e<t.length;e++)"ref"in t[e]&&(t[e]=function(e,t){const r={};for(const se in e)"ref"!==se&&(r[se]=e[se]);return se.refProperties.forEach(e=>{e in t&&(r[e]=t[e])}),r}(t[e],r[t[e].ref]));return t}n.workerCount=2;const b={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function lt(e,t,r){r.push({command:b.addSource,args:[e,t[e]]})}function ut(e,t,r){t.push({command:b.removeSource,args:[e]}),r[e]=!0}function ct(e,t,r,n){ut(e,r,n),lt(e,t,r)}function ht(e,t,r){let n;for(n in e[r])if(e[r].hasOwnProperty(n)&&"data"!==n&&!x(e[r][n],t[r][n]))return;for(n in t[r])if(t[r].hasOwnProperty(n)&&"data"!==n&&!x(e[r][n],t[r][n]))return;return 1}function w(e,t,r,n,i,o){let a;for(a in t=t||{},e=e||{})!e.hasOwnProperty(a)||x(e[a],t[a])||r.push({command:o,args:[n,a,t[a],i]});for(a in t)!t.hasOwnProperty(a)||e.hasOwnProperty(a)||x(e[a],t[a])||r.push({command:o,args:[n,a,t[a],i]})}function ft(e){return e.id}function dt(e,t){return e[t.id]=t,e}class pt{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let e=1;e<this.points.length;e++)this._distances[e]=this._distances[e-1]+this.points[e].dist(this.points[e-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=se.clamp(e,0,1);let t=1,r=this._distances[t];for(var n=e*this.paddedLength+this.padding;r<n&&t<this._distances.length;)r=this._distances[++t];var e=t-1,i=this._distances[e],o=r-i,i=0<o?(n-i)/o:0;return this.points[e].mult(1-i).add(this.points[t].mult(i))}}class mt{constructor(e,t,r){var n=this.boxCells=[],i=this.circleCells=[];this.xCellCount=Math.ceil(e/r),this.yCellCount=Math.ceil(t/r);for(let e=0;e<this.xCellCount*this.yCellCount;e++)n.push([]),i.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,r,n,i){this._forEachCell(t,r,n,i,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)}insertCircle(e,t,r,n){this._forEachCell(t-n,r-n,t+n,r+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(r),this.circles.push(n)}_insertBoxCell(e,t,r,n,i,o){this.boxCells[i].push(o)}_insertCircleCell(e,t,r,n,i,o){this.circleCells[i].push(o)}_query(e,t,r,n,i,o){if(r<0||e>this.width||n<0||t>this.height)return!i&&[];var a=[];if(e<=0&&t<=0&&this.width<=r&&this.height<=n){if(i)return!0;for(let e=0;e<this.boxKeys.length;e++)a.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],r=this.circles[3*e+1],n=this.circles[3*e+2];a.push({key:this.circleKeys[e],x1:t-n,y1:r-n,x2:t+n,y2:r+n})}return o?a.filter(o):a}return this._forEachCell(e,t,r,n,this._queryCell,a,{hitTest:i,seenUids:{box:{},circle:{}}},o),i?0<a.length:a}_queryCircle(e,t,r,n,i){var o=e-r,a=e+r,s=t-r,l=t+r;return a<0||o>this.width||l<0||s>this.height?!n&&[]:(this._forEachCell(o,s,a,l,this._queryCellCircle,o=[],{hitTest:n,circle:{x:e,y:t,radius:r},seenUids:{box:{},circle:{}}},i),n?0<o.length:o)}query(e,t,r,n,i){return this._query(e,t,r,n,!1,i)}hitTest(e,t,r,n,i){return this._query(e,t,r,n,!0,i)}hitTestCircle(e,t,r,n){return this._queryCircle(e,t,r,!0,n)}_queryCell(e,t,r,n,i,o,a,s){const l=a.seenUids,u=this.boxCells[i];if(null!==u){const i=this.bboxes;for(const c of u)if(!l.box[c]){l.box[c]=!0;const u=4*c;if(e<=i[2+u]&&t<=i[3+u]&&r>=i[0+u]&&n>=i[1+u]&&(!s||s(this.boxKeys[c]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[c],x1:i[u],y1:i[1+u],x2:i[2+u],y2:i[3+u]})}}}const c=this.circleCells[i];if(null!==c){const i=this.circles;for(const u of c)if(!l.circle[u]){l.circle[u]=!0;const c=3*u;if(this._circleAndRectCollide(i[c],i[1+c],i[2+c],e,t,r,n)&&(!s||s(this.circleKeys[u]))){if(a.hitTest)return o.push(!0),!0;{const e=i[c],t=i[1+c],r=i[2+c];o.push({key:this.circleKeys[u],x1:e-r,y1:t-r,x2:e+r,y2:t+r})}}}}}_queryCellCircle(e,t,r,n,i,o,a,s){var l=a.circle,u=a.seenUids,a=this.boxCells[i];if(null!==a){const e=this.bboxes;for(const t of a)if(!u.box[t]){u.box[t]=!0;const r=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[0+r],e[1+r],e[2+r],e[3+r])&&(!s||s(this.boxKeys[t])))return o.push(!0),!0}}a=this.circleCells[i];if(null!==a){const e=this.circles;for(const t of a)if(!u.circle[t]){u.circle[t]=!0;const r=3*t;if(this._circlesCollide(e[r],e[1+r],e[2+r],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[t])))return o.push(!0),!0}}}_forEachCell(r,n,i,o,a,s,l,u){var e=this._convertToXCellCoord(r),c=this._convertToYCellCoord(n),h=this._convertToXCellCoord(i),f=this._convertToYCellCoord(o);for(let t=e;t<=h;t++)for(let e=c;e<=f;e++)if(a.call(this,r,n,i,o,this.xCellCount*e+t,s,l,u))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,r,n,i,o){n-=e,e=i-t,i=r+o;return n*n+e*e<i*i}_circleAndRectCollide(e,t,r,n,i,o,a){o=(o-n)/2,e=Math.abs(e-(n+o));return!(o+r<e)&&(!((n=(a-i)/2)+r<(a=Math.abs(t-(i+n))))&&(e<=o||a<=n||(t=e-o)*t+(i=a-n)*i<=r*r))}}const gt=Math.tan(85*Math.PI/180);function le(e,t,r,n,i,o,a){var s=se.create();if(r)if("globe"===o.name){const e=se.calculateGlobeLabelMatrix(i,t);se.multiply(s,s,e)}else{const e=W([],a);s[0]=e[0],s[1]=e[1],s[4]=e[2],s[5]=e[3],n||se.rotateZ(s,s,i.angle)}else se.multiply(s,i.labelPlaneMatrix,e);return s}function yt(e,t,r,n,i,o,a){e=le(e,t,r,n,i,o,a);return"globe"===o.name&&r||(e[2]=e[6]=e[10]=e[14]=0),e}function vt(e,t,r,n,i,o,a){if(r){if("globe"===o.name)return t=le(e,t,r,n,i,o,a),se.invert(t,t),se.multiply(t,e,t),t;{const t=se.clone(e),r=se.identity([]);return r[0]=a[0],r[1]=a[1],r[4]=a[2],r[5]=a[3],se.multiply(t,t,r),n||se.rotateZ(t,t,-i.angle),t}}return i.glCoordMatrix}function O(e,t,r,n){e=[e,t,r,1],r?se.transformMat4$1(e,e,n):Mt(e,e,n),t=e[3];return e[0]/=t,e[1]/=t,e[2]/=t,e}function _t(e,t){return Math.min(.5+e/t*.5,1.5)}function xt(n,i,o,e,a,s,l,u,c,h){const f=o.transform,d=e?n.textSizeData:n.iconSizeData,p=se.evaluateSizeForZoom(d,o.transform.zoom),m="globe"===f.projection.name,g=[256/o.width*2+1,256/o.height*2+1],y=(e?n.text:n.icon).dynamicLayoutVertexArray;y.clear();let v=null;m&&(v=(e?n.text:n.icon).globeExtVertexArray);var _=n.lineVertexArray,t=(e?n.text:n.icon).placedSymbolArray,x=o.transform.width/o.transform.height;let r,b=!1;for(let e=0;e<t.length;e++){const m=t.get(e),{numGlyphs:k,writingMode:C}=m;if(C!==se.WritingMode.vertical||b||r===se.WritingMode.horizontal||(b=!0),r=C,!m.hidden&&C!==se.WritingMode.vertical||b){b=!1;var w=new se.pointGeometry(m.tileAnchorX,m.tileAnchorY);let{x:e,y:t,z:r}=f.projection.projectTilePoint(w.x,w.y,h.canonical);if(c){const[se,n,i]=c(w);e+=se,t+=n,r+=i}var E=[e,t,r,1];if(se.transformMat4$1(E,E,i),M=g,T=void 0,T=(S=E)[0]/S[3],S=S[1]/S[3],T>=-M[0]&&T<=M[0]&&S>=-M[1]&&S<=M[1]){var T=_t(o.transform.cameraToCenterDistance,E[3]),S=se.evaluateSizeForFeature(d,p,m),M=l?S/T:S*T,E=O(e,t,r,a);if(E[3]<=0)L(k,y);else{let e={};var S=l?null:c,T=Et(m,M,!1,u,i,a,s,n.glyphOffsetArray,_,y,v,E,w,e,x,S,f.projection,h,l);b=T.useVertical,S&&T.needsFlipping&&(e={}),(T.notEnoughRoom||b||T.needsFlipping&&Et(m,M,!0,u,i,a,s,n.glyphOffsetArray,_,y,v,E,w,e,x,S,f.projection,h,l).notEnoughRoom)&&L(k,y)}}else L(k,y)}else L(k,y)}e?(n.text.dynamicLayoutVertexBuffer.updateData(y),v&&n.text.globeExtVertexBuffer.updateData(v)):(n.icon.dynamicLayoutVertexBuffer.updateData(y),v&&n.icon.globeExtVertexBuffer.updateData(v))}function bt(e,t,r,n,i,o,a,s,l,u,c,h,f,d,p,m){var{lineStartIndex:g,glyphStartIndex:y,segment:v}=s,_=y+s.numGlyphs,s=g+s.lineLength,y=t.getoffsetX(y),t=t.getoffsetX(_-1),_=R(e*y,r,n,i,o,a,v,g,s,l,u,c,h,f,!0,d,p,m);return _&&(y=R(e*t,r,n,i,o,a,v,g,s,l,u,c,h,f,!0,d,p,m))?{first:_,last:y}:null}function wt(e,t,r,n){return e===se.WritingMode.horizontal&&Math.abs(n)>Math.abs(r)?{useVertical:!0}:e===se.WritingMode.vertical?0<n?{needsFlipping:!0}:null:0!==t&&(0===r||Math.abs(n/r)>gt)?1===t?{needsFlipping:!0}:null:r<0?{needsFlipping:!0}:null}function Et(t,e,r,n,i,o,a,s,l,u,c,h,f,d,p,m,g,y,v){var _=e/24,x=t.lineOffsetX*_,b=t.lineOffsetY*_,{lineStartIndex:w,glyphStartIndex:E,numGlyphs:T,segment:S,writingMode:M,flipState:k}=t,C=w+t.lineLength,A=e=>{if(c){const[t,r,n]=e.up,i=u.length;se.updateGlobeVertexNormal(c,i+0,t,r,n),se.updateGlobeVertexNormal(c,i+1,t,r,n),se.updateGlobeVertexNormal(c,i+2,t,r,n),se.updateGlobeVertexNormal(c,i+3,t,r,n)}const[t,r,n]=e.point;se.addDynamicAttributes(u,t,r,n,e.angle)};if(1<T){const se=bt(_,s,x,b,r,h,f,t,l,o,d,m,!1,g,y,v);if(!se)return{notEnoughRoom:!0};if(n&&!r){var[e,I,L]=se.first.point,[P,z,D]=se.last.point;[e,I]=O(e,I,L,a),[P,z]=O(P,z,D,a);const l=wt(M,k,(P-e)*p,z-I);if(t.flipState=l&&l.needsFlipping?1:2,l)return l}A(se.first);for(let e=E+1;e<E+T-1;e++){const t=R(_*s.getoffsetX(e),x,b,r,h,f,S,w,C,l,o,d,m,!1,!1,g,y,v);if(!t)return u.length-=4*(e-E),{notEnoughRoom:!0};A(t)}A(se.last)}else{if(n&&!r){const e=O(f.x,f.y,0,i),r=w+S+1,n=new se.pointGeometry(l.getx(r),l.gety(r)),o=O(n.x,n.y,0,i),a=0<o[3]?o:St(f,n,e,1,i,void 0,g,y.canonical),s=wt(M,k,(a[0]-e[0])*p,a[1]-e[1]);if(t.flipState=s&&s.needsFlipping?1:2,s)return s}const e=R(_*s.getoffsetX(E),x,b,r,h,f,S,w,C,l,o,d,m,!1,!1,g,y,v);if(!e)return{notEnoughRoom:!0};A(e)}return{}}function Tt(e,t,r,n,i){var o,{x:n,y:t,z:a}=n.projectTilePoint(e.x,e.y,t);return i?([i,e,o]=i(e),O(n+i,t+e,a+o,r)):O(n,t,a,r)}function St(e,t,r,n,i,o,a,s){t=Tt(e.sub(t)._unit()._add(e),s,i,a,o);return se.sub(t,r,t),se.normalize(t,t),se.scaleAndAdd(t,r,t,n)}function R(e,t,r,n,i,o,a,s,l,u,c,h,f,d,p,m,g,y){e=n?e-t:e+t;let v=0<e?1:-1,_=0,x=(n&&(v*=-1,_=Math.PI),v<0&&(_+=Math.PI),s+a+(0<v?0:1)|0),b=i,w=i,E=0,T=0;const S=Math.abs(e),M=[],k=[];let C=o,A=C;for(var I=()=>St(A,C,w,S-E+1,c,f,m,g.canonical);E+T<=S;){if((x+=v)<s||x>=l)return null;if(w=b,A=C,M.push(w),d&&k.push(A),C=new se.pointGeometry(u.getx(x),u.gety(x)),!(b=h[x])){const se=Tt(C,g.canonical,c,m,f);b=0<se[3]?h[x]=se:I()}E+=T,T=se.distance(w,b)}p&&f&&(h[x]&&(b=I(),T=se.distance(w,b)),h[x]=b);t=(S-E)/T,n=C.sub(A)._mult(t)._add(A),a=se.sub([],b,w),i=se.scaleAndAdd([],w,a,t);let L=[0,0,1],P=a[0],z=a[1];if(y&&(0!==(L=m.upVector(g.canonical,n.x,n.y))[0]||0!==L[1]||1!==L[2])){const e=[L[2],0,-L[0]],t=se.cross([],L,e);se.normalize(e,e),se.normalize(t,t),P=se.dot(a,e),z=se.dot(a,t)}if(r){const e=se.cross([],L,a);se.normalize(e,e),se.scaleAndAdd(i,i,e,r*v)}e=_+Math.atan2(z,P);return M.push(i),d&&k.push(n),{point:i,angle:e,path:M,tilePath:k,up:L}}function L(e,t){var r=t.length,e=r+4*e;t.resize(e),t.float32.fill(-1/0,4*r,4*e)}function Mt(e,t,r){var n=t[0],t=t[1];e[0]=r[0]*n+r[4]*t+r[12],e[1]=r[1]*n+r[5]*t+r[13],e[3]=r[3]*n+r[7]*t+r[15]}class kt{constructor(e,t,r=new mt(e.width+200,e.height+200,25),n=new mt(e.width+200,e.height+200,25)){this.transform=e,this.grid=r,this.ignoredGrid=n,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+100,this.screenBottomBoundary=e.height+100,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t}placeCollisionBox(e,t,r,n,i,o,a,s){let l=r.projectedAnchorX,u=r.projectedAnchorY,c=r.projectedAnchorZ;var h=r.elevation,f=r.tileID,d=e.getProjection();if(h&&f){const[e,t,n]=d.upVector(f.canonical,r.tileAnchorX,r.tileAnchorY),i=d.upVectorScale(f.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;l+=e*h*i,u+=t*h*i,c+=n*h*i}e=this.projectAndGetPerspectiveRatio(a,l,u,c,r.tileID,"globe"===d.name||!!h||0<this.transform.pitch,d),f=o*e.perspectiveRatio,a=(r.x1*t+n.x-r.padding)*f+e.point.x,h=(r.y1*t+n.y-r.padding)*f+e.point.y,d=(r.x2*t+n.x+r.padding)*f+e.point.x,o=(r.y2*t+n.y+r.padding)*f+e.point.y,t=e.perspectiveRatio<=.55||e.occluded;return!this.isInsideGrid(a,h,d,o)||!i&&this.grid.hitTest(a,h,d,o,s)||t?{box:[],offscreen:!1,occluded:e.occluded}:{box:[a,h,d,o],offscreen:this.isOffscreen(a,h,d,o),occluded:!1}}placeCollisionCircles(t,r,a,s,n,l,u,c,h,f,d,p,m,g,e){const y=[],i=this.transform.elevation,o=t.getProjection(),v=i?i.getAtTileOffsetFunc(e,this.transform.center.lat,this.transform.worldSize,o):null,_=new se.pointGeometry(a.tileAnchorX,a.tileAnchorY);let{x,y:b,z:w}=o.projectTilePoint(_.x,_.y,e.canonical);if(v){const[se,t,r]=v(_);x+=se,b+=t,w+=r}const E="globe"===o.name,T=this.projectAndGetPerspectiveRatio(u,x,b,w,e,E||!!i||0<this.transform.pitch,o),S=T["perspectiveRatio"],M=(d?l/S:l*S)/se.ONE_EM,k=O(x,b,w,c),C=0<T.signedDistanceFromCamera?bt(M,n,a.lineOffsetX*M,a.lineOffsetY*M,!1,k,_,a,s,c,{},i&&!d?v:null,d&&!!i,o,e,d):null;let A=!1,I=!1,L=!0;if(C&&!T.occluded){const t=.5*m*S+g,a=new se.pointGeometry(-100,-100),s=new se.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),n=new pt,{first:l,last:u}=C,c=l.path.length;let i=[];for(let e=c-1;1<=e;e--)i.push(l.path[e]);for(let e=1;e<u.path.length;e++)i.push(u.path[e]);const e=2.5*t;h&&((i=i.map(([e,t,r],n)=>O(e,t,r=v&&!E?v(n<c-1?l.tilePath[c-1-n]:u.tilePath[n-c+2])[2]:r,h))).some(e=>e[3]<=0)&&(i=[]));let o=[];if(0<i.length){let e=1/0,t=-1/0,r=1/0,n=-1/0;for(const se of i)e=Math.min(e,se[0]),r=Math.min(r,se[1]),t=Math.max(t,se[0]),n=Math.max(n,se[1]);t>=a.x&&e<=s.x&&n>=a.y&&r<=s.y&&(o=[i.map(e=>new se.pointGeometry(e[0],e[1]))],(e<a.x||t>s.x||r<a.y||n>s.y)&&(o=se.clipLine(o,a.x,a.y,s.x,s.y)))}for(const se of o){n.reset(se,.25*t);var P=n.length<=.5*t?1:Math.ceil(n.paddedLength/e)+1;for(let e=0;e<P;e++){const s=e/Math.max(P-1,1),l=n.lerp(s),u=l.x+100,c=l.y+100,h=(y.push(u,c,t,0),u-t),d=c-t,m=u+t,g=c+t;if(L=L&&this.isOffscreen(h,d,m,g),I=I||this.isInsideGrid(h,d,m,g),!r&&this.grid.hitTestCircle(u,c,t,p)&&(A=!0,!f))return{circles:[],offscreen:!1,collisionDetected:A,occluded:!1}}}}return{circles:!f&&A||!I?[]:y,offscreen:L,collisionDetected:A,occluded:T.occluded}}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};var t=[];let r=1/0,n=1/0,i=-1/0,o=-1/0;for(const a of e){const e=new se.pointGeometry(a.x+100,a.y+100);r=Math.min(r,e.x),n=Math.min(n,e.y),i=Math.max(i,e.x),o=Math.max(o,e.y),t.push(e)}const a=this.grid.query(r,n,i,o).concat(this.ignoredGrid.query(r,n,i,o)),s={},l={};for(const e of a){const r=e.key;if(void 0===s[r.bucketInstanceId]&&(s[r.bucketInstanceId]={}),!s[r.bucketInstanceId][r.featureIndex]){const n=[new se.pointGeometry(e.x1,e.y1),new se.pointGeometry(e.x2,e.y1),new se.pointGeometry(e.x2,e.y2),new se.pointGeometry(e.x1,e.y2)];se.polygonIntersectsPolygon(t,n)&&(s[r.bucketInstanceId][r.featureIndex]=!0,void 0===l[r.bucketInstanceId]&&(l[r.bucketInstanceId]=[]),l[r.bucketInstanceId].push(r.featureIndex))}}return l}insertCollisionBox(e,t,r,n,i){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:n,collisionGroupID:i},e[0],e[1],e[2],e[3])}insertCollisionCircles(t,e,r,n,i){var o=e?this.ignoredGrid:this.grid,a={bucketInstanceId:r,featureIndex:n,collisionGroupID:i};for(let e=0;e<t.length;e+=4)o.insertCircle(a,t[e],t[e+1],t[e+2])}projectAndGetPerspectiveRatio(e,t,r,n,i,o,a){var s=[t,r,n,1];let l=!1;if(n||0<this.transform.pitch){se.transformMat4$1(s,s,e);const o="globe"===a.name;if(this.fogState&&i&&!o){const e=function(e,t,r,n,i,o){i=o.calculateFogTileMatrix(i),t=[t,r,n];return se.transformMat4(t,t,i),Q(e,t,o.pitch,o._fov)}(this.fogState,t,r,n,i.toUnwrapped(),this.transform);l=.9<e}}else Mt(s,s,e);t=s[3];return{point:new se.pointGeometry((s[0]/t+1)/2*this.transform.width+100,(-s[1]/t+1)/2*this.transform.height+100),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(a)/t*.5,1.5),signedDistanceFromCamera:t,occluded:o&&t<s[2]||l}}isOffscreen(e,t,r,n){return r<100||e>=this.screenRightBoundary||n<100||t>this.screenBottomBoundary}isInsideGrid(e,t,r,n){return 0<=r&&e<this.gridRightBoundary&&0<=n&&t<this.gridBottomBoundary}getViewportMatrix(){var e=se.identity([]);return se.translate(e,e,[-100,-100,0]),e}}function Ct(e,t,r){t=t.createTileMatrix(e,e.worldSize,r.toUnwrapped());return se.multiply(new Float32Array(16),e.projMatrix,t)}function At(e,t,r){return t.name===r.projection.name?e.projMatrix:Ct(r,t,e)}class It{constructor(e,t,r,n){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):n&&r?1:0,this.placed=r}isHidden(){return 0===this.opacity&&!this.placed}}class T{constructor(e,t,r,n,i,o=!1){this.text=new It(e?e.text:null,t,r,i),this.icon=new It(e?e.icon:null,t,n,i),this.clipped=o}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Lt{constructor(e,t,r,n=!1){this.text=e,this.icon=t,this.skipFade=r,this.clipped=n}}class Pt{constructor(){this.invProjMatrix=se.create(),this.viewportMatrix=se.create(),this.circles=[]}}class zt{constructor(e,t,r,n,i){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=r,this.bucketIndex=n,this.tileID=i}}class Dt{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function Ot(e,t,r,n,i){var{horizontalAlign:o,verticalAlign:a}=se.getAnchorAlignment(e),o=-(o-.5)*t,t=-(a-.5)*r,a=se.evaluateVariableOffset(e,n);return new se.pointGeometry(o+a[0]*i,t+a[1]*i)}function Rt(e,t,r,n,i){e=new se.pointGeometry(e,t);return r&&e._rotate(n?i:-i),e}class Ft{constructor(e,t,r,n,i){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new kt(this.transform,i),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new Dt(r),this.collisionCircleArrays={},(this.prevPlacement=n)&&(n.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,n,i,o){var a=i.getBucket(n),s=i.latestFeatureIndex;if(a&&s&&n.id===a.layerIds[0]){var l=a.layers[0].layout,u=i.collisionBoxArray,c=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),h=i.tileSize/se.EXTENT,f=i.tileID.toUnwrapped(),d=(this.transform.setProjection(a.projection),m=i.tileID,p=a.getProjection(),d=this.transform,p.name===this.projection?d.calculateProjMatrix(m.toUnwrapped()):Ct(d,p,m)),p="map"===l.get("text-pitch-alignment"),m="map"===l.get("text-rotation-alignment"),g=(n.compileFilter(),n.dynamicFilter()),n=n.dynamicFilterNeedsFeature(),y=this.transform.calculatePixelsToTileUnitsMatrix(i),v=yt(d,i.tileID.canonical,p,m,this.transform,a.getProjection(),y);let e=null;if(p){const r=vt(d,i.tileID.canonical,p,m,this.transform,a.getProjection(),y);e=se.multiply([],this.transform.labelPlaneMatrix,r)}let t=null;g&&i.latestFeatureIndex&&(t={unwrappedTileID:f,dynamicFilter:g,dynamicFilterNeedsFeature:n,featureIndex:i.latestFeatureIndex}),this.retainedQueryData[a.bucketInstanceId]=new zt(a.bucketInstanceId,s,a.sourceLayerIndex,a.index,i.tileID);var _={bucket:a,layout:l,posMatrix:d,textLabelPlaneMatrix:v,labelToScreenMatrix:e,clippingData:t,scale:c,textPixelRatio:h,holdingForFade:i.holdingForFade(),collisionBoxArray:u,partiallyEvaluatedTextSize:se.evaluateSizeForZoom(a.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:se.evaluateSizeForZoom(a.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(a.sourceID)};if(o)for(const se of a.sortKeyRanges){const{sortKey:n,symbolInstanceStart:i,symbolInstanceEnd:o}=se;r.push({sortKey:n,symbolInstanceStart:i,symbolInstanceEnd:o,parameters:_})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:a.symbolInstances.length,parameters:_})}}attemptAnchorPlacement(t,r,n,i,o,e,a,s,l,u,c,h,f,d,p,m,g,y){var{textOffset0:v,textOffset1:_,crossTileID:x}=h,v=[v,_],_=Ot(t,n,i,v,o),r=this.collisionIndex.placeCollisionBox(d,o,r,Rt(_.x,_.y,e,a,this.transform.angle),c,s,l,u.predicate);if(m){const t=d.getSymbolInstanceIconSize(y,this.transform.zoom,h.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(d,t,m,Rt(_.x,_.y,e,a,this.transform.angle),c,s,l,u.predicate).box.length)return}if(0<r.box.length){let e;return this.prevPlacement&&this.prevPlacement.variableOffsets[x]&&this.prevPlacement.placements[x]&&this.prevPlacement.placements[x].text&&(e=this.prevPlacement.variableOffsets[x].anchor),this.variableOffsets[x]={textOffset:v,width:n,height:i,anchor:t,textScale:o,prevAnchor:e},this.markUsedJustification(d,t,h,p),d.allowVerticalPlacement&&(this.markUsedOrientation(d,p,h),this.placedOrientations[x]=p),{shift:_,placedGlyphBoxes:r}}}placeLayerBucketPart(t,E,T,e){const{bucket:S,layout:M,posMatrix:k,textLabelPlaneMatrix:C,labelToScreenMatrix:A,clippingData:I,textPixelRatio:L,holdingForFade:r,collisionBoxArray:n,partiallyEvaluatedTextSize:P,partiallyEvaluatedIconSize:z,collisionGroup:D}=t.parameters,O=M.get("text-optional"),R=M.get("icon-optional"),F=M.get("text-allow-overlap"),B=M.get("icon-allow-overlap"),N="map"===M.get("text-rotation-alignment"),j="map"===M.get("text-pitch-alignment"),U="none"!==M.get("icon-text-fit"),i="viewport-y"===M.get("symbol-z-order");this.transform.setProjection(S.projection);let V=F&&(B||!S.hasIconData()||R),G=B&&(F||!S.hasTextData()||O);!S.collisionArrays&&n&&S.deserializeCollisionBoxes(n),T&&e&&S.updateCollisionDebugBuffers(this.transform.zoom,n);var o=(p,m,g)=>{const{crossTileID:y,numVerticalGlyphVertices:v}=p;if(I){const T={zoom:this.transform.zoom,pitch:this.transform.pitch};let e=null;if(I.dynamicFilterNeedsFeature){const se=this.retainedQueryData[S.bucketInstanceId];e=I.featureIndex.loadFeature({featureIndex:p.featureIndex,bucketIndex:se.bucketIndex,sourceLayerIndex:se.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,I.dynamicFilter)(T,e,this.retainedQueryData[S.bucketInstanceId].tileID.canonical,new se.pointGeometry(p.tileAnchorX,p.tileAnchorY),this.transform.calculateDistanceTileData(I.unwrappedTileID)))return this.placements[y]=new Lt(!1,!1,!1,!0),void(E[y]=!0)}if(!E[y])if(r)this.placements[y]=new Lt(!1,!1,!1);else{let c=!1,e=!1,t=!0,r=!1,n=!1,h=null,i={box:null,offscreen:null,occluded:null},o={box:null,offscreen:null,occluded:null},a,s=null,l=null,u=0,f=0,d=0;g.textFeatureIndex?u=g.textFeatureIndex:p.useRuntimeCollisionCircles&&(u=p.featureIndex),g.verticalTextFeatureIndex&&(f=g.verticalTextFeatureIndex);const b=e=>{e.tileID=this.retainedQueryData[S.bucketInstanceId].tileID;var t=this.transform.elevation;(t||e.elevation)&&(e.elevation=t?t.getAtTileOffset(e.tileID,e.tileAnchorX,e.tileAnchorY):0)},w=g.textBox;if(w){b(w);const E=e=>{let t=se.WritingMode.horizontal;if(S.allowVerticalPlacement&&!e&&this.prevPlacement){const se=this.prevPlacement.placedOrientations[y];se&&(this.placedOrientations[y]=se,t=se,this.markUsedOrientation(S,t,p))}return t},T=(e,t)=>{if(S.allowVerticalPlacement&&0<v&&g.verticalTextBox){for(const r of S.writingModes)if(r===se.WritingMode.vertical?(i=t(),o=i):i=e(),i&&i.box&&i.box.length)break}else i=e()};if(M.get("text-variable-anchor")){let u=M.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[y]){const se=this.prevPlacement.variableOffsets[y];0<u.indexOf(se.anchor)&&(u=u.filter(e=>e!==se.anchor)).unshift(se.anchor)}const A=(t,e,r)=>{var n=S.getSymbolInstanceTextSize(P,p,this.transform.zoom,m),i=(t.x2-t.x1)*n+2*t.padding,o=(t.y2-t.y1)*n+2*t.padding,a=U&&!B?e:null;a&&b(a);let s={box:[],offscreen:!1,occluded:!1};const l=F?2*u.length:u.length;for(let e=0;e<l;++e){const l=this.attemptAnchorPlacement(u[e%u.length],t,i,o,n,N,j,L,k,D,e>=u.length,p,m,S,r,a,P,z);if(l&&((s=l.placedGlyphBoxes)&&s.box&&s.box.length)){c=!0,h=l.shift;break}}return s},I=(T(()=>A(w,g.iconBox,se.WritingMode.horizontal),()=>{var e=g.verticalTextBox;return e&&b(e),S.allowVerticalPlacement&&!(i&&i.box&&i.box.length)&&0<v&&e?A(e,g.verticalIconBox,se.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),i&&(c=i.box,t=i.offscreen,r=i.occluded),E(i&&i.box));if(!c&&this.prevPlacement){const se=this.prevPlacement.variableOffsets[y];se&&(this.variableOffsets[y]=se,this.markUsedJustification(S,se.anchor,p,I))}}else{const M=(e,t)=>{var r=S.getSymbolInstanceTextSize(P,p,this.transform.zoom,m),r=this.collisionIndex.placeCollisionBox(S,r,e,new se.pointGeometry(0,0),F,L,k,D.predicate);return r&&r.box&&r.box.length&&(this.markUsedOrientation(S,t,p),this.placedOrientations[y]=t),r};T(()=>M(w,se.WritingMode.horizontal),()=>{var e=g.verticalTextBox;return S.allowVerticalPlacement&&0<v&&e?(b(e),M(e,se.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),E(i&&i.box&&i.box.length)}}if(a=i,c=a&&a.box&&0<a.box.length,t=a&&a.offscreen,r=a&&a.occluded,p.useRuntimeCollisionCircles){const E=S.text.placedSymbolArray.get(0<=p.centerJustifiedTextSymbolIndex?p.centerJustifiedTextSymbolIndex:p.verticalPlacedTextSymbolIndex),m=se.evaluateSizeForFeature(S.textSizeData,P,E),I=M.get("text-padding");s=this.collisionIndex.placeCollisionCircles(S,F,E,S.lineVertexArray,S.glyphOffsetArray,m,k,C,A,T,j,D.predicate,p.collisionCircleDiameter*m/se.ONE_EM,I,this.retainedQueryData[S.bucketInstanceId].tileID),c=F||0<s.circles.length&&!s.collisionDetected,t=t&&s.offscreen,r=s.occluded}if(g.iconFeatureIndex&&(d=g.iconFeatureIndex),g.iconBox){const E=e=>{b(e);var t=U&&h?Rt(h.x,h.y,N,j,this.transform.angle):new se.pointGeometry(0,0),r=S.getSymbolInstanceIconSize(z,this.transform.zoom,p.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(S,r,e,t,B,L,k,D.predicate)};e=0<(l=o&&o.box&&o.box.length&&g.verticalIconBox?E(g.verticalIconBox):E(g.iconBox)).box.length,t=t&&l.offscreen,n=l.occluded}var _=O||0===p.numHorizontalGlyphVertices&&0===v,x=R||0===p.numIconVertices;if(_||x?x?_||(e=e&&c):c=e&&c:e=c=e&&c,c&&a&&a.box&&this.collisionIndex.insertCollisionBox(a.box,M.get("text-ignore-placement"),S.bucketInstanceId,o&&o.box&&f?f:u,D.ID),e&&l&&this.collisionIndex.insertCollisionBox(l.box,M.get("icon-ignore-placement"),S.bucketInstanceId,d,D.ID),s&&(c&&this.collisionIndex.insertCollisionCircles(s.circles,M.get("text-ignore-placement"),S.bucketInstanceId,u,D.ID),T)){const se=S.bucketInstanceId;let t=this.collisionCircleArrays[se];void 0===t&&(t=this.collisionCircleArrays[se]=new Pt);for(let e=0;e<s.circles.length;e+=4)t.circles.push(s.circles[e+0]),t.circles.push(s.circles[e+1]),t.circles.push(s.circles[e+2]),t.circles.push(s.collisionDetected?1:0)}x="globe"!==S.projection.name;V=V&&(x||!r),G=G&&(x||!n),this.placements[y]=new Lt(c||V,e||G,t||S.justReloaded),E[y]=!0}};if(i){const se=S.getSortedSymbolIndexes(this.transform.angle);for(let e=se.length-1;0<=e;--e){const E=se[e];o(S.symbolInstances.get(E),E,S.collisionArrays[E])}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)o(S.symbolInstances.get(e),e,S.collisionArrays[e]);if(T&&S.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[S.bucketInstanceId];se.invert(t.invProjMatrix,k),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}markUsedJustification(e,t,r,n){var{leftJustifiedTextSymbolIndex:r,centerJustifiedTextSymbolIndex:i,rightJustifiedTextSymbolIndex:o,verticalPlacedTextSymbolIndex:a,crossTileID:s}=r,t=se.getAnchorJustification(t),n=n===se.WritingMode.vertical?a:"left"===t?r:"center"===t?i:"right"===t?o:-1;0<=r&&(e.text.placedSymbolArray.get(r).crossTileID=0<=n&&r!==n?0:s),0<=i&&(e.text.placedSymbolArray.get(i).crossTileID=0<=n&&i!==n?0:s),0<=o&&(e.text.placedSymbolArray.get(o).crossTileID=0<=n&&o!==n?0:s),0<=a&&(e.text.placedSymbolArray.get(a).crossTileID=0<=n&&a!==n?0:s)}markUsedOrientation(e,t,r){var n=t===se.WritingMode.horizontal||t===se.WritingMode.horizontalOnly?t:0,t=t===se.WritingMode.vertical?t:0,{leftJustifiedTextSymbolIndex:r,centerJustifiedTextSymbolIndex:i,rightJustifiedTextSymbolIndex:o,verticalPlacedTextSymbolIndex:a}=r,e=e.text.placedSymbolArray;0<=r&&(e.get(r).placedOrientation=n),0<=i&&(e.get(i).placedOrientation=n),0<=o&&(e.get(o).placedOrientation=n),0<=a&&(e.get(a).placedOrientation=t)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let r=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const n=t?t.symbolFadeChange(e):1,i=t?t.opacities:{},o=t?t.variableOffsets:{},a=t?t.placedOrientations:{};for(const e in this.placements){const t=this.placements[e],o=i[e];r=o?(this.opacities[e]=new T(o,n,t.text,t.icon,null,t.clipped),r||t.text!==o.text.placed||t.icon!==o.icon.placed):(this.opacities[e]=new T(null,n,t.text,t.icon,t.skipFade,t.clipped),r||t.text||t.icon)}for(const e in i){const t=i[e];if(!this.opacities[e]){const i=new T(t,n,!1,!1);i.isHidden()||(this.opacities[e]=i,r=r||t.text.placed||t.icon.placed)}}for(const e in o)this.variableOffsets[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.variableOffsets[e]=o[e]);for(const e in a)this.placedOrientations[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.placedOrientations[e]=a[e]);r?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){var r={};for(const n of t){const t=n.getBucket(e);t&&n.latestFeatureIndex&&e.id===t.layerIds[0]&&this.updateBucketOpacities(t,r,n.collisionBoxArray)}}updateBucketOpacities(n,i,t){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const o=n.layers[0].layout,a=!!n.layers[0].dynamicFilter(),s=new T(null,0,!1,!1,!0),l=o.get("text-allow-overlap"),u=o.get("icon-allow-overlap"),c=o.get("text-variable-anchor"),h="map"===o.get("text-rotation-alignment"),f="map"===o.get("text-pitch-alignment"),d="none"!==o.get("icon-text-fit"),p=new T(null,0,l&&(u||!n.hasIconData()||o.get("icon-optional")),u&&(l||!n.hasTextData()||o.get("text-optional")),!0);!n.collisionArrays&&t&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(t);var m=(t,r,n)=>{for(let e=0;e<r/4;e++)t.opacityVertexArray.emplaceBack(n)};let g=0;for(let e=0;e<n.symbolInstances.length;e++){const o=n.symbolInstances.get(e),{numHorizontalGlyphVertices:l,numVerticalGlyphVertices:u,crossTileID:w,numIconVertices:E}=o;let r=this.opacities[w];i[w]?r=s:r||(r=p,this.opacities[w]=r),i[w]=!0;var y=0<l||0<u,v=0<E,_=this.placedOrientations[w],x=_===se.WritingMode.vertical,b=_===se.WritingMode.horizontal||_===se.WritingMode.horizontalOnly;if(!y&&!v||r.isHidden()||g++,y){const se=Zt(r.text),i=(m(n.text,l,x?M:se),m(n.text,u,b?M:se),r.text.isHidden()),{leftJustifiedTextSymbolIndex:t,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:s,verticalPlacedTextSymbolIndex:c}=o,h=n.text.placedSymbolArray,f=i||x?1:0,d=(0<=t&&(h.get(t).hidden=f),0<=a&&(h.get(a).hidden=f),0<=s&&(h.get(s).hidden=f),0<=c&&(h.get(c).hidden=i||b?1:0),this.variableOffsets[w]),p=(d&&this.markUsedJustification(n,d.anchor,o,_),this.placedOrientations[w]);p&&(this.markUsedJustification(n,"left",o,p),this.markUsedOrientation(n,p,o))}if(v){const se=Zt(r.icon),{placedIconSymbolIndex:i,verticalPlacedIconSymbolIndex:t}=o,a=n.icon.placedSymbolArray,s=r.icon.isHidden()?1:0;0<=i&&(m(n.icon,E,x?M:se),a.get(i).hidden=s),0<=t&&(m(n.icon,o.numVerticalIconVertices,b?M:se),a.get(t).hidden=s)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const i=n.collisionArrays[e];if(i){let e=new se.pointGeometry(0,0),t=!0;if(i.textBox||i.verticalTextBox){if(c){const se=this.variableOffsets[w];se?(e=Ot(se.anchor,se.width,se.height,se.textOffset,se.textScale),h&&e._rotate(f?this.transform.angle:-this.transform.angle)):t=!1}a&&(t=!r.clipped),i.textBox&&S(n.textCollisionBox.collisionVertexArray,r.text.placed,!t||x,e.x,e.y),i.verticalTextBox&&S(n.textCollisionBox.collisionVertexArray,r.text.placed,!t||b,e.x,e.y)}const s=t&&Boolean(!b&&i.verticalIconBox);i.iconBox&&S(n.iconCollisionBox.collisionVertexArray,r.icon.placed,s,d?e.x:0,d?e.y:0),i.verticalIconBox&&S(n.iconCollisionBox.collisionVertexArray,r.icon.placed,!s,d?e.x:0,d?e.y:0)}}}if(n.fullyClipped=0===g,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=se.invProjMatrix,n.placementViewportMatrix=se.viewportMatrix,n.collisionCircleArray=se.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){var r=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*r>e}setStale(){this.stale=!0}}function S(e,t,r,n,i){e.emplaceBack(t?1:0,r?1:0,n||0,i||0),e.emplaceBack(t?1:0,r?1:0,n||0,i||0),e.emplaceBack(t?1:0,r?1:0,n||0,i||0),e.emplaceBack(t?1:0,r?1:0,n||0,i||0)}const Bt=Math.pow(2,25),Nt=Math.pow(2,24),jt=Math.pow(2,17),Ut=Math.pow(2,16),Vt=Math.pow(2,9),Gt=Math.pow(2,8),Wt=Math.pow(2,1);function Zt(e){var t;return 0!==e.opacity||e.placed?1===e.opacity&&e.placed?4294967295:(t=e.placed?1:0,(e=Math.floor(127*e.opacity))*Bt+t*Nt+e*jt+t*Ut+e*Vt+t*Gt+e*Wt+t):0}const M=0;class qt{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,t,r,n,i){for(var o=this._bucketParts;this._currentTileIndex<e.length;)if(t.getBucketParts(o,n,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,i())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort((e,t)=>e.sortKey-t.sortKey));this._currentPartIndex<o.length;){const e=o[this._currentPartIndex];if(t.placeLayerBucketPart(e,this._seenCrossTileIDs,r,0===e.symbolInstanceStart),this._currentPartIndex++,i())return!0}return!1}}class Ht{constructor(e,t,r,n,i,o,a,s){this.placement=new Ft(e,i,o,a,s),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=n,this._done=!1}isDone(){return this._done}continuePlacement(e,t,r){const n=se.exported.now(),i=()=>{var e=se.exported.now()-n;return!this._forceFullPlacement&&2<e};for(;0<=this._currentPlacementIndex;){const se=t[e[this._currentPlacementIndex]],n=this.placement.collisionIndex.transform.zoom;if("symbol"===se.type&&(!se.minzoom||se.minzoom<=n)&&(!se.maxzoom||se.maxzoom>n)){if(this._inProgressLayer||(this._inProgressLayer=new qt(se)),this._inProgressLayer.continuePlacement(r[se.source],this.placement,this._showCollisionBoxes,se,i))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const $t=512/se.EXTENT/2;class Xt{constructor(t,r,e){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=e;for(let e=0;e<r.length;e++){var n=r.get(e),i=n.key;this.indexedSymbolInstances[i]||(this.indexedSymbolInstances[i]=[]),this.indexedSymbolInstances[i].push({crossTileID:n.crossTileID,coord:this.getScaledCoordinates(n,t)})}}getScaledCoordinates(e,t){var r=$t/Math.pow(2,t.canonical.z-this.tileID.canonical.z);return{x:Math.floor((t.canonical.x*se.EXTENT+e.tileAnchorX)*r),y:Math.floor((t.canonical.y*se.EXTENT+e.tileAnchorY)*r)}}findMatches(t,r,n){var i=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let e=0;e<t.length;e++){var o=t.get(e);if(!o.crossTileID){var a=this.indexedSymbolInstances[o.key];if(a){var s=this.getScaledCoordinates(o,r);for(const t of a)if(Math.abs(t.coord.x-s.x)<=i&&Math.abs(t.coord.y-s.y)<=i&&!n[t.crossTileID]){n[t.crossTileID]=!0,o.crossTileID=t.crossTileID;break}}}}}}class Yt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Jt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){var t=Math.round((e-this.lng)/360);if(0!==t)for(const e in this.indexes){var r=this.indexes[e],n={};for(const e in r){var i=r[e];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+t),n[i.tileID.key]=i}this.indexes[e]=n}this.lng=e}addBucket(e,t,r){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let e=0;e<t.symbolInstances.length;e++)t.symbolInstances.get(e).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});var n=this.usedCrossTileIDs[e.overscaledZ];for(const r in this.indexes){var i=this.indexes[r];if(Number(r)>e.overscaledZ)for(const r in i){var o=i[r];o.tileID.isChildOf(e)&&o.findMatches(t.symbolInstances,e,n)}else{var a=i[e.scaledTo(Number(r)).key];a&&a.findMatches(t.symbolInstances,e,n)}}for(let e=0;e<t.symbolInstances.length;e++){var s=t.symbolInstances.get(e);s.crossTileID||(s.crossTileID=r.generate(),n[s.crossTileID]=!0)}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Xt(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const r in t.indexedSymbolInstances)for(const n of t.indexedSymbolInstances[r])delete this.usedCrossTileIDs[e][n.crossTileID]}removeStaleBuckets(e){let t=!1;for(const n in this.indexes){var r=this.indexes[n];for(const i in r)e[r[i].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,r[i]),delete r[i],t=!0)}return t}}class Kt{constructor(){this.layerIndexes={},this.crossTileIDs=new Yt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,r,n){let i=this.layerIndexes[e.id],o=(void 0===i&&(i=this.layerIndexes[e.id]=new Jt),!1);var a={};"globe"!==n.name&&i.handleWrapJump(r);for(const r of t){const t=r.getBucket(e);t&&e.id===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(r.tileID,t,this.crossTileIDs)&&(o=!0),a[t.bucketInstanceId]=!0)}return o=i.removeStaleBuckets(a)?!0:o}pruneUnusedLayers(e){const t={};e.forEach(e=>{t[e]=!0});for(const e in this.layerIndexes)t[e]||delete this.layerIndexes[e]}}const h=(e,t)=>se.emitValidationErrors(e,t&&t.filter(e=>"source.canvas"!==e.identifier)),Qt=se.pick(b,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),er=se.pick(b,["setCenter","setZoom","setBearing","setPitch"]),tr={version:8,layers:[],sources:{}},rr={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class p extends se.Evented{constructor(e,t={}){super(),this.map=e,this.dispatcher=new i(c(),this),this.imageManager=new q,this.imageManager.setEventedParent(this),this.glyphManager=new se.GlyphManager(e._requestManager,t.localFontFamily?se.LocalGlyphMode.all:t.localIdeographFontFamily?se.LocalGlyphMode.ideographs:se.LocalGlyphMode.none,t.localFontFamily||t.localIdeographFontFamily),this.crossTileSymbolIndex=new Kt,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",se.getReferrer());const r=this;this._rtlTextPluginCallback=p.registerForPluginStateChange(e=>{r.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},(e,t)=>{if(se.triggerPluginCompletionEvent(e),t&&t.every(e=>e))for(const se in r._sourceCaches){const e=r._sourceCaches[se],t=e.getSource().type;"vector"!==t&&"geojson"!==t||e.reload()}})}),this.on("data",e=>{if("source"===e.dataType&&"metadata"===e.sourceDataType){var t=this.getSource(e.sourceId);if(t&&t.vectorLayerIds)for(const e in this._layers){var r=this._layers[e];r.source===t.id&&this._validateLayer(r)}}})}loadURL(e,t={}){this.fire(new se.Event("dataloading",{dataType:"style"}));const r="boolean"==typeof t.validate?t.validate:!se.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,t.accessToken);t=this.map._requestManager.transformRequest(e,se.ResourceType.Style);this._request=se.getJSON(t,(e,t)=>{this._request=null,e?this.fire(new se.ErrorEvent(e)):t&&this._load(t,r)})}loadJSON(e,t={}){this.fire(new se.Event("dataloading",{dataType:"style"})),this._request=se.exported.frame(()=>{this._request=null,this._load(e,!1!==t.validate)})}loadEmpty(){this.fire(new se.Event("dataloading",{dataType:"style"})),this._load(tr,!1)}_updateLayerCount(e,t){t=t?1:-1;e.is3D()&&(this._num3DLayers+=t),"circle"===e.type&&(this._numCircleLayers+=t),"symbol"===e.type&&(this._numSymbolLayers+=t)}_load(e,t){if(!t||!h(this,se.validateStyle(e))){this._loaded=!0,this.stylesheet=se.clone$1(e),this._updateMapProjection();for(const se in e.sources)this.addSource(se,e.sources[se],{validate:!1});this._changed=!1,e.sprite?this._loadSprite(e.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(e.glyphs);var r,t=st(this.stylesheet.layers);this._order=t.map(e=>e.id),this._layers={},this._serializedLayers={};for(r of t)r=se.createStyleLayer(r),r.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=r,this._serializedLayers[r.id]=r.serialize(),this._updateLayerCount(r,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new X(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new se.Event("data",{dataType:"style"})),this.fire(new se.Event("style.load"))}}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(e){this._spriteRequest=function(e,t,c){let h,f,d;var r=1<se.exported.devicePixelRatio?"@2x":"";let n=se.getJSON(t.transformRequest(t.normalizeSpriteURL(e,r,".json"),se.ResourceType.SpriteJSON),(e,t)=>{n=null,d||(d=e,h=t,o())}),i=se.getImage(t.transformRequest(t.normalizeSpriteURL(e,r,".png"),se.ResourceType.SpriteImage),(e,t)=>{i=null,d||(d=e,f=t,o())});function o(){if(d)c(d);else if(h&&f){var e=se.exported.getImageData(f),t={};for(const c in h){const{width:f,height:d,x:r,y:n,sdf:i,pixelRatio:o,stretchX:a,stretchY:s,content:l}=h[c],u=new se.RGBAImage({width:f,height:d});se.RGBAImage.copy(e,u,{x:r,y:n},{x:0,y:0},{width:f,height:d}),t[c]={data:u,pixelRatio:o,sdf:i,stretchX:a,stretchY:s,content:l}}c(null,t)}}return{cancel(){n&&(n.cancel(),n=null),i&&(i.cancel(),i=null)}}}(e,this.map._requestManager,(e,t)=>{if(this._spriteRequest=null,e)this.fire(new se.ErrorEvent(e));else if(t)for(const se in t)this.imageManager.addImage(se,t[se]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new se.Event("data",{dataType:"style"}))})}_validateLayer(e){var t,r=this.getSource(e.source);!r||(t=e.sourceLayer)&&("geojson"===r.type||r.vectorLayerIds&&-1===r.vectorLayerIds.indexOf(t))&&this.fire(new se.ErrorEvent(new Error(`Source layer "${t}" does not exist on source "${r.id}" as specified by style layer "${e.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(e){var t=[];for(const r of e){const e=this._layers[r];"custom"!==e.type&&t.push(e.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;if(this.fog&&this.fog.hasTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(e){return!!this.terrain&&("function"==typeof e.isLayerDraped?e.isLayerDraped():rr[e.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(e){if(this._loaded){const r=this._changed;if(this._changed){const se=Object.keys(this._updatedLayers),r=Object.keys(this._removedLayers);(se.length||r.length)&&this._updateWorkerLayers(se,r);for(const se in this._updatedSources){const e=this._updatedSources[se];"reload"===e?this._reloadSource(se):"clear"===e&&this._clearSource(se)}this._updateTilesForChangedImages();for(const se in this._updatedPaintProps)this._layers[se].updateTransitions(e);this.light.updateTransitions(e),this.fog&&this.fog.updateTransitions(e),this._resetUpdates()}const n={};for(const se in this._sourceCaches){const e=this._sourceCaches[se];n[se]=e.used,e.used=!1}for(const se of this._order){const r=this._layers[se];if(r.recalculate(e,this._availableImages),!r.isHidden(e.zoom)){const se=this._getLayerSourceCache(r);se&&(se.used=!0)}const n=this.map.painter;if(n){const se=r.getProgramIds();if(se){var t=r.getProgramConfiguration(e.zoom);for(const e of se)n.useProgram(e,t)}}}for(const e in n){const r=this._sourceCaches[e];n[e]!==r.used&&r.getSource().fire(new se.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:r.getSource().id}))}this.light.recalculate(e),this.terrain&&this.terrain.recalculate(e),this.fog&&this.fog.recalculate(e),this.z=e.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),r&&this.fire(new se.Event("data",{dataType:"style"}))}}_updateTilesForChangedImages(){var e=Object.keys(this._changedImages);if(e.length){for(const t in this._sourceCaches)this._sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateWorkerLayers(e,t){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(e),removedIds:t})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(e){if(this._checkLoaded(),h(this,se.validateStyle(e)))return!1;(e=se.clone$1(e)).layers=st(e.layers);var t=function(t,s){if(!t)return[{command:b.setStyle,args:[s]}];let l=[];try{if(!x(t.version,s.version))return[{command:b.setStyle,args:[s]}];x(t.center,s.center)||l.push({command:b.setCenter,args:[s.center]}),x(t.zoom,s.zoom)||l.push({command:b.setZoom,args:[s.zoom]}),x(t.bearing,s.bearing)||l.push({command:b.setBearing,args:[s.bearing]}),x(t.pitch,s.pitch)||l.push({command:b.setPitch,args:[s.pitch]}),x(t.sprite,s.sprite)||l.push({command:b.setSprite,args:[s.sprite]}),x(t.glyphs,s.glyphs)||l.push({command:b.setGlyphs,args:[s.glyphs]}),x(t.transition,s.transition)||l.push({command:b.setTransition,args:[s.transition]}),x(t.light,s.light)||l.push({command:b.setLight,args:[s.light]}),x(t.fog,s.fog)||l.push({command:b.setFog,args:[s.fog]}),x(t.projection,s.projection)||l.push({command:b.setProjection,args:[s.projection]});const a={},v=[];{var r=t.sources;var n=s.sources;var i=v;var o=a;let e;for(e in n=n||{},r=r||{})!r.hasOwnProperty(e)||n.hasOwnProperty(e)||ut(e,i,o);for(e in n)n.hasOwnProperty(e)&&(r.hasOwnProperty(e)?x(r[e],n[e])||("geojson"===r[e].type&&"geojson"===n[e].type&&ht(r,n,e)?i.push({command:b.setGeoJSONSourceData,args:[e,n[e].data]}):ct(e,n,i,o)):lt(e,n,i))}const _=[];t.layers&&t.layers.forEach(e=>{e.source&&a[e.source]?l.push({command:b.removeLayer,args:[e.id]}):_.push(e)});let e=t.terrain;e&&a[e.source]&&(l.push({command:b.setTerrain,args:[void 0]}),e=void 0),l=l.concat(v),x(e,s.terrain)||l.push({command:b.setTerrain,args:[s.terrain]});{var u=_;var c=s.layers;var h=l;c=c||[];var f=(u=u||[]).map(ft),d=c.map(ft),p=u.reduce(dt,{}),m=c.reduce(dt,{}),g=f.slice(),y=Object.create(null);let e,t,r,n,i,o,a;for(e=0,t=0;e<f.length;e++)r=f[e],m.hasOwnProperty(r)?t++:(h.push({command:b.removeLayer,args:[r]}),g.splice(g.indexOf(r,t),1));for(e=0,t=0;e<d.length;e++)r=d[d.length-1-e],g[g.length-1-e]!==r&&(p.hasOwnProperty(r)?(h.push({command:b.removeLayer,args:[r]}),g.splice(g.lastIndexOf(r,g.length-t),1)):t++,o=g[g.length-e],h.push({command:b.addLayer,args:[m[r],o]}),g.splice(g.length-e,0,r),y[r]=!0);for(e=0;e<d.length;e++)if(r=d[e],n=p[r],i=m[r],!y[r]&&!x(n,i))if(x(n.source,i.source)&&x(n["source-layer"],i["source-layer"])&&x(n.type,i.type)){for(a in w(n.layout,i.layout,h,r,null,b.setLayoutProperty),w(n.paint,i.paint,h,r,null,b.setPaintProperty),x(n.filter,i.filter)||h.push({command:b.setFilter,args:[r,i.filter]}),x(n.minzoom,i.minzoom)&&x(n.maxzoom,i.maxzoom)||h.push({command:b.setLayerZoomRange,args:[r,i.minzoom,i.maxzoom]}),n)n.hasOwnProperty(a)&&"layout"!==a&&"paint"!==a&&"filter"!==a&&"metadata"!==a&&"minzoom"!==a&&"maxzoom"!==a&&(0===a.indexOf("paint.")?w(n[a],i[a],h,r,a.slice(6),b.setPaintProperty):x(n[a],i[a])||h.push({command:b.setLayerProperty,args:[r,a,i[a]]}));for(a in i)i.hasOwnProperty(a)&&!n.hasOwnProperty(a)&&"layout"!==a&&"paint"!==a&&"filter"!==a&&"metadata"!==a&&"minzoom"!==a&&"maxzoom"!==a&&(0===a.indexOf("paint.")?w(n[a],i[a],h,r,a.slice(6),b.setPaintProperty):x(n[a],i[a])||h.push({command:b.setLayerProperty,args:[r,a,i[a]]}))}else h.push({command:b.removeLayer,args:[r]}),o=g[g.lastIndexOf(r)+1],h.push({command:b.addLayer,args:[i,o]})}}catch(t){console.warn("Unable to compute style diff:",t),l=[{command:b.setStyle,args:[s]}]}return l}(this.serialize(),e).filter(e=>!(e.command in er));if(0===t.length)return!1;var r=t.filter(e=>!(e.command in Qt));if(0<r.length)throw new Error(`Unimplemented: ${r.map(e=>e.command).join(", ")}.`);return t.forEach(e=>{"setTransition"!==e.command&&"setProjection"!==e.command&&this[e.command].apply(this,e.args)}),this.stylesheet=e,this._updateMapProjection(),!0}addImage(e,t){return this.getImage(e)?this.fire(new se.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(e,t),this._afterImageUpdated(e),this)}updateImage(e,t){this.imageManager.updateImage(e,t)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){return this.getImage(e)?(this.imageManager.removeImage(e),this._afterImageUpdated(e),this):this.fire(new se.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new se.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,e,t={}){if(this._checkLoaded(),void 0!==this.getSource(r))throw new Error("There is already a source with this ID");if(!e.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(e).join(", ")}.`);if(!(0<=["vector","raster","geojson","video","image"].indexOf(e.type)&&this._validate(se.validateSource,"sources."+r,e,null,t))){this.map&&this.map._collectResourceTiming&&(e.collectResourceTiming=!0);const n=et(r,e,this.dispatcher,this);n.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:n.serialize(),sourceId:r}));t=e=>{var t=(e?"symbol:":"other:")+r,t=this._sourceCaches[t]=new se.SourceCache(t,n,e);((e?this._symbolSourceCaches:this._otherSourceCaches)[r]=t).style=this,t.onAdd(this.map)};t(!1),"vector"!==e.type&&"geojson"!==e.type||t(!0),n.onAdd&&n.onAdd(this.map),this._changed=!0}}removeSource(e){this._checkLoaded();const t=this.getSource(e);if(!t)throw new Error("There is no source with this ID");for(const t in this._layers)if(this._layers[t].source===e)return this.fire(new se.ErrorEvent(new Error(`Source "${e}" cannot be removed while layer "${t}" is using it.`)));if(this.terrain&&this.terrain.get().source===e)return this.fire(new se.ErrorEvent(new Error(`Source "${e}" cannot be removed while terrain is using it.`)));var r=this._getSourceCaches(e);for(const e of r)delete this._sourceCaches[e.id],delete this._updatedSources[e.id],e.fire(new se.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e.getSource().id})),e.setEventedParent(null),e.clearTiles();return delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],t.setEventedParent(null),t.onRemove&&t.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getSource(e).setData(t),this._changed=!0}getSource(e){e=this._getSourceCache(e);return e&&e.getSource()}_getSources(){var e=[];for(const r in this._otherSourceCaches){var t=this._getSourceCache(r);t&&e.push(t.getSource())}return e}addLayer(t,r,n={}){this._checkLoaded();var i=t.id;if(this.getLayer(i))this.fire(new se.ErrorEvent(new Error(`Layer with id "${i}" already exists on this map`)));else{let e;if("custom"===t.type){if(h(this,se.validateCustomStyleLayer(t)))return;e=se.createStyleLayer(t)}else{if("object"==typeof t.source&&(this.addSource(i,t.source),t=se.clone$1(t),t=se.extend(t,{source:i})),this._validate(se.validateLayer,"layers."+i,t,{arrayIndex:-1},n))return;e=se.createStyleLayer(t),this._validateLayer(e),e.setEventedParent(this,{layer:{id:i}}),this._serializedLayers[e.id]=e.serialize(),this._updateLayerCount(e,!0)}n=r?this._order.indexOf(r):this._order.length;if(r&&-1===n)this.fire(new se.ErrorEvent(new Error(`Layer with id "${r}" does not exist on this map.`)));else{this._order.splice(n,0,i),this._layerOrderChanged=!0,this._layers[i]=e;t=this._getLayerSourceCache(e);if(this._removedLayers[i]&&e.source&&t&&"custom"!==e.type){const se=this._removedLayers[i];delete this._removedLayers[i],se.type!==e.type?this._updatedSources[e.source]="clear":(this._updatedSources[e.source]="reload",t.pause())}this._updateLayer(e),e.onAdd&&e.onAdd(this.map),this._updateDrapeFirstLayers()}}}moveLayer(e,t){var r;this._checkLoaded(),this._changed=!0,this._layers[e]?e!==t&&(r=this._order.indexOf(e),this._order.splice(r,1),r=t?this._order.indexOf(t):this._order.length,t&&-1===r?this.fire(new se.ErrorEvent(new Error(`Layer with id "${t}" does not exist on this map.`))):(this._order.splice(r,0,e),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())):this.fire(new se.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)))}removeLayer(e){this._checkLoaded();var t,r=this._layers[e];r?(r.setEventedParent(null),this._updateLayerCount(r,!1),t=this._order.indexOf(e),this._order.splice(t,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=r,delete this._layers[e],delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],r.onRemove&&r.onRemove(this.map),this._updateDrapeFirstLayers()):this.fire(new se.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be removed.`)))}getLayer(e){return this._layers[e]}hasLayer(e){return e in this._layers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return!0;return!1}setLayerZoomRange(e,t,r){this._checkLoaded();var n=this.getLayer(e);n?n.minzoom===t&&n.maxzoom===r||(null!=t&&(n.minzoom=t),null!=r&&(n.maxzoom=r),this._updateLayer(n)):this.fire(new se.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(e,t,r={}){this._checkLoaded();var n=this.getLayer(e);if(n){if(!x(n.filter,t))return null==t?(n.filter=void 0,void this._updateLayer(n)):void(this._validate(se.validateFilter,`layers.${n.id}.filter`,t,{layerType:n.type},r)||(n.filter=se.clone$1(t),this._updateLayer(n)))}else this.fire(new se.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be filtered.`)))}getFilter(e){e=this.getLayer(e);return e&&se.clone$1(e.filter)}setLayoutProperty(e,t,r,n={}){this._checkLoaded();var i=this.getLayer(e);i?x(i.getLayoutProperty(t),r)||(i.setLayoutProperty(t,r,n),this._updateLayer(i)):this.fire(new se.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(e,t){var r=this.getLayer(e);if(r)return r.getLayoutProperty(t);this.fire(new se.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style.`)))}setPaintProperty(e,t,r,n={}){this._checkLoaded();var i=this.getLayer(e);i?x(i.getPaintProperty(t),r)||(i.setPaintProperty(t,r,n)&&this._updateLayer(i),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new se.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(e,t){e=this.getLayer(e);return e&&e.getPaintProperty(t)}setFeatureState(e,t){this._checkLoaded();var r=e.source,n=e.sourceLayer,i=this.getSource(r);if(i){i=i.type;if("geojson"===i&&n)this.fire(new se.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));else if("vector"!==i||n){void 0===e.id&&this.fire(new se.ErrorEvent(new Error("The feature id parameter must be provided.")));for(const se of this._getSourceCaches(r))se.setFeatureState(n,e.id,t)}else this.fire(new se.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new se.ErrorEvent(new Error(`The source '${r}' does not exist in the map's style.`)))}removeFeatureState(e,t){this._checkLoaded();var r=e.source,n=this.getSource(r);if(n){var n=n.type,i="vector"===n?e.sourceLayer:void 0;if("vector"!==n||i)if(t&&"string"!=typeof e.id&&"number"!=typeof e.id)this.fire(new se.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));else for(const se of this._getSourceCaches(r))se.removeFeatureState(i,e.id,t);else this.fire(new se.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new se.ErrorEvent(new Error(`The source '${r}' does not exist in the map's style.`)))}getFeatureState(e){this._checkLoaded();var t=e.source,r=e.sourceLayer,n=this.getSource(t);if(n){if("vector"!==n.type||r)return void 0===e.id&&this.fire(new se.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(t)[0].getFeatureState(r,e.id);this.fire(new se.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new se.ErrorEvent(new Error(`The source '${t}' does not exist in the map's style.`)))}getTransition(){return se.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){var e={};for(const se in this._sourceCaches){var t=this._sourceCaches[se].getSource();e[t.id]||(e[t.id]=t.serialize())}return se.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:e,layers:this._serializeLayers(this._order)},e=>void 0!==e)}_updateLayer(e){this._updatedLayers[e.id]=!0;var t=this._getLayerSourceCache(e);e.source&&!this._updatedSources[e.source]&&t&&"raster"!==t.getSource().type&&(this._updatedSources[e.source]="reload",t.pause()),this._changed=!0,e.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const n=e=>"fill-extrusion"===this._layers[e].type,i={},o=[];for(let e=this._order.length-1;0<=e;e--){var t=this._order[e];if(n(t)){i[t]=e;for(const n of r){const r=n[t];if(r)for(const n of r)o.push(n)}}}o.sort((e,t)=>t.intersectionZ-e.intersectionZ);var a=[];for(let t=this._order.length-1;0<=t;t--){var e=this._order[t];if(n(e))for(let e=o.length-1;0<=e;e--){const n=o[e].feature;if(i[n.layer.id]<t)break;a.push(n),o.pop()}else for(const n of r){const r=n[e];if(r)for(const n of r)a.push(n.feature)}}return a}queryRenderedFeatures(e,t,r){t&&t.filter&&this._validate(se.validateFilter,"queryRenderedFeatures.filter",t.filter,null,t);var n={};if(t&&t.layers){if(!Array.isArray(t.layers))return this.fire(new se.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const e of t.layers){const t=this._layers[e];if(!t)return this.fire(new se.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be queried for features.`))),[];n[t.source]=!0}}var i=[],o=(t.availableImages=this._availableImages,t&&t.layers?t.layers.some(e=>{e=this.getLayer(e);return e&&e.is3D()}):this.has3DLayers()),a=ie.createFromScreenPoints(e,r);for(const se in this._sourceCaches){const e=this._sourceCaches[se].getSource().id;t.layers&&!n[e]||i.push(rt(this._sourceCaches[se],this._layers,this._serializedLayers,a,t,r,o,!!this.map._showQueryGeometry))}return this.placement&&i.push(function(r,n,i,e,t,o,a){var s={},l=o.queryRenderedSymbols(e),u=[];for(const r of Object.keys(l).map(Number))u.push(a[r]);u.sort(it);for(const i of u){const e=i.featureIndex.lookupSymbolFeatures(l[i.bucketInstanceId],n,i.bucketIndex,i.sourceLayerIndex,t.filter,t.layers,t.availableImages,r);for(const r in e){const n=s[r]=s[r]||[],t=e[r];t.sort((e,t)=>{var r=i.featureSortOrder;if(r){const i=r.indexOf(e.featureIndex);return r.indexOf(t.featureIndex)-i}return t.featureIndex-e.featureIndex});for(const r of t)n.push(r)}}for(const n in s)s[n].forEach(e=>{var e=e.feature,t=i(r[n]).getFeatureState(e.layer["source-layer"],e.id);e.source=e.layer.source,e.layer["source-layer"]&&(e.sourceLayer=e.layer["source-layer"]),e.state=t});return s}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),a.screenGeometry,t,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(i)}querySourceFeatures(e,t){t&&t.filter&&this._validate(se.validateFilter,"querySourceFeatures.filter",t.filter,null,t);let r=[];for(const se of this._getSourceCaches(e))r=r.concat(nt(se,t));return r}addSourceType(e,t,r){return p.getSourceType(e)?r(new Error(`A source type called "${e}" already exists.`)):(p.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},r):r(null,null))}getLight(){return this.light.getLight()}setLight(e,t={}){this._checkLoaded();var r,n=this.light.getLight();let i=!1;for(const t in e)if(!x(e[t],n[t])){i=!0;break}i&&(r=this._setTransitionParameters({duration:300,delay:0}),this.light.setLight(e,t),this.light.updateTransitions(r))}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(e,t=1){if(this._checkLoaded(),e){if(1===t){if("object"==typeof e.source){const x="terrain-dem-src";this.addSource(x,e.source),e=se.clone$1(e),e=se.extend(e,{source:x})}if(this._validate(se.validateTerrain,"terrain",e))return}if(!this.terrain||this.terrain&&t!==this.terrain.drapeRenderMode)this._createTerrain(e,t);else{const t=this.terrain,r=t.get();for(const x of Object.keys(se.spec.terrain))!e.hasOwnProperty(x)&&se.spec.terrain[x].default&&(e[x]=se.spec.terrain[x].default);for(const se in e)if(!x(e[se],r[se])){t.set(e),this.stylesheet.terrain=e;const se=this._setTransitionParameters({duration:0});t.updateTransitions(se);break}}this._updateDrapeFirstLayers()}else delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate();this._markersNeedUpdate=!0}_createFog(e){var t=this.fog=new ne(e,this.map.transform),e=(this.stylesheet.fog=e,this._setTransitionParameters({duration:0}));t.updateTransitions(e)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const e of this.map._markers)e._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),e)if(this.fog){var t=this.fog,r=t.get();0===Object.keys(e).length&&t.set(e);for(const n in e)if(!x(e[n],r[n])){t.set(e),this.stylesheet.fog=e;const x=this._setTransitionParameters({duration:0});t.updateTransitions(x);break}}else this._createFog(e);else delete this.fog,delete this.stylesheet.fog;this._markersNeedUpdate=!0}_setTransitionParameters(e){return{now:se.exported.now(),transition:se.extend(e,this.stylesheet.transition)}}_updateDrapeFirstLayers(){var e,t;this.map._optimizeForTerrain&&this.terrain&&(e=this._order.filter(e=>this.isLayerDraped(this._layers[e])),t=this._order.filter(e=>!this.isLayerDraped(this._layers[e])),this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t))}_createTerrain(e,t){t=this.terrain=new K(e,t),this.stylesheet.terrain=e,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate(),e=this._setTransitionParameters({duration:0});t.updateTransitions(e)}_force3DLayerUpdate(){for(const t in this._layers){var e=this._layers[t];"fill-extrusion"===e.type&&this._updateLayer(e)}}_forceSymbolLayerUpdate(){for(const t in this._layers){var e=this._layers[t];"symbol"===e.type&&this._updateLayer(e)}}_validate(e,t,r,n,i={}){return(!i||!1!==i.validate)&&h(this,e.call(se.validateStyle,se.extend({key:t,style:this.serialize(),value:r,styleSpec:se.spec},n)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),se.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const se in this._layers)this._layers[se].setEventedParent(null);for(const se in this._sourceCaches)this._sourceCaches[se].clearTiles(),this._sourceCaches[se].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(e){var t=this._getSourceCaches(e);for(const e of t)e.clearTiles()}_reloadSource(e){var t=this._getSourceCaches(e);for(const e of t)e.resume(),e.reload()}_reloadSources(){for(const e of this._getSources())e.reload&&e.reload()}_updateSources(e){for(const t in this._sourceCaches)this._sourceCaches[t].update(e)}_generateCollisionBoxes(){for(const t in this._sourceCaches){var e=this._sourceCaches[t];e.resume(),e.reload()}}_updatePlacement(e,t,r,n,i=!1){let o=!1,a=!1;var s={};for(const se of this._order){const t=this._layers[se];if("symbol"===t.type){if(!s[t.source]){const se=this._getLayerSourceCache(t);if(!se)continue;s[t.source]=se.getRenderableIds(!0).map(e=>se.getTileByID(e)).sort((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1))}const r=this.crossTileSymbolIndex.addLayer(t,s[t.source],e.center.lng,e.projection);o=o||r}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),i=i||this._layerOrderChanged||0===r,this._layerOrderChanged&&this.fire(new se.Event("neworder")),(i||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(se.exported.now(),e.zoom))&&(this.pauseablePlacement=new Ht(e,this._order,i,t,r,n,this.placement,this.fog&&e.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,s),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(se.exported.now()),a=!0),o&&this.pauseablePlacement.placement.setStale()),a||o)for(const se of this._order){const e=this._layers[se];"symbol"===e.type&&this.placement.updateLayerOpacities(e,s[e.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(se.exported.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,t,r){this.imageManager.getImages(t.icons,r),this._updateTilesForChangedImages();r=e=>{e&&e.setDependencies(t.tileID.key,t.type,t.icons)};r(this._otherSourceCaches[t.source]),r(this._symbolSourceCaches[t.source])}getGlyphs(e,t,r){this.glyphManager.getGlyphs(t.stacks,r)}getResource(e,t,r){return se.makeRequest(t,r)}_getSourceCache(e){return this._otherSourceCaches[e]}_getLayerSourceCache(e){return("symbol"===e.type?this._symbolSourceCaches:this._otherSourceCaches)[e.source]}_getSourceCaches(e){var t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}_isSourceCacheLoaded(e){var t=this._getSourceCaches(e);return 0===t.length?(this.fire(new se.ErrorEvent(new Error(`There is no source with ID '${e}'`))),!1):t.every(e=>e.loaded())}has3DLayers(){return 0<this._num3DLayers}hasSymbolLayers(){return 0<this._numSymbolLayers}hasCircleLayers(){return 0<this._numCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}p.getSourceType=function(e){return tt[e]},p.setSourceType=function(e,t){tt[e]=t},p.registerForPluginStateChange=se.registerForPluginStateChange;var nr="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",ir="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",or="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",ar="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",sr="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let lr,ur;const m=[],cr=(g(nr,m),g(or,m),g(ar,m),g(sr,m),lr=y("",or),ur=y(sr,ar),y("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.")),hr=nr,fr="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var dr={background:y("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:y("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:y("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:y("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:y("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:y("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:y("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:y("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:y("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:y("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:y("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:y("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:y("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:y("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:y("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:y("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:y("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:y("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:y("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:y("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:y("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:y("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:y("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:y("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:y("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:y("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ir),skyboxGradient:y("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ir),skyboxCapture:y("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:y("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:y("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function g(e,t){const r=e.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(var n of r)if(n=n.trim(),"#"===n[0]&&n.includes("if")&&!n.includes("endif")){const r=(n=n.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim()).split(" ");for(const e of r)t.includes(e)||t.push(e)}}function y(e,t){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,n=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),s={},i=[...m];return g(e,i),g(t,i),{fragmentSource:e=e.replace(r,(e,t,r,n,i)=>(s[i]=!0,"define"===t?`
#ifndef HAS_UNIFORM_u_${i}
varying ${r} ${n} ${i};
#else
uniform ${r} ${n} u_${i};
#endif
`:`
#ifdef HAS_UNIFORM_u_${i}
    ${r} ${n} ${i} = u_${i};
#endif
`)),vertexSource:t=t.replace(r,(e,t,r,n,i)=>{var o="float"===n?"vec2":"vec4",a=i.match(/color/)?"color":o;return s[i]?"define"===t?`
#ifndef HAS_UNIFORM_u_${i}
uniform lowp float u_${i}_t;
attribute ${r} ${o} a_${i};
varying ${r} ${n} ${i};
#else
uniform ${r} ${n} u_${i};
#endif
`:"vec4"==a?`
#ifndef HAS_UNIFORM_u_${i}
    ${i} = a_${i};
#else
    ${r} ${n} ${i} = u_${i};
#endif
`:`
#ifndef HAS_UNIFORM_u_${i}
    ${i} = unpack_mix_${a}(a_${i}, u_${i}_t);
#else
    ${r} ${n} ${i} = u_${i};
#endif
`:"define"===t?`
#ifndef HAS_UNIFORM_u_${i}
uniform lowp float u_${i}_t;
attribute ${r} ${o} a_${i};
#else
uniform ${r} ${n} u_${i};
#endif
`:"vec4"==a?`
#ifndef HAS_UNIFORM_u_${i}
    ${r} ${n} ${i} = a_${i};
#else
    ${r} ${n} ${i} = u_${i};
#endif
`:`
#ifndef HAS_UNIFORM_u_${i}
    ${r} ${n} ${i} = unpack_mix_${a}(a_${i}, u_${i}_t);
#else
    ${r} ${n} ${i} = u_${i};
#endif
`}),staticAttributes:n,usedDefines:i}}class pr{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,t,r,n,i,o,a){this.context=e;let s=this.boundPaintVertexBuffers.length!==n.length;for(let e=0;!s&&e<n.length;e++)this.boundPaintVertexBuffers[e]!==n[e]&&(s=!0);let l=this.boundDynamicVertexBuffers.length!==a.length;for(let e=0;!l&&e<a.length;e++)this.boundDynamicVertexBuffers[e]!==a[e]&&(l=!0);if(!e.extVertexArrayObject||!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==r||s||l||this.boundIndexBuffer!==i||this.boundVertexOffset!==o)this.freshBind(t,r,n,i,o,a);else{e.bindVertexArrayOES.set(this.vao);for(const e of a)e&&e.bind();i&&i.dynamicDraw&&i.bind()}}freshBind(e,t,r,n,i,o){let a;var s=e.numAttributes,l=this.context,u=l.gl;if(l.extVertexArrayObject)this.vao&&this.destroy(),this.vao=l.extVertexArrayObject.createVertexArrayOES(),l.bindVertexArrayOES.set(this.vao),a=0,this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=r,this.boundIndexBuffer=n,this.boundVertexOffset=i,this.boundDynamicVertexBuffers=o;else{a=l.currentNumAttributes||0;for(let e=s;e<a;e++)u.disableVertexAttribArray(e)}t.enableAttributes(u,e),t.bind(),t.setVertexAttribPointers(u,e,i);for(const t of r)t.enableAttributes(u,e),t.bind(),t.setVertexAttribPointers(u,e,i);for(const t of o)t&&(t.enableAttributes(u,e),t.bind(),t.setVertexAttribPointers(u,e,i));n&&n.bind(),l.currentNumAttributes=s}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function mr(e,t,r,n,i,o,a){var s,l=e.context,u=l.gl,c=r.fbo;c&&(e.prepareDrawTile(),s=e.useProgram("hillshade"),l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,c.colorAttachment.get()),c=((e,t,r,n)=>{var i=r.paint.get("hillshade-shadow-color"),o=r.paint.get("hillshade-highlight-color"),a=r.paint.get("hillshade-accent-color");let s=r.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===r.paint.get("hillshade-illumination-anchor")&&(s-=e.transform.angle);var l=!e.options.moving;return{u_matrix:n||e.transform.calculateProjMatrix(t.tileID.toUnwrapped(),l),u_image:0,u_latrange:(n=t.tileID,e=Math.pow(2,n.canonical.z),n=n.canonical.y,[new se.MercatorCoordinate(0,n/e).toLngLat().lat,new se.MercatorCoordinate(0,(n+1)/e).toLngLat().lat]),u_light:[r.paint.get("hillshade-exaggeration"),s],u_shadow:i,u_highlight:o,u_accent:a}})(e,r,n,e.terrain?t.projMatrix:null),{tileBoundsBuffer:t,tileBoundsIndexBuffer:e,tileBoundsSegments:r}=(e.prepareDrawProgram(l,s,t.toUnwrapped()),e.getTileBoundsBuffers(r)),s.draw(l,u.TRIANGLES,i,o,a,se.CullFaceMode.disabled,c,n.id,t,e,r))}function gr(e,t,r){var n,i;t.needsDEMTextureUpload&&(i=(n=e.context).gl,n.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||e.getTileTexture(r.stride),e=r.getPixels(),t.demTexture?t.demTexture.update(e,{premultiply:!1}):t.demTexture=new se.Texture(n,e,i.RGBA,{premultiply:!1}),t.needsDEMTextureUpload=!1)}const yr=e=>({u_matrix:new se.UniformMatrix4f(e),u_image0:new se.Uniform1i(e),u_skirt_height:new se.Uniform1f(e)}),vr=(e,t)=>({u_matrix:e,u_image0:0,u_skirt_height:t}),_r=(e,t,r,n,i,o,a,s,l,u,c,h,f,d,p)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(n),u_merc_matrix:r,u_zoom_transition:i,u_merc_center:o,u_image0:0,u_frustum_tl:a,u_frustum_tr:s,u_frustum_br:l,u_frustum_bl:u,u_globe_pos:c,u_globe_radius:h,u_viewport:f,u_grid_matrix:p?Float32Array.from(p):new Float32Array(9),u_skirt_height:d});function xr(e,t){return null!=e&&null!=t&&e.hasData()&&t.hasData()&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const U=new class{constructor(){this.operations={}}newMorphing(e,t,r,n,i){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==r.tileID.key&&(t.queued=r)}else this.operations[e]={startTime:n,phase:0,duration:i,from:t,to:r,queued:null}}getMorphValuesForProxy(e){return e in this.operations?{from:(e=this.operations[e]).from,to:e.to,phase:e.phase}:null}update(e){for(const r in this.operations){var t=this.operations[r];for(t.phase=(e-t.startTime)/t.duration;1<=t.phase||!this._validOp(t);)if(!this._nextOp(t,e)){delete this.operations[r];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},br={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function wr(e){return 6*Math.pow(1.5,22-e)}function Er(e,t){var r=1<<e.z;return!t&&(0===e.x||e.x===r-1)||0===e.y||e.y===r-1}const Tr=e=>({u_matrix:e});function Sr(e,t,r,n,i){var o,a;return 0<i?(o=((a=se.exported.now())-e.timeAdded)/i,a=t?(a-t.timeAdded)/i:-1,i=r.getSource(),r=n.coveringZoomLevel({tileSize:i.tileSize,roundZoom:i.roundZoom}),i=(n=!t||Math.abs(t.tileID.overscaledZ-r)>Math.abs(e.tileID.overscaledZ-r))&&e.refreshedUponExpiration?1:se.clamp(n?o:1-a,0,1),e.refreshedUponExpiration&&1<=o&&(e.refreshedUponExpiration=!1),t?{opacity:1,mix:1-i}:{opacity:i,mix:0}):{opacity:1,mix:0}}class Mr extends se.SourceCache{constructor(e){var t={type:"raster-dem",maxzoom:e.transform.maxZoom},r=new i(c(),null),t=et("mock-dem",t,r,e.style);super("mock-dem",t,!1),t.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,t){e.state="loaded",t(null)}}class kr extends se.SourceCache{constructor(e){var t=et("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new i(c(),null),e.style);super("proxy",t,!1),t.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,e,t){if(!r.freezeTileCoverage){var n=(this.transform=r).coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((e,t)=>{if(e[t.key]="",!this._tiles[t.key]){const e=new se.Tile(t,this._source.tileSize*t.overscaleFactor(),r.tileZoom);e.state="loaded",this._tiles[t.key]=e}return e},{});for(const se in this._tiles)se in n||(this.freeFBO(se),this._tiles[se].unloadVectorData(),delete this._tiles[se])}}freeFBO(e){var t=this.proxyCachedFBO[e];void 0!==t&&(t=Object.values(t),this.renderCachePool.push(...t),delete this.proxyCachedFBO[e])}deallocRenderCache(){this.renderCache.forEach(e=>e.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Cr extends se.OverscaledTileID{constructor(e,t,r){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=r}}class Ar extends se.Elevation{constructor(e,t){super(),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};var[r,n,i]=function(){const r=new se.StructArrayLayout2i4,n=new se.StructArrayLayout3ui6,i=131,o=(r.reserve(17161),n.reserve(33800),se.EXTENT/128),a=se.EXTENT+o/2,s=a+o;for(let t=-o;t<s;t+=o)for(let e=-o;e<s;e+=o){const i=e<0||e>a||t<0||t>a?24575:0,o=se.clamp(Math.round(e),0,se.EXTENT),s=se.clamp(Math.round(t),0,se.EXTENT);r.emplaceBack(o+i,s)}const l=(e,t)=>{t=t*i+e;n.emplaceBack(t+1,t,t+i),n.emplaceBack(t+i,t+i+1,t+1)};for(let t=1;t<129;t++)for(let e=1;e<129;e++)l(e,t);return[0,129].forEach(t=>{for(let e=0;e<130;e++)l(e,t),l(t,e)}),[r,n,32768]}(),o=e.context,n=(this.gridBuffer=o.createVertexBuffer(r,se.posAttributes.members),this.gridIndexBuffer=o.createIndexBuffer(n),this.gridSegments=se.SegmentVector.simpleSegment(0,0,r.length,n.length),this.gridNoSkirtSegments=se.SegmentVector.simpleSegment(0,0,r.length,i),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new kr(t.map),this.orthoMatrix=se.create(),se.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,se.EXTENT,0,se.EXTENT,0,1),o.gl);this._overlapStencilMode=new se.StencilMode({func:n.GEQUAL,mask:255},0,255,n.KEEP,n.KEEP,n.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=t,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Mr(t.map)}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),e.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=e,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(e,t,r){var n;e&&e.terrain?(this._style!==e&&(this.style=e),this.enabled=!0,n=e.terrain.properties,this.sourceCache=0===e.terrain.drapeRenderMode?this._mockSourceCache:e._getSourceCache(n.get("source")),this._exaggeration=n.get("exaggeration"),e=()=>{this.sourceCache.used&&se.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);var e=this.getScaledDemTileSize();this.sourceCache.update(t,e,!0),this.resetTileLookupCache(this.sourceCache.id)},this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,e(),this._initializing=!0),e(),t.updateElevation(!0,r),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(t),this._emptyDEMTextureDirty=!0):this._disable()}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){var e=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==e.efficiency&&se.warnOnce(`Terrain render cache efficiency is not optimal (${e.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${e.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._sourceCaches)this._style._sourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(e=>e.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){var e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(e){if(this.enabled){this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,l=this.painter.transform;this._initializing&&(this._initializing=0===l._centerAltitude&&-1===this.getAtPointOrZero(se.MercatorCoordinate.fromLngLat(l.center),-1),this._emptyDEMTextureDirty=!this._initializing);var t=this.proxyCoords=s.getIds().map(e=>{e=s.getTileByID(e).tileID;return e.projMatrix=l.calculateProjMatrix(e.toUnwrapped()),e});{var r=t;var n=this.painter;const u=n.transform.pointCoordinate(n.transform.getCameraPoint()),c=new se.pointGeometry(u.x,u.y);r.sort((e,t)=>{var r;return t.overscaledZ-e.overscaledZ?t.overscaledZ-e.overscaledZ:(r=new se.pointGeometry(e.canonical.x+(1<<e.canonical.z)*e.wrap,e.canonical.y),t=new se.pointGeometry(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),(e=c.mult(1<<e.canonical.z)).x-=.5,e.y-=.5,e.distSqr(r)-e.distSqr(t))})}this._previousZoom=l.zoom;var i=this.proxyToSource||{},o=(this.proxyToSource={},t.forEach(e=>{this.proxyToSource[e.key]={}}),this.terrainTileForTile={},this._style._sourceCaches);for(const se in o){const s=o[se];if(s.used&&(s!==this.sourceCache&&this.resetTileLookupCache(s.id),this._setupProxiedCoordsForOrtho(s,e[se],i),!s.usedForTerrain)){const l=e[se];s.getSource().reparseOverscaled&&this._assignTerrainTiles(l)}}this.proxiedCoords[s.id]=t.map(e=>new Cr(e,e.key,this.orthoMatrix)),this._assignTerrainTiles(t),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(i),this.renderingToTexture=!1,this._updateTimestamp=se.exported.now();var a={};this._visibleDemTiles=[];for(const se of this.proxyCoords){const e=this.terrainTileForTile[se.key];if(e){const s=e.tileID.key;s in a||(this._visibleDemTiles.push(e),a[s]=s)}}}}_assignTerrainTiles(e){this._initializing||e.forEach(e=>{var t;this.terrainTileForTile[e.key]||(t=this._findTileCoveringTileID(e,this.sourceCache))&&(this.terrainTileForTile[e.key]=t)})}_prepareDEMTextures(){var e=this.painter.context,t=e.gl;for(const i in this.terrainTileForTile){var r=this.terrainTileForTile[i],n=r.dem;!n||r.demTexture&&!r.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),gr(this.painter,r,n))}}_prepareDemTileUniforms(e,t,r,n){return!(!t||null==t.demTexture)&&(e=e.tileID.canonical,t=Math.pow(2,t.tileID.canonical.z-e.z),r["u_dem_tl"+(n=n||"")]=[e.x*t%1,e.y*t%1],r["u_dem_scale"+n]=t,!0)}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){var e,t=this.painter.context,r=t.gl;return this._emptyDepthBufferTexture||(e=new se.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255)),this._emptyDepthBufferTexture=new se.Texture(t,e,r.RGBA,{premultiply:!1})),this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;var e=this._visibleDemTiles.reduce((e,t)=>{return t.dem?(0<(t=t.dem.tree.minimums[0])&&r++,e+t):e},0);return r?e/r:0}_updateEmptyDEMTexture(){var e=this.painter.context,t=e.gl,r=(e.activeTexture.set(t.TEXTURE2),this._getLoadedAreaMinimum()),r=new se.RGBAImage({width:1,height:1},new Uint8Array(se.DEMData.pack(r,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let n=this._emptyDEMTexture;return n?n.update(r,{premultiply:!1}):n=this._emptyDEMTexture=new se.Texture(e,r,t.RGBA,{premultiply:!1}),n}setupElevationDraw(e,t,r){var n=this.painter.context,i=n.gl,o=(o=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:se.DEMData.getUnpackVector(o),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});o.u_dem_size=this.sourceCache.getSource().tileSize,o.u_exaggeration=this.exaggeration();let a=null,s=null,l=1;if(r&&r.morphing&&this._useVertexMorphing){const se=r.morphing.srcDemTile,t=r.morphing.dstDemTile;l=r.morphing.phase,se&&t&&(this._prepareDemTileUniforms(e,se,o,"_prev")&&(s=se),this._prepareDemTileUniforms(e,t,o)&&(a=t))}if(s&&a?(n.activeTexture.set(i.TEXTURE2),a.demTexture.bind(i.NEAREST,i.CLAMP_TO_EDGE,i.NEAREST),n.activeTexture.set(i.TEXTURE4),s.demTexture.bind(i.NEAREST,i.CLAMP_TO_EDGE,i.NEAREST),o.u_dem_lerp=l):(a=this.terrainTileForTile[e.tileID.key],n.activeTexture.set(i.TEXTURE2),(this._prepareDemTileUniforms(e,a,o)?a.demTexture:this.emptyDEMTexture).bind(i.NEAREST,i.CLAMP_TO_EDGE)),n.activeTexture.set(i.TEXTURE3),r&&r.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(i.NEAREST,i.CLAMP_TO_EDGE),this._depthFBO&&(o.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(i.NEAREST,i.CLAMP_TO_EDGE),o.u_depth_size_inv=[1,1]),r&&r.useMeterToDem&&a){const e=(1<<a.tileID.canonical.z)*se.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;o.u_meter_to_dem=e}if(r&&r.labelPlaneMatrixInv&&(o.u_label_plane_matrix_inv=r.labelPlaneMatrixInv),t.setTerrainUniformValues(n,o),"globe"===this.painter.transform.projection.name){const se=this.globeUniformValues(this.painter.transform,e.tileID.canonical,r&&r.useDenormalizedUpVectorScale);t.setGlobeUniformValues(n,se)}}globeUniformValues(e,t,r){var n=e.projection;return{u_tile_tl_up:n.upVector(t,0,0),u_tile_tr_up:n.upVector(t,se.EXTENT,0),u_tile_br_up:n.upVector(t,se.EXTENT,se.EXTENT),u_tile_bl_up:n.upVector(t,0,se.EXTENT),u_tile_up_scale:r?se.globeMetersToEcef(1):n.upVectorScale(t,e.center.lat,e.worldSize).metersToTile}}renderToBackBuffer(e){var t=this.painter,r=this.painter.context;if(0!==e.length){r.bindFramebuffer.set(null),r.viewport.set([0,0,t.width,t.height]),t.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1;var d=t,p=this,m=this.proxySourceCache,g=e,y=this._updateTimestamp;if("globe"===d.transform.projection.name){var v=d,_=p,x=m,b=g,w=y;const E=v.context,T=E.gl;let h,f;const n=v.options.showTerrainWireframe?2:0,i=v.transform,o=se.globeUseCustomAntiAliasing(v,E,i),S=(e,t)=>{var r;f!==e&&(r=[br[e],"PROJECTION_GLOBE_VIEW"],o&&r.push("CUSTOM_ANTIALIASING"),t&&r.push(br[n]),h=v.useProgram("globeRaster",null,r),f=e)},M=v.colorModeForRenderPass(),k=new se.DepthMode(T.LEQUAL,se.DepthMode.ReadWrite,v.depthRangeFor3D),C=(U.update(w),se.calculateGlobeMercatorMatrix(i)),A=[se.mercatorXfromLng(i.center.lng),se.mercatorYfromLat(i.center.lat)],a=n?[!1,!0]:[!1],I=v.globeSharedBuffers,L=[i.width*se.exported.devicePixelRatio,i.height*se.exported.devicePixelRatio],P=Float32Array.from(i.globeMatrix),z={useDenormalizedUpVectorScale:!0};if(a.forEach(e=>{var t=v.transform,r=wr(t.zoom)*_.exaggeration(),n=(f=-1,e?T.LINES:T.TRIANGLES);for(const f of b){const b=x.getTile(f),l=se.StencilMode.disabled,u=_.prevTerrainTileForTile[f.key],c=_.terrainTileForTile[f.key];xr(u,c)&&U.newMorphing(f.key,u,c,w,250),E.activeTexture.set(T.TEXTURE0),b.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE);var i=U.getMorphValuesForProxy(f.key),o=i?1:0,i=(i&&se.extend$1(z,{morphing:{srcDemTile:i.from,dstDemTile:i.to,phase:se.easeCubicInOut(i.phase)}}),se.tileCornersToBounds(f.canonical)),a=se.getLatitudinalLod(i.getCenter().lat),i=se.getGridMatrix(f.canonical,i,a,t.worldSize/t._pixelsPerMercatorPixel),s=se.globeNormalizeECEF(se.globeTileBounds(f.canonical)),s=_r(t.projMatrix,P,C,s,se.globeToMercatorTransition(t.zoom),A,t.frustumCorners.TL,t.frustumCorners.TR,t.frustumCorners.BR,t.frustumCorners.BL,t.globeCenterInViewSpace,t.globeRadius,L,r,i);if(S(o,e),_.setupElevationDraw(b,h,z),v.prepareDrawProgram(E,h,f.toUnwrapped()),I){const[_,x,b]=e?I.getWirefameBuffers(v.context,a):I.getGridBuffers(a,0!=r);h.draw(E,n,k,l,M,se.CullFaceMode.backCCW,s,"globe_raster",_,x,b)}}}),I){const w=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];o&&w.push("CUSTOM_ANTIALIASING"),h=v.useProgram("globeRaster",null,w);for(const w of b){const{x:b,y:e,z:n}=w.canonical,o=0===e,S=e===(1<<n)-1,[C,a,P,s]=I.getPoleBuffers(n);if(s&&(o||S)){const e=x.getTile(w);E.activeTexture.set(T.TEXTURE0),e.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE);let r=se.globePoleMatrixForTile(n,b,i);const l=se.globeNormalizeECEF(se.globeTileBounds(w.canonical)),u=(e,t)=>e.draw(E,T.TRIANGLES,k,se.StencilMode.disabled,M,se.CullFaceMode.disabled,_r(i.projMatrix,r,r,l,0,A,i.frustumCorners.TL,i.frustumCorners.TR,i.frustumCorners.BR,i.frustumCorners.BL,i.globeCenterInViewSpace,i.globeRadius,L,0),"globe_pole_raster",t,P,s);_.setupElevationDraw(e,h,z),v.prepareDrawProgram(E,h,w.toUnwrapped()),o&&u(h,C),S&&(r=se.scale(se.create(),r,[1,-1,1]),u(h,a))}}}}else{const f=d.context,D=f.gl;let c,h;const O=d.options.showTerrainWireframe?2:0,B=(e,t)=>{var r;h!==e&&(r=[br[e]],t&&r.push(br[O]),c=d.useProgram("terrainRaster",null,r),h=e)},N=d.colorModeForRenderPass(),j=new se.DepthMode(D.LEQUAL,se.DepthMode.ReadWrite,d.depthRangeFor3D),R=(U.update(y),d.transform),F=wr(R.zoom)*p.exaggeration();(O?[!1,!0]:[!1]).forEach(t=>{h=-1;var r=t?D.LINES:D.TRIANGLES,[n,i]=t?p.getWirefameBuffer():[p.gridIndexBuffer,p.gridSegments];for(const h of g){const g=m.getTile(h),s=se.StencilMode.disabled,l=p.prevTerrainTileForTile[h.key],u=p.terrainTileForTile[h.key];xr(l,u)&&U.newMorphing(h.key,l,u,y,250),f.activeTexture.set(D.TEXTURE0),g.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST);var o=U.getMorphValuesForProxy(h.key),a=o?1:0;let e;o&&(e={morphing:{srcDemTile:o.from,dstDemTile:o.to,phase:se.easeCubicInOut(o.phase)}});o=vr(h.projMatrix,Er(h.canonical,R.renderWorldCopies)?F/10:F);B(a,t),p.setupElevationDraw(g,c,e),d.prepareDrawProgram(f,c,h.toUnwrapped()),c.draw(f,r,j,s,N,se.CullFaceMode.backCCW,o,"terrain_raster",p.gridBuffer,n,i)}})}this.renderingToTexture=!0,t.gpuTimingDeferredRenderEnd(),e.splice(0,e.length)}}renderBatch(r){if(0===this._drapedRenderBatches.length)return r+1;this.renderingToTexture=!0;const n=this.painter,i=this.painter.context,o=this.proxySourceCache,a=this.proxiedCoords[o.id],s=this._drapedRenderBatches.shift(),e=[],l=n.style.order;let u=0;for(const c of a){const a=o.getTileByID(c.proxyTileKey),t=o.proxyCachedFBO[c.key]?o.proxyCachedFBO[c.key][r]:void 0,h=void 0!==t?o.renderCache[t]:this.pool[u++],f=void 0!==t;if(a.texture=h.tex,f&&!h.dirty)e.push(a.tileID);else{let t;i.bindFramebuffer.set(h.fb.framebuffer),this.renderedToTile=!1,h.dirty&&(i.clear({color:se.Color.transparent,stencil:0}),h.dirty=!1);for(let e=s.start;e<=s.end;++e){const r=n.style._layers[l[e]];if(!r.isHidden(n.transform.zoom)){const o=n.style._getLayerSourceCache(r),a=o?this.proxyToSource[c.key][o.id]:[c];if(a){const s=a;i.viewport.set([0,0,h.fb.width,h.fb.height]),t!==(o?o.id:null)&&(this._setupStencil(h,a,r,o),t=o?o.id:null),n.renderLayer(n,o,r,s)}}}this.renderedToTile?(h.dirty=!0,e.push(a.tileID)):f||--u,5===u&&(u=0,this.renderToBackBuffer(e))}}return this.renderToBackBuffer(e),this.renderingToTexture=!1,i.bindFramebuffer.set(null),i.viewport.set([0,0,n.width,n.height]),s.end+1}postRender(){}renderCacheEfficiency(t){const r=t.order.length;if(0===r)return{efficiency:100};let n,i=0,o=0,a=!1;for(let e=0;e<r;++e){const r=t._layers[t.order[e]];this._style.isLayerDraped(r)?(a&&++i,++o):a||(a=!0,n=r.id)}return 0===o?{efficiency:100}:{efficiency:100*(1-i/o),firstUndrapedLayer:n}}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(e=>e.dem).forEach(e=>{t=Math.min(t,e.dem.tree.minimums[0])}),0===t?t:(t-30)*this._exaggeration}raycast(a,s,l){if(this._visibleDemTiles){const e=this._visibleDemTiles.filter(e=>e.dem).map(e=>{var t=e.tileID,r=1<<t.overscaledZ,{x:t,y:n}=t.canonical,i=t/r,t=(t+1)/r,o=n/r,n=(n+1)/r;return{minx:i,miny:o,maxx:t,maxy:n,t:e.dem.tree.raycastRoot(i,o,t,n,a,s,l),tile:e}});e.sort((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE));for(const t of e){if(null==t.t)return null;const e=t.tile.dem.tree.raycast(t.minx,t.miny,t.maxx,t.maxy,a,s,l);if(null!=e)return e}}return null}_createFBO(){var e=this.painter.context,t=e.gl,r=this.drapeBufferSize,n=(e.activeTexture.set(t.TEXTURE0),new se.Texture(e,{width:r[0],height:r[1],data:null},t.RGBA)),i=(n.bind(t.LINEAR,t.CLAMP_TO_EDGE),e.createFramebuffer(r[0],r[1],!1));return i.colorAttachment.set(n.texture),i.depthAttachment=new $e(e,i.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=e.createRenderbuffer(e.gl.DEPTH_STENCIL,r[0],r[1]),this._stencilRef=0,i.depthAttachment.set(this._sharedDepthStencil),e.clear({stencil:0})):i.depthAttachment.set(this._sharedDepthStencil),e.extTextureFilterAnisotropic&&!e.extTextureFilterAnisotropicForceOff&&t.texParameterf(t.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:i,tex:n,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const e in this._style._sourceCaches)if(this._style._sourceCaches[e].hasTransition())return!0;return this._style.order.some(e=>{var e=this._style._layers[e],t=e.isHidden(this.painter.transform.zoom);return"custom"===e.type?!t&&e.shouldRedrape():!t&&e.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const se of this._style._getSources())if(se instanceof Je){t=!0;break}if(t){var r={};for(let e=0;e<this._style.order.length;++e){var n=this._style._layers[this._style.order[e]],i=this._style._getLayerSourceCache(n);if(i&&!r[i.id]&&!n.isHidden(this.painter.transform.zoom)&&"line"===n.type&&n.widthExpression()instanceof se.ZoomDependentExpression){r[i.id]=!0;for(const se of this.proxyCoords){const t=this.proxyToSource[se.key][i.id];if(t)for(const se of t)this._clearRenderCacheForTile(i.id,se)}}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const o in this._style._sourceCaches)if(this._style._sourceCaches[o]._source instanceof a){t=!0;break}if(t){const o={};for(let e=0;e<this._style.order.length;++e){var r=this._style._layers[this._style.order[e]],n=this._style._getLayerSourceCache(r);if(n&&!o[n.id]&&(!r.isHidden(this.painter.transform.zoom)&&"raster"===r.type)){var i=r.paint.get("raster-fade-duration");for(const t of this.proxyCoords){const o=this.proxyToSource[t.key][n.id];if(o)for(const t of o){const o=Sr(n.getTile(t),n.findLoadedParent(t,0),n,this.painter.transform,i);1===o.opacity&&0===o.mix||this._clearRenderCacheForTile(n.id,t)}}}}}}_setupDrapedRenderBatches(){const n=this._style.order,i=n.length;if(0!==i){var o=[];let e,t=0,r=this._style._layers[n[t]];for(;!this._style.isLayerDraped(r)&&r.isHidden(this.painter.transform.zoom)&&++t<i;)r=this._style._layers[n[t]];for(;t<i;++t){const i=this._style._layers[n[t]];i.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(i)?void 0===e&&(e=t):void 0!==e&&(o.push({start:e,end:t-1}),e=void 0))}void 0!==e&&o.push({start:e,end:t-1}),this._drapedRenderBatches=o}}_setupRenderCache(r){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){const r=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let e=0;e<r.length;++e){const i=Object.values(r[e]);t.renderCachePool.push(...i)}}}else{this._clearRasterLayersFromRenderCache();const o=this.proxyCoords,i=this._tilesDirty;for(let e=o.length-1;0<=e;e--){var n=o[e];if(t.getTileByID(n.key),void 0!==t.proxyCachedFBO[n.key]){const o=r[n.key],a=this.proxyToSource[n.key];let e=0;for(const r in a){const t=a[r],s=o[r];if(!s||s.length!==t.length||t.some((e,t)=>e!==s[t]||i[r]&&i[r].hasOwnProperty(e.key))){e=-1;break}++e}for(const r in t.proxyCachedFBO[n.key])t.renderCache[t.proxyCachedFBO[n.key][r]].dirty=e<0||e!==Object.values(o).length}}const a=[...this._drapedRenderBatches];a.sort((e,t)=>t.end-t.start-(e.end-e.start));for(const r of a)for(const i of o)if(!t.proxyCachedFBO[i.key]){let e=t.renderCachePool.pop();void 0===e&&t.renderCache.length<50&&(e=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==e&&(t.proxyCachedFBO[i.key]={},t.proxyCachedFBO[i.key][r.start]=e,t.renderCache[e].dirty=!0)}this._tilesDirty={}}}_setupStencil(e,t,r,n){if(n&&this._sourceTilesOverlap[n.id]){var n=this.painter.context,i=n.gl;if(t.length<=1)this._overlapStencilType=!1;else{let e;if(r.isTileClipped())e=t.length,this._overlapStencilMode.test={func:i.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);e=1,this._overlapStencilMode.test={func:i.GREATER,mask:255},this._overlapStencilType="Mask"}255<this._stencilRef+e&&(n.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=e,this._overlapStencilMode.ref=this._stencilRef,r.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}}else this._overlapStencilType&&(this._overlapStencilType=!1)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):se.StencilMode.disabled}_renderTileClippingMasks(e,t){var r=this.painter,n=this.painter.context,i=n.gl,o=(r._tileClippingMaskIDs={},n.setColorMode(se.ColorMode.disabled),n.setDepthMode(se.DepthMode.disabled),r.useProgram("clippingMask"));for(const a of e){const e=r._tileClippingMaskIDs[a.key]=--t;o.draw(n,i.TRIANGLES,se.DepthMode.disabled,new se.StencilMode({func:i.ALWAYS,mask:0},e,255,i.KEEP,i.KEEP,i.REPLACE),se.ColorMode.disabled,se.CullFaceMode.disabled,Tr(a.projMatrix),"$clipping",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments)}}pointCoordinate(e){var t,r,n=this.painter.transform;return!(e.x<0||e.x>n.width||e.y<0||e.y>n.height)&&(e=[e.x,e.y,1,1],se.transformMat4$1(e,e,n.pixelMatrixInverse),se.scale$1(e,e,1/e[3]),e[0]/=n.worldSize,e[1]/=n.worldSize,t=n._camera.position,n=se.mercatorZfromAltitude(1,n.center.lat),t=[t[0],t[1],t[2]/n,0],e=se.subtract([],e.slice(0,3),t),se.normalize(e,e),null!==(r=this.raycast(t,e,this._exaggeration))&&r)?(se.scaleAndAdd(t,t,e,r),t[3]=t[2],t[2]*=n,t):null}drawDepth(){const e=this.painter,t=e.context,r=this.proxySourceCache,n=Math.ceil(e.width),i=Math.ceil(e.height);if(!this._depthFBO||this._depthFBO.width===n&&this._depthFBO.height===i||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const e=t.gl,r=t.createFramebuffer(n,i,!0);t.activeTexture.set(e.TEXTURE0);var o=new se.Texture(t,{width:n,height:i,data:null},e.RGBA),a=(o.bind(e.NEAREST,e.CLAMP_TO_EDGE),r.colorAttachment.set(o.texture),t.createRenderbuffer(t.gl.DEPTH_COMPONENT16,n,i));r.depthAttachment.set(a),this._depthFBO=r,this._depthTexture=o}t.bindFramebuffer.set(this._depthFBO.framebuffer),t.viewport.set([0,0,n,i]);var s=e,l=this,u=r,c=this.proxyCoords;if("globe"!==s.transform.projection.name){var h=s.context,f=h.gl,d=(h.clear({depth:1}),s.useProgram("terrainDepth")),p=new se.DepthMode(f.LESS,se.DepthMode.ReadWrite,s.depthRangeFor3D);for(const s of c){const c=u.getTile(s),m=vr(s.projMatrix,0);l.setupElevationDraw(c,d),d.draw(h,f.TRIANGLES,p,se.StencilMode.disabled,se.ColorMode.unblended,se.CullFaceMode.backCCW,m,"terrain_depth",l.gridBuffer,l.gridIndexBuffer,l.gridNoSkirtSegments)}}}_setupProxiedCoordsForOrtho(t,r,n){if(t.getSource()instanceof E)return this._setupProxiedCoordsForImageSource(t,r,n);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const i=this.proxiedCoords[t.id]=[],o=this.proxyCoords;for(let e=0;e<o.length;e++){const a=o[e],u=this._findTileCoveringTileID(a,t);if(u){const r=this._createProxiedId(a,u,n[a.key]&&n[a.key][t.id]);i.push(r),this.proxyToSource[a.key][t.id]=[r]}}let a=!1;for(let e=0;e<r.length;e++){var s=t.getTile(r[e]);if(s&&s.hasData()){var l=this._findTileCoveringTileID(s.tileID,this.proxySourceCache);if(l&&l.tileID.canonical.z!==s.tileID.canonical.z){const r=this.proxyToSource[l.tileID.key][t.id],o=this._createProxiedId(l.tileID,s,n[l.tileID.key]&&n[l.tileID.key][t.id]);r?r.splice(r.length-1,0,o):this.proxyToSource[l.tileID.key][t.id]=[o],i.push(o),a=!0}}}this._sourceTilesOverlap[t.id]=a}_setupProxiedCoordsForImageSource(t,r,n){if(t.getSource().loaded()){const i=this.proxiedCoords[t.id]=[],o=this.proxyCoords,a=t.getSource(),s=new se.pointGeometry(a.tileID.x,a.tileID.y)._div(1<<a.tileID.z),l=a.coordinates.map(se.MercatorCoordinate.fromLngLat).reduce((e,t)=>(e.min.x=Math.min(e.min.x,t.x-s.x),e.min.y=Math.min(e.min.y,t.y-s.y),e.max.x=Math.max(e.max.x,t.x-s.x),e.max.y=Math.max(e.max.y,t.y-s.y),e),{min:new se.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new se.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),u=(e,t)=>{var r=e.wrap+e.canonical.x/(1<<e.canonical.z),n=e.canonical.y/(1<<e.canonical.z),e=se.EXTENT/(1<<e.canonical.z),i=t.wrap+t.canonical.x/(1<<t.canonical.z),t=t.canonical.y/(1<<t.canonical.z);return r+e<i+l.min.x||r>i+l.max.x||n+e<t+l.min.y||n>t+l.max.y};for(let e=0;e<o.length;e++){const a=o[e];for(let e=0;e<r.length;e++){const o=t.getTile(r[e]);if(o&&o.hasData()&&!u(a,o.tileID)){const s=this._createProxiedId(a,o,n[a.key]&&n[a.key][t.id]),l=this.proxyToSource[a.key][t.id];l?l.push(s):this.proxyToSource[a.key][t.id]=[s],i.push(s)}}}}}_createProxiedId(n,i,o){let a=this.orthoMatrix;if(o){const se=o.find(e=>e.key===i.tileID.key);if(se)return se}if(i.tileID.key!==n.key){const o=n.canonical.z-i.tileID.canonical.z;let e,t,r;a=se.create();var s=i.tileID.wrap-n.wrap<<n.overscaledZ;r=0<o?(e=se.EXTENT>>o,t=e*((i.tileID.canonical.x<<o)-n.canonical.x+s),e*((i.tileID.canonical.y<<o)-n.canonical.y)):(e=se.EXTENT<<-o,t=se.EXTENT*(i.tileID.canonical.x-(n.canonical.x+s<<-o)),se.EXTENT*(i.tileID.canonical.y-(n.canonical.y<<-o))),se.ortho(a,0,e,0,e,0,1),se.translate(a,a,[t,r,0])}return new Cr(i.tileID,n.key,a)}_findTileCoveringTileID(e,t){let r=t.getTile(e);if(r&&r.hasData())return r;const n=this._findCoveringTileCache[t.id],i=n[e.key];if((r=i?t.getTileByID(i):null)&&r.hasData()||null===i)return r;let o=r?r.tileID:e,a=o.overscaledZ;const s=t.getSource().minzoom,l=[];if(!i){const n=t.getSource().maxzoom;if(e.canonical.z>=n){const r=e.canonical.z-n;t.getSource().reparseOverscaled?(a=Math.max(e.canonical.z+2,t.transform.tileZoom),o=new se.OverscaledTileID(a,e.wrap,n,e.canonical.x>>r,e.canonical.y>>r)):0!=r&&(a=n,o=new se.OverscaledTileID(a,e.wrap,n,e.canonical.x>>r,e.canonical.y>>r))}o.key!==e.key&&(l.push(o.key),r=t.getTile(o))}var u=t=>{l.forEach(e=>{n[e]=t}),l.length=0};for(--a;a>=s&&(!r||!r.hasData());a--){r&&u(r.tileID.key);const se=o.calculateScaledKey(a);if((r=t.getTileByID(se))&&r.hasData())break;const e=n[se];if(null===e)break;void 0===e?l.push(se):r=t.getTileByID(e)}return u(r?r.tileID.key:null),r&&r.hasData()?r:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,t){let r=this._tilesDirty[e];(r=r||(this._tilesDirty[e]={}))[t.key]=!0}getWirefameBuffer(){var e;return this.wireframeSegments||(e=function(){let r=0;var n=new se.StructArrayLayout2ui4;for(let t=1;t<129;t++){for(let e=1;e<129;e++)r=131*t+e,n.emplaceBack(r,r+1),n.emplaceBack(r,r+131),n.emplaceBack(r+1,r+131),128===t&&n.emplaceBack(r+131,r+131+1);n.emplaceBack(r+1,r+1+131)}return n}(),this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(e),this.wireframeSegments=se.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,e.length)),[this.wireframeIndexBuffer,this.wireframeSegments]}}class Ir{static cacheKey(e,t,r,n){let i=""+t+(n?n.cacheKey:"");for(const t of r)e.usedDefines.includes(t)&&(i+="/"+t);return i}constructor(e,t,r,n,i,o){var a=e.gl,s=(this.program=a.createProgram(),function(t){var r,n=[];for(let e=0;e<t.length;e++)null!==t[e]&&(r=t[e].split(" "),n.push(r.pop()));return n}(r.staticAttributes)),l=n?n.getBinderAttributes():[],u=s.concat(l);let c=n?n.defines():[];c=c.concat(o.map(e=>"#define "+e));s=e.isWebGL2?"#version 300 es\n":"",l=s+c.concat(e.extStandardDerivatives&&0===s.length?"#extension GL_OES_standard_derivatives : enable\n".concat(fr):fr,fr,hr,cr.fragmentSource,ur.fragmentSource,r.fragmentSource).join("\n"),s+=c.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",hr,cr.vertexSource,ur.vertexSource,lr.vertexSource,r.vertexSource).join("\n"),r=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(r,l),a.compileShader(r),a.attachShader(this.program,r);var l=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(l,s),a.compileShader(l),a.attachShader(this.program,l),this.attributes={},this.numAttributes=u.length;for(let e=0;e<this.numAttributes;e++)u[e]&&(a.bindAttribLocation(this.program,e,u[e]),this.attributes[u[e]]=e);a.linkProgram(this.program),a.deleteShader(l),a.deleteShader(r),this.fixedUniforms=i(e),this.binderUniforms=n?n.getUniforms(e):[],o.includes("TERRAIN")&&(this.terrainUniforms=(s=e,{u_dem:new se.Uniform1i(s),u_dem_prev:new se.Uniform1i(s),u_dem_unpack:new se.Uniform4f(s),u_dem_tl:new se.Uniform2f(s),u_dem_scale:new se.Uniform1f(s),u_dem_tl_prev:new se.Uniform2f(s),u_dem_scale_prev:new se.Uniform1f(s),u_dem_size:new se.Uniform1f(s),u_dem_lerp:new se.Uniform1f(s),u_exaggeration:new se.Uniform1f(s),u_depth:new se.Uniform1i(s),u_depth_size_inv:new se.Uniform2f(s),u_meter_to_dem:new se.Uniform1f(s),u_label_plane_matrix_inv:new se.UniformMatrix4f(s)})),o.includes("GLOBE")&&(this.globeUniforms=(l=e,{u_tile_tl_up:new se.Uniform3f(l),u_tile_tr_up:new se.Uniform3f(l),u_tile_br_up:new se.Uniform3f(l),u_tile_bl_up:new se.Uniform3f(l),u_tile_up_scale:new se.Uniform1f(l)})),o.includes("FOG")&&(this.fogUniforms=(r=e,{u_fog_matrix:new se.UniformMatrix4f(r),u_fog_range:new se.Uniform2f(r),u_fog_color:new se.Uniform4f(r),u_fog_horizon_blend:new se.Uniform1f(r),u_fog_temporal_offset:new se.Uniform1f(r),u_frustum_tl:new se.Uniform3f(r),u_frustum_tr:new se.Uniform3f(r),u_frustum_br:new se.Uniform3f(r),u_frustum_bl:new se.Uniform3f(r),u_globe_pos:new se.Uniform3f(r),u_globe_radius:new se.Uniform1f(r),u_globe_transition:new se.Uniform1f(r),u_is_globe:new se.Uniform1i(r),u_viewport:new se.Uniform2f(r)}))}}}setTerrainUniformValues(e,t){if(this.terrainUniforms){var r=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e]&&r[e].set(this.program,e,t[e])}}}setGlobeUniformValues(e,t){if(this.globeUniforms){var r=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e]&&r[e].set(this.program,e,t[e])}}}setFogUniformValues(e,t){if(this.fogUniforms){var r=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e].set(this.program,e,t[e])}}}draw(e,t,r,n,i,o,a,s,l,u,c,h,f,d,p){var m=e.gl;if(!this.failedToCreate){e.program.set(this.program),e.setDepthMode(r),e.setStencilMode(n),e.setColorMode(i),e.setCullFace(o);for(const e of Object.keys(this.fixedUniforms))this.fixedUniforms[e].set(this.program,e,a[e]);d&&d.setUniforms(this.program,e,this.binderUniforms,h,{zoom:f});var g={[m.LINES]:2,[m.TRIANGLES]:3,[m.LINE_STRIP]:1}[t];for(const r of c.get()){const n=r.vaos||(r.vaos={});(n[s]||(n[s]=new pr)).bind(e,this,l,d?d.getPaintVertexBuffers():[],u,r.vertexOffset,p||[]),m.drawElements(t,r.primitiveLength*g,m.UNSIGNED_SHORT,r.primitiveOffset*g*2)}}}}function Lr(e,t){var r=Math.pow(2,t.tileID.overscaledZ),n=t.tileSize*Math.pow(2,e.transform.tileZoom)/r,r=n*(t.tileID.canonical.x+t.tileID.wrap*r),n=n*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture.size,u_tile_units_to_pixels:1/I(t,1,e.transform.tileZoom),u_pixel_coord_upper:[r>>16,n>>16],u_pixel_coord_lower:[65535&r,65535&n]}}const Pr=se.create(),zr=(e,t,r,n,i,o,a,s,l,u,c)=>{var h=t.style.light,f=h.properties.get("position"),f=[f.x,f.y,f.z],d=se.create$1(),d=("viewport"===h.properties.get("anchor")&&(se.fromRotation(d,-t.transform.angle),se.transformMat3(f,f,d)),h.properties.get("color")),t=t.transform,e={u_matrix:e,u_lightpos:f,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[d.r,d.g,d.b],u_vertical_gradient:+r,u_opacity:n,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Pr,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:i,u_edge_radius:o};return"globe"===t.projection.name&&(e.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],e.u_zoom_transition=l,e.u_inv_rot_matrix=c,e.u_merc_center=u,e.u_up_dir=t.projection.upVector(new se.CanonicalTileID(0,0,0),u[0]*se.EXTENT,u[1]*se.EXTENT),e.u_height_lift=s),e},Dr=e=>({u_matrix:e}),Or=(e,t,r)=>se.extend(Dr(e),Lr(t,r)),Rr=(e,t,r,n)=>se.extend(Or(e,t,r),{u_world:n}),Fr=se.create(),Br=(e,t,r=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:r}),Nr=se.create();function jr(e,t){return 1/I(e,1,t.tileZoom)}function Ur(e,t,r,n){return e.translatePosMatrix(n||t.tileID.projMatrix,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}function Vr(e){e=e.paint.get("line-dasharray").value;return e.value||"constant"!==e.kind}const Gr=(e,t,r,n,i,o)=>{return{u_matrix:e,u_tl_parent:t,u_scale_parent:r,u_fade_t:n.mix,u_opacity:n.opacity*i.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:i.paint.get("raster-brightness-min"),u_brightness_high:i.paint.get("raster-brightness-max"),u_saturation_factor:0<(e=i.paint.get("raster-saturation"))?1-1/(1.001-e):-e,u_contrast_factor:0<(t=i.paint.get("raster-contrast"))?1/(1-t):1+t,u_spin_weights:(r=i.paint.get("raster-hue-rotate"),r*=Math.PI/180,n=Math.sin(r),[(2*(r=Math.cos(r))+1)/3,(-Math.sqrt(3)*n-r+1)/3,(Math.sqrt(3)*n-r+1)/3]),u_perspective_transform:o}};const Wr=se.create(),Zr=(e,t,r,n,i,o,a,s,l,u,c,h,f,d,p,m)=>{var g=i.transform,e={u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:g.cameraToCenterDistance,u_rotate_symbol:+r,u_aspect_ratio:g.width/g.height,u_fade_change:i.options.fadeDuration?i.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:a,u_coord_matrix:s,u_is_text:+l,u_pitch_with_map:+n,u_texsize:u,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Wr,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Wr,u_up_vector:[0,-1,0]};return"globe"===m.name&&(e.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],e.u_zoom_transition=h,e.u_inv_rot_matrix=d,e.u_merc_center=f,e.u_camera_forward=g._camera.forward(),e.u_ecef_origin=se.globeECEFOrigin(g.globeMatrix,c.toUnwrapped()),e.u_tile_matrix=Float32Array.from(g.globeMatrix),e.u_up_vector=p),e},qr=(e,t,r,n,i,o,a,s,l,u,c,h,f,d,p,m,g)=>se.extend(Zr(e,t,r,n,i,o,a,s,l,u,h,f,d,p,m,g),{u_gamma_scale:n?i.transform.cameraToCenterDistance*Math.cos(i.terrain?0:i.transform._pitch):1,u_device_pixel_ratio:se.exported.devicePixelRatio,u_is_halo:+c}),Hr={fillExtrusion:e=>({u_matrix:new se.UniformMatrix4f(e),u_lightpos:new se.Uniform3f(e),u_lightintensity:new se.Uniform1f(e),u_lightcolor:new se.Uniform3f(e),u_vertical_gradient:new se.Uniform1f(e),u_opacity:new se.Uniform1f(e),u_edge_radius:new se.Uniform1f(e),u_ao:new se.Uniform2f(e),u_tile_id:new se.Uniform3f(e),u_zoom_transition:new se.Uniform1f(e),u_inv_rot_matrix:new se.UniformMatrix4f(e),u_merc_center:new se.Uniform2f(e),u_up_dir:new se.Uniform3f(e),u_height_lift:new se.Uniform1f(e)}),fillExtrusionPattern:e=>({u_matrix:new se.UniformMatrix4f(e),u_lightpos:new se.Uniform3f(e),u_lightintensity:new se.Uniform1f(e),u_lightcolor:new se.Uniform3f(e),u_vertical_gradient:new se.Uniform1f(e),u_height_factor:new se.Uniform1f(e),u_edge_radius:new se.Uniform1f(e),u_ao:new se.Uniform2f(e),u_tile_id:new se.Uniform3f(e),u_zoom_transition:new se.Uniform1f(e),u_inv_rot_matrix:new se.UniformMatrix4f(e),u_merc_center:new se.Uniform2f(e),u_up_dir:new se.Uniform3f(e),u_height_lift:new se.Uniform1f(e),u_image:new se.Uniform1i(e),u_texsize:new se.Uniform2f(e),u_pixel_coord_upper:new se.Uniform2f(e),u_pixel_coord_lower:new se.Uniform2f(e),u_tile_units_to_pixels:new se.Uniform1f(e),u_opacity:new se.Uniform1f(e)}),fill:e=>({u_matrix:new se.UniformMatrix4f(e)}),fillPattern:e=>({u_matrix:new se.UniformMatrix4f(e),u_image:new se.Uniform1i(e),u_texsize:new se.Uniform2f(e),u_pixel_coord_upper:new se.Uniform2f(e),u_pixel_coord_lower:new se.Uniform2f(e),u_tile_units_to_pixels:new se.Uniform1f(e)}),fillOutline:e=>({u_matrix:new se.UniformMatrix4f(e),u_world:new se.Uniform2f(e)}),fillOutlinePattern:e=>({u_matrix:new se.UniformMatrix4f(e),u_world:new se.Uniform2f(e),u_image:new se.Uniform1i(e),u_texsize:new se.Uniform2f(e),u_pixel_coord_upper:new se.Uniform2f(e),u_pixel_coord_lower:new se.Uniform2f(e),u_tile_units_to_pixels:new se.Uniform1f(e)}),circle:e=>({u_camera_to_center_distance:new se.Uniform1f(e),u_extrude_scale:new se.UniformMatrix2f(e),u_device_pixel_ratio:new se.Uniform1f(e),u_matrix:new se.UniformMatrix4f(e),u_inv_rot_matrix:new se.UniformMatrix4f(e),u_merc_center:new se.Uniform2f(e),u_tile_id:new se.Uniform3f(e),u_zoom_transition:new se.Uniform1f(e),u_up_dir:new se.Uniform3f(e)}),collisionBox:e=>({u_matrix:new se.UniformMatrix4f(e),u_camera_to_center_distance:new se.Uniform1f(e),u_extrude_scale:new se.Uniform2f(e)}),collisionCircle:e=>({u_matrix:new se.UniformMatrix4f(e),u_inv_matrix:new se.UniformMatrix4f(e),u_camera_to_center_distance:new se.Uniform1f(e),u_viewport_size:new se.Uniform2f(e)}),debug:e=>({u_color:new se.UniformColor(e),u_matrix:new se.UniformMatrix4f(e),u_overlay:new se.Uniform1i(e),u_overlay_scale:new se.Uniform1f(e)}),clippingMask:e=>({u_matrix:new se.UniformMatrix4f(e)}),heatmap:e=>({u_extrude_scale:new se.Uniform1f(e),u_intensity:new se.Uniform1f(e),u_matrix:new se.UniformMatrix4f(e),u_inv_rot_matrix:new se.UniformMatrix4f(e),u_merc_center:new se.Uniform2f(e),u_tile_id:new se.Uniform3f(e),u_zoom_transition:new se.Uniform1f(e),u_up_dir:new se.Uniform3f(e)}),heatmapTexture:e=>({u_image:new se.Uniform1i(e),u_color_ramp:new se.Uniform1i(e),u_opacity:new se.Uniform1f(e)}),hillshade:e=>({u_matrix:new se.UniformMatrix4f(e),u_image:new se.Uniform1i(e),u_latrange:new se.Uniform2f(e),u_light:new se.Uniform2f(e),u_shadow:new se.UniformColor(e),u_highlight:new se.UniformColor(e),u_accent:new se.UniformColor(e)}),hillshadePrepare:e=>({u_matrix:new se.UniformMatrix4f(e),u_image:new se.Uniform1i(e),u_dimension:new se.Uniform2f(e),u_zoom:new se.Uniform1f(e),u_unpack:new se.Uniform4f(e)}),line:e=>({u_matrix:new se.UniformMatrix4f(e),u_pixels_to_tile_units:new se.UniformMatrix2f(e),u_device_pixel_ratio:new se.Uniform1f(e),u_units_to_pixels:new se.Uniform2f(e),u_dash_image:new se.Uniform1i(e),u_gradient_image:new se.Uniform1i(e),u_image_height:new se.Uniform1f(e),u_texsize:new se.Uniform2f(e),u_tile_units_to_pixels:new se.Uniform1f(e),u_alpha_discard_threshold:new se.Uniform1f(e),u_trim_offset:new se.Uniform2f(e)}),linePattern:e=>({u_matrix:new se.UniformMatrix4f(e),u_texsize:new se.Uniform2f(e),u_pixels_to_tile_units:new se.UniformMatrix2f(e),u_device_pixel_ratio:new se.Uniform1f(e),u_image:new se.Uniform1i(e),u_units_to_pixels:new se.Uniform2f(e),u_tile_units_to_pixels:new se.Uniform1f(e),u_alpha_discard_threshold:new se.Uniform1f(e)}),raster:e=>({u_matrix:new se.UniformMatrix4f(e),u_tl_parent:new se.Uniform2f(e),u_scale_parent:new se.Uniform1f(e),u_fade_t:new se.Uniform1f(e),u_opacity:new se.Uniform1f(e),u_image0:new se.Uniform1i(e),u_image1:new se.Uniform1i(e),u_brightness_low:new se.Uniform1f(e),u_brightness_high:new se.Uniform1f(e),u_saturation_factor:new se.Uniform1f(e),u_contrast_factor:new se.Uniform1f(e),u_spin_weights:new se.Uniform3f(e),u_perspective_transform:new se.Uniform2f(e)}),symbolIcon:e=>({u_is_size_zoom_constant:new se.Uniform1i(e),u_is_size_feature_constant:new se.Uniform1i(e),u_size_t:new se.Uniform1f(e),u_size:new se.Uniform1f(e),u_camera_to_center_distance:new se.Uniform1f(e),u_rotate_symbol:new se.Uniform1i(e),u_aspect_ratio:new se.Uniform1f(e),u_fade_change:new se.Uniform1f(e),u_matrix:new se.UniformMatrix4f(e),u_label_plane_matrix:new se.UniformMatrix4f(e),u_coord_matrix:new se.UniformMatrix4f(e),u_is_text:new se.Uniform1i(e),u_pitch_with_map:new se.Uniform1i(e),u_texsize:new se.Uniform2f(e),u_tile_id:new se.Uniform3f(e),u_zoom_transition:new se.Uniform1f(e),u_inv_rot_matrix:new se.UniformMatrix4f(e),u_merc_center:new se.Uniform2f(e),u_camera_forward:new se.Uniform3f(e),u_tile_matrix:new se.UniformMatrix4f(e),u_up_vector:new se.Uniform3f(e),u_ecef_origin:new se.Uniform3f(e),u_texture:new se.Uniform1i(e)}),symbolSDF:e=>({u_is_size_zoom_constant:new se.Uniform1i(e),u_is_size_feature_constant:new se.Uniform1i(e),u_size_t:new se.Uniform1f(e),u_size:new se.Uniform1f(e),u_camera_to_center_distance:new se.Uniform1f(e),u_rotate_symbol:new se.Uniform1i(e),u_aspect_ratio:new se.Uniform1f(e),u_fade_change:new se.Uniform1f(e),u_matrix:new se.UniformMatrix4f(e),u_label_plane_matrix:new se.UniformMatrix4f(e),u_coord_matrix:new se.UniformMatrix4f(e),u_is_text:new se.Uniform1i(e),u_pitch_with_map:new se.Uniform1i(e),u_texsize:new se.Uniform2f(e),u_texture:new se.Uniform1i(e),u_gamma_scale:new se.Uniform1f(e),u_device_pixel_ratio:new se.Uniform1f(e),u_tile_id:new se.Uniform3f(e),u_zoom_transition:new se.Uniform1f(e),u_inv_rot_matrix:new se.UniformMatrix4f(e),u_merc_center:new se.Uniform2f(e),u_camera_forward:new se.Uniform3f(e),u_tile_matrix:new se.UniformMatrix4f(e),u_up_vector:new se.Uniform3f(e),u_ecef_origin:new se.Uniform3f(e),u_is_halo:new se.Uniform1i(e)}),symbolTextAndIcon:e=>({u_is_size_zoom_constant:new se.Uniform1i(e),u_is_size_feature_constant:new se.Uniform1i(e),u_size_t:new se.Uniform1f(e),u_size:new se.Uniform1f(e),u_camera_to_center_distance:new se.Uniform1f(e),u_rotate_symbol:new se.Uniform1i(e),u_aspect_ratio:new se.Uniform1f(e),u_fade_change:new se.Uniform1f(e),u_matrix:new se.UniformMatrix4f(e),u_label_plane_matrix:new se.UniformMatrix4f(e),u_coord_matrix:new se.UniformMatrix4f(e),u_is_text:new se.Uniform1i(e),u_pitch_with_map:new se.Uniform1i(e),u_texsize:new se.Uniform2f(e),u_texsize_icon:new se.Uniform2f(e),u_texture:new se.Uniform1i(e),u_texture_icon:new se.Uniform1i(e),u_gamma_scale:new se.Uniform1f(e),u_device_pixel_ratio:new se.Uniform1f(e),u_is_halo:new se.Uniform1i(e)}),background:e=>({u_matrix:new se.UniformMatrix4f(e),u_opacity:new se.Uniform1f(e),u_color:new se.UniformColor(e)}),backgroundPattern:e=>({u_matrix:new se.UniformMatrix4f(e),u_opacity:new se.Uniform1f(e),u_image:new se.Uniform1i(e),u_pattern_tl:new se.Uniform2f(e),u_pattern_br:new se.Uniform2f(e),u_texsize:new se.Uniform2f(e),u_pattern_size:new se.Uniform2f(e),u_pixel_coord_upper:new se.Uniform2f(e),u_pixel_coord_lower:new se.Uniform2f(e),u_tile_units_to_pixels:new se.Uniform1f(e)}),terrainRaster:yr,terrainDepth:yr,skybox:e=>({u_matrix:new se.UniformMatrix4f(e),u_sun_direction:new se.Uniform3f(e),u_cubemap:new se.Uniform1i(e),u_opacity:new se.Uniform1f(e),u_temporal_offset:new se.Uniform1f(e)}),skyboxGradient:e=>({u_matrix:new se.UniformMatrix4f(e),u_color_ramp:new se.Uniform1i(e),u_center_direction:new se.Uniform3f(e),u_radius:new se.Uniform1f(e),u_opacity:new se.Uniform1f(e),u_temporal_offset:new se.Uniform1f(e)}),skyboxCapture:e=>({u_matrix_3f:new se.UniformMatrix3f(e),u_sun_direction:new se.Uniform3f(e),u_sun_intensity:new se.Uniform1f(e),u_color_tint_r:new se.Uniform4f(e),u_color_tint_m:new se.Uniform4f(e),u_luminance:new se.Uniform1f(e)}),globeRaster:e=>({u_proj_matrix:new se.UniformMatrix4f(e),u_globe_matrix:new se.UniformMatrix4f(e),u_normalize_matrix:new se.UniformMatrix4f(e),u_merc_matrix:new se.UniformMatrix4f(e),u_zoom_transition:new se.Uniform1f(e),u_merc_center:new se.Uniform2f(e),u_image0:new se.Uniform1i(e),u_grid_matrix:new se.UniformMatrix3f(e),u_skirt_height:new se.Uniform1f(e),u_frustum_tl:new se.Uniform3f(e),u_frustum_tr:new se.Uniform3f(e),u_frustum_br:new se.Uniform3f(e),u_frustum_bl:new se.Uniform3f(e),u_globe_pos:new se.Uniform3f(e),u_globe_radius:new se.Uniform1f(e),u_viewport:new se.Uniform2f(e)}),globeAtmosphere:e=>({u_frustum_tl:new se.Uniform3f(e),u_frustum_tr:new se.Uniform3f(e),u_frustum_br:new se.Uniform3f(e),u_frustum_bl:new se.Uniform3f(e),u_horizon:new se.Uniform1f(e),u_transition:new se.Uniform1f(e),u_fadeout_range:new se.Uniform1f(e),u_color:new se.Uniform4f(e),u_high_color:new se.Uniform4f(e),u_space_color:new se.Uniform4f(e),u_star_intensity:new se.Uniform1f(e),u_star_density:new se.Uniform1f(e),u_star_size:new se.Uniform1f(e),u_temporal_offset:new se.Uniform1f(e),u_horizon_angle:new se.Uniform1f(e),u_rotation_matrix:new se.UniformMatrix4f(e)})};let $r;function Xr(r,n,i,o,a,s,t){var l,e,u=r.context,c=u.gl,h=r.transform,f=r.useProgram("collisionBox"),d=[];let p=0,m=0;for(let e=0;e<o.length;e++){const v=o[e],_=n.getTile(v),x=_.getBucket(i);if(x){l=v,y=x,g=h;const b=y.projection.name===g.projection.name?l.projMatrix:((g=g.clone()).setProjection(y.projection),Ct(g,y.getProjection(),l));let e=b;0===a[0]&&0===a[1]||(e=r.translatePosMatrix(b,_,a,s));var g=t?x.textCollisionBox:x.iconCollisionBox,y=x.collisionCircleArray;if(0<y.length){const r=se.create(),n=e;se.mul(r,x.placementInvProjMatrix,h.glCoordMatrix),se.mul(r,r,x.placementViewportMatrix),d.push({circleArray:y,circleOffset:m,transform:n,invTransform:r,projection:x.getProjection()}),p+=y.length/4,m=p}g&&(r.terrain&&r.terrain.setupElevationDraw(_,f),f.draw(u,c.LINES,se.DepthMode.disabled,se.StencilMode.disabled,r.colorModeForRenderPass(),se.CullFaceMode.disabled,((e,t,r,n)=>{r=se.EXTENT/r.tileSize;return{u_matrix:e,u_camera_to_center_distance:t.getCameraToCenterDistance(n),u_extrude_scale:[t.pixelsToGLUnits[0]/r,t.pixelsToGLUnits[1]/r]}})(e,h,_,x.getProjection()),i.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,null,h.zoom,null,[g.collisionVertexBuffer,g.collisionVertexBufferExt]))}}if(t&&d.length){const w=r.useProgram("collisionCircle"),v=new se.StructArrayLayout2f1f2i16;v.resize(4*p),v._trim();let t=0;for(const se of d)for(let e=0;e<se.circleArray.length/4;e++){const n=4*e,i=se.circleArray[0+n],o=se.circleArray[1+n],a=se.circleArray[2+n],s=se.circleArray[3+n];v.emplace(t++,i,o,a,s,0),v.emplace(t++,i,o,a,s,1),v.emplace(t++,i,o,a,s,2),v.emplace(t++,i,o,a,s,3)}(!$r||$r.length<2*p)&&($r=function(t){var r=2*t,n=new se.StructArrayLayout3ui6;n.resize(r),n._trim();for(let e=0;e<r;e++){const t=6*e;n.uint16[0+t]=4*e+0,n.uint16[1+t]=4*e+1,n.uint16[2+t]=4*e+2,n.uint16[3+t]=4*e+2,n.uint16[4+t]=4*e+3,n.uint16[5+t]=4*e+0}return n}(p));const x=u.createIndexBuffer($r,!0),b=u.createVertexBuffer(v,se.collisionCircleLayout.members,!0);for(const n of d){const o={u_matrix:n.transform,u_inv_matrix:n.invTransform,u_camera_to_center_distance:(e=h).getCameraToCenterDistance(n.projection),u_viewport_size:[e.width,e.height]};w.draw(u,c.TRIANGLES,se.DepthMode.disabled,se.StencilMode.disabled,r.colorModeForRenderPass(),se.CullFaceMode.disabled,o,i.id,b,x,se.SegmentVector.simpleSegment(0,2*n.circleOffset,n.circleArray.length,n.circleArray.length/2),null,h.zoom)}b.destroy(),x.destroy()}}const Yr=se.create();function Jr(l,u,c,t,h,f,d,p,m,g,y){var r=l.text.placedSymbolArray,v=l.text.dynamicLayoutVertexArray,n=l.icon.dynamicLayoutVertexArray,_={},x=l.getProjection(),b=At(p,x,f),w=f.elevation,E=x.upVectorScale(p.canonical,f.center.lat,f.worldSize).metersToTile;v.clear();for(let e=0;e<r.length;e++){var T=r.get(e),{tileAnchorX:S,tileAnchorY:M,numGlyphs:k}=T,C=l.allowVerticalPlacement&&!T.placedOrientation,C=T.hidden||!T.crossTileID||C?null:t[T.crossTileID];if(C){let e=0,t=0,r=0;if(w){const se=w?w.getAtTileOffset(p,S,M):0,[l,u,c]=x.upVector(p.canonical,S,M);e=se*l*E,t=se*u*E,r=se*c*E}let[n,i,o,a]=O(T.projectedAnchorX+e,T.projectedAnchorY+t,T.projectedAnchorZ+r,c?b:d);var A=_t(f.getCameraToCenterDistance(x),a);let s=h.evaluateSizeForFeature(l.textSizeData,g,T)*A/se.ONE_EM;c&&(s*=l.tilePixelRatio/m);var A=function({width:e,height:t,anchor:r,textOffset:n,textScale:i},o){var{horizontalAlign:a,verticalAlign:s}=se.getAnchorAlignment(r),a=-(a-.5)*e,e=-(s-.5)*t,s=se.evaluateVariableOffset(r,n);return new se.pointGeometry((a/i+s[0])*o,(e/i+s[1])*o)}(C,s),I=(c?({x:n,y:i,z:o}=x.projectTilePoint(S+A.x,M+A.y,p.canonical),[n,i,o]=O(n+e,i+t,o+r,d)):(u&&A._rotate(-f.angle),n+=A.x,i+=A.y,o=0),l.allowVerticalPlacement&&T.placedOrientation===se.WritingMode.vertical?Math.PI/2:0);for(let e=0;e<k;e++)se.addDynamicAttributes(v,n,i,o,I);y&&0<=T.associatedIconIndex&&(_[T.associatedIconIndex]={x:n,y:i,z:o,angle:I})}else L(k,v)}if(y){n.clear();const u=l.icon.placedSymbolArray;for(let e=0;e<u.length;e++){const c=u.get(e),t=c["numGlyphs"],h=_[e];if(c.hidden||!h)L(t,n);else{const{x:l,y:u,z:c,angle:f}=h;for(let e=0;e<t;e++)se.addDynamicAttributes(n,l,u,c,f)}}l.icon.dynamicLayoutVertexBuffer.updateData(n)}l.text.dynamicLayoutVertexBuffer.updateData(v)}function Kr(a,s,l,u,c,h,f,d,p,j,m,g){const y=a.context,v=y.gl,_=a.transform,x="map"===d,b="map"===p,w=x&&"point"!==l.layout.get("symbol-placement"),E=x&&!b&&!w,U=void 0!==l.layout.get("symbol-sort-key").constantOr(1);let V=!1;const T=a.depthModeForSublayer(0,se.DepthMode.ReadOnly),S=[se.mercatorXfromLng(_.center.lng),se.mercatorYfromLat(_.center.lat)],G=l.layout.get("text-variable-anchor"),e="globe"===_.projection.name,M=[],W=[0,-1,0];let Z=W;var t,k,C,q,H,$,X,Y,J,K,Q,ee,te,re,ne,ie;!e&&!_.mercatorFromTransition||x||(Z=(p=(d=_)._camera.getWorldToCamera(d.worldSize,1),p=se.multiply([],p,d.globeMatrix),se.invert(p,p),d=[0,0,0],t=[0,1,0,0],se.transformMat4$1(t,t,p),d[0]=t[0],d[1]=t[1],d[2]=t[2],se.normalize(d,d),d));for(const d of u){const u=s.getTile(d),p=u.getBucket(l);if(p&&("mercator"!==p.projection.name||!e)){const m=c?p.text:p.icon;if(m&&!p.fullyClipped&&m.segments.get().length){const g=m.programConfigurations.get(l.id),y=c||p.sdfIcons,T=c?p.textSizeData:p.iconSizeData,B=b||0!==_.pitch,N=se.evaluateSizeForZoom(T,_.zoom);let e,t,r,n,i=[0,0],o=null;if(c){if(t=u.glyphAtlasTexture,r=v.LINEAR,e=u.glyphAtlasTexture.size,p.iconsInText){i=u.imageAtlasTexture.size,o=u.imageAtlasTexture;const se="composite"===T.kind||"camera"===T.kind;n=B||a.options.rotating||a.options.zooming||se?v.LINEAR:v.NEAREST}}else{const se=1!==l.layout.get("icon-size").constantOr(0)||p.iconsNeedLinear;t=u.imageAtlasTexture,r=y||a.options.rotating||a.options.zooming||se||B?v.LINEAR:v.NEAREST,e=u.imageAtlasTexture.size}var A="globe"===p.projection.name,I=A?Z:W,L=A?se.globeToMercatorTransition(_.zoom):0,P=At(d,p.getProjection(),_),z=_.calculatePixelsToTileUnitsMatrix(u),D=le(P,u.tileID.canonical,b,x,_,p.getProjection(),z),oe=a.terrain&&b&&w?se.invert(se.create(),D):Yr,O=vt(P,u.tileID.canonical,b,x,_,p.getProjection(),z),R=G&&p.hasTextData(),R="none"!==l.layout.get("icon-text-fit")&&R&&p.hasIconData();if(w){const se=_.elevation,s=se?se.getAtTileOffsetFunc(d,_.center.lat,_.worldSize,p.getProjection()):null,l=yt(P,u.tileID.canonical,b,x,_,p.getProjection(),z);xt(p,P,a,c,l,O,b,j,s,d)}var z=w||c&&G||R,R=a.translatePosMatrix(P,u,h,f),P=z?Yr:D,D=a.translatePosMatrix(O,u,h,f,!0),O=p.getProjection().createInversionMatrix(_,d.canonical),F=[],A=(a.terrainRenderModeElevated()&&b&&F.push("PITCH_WITH_MAP_TERRAIN"),A&&F.push("PROJECTION_GLOBE_VIEW"),z&&F.push("PROJECTED_POS_ON_VIEWPORT"),y&&0!==l.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)),z=y?p.iconsInText?(z=T.kind,k=N,C=E,q=b,H=a,$=R,X=P,Y=D,J=e,K=i,Q=d,ee=L,te=S,re=O,ne=I,ie=p.getProjection(),se.extend(qr(z,k,C,q,H,$,X,Y,!0,J,!0,Q,ee,te,re,ne,ie),{u_texsize_icon:K,u_texture_icon:1})):qr(T.kind,N,E,b,a,R,P,D,c,e,!0,d,L,S,O,I,p.getProjection()):Zr(T.kind,N,E,b,a,R,P,D,c,e,d,L,S,O,I,p.getProjection()),ae={program:a.useProgram((k=y,C=c,p.iconsInText&&C?"symbolTextAndIcon":k?"symbolSDF":"symbolIcon"),g,F),buffers:m,uniformValues:z,atlasTexture:t,atlasTextureIcon:o,atlasInterpolation:r,atlasInterpolationIcon:n,isSDF:y,hasHalo:A,tile:u,labelPlaneMatrixInv:oe};if(U&&p.canOverlap){V=!0;const a=m.segments.get();for(const s of a)M.push({segments:new se.SegmentVector([s]),sortKey:s.sortKey,state:ae})}else M.push({segments:m.segments,sortKey:0,state:ae})}}}V&&M.sort((e,t)=>e.sortKey-t.sortKey);for(const se of M){const s=se.state;if(a.terrain&&a.terrain.setupElevationDraw(s.tile,s.program,{useDepthForOcclusion:!e,labelPlaneMatrixInv:s.labelPlaneMatrixInv}),y.activeTexture.set(v.TEXTURE0),s.atlasTexture.bind(s.atlasInterpolation,v.CLAMP_TO_EDGE),s.atlasTextureIcon&&(y.activeTexture.set(v.TEXTURE1),s.atlasTextureIcon&&s.atlasTextureIcon.bind(s.atlasInterpolationIcon,v.CLAMP_TO_EDGE)),s.isSDF){const u=s.uniformValues;s.hasHalo&&(u.u_is_halo=1,Qr(s.buffers,se.segments,l,a,s.program,T,m,g,u)),u.u_is_halo=0}Qr(s.buffers,se.segments,l,a,s.program,T,m,g,s.uniformValues)}}function Qr(e,t,r,n,i,o,a,s,l){var u=n.context,c=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.globeExtVertexBuffer];i.draw(u,u.gl.TRIANGLES,o,a,s,se.CullFaceMode.disabled,l,r.id,e.layoutVertexBuffer,e.indexBuffer,t,r.paint,n.transform.zoom,e.programConfigurations.get(r.id),c)}function en(e,t,r,n,i,o,a){var s=e.context.gl,l=r.paint.get("fill-pattern"),u=l&&l.constantOr(1);let c,h,f,d,p;c=a?(h=u&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",s.LINES):(h=u?"fillPattern":"fill",s.TRIANGLES);for(const _ of n){const n=t.getTile(_);if(!u||n.patternsLoaded()){var m=n.getBucket(r);if(m){e.prepareDrawTile();var g=m.programConfigurations.get(r.id),y=e.useProgram(h,g),v=(u&&(e.context.activeTexture.set(s.TEXTURE0),n.imageAtlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE),g.updatePaintBuffers()),l.constantOr(null));if(v&&n.imageAtlas){const se=n.imageAtlas.patternPositions[v.toString()];se&&g.setConstantPatternPositions(se)}v=e.translatePosMatrix(_.projMatrix,n,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(a){d=m.indexBuffer2,p=m.segments2;const se=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[s.drawingBufferWidth,s.drawingBufferHeight];f="fillOutlinePattern"===h&&u?Rr(v,e,n,se):{u_matrix:v,u_world:se}}else d=m.indexBuffer,p=m.segments,f=u?Or(v,e,n):Dr(v);e.prepareDrawProgram(e.context,y,_.toUnwrapped()),y.draw(e.context,c,i,e.stencilModeForClipping(_),o,se.CullFaceMode.disabled,f,r.id,m.layoutVertexBuffer,d,p,r.paint,e.transform.zoom,g)}}}}function tn(e,t,r,n,i,o,a){var s=e.context,l=s.gl,u=e.transform,c=r.paint.get("fill-extrusion-pattern"),h=c.constantOr(1),f=r.paint.get("fill-extrusion-opacity"),d=[r.paint.get("fill-extrusion-ambient-occlusion-intensity"),r.paint.get("fill-extrusion-ambient-occlusion-radius")],p=r.layout.get("fill-extrusion-edge-radius"),m="globe"===u.projection.name?se.fillExtrusionHeightLift():0,g="globe"===u.projection.name,y=g?se.globeToMercatorTransition(u.zoom):0,v=[se.mercatorXfromLng(u.center.lng),se.mercatorYfromLat(u.center.lat)],_=[];g&&_.push("PROJECTION_GLOBE_VIEW"),0<d[0]&&_.push("FAUX_AO");for(const S of n){const n=t.getTile(S),M=n.getBucket(r);if(M&&M.projection.name===u.projection.name){var x=M.programConfigurations.get(r.id),b=e.useProgram(h?"fillExtrusionPattern":"fillExtrusion",x,_);if(e.terrain){const se=e.terrain;if(e.style.terrainSetForDrapingOnly())se.setupElevationDraw(n,b,{useMeterToDem:!0});else{if(!M.enableTerrain)continue;if(se.setupElevationDraw(n,b,{useMeterToDem:!0}),rn(s,t,S,M,r,se),!M.centroidVertexBuffer){const se=b.attributes.a_centroid_pos;void 0!==se&&l.vertexAttrib2f(se,0,0)}}}h&&(e.context.activeTexture.set(l.TEXTURE0),n.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),x.updatePaintBuffers());var w=c.constantOr(null);if(w&&n.imageAtlas){const se=n.imageAtlas.patternPositions[w.toString()];se&&x.setConstantPatternPositions(se)}var w=e.translatePosMatrix(S.projMatrix,n,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),E=u.projection.createInversionMatrix(u,S.canonical),T=r.paint.get("fill-extrusion-vertical-gradient"),w=h?((e,t,r,n,i,o,a,s,l,u,c,h)=>{e=zr(e,t,r,n,i,o,a,l,u,c,h),r={u_height_factor:-Math.pow(2,a.overscaledZ)/s.tileSize/8};return se.extend(e,Lr(t,s),r)})(w,e,T,f,d,p,S,n,m,y,v,E):zr(w,e,T,f,d,p,S,m,y,v,E),T=(e.prepareDrawProgram(s,b,S.toUnwrapped()),[]);e.terrain&&T.push(M.centroidVertexBuffer),g&&T.push(M.layoutVertexExtBuffer),b.draw(s,s.gl.TRIANGLES,i,o,a,se.CullFaceMode.backCCW,w,r.id,M.layoutVertexBuffer,M.indexBuffer,M.segments,r.paint,e.transform.zoom,x,T)}}}function rn(e,i,s,o,a,l){const u=[e=>{let t=e.canonical.x-1,r=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,r--),new se.OverscaledTileID(e.overscaledZ,r,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,r=e.wrap;return t===1<<e.canonical.z&&(t=0,r++),new se.OverscaledTileID(e.overscaledZ,r,e.canonical.z,t,e.canonical.y)},e=>new se.OverscaledTileID(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new se.OverscaledTileID(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)],t=e=>{const t=i.getSource().minzoom,r=e=>{e=i.getTileByID(e);if(e&&e.hasData())return e.getBucket(a)},n=[0,-1,1];for(const i of n)if(!(e.overscaledZ+i<t)){const n=r(e.calculateScaledKey(e.overscaledZ+i));if(n)return n}},c=[0,0,0],h=(e,t)=>(c[0]=Math.min(e.min.y,t.min.y),c[1]=Math.max(e.max.y,t.max.y),c[2]=se.EXTENT-t.min.x>e.max.x?t.min.x-se.EXTENT:e.max.x,c),f=(e,t)=>(c[0]=Math.min(e.min.x,t.min.x),c[1]=Math.max(e.max.x,t.max.x),c[2]=se.EXTENT-t.min.y>e.max.y?t.min.y-se.EXTENT:e.max.y,c),d=[(e,t)=>h(e,t),(e,t)=>h(t,e),(e,t)=>f(e,t),(e,t)=>f(t,e)],p=new se.pointGeometry(0,0);let m,g,y;var v=(e,t,r,n,i)=>{var o=[[n?r:e,n?e:r,0],[n?r:t,n?t:r,0]],a=i<0?se.EXTENT+i:i,n=[n?a:(e+t)/2,n?(e+t)/2:a,0];return 0===r&&i<0||0!==r&&0<i?l.getForTilePoints(y,[n],!0,g):o.push(n),l.getForTilePoints(s,o,!0,m),Math.max(o[0][2],o[1][2],n[2])/l.exaggeration()};for(let n=0;n<4;n++){const i=(n<2?1:5)-n,a=o.borders[n];if(0!==a.length){const c=y=u[n](s),h=t(c);if(h&&h instanceof se.FillExtrusionBucket&&h.enableTerrain&&(o.borderDoneWithNeighborZ[n]!==h.canonical.z||h.borderDoneWithNeighborZ[i]!==o.canonical.z)&&(g=l.findDEMTileFor(c))&&g.dem){if(!m){const se=l.findDEMTileFor(s);if(!se||!se.dem)return;m=se}const f=h.borders[i];let r=0;var _=h.borderDoneWithNeighborZ[i]!==o.canonical.z;if(o.canonical.z===h.canonical.z){for(let e=0;e<a.length;e++){const l=o.featuresOnBorder[a[e]],u=l.borders[n];let t;for(;r<f.length&&!((t=h.featuresOnBorder[f[r]]).borders[i][1]>u[0]+3);)_&&h.encodeCentroid(void 0,t,!1),r++;if(t&&r<f.length){const s=r;let e=0;for(;!(t.borders[i][0]>u[1]-3)&&(e++,++r!==f.length);)t=h.featuresOnBorder[f[r]];if(t=h.featuresOnBorder[f[s]],1<l.intersectsCount()||1<t.intersectsCount()||1!==e)1!==e&&(r=s),o.encodeCentroid(void 0,l,!1),_&&h.encodeCentroid(void 0,t,!1);else{const c=d[n](l,t),m=n%2?se.EXTENT-1:0;p.x=v(c[0],Math.min(se.EXTENT-1,c[1]),m,n<2,c[2]),p.y=0,o.encodeCentroid(p,l,!1),_&&h.encodeCentroid(p,t,!1)}}else o.encodeCentroid(void 0,l,!1)}o.borderDoneWithNeighborZ[n]=h.canonical.z,o.needsCentroidUpdate=!0,_&&(h.borderDoneWithNeighborZ[i]=o.canonical.z,h.needsCentroidUpdate=!0)}else{for(const se of a)o.encodeCentroid(void 0,o.featuresOnBorder[se],!1);if(_){for(const se of f)h.encodeCentroid(void 0,h.featuresOnBorder[se],!1);h.borderDoneWithNeighborZ[i]=o.canonical.z,h.needsCentroidUpdate=!0}o.borderDoneWithNeighborZ[n]=h.canonical.z,o.needsCentroidUpdate=!0}}}}(o.needsCentroidUpdate||!o.centroidVertexBuffer&&0!==o.centroidVertexArray.length)&&o.uploadCentroid(e)}const nn=new se.Color(1,0,0,1),on=new se.Color(0,1,0,1),an=new se.Color(0,0,1,1),sn=new se.Color(1,0,1,1),ln=new se.Color(0,1,1,1);function un(e,t,r,n){hn(e,0,t+r/2,e.transform.width,r,n)}function cn(e,t,r,n){hn(e,t-r/2,0,r,e.transform.height,n)}function hn(e,t,r,n,i,o){var e=e.context,a=e.gl;a.enable(a.SCISSOR_TEST),a.scissor(t*se.exported.devicePixelRatio,r*se.exported.devicePixelRatio,n*se.exported.devicePixelRatio,i*se.exported.devicePixelRatio),e.clear({color:o}),a.disable(a.SCISSOR_TEST)}const fn=se.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),dn=fn["members"];function v(e,t,r,n){e.emplaceBack(t,r,n)}class pn{constructor(e){this.vertexArray=new se.StructArrayLayout3f12,this.indices=new se.StructArrayLayout3ui6,v(this.vertexArray,-1,-1,1),v(this.vertexArray,1,-1,1),v(this.vertexArray,-1,1,1),v(this.vertexArray,1,1,1),v(this.vertexArray,-1,-1,-1),v(this.vertexArray,1,-1,-1),v(this.vertexArray,-1,1,-1),v(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,dn),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=se.SegmentVector.simpleSegment(0,0,36,12)}}function _(e,t,r,n,i,o){const a=e.gl,s=t.paint.get("sky-atmosphere-color"),l=t.paint.get("sky-atmosphere-halo-color"),u=t.paint.get("sky-atmosphere-sun-intensity"),c={u_matrix_3f:se.fromMat4(se.create$1(),n),u_sun_direction:i,u_sun_intensity:u,u_color_tint_r:[s.r,s.g,s.b,s.a],u_color_tint_m:[l.r,l.g,l.b,l.a],u_luminance:5e-5};a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+o,t.skyboxTexture,0),r.draw(e,a.TRIANGLES,se.DepthMode.disabled,se.StencilMode.disabled,se.ColorMode.unblended,se.CullFaceMode.frontCW,c,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const mn=se.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class gn{constructor(e){var t=new se.StructArrayLayout5f20,r=(t.emplaceBack(-1,1,1,0,0),t.emplaceBack(1,1,1,1,0),t.emplaceBack(1,-1,1,1,1),t.emplaceBack(-1,-1,1,0,1),new se.StructArrayLayout3ui6);r.emplaceBack(0,1,2),r.emplaceBack(2,3,0),this.vertexBuffer=e.createVertexBuffer(t,mn.members),this.indexBuffer=e.createIndexBuffer(r),this.segments=se.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const yn={symbol:function(e,t,r,n,i){if("translucent"===e.renderPass){var o=se.StencilMode.disabled,a=e.colorModeForRenderPass();if(r.layout.get("text-variable-anchor")){var s=n;var l=e;var u=r;var c=t;var h=r.layout.get("text-rotation-alignment");var f=r.layout.get("text-pitch-alignment");var d=i;var p=l.transform,m="map"===h,g="map"===f;for(const l of s){const s=c.getTile(l),h=s.getBucket(u);if(h&&h.text&&h.text.segments.get().length){const f=se.evaluateSizeForZoom(h.textSizeData,p.zoom),y=At(l,h.getProjection(),p),v=p.calculatePixelsToTileUnitsMatrix(s),_=le(y,s.tileID.canonical,g,m,p,h.getProjection(),v),x="none"!==u.layout.get("icon-text-fit")&&h.hasIconData();if(f){const u=Math.pow(2,p.zoom-s.tileID.overscaledZ);Jr(h,m,g,d,se.symbolSize,p,_,l,u,f,x)}}}}0!==r.paint.get("icon-opacity").constantOr(1)&&Kr(e,t,r,n,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),o,a),0!==r.paint.get("text-opacity").constantOr(1)&&Kr(e,t,r,n,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),o,a),t.map.showCollisionBoxes&&(Xr(e,t,r,n,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),Xr(e,t,r,n,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))}},circle:function(t,r,n,i){if("translucent"===t.renderPass){const e=n.paint.get("circle-opacity"),s=n.paint.get("circle-stroke-width"),l=n.paint.get("circle-stroke-opacity"),u=void 0!==n.layout.get("circle-sort-key").constantOr(1);if(0!==e.constantOr(1)||0!==s.constantOr(1)&&0!==l.constantOr(1)){const c=t.context,h=c.gl,f=t.transform,d=t.depthModeForSublayer(0,se.DepthMode.ReadOnly),p=se.StencilMode.disabled,m=t.colorModeForRenderPass(),g="globe"===f.projection.name,y=[se.mercatorXfromLng(f.center.lng),se.mercatorYfromLat(f.center.lat)],v=[];for(let e=0;e<i.length;e++){const s=i[e],l=r.getTile(s),c=l.getBucket(n);if(c&&c.projection.name===f.projection.name){const h=c.programConfigurations.get(n.id),d=(void 0,a=[],"map"===(o=n).paint.get("circle-pitch-alignment")&&a.push("PITCH_WITH_MAP"),"map"===o.paint.get("circle-pitch-scale")&&a.push("SCALE_WITH_MAP"),a),p=(g&&d.push("PROJECTION_GLOBE_VIEW"),t.useProgram("circle",h,d)),m=c.layoutVertexBuffer,_=c.globeExtVertexBuffer,x=c.indexBuffer,b=f.projection.createInversionMatrix(f,s.canonical),w={programConfiguration:h,program:p,layoutVertexBuffer:m,globeExtVertexBuffer:_,indexBuffer:x,uniformValues:((e,t,r,n,i,o)=>{var a=e.transform,s="globe"===a.projection.name;let l;if("map"===o.paint.get("circle-pitch-alignment"))if(s){const e=se.globePixelsToTileUnits(a.zoom,t.canonical)*a._pixelsPerMercatorPixel;l=Float32Array.from([e,0,0,e])}else l=a.calculatePixelsToTileUnitsMatrix(r);else l=new Float32Array([a.pixelsToGLUnits[0],0,0,a.pixelsToGLUnits[1]]);o={u_camera_to_center_distance:a.cameraToCenterDistance,u_matrix:e.translatePosMatrix(t.projMatrix,r,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_device_pixel_ratio:se.exported.devicePixelRatio,u_extrude_scale:l,u_inv_rot_matrix:Fr,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(s){o.u_inv_rot_matrix=n,o.u_merc_center=i,o.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],o.u_zoom_transition=se.globeToMercatorTransition(a.zoom);const e=i[0]*se.EXTENT,r=i[1]*se.EXTENT;o.u_up_dir=a.projection.upVector(new se.CanonicalTileID(0,0,0),e,r)}return o})(t,s,l,b,y,n),tile:l};if(u){const t=c.segments.get();for(const r of t)v.push({segments:new se.SegmentVector([r]),sortKey:r.sortKey,state:w})}else v.push({segments:c.segments,sortKey:0,state:w})}}var o,a;u&&v.sort((e,t)=>e.sortKey-t.sortKey);const _={useDepthForOcclusion:!g};for(const r of v){const{programConfiguration:i,program:e,layoutVertexBuffer:s,globeExtVertexBuffer:l,indexBuffer:u,uniformValues:g,tile:y}=r.state,v=r.segments;t.terrain&&t.terrain.setupElevationDraw(y,e,_),t.prepareDrawProgram(c,e,y.tileID.toUnwrapped()),e.draw(c,h.TRIANGLES,d,p,m,se.CullFaceMode.disabled,g,n.id,s,u,v,n.paint,f.zoom,i,[l])}}}},heatmap:function(t,r,n,i){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){var o=t.context,a=o.gl,s=se.StencilMode.disabled,l=new se.ColorMode([a.ONE,a.ONE],se.Color.transparent,[!0,!0,!0,!0]);{var u=o;var c=t;var h=n;var f="globe"===t.transform.projection.name?.5:.25;var d,p,m=u.gl,g=c.width*f,f=c.height*f;u.activeTexture.set(m.TEXTURE1),u.viewport.set([0,0,g,f]);let e=h.heatmapFbo;if(!e||e&&(e.width!==g||e.height!==f)){e&&e.destroy();const c=m.createTexture();m.bindTexture(m.TEXTURE_2D,c),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR),e=h.heatmapFbo=u.createFramebuffer(g,f,!1),h=u,d=c,p=e,(A=h.gl).texImage2D(A.TEXTURE_2D,0,h.isWebGL2&&h.extRenderToTextureHalfFloat?A.RGBA16F:A.RGBA,g,f,0,A.RGBA,h.extRenderToTextureHalfFloat?h.isWebGL2?A.HALF_FLOAT:h.extTextureHalfFloat.HALF_FLOAT_OES:A.UNSIGNED_BYTE,null),p.colorAttachment.set(d)}else m.bindTexture(m.TEXTURE_2D,e.colorAttachment.get()),u.bindFramebuffer.set(e.framebuffer)}o.clear({color:se.Color.transparent});var y=t.transform,v="globe"===y.projection.name,_=v?["PROJECTION_GLOBE_VIEW"]:null,x=v?se.CullFaceMode.frontCCW:se.CullFaceMode.disabled,b=[se.mercatorXfromLng(y.center.lng),se.mercatorYfromLat(y.center.lat)];for(let e=0;e<i.length;e++){var w,E,T,S,M,k,C=i[e];r.hasRenderableParent(C)||(E=(w=r.getTile(C)).getBucket(n))&&E.projection.name===y.projection.name&&(T=E.programConfigurations.get(n.id),S=t.useProgram("heatmap",T,_),M=t.transform["zoom"],t.terrain&&t.terrain.setupElevationDraw(w,S),t.prepareDrawProgram(o,S,C.toUnwrapped()),k=y.projection.createInversionMatrix(y,C.canonical),S.draw(o,a.TRIANGLES,se.DepthMode.disabled,s,l,x,((e,t,r,n,i,o,a)=>{var s=e.transform,e="globe"===s.projection.name,r=e?se.globePixelsToTileUnits(s.zoom,t.canonical)*s._pixelsPerMercatorPixel:I(r,1,o),o={u_matrix:t.projMatrix,u_extrude_scale:r,u_intensity:a,u_inv_rot_matrix:Nr,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(e){o.u_inv_rot_matrix=n,o.u_merc_center=i,o.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],o.u_zoom_transition=se.globeToMercatorTransition(s.zoom);const e=i[0]*se.EXTENT,r=i[1]*se.EXTENT;o.u_up_dir=s.projection.upVector(new se.CanonicalTileID(0,0,0),e,r)}return o})(t,C,w,k,b,M,n.paint.get("heatmap-intensity")),n.id,E.layoutVertexBuffer,E.indexBuffer,E.segments,n.paint,t.transform.zoom,T,v?[E.globeExtVertexBuffer]:null))}o.viewport.set([0,0,t.width,t.height])}else if("translucent"===t.renderPass){t.context.setColorMode(t.colorModeForRenderPass());{c=t;g=n;var f=c.context,h=f.gl,A=g.heatmapFbo;if(A){f.activeTexture.set(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,A.colorAttachment.get()),f.activeTexture.set(h.TEXTURE1);let e=g.colorRampTexture;(e=e||(g.colorRampTexture=new se.Texture(f,g.colorRamp,h.RGBA))).bind(h.LINEAR,h.CLAMP_TO_EDGE),c.useProgram("heatmapTexture").draw(f,h.TRIANGLES,se.DepthMode.disabled,se.StencilMode.disabled,c.colorModeForRenderPass(),se.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:g.paint.get("heatmap-opacity")},g.id,c.viewportBuffer,c.quadTriangleIndexBuffer,c.viewportSegments,g.paint,c.transform.zoom)}return}}else return void 0},line:function(n,i,o,a){if("translucent"===n.renderPass){const y=o.paint.get("line-opacity"),v=o.paint.get("line-width");if(0!==y.constantOr(1)&&0!==v.constantOr(1)){const _=n.depthModeForSublayer(0,se.DepthMode.ReadOnly),x=n.colorModeForRenderPass(),b=n.terrain&&n.terrain.renderingToTexture?1:se.exported.devicePixelRatio,w=o.paint.get("line-dasharray"),E=w.constantOr(1),T=o.layout.get("line-cap"),S=o.paint.get("line-pattern"),M=S.constantOr(1),k=o.paint.get("line-gradient"),C=M?"linePattern":"line",A=n.context,I=A.gl,L=(t=[],Vr(e=o)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT"),0===(s=e.paint.get("line-trim-offset"))[0]&&0===s[1]||t.push("RENDER_LINE_TRIM_OFFSET"),s=e.paint.get("line-pattern").constantOr(1),e=1!==e.paint.get("line-opacity").constantOr(1),!s&&e&&t.push("RENDER_LINE_ALPHA_DISCARD"),t);var e,t,s,l,u,c,h,f,d;let r=L.includes("RENDER_LINE_ALPHA_DISCARD");n.terrain&&n.terrain.clipOrMaskOverlapStencilType()&&(r=!1);for(const y of a){const a=i.getTile(y);if(!M||a.patternsLoaded()){const v=a.getBucket(o);if(v){n.prepareDrawTile();const P=v.programConfigurations.get(o.id),z=n.useProgram(C,P,L),D=S.constantOr(null);if(D&&a.imageAtlas){const se=a.imageAtlas.patternPositions[D.toString()];se&&P.setConstantPatternPositions(se)}var p=w.constantOr(null),m=T.constantOr(null);if(!M&&p&&m&&a.lineAtlas){const se=a.lineAtlas.getDash(p,m);se&&P.setConstantPatternPositions(se)}let[e,t]=o.paint.get("line-trim-offset");if("round"===m||"square"===m){const se=1;e!==t&&(0===e&&--e,1===t&&(t+=1))}const O=n.terrain?y.projMatrix:null,R=M?(p=a,m=b,d=void 0,d=n.transform,{u_matrix:Ur(n,p,o,O),u_texsize:p.imageAtlasTexture.size,u_pixels_to_tile_units:d.calculatePixelsToTileUnitsMatrix(p),u_device_pixel_ratio:m,u_image:0,u_tile_units_to_pixels:jr(p,d),u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}):(m=n,p=a,d=o,g=O,l=v.lineClipsArray.length,u=b,c=[e,t],f=h=void 0,h=m.transform,f=h.calculatePixelsToTileUnitsMatrix(p),{u_matrix:Ur(m,p,d,g),u_pixels_to_tile_units:f,u_device_pixel_ratio:u,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:l,u_texsize:Vr(d)?p.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:jr(p,m.transform),u_alpha_discard_threshold:0,u_trim_offset:c});if(k){const a=v.gradients[o.id];let t=a.texture;if(o.gradientVersion!==a.version){let e=256;if(o.stepInterpolant){const o=i.getSource().maxzoom,a=y.canonical.z===o?Math.ceil(1<<n.transform.maxZoom-y.canonical.z):1;e=se.clamp(se.nextPowerOfTwo(v.maxLineLength/se.EXTENT*1024*a),256,A.maxTextureSize)}a.gradient=se.renderColorRamp({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:e,image:a.gradient||void 0,clips:v.lineClipsArray}),a.texture?a.texture.update(a.gradient):a.texture=new se.Texture(A,a.gradient,I.RGBA),a.version=o.gradientVersion,t=a.texture}A.activeTexture.set(I.TEXTURE1),t.bind(o.stepInterpolant?I.NEAREST:I.LINEAR,I.CLAMP_TO_EDGE)}E&&(A.activeTexture.set(I.TEXTURE0),a.lineAtlasTexture.bind(I.LINEAR,I.REPEAT),P.updatePaintBuffers()),M&&(A.activeTexture.set(I.TEXTURE0),a.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),P.updatePaintBuffers()),n.prepareDrawProgram(A,z,y.toUnwrapped());var g=e=>{z.draw(A,I.TRIANGLES,_,e,x,se.CullFaceMode.disabled,R,o.id,v.layoutVertexBuffer,v.indexBuffer,v.segments,o.paint,n.transform.zoom,P,[v.layoutVertexBuffer2])};if(r){const i=n.stencilModeForClipping(y).ref,o=(0===i&&n.terrain&&A.clear({stencil:0}),{func:I.EQUAL,mask:255});R.u_alpha_discard_threshold=.8,g(new se.StencilMode(o,i,255,I.KEEP,I.KEEP,I.INVERT)),R.u_alpha_discard_threshold=0,g(new se.StencilMode(o,i,255,I.KEEP,I.KEEP,I.KEEP))}else g(n.stencilModeForClipping(y))}}}r&&(n.resetStencilClippingMasks(),n.terrain&&A.clear({stencil:0}))}}},fill:function(e,t,r,n){const i=r.paint.get("fill-color"),o=r.paint.get("fill-opacity");if(0!==o.constantOr(1)){var a=e.colorModeForRenderPass(),s=r.paint.get("fill-pattern"),s=e.opaquePassEnabledForLayer()&&!s.constantOr(1)&&1===i.constantOr(se.Color.transparent).a&&1===o.constantOr(0)?"opaque":"translucent";if(e.renderPass===s){const i=e.depthModeForSublayer(1,"opaque"===e.renderPass?se.DepthMode.ReadWrite:se.DepthMode.ReadOnly);en(e,t,r,n,i,a,!1)}if("translucent"===e.renderPass&&r.paint.get("fill-antialias")){const i=e.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,se.DepthMode.ReadOnly);en(e,t,r,n,i,a,!0)}}},"fill-extrusion":function(e,t,r,n){const i=r.paint.get("fill-extrusion-opacity");if(0!==i&&"translucent"===e.renderPass){var o=new se.DepthMode(e.context.gl.LEQUAL,se.DepthMode.ReadWrite,e.depthRangeFor3D);if(1!==i||r.paint.get("fill-extrusion-pattern").constantOr(1))tn(e,t,r,n,o,se.StencilMode.disabled,se.ColorMode.disabled),tn(e,t,r,n,o,e.stencilModeFor3D(),e.colorModeForRenderPass()),e.resetStencilClippingMasks();else{const i=e.colorModeForRenderPass();tn(e,t,r,n,o,se.StencilMode.disabled,i)}}},hillshade:function(e,t,r,n){if("offscreen"===e.renderPass||"translucent"===e.renderPass){const g=e.context,y=e.depthModeForSublayer(0,se.DepthMode.ReadOnly),v=e.colorModeForRenderPass(),_=e.terrain&&e.terrain.renderingToTexture,[x,b]="translucent"!==e.renderPass||_?[{},n]:e.stencilConfigForOverlap(n);for(const n of b){const g=t.getTile(n);if(g.needsHillshadePrepare&&"offscreen"===e.renderPass){i=void 0;o=void 0;a=void 0;s=void 0;l=void 0;u=void 0;c=void 0;h=void 0;f=void 0;d=void 0;d=void 0;p=void 0;m=void 0;void 0;void 0;h=void 0;s=void 0;var i=e;var o=g;var a=r;var s=y;var l=se.StencilMode.disabled;var u=v;var c=i.context,h=c.gl;if(o.dem){var f=o.dem;if(c.activeTexture.set(h.TEXTURE1),gr(i,o,f),o.demTexture){o.demTexture.bind(h.NEAREST,h.CLAMP_TO_EDGE);var d=f.dim;c.activeTexture.set(h.TEXTURE0);let e=o.fbo;if(!e){const i=new se.Texture(c,{width:d,height:d,data:null},h.RGBA);i.bind(h.LINEAR,h.CLAMP_TO_EDGE),(e=o.fbo=c.createFramebuffer(d,d,!0)).colorAttachment.set(i.texture)}c.bindFramebuffer.set(e.framebuffer),c.viewport.set([0,0,d,d]);var{tileBoundsBuffer:d,tileBoundsIndexBuffer:p,tileBoundsSegments:m}=i.getMercatorTileBoundsBuffers();i.useProgram("hillshadePrepare").draw(c,h.TRIANGLES,s,l,u,se.CullFaceMode.disabled,(i=o.tileID,h=(c=f).stride,s=se.create(),se.ortho(s,0,se.EXTENT,-se.EXTENT,0,0,1),se.translate(s,s,[0,-se.EXTENT,0]),{u_matrix:s,u_image:1,u_dimension:[h,h],u_zoom:i.overscaledZ,u_unpack:c.unpackVector}),a.id,d,p,m),o.needsHillshadePrepare=!1}}}else if("translucent"===e.renderPass){const se=_&&e.terrain?e.terrain.stencilModeForRTTOverlap(n):x[n.overscaledZ];mr(e,n,g,r,y,se,v)}}g.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()}},raster:function(r,n,i,o,a,s){if("translucent"===r.renderPass&&0!==i.paint.get("raster-opacity")&&o.length){const d=r.context,p=d.gl,m=n.getSource(),g=r.useProgram("raster"),y=r.colorModeForRenderPass(),v=r.terrain&&r.terrain.renderingToTexture,[_,x]=m instanceof E||v?[{},o]:r.stencilConfigForOverlap(o),e=x[x.length-1].overscaledZ,b=!r.options.moving;for(const o of x){const a=v?se.DepthMode.disabled:r.depthModeForSublayer(o.overscaledZ-e,1===i.paint.get("raster-opacity")?se.DepthMode.ReadWrite:se.DepthMode.ReadOnly,p.LESS),x=o.toUnwrapped(),w=n.getTile(o);if(!v||w&&w.hasData()){var l=v?o.projMatrix:r.transform.calculateProjMatrix(x,b),u=r.terrain&&v?r.terrain.stencilModeForRTTOverlap(o):_[o.overscaledZ],c=s?0:i.paint.get("raster-fade-duration"),h=(w.registerFadeDuration(c),n.findLoadedParent(o,0)),c=Sr(w,h,n,r.transform,c);let e,t;r.terrain&&r.terrain.prepareDrawTile();var f="nearest"===i.paint.get("raster-resampling")?p.NEAREST:p.LINEAR,h=(d.activeTexture.set(p.TEXTURE0),w.texture.bind(f,p.CLAMP_TO_EDGE),d.activeTexture.set(p.TEXTURE1),h?(h.texture.bind(f,p.CLAMP_TO_EDGE),e=Math.pow(2,h.tileID.overscaledZ-w.tileID.overscaledZ),t=[w.tileID.canonical.x*e%1,w.tileID.canonical.y*e%1]):w.texture.bind(f,p.CLAMP_TO_EDGE),Gr(l,t||[0,0],e||1,c,i,m instanceof E?m.perspectiveTransform:[0,0]));if(r.prepareDrawProgram(d,g,x),m instanceof E)m.boundsBuffer&&m.boundsSegments&&g.draw(d,p.TRIANGLES,a,se.StencilMode.disabled,y,se.CullFaceMode.disabled,h,i.id,m.boundsBuffer,r.quadTriangleIndexBuffer,m.boundsSegments);else{const{tileBoundsBuffer:n,tileBoundsIndexBuffer:o,tileBoundsSegments:s}=r.getTileBoundsBuffers(w);g.draw(d,p.TRIANGLES,a,u,y,se.CullFaceMode.disabled,h,i.id,n,o,s)}}}r.resetStencilClippingMasks()}},background:function(r,n,i,o){var a=i.paint.get("background-color"),s=i.paint.get("background-opacity");if(0!==s){var l=r.context,u=l.gl,c=r.transform,h=c.tileSize,f=i.paint.get("background-pattern");if(!r.isPatternMissing(f)){const b=!f&&1===a.a&&1===s&&r.opaquePassEnabledForLayer()?"opaque":"translucent";if(r.renderPass===b){var d=se.StencilMode.disabled,p=r.depthModeForSublayer(0,"opaque"===b?se.DepthMode.ReadWrite:se.DepthMode.ReadOnly),m=r.colorModeForRenderPass(),g=r.useProgram(f?"backgroundPattern":"background");let t,e=o;e||(t=r.getBackgroundTiles(),e=Object.values(t).map(e=>e.tileID)),f&&(l.activeTexture.set(u.TEXTURE0),r.imageManager.bind(r.context));for(const b of e){const e=b.toUnwrapped(),w=o?b.projMatrix:r.transform.calculateProjMatrix(e);r.prepareDrawTile();var y=n?n.getTile(b):t?t[b.key]:new se.Tile(b,h,c.zoom,r),v=f?(_=w,x=s,v={tileID:b,tileSize:h},se.extend(function(e,t,r){var e=t.imageManager.getPattern(e.toString()),{width:n,height:i}=t.imageManager.getPixelSize(),o=Math.pow(2,r.tileID.overscaledZ),a=r.tileSize*Math.pow(2,t.transform.tileZoom)/o,o=a*(r.tileID.canonical.x+r.tileID.wrap*o),a=a*r.tileID.canonical.y;return{u_image:0,u_pattern_tl:e.tl,u_pattern_br:e.br,u_texsize:[n,i],u_pattern_size:e.displaySize,u_tile_units_to_pixels:1/I(r,1,t.transform.tileZoom),u_pixel_coord_upper:[o>>16,a>>16],u_pixel_coord_lower:[65535&o,65535&a]}}(f,r,v),{u_matrix:_,u_opacity:x})):{u_matrix:w,u_opacity:s,u_color:a},{tileBoundsBuffer:_,tileBoundsIndexBuffer:x,tileBoundsSegments:y}=(r.prepareDrawProgram(l,g,e),r.getTileBoundsBuffers(y));g.draw(l,u.TRIANGLES,p,d,m,se.CullFaceMode.disabled,v,i.id,_,x,y)}}}}},sky:function(t,e,r){var n=t.transform,n="mercator"===n.projection.name||"globe"===n.projection.name?1:se.smoothstep(7,8,n.zoom),n=r.paint.get("sky-opacity")*n;if(0!=n){var i=t.context,o=r.paint.get("sky-type"),i=new se.DepthMode(i.gl.LEQUAL,se.DepthMode.ReadOnly,[0,1]),a=t.frameCounter/1e3%1;if("atmosphere"===o)if("offscreen"===t.renderPass){if(r.needsSkyboxCapture(t)){{var s=t;var l=r;var u=s.context,c=u.gl;let e=l.skyboxFbo;if(!e){e=l.skyboxFbo=u.createFramebuffer(32,32,!1),l.skyboxGeometry=new pn(u),l.skyboxTexture=u.gl.createTexture(),c.bindTexture(c.TEXTURE_CUBE_MAP,l.skyboxTexture),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MAG_FILTER,c.LINEAR);for(let e=0;e<6;++e)c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,c.RGBA,32,32,0,c.RGBA,c.UNSIGNED_BYTE,null)}u.bindFramebuffer.set(e.framebuffer),u.viewport.set([0,0,32,32]);var h=l.getCenter(s,!0),f=s.useProgram("skyboxCapture"),d=new Float64Array(16);se.identity(d),se.rotateY(d,d,.5*-Math.PI),_(u,l,f,d,h,0),se.identity(d),se.rotateY(d,d,.5*Math.PI),_(u,l,f,d,h,1),se.identity(d),se.rotateX(d,d,.5*-Math.PI),_(u,l,f,d,h,2),se.identity(d),se.rotateX(d,d,.5*Math.PI),_(u,l,f,d,h,3),se.identity(d),_(u,l,f,d,h,4),se.identity(d),se.rotateY(d,d,Math.PI),_(u,l,f,d,h,5),u.viewport.set([0,0,s.width,s.height])}r.markSkyboxValid(t)}}else"sky"===t.renderPass&&(l=r,f=i,d=n,h=a,s=(u=t).context,m=s.gl,g=u.transform,p=u.useProgram("skybox"),s.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_CUBE_MAP,l.skyboxTexture),g={u_matrix:g.skyboxMatrix,u_sun_direction:l.getCenter(u,!1),u_cubemap:0,u_opacity:d,u_temporal_offset:h},u.prepareDrawProgram(s,p),p.draw(s,m.TRIANGLES,f,se.StencilMode.disabled,u.colorModeForRenderPass(),se.CullFaceMode.backCW,g,"skybox",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment));else if("gradient"===o&&"sky"===t.renderPass){var p=t;var m=r;var g=i;o=n;t=a;r=p.context,i=r.gl,n=p.transform,a=p.useProgram("skyboxGradient");m.skyboxGeometry||(m.skyboxGeometry=new pn(r)),r.activeTexture.set(i.TEXTURE0);let e=m.colorRampTexture;(e=e||(m.colorRampTexture=new se.Texture(r,m.colorRamp,i.RGBA))).bind(i.LINEAR,i.CLAMP_TO_EDGE);n=n.skyboxMatrix,y=m.getCenter(p,!1),v=m.paint.get("sky-gradient-radius"),o=o,t=t;var y,v,n={u_matrix:n,u_color_ramp:0,u_center_direction:y,u_radius:se.degToRad(v),u_opacity:o,u_temporal_offset:t};p.prepareDrawProgram(r,a),a.draw(r,i.TRIANGLES,g,se.StencilMode.disabled,p.colorModeForRenderPass(),se.CullFaceMode.backCW,n,"skyboxGradient",m.skyboxGeometry.vertexBuffer,m.skyboxGeometry.indexBuffer,m.skyboxGeometry.segment)}}},debug:function(n,i,o){for(let r=0;r<o.length;r++){a=void 0;s=void 0;l=void 0;u=void 0;c=void 0;h=void 0;y=void 0;f=void 0;f=void 0;d=void 0;p=void 0;m=void 0;g=void 0;y=void 0;v=void 0;_=void 0;g=void 0;y=void 0;v=void 0;_=void 0;y=void 0;l=void 0;s=void 0;void 0;void 0;v=void 0;c=void 0;l=void 0;var a=n;var s=i;var l=o[r];var u=a.context,c=a.transform,h=u.gl,f=(y="globe"===c.projection.name)?["PROJECTION_GLOBE_VIEW"]:null;let e=l.projMatrix;if(y&&0<se.globeToMercatorTransition(c.zoom)){const a=se.transitionTileAABBinECEF(l.canonical,c),s=se.globeDenormalizeECEF(a);e=se.multiply(new Float32Array(16),c.globeMatrix,s),se.multiply(e,c.projMatrix,e)}var f=a.useProgram("debug",null,f),d=s.getTileByID(l.key),p=(a.terrain&&a.terrain.setupElevationDraw(d,f),se.DepthMode.disabled),m=se.StencilMode.disabled,g=a.colorModeForRenderPass(),y=(u.activeTexture.set(h.TEXTURE0),a.emptyTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE),y?d._makeGlobeTileDebugBuffers(a.context,c):d._makeDebugTileBoundsBuffers(a.context,c.projection),d._tileDebugBuffer||a.debugBuffer),v=d._tileDebugIndexBuffer||a.debugIndexBuffer,_=d._tileDebugSegments||a.debugSegments,g=(f.draw(u,h.LINE_STRIP,p,m,g,se.CullFaceMode.disabled,Br(e,se.Color.red),"$debug",y,v,_,null,null,null,[d._globeTileDebugBorderBuffer]),d.latestRawTileData),y=Math.floor((g&&g.byteLength||0)/1024),v=s.getTile(l).tileSize,_=512/Math.min(v,512)*(l.overscaledZ/c.zoom)*.5;let t=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(t+=" => "+l.overscaledZ),t+=` ${y}kb`,g=a,s=t,g.initDebugOverlayCanvas(),v=g.debugOverlayCanvas,c=g.context.gl,(l=g.debugOverlayCanvas.getContext("2d")).clearRect(0,0,v.width,v.height),l.shadowColor="white",l.shadowBlur=2,l.lineWidth=1.5,l.strokeStyle="white",l.textBaseline="top",l.font="bold 36px Open Sans, sans-serif",l.fillText(s,5,5),l.strokeText(s,5,5),g.debugOverlayTexture.update(v),g.debugOverlayTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),y=d._tileDebugTextBuffer||a.debugBuffer,l=d._tileDebugTextIndexBuffer||a.quadTriangleIndexBuffer,s=d._tileDebugTextSegments||a.debugSegments,f.draw(u,h.TRIANGLES,p,m,se.ColorMode.alphaBlended,se.CullFaceMode.disabled,Br(e,se.Color.transparent,_),"$debug",y,l,s,null,null,null,[d._globeTileDebugTextBuffer])}},custom:function(e,t,r,n){var i=e.context,o=r.implementation;if(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes("custom")||e.terrain&&(e.terrain.renderingToTexture||"offscreen"===e.renderPass)&&r.isLayerDraped()){if("offscreen"===e.renderPass){const t=o.prerender;if(t){if(e.setCustomLayerDefaults(),i.setColorMode(e.colorModeForRenderPass()),"globe"===e.transform.projection.name){const r=e.transform.pointMerc;t.call(o,i.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),se.globeToMercatorTransition(e.transform.zoom),[r.x,r.y],e.transform.pixelsPerMeterRatio)}else t.call(o,i.gl,e.transform.customLayerMatrix());i.setDirty(),e.setBaseState()}}else if("translucent"===e.renderPass)if(e.terrain&&e.terrain.renderingToTexture){const t=o.renderToTile;if(t){const r=n[0].canonical,a=new se.MercatorCoordinate(r.x+n[0].wrap*(1<<r.z),r.y,r.z);i.setDepthMode(se.DepthMode.disabled),i.setStencilMode(se.StencilMode.disabled),i.setColorMode(e.colorModeForRenderPass()),e.setCustomLayerDefaults(),t.call(o,i.gl,a),i.setDirty(),e.setBaseState()}}else{e.setCustomLayerDefaults(),i.setColorMode(e.colorModeForRenderPass()),i.setStencilMode(se.StencilMode.disabled);const t="3d"===o.renderingMode?new se.DepthMode(e.context.gl.LEQUAL,se.DepthMode.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,se.DepthMode.ReadOnly);if(i.setDepthMode(t),"globe"===e.transform.projection.name){const t=e.transform.pointMerc;o.render(i.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),se.globeToMercatorTransition(e.transform.zoom),[t.x,t.y],e.transform.pixelsPerMeterRatio)}else o.render(i.gl,e.transform.customLayerMatrix());i.setDirty(),e.setBaseState(),i.bindFramebuffer.set(null)}}else se.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class vn{constructor(e,t,r=!1){this.context=new Ye(e,r),this.transform=t,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=se.SourceCache.maxUnderzooming+se.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Kt,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(e,t){var r,n=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;(n||this._terrain&&this._terrain.enabled)&&(this._terrain||(this._terrain=new Ar(this,e)),r=this._terrain,this.transform.elevation=n?r:null,r.update(e,this.transform,t))}_updateFog(e){var t,e=e.fog;!e||"globe"===this.transform.projection.name||e.getOpacity(this.transform.pitch)<1||e.properties.get("horizon-blend")<.03?this.transform.fogCullDistSq=null:([e,t]=e.getFovAdjustedRange(this.transform._fov),this.transform.fogCullDistSq=t<e?null:(t=e+.78*(t-e))*t)}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(e,t){if(this.width=e*se.exported.devicePixelRatio,this.height=t*se.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const se of this.style.order)this.style._layers[se].resize()}setup(){var e=this.context,t=new se.StructArrayLayout2i4,t=(t.emplaceBack(0,0),t.emplaceBack(se.EXTENT,0),t.emplaceBack(0,se.EXTENT),t.emplaceBack(se.EXTENT,se.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(t,se.posAttributes.members),this.tileExtentSegments=se.SegmentVector.simpleSegment(0,0,4,2),new se.StructArrayLayout2i4),t=(t.emplaceBack(0,0),t.emplaceBack(se.EXTENT,0),t.emplaceBack(0,se.EXTENT),t.emplaceBack(se.EXTENT,se.EXTENT),this.debugBuffer=e.createVertexBuffer(t,se.posAttributes.members),this.debugSegments=se.SegmentVector.simpleSegment(0,0,4,5),new se.StructArrayLayout2i4),t=(t.emplaceBack(-1,-1),t.emplaceBack(1,-1),t.emplaceBack(-1,1),t.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(t,se.posAttributes.members),this.viewportSegments=se.SegmentVector.simpleSegment(0,0,4,2),new se.StructArrayLayout4i8),t=(t.emplaceBack(0,0,0,0),t.emplaceBack(se.EXTENT,0,se.EXTENT,0),t.emplaceBack(0,se.EXTENT,0,se.EXTENT),t.emplaceBack(se.EXTENT,se.EXTENT,se.EXTENT,se.EXTENT),this.mercatorBoundsBuffer=e.createVertexBuffer(t,se.boundsAttributes.members),this.mercatorBoundsSegments=se.SegmentVector.simpleSegment(0,0,4,2),new se.StructArrayLayout3ui6),r=(t.emplaceBack(0,1,2),t.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(t),new se.StructArrayLayout1ui2);for(const se of[0,1,3,2,0])r.emplaceBack(se);this.debugIndexBuffer=e.createIndexBuffer(r),this.emptyTexture=new se.Texture(e,new se.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),e.gl.RGBA),this.identityMat=se.create();t=this.context.gl;this.stencilClearMode=new se.StencilMode({func:t.ALWAYS,mask:0},0,255,t.ZERO,t.ZERO,t.ZERO),this.loadTimeStamps.push(se.window.performance.now()),this.atmosphereBuffer=new gn(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){var e=this.context,t=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(e,t.TRIANGLES,se.DepthMode.disabled,this.stencilClearMode,se.ColorMode.disabled,se.CullFaceMode.disabled,Tr(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,e,r){if(e&&this.currentStencilSource!==e.id&&t.isTileClipped()&&r&&0!==r.length){if(this._tileClippingMaskIDs&&!this.terrain){let e=!1;for(const t of r)if(void 0===this._tileClippingMaskIDs[t.key]){e=!0;break}if(!e)return}this.currentStencilSource=e.id;var n=this.context,i=n.gl,o=(256<this.nextStencilID+r.length&&this.clearStencil(),n.setColorMode(se.ColorMode.disabled),n.setDepthMode(se.DepthMode.disabled),this.useProgram("clippingMask"));this._tileClippingMaskIDs={};for(const t of r){const r=e.getTile(t),a=this._tileClippingMaskIDs[t.key]=this.nextStencilID++,{tileBoundsBuffer:s,tileBoundsIndexBuffer:l,tileBoundsSegments:u}=this.getTileBoundsBuffers(r);o.draw(n,i.TRIANGLES,se.DepthMode.disabled,new se.StencilMode({func:i.ALWAYS,mask:0},a,255,i.KEEP,i.KEEP,i.REPLACE),se.ColorMode.disabled,se.CullFaceMode.disabled,Tr(t.projMatrix),"$clipping",s,l,u)}}}stencilModeFor3D(){this.currentStencilSource=void 0,256<this.nextStencilID+1&&this.clearStencil();var e=this.nextStencilID++,t=this.context.gl;return new se.StencilMode({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)}stencilModeForClipping(e){var t;return this.terrain?this.terrain.stencilModeForRTTOverlap(e):(t=this.context.gl,new se.StencilMode({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE))}stencilConfigForOverlap(t){var r=this.context.gl,e=t.sort((e,t)=>t.overscaledZ-e.overscaledZ),n=e[e.length-1].overscaledZ,i=e[0].overscaledZ-n+1;if(1<i){this.currentStencilSource=void 0,256<this.nextStencilID+i&&this.clearStencil();const t={};for(let e=0;e<i;e++)t[e+n]=new se.StencilMode({func:r.GEQUAL,mask:255},e+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=i,[t,e]}return[{[n]:se.StencilMode.disabled},e]}colorModeForRenderPass(){var e=this.context.gl;return this._showOverdrawInspector?new se.ColorMode([e.CONSTANT_COLOR,e.ONE],new se.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?se.ColorMode.unblended:se.ColorMode.alphaBlended}depthModeForSublayer(e,t,r){return this.opaquePassEnabledForLayer()?(e=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon,new se.DepthMode(r||this.context.gl.LEQUAL,t,[e,e])):se.DepthMode.disabled}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,e){this.style=n,this.options=e,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(se.exported.now()),this.imageManager.beginFrame();const t=this.style.order,r=this.style._sourceCaches;for(const se in r){const n=r[se];n.used&&n.prepare(this.context)}var i={},o={},a={};for(const se in r){const n=r[se];i[se]=n.getVisibleCoordinates(),o[se]=i[se].slice().reverse(),a[se]=n.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let e=0;e<t.length;e++)if(this.style._layers[t[e]].is3D()){this.opaquePassCutoff=e;break}if(this.terrain&&(this.terrain.updateTileBinding(a),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new se.GlobeSharedBuffers(this.context)),se.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const se of t){const e=this.style._layers[se],t=n._getLayerSourceCache(e);if(e.hasOffscreenPass()&&!e.isHidden(this.transform.zoom)){const r=t?o[t.id]:void 0;("custom"===e.type||e.isSky()||r&&r.length)&&this.renderLayer(this,t,e,r)}}if(this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:e.showOverdrawInspector?se.Color.black:se.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=e.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=t.length-1;0<=this.currentLayer;this.currentLayer--){const se=this.style._layers[t[this.currentLayer]],e=n._getLayerSourceCache(se);if(!se.isSky()){const r=e?o[e.id]:void 0;this._renderTileClippingMasks(se,e,r),this.renderLayer(this,e,se,r)}}if(this.style.fog&&this.transform.projection.supportsFog){e=this;var s=this.style.fog;var l=e.context,u=l.gl,c=e.transform,h=new se.DepthMode(u.LEQUAL,se.DepthMode.ReadOnly,[0,1]),f=e.useProgram("globeAtmosphere",null,"globe"===c.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),d=se.globeToMercatorTransition(c.zoom),p=s.properties.get("color").toArray01(),m=s.properties.get("high-color").toArray01(),g=s.properties.get("space-color").toArray01PremultipliedAlpha(),y=se.identity$1([]);se.rotateY$1(y,y,-se.degToRad(c._center.lng)),se.rotateX$1(y,y,se.degToRad(c._center.lat)),se.rotateZ$1(y,y,c.angle),se.rotateX$1(y,y,-c._pitch);const v=se.fromQuat(new Float32Array(16),y),_=se.mapValue(s.properties.get("star-intensity"),0,1,0,.25),x=se.mapValue(s.properties.get("horizon-blend"),0,1,5e-4,.25),b=se.globeUseCustomAntiAliasing(e,l,c)&&5e-4===x?c.worldSize/(2*Math.PI*1.025)-1:c.globeRadius,w=e.frameCounter/1e3%1,E=se.length(c.globeCenterInViewSpace),T=Math.sqrt(Math.pow(E,2)-Math.pow(b,2)),S=Math.acos(T/E),M={u_frustum_tl:c.frustumCorners.TL,u_frustum_tr:c.frustumCorners.TR,u_frustum_br:c.frustumCorners.BR,u_frustum_bl:c.frustumCorners.BL,u_horizon:c.frustumCorners.horizon,u_transition:d,u_fadeout_range:x,u_color:p,u_high_color:m,u_space_color:g,u_star_intensity:_,u_star_size:5*se.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:w,u_horizon_angle:S,u_rotation_matrix:v};e.prepareDrawProgram(l,f);y=e.atmosphereBuffer;y&&f.draw(l,u.TRIANGLES,h,se.StencilMode.disabled,se.ColorMode.alphaBlended,se.CullFaceMode.backCW,M,"skybox",y.vertexBuffer,y.indexBuffer,y.segments)}if(this.renderPass="sky",(0<se.globeToMercatorTransition(this.transform.zoom)||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<t.length;this.currentLayer++){const se=this.style._layers[t[this.currentLayer]],e=n._getLayerSourceCache(se);se.isSky()&&this.renderLayer(this,e,se,e?o[e.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<t.length;){const se=this.style._layers[t[this.currentLayer]],e=n._getLayerSourceCache(se);if(se.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(se))se.isHidden(this.transform.zoom)?++this.currentLayer:this.currentLayer=this.terrain.renderBatch(this.currentLayer);else{const r=e?("symbol"===se.type?a:o)[e.id]:void 0;this._renderTileClippingMasks(se,e,e?i[e.id]:void 0),this.renderLayer(this,e,se,r),++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let r=null;se.values(this.style._layers).forEach(e=>{var t=n._getLayerSourceCache(e);t&&!e.isHidden(this.transform.zoom)&&(!r||r.getSource().maxzoom<t.getSource().maxzoom)&&(r=t)}),r&&this.options.showTileBoundaries&&yn.debug(this,r,r.getVisibleCoordinates())}this.options.showPadding&&(c=(s=this).transform.padding,un(s,s.transform.height-(c.top||0),3,nn),un(s,c.bottom||0,3,on),cn(s,c.left||0,3,an),cn(s,s.transform.width-(c.right||0),3,sn),c=s.transform.centerPoint,d=s,p=c.x,s=s.transform.height-c.y,c=ln,hn(d,p-1,s-10,2,20,c),hn(d,p-10,s-1,20,2,c)),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(se.window.performance.now()),this.saveCanvasCopy())}}renderLayer(e,t,r,n){r.isHidden(this.transform.zoom)||("background"===r.type||"sky"===r.type||"custom"===r.type||n&&n.length)&&(this.id=r.id,this.gpuTimingStart(r),e.transform.projection.unsupportedLayers&&e.transform.projection.unsupportedLayers.includes(r.type)&&(!e.terrain||"custom"!==r.type)||yn[r.type](e,t,r,n,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(this.options.gpuTiming){var r=this.context.extTimerQuery;let e=this.gpuTimers[t.id];(e=e||(this.gpuTimers[t.id]={calls:0,cpuTime:0,query:r.createQueryEXT()})).calls++,r.beginQueryEXT(r.TIME_ELAPSED_EXT,e.query)}}gpuTimingDeferredRenderStart(){var e,t;this.options.gpuTimingDeferredRender&&(t=(e=this.context.extTimerQuery).createQueryEXT(),this.deferredRenderGpuTimeQueries.push(t),e.beginQueryEXT(e.TIME_ELAPSED_EXT,t))}gpuTimingDeferredRenderEnd(){var e;this.options.gpuTimingDeferredRender&&(e=this.context.extTimerQuery).endQueryEXT(e.TIME_ELAPSED_EXT)}gpuTimingEnd(){var e;this.options.gpuTiming&&(e=this.context.extTimerQuery).endQueryEXT(e.TIME_ELAPSED_EXT)}collectGpuTimers(){var e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){var e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){var t={};for(const o in e){var r=e[o],n=this.context.extTimerQuery,i=n.getQueryObjectEXT(r.query,n.QUERY_RESULT_EXT)/1e6;n.deleteQueryEXT(r.query),t[o]=i}return t}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;var t=this.context.extTimerQuery;let r=0;for(const n of e)r+=t.getQueryObjectEXT(n,t.QUERY_RESULT_EXT)/1e6,t.deleteQueryEXT(n);return r}translatePosMatrix(e,t,r,n,i){if(!r[0]&&!r[1])return e;n=i?"map"===n?this.transform.angle:0:"viewport"===n?-this.transform.angle:0;if(n){const se=Math.sin(n),e=Math.cos(n);r=[r[0]*e-r[1]*se,r[0]*se+r[1]*e]}n=[i?r[0]:I(t,r[0],this.transform.zoom),i?r[1]:I(t,r[1],this.transform.zoom),0],i=new Float32Array(16);return se.translate(i,e,n),i}saveTileTexture(e){var t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){e=this._tileTextures[e];return e&&0<e.length?e.pop():null}isPatternMissing(e){return null===e||void 0!==e&&!this.imageManager.getPattern(e.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){var e=this.terrain&&this.terrain.renderingToTexture,t=this.terrain&&0===this.terrain.exaggeration(),r=this.style&&this.style.fog,n=[];return this.terrainRenderModeElevated()&&n.push("TERRAIN"),"globe"===this.transform.projection.name&&n.push("GLOBE"),t&&n.push("ZERO_EXAGGERATION"),r&&!e&&0!==r.getOpacity(this.transform.pitch)&&n.push("FOG"),e&&n.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&n.push("OVERDRAW_INSPECTOR"),n}useProgram(e,t,r){this.cache=this.cache||{};var r=r||[],r=this.currentGlobalDefines().concat(r),n=Ir.cacheKey(dr[e],e,r,t);return this.cache[n]||(this.cache[n]=new Ir(this.context,e,dr[e],t,Hr[e],r)),this.cache[n]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){var e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=se.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new se.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(e,t,r){var n,i,o,a,s,l,u,c,h,f,d,p;this.terrain&&this.terrain.renderingToTexture||(i=this.style.fog)&&(o=i.getOpacity(this.transform.pitch),i=i,r=r,o=o,a=(n=this).transform.frustumCorners.TL,s=this.transform.frustumCorners.TR,l=this.transform.frustumCorners.BR,u=this.transform.frustumCorners.BL,c=this.transform.globeCenterInViewSpace,h=this.transform.globeRadius,f=[this.transform.width*se.exported.devicePixelRatio,this.transform.height*se.exported.devicePixelRatio],d=n.transform,(p=i.properties.get("color").toArray01())[3]=o,o=n.frameCounter/1e3%1,r={u_fog_matrix:r?d.calculateFogTileMatrix(r):n.identityMat,u_fog_range:i.getFovAdjustedRange(d._fov),u_fog_color:p,u_fog_horizon_blend:i.properties.get("horizon-blend"),u_fog_temporal_offset:o,u_frustum_tl:a,u_frustum_tr:s,u_frustum_br:l,u_frustum_bl:u,u_globe_pos:c,u_globe_radius:h,u_viewport:f,u_globe_transition:se.globeToMercatorTransition(d.zoom),u_is_globe:+("globe"===d.projection.name)},t.setFogUniformValues(e,r))}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){var e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){var e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){var e;return!!this.transform._elevation&&(!!(e=this.style&&this.style.fog)&&0!==e.getOpacity(this.transform.pitch))}getBackgroundTiles(){var e=this._backgroundTiles,t=this._backgroundTiles={};for(const r of this.transform.coveringTiles({tileSize:512}))t[r.key]=e[r.key]||new se.Tile(r,512,this.transform.tileZoom,this);return t}clearBackgroundTiles(){this._backgroundTiles={}}}class _n{constructor(e=0,t=0,r=0,n=0){if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(r)||r<0||isNaN(n)||n<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=r,this.right=n}interpolate(e,t,r){return null!=t.top&&null!=e.top&&(this.top=se.number(e.top,t.top,r)),null!=t.bottom&&null!=e.bottom&&(this.bottom=se.number(e.bottom,t.bottom,r)),null!=t.left&&null!=e.left&&(this.left=se.number(e.left,t.left,r)),null!=t.right&&null!=e.right&&(this.right=se.number(e.right,t.right,r)),this}getCenter(e,t){e=se.clamp((this.left+e-this.right)/2,0,e),t=se.clamp((this.top+t-this.bottom)/2,0,t);return new se.pointGeometry(e,t)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new _n(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function xn(e,t){var r=se.getColumn(e,3);se.fromQuat(e,t),se.setColumn(e,3,r)}function bn(e,t){var r=se.identity$1([]);return se.rotateZ$1(r,r,-t),se.rotateX$1(r,r,-e),r}function wn(e,t){var r=[e[0],e[1],0],n=[t[0],t[1],0];if(1e-15<=se.length(r)){const e=se.normalize([],r);se.scale$2(n,e,se.dot(n,e)),t[0]=n[0],t[1]=n[1]}r=se.cross([],t,e);return se.len(r)<1e-15?null:(n=Math.atan2(-r[1],r[0]),bn(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),n))}class En{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(e){e?(e=e instanceof se.MercatorCoordinate?e:new se.MercatorCoordinate(e[0],e[1],e[2]),this._renderWorldCopies&&(e.x=se.wrap(e.x,0,1)),this._position=e):this._position=null}lookAtPoint(e,t){var r,n;this.orientation=null,this.position&&(n=this._elevation?this._elevation.getAtPointOrZero(se.MercatorCoordinate.fromLngLat(e)):0,r=this.position,n=[(e=se.MercatorCoordinate.fromLngLat(e,n)).x-r.x,e.y-r.y,e.z-r.z],(t=t||[0,0,1])[2]=Math.abs(t[2]),this.orientation=wn(n,t))}setPitchBearing(e,t){this.orientation=bn(se.degToRad(e),se.degToRad(-t))}}class Tn{constructor(e,t){this._transform=se.identity([]),this.orientation=t,this.position=e}get mercatorPosition(){var e=this.position;return new se.MercatorCoordinate(e[0],e[1],e[2])}get position(){var e=se.getColumn(this._transform,3);return[e[0],e[1],e[2]]}set position(e){e&&se.setColumn(this._transform,3,[e[0],e[1],e[2],1])}get orientation(){return this._orientation}set orientation(e){this._orientation=e||se.identity$1([]),e&&xn(this._transform,this._orientation)}getPitchBearing(){var e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=bn(e,t),xn(this._transform,this._orientation)}forward(){var e=se.getColumn(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){var e=se.getColumn(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){var e=se.getColumn(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(e,t){var r=new Float64Array(16);return se.invert(r,this.getWorldToCamera(e,t)),r}getWorldToCameraPosition(e,t,r){var n=this.position,e=(se.scale$2(n,n,-e),new Float64Array(16));return se.fromScaling(e,[r,r,r]),se.translate(e,e,n),e[10]*=t,e}getWorldToCamera(e,t){var r=new Float64Array(16),n=new Float64Array(4),i=this.position;return se.conjugate(n,this._orientation),se.scale$2(i,i,-e),se.fromQuat(r,n),se.translate(r,r,i),r[1]*=-1,r[5]*=-1,r[9]*=-1,r[13]*=-1,r[8]*=t,r[9]*=t,r[10]*=t,r[11]*=t,r}getCameraToClipPerspective(e,t,r,n){var i=new Float64Array(16);return se.perspective(i,e,t,r,n),i}getDistanceToElevation(e,t=!1){e=0===e?0:se.mercatorZfromAltitude(e,t?se.latFromMercatorY(this.position[1]):this.position[1]),t=this.forward();return(e-this.position[2])/t[2]}clone(){return new Tn([...this.position],[...this.orientation])}}function Sn(e,t){var r,n,i,o,a=kn(e.projection,e.zoom,e.width,e.height),t=(s=e.projection,r=e.center,a=a,t=t,n=new se.LngLat(r.lng-180*k,r.lat),i=new se.LngLat(r.lng+180*k,r.lat),n=s.project(n.lng,n.lat),i=s.project(i.lng,i.lat),i=-Math.atan2(i.y-n.y,i.x-n.x),(n=se.MercatorCoordinate.fromLngLat(r)).y=se.clamp(n.y,-.999975,.999975),r=n.toLngLat(),n=s.project(r.lng,r.lat),(o=se.MercatorCoordinate.fromLngLat(r)).x+=k,o=o.toLngLat(),o=An((o=s.project(o.lng,o.lat)).x-n.x,o.y-n.y,i),(r=se.MercatorCoordinate.fromLngLat(r)).y+=k,r=r.toLngLat(),s=s.project(r.lng,r.lat),r=An(s.x-n.x,s.y-n.y,i),s=Math.abs(o.x)/Math.abs(r.y),n=se.identity([]),se.rotateZ(n,n,-i*(1-(t?0:a))),o=se.identity([]),se.scale(o,o,[1,1-(1-s)*a,1]),o[4]=-r.x/r.y*a,se.rotateZ(o,o,i),se.multiply(o,n,o),o),s=Mn(e);return se.scale(t,t,[s,s,1]),t}function Mn(e){var t=e.projection,r=kn(e.projection,e.zoom,e.width,e.height),e=Cn(t,e.center),t=Cn(t,se.LngLat.convert(t.center));return Math.pow(2,e*r+(1-r)*t)}function kn(e,t,r,n,i=1/0){e=e.range;return e?(i=Math.min(i,Math.max(r,n)),r=Math.log(i/1024)/Math.LN2,se.smoothstep(e[0]+r,e[1]+r,t)):0}const k=25e-6;function Cn(e,t){var r=se.clamp(t.lat,-se.MAX_MERCATOR_LATITUDE,se.MAX_MERCATOR_LATITUDE),n=new se.LngLat(t.lng-180*k,r),t=new se.LngLat(t.lng+180*k,r),i=e.project(n.lng,r),e=e.project(t.lng,r),r=se.MercatorCoordinate.fromLngLat(n),n=se.MercatorCoordinate.fromLngLat(t),t=e.x-i.x,e=e.y-i.y,i=n.x-r.x,n=n.y-r.y,r=Math.sqrt((i*i+n*n)/(t*t+e*e));return Math.log(r)/Math.LN2}function An(e,t,r){var n=Math.cos(r),r=Math.sin(r);return{x:e*n-t*r,y:e*r+t*n}}class In{constructor(e,t,r,n,i,o,a){this.tileSize=512,this._renderWorldCopies=void 0===i||i,this._minZoom=e||0,this._maxZoom=t||22,this._minPitch=null==r?0:r,this._maxPitch=null==n?60:n,this.setProjection(o),this.setMaxBounds(a),this.width=0,this.height=0,this._center=new se.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new _n,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Tn,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){var e=new In(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(e,t=!1){var r=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;null!=this._seaLevelZoom&&!r||this._updateCameraOnTerrain(),(e||r)&&this._constrainCamera(t),this._calcMatrices()}getProjection(){return se.pick(this.projection,["name","center","parallels"])}setProjection(e){this.projectionOptions=e||{name:"mercator"};e=this.projection?this.getProjection():void 0,this.projection=se.getProjection(this.projectionOptions),e=!x(e,this.getProjection());return e&&this._calcMatrices(),this.mercatorFromTransition=!1,e}setMercatorFromTransition(){var e=this.projection.name,e=(this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=se.getProjection({name:"mercator"}),e!==this.projection.name);return e&&this._calcMatrices(),e}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){var e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){var e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return se.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new se.pointGeometry(this.width,this.height)}get bearing(){return se.wrap(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(e){var t,r,n,i,o,a,e=-e*Math.PI/180;this.angle!==e&&(this._unmodified=!1,this.angle=e,this._calcMatrices(),this.rotationMatrix=(e=new se.ARRAY_TYPE(4),se.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e),e=this.rotationMatrix,t=this.rotationMatrix,r=this.angle,n=t[0],i=t[1],o=t[2],t=t[3],a=Math.sin(r),r=Math.cos(r),e[0]=n*r+o*a,e[1]=i*r+t*a,e[2]=n*-a+o*r,e[3]=i*-a+t*r)}get pitch(){return this._pitch/Math.PI*180}set pitch(e){e=se.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==e&&(this._unmodified=!1,this._pitch=e,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){var e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=se.degToRad(e),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){e=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._setZoom(e),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}_updateCameraOnTerrain(){var e;this._elevation&&this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center))?(e=this._elevation,this._centerAltitude=e.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=e.exaggeration(),this._updateSeaLevelZoom()):(this._centerAltitude=0,this._seaLevelZoom=null,this._centerAltitudeValidForExaggeration=void 0)}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;var t=this._elevation,r=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],n=this.horizonLineFromTop();let i=0,o=0;for(let e=0;e<r.length;e++){var a,s=new se.pointGeometry(r[e][0]*this.width,n+r[e][1]*(this.height-n)),s=t.pointCoordinate(s);s&&(a=1/Math.hypot(s[0]-this._camera.position[0],s[1]-this._camera.position[1]),i+=s[3]*a,o+=a)}return 0===o?NaN:i/o}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){var e,t,r;null!=this._seaLevelZoom&&this._elevation&&(r=this._seaLevelZoom,e=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),e=this.pixelsPerMeter/this.worldSize*e,r=this._mercatorZfromZoom(r),t=this._mercatorZfromZoom(this._maxZoom),r=Math.max(r-e,t),this._setZoom(this._zoomFromMercatorZ(r)))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(e){var t=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude())),t=e.z<this._camera.position[2]?[t.x,t.y,t.z]:[e.x,e.y,e.z],e=se.length(se.sub([],this._camera.position,t));return se.clamp(this._zoomFromMercatorZ(e),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(this.height&&(t.position||t.orientation)){this._updateCameraState();let e=!1;t.orientation&&!se.exactEquals(t.orientation,this._camera.orientation)&&(e=this._setCameraOrientation(t.orientation)),t.position&&(t=[t.position.x,t.position.y,t.position.z],se.exactEquals$1(t,this._camera.position)||(this._setCameraPosition(t),e=!0)),e&&(this._updateStateFromCamera(),this.recenterOnTerrain())}}getFreeCameraOptions(){this._updateCameraState();var e=this._camera.position,t=new En;return t.position=new se.MercatorCoordinate(e[0],e[1],e[2]),t.orientation=this._camera.orientation,t._elevation=this.elevation,t._renderWorldCopies=this.renderWorldCopies,t}_setCameraOrientation(e){if(!se.length$1(e))return!1;se.normalize$1(e,e);var t=se.transformQuat([],[0,0,-1],e),e=se.transformQuat([],[0,-1,0],e);return!(e[2]<0)&&(!!(t=wn(t,e))&&(this._camera.orientation=t,!0))}_setCameraPosition(e){var t=this.zoomScale(this.minZoom)*this.tileSize,r=this.zoomScale(this.maxZoom)*this.tileSize,n=this.cameraToCenterDistance;e[2]=se.clamp(e[2],n/r,n/t),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,r){this._unmodified=!1,this._edgeInsets.interpolate(e,t,r),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){e=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,e)}getVisibleUnwrappedCoordinates(t){var r=[new se.UnwrappedTileID(0,t)];if(this.renderWorldCopies){var e=this.pointCoordinate(new se.pointGeometry(0,0)),n=this.pointCoordinate(new se.pointGeometry(this.width,0)),i=this.pointCoordinate(new se.pointGeometry(this.width,this.height)),o=this.pointCoordinate(new se.pointGeometry(0,this.height)),a=Math.floor(Math.min(e.x,n.x,i.x,o.x)),s=Math.floor(Math.max(e.x,n.x,i.x,o.x));for(let e=a-1;e<=s+1;e++)0!==e&&r.push(new se.UnwrappedTileID(e,t))}return r}coveringTiles(s){let l=this.coveringZoomLevel(s);const u=l,c=this.elevation&&!s.isTerrainDEM,n="mercator"===this.projection.name;if(void 0!==s.minzoom&&l<s.minzoom)return[];void 0!==s.maxzoom&&l>s.maxzoom&&(l=s.maxzoom);const r=this.locationCoordinate(this.center),h=this.center.lat,i=1<<l,o=[i*r.x,i*r.y,0],f="globe"===this.projection.name,e=!f,a=se.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,e),t=f?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),d=i*se.mercatorZfromAltitude(1,this.center.lat),p=this._camera.position[2]/se.mercatorZfromAltitude(1,this.center.lat),m=[i*t.x,i*t.y,p*(e?1:d)],g=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),y=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?l:0,v=s.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,_=s.isTerrainDEM?-v:this._elevation?this._elevation.getMinElevationBelowMSL():0,x=this.projection.isReprojectedInTileSpace?Mn(this):1,b=e=>{var t=new se.MercatorCoordinate(e.x+25e-6,e.y,e.z),r=new se.MercatorCoordinate(e.x,e.y+25e-6,e.z),e=e.toLngLat(),t=t.toLngLat(),r=r.toLngLat(),e=this.locationCoordinate(e),t=this.locationCoordinate(t),r=this.locationCoordinate(r),t=Math.hypot(t.x-e.x,t.y-e.y),r=Math.hypot(r.x-e.x,r.y-e.y);return Math.sqrt(t*r)*x/25e-6},w=e=>{var t=v,r=_;return{aabb:se.tileAABB(this,i,0,0,0,e,r,t,this.projection),zoom:0,x:0,y:0,minZ:r,maxZ:t,wrap:e,fullyVisible:!1}},E=[];let T=[];const S=l,M=s.reparseOverscaled?u:l,k=e=>e*e,C=k((p-this._centerAltitude)*d),A=e=>{var t,r;this._elevation&&e.tileID&&n&&(t=this._elevation.getMinMaxForTile(e.tileID),r=e.aabb,t?(r.min[2]=t.min,r.max[2]=t.max,r.center[2]=(r.min[2]+r.max[2])/2):(e.shouldSplit=I(e),e.shouldSplit||(r.min[2]=r.max[2]=r.center[2]=this._centerAltitude)))},I=e=>{if(e.zoom<y)return!0;if(e.zoom===S)return!1;if(null!=e.shouldSplit)return e.shouldSplit;const t=e.aabb.distanceX(m),r=e.aabb.distanceY(m);let n=C,i=1;if(f){n=k(e.aabb.distanceZ(m));const t=Math.pow(2,e.zoom),u=se.latFromMercatorY((e.y+1)/t),c=se.latFromMercatorY(e.y/t),r=Math.min(Math.max(h,u),c),o=se.circumferenceAtLatitude(r)/se.circumferenceAtLatitude(h);if(i=r===h?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,o/this._mercatorScaleRatio),this.zoom<=se.GLOBE_ZOOM_THRESHOLD_MIN&&e.zoom===S-1&&.9<=o)return!0}else if(c&&(n=k(e.aabb.distanceZ(m)*d)),this.projection.isReprojectedInTileSpace&&u<=5){const t=Math.pow(2,e.zoom),u=b(new se.MercatorCoordinate((e.x+.5)/t,(e.y+.5)/t));i=.85<u?1:u}const o=t*t+r*r+n,a=k((1<<S-e.zoom)*g*i*(e=Math.max(n,C),(s=o)*k(.707)<e?1:(s=Math.sqrt(s/e))/(1.4144271570014144+(Math.pow(1.1,s-1.4144271570014144+1)-1)/(1.1-1)-1)));var s;return o<a};if(this.renderWorldCopies)for(let e=1;e<=3;e++)E.push(w(-e)),E.push(w(e));for(E.push(w(0));0<E.length;){const u=E.pop(),r=u.x,h=u.y;let t=u.fullyVisible;if(!t){const se=u.aabb.intersects(a);if(0===se)continue;t=2===se}if(u.zoom!==S&&I(u))for(let e=0;e<4;e++){const l=(r<<1)+e%2,o=(h<<1)+(e>>1),a={aabb:n?u.aabb.quadrant(e):se.tileAABB(this,i,u.zoom+1,l,o,u.wrap,u.minZ,u.maxZ,this.projection),zoom:u.zoom+1,x:l,y:o,wrap:u.wrap,fullyVisible:t,tileID:void 0,shouldSplit:void 0,minZ:u.minZ,maxZ:u.maxZ};c&&!f&&(a.tileID=new se.OverscaledTileID(u.zoom+1===S?M:u.zoom+1,u.wrap,u.zoom+1,l,o),A(a)),E.push(a)}else{const c=u.zoom===S?M:u.zoom;if(!(s.minzoom&&s.minzoom>c)){const n=o[0]-(.5+r+(u.wrap<<u.zoom))*(1<<l-u.zoom),i=o[1]-.5-h,f=u.tileID||new se.OverscaledTileID(c,u.wrap,u.zoom,r,h);T.push({tileID:f,distanceSq:n*n+i*i})}}}if(this.fogCullDistSq){const l=this.fogCullDistSq,u=this.horizonLineFromTop();T=T.filter(t=>{const e=[0,0,0,1],r=[se.EXTENT,se.EXTENT,0,1],n=this.calculateFogTileMatrix(t.tileID.toUnwrapped());se.transformMat4$1(e,e,n),se.transformMat4$1(r,r,n);var i=se.getAABBPointSquareDist(e,r);if(0===i)return!0;let o=!1;var a=this._elevation;if(a&&i>l&&0!==u){const l=this.calculateProjMatrix(t.tileID.toUnwrapped());let e;e=(e=s.isTerrainDEM?e:a.getMinMaxForTile(t.tileID))||{min:_,max:v};const r=se.furthestTileCorner(this.rotation),n=[r[0]*se.EXTENT,r[1]*se.EXTENT,e.max];se.transformMat4(n,n,l),o=(1-n[1])*this.height*.5<u}return i<l||o})}return T.sort((e,t)=>e.distanceSq-t.distanceSq).map(e=>e.tileID)}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){var t=se.clamp(e.lat,-se.MAX_MERCATOR_LATITUDE,se.MAX_MERCATOR_LATITUDE),e=this.projection.project(e.lng,t);return new se.pointGeometry(e.x*this.worldSize,e.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/se.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(e,t){let r,n;var i=this.centerPoint;if("globe"===this.projection.name){const se=this.worldSize;r=(t.x-i.x)/se,n=(t.y-i.y)/se}else{const se=this.pointCoordinate(t),e=this.pointCoordinate(i);r=se.x-e.x,n=se.y-e.y}t=this.locationCoordinate(e);this.setLocation(new se.MercatorCoordinate(t.x-r,t.y-n))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e){return this.projection.locationPoint(this,e)}locationPoint3D(e){return this.projection.locationPoint(this,e,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(e,t){t=t?se.mercatorZfromAltitude(t,e.lat):void 0,e=this.projection.project(e.lng,e.lat);return new se.MercatorCoordinate(e.x,e.y,t)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(e,t){var t=null!=t?t:this._centerAltitude,r=[e.x,e.y,0,1],e=[e.x,e.y,1,1],n=(se.transformMat4$1(r,r,this.pixelMatrixInverse),se.transformMat4$1(e,e,this.pixelMatrixInverse),e[3]),n=(se.scale$1(r,r,1/r[3]),se.scale$1(e,e,1/n),r[2]),i=e[2];return{p0:r,p1:e,t:n===i?0:(t-n)/(i-n)}}screenPointToMercatorRay(e){var t=[e.x,e.y,0,1],e=[e.x,e.y,1,1];return se.transformMat4$1(t,t,this.pixelMatrixInverse),se.transformMat4$1(e,e,this.pixelMatrixInverse),se.scale$1(t,t,1/t[3]),se.scale$1(e,e,1/e[3]),t[2]=se.mercatorZfromAltitude(t[2],this._center.lat)*this.worldSize,e[2]=se.mercatorZfromAltitude(e[2],this._center.lat)*this.worldSize,se.scale$1(t,t,1/this.worldSize),se.scale$1(e,e,1/this.worldSize),new se.Ray([t[0],t[1],t[2]],se.normalize([],se.sub([],e,t)))}rayIntersectionCoordinate(e){var{p0:e,p1:t,t:r}=e,n=se.mercatorZfromAltitude(e[2],this._center.lat),i=se.mercatorZfromAltitude(t[2],this._center.lat);return new se.MercatorCoordinate(se.number(e[0],t[0],r)/this.worldSize,se.number(e[1],t[1],r)/this.worldSize,se.number(n,i,r))}pointCoordinate(e,t=this._centerAltitude){return this.projection.pointCoordinate(this,e.x,e.y,t)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let r=this.projection.pointCoordinate3D(this,t.x,t.y);if(r)return new se.MercatorCoordinate(r[0],r[1],r[2]);let n=0,i=this.horizonLineFromTop();if(t.y>i)return this.pointCoordinate(t);var o=.02*i,a=t.clone();for(let e=0;e<10&&i-n>o;e++){a.y=se.number(n,i,.66);const t=this.projection.pointCoordinate3D(this,a.x,a.y);t?(i=a.y,r=t):n=a.y}return r?new se.MercatorCoordinate(r[0],r[1],r[2]):this.pointCoordinate(t)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}_coordinatePoint(e,t){t=t&&this.elevation?this.elevation.getAtPointOrZero(e,this._centerAltitude):this._centerAltitude,t=[e.x*this.worldSize,e.y*this.worldSize,t+e.toAltitude(),1];return se.transformMat4$1(t,t,this.pixelMatrix),0<t[3]?new se.pointGeometry(t[0]/t[3],t[1]/t[3]):new se.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:e,left:t}=this._edgeInsets,r=this.height-this._edgeInsets.bottom,n=this.width-this._edgeInsets.right,i=this.pointLocation3D(new se.pointGeometry(t,e)),o=this.pointLocation3D(new se.pointGeometry(n,e)),a=this.pointLocation3D(new se.pointGeometry(n,r)),s=this.pointLocation3D(new se.pointGeometry(t,r));let c=Math.min(i.lng,o.lng,a.lng,s.lng),h=Math.max(i.lng,o.lng,a.lng,s.lng),f=Math.min(i.lat,o.lat,a.lat,s.lat),d=Math.max(i.lat,o.lat,a.lat,s.lat);const p=Math.pow(2,-this.zoom)/16*270,m="globe"===this.projection.name?1:4,g=(e,t,r,n,i)=>{var o=(e+r)/2,a=(t+n)/2,s=new se.pointGeometry(o,a),{lng:s,lat:l}=this.pointLocation3D(s),u=Math.max(0,c-s,f-l,s-h,l-d);c=Math.min(c,s),h=Math.max(h,s),f=Math.min(f,l),d=Math.max(d,l),(i<m||u>p)&&(g(e,t,o,a,i+1),g(o,a,r,n,i+1))};if(g(t,e,n,e,1),g(n,e,n,r,1),g(n,r,t,r,1),g(t,r,t,e,1),"globe"===this.projection.name){const[e,t]=se.polesInViewport(this);e?(d=90,h=180,c=-180):t&&(f=-90,h=180,c=-180)}return new se.LngLatBounds(new se.LngLat(c,f),new se.LngLat(h,d))}_getBoundsRectangular(e,t){var{top:r,left:n}=this._edgeInsets,i=this.height-this._edgeInsets.bottom,o=this.width-this._edgeInsets.right,a=new se.pointGeometry(n,r),r=new se.pointGeometry(o,r),o=new se.pointGeometry(o,i),n=new se.pointGeometry(n,i);let s=this.pointCoordinate(a,e),l=this.pointCoordinate(r,e);i=this.pointCoordinate(o,t),a=this.pointCoordinate(n,t),r=(e,t)=>(t.y-e.y)/(t.x-e.x);return 1<s.y&&0<=l.y?s=new se.MercatorCoordinate((1-a.y)/r(a,s)+a.x,1):s.y<0&&l.y<=1&&(s=new se.MercatorCoordinate(-a.y/r(a,s)+a.x,0)),1<l.y&&0<=s.y?l=new se.MercatorCoordinate((1-i.y)/r(i,l)+i.x,1):l.y<0&&s.y<=1&&(l=new se.MercatorCoordinate(-i.y/r(i,l)+i.x,0)),(new se.LngLatBounds).extend(this.coordinateLocation(s)).extend(this.coordinateLocation(l)).extend(this.coordinateLocation(a)).extend(this.coordinateLocation(i))}_getBoundsRectangularTerrain(){var e,t=this.elevation;return!t.visibleDemTiles.length||t.isUsingMockSource()?this._getBoundsRectangular(0,0):(e=t.visibleDemTiles.reduce((e,t)=>{return t.dem&&(t=t.dem.tree,e.min=Math.min(e.min,t.minimums[0]),e.max=Math.max(e.max,t.maximums[0])),e},{min:Number.MAX_VALUE,max:0}),this._getBoundsRectangular(e.min*t.exaggeration(),e.max*t.exaggeration()))}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(e=!0){var t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,t=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,t):t}getMaxBounds(){return this.maxBounds}setMaxBounds(e){this.maxBounds=e,this.minLat=-se.MAX_MERCATOR_LATITUDE,this.maxLat=se.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,e&&(this.minLat=e.getSouth(),this.maxLat=e.getNorth(),this.minLng=e.getWest(),this.maxLng=e.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=se.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=se.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=se.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=se.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,t){return this.projection.createTileMatrix(this,t,e)}calculateDistanceTileData(e){var t,r,n,i,o,a,s=e.key,l=this._distanceTileDataCache;return l[s]||(n=e.canonical,t=1/this.height,r=(a=this.cameraWorldSize)/this.zoomScale(n.z),e=(n.x+Math.pow(2,n.z)*e.wrap)*r,n=n.y*r,(i=this.point).x*=a/this.worldSize,i.y*=a/this.worldSize,a=this.angle,o=Math.sin(-a),a=-Math.cos(-a),l[s]={bearing:[o,a],center:[(i.x-e)*t,(i.y-n)*t],scale:r/se.EXTENT*t}),l[s]}calculateFogTileMatrix(e){var t=e.key,r=this._fogTileMatrixCache;return r[t]||(e=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,e),se.multiply(e,this.worldToFogMatrix,e),r[t]=new Float32Array(e)),r[t]}calculateProjMatrix(e,t=!1){var r=e.key,n=t?this._alignedProjMatrixCache:this._projMatrixCache;return n[r]||(e=this.calculatePosMatrix(e,this.worldSize),se.multiply(e,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:t?this.alignedProjMatrix:this.projMatrix,e),n[r]=new Float32Array(e)),n[r]}calculatePixelsToTileUnitsMatrix(e){var t,r,n,i,o,a,s=e.tileID.key,l=this._pixelsToTileUnitsCache;return l[s]||(t=this,r=(r=e.tileTransform.scale)*se.EXTENT/(e.tileSize*Math.pow(2,t.zoom-e.tileID.overscaledZ+e.tileID.canonical.z)),e=new Float32Array(4),n=(t=t.inverseAdjustmentMatrix)[1],i=t[2],o=t[3],a=(r=[r,r])[1],e[0]=t[0]*(t=r[0]),e[1]=n*t,e[2]=i*a,e[3]=o*a,l[s]=e),l[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){var e;if("globe"===this.projection.name)return e=1/this.worldSize,e=se.fromScaling([],[e,e,e]),se.multiply(e,e,this.globeMatrix),e}recenterOnTerrain(){if(this._elevation&&"globe"!==this.projection.name){const t=this._elevation,r=(this._updateCameraState(),se.mercatorZfromAltitude(1,this._center.lat)*this.worldSize),n=this._computeCameraPosition(r),i=this._camera.forward(),o=se.mercatorZfromAltitude(1,this._center.lat);n[2]/=o,i[2]/=o,se.normalize(i,i);var e=t.raycast(n,i,t.exaggeration());if(e){const t=se.scaleAndAdd([],n,i,e),r=new se.MercatorCoordinate(t[0],t[1],se.mercatorZfromAltitude(t[2],se.latFromMercatorY(t[1]))),a=(r.z+se.length([r.x-n[0],r.y-n[1],r.z-n[2]*o]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(a),this._centerAltitude=r.toAltitude(),this._center=this.coordinateLocation(r),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}}_constrainCamera(e=!1){if(this._elevation){const t=this._elevation,r=se.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(r),i=t.getAtPointOrZero(new se.MercatorCoordinate(...n)),o=this.pixelsPerMeter/this.worldSize*i,a=this._minimumHeightOverTerrain(),s=n[2]-o;if(s<=a)if(s<0||e){const e=this.locationCoordinate(this._center,this._centerAltitude),t=[n[0],n[1],e.z-n[2]],r=se.length(t),i=(t[2]-=(a-s)/this._pixelsPerMercatorPixel,se.length(t));0!==i&&(se.scale$2(t,t,r/i*this._pixelsPerMercatorPixel),this._camera.position=[n[0],n[1],e.z*this._pixelsPerMercatorPixel-t[2]],this._updateStateFromCamera())}else this._isCameraConstrained=!0}}_constrain(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;const s="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){const l=this.center;l.lat=se.clamp(l.lat,this.minLat,this.maxLat),!this.maxBounds&&(this.renderWorldCopies||s)||(l.lng=se.clamp(l.lng,this.minLng,this.maxLng)),this.center=l,void(this._constraining=!1)}else{const l=this._unmodified,{x:u,y:c}=this.point;let e=0,t=u,r=c;var n=this.width/2,i=this.height/2,o=this.worldMinY*this.scale,a=this.worldMaxY*this.scale;if(c-i<o&&(r=o+i),a<c+i&&(r=a-i),a-o<this.height&&(e=Math.max(e,this.height/(a-o)),r=(a+o)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const se=this.worldMinX*this.scale,s=this.worldMaxX*this.scale,l=this.worldSize/2-(se+s)/2;(t=(t=(u+l+this.worldSize)%this.worldSize-l)-n<se?se+n:t)+n>s&&(t=s-n),s-se<this.width&&(e=Math.max(e,this.width/(s-se)),t=(s+se)/2)}t===u&&r===c||(this.center=this.unproject(new se.pointGeometry(t,r))),e&&(this.zoom+=this.scaleZoom(e)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}}}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return e=this.maxBounds?Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX))):e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(this.height){const l=this.centerOffset,u=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=se.mercatorZfromAltitude(1,this.center.lat)/se.mercatorZfromAltitude(1,se.GLOBE_SCALE_MATCH_LATITUDE));var e=kn(this.projection,this.zoom,this.width,this.height,1024),e=(this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,e),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50,"meters"===this.projection.zAxisUnit?u:1),t=this._camera.getWorldToCamera(this.worldSize,e),r=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ),n=(r[8]=2*-l.x/this.width,r[9]=2*l.y/this.height,se.mul([],r,t));if(this.projection.isReprojectedInTileSpace){const l=this.locationCoordinate(this.center),u=se.identity([]);se.translate(u,u,[l.x*this.worldSize,l.y*this.worldSize,0]),se.multiply(u,u,Sn(this)),se.translate(u,u,[-l.x*this.worldSize,-l.y*this.worldSize,0]),se.multiply(n,n,u),this.inverseAdjustmentMatrix=function(e){e=Sn(e,!0);return W([],[e[0],e[1],e[4],e[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=se.scale([],n,[this.worldSize,this.worldSize,this.worldSize/e,1]),this.projMatrix=n,this.invProjMatrix=se.invert(new Float64Array(16),this.projMatrix);var e=se.invert([],r),r=(this.frustumCorners=se.FrustumCorners.fromInvProjectionMatrix(e,this.horizonLineFromTop(),this.height),new Float32Array(16)),e=(se.identity(r),se.scale(r,r,[1,-1,1]),se.rotateX(r,r,this._pitch),se.rotateZ(r,r,this.angle),se.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ)),i=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift,i=(e[8]=2*-l.x/this.width,e[9]=2*(l.y+i)/this.height,this.skyboxMatrix=se.multiply(r,e,r),this.point),e=i.x,r=i.y,i=this.width%2/2,o=this.height%2/2,a=Math.cos(this.angle),s=Math.sin(this.angle),e=e-Math.round(e)+a*i+s*o,r=r-Math.round(r)+a*o+s*i,a=new Float64Array(n);if(se.translate(a,a,[.5<e?e-1:e,.5<r?r-1:r,0]),this.alignedProjMatrix=a,n=se.create(),se.scale(n,n,[this.width/2,-this.height/2,1]),se.translate(n,n,[1,-1,0]),this.labelPlaneMatrix=n,n=se.create(),se.scale(n,n,[1,-1,1]),se.translate(n,n,[-1,-1,0]),se.scale(n,n,[2/this.width,2/this.height,1]),this.glCoordMatrix=n,this.pixelMatrix=se.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},!(n=se.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=n,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=se.calculateGlobeMatrix(this);const l=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=se.transformMat4(l,l,t),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=n;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}}_calcFogMatrices(){this._fogTileMatrixCache={};var e=this.cameraWorldSizeForFog,t=this.cameraPixelsPerMeter,r=this._camera.position,n=1/this.height/this._pixelsPerMercatorPixel,i=[e,e,t],o=(se.scale$2(i,i,n),se.scale$2(r,r,-1),se.multiply$2(r,r,i),se.create());se.translate(o,o,r),se.scale(o,o,i),this.mercatorFogMatrix=o,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(e,t,n)}_computeCameraPosition(e){var t=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,r=this._camera.forward(),n=this.point,t=this._mercatorZfromZoom(this._seaLevelZoom||this._zoom)*t-e/this.worldSize*this._centerAltitude;return[n.x/this.worldSize-r[0]*t,n.y/this.worldSize-r[1]*t,e/this.worldSize*this._centerAltitude-r[2]*t]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(e){var t=this._maxCameraBoundsDistance()*Math.cos(this._pitch),r=this._camera.position[2],n=e[2];let i=1;this.projection.wrap&&(this.center=this.center.wrap()),0<n&&(i=Math.min((t-r)/n,1)),this._camera.position=se.scaleAndAdd([],this._camera.position,e,i),this._updateStateFromCamera()}_updateStateFromCamera(){var e=this._camera.position,t=this._camera.forward(),{pitch:r,bearing:n}=this._camera.getPitchBearing(),i=se.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,o=this._mercatorZfromZoom(this._maxZoom)*Math.cos(se.degToRad(this._maxPitch)),i=Math.max((e[2]-i)/Math.cos(r),o),o=this._zoomFromMercatorZ(i);se.scaleAndAdd(e,e,t,i),this._pitch=se.clamp(r,se.degToRad(this.minPitch),se.degToRad(this.maxPitch)),this.angle=se.wrap(n,-Math.PI,Math.PI),this._setZoom(se.clamp(o,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new se.MercatorCoordinate(e[0],e[1],e[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){var e=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}zoomFromMercatorZAdjusted(e){let t=0,r=se.GLOBE_ZOOM_THRESHOLD_MAX,n=0,i=1/0;for(;1e-6<r-t&&r>t;){const se=t+.5*(r-t),o=this.tileSize*Math.pow(2,se),a=this.getCameraToCenterDistance(this.projection,se,o),s=this.scaleZoom(a/(e*this.tileSize)),l=Math.abs(se-s);l<i&&(i=l,n=se),se<s?t=se:r=se}return n}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(se.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(e,t){var r=Math.min(e.x,t.x),n=Math.max(e.x,t.x),i=Math.min(e.y,t.y),e=Math.max(e.y,t.y);if(i<this.horizonLineFromTop(!1))return!0;if("mercator"===this.projection.name){var t=[new se.pointGeometry(r,i),new se.pointGeometry(n,e),new se.pointGeometry(r,e),new se.pointGeometry(n,i)],o=this.renderWorldCopies?-3:0,a=this.renderWorldCopies?4:1;for(const se of t){const e=this.pointRayIntersection(se);if(e.t<0)return!0;const t=this.rayIntersectionCoordinate(e);if(t.x<o||t.y<0||t.x>a||1<t.y)return!0}}return!1}isHorizonVisible(){return 88<this.pitch+se.radToDeg(this.fovAboveCenter)||this.anyCornerOffEdge(new se.pointGeometry(0,0),new se.pointGeometry(this.width,this.height))}zoomDeltaToMovement(e,t){e=se.length(se.sub([],this._camera.position,e)),t=this._zoomFromMercatorZ(e)+t;return e-this._mercatorZfromZoom(t)}getCameraPoint(){var e;return"globe"===this.projection.name?(e=function([e,t,r],n){e=[e,t,r,1],se.transformMat4$1(e,e,n),t=e[3]=Math.max(e[3],1e-6);return e[0]/=t,e[1]/=t,e[2]/=t,e}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix),new se.pointGeometry(e[0],e[1])):(e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1),this.centerPoint.add(new se.pointGeometry(0,e)))}getCameraToCenterDistance(e,t=this.zoom,r=this.worldSize){t=kn(e,t,this.width,this.height,1024),e=e.pixelSpaceConversion(this.center.lat,r,t);return.5/Math.tan(.5*this._fov)*this.height*e}getWorldToCameraMatrix(){var e=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&se.multiply(e,e,this.globeMatrix),e}}function Ln(e,t){let r=!1,n=null;const i=()=>{n=null,r&&(e(),n=setTimeout(i,t),r=!1)};return()=>(r=!0,n||i(),n)}class Pn{constructor(e){this._hashName=e&&encodeURIComponent(e),se.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ln(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,se.window.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map&&(this._map.off("moveend",this._updateHash),se.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0),this}getHashString(){const n=this._map;if(!n)return"";const i=zn(n);if(this._hashName){const n=this._hashName;let r=!1;var e=se.window.location.hash.slice(1).split("&").map(e=>{var t=e.split("=")[0];return t===n?(r=!0,t+"="+i):e}).filter(e=>e);return r||e.push(n+"="+i),"#"+e.join("&")}return"#"+i}_getCurrentHash(){var e=se.window.location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map(e=>e.split("=")).forEach(e=>{e[0]===this._hashName&&(t=e)}),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){var e,t,r=this._map;return!!r&&(3<=(e=this._getCurrentHash()).length&&!e.some(e=>isNaN(e))&&(t=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(e[3]||0):r.getBearing(),r.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:t,pitch:+(e[4]||0)}),!0))}_updateHashUnthrottled(){var e=se.window.location.href.replace(/(#.+)?$/,this.getHashString());se.window.history.replaceState(se.window.history.state,null,e)}}function zn(e,t){var r=e.getCenter(),n=Math.round(100*e.getZoom())/100,i=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,i),o=Math.round(r.lng*i)/i,r=Math.round(r.lat*i)/i,i=e.getBearing(),e=e.getPitch();let a=t?`/${o}/${r}/`+n:n+`/${r}/`+o;return(i||e)&&(a+="/"+Math.round(10*i)/10),e&&(a+="/"+Math.round(e)),a}const Dn={linearity:.3,easing:se.bezier(0,0,.3,1)},On=se.extend({deceleration:2500,maxSpeed:1400},Dn),Rn=se.extend({deceleration:20,maxSpeed:1400},Dn),Fn=se.extend({deceleration:1e3,maxSpeed:360},Dn),Bn=se.extend({deceleration:1e3,maxSpeed:90},Dn);class Nn{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:se.exported.now(),settings:e})}_drainInertiaBuffer(){for(var e=this._inertiaBuffer,t=se.exported.now();0<e.length&&160<t-e[0].time;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){var t={zoom:0,bearing:0,pitch:0,pan:new se.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:se}of this._inertiaBuffer)t.zoom+=se.zoomDelta||0,t.bearing+=se.bearingDelta||0,t.pitch+=se.pitchDelta||0,se.panDelta&&t.pan._add(se.panDelta),se.around&&(t.around=se.around),se.pinchAround&&(t.pinchAround=se.pinchAround);var r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,n={};if(t.pan.mag()&&(e=Un(t.pan.mag(),r,se.extend({},On,e||{})),n.offset=t.pan.mult(e.amount/t.pan.mag()),n.center=this._map.transform.center,jn(n,e)),t.zoom){const se=Un(t.zoom,r,Rn);n.zoom=this._map.transform.zoom+se.amount,jn(n,se)}if(t.bearing){const e=Un(t.bearing,r,Fn);n.bearing=this._map.transform.bearing+se.clamp(e.amount,-179,179),jn(n,e)}if(t.pitch){const se=Un(t.pitch,r,Bn);n.pitch=this._map.transform.pitch+se.amount,jn(n,se)}if(n.zoom||n.bearing){const se=void 0===t.pinchAround?t.around:t.pinchAround;n.around=se?this._map.unproject(se):this._map.getCenter()}return this.clear(),n.noMoveStart=!0,n}}}function jn(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function Un(e,t,r){var{maxSpeed:n,linearity:i,deceleration:o}=r,e=se.clamp(e*i/(t/1e3),-n,n),t=Math.abs(e)/(o*i);return{easing:r.easing,duration:1e3*t,amount:e*(t/2)}}class C extends se.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,r,n={}){var i=f(t.getCanvasContainer(),r),o=t.unproject(i);super(e,se.extend({point:i,lngLat:o,originalEvent:r},n)),this._defaultPrevented=!1,this.target=t}}class Vn extends se.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,r){var n="touchend"===e?r.changedTouches:r.touches,n=d(t.getCanvasContainer(),n),i=n.map(e=>t.unproject(e)),o=n.reduce((e,t,r,n)=>e.add(t.div(n.length)),new se.pointGeometry(0,0));super(e,{points:n,point:o,lngLats:i,lngLat:t.unproject(o),originalEvent:r}),this._defaultPrevented=!1}}class Gn extends se.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,r){super(e,{originalEvent:r}),this._defaultPrevented=!1}}class Wn{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new Gn(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new C(e.type,this._map,e))}mouseup(e){this._map.fire(new C(e.type,this._map,e))}preclick(e){e=se.extend({},e);e.type="preclick",this._map.fire(new C(e.type,this._map,e))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new C(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new C(e.type,this._map,e))}mouseover(e){this._map.fire(new C(e.type,this._map,e))}mouseout(e){this._map.fire(new C(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Vn(e.type,this._map,e))}touchmove(e){this._map.fire(new Vn(e.type,this._map,e))}touchend(e){this._map.fire(new Vn(e.type,this._map,e))}touchcancel(e){this._map.fire(new Vn(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zn{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new C(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new C("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new C(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qn{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(F(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(this._active){var r=this._startPos,n=this._lastPos;if(!(!r||!n||n.equals(t)||!this._box&&t.dist(r)<this._clickTolerance)){this._lastPos=t,this._box||(this._box=l("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const i=Math.min(r.x,t.x),o=Math.max(r.x,t.x),a=Math.min(r.y,t.y),s=Math.max(r.y,t.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${i}px,${a}px)`,this._box.style.width=o-i+"px",this._box.style.height=s-a+"px")})}}}mouseupWindow(e,t){if(this._active){const r=this._startPos,n=t;if(r&&0===e.button){if(this.reset(),j(),r.x!==n.x||r.y!==n.y)return this._map.fire(new se.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:e=>e.fitScreenCoordinates(r,n,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}}}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),B(),delete this._startPos,delete this._lastPos}_fireEvent(e,t){return this._map.fire(new se.Event(e,{originalEvent:t}))}}function Hn(t,r){var n={};for(let e=0;e<t.length;e++)n[t[e].identifier]=r[e];return n}class $n{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(e,t,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=e.timeStamp),r.length===this.numTouches&&(this.centroid=function(e){var t=new se.pointGeometry(0,0);for(const se of e)t._add(se);return t.div(e.length)}(t),this.touches=Hn(r,t)))}touchmove(e,t,r){if(!this.aborted&&this.centroid){var n=Hn(r,t);for(const e in this.touches){const t=this.touches[e],r=n[e];(!r||30<r.dist(t))&&(this.aborted=!0)}}}touchend(e,t,r){if((!this.centroid||500<e.timeStamp-this.startTime)&&(this.aborted=!0),0===r.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class Xn{constructor(e){this.singleTap=new $n(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,t,r){this.singleTap.touchstart(e,t,r)}touchmove(e,t,r){this.singleTap.touchmove(e,t,r)}touchend(e,t,r){var n=this.singleTap.touchend(e,t,r);if(n){const t=e.timeStamp-this.lastTime<500,r=!this.lastTap||this.lastTap.dist(n)<30;if(t&&r||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=n,this.count===this.numTaps)return this.reset(),n}}}class Yn{constructor(){this._zoomIn=new Xn({numTouches:1,numTaps:2}),this._zoomOut=new Xn({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,r){this._zoomIn.touchstart(e,t,r),this._zoomOut.touchstart(e,t,r)}touchmove(e,t,r){this._zoomIn.touchmove(e,t,r),this._zoomOut.touchmove(e,t,r)}touchend(t,e,r){const n=this._zoomIn.touchend(t,e,r),i=this._zoomOut.touchend(t,e,r);return n?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(n)},{originalEvent:t})}):i?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(i)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Jn={0:1,2:2};class Kn{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){var r;this._lastPoint||(r=V(e),this._correctButton(e,r)&&(this._lastPoint=t,this._eventButton=r))}mousemoveWindow(e,t){var r=this._lastPoint;if(r)if(e.preventDefault(),null!=this._eventButton&&function(e,t){t=Jn[t];return void 0===e.buttons||(e.buttons&t)!==t}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(r)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(r,t)}mouseupWindow(e){this._lastPoint&&V(e)===this._eventButton&&(this._moved&&j(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qn extends Kn{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class ei extends Kn{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){t=.8*(t.x-e.x);if(t)return this._active=!0,{bearingDelta:t}}contextmenu(e){e.preventDefault()}}class ti extends Kn{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){t=-.5*(t.y-e.y);if(t)return this._active=!0,{pitchDelta:t}}contextmenu(e){e.preventDefault()}}class ri{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset(),se.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new se.pointGeometry(0,0)}touchstart(e,t,r){return this._calculateTransform(e,t,r)}touchmove(e,t,r){if(this._active&&!(r.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===r.length&&!se.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return e.cancelable&&e.preventDefault(),this._calculateTransform(e,t,r)}}touchend(e,t,r){this._calculateTransform(e,t,r),this._active&&r.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,t,r){0<r.length&&(this._active=!0);var n=Hn(r,t),i=new se.pointGeometry(0,0),o=new se.pointGeometry(0,0);let a=0;for(const se in n){const e=n[se],t=this._touches[se];t&&(i._add(e),o._add(e.sub(t)),a++,n[se]=e)}if(this._touches=n,!(a<this._minTouches)&&o.mag())return r=o.div(a),this._sum._add(r),this._sum.mag()<this._clickTolerance?void 0:{around:i.div(a),panDelta:r}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=l("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))+"px")}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class ni{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,t,r){return{}}touchstart(e,t,r){this._firstTwoTouches||r.length<2||(this._firstTwoTouches=[r[0].identifier,r[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,r){var n=this._firstTwoTouches;if(n){e.preventDefault();var[n,i]=n,n=ii(r,t,n),r=ii(r,t,i);if(n&&r)return t=this._aroundCenter?null:n.add(r).div(2),this._move([n,r],t,e)}}touchend(e,t,r){var n,i;this._firstTwoTouches&&([i,n]=this._firstTwoTouches,i=ii(r,t,i),r=ii(r,t,n),i&&r||(this._active&&j(),this.reset()))}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ii(t,r,n){for(let e=0;e<t.length;e++)if(t[e].identifier===n)return r[e]}function oi(e,t){return Math.log(e/t)/Math.LN2}class ai extends ni{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){var r=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(oi(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:oi(this._distance,r),pinchAround:t}}}function si(e,t){return 180*e.angleWith(t)/Math.PI}class li extends ni{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){var r=this._vector;if(this._vector=e[0].sub(e[1]),r&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:si(this._vector,r),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());var t=25/(Math.PI*this._minDiameter)*360,r=this._startVector;return!!r&&(e=si(e,r),Math.abs(e)<t)}}function ui(e){return Math.abs(e.y)>Math.abs(e.x)}class ci extends ni{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){ui((this._lastPoints=e)[0].sub(e[1]))&&(this._valid=!1)}_move(e,t,r){var n,i=this._lastPoints;if(i)return n=e[0].sub(i[0]),i=e[1].sub(i[1]),this._map._cooperativeGestures&&!se.isFullscreen()&&r.touches.length<3||(this._valid=this.gestureBeginsVertically(n,i,r.timeStamp),!this._valid)?void 0:(this._lastPoints=e,this._active=!0,{pitchDelta:(n.y+i.y)/2*-.5})}gestureBeginsVertically(e,t,r){var n,i;return void 0!==this._valid?this._valid:(i=2<=e.mag(),n=2<=t.mag(),i||n?i&&n?(i=0<e.y==0<t.y,ui(e)&&ui(t)&&i):(null==this._firstMove&&(this._firstMove=r),r-this._firstMove<100&&void 0):void 0)}}const hi={panStep:100,bearingStep:15,pitchStep:10};class fi{constructor(){var e=hi;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(!(s.altKey||s.ctrlKey||s.metaKey)){let r=0,n=0,i=0,o=0,a=0;switch(s.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:s.shiftKey?n=-1:(s.preventDefault(),o=-1);break;case 39:s.shiftKey?n=1:(s.preventDefault(),o=1);break;case 38:s.shiftKey?i=1:(s.preventDefault(),a=-1);break;case 40:s.shiftKey?i=-1:(s.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(n=0,i=0),{cameraAnimation:e=>{var t=e.getZoom();e.easeTo({duration:300,easeId:"keyboardHandler",easing:di,zoom:r?Math.round(t)+r*(s.shiftKey?2:1):t,bearing:e.getBearing()+n*this._bearingStep,pitch:e.getPitch()+i*this._pitchStep,offset:[-o*this._panStep,-a*this._panStep],center:e.getCenter()},{originalEvent:s})}}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function di(e){return e*(2-e)}const pi=4.000244140625;class mi{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._handler=t,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,se.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(this.isEnabled()){if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||se.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let e=t.deltaMode===se.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;var r=se.exported.now(),n=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==e&&e%pi==0?this._type="wheel":0!==e&&Math.abs(e)<4?this._type="trackpad":400<n?(this._type=null,this._lastValue=e,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(n*e)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,e+=this._lastValue)),t.shiftKey&&e&&(e/=4),this._type&&(this._lastWheelEvent=t,this._delta-=e,this._active||this._start(t)),t.preventDefault()}}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){this._delta&&(this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout),e=f(this._el,e),this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:e,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame()))}renderFrame(){if(this._frameId&&(this._frameId=null,this.isActive())){const r=this._map.transform,n=("wheel"===this._type&&r.projection.wrap&&(180<=r._center.lng||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0),()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom);if(0!==this._delta){const se="wheel"===this._type&&Math.abs(this._delta)>pi?this._wheelZoomRate:this._defaultZoomRate;let e=2/(1+Math.exp(-Math.abs(this._delta*se)));this._delta<0&&0!==e&&(e=1/e);const o=n(),a=Math.pow(2,o),t="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):a;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(t*e))),"wheel"===this._type&&(this._startZoom=o,this._easing=this._smoothOutEasing(200)),this._delta=0}const i="number"==typeof this._targetZoom?this._targetZoom:n(),o=this._startZoom,a=this._easing;let e,t=!1;if("wheel"===this._type&&o&&a){const r=Math.min((se.exported.now()-this._lastWheelEventTime)/200,1),n=a(r);e=se.number(o,i,n),r<1?this._frameId||(this._frameId=!0):t=!0}else e=i,t=!0;return this._active=!0,t&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!t,zoomDelta:e-n(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}}_smoothOutEasing(e){let t=se.ease;if(this._prevEase){const e=this._prevEase,r=(se.exported.now()-e.start)/e.duration,n=e.easing(.01+r)-e.easing(r),i=.27/Math.sqrt(n*n+1e-4)*.01,o=Math.sqrt(.0729-i*i);t=se.bezier(i,o,.25,1)}return this._prevEase={start:se.exported.now(),duration:e,easing:t},t}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=l("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(se.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))+"px")}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class gi{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class yi{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,r){return t.preventDefault(),{cameraAnimation:e=>{e.easeTo({duration:300,zoom:e.getZoom()+(t.shiftKey?-1:1),around:e.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vi{constructor(){this._tap=new Xn({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,t,r){this._swipePoint||(this._tapTime&&500<e.timeStamp-this._tapTime&&this.reset(),this._tapTime?0<r.length&&(this._swipePoint=t[0],this._swipeTouch=r[0].identifier):this._tap.touchstart(e,t,r))}touchmove(e,t,r){var n,i;if(this._tapTime){if(this._swipePoint&&r[0].identifier===this._swipeTouch)return i=(n=t[0]).y-this._swipePoint.y,this._swipePoint=n,e.preventDefault(),this._active=!0,{zoomDelta:i/128}}else this._tap.touchmove(e,t,r)}touchend(e,t,r){this._tapTime?this._swipePoint&&0===r.length&&this.reset():this._tap.touchend(e,t,r)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _i{constructor(e,t,r){this._el=e,this._mousePan=t,this._touchPan=r}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class xi{constructor(e,t,r){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=r}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class bi{constructor(e,t,r,n){this._el=e,this._touchZoom=t,this._touchRotate=r,this._tapDragZoom=n,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const wi=e=>e.zoom||e.drag||e.pitch||e.rotate;class Ei extends se.Event{}class Ti{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,t){t=se.sub([],t,e);this.radius=se.length(t[2]<0?se.div([],t,this.constants):[t[0],t[1],0])}projectRay(e){se.div(e,e,this.constants),se.normalize(e,e),se.mul$1(e,e,this.constants);var t=se.scale$2([],e,this.radius);if(0<t[2]){const e=se.scale$2([],[0,0,1],se.dot(t,[0,0,1])),r=se.scale$2([],se.normalize([],[t[0],t[1],0]),this.radius),n=se.add([],t,se.scale$2([],se.sub([],se.add([],r,e),t),2));t[0]=n[0],t[1]=n[1]}return t}}function Si(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class Mi{constructor(e,t){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Nn(e),this._bearingSnap=t.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ti,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(t),se.bindAll(["handleEvent","handleWindowEvent"],this);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[se.window.document,"mousemove",{capture:!0}],[se.window.document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[se.window,"blur",void 0]];for(const[e,t,r]of this._listeners)e.addEventListener(t,e===se.window.document?this.handleWindowEvent:this.handleEvent,r)}destroy(){for(var[e,t,r]of this._listeners)e.removeEventListener(t,e===se.window.document?this.handleWindowEvent:this.handleEvent,r)}_addDefaultHandlers(e){const t=this._map,r=t.getCanvasContainer();this._add("mapEvent",new Wn(t,e));var n=t.boxZoom=new qn(t,e),n=(this._add("boxZoom",n),new Yn),i=new yi,n=(t.doubleClickZoom=new gi(i,n),this._add("tapZoom",n),this._add("clickZoom",i),new vi),i=(this._add("tapDragZoom",n),t.touchPitch=new ci(t)),i=(this._add("touchPitch",i),new ei(e)),o=new ti(e),i=(t.dragRotate=new xi(e,i,o),this._add("mouseRotate",i,["mousePitch"]),this._add("mousePitch",o,["mouseRotate"]),new Qn(e)),o=new ri(t,e),i=(t.dragPan=new _i(r,i,o),this._add("mousePan",i),this._add("touchPan",o,["touchZoom","touchRotate"]),new li),o=new ai,n=(t.touchZoomRotate=new bi(r,o,i,n),this._add("touchRotate",i,["touchPan","touchZoom"]),this._add("touchZoom",o,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Zn(t)),t.scrollZoom=new mi(t,this)),i=(this._add("scrollZoom",n,["mousePan"]),t.keyboard=new fi);this._add("keyboard",i);for(const r of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[r]&&t[r].enable(e[r])}_add(e,t,r){this._handlers.push({handlerName:e,handler:t,allowed:r}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(var{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!wi(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,t,r){for(const n in e)if(n!==r&&(!t||t.indexOf(n)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,e.type+"Window")}_getMapTouches(e){var t=[];for(const r of e)this._el.contains(r.target)&&t.push(r);return t}handleEvent(t,r){this._updatingCamera=!0;const n="renderFrame"===t.type,i=n?void 0:t,o={needsRenderFrame:!1},a={},s={},l=t.touches?this._getMapTouches(t.touches):void 0,u=l?d(this._el,l):n?void 0:f(this._el,t);for(const{handlerName:n,handler:c,allowed:h}of this._handlers)if(c.isEnabled()){let e;this._blockedByActive(s,h,n)?c.reset():c[r||t.type]&&(e=c[r||t.type](t,u,l),this.mergeHandlerResult(o,a,e,n,i),e&&e.needsRenderFrame&&this._triggerRenderFrame()),(e||c.isActive())&&(s[n]=c)}const c={};for(const t in this._previousActiveHandlers)s[t]||(c[t]=i);this._previousActiveHandlers=s,(Object.keys(c).length||Si(o))&&(this._changes.push([o,a,c]),this._triggerRenderFrame()),(Object.keys(s).length||Si(o))&&this._map._stop(!0),this._updatingCamera=!1;const h=o["cameraAnimation"];h&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],h(this._map))}mergeHandlerResult(e,t,r,n,i){r&&(se.extend(e,r),e={handlerName:n,originalEvent:r.originalEvent||i},void 0!==r.zoomDelta&&(t.zoom=e),void 0!==r.panDelta&&(t.drag=e),void 0!==r.pitchDelta&&(t.pitch=e),void 0!==r.bearingDelta&&(t.rotate=e))}_applyChanges(){var e,t,r,n={},i={},o={};for([e,t,r]of this._changes)e.panDelta&&(n.panDelta=(n.panDelta||new se.pointGeometry(0,0))._add(e.panDelta)),e.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+e.zoomDelta),e.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+e.bearingDelta),e.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+e.pitchDelta),void 0!==e.around&&(n.around=e.around),void 0!==e.aroundCoord&&(n.aroundCoord=e.aroundCoord),void 0!==e.pinchAround&&(n.pinchAround=e.pinchAround),e.noInertia&&(n.noInertia=e.noInertia),se.extend(i,t),se.extend(o,r);this._updateMapTransform(n,i,o),this._changes=[]}_updateMapTransform(s,l,u){var c=this._map,h=c.transform,f=e=>[e.x,e.y,e.z];if((d=this._eventsInProgress.drag)&&!this._handlersById[d.handlerName].isActive()&&!Si(s)){const se=h.zoom;h.cameraElevationReference="sea",h.recenterOnTerrain(),h.cameraElevationReference="ground",se!==h.zoom&&this._map._update(!0)}if(h._isCameraConstrained&&c._stop(!0),Si(s)){let{panDelta:e,zoomDelta:t,bearingDelta:r,pitchDelta:n,around:i,aroundCoord:o,pinchAround:a}=s;h._isCameraConstrained&&(0<t&&(t=0),h._isCameraConstrained=!1),void 0!==a&&(i=a),(t||l.drag&&!this._eventsInProgress.drag)&&i&&(this._dragOrigin=f(h.pointCoordinate3D(i)),this._trackingEllipsoid.setup(h._camera.position,this._dragOrigin)),h.cameraElevationReference="sea",c._stop(!0),i=i||c.transform.centerPoint,r&&(h.bearing+=r),n&&(h.pitch+=n),h._updateCameraState();var d=[0,0,0];if(e)if("mercator"===h.projection.name){const se=this._trackingEllipsoid.projectRay(h.screenPointToMercatorRay(i).dir),s=this._trackingEllipsoid.projectRay(h.screenPointToMercatorRay(i.sub(e)).dir);d[0]=s[0]-se[0],d[1]=s[1]-se[1]}else{const s=h.pointCoordinate(i);if("globe"===h.projection.name){e=e.rotate(-h.angle);const l=h._pixelsPerMercatorPixel/h.worldSize;d[0]=-e.x*se.mercatorScale(se.latFromMercatorY(s.y))*l,d[1]=-e.y*se.mercatorScale(h.center.lat)*l}else{const se=h.pointCoordinate(i.sub(e));s&&se&&(d[0]=se.x-s.x,d[1]=se.y-s.y)}}var c=h.zoom,p=[0,0,0];if(t){const s=f(o||h.pointCoordinate3D(i)),l={dir:se.normalize([],se.sub([],s,h._camera.position))};if(l.dir[2]<0){const u=h.zoomDeltaToMovement(s,t);se.scale$2(p,l.dir,u)}}f=se.add(d,d,p),h._translateCameraConstrained(f),t&&1e-4<Math.abs(h.zoom-c)&&h.recenterOnTerrain(),h.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s)}this._fireEvents(l,u,!0)}_fireEvents(e,t,r){var n=wi(this._eventsInProgress),i=wi(e),o={};for(const se in e){const t=e[se]["originalEvent"];this._eventsInProgress[se]||(o[se+"start"]=t),this._eventsInProgress[se]=e[se]}!n&&i&&this._fireEvent("movestart",i.originalEvent);for(const se in o)this._fireEvent(se,o[se]);i&&this._fireEvent("move",i.originalEvent);for(const se in e){const t=e[se]["originalEvent"];this._fireEvent(se,t)}var a={};let s;for(const se in this._eventsInProgress){const{handlerName:e,originalEvent:r}=this._eventsInProgress[se];this._handlersById[e].isActive()||(delete this._eventsInProgress[se],s=t[e]||r,a[se+"end"]=s)}for(const se in a)this._fireEvent(se,a[se]);var l=wi(this._eventsInProgress);if(r&&(n||i)&&!l){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),t=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;e?(t(e.bearing||this._map.getBearing())&&(e.bearing=0),this._map.easeTo(e,{originalEvent:s})):(this._map.fire(new se.Event("moveend",{originalEvent:s})),t(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,t){this._map.fire(new se.Event(e,t?{originalEvent:t}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{this._frameId=void 0,this.handleEvent(new Ei("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const ki="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ci extends se.Evented{constructor(e,t){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=t.bearingSnap,se.bindAll(["_renderFrameCallback"],this)}getCenter(){return new se.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(e,t,r){return e=se.pointGeometry.convert(e).mult(-1),this.panTo(this.transform.center,se.extend({offset:e},t),r)}panTo(e,t,r){return this.easeTo(se.extend({center:e},t),r)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(e,t,r){return this.easeTo(se.extend({zoom:e},t),r)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(e,t,r){return this.easeTo(se.extend({bearing:e},t),r)}resetNorth(e,t){return this.rotateTo(0,se.extend({duration:1e3},e),t),this}resetNorthPitch(e,t){return this.easeTo(se.extend({bearing:0,pitch:0,duration:1e3},e),t),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(e,t){e=se.LngLatBounds.convert(e);var r=t&&t.bearing||0,n=t&&t.pitch||0,i=e.getNorthWest(),e=e.getSouthEast();return this._cameraForBounds(this.transform,i,e,r,n,t)}_extendCameraOptions(e){var t={top:0,bottom:0,right:0,left:0};if("number"==typeof(e=se.extend({padding:t,offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding){const se=e.padding;e.padding={top:se,bottom:se,right:se,left:se}}return e.padding=se.extend(t,e.padding),e}_minimumAABBFrustumDistance(e,t){var r=t.max[0]-t.min[0],t=t.max[1]-t.min[1];return r/t>e.aspect?r/(2*Math.tan(.5*e.fovX)*e.aspect):t/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(e,t,r,n,i,o){var e=e.clone(),a=this._extendCameraOptions(o);e.bearing=n,e.pitch=i;const s=se.LngLat.convert(t),l=se.LngLat.convert(r),u=.5*(s.lat+l.lat),c=.5*(s.lng+l.lng),h=se.latLngToECEF(u,c),f=se.normalize([],h),d=se.normalize([],se.cross([],f,[0,1,0])),p=se.cross([],d,f),m=[d[0],d[1],d[2],0,p[0],p[1],p[2],0,f[0],f[1],f[2],0,0,0,0,1],g=[h,se.latLngToECEF(s.lat,s.lng),se.latLngToECEF(l.lat,s.lng),se.latLngToECEF(l.lat,l.lng),se.latLngToECEF(s.lat,l.lng),se.latLngToECEF(u,s.lng),se.latLngToECEF(u,l.lng),se.latLngToECEF(s.lat,c),se.latLngToECEF(l.lat,c)];var y=se.Aabb.fromPoints(g.map(e=>[se.dot(d,e),se.dot(p,e),se.dot(f,e)])),v=se.transformMat4([],y.center,m),_=(0===se.squaredLength(v)&&se.set(v,0,0,1),se.normalize(v,v),se.scale$2(v,v,se.GLOBE_RADIUS),e.center=se.ecefToLatLng(v),e.getWorldToCameraMatrix()),x=se.invert(new Float64Array(16),_),y=se.Aabb.applyTransform(y,se.multiply([],_,m)),_=(se.transformMat4(v,v,_),.5*(y.max[2]-y.min[2])),y=this._minimumAABBFrustumDistance(e,y),_=se.scale$2([],[0,0,1],_),_=se.add(_,v,_),y=y+(0===e.pitch?0:se.distance(v,_)),_=e.globeCenterInViewSpace,_=se.sub([],v,[_[0],_[1],_[2]]),y=(se.normalize(_,_),se.scale$2(_,_,y),se.add([],v,_)),v=(se.transformMat4(y,y,x),se.earthRadius/se.GLOBE_RADIUS),_=se.length(y),x=se.mercatorZfromAltitude(Math.max(_*v-se.earthRadius,Number.EPSILON),0),y=Math.min(e.zoomFromMercatorZAdjusted(x),a.maxZoom);return y>.5*(se.GLOBE_ZOOM_THRESHOLD_MIN+se.GLOBE_ZOOM_THRESHOLD_MAX)?(e.setProjection({name:"mercator"}),e.zoom=y,this._cameraForBounds(e,t,r,n,i,o)):{center:e.center,zoom:y,bearing:n,pitch:i}}queryTerrainElevation(e,t){var r=this.transform.elevation;return r?(t=se.extend({},{exaggerated:!0},t),r.getAtPoint(se.MercatorCoordinate.fromLngLat(e),null,t.exaggerated)):null}_cameraForBounds(e,t,r,n,i,o){var a,s,l,u,c,h,f,d,p,m,g,y,v,_,x;return"globe"===e.projection.name?this._cameraForBoundsOnGlobe(e,t,r,n,i,o):(e=e.clone(),a=this._extendCameraOptions(o),h=e.padding,e.bearing=n,e.pitch=i,x=se.LngLat.convert(t),s=se.LngLat.convert(r),_=new se.LngLat(x.lng,s.lat),f=new se.LngLat(s.lng,x.lat),u=e.project(x),l=e.project(s),x=this.queryTerrainElevation(x),s=this.queryTerrainElevation(s),_=this.queryTerrainElevation(_),f=this.queryTerrainElevation(f),u=[[u.x,u.y,Math.min(x||0,s||0,_||0,f||0)],[l.x,l.y,Math.max(x||0,s||0,_||0,f||0)]],l=se.Aabb.fromPoints(u),x=e.getWorldToCameraMatrix(),s=se.invert(new Float64Array(16),x),l=se.Aabb.applyTransform(l,x),_=se.sub([],l.max,l.min),f=h.left||0,u=h.right||0,c=h.bottom||0,h=h.top||0,{left:d,right:m,top:y,bottom:p}=a.padding,g=.5*(f+u),v=.5*(h+c),f=Math.min(e.scaleZoom(e.scale*Math.min((e.width-(f+u+d+m))/_[0],(e.height-(c+h+p+y))/_[1])),a.maxZoom),u=e.scale/e.zoomScale(f),l=new se.Aabb([l.min[0]-(d+g)*u,l.min[1]-(p+v)*u,l.min[2]],[l.max[0]+(m+g)*u,l.max[1]+(y+v)*u,l.max[2]]),c=.5*_[2],h=this._minimumAABBFrustumDistance(e,l),se.transformMat4$1(f=[0,0,1,0],f,x),se.normalize$2(f,f),d=se.scale$2([],f,h+c),p=se.add([],l.center,d),m=("number"==typeof a.offset.x&&"number"==typeof a.offset.y?new se.pointGeometry(a.offset.x,a.offset.y):se.pointGeometry.convert(a.offset)).rotate(-se.degToRad(n)),l.center[0]-=m.x*u,l.center[1]+=m.y*u,se.transformMat4(l.center,l.center,s),se.transformMat4(p,p,s),g=[l.center[0],l.center[1],p[2]*e.pixelsPerMeter],se.scale$2(g,g,1/e.worldSize),y=se.lngFromMercatorX(g[0]),v=se.latFromMercatorY(g[1]),_=Math.min(e._zoomFromMercatorZ(g[2]),a.maxZoom),x=new se.LngLat(y,v),e.mercatorFromTransition&&_<.5*(se.GLOBE_ZOOM_THRESHOLD_MIN+se.GLOBE_ZOOM_THRESHOLD_MAX)?(e.setProjection({name:"globe"}),e.zoom=_,this._cameraForBounds(e,t,r,n,i,o)):{center:x,zoom:_,bearing:n,pitch:i})}fitBounds(e,t,r){e=this.cameraForBounds(e,t);return this._fitInternal(e,t,r)}fitScreenCoordinates(e,t,r,n,i){var o,e=se.pointGeometry.convert(e),t=se.pointGeometry.convert(t),a=new se.pointGeometry(Math.min(e.x,t.x),Math.min(e.y,t.y)),s=new se.pointGeometry(Math.max(e.x,t.x),Math.max(e.y,t.y));return"mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(e,t)?this:(e=this.transform.pointLocation3D(a),t=this.transform.pointLocation3D(s),o=this.transform.pointLocation3D(new se.pointGeometry(a.x,s.y)),s=this.transform.pointLocation3D(new se.pointGeometry(s.x,a.y)),a=[Math.min(e.lng,t.lng,o.lng,s.lng),Math.min(e.lat,t.lat,o.lat,s.lat)],e=[Math.max(e.lng,t.lng,o.lng,s.lng),Math.max(e.lat,t.lat,o.lat,s.lat)],t=n&&n.pitch?n.pitch:this.getPitch(),o=this._cameraForBounds(this.transform,a,e,r,t,n),this._fitInternal(o,n,i))}_fitInternal(e,t,r){return e?(delete(t=se.extend(e,t)).padding,t.linear?this.easeTo(t,r):this.flyTo(t,r)):this}jumpTo(e,t){this.stop();var r=e.preloadOnly?this.transform.clone():this.transform;let n=!1,i=!1,o=!1;return"zoom"in e&&r.zoom!==+e.zoom&&(n=!0,r.zoom=+e.zoom),void 0!==e.center&&(r.center=se.LngLat.convert(e.center)),"bearing"in e&&r.bearing!==+e.bearing&&(i=!0,r.bearing=+e.bearing),"pitch"in e&&r.pitch!==+e.pitch&&(o=!0,r.pitch=+e.pitch),null==e.padding||r.isPaddingEqual(e.padding)||(r.padding=e.padding),e.preloadOnly?(this._preloadTiles(r),this):(this.fire(new se.Event("movestart",t)).fire(new se.Event("move",t)),n&&this.fire(new se.Event("zoomstart",t)).fire(new se.Event("zoom",t)).fire(new se.Event("zoomend",t)),i&&this.fire(new se.Event("rotatestart",t)).fire(new se.Event("rotate",t)).fire(new se.Event("rotateend",t)),o&&this.fire(new se.Event("pitchstart",t)).fire(new se.Event("pitch",t)).fire(new se.Event("pitchend",t)),this.fire(new se.Event("moveend",t)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||se.warnOnce(ki),this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,t){var r,n,i,o=this.transform;return o.projection.supportsFreeCamera?(this.stop(),n=o.zoom,i=o.pitch,r=o.bearing,e=(o.setFreeCameraOptions(e),n!==o.zoom),n=i!==o.pitch,i=r!==o.bearing,this.fire(new se.Event("movestart",t)).fire(new se.Event("move",t)),e&&this.fire(new se.Event("zoomstart",t)).fire(new se.Event("zoom",t)).fire(new se.Event("zoomend",t)),i&&this.fire(new se.Event("rotatestart",t)).fire(new se.Event("rotate",t)).fire(new se.Event("rotateend",t)),n&&this.fire(new se.Event("pitchstart",t)).fire(new se.Event("pitch",t)).fire(new se.Event("pitchend",t)),this.fire(new se.Event("moveend",t))):se.warnOnce(ki),this}easeTo(r,n){this._stop(!1,r.easeId),(!1===(r=se.extend({offset:[0,0],duration:500,easing:se.ease},r)).animate||!r.essential&&se.exported.prefersReducedMotion)&&(r.duration=0);const t=this.transform,i=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),l="zoom"in r?+r.zoom:i,u="bearing"in r?this._normalizeBearing(r.bearing,o):o,c="pitch"in r?+r.pitch:a,h=("padding"in r?r:t).padding,f=se.pointGeometry.convert(r.offset);let d,p,m;if("globe"===t.projection.name){const n=se.MercatorCoordinate.fromLngLat(t.center),i=f.rotate(-t.angle),o=(n.x+=i.x/t.worldSize,n.y+=i.y/t.worldSize,n.toLngLat()),a=se.LngLat.convert(r.center||o);this._normalizeCenter(a),d=t.centerPoint.add(i),p=new se.pointGeometry(n.x,n.y).mult(t.worldSize),m=new se.pointGeometry(se.mercatorXfromLng(a.lng),se.mercatorYfromLat(a.lat)).mult(t.worldSize).sub(p)}else{d=t.centerPoint.add(f);const n=t.pointLocation(d),i=se.LngLat.convert(r.center||n);this._normalizeCenter(i),p=t.project(n),m=t.project(i).sub(p)}const g=t.zoomScale(l-i);let y,v;r.around&&(y=se.LngLat.convert(r.around),v=t.locationPoint(y));const _=this._zooming||l!==i,x=this._rotating||o!==u,b=this._pitching||c!==a,w=!t.isPaddingEqual(h),e=t=>e=>{if(_&&(t.zoom=se.number(i,l,e)),x&&(t.bearing=se.number(o,u,e)),b&&(t.pitch=se.number(a,c,e)),w&&(t.interpolatePadding(s,h,e),d=t.centerPoint.add(f)),y)t.setLocationAtPoint(y,v);else{const se=t.zoomScale(t.zoom-i),r=l>i?Math.min(2,g):Math.max(.5,g),n=Math.pow(r,1-e),o=t.unproject(p.add(m.mult(e*n)).mult(se));t.setLocationAtPoint(t.renderWorldCopies?o.wrap():o,d)}return r.preloadOnly||this._fireMoveEvents(n),t};if(r.preloadOnly){const se=this._emulate(e,r.duration,t);this._preloadTiles(se)}else{var E={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};this._zooming=_,this._rotating=x,this._pitching=b,this._padding=w,this._easeId=r.easeId,this._prepareEase(n,r.noMoveStart,E),this._ease(e(t),e=>{t.recenterOnTerrain(),this._afterEase(n,e)},r)}return this}_prepareEase(e,t,r={}){this._moving=!0,this.transform.cameraElevationReference="sea",t||r.moving||this.fire(new se.Event("movestart",e)),this._zooming&&!r.zooming&&this.fire(new se.Event("zoomstart",e)),this._rotating&&!r.rotating&&this.fire(new se.Event("rotatestart",e)),this._pitching&&!r.pitching&&this.fire(new se.Event("pitchstart",e))}_fireMoveEvents(e){this.fire(new se.Event("move",e)),this._zooming&&this.fire(new se.Event("zoom",e)),this._rotating&&this.fire(new se.Event("rotate",e)),this._pitching&&this.fire(new se.Event("pitch",e))}_afterEase(e,t){var r,n;this._easeId&&t&&this._easeId===t||(this._easeId=void 0,this.transform.cameraElevationReference="ground",t=this._zooming,r=this._rotating,n=this._pitching,this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,t&&this.fire(new se.Event("zoomend",e)),r&&this.fire(new se.Event("rotateend",e)),n&&this.fire(new se.Event("pitchend",e)),this.fire(new se.Event("moveend",e)))}flyTo(i,o){if(!i.essential&&se.exported.prefersReducedMotion){const e=se.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(e,o)}this.stop(),i=se.extend({offset:[0,0],speed:1.2,curve:1.42,easing:se.ease},i);const e=this.transform,a=this.getZoom(),s=this.getBearing(),l=this.getPitch(),u=this.getPadding(),c="zoom"in i?se.clamp(+i.zoom,e.minZoom,e.maxZoom):a,h="bearing"in i?this._normalizeBearing(i.bearing,s):s,f="pitch"in i?+i.pitch:l,d=("padding"in i?i:e).padding,t=e.zoomScale(c-a),p=se.pointGeometry.convert(i.offset);let m=e.centerPoint.add(p);const r=e.pointLocation(m),g=se.LngLat.convert(i.center||r),y=(this._normalizeCenter(g),e.project(r)),v=e.project(g).sub(y);let n=i.curve;const _=Math.max(e.width,e.height),x=_/t,b=v.mag();if("minZoom"in i){const o=se.clamp(Math.min(i.minZoom,a,c),e.minZoom,e.maxZoom),s=_/e.zoomScale(o-a);n=Math.sqrt(s/b*2)}const w=n*n;function E(e){e=(x*x-_*_+(e?-1:1)*w*w*b*b)/(2*(e?x:_)*w*b);return Math.log(Math.sqrt(e*e+1)-e)}function T(e){return(Math.exp(e)-Math.exp(-e))/2}function S(e){return(Math.exp(e)+Math.exp(-e))/2}const M=E(0);let k=function(e){return S(M)/S(M+n*e)},C=function(e){return _*((S(M)*(T(e=M+n*e)/S(e))-T(M))/w)/b},A=(E(1)-M)/n;if(Math.abs(b)<1e-6||!isFinite(A)){if(Math.abs(_-x)<1e-6)return this.easeTo(i,o);const se=x<_?-1:1;A=Math.abs(Math.log(x/_))/n,C=function(){return 0},k=function(e){return Math.exp(se*n*e)}}i.duration="duration"in i?+i.duration:1e3*A/("screenSpeed"in i?+i.screenSpeed/n:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const I=s!==h,L=f!==l,P=!e.isPaddingEqual(d),z=n=>e=>{var t=e*A,r=1/k(t),e=(n.zoom=1===e?c:a+n.scaleZoom(r),I&&(n.bearing=se.number(s,h,e)),L&&(n.pitch=se.number(l,f,e)),P&&(n.interpolatePadding(u,d,e),m=n.centerPoint.add(p)),1===e?g:n.unproject(y.add(v.mult(C(t))).mult(r)));return n.setLocationAtPoint(n.renderWorldCopies?e.wrap():e,m),n._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(o),n};if(i.preloadOnly){const se=this._emulate(z,i.duration,e);this._preloadTiles(se)}else this._zooming=!0,this._rotating=I,this._pitching=L,this._padding=P,this._prepareEase(o,!1),this._ease(z(e),()=>this._afterEase(o),i);return this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const e=this._onEaseEnd;this._onEaseEnd=void 0,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(e,t,r){!1===r.animate||0===r.duration?(e(1),t()):(this._easeStart=se.exported.now(),this._easeOptions=r,this._onEaseFrame=e,this._onEaseEnd=t,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){var e=Math.min((se.exported.now()-this._easeStart)/this._easeOptions.duration,1),t=this._onEaseFrame;t&&t(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,t){e=se.wrap(e,-180,180);var r=Math.abs(e-t);return Math.abs(e-360-t)<r&&(e-=360),Math.abs(e+360-t)<r&&(e+=360),e}_normalizeCenter(e){var t=this.transform;t.renderWorldCopies&&!t.maxBounds&&(t=e.lng-t.center.lng,e.lng+=180<t?-360:t<-180?360:0)}_emulate(e,t,r){var n=Math.ceil(15*t/1e3),i=[],o=e(r.clone());for(let e=0;e<=n;e++){const t=o(e/n);i.push(t.clone())}return i}}class Ai{constructor(e={}){this.options=e,se.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){var t=this.options&&this.options.compact;return this._map=e,this._container=l("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=l("button","mapboxgl-ctrl-attrib-button",this._container),l("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=l("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,t){t=this._map._getUIString("AttributionControl."+t);e.setAttribute("aria-label",t),e.removeAttribute("title"),e.firstElementChild&&e.firstElementChild.setAttribute("title",t)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let e=this._editLink;e=e||(this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||se.config.ACCESS_TOKEN}];var t;e&&(t=n.reduce((e,t,r)=>(t.value&&(e+=t.key+"="+t.value+(r<n.length-1?"&":"")),e),"?"),e.href=se.config.FEEDBACK_URL+`/${t}#`+zn(this._map,!0),e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback"))}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(this._map.style){let n=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style._sourceCaches;for(const r in t){var e=t[r];if(e.used){const t=e.getSource();t.attribution&&n.indexOf(t.attribution)<0&&n.push(t.attribution)}}n.sort((e,t)=>e.length-t.length),n=n.filter((t,r)=>{for(let e=r+1;e<n.length;e++)if(0<=n[e].indexOf(t))return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const r=n.join(" | ");r!==this._attribHTML&&(this._attribHTML=r,n.length?(this._innerContainer.innerHTML=r,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ii{constructor(){se.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=l("div","mapboxgl-ctrl");e=l("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(this._map.style){var e=this._map.style._sourceCaches;if(0!==Object.entries(e).length)for(const r in e){var t=e[r].getSource();if(t.hasOwnProperty("mapbox_logo")&&!t.mapbox_logo)return!1}}return!0}_updateCompact(){var e=this._container.children;e.length&&(e=e[0],this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact"))}}class Li{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){var t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,r=t?this._queue.concat(t):this._queue;for(const t of r)if(t.id===e)return void(t.cancelled=!0)}run(e=0){var t=this._currentlyRunning=this._queue;this._queue=[];for(const r of t)if(!r.cancelled&&(r.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Pi(e,t,r){var n,i,o,a,s;for(e=new se.LngLat(e.lng,e.lat),t&&(n=new se.LngLat(e.lng-360,e.lat),i=new se.LngLat(e.lng+360,e.lat),o=360*Math.ceil(Math.abs(e.lng-r.center.lng)/360),a=r.locationPoint(e).distSqr(t),s=t.x<0||t.y<0||t.x>r.width||t.y>r.height,r.locationPoint(n).distSqr(t)<a&&(s||Math.abs(n.lng-r.center.lng)<o)?e=n:r.locationPoint(i).distSqr(t)<a&&(s||Math.abs(i.lng-r.center.lng)<o)&&(e=i));180<Math.abs(e.lng-r.center.lng);){const se=r.locationPoint(e);if(0<=se.x&&0<=se.y&&se.x<=r.width&&se.y<=r.height)break;e.lng>r.center.lng?e.lng-=360:e.lng+=360}return e}const zi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Di extends se.Evented{constructor(e,t){if(super(),(e instanceof se.window.HTMLElement||t)&&(e=se.extend({element:e},t)),se.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=e&&e.occludedOpacity||.2,e&&e.element)this._element=e.element,this._offset=se.pointGeometry.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=l("div");const t=41,r=27,n=o("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},this._element),i=o("radialGradient",{id:"shadowGradient"},o("defs",{},n));o("stop",{offset:"10%","stop-opacity":.4},i),o("stop",{offset:"100%","stop-opacity":.05},i),o("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},n),o("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},n),o("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},n),o("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},n),this._offset=se.pointGeometry.convert(e&&e.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",e=>{e.preventDefault()}),this._element.addEventListener("mousedown",e=>{e.preventDefault()});const r=this._element.classList;for(const se in zi)r.remove("mapboxgl-marker-anchor-"+se);r.add("mapboxgl-marker-anchor-"+this._anchor),this._popup=null}addTo(e){return e!==this._map&&(this.remove(),(this._map=e).getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){var e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=se.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(e){var t;return this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e&&("offset"in e.options||(t=Math.sqrt(Math.pow(13.5,2)/2),e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[t,-1*(24.6+t)],"bottom-right":[-t,-1*(24.6+t)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset),((this._popup=e)._marker=this)._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")),this}_onKeyPress(e){var t=e.code,e=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==e&&13!==e||this.togglePopup()}_onMapClick(e){var e=e.originalEvent.target,t=this._element;this._popup&&(e===t||t.contains(e))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){var e=this._popup;return e&&(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true"))),this}_behindTerrain(){var e=this._map,t=this._pos;return!(!e||!t)&&(t=e.unproject(t),!!(e=e.getFreeCameraOptions()).position&&(e=e.position.toLngLat()).distanceTo(t)<.9*e.distanceTo(this._lngLat))}_evaluateOpacity(){var t=this._map;if(t){var r=this._pos;if(!r||r.x<0||r.x>t.transform.width||r.y<0||r.y>t.transform.height)this._clearFadeTimer();else{r=t.unproject(r);let e;t._showingGlobe()&&se.isLngLatBehindGlobe(t.transform,this._lngLat)?e=0:(e=1-t._queryFogOpacity(r),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(e*=this._occludedOpacity)),this._element.style.opacity=""+e,this._element.style.pointerEvents=0<e?"auto":"none",this._popup&&this._popup._setOpacity(e),this._fadeTimer=null}}}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){var e,t=this._pos;t&&this._map&&(e=this._offset.mult(this._scale),this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${zi[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${e.x}px,${e.y}px)
        `)}_calculateXYTransform(){var e,t=this._pos,r=this._map,n=this.getPitchAlignment();if(!r||!t||"map"!==n)return"";if(r._showingGlobe())return n=se.radToDeg(se.globeTiltAtLngLat(r.transform,this._lngLat)),t=t.sub(se.globeCenterToScreenPoint(r.transform)),0===(e=Math.abs(t.x)+Math.abs(t.y))?"":`rotateX(${-t.y*(n=n/e)}deg) rotateY(${t.x*n}deg)`;{const se=r.getPitch();return se?`rotateX(${se}deg)`:""}}_calculateZTransform(){const e=this._pos,t=this._map;if(!t||!e)return"";let r=0;const n=this.getRotationAlignment();if("map"===n)if(t._showingGlobe()){const e=t.project(new se.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),n=t.project(new se.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(e);r=se.radToDeg(Math.atan2(n.y,n.x))-90}else r=-t.getBearing();else if("horizon"===n){const n=se.smoothstep(4,6,t.getZoom()),o=se.globeCenterToScreenPoint(t.transform);o.y+=n*t.transform.height;var i=e.sub(o),i=se.radToDeg(Math.atan2(i.y,i.x));r=(90<i?i-270:i+90)*(1-n)}return(r+=this._rotation)?`rotateZ(${r}deg)`:""}_update(e){se.window.cancelAnimationFrame(this._updateFrameId);const t=this._map;t&&(t.transform.renderWorldCopies&&(this._lngLat=Pi(this._lngLat,this._pos,t.transform)),this._pos=t.project(this._lngLat),!0===e?this._updateFrameId=se.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),t._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(t._showingGlobe()||t.getTerrain()||t.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(e){return this._offset=se.pointGeometry.convert(e),this._update(),this}_onMove(e){var t=this._map;if(t){var r=this._pointerdownPos,n=this._positionDelta;if(r&&n){if(!this._isDragging){const se=this._clickTolerance||t._clickTolerance;if(e.point.dist(r)<se)return;this._isDragging=!0}this._pos=e.point.sub(n),this._lngLat=t.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new se.Event("dragstart"))),this.fire(new se.Event("drag"))}}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;var e=this._map;e&&(e.off("mousemove",this._onMove),e.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new se.Event("dragend")),this._state="inactive"}_addDragHandler(e){var t=this._map,r=this._pos;t&&r&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(r),this._pointerdownPos=e.point,this._state="pending",t.on("mousemove",this._onMove),t.on("touchmove",this._onMove),t.once("mouseup",this._onUp),t.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;var t=this._map;return t&&(e?(t.on("mousedown",this._addDragHandler),t.on("touchstart",this._addDragHandler)):(t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Oi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ri=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Fi(e=new se.pointGeometry(0,0),t="bottom"){if("number"!=typeof e)return e instanceof se.pointGeometry||Array.isArray(e)?se.pointGeometry.convert(e):se.pointGeometry.convert(e[t]||[0,0]);var r=Math.round(Math.sqrt(.5*Math.pow(e,2)));switch(t){case"top":return new se.pointGeometry(0,e);case"top-left":return new se.pointGeometry(r,r);case"top-right":return new se.pointGeometry(-r,r);case"bottom":return new se.pointGeometry(0,-e);case"bottom-left":return new se.pointGeometry(r,-r);case"bottom-right":return new se.pointGeometry(-r,-r);case"left":return new se.pointGeometry(e,0);case"right":return new se.pointGeometry(-e,0)}return new se.pointGeometry(0,0)}class Bi{constructor(e){this.jumpTo(e)}getValue(e){return e<=this._startTime?this._start:e>=this._endTime?this._end:(e=se.easeCubicInOut((e-this._startTime)/(this._endTime-this._startTime)),this._start*(1-e)+this._end*e)}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,t,r){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+r}}const Ni={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},ji={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Ui={showCompass:!0,showZoom:!0,visualizePitch:!1};class Vi{constructor(e,t,r=!1){this._clickTolerance=10,this.element=t,this.mouseRotate=new ei({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,r&&(this.mousePitch=new ti({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),se.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),t.addEventListener("mousedown",this.mousedown),t.addEventListener("touchstart",this.touchstart,{passive:!1}),t.addEventListener("touchmove",this.touchmove),t.addEventListener("touchend",this.touchend),t.addEventListener("touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),F()}move(e,t){const r=this.map,n=this.mouseRotate.mousemoveWindow(e,t),i=n&&n.bearingDelta;if(i&&r.setBearing(r.getBearing()+i),this.mousePitch){const n=this.mousePitch.mousemoveWindow(e,t),i=n&&n.pitchDelta;i&&r.setPitch(r.getPitch()+i)}}off(){var e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){B(),se.window.removeEventListener("mousemove",this.mousemove),se.window.removeEventListener("mouseup",this.mouseup)}mousedown(e){this.down(se.extend({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),f(this.element,e)),se.window.addEventListener("mousemove",this.mousemove),se.window.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,f(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=d(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=d(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Gi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Wi={maxWidth:100,unit:"metric"};function Zi(e,t,r){const n=qi(t),i=n/t,o={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[r];this._map._requestDomTask(()=>{this._container.style.width=e*i+"px",this._container.innerHTML=n+"&nbsp;"+o})}function qi(e){var t=Math.pow(10,(""+Math.floor(e)).length-1),e=e/t;return t*(10<=e?10:5<=e?5:3<=e?3:2<=e?2:1<=e?1:(t=e,e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10)),Math.round(t*e)/e))}const Hi={version:se.version,supported:A,setRTLTextPlugin:se.setRTLTextPlugin,getRTLTextPluginStatus:se.getRTLTextPluginStatus,Map:class extends Ci{constructor(e){if(se.LivePerformanceUtils.mark(se.PerformanceMarkers.create),null!=(e=se.extend({},ji,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&85<e.maxPitch)throw new Error("maxPitch must be less than or equal to 85");if(e.antialias&&se.isSafariWithAntialiasingBug(se.window)&&(e.antialias=!1,se.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new In(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._interactive=e.interactive,this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._useWebGL2=e.useWebGL2,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._collectResourceTiming=e.collectResourceTiming,this._optimizeForTerrain=e.optimizeForTerrain,this._language=this._parseLanguage(e.language),this._worldview=e.worldview,this._renderTaskQueue=new Li,this._domRenderTaskQueue=new Li,this._controls=[],this._markers=[],this._popups=[],this._mapId=se.uniqueId(),this._locale=se.extend({},Ni,e.locale),this._clickTolerance=e.clickTolerance,this._cooperativeGestures=e.cooperativeGestures,this._performanceMetricsCollection=e.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Bi(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new se.RequestManager(e.transformRequest,e.accessToken,e.testMode),this._silenceAuthErrors=!!e.testMode,"string"==typeof e.container){if(this._container=se.window.document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof se.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(0<this._container.childNodes.length&&se.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),e.maxBounds&&this.setMaxBounds(e.maxBounds),se.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==se.window&&(se.window.addEventListener("online",this._onWindowOnline,!1),se.window.addEventListener("resize",this._onWindowResize,!1),se.window.addEventListener("orientationchange",this._onWindowResize,!1),se.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),se.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Mi(this,e),this._localFontFamily=e.localFontFamily,this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),e.projection&&this.setProjection(e.projection),this._hash=e.hash&&new Pn("string"==typeof e.hash&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,se.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),e.attributionControl&&this.addControl(new Ai({customAttribution:e.customAttribution})),this._logoControl=new Ii,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",e=>{this._update("style"===e.dataType),this.fire(new se.Event(e.dataType+"data",e))}),this.on("dataloading",e=>{this.fire(new se.Event(e.dataType+"dataloading",e))})}_getMapId(){return this._mapId}addControl(e,t){var r;return void 0===t&&(t=e.getDefaultPosition?e.getDefaultPosition():"top-right"),e&&e.onAdd?(r=e.onAdd(this),this._controls.push(e),e=this._controlPositions[t],-1!==t.indexOf("bottom")?e.insertBefore(r,e.firstChild):e.appendChild(r),this):this.fire(new se.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")))}removeControl(e){var t;return e&&e.onRemove?(-1<(t=this._controls.indexOf(e))&&this._controls.splice(t,1),e.onRemove(this),this):this.fire(new se.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")))}hasControl(e){return-1<this._controls.indexOf(e)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(e){var t;return this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height||(this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),(t=!this._moving)&&this.fire(new se.Event("movestart",e)).fire(new se.Event("move",e)),this.fire(new se.Event("resize",e)),t&&this.fire(new se.Event("moveend",e))),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(e){return this.transform.setMaxBounds(se.LngLatBounds.convert(e)),this._update()}setMinZoom(e){if(-2<=(e=null==e?-2:e)&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e?this.setZoom(e):this.fire(new se.Event("zoomstart")).fire(new se.Event("zoom")).fire(new se.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e?this.setZoom(e):this.fire(new se.Event("zoomstart")).fire(new se.Event("zoom")).fire(new se.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(0<=e&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e?this.setPitch(e):this.fire(new se.Event("pitchstart")).fire(new se.Event("pitch")).fire(new se.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if(85<(e=null==e?85:e))throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e?this.setPitch(e):this.fire(new se.Event("pitchstart")).fire(new se.Event("pitch")).fire(new se.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return"auto"===e?se.window.navigator.language:Array.isArray(e)?0===e.length?void 0:e.map(e=>"auto"===e?se.window.navigator.language:e):e}setLanguage(e){e=this._parseLanguage(e);if(this.style&&e!==this._language){this._language=e,this.style._reloadSources();for(const e of this._controls)e._setLanguage&&e._setLanguage(this._language)}return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview&&(this._worldview=e,this.style._reloadSources()),this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"===this.getProjection().name){var t=this.transform,r=t.projection.name;let e;"globe"===r&&t.zoom>=se.GLOBE_ZOOM_THRESHOLD_MAX?(t.setMercatorFromTransition(),e=!0):"mercator"===r&&t.zoom<se.GLOBE_ZOOM_THRESHOLD_MAX&&(t.setProjection({name:"globe"}),e=!0),e&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(e){e="globe"===e.name&&this.transform.zoom>=se.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(e);if(this.style.applyProjectionUpdate(),e){this.painter.clearBackgroundTiles();for(const se in this.style._sourceCaches)this.style._sourceCaches[se].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(e){return this.transform.locationPoint3D(se.LngLat.convert(e))}unproject(e){return this.transform.pointLocation3D(se.pointGeometry.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(n,i,o){if("mouseenter"===n||"mouseover"===n){let r=!1;return{layers:new Set(i),listener:o,delegates:{mousemove:e=>{var t=i.filter(e=>this.getLayer(e)),t=t.length?this.queryRenderedFeatures(e.point,{layers:t}):[];t.length?r||(r=!0,o.call(this,new C(n,this,e.originalEvent,{features:t}))):r=!1},mouseout:()=>{r=!1}}}}if("mouseleave"===n||"mouseout"===n){let r=!1;return{layers:new Set(i),listener:o,delegates:{mousemove:e=>{var t=i.filter(e=>this.getLayer(e));(t.length?this.queryRenderedFeatures(e.point,{layers:t}):[]).length?r=!0:r&&(r=!1,o.call(this,new C(n,this,e.originalEvent)))},mouseout:e=>{r&&(r=!1,o.call(this,new C(n,this,e.originalEvent)))}}}}return{layers:new Set(i),listener:o,delegates:{[n]:e=>{var t=i.filter(e=>this.getLayer(e)),t=t.length?this.queryRenderedFeatures(e.point,{layers:t}):[];t.length&&(e.features=t,o.call(this,e),delete e.features)}}}}on(e,t,r){if(void 0===r)return super.on(e,t);Array.isArray(t)||(t=[t]);var n=this._createDelegatedListener(e,t,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(n);for(const e in n.delegates)this.on(e,n.delegates[e]);return this}once(e,t,r){if(void 0===r)return super.once(e,t);Array.isArray(t)||(t=[t]);var n=this._createDelegatedListener(e,t,r);for(const e in n.delegates)this.once(e,n.delegates[e]);return this}off(e,n,i){if(void 0===i)return super.off(e,n);n=new Set(Array.isArray(n)?n:[n]);const t=this._delegatedListeners?this._delegatedListeners[e]:void 0;return t&&(t=>{for(let e=0;e<t.length;e++){var r=t[e];if(r.listener===i&&((e,t)=>{if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0})(r.layers,n)){for(const t in r.delegates)this.off(t,r.delegates[t]);return t.splice(e,1)}}})(t),this}queryRenderedFeatures(e,t){return this.style?(void 0!==t||void 0===e||e instanceof se.pointGeometry||Array.isArray(e)||(t=e,e=void 0),this.style.queryRenderedFeatures(e=e||[[0,0],[this.transform.width,this.transform.height]],t=t||{},this.transform)):[]}querySourceFeatures(e,t){return this.style.querySourceFeatures(e,t)}setStyle(e,t){return!1!==(t=se.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&e?(this._diffStyle(e,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(e,t))}_getUIString(e){var t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e&&(this.style=new p(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new p(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,r){var t;"string"==typeof e?(t=this._requestManager.normalizeStyleURL(e),t=this._requestManager.transformRequest(t,se.ResourceType.Style),se.getJSON(t,(e,t)=>{e?this.fire(new se.ErrorEvent(e)):t&&this._updateDiff(t,r)})):"object"==typeof e&&this._updateDiff(e,r)}_updateDiff(t,r){try{this.style.setState(t)&&this._update(!0)}catch(e){se.warnOnce(`Unable to perform style diff: ${e.message||e.error||e}.  Rebuilding the style from scratch.`),this._updateStyle(t,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(se.warnOnce("There is no style added to the map."),!1)}addSource(e,t){return this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)}isSourceLoaded(e){return!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){const e=this.style&&this.style._sourceCaches;for(const n in e){var t=e[n]._tiles;for(const e in t){var r=t[e];if("loaded"!==r.state&&"errored"!==r.state)return!1}}return!0}addSourceType(e,t,r){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,r)}removeSource(e){return this.style.removeSource(e),this._updateTerrain(),this._update(!0)}getSource(e){return this.style.getSource(e)}addImage(e,t,{pixelRatio:r=1,sdf:n=!1,stretchX:i,stretchY:o,content:a}={}){var s,l,u;this._lazyInitEmptyStyle(),t instanceof se.window.HTMLImageElement||se.window.ImageBitmap&&t instanceof se.window.ImageBitmap?({width:s,height:l,data:u}=se.exported.getImageData(t),this.style.addImage(e,{data:new se.RGBAImage({width:s,height:l},u),pixelRatio:r,stretchX:i,stretchY:o,content:a,sdf:n,version:0})):void 0===t.width||void 0===t.height?this.fire(new se.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):({width:s,height:l}=t,u=t,this.style.addImage(e,{data:new se.RGBAImage({width:s,height:l},new Uint8Array(u.data)),pixelRatio:r,stretchX:i,stretchY:o,content:a,sdf:n,version:0,userImage:u}),u.onAdd&&u.onAdd(this,e))}updateImage(e,t){var r,n,i,o=this.style.getImage(e);o?({width:n,height:i}=r=t instanceof se.window.HTMLImageElement||se.window.ImageBitmap&&t instanceof se.window.ImageBitmap?se.exported.getImageData(t):t,void 0!==n&&void 0!==i?n===o.data.width&&i===o.data.height?(o.data.replace(r.data,!(t instanceof se.window.HTMLImageElement||se.window.ImageBitmap&&t instanceof se.window.ImageBitmap)),this.style.updateImage(e,o)):this.fire(new se.ErrorEvent(new Error(`The width and height of the updated image (${n}, ${i})
                must be that same as the previous version of the image
                (${o.data.width}, ${o.data.height})`))):this.fire(new se.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))):this.fire(new se.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")))}hasImage(e){return e?!!this.style.getImage(e):(this.fire(new se.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(e,r){se.getImage(this._requestManager.transformRequest(e,se.ResourceType.Image),(e,t)=>{r(e,t instanceof se.window.HTMLImageElement?se.exported.getImageData(t):t)})}listImages(){return this.style.listImages()}addLayer(e,t){return this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)}moveLayer(e,t){return this.style.moveLayer(e,t),this._update(!0)}removeLayer(e){return this.style.removeLayer(e),this._update(!0)}getLayer(e){return this.style.getLayer(e)}setLayerZoomRange(e,t,r){return this.style.setLayerZoomRange(e,t,r),this._update(!0)}setFilter(e,t,r={}){return this.style.setFilter(e,t,r),this._update(!0)}getFilter(e){return this.style.getFilter(e)}setPaintProperty(e,t,r,n={}){return this.style.setPaintProperty(e,t,r,n),this._update(!0)}getPaintProperty(e,t){return this.style.getPaintProperty(e,t)}setLayoutProperty(e,t,r,n={}){return this.style.setLayoutProperty(e,t,r,n),this._update(!0)}getLayoutProperty(e,t){return this.style.getLayoutProperty(e,t)}setLight(e,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(e,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(e){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(se.LngLat.convert(e),this.transform):0}setFeatureState(e,t){return this.style.setFeatureState(e,t),this._update()}removeFeatureState(e,t){return this.style.removeFeatureState(e,t),this._update()}getFeatureState(e){return this.style.getFeatureState(e)}_updateContainerDimensions(){if(this._container){const i=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let e,t,r,n=this._container;for(;n&&(!t||!r);){const i=se.window.getComputedStyle(n).transform;i&&"none"!==i&&((e=i.match(/matrix.*\((.+)\)/)[1].split(", "))[0]&&"0"!==e[0]&&"1"!==e[0]&&(t=e[0]),e[3]&&"0"!==e[3]&&"1"!==e[3]&&(r=e[3])),n=n.parentElement}this._containerWidth=t?Math.abs(i/t):i,this._containerHeight=r?Math.abs(o/r):o}}_detectMissingCSS(){"rgb(250, 128, 114)"!==se.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&se.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){var e=this._container,t=(e.classList.add("mapboxgl-map"),(this._missingCSSCanary=l("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS(),this._canvasContainer=l("div","mapboxgl-canvas-container",e));this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=l("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const r=this._controlContainer=l("div","mapboxgl-control-container",e),n=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(e=>{n[e]=l("div","mapboxgl-ctrl-"+e,r)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,t){var r=se.exported.devicePixelRatio||1;this._canvas.width=r*Math.ceil(e),this._canvas.height=r*Math.ceil(t),this._canvas.style.width=e+"px",this._canvas.style.height=t+"px"}_addMarker(e){this._markers.push(e)}_removeMarker(e){e=this._markers.indexOf(e);-1!==e&&this._markers.splice(e,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){e=this._popups.indexOf(e);-1!==e&&this._popups.splice(e,1)}_setupPainter(){var e=se.extend({},A.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._useWebGL2&&this._canvas.getContext("webgl2",e),e=t||this._canvas.getContext("webgl",e)||this._canvas.getContext("experimental-webgl",e);e?(this._useWebGL2&&!t&&se.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),se.storeAuthState(e,!0),this.painter=new vn(e,this.transform,!!t),this.on("data",e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)}),se.exported$1.testSupport(e)):this.fire(new se.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new se.Event("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new se.Event("webglcontextrestored",{originalEvent:e}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style&&(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint()),this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(t){let r;const n=this.painter.context.extTimerQuery,i=se.exported.now();if(this.listens("gpu-timing-frame")&&(r=n.createQueryEXT(),n.beginQueryEXT(n.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],se.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],se.window.performance.now())),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),!this._removed){this._updateProjectionTransition();var o=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,r=this.transform.pitch,n=se.exported.now(),i=new se.EvaluationParameters(t,{now:n,fadeDuration:o,pitch:r,transition:this.style.getTransition()});this.style.update(i)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let e=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),e=this._updateAverageElevation(i),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):e=this._updateAverageElevation(i),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new se.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new se.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const t=se.exported.now()-i;n.endQueryEXT(n.TIME_ELAPSED_EXT,r),setTimeout(()=>{var e=n.getQueryObjectEXT(r,n.QUERY_RESULT_EXT)/1e6;n.deleteQueryEXT(r),this.fire(new se.Event("gpu-timing-frame",{cpuTime:t,gpuTime:e})),se.window.performance.mark("frame-gpu",{startTime:i,detail:{gpuTime:e}})},50)}if(this.listens("gpu-timing-layer")){const t=this.painter.collectGpuTimers();setTimeout(()=>{var e=this.painter.queryGpuTimers(t);this.fire(new se.Event("gpu-timing-layer",{layerTimes:e}))},50)}if(this.listens("gpu-timing-deferred-render")){const t=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{var e=this.painter.queryGpuTimeDeferredRender(t);this.fire(new se.Event("gpu-timing-deferred-render",{gpuTime:e}))},50)}t=this._sourcesDirty||this._styleDirty||this._placementDirty||e;if(t||this._repaint)this.triggerRepaint();else{const t=!this.isMoving()&&this.loaded();if(e=t?this._updateAverageElevation(i,!0):e)this.triggerRepaint();else if(this._triggerFrame(!1),t&&(this.fire(new se.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const t=this._calculateSpeedIndex();this.fire(new se.Event("speedindexcompleted",{speedIndex:t})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||t||(this._fullyLoaded=!0,se.LivePerformanceUtils.mark(se.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&se.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}}_forceMarkerAndPopupUpdate(e){for(const t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const r of this._popups)!e||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(r,n=!1){var i=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&i(0);if((n||500<r-this._averageElevationLastSampledAt)&&!this._averageElevation.isEasing(r)){const n=this.transform.averageElevation;let e=this.transform.sampleAverageElevation(),t=!1;this.transform.elevation&&(t=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(e)?e=0:this._averageElevationLastSampledAt=r;var o=Math.abs(n-e);if(1<o){if(this._isInitialLoad||t)return this._averageElevation.jumpTo(e),i(e);this._averageElevation.easeTo(e,r,300)}else if(1e-4<o)return this._averageElevation.jumpTo(e),i(e)}return!!this._averageElevation.isEasing(r)&&i(this._averageElevation.getValue(r))}_authenticate(){se.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,e=>{if(e&&(e.message===se.AUTH_ERR_MSG||401===e.status)){const e=this.painter.context.gl;se.storeAuthState(e,!1),this._logoControl instanceof Ii&&this._logoControl._updateLogo(),e&&e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new se.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),se.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){var e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){var e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const r=this.painter.context.gl,n=r.createFramebuffer();function i(e){r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0);e=new Uint8Array(r.drawingBufferWidth*r.drawingBufferHeight*4);return r.readPixels(0,0,r.drawingBufferWidth,r.drawingBufferHeight,r.RGBA,r.UNSIGNED_BYTE,e),e}return r.bindFramebuffer(r.FRAMEBUFFER,n),this._canvasPixelComparison(i(e),t.canvasCopies.map(i),t.timeStamps)}_canvasPixelComparison(r,n,i){let o=i[1]-i[0];var a=r.length/4;for(let e=0;e<n.length;e++){var s=n[e];let t=0;for(let e=0;e<s.length;e+=4)s[e]===r[e]&&s[e+1]===r[e+1]&&s[e+2]===r[e+2]&&s[e+3]===r[e+3]&&(t+=1);o+=(i[e+2]-i[e+1])*(1-t/a)}return o}remove(){this._hash&&this._hash.remove();for(const se of this._controls)se.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==se.window&&(se.window.removeEventListener("resize",this._onWindowResize,!1),se.window.removeEventListener("orientationchange",this._onWindowResize,!1),se.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),se.window.removeEventListener("online",this._onWindowOnline,!1),se.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));var e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),se.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new se.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=se.exported.frame(e=>{var t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)}))}_preloadTiles(r){var e=this.style?Object.values(this.style._sourceCaches):[];return se.asyncAll(e,(e,t)=>e._preloadTiles(r,t),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){"hidden"===se.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&((this._showCollisionBoxes=e)?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&((this._showTileAABBs=e)&&this._update())}_setCacheLimits(e,t){se.setCacheLimits(e,t)}get version(){return se.version}},NavigationControl:class{constructor(e){this.options=se.extend({},Ui,e),this._container=l("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(se.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",e=>{this._map&&this._map.zoomIn({},{originalEvent:e})}),l("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",e=>{this._map&&this._map.zoomOut({},{originalEvent:e})}),l("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(se.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",e=>{var t=this._map;t&&(this.options.visualizePitch?t.resetNorthPitch({},{originalEvent:e}):t.resetNorth({},{originalEvent:e}))}),this._compassIcon=l("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){var e,t,r=this._map;r&&(e=(t=r.getZoom())===r.getMaxZoom(),t=t===r.getMinZoom(),this._zoomInButton.disabled=e,this._zoomOutButton.disabled=t,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",t.toString()))}_rotateCompassArrow(){var e=this._map;if(e){const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5)}) rotateX(${e.transform.pitch}deg) rotateZ(${e.transform.angle*(180/Math.PI)}deg)`:`rotate(${e.transform.angle*(180/Math.PI)}deg)`;e._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Vi(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){var e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){e=l("button",e,this._container);return e.type="button",e.addEventListener("click",t),e}_setButtonTitle(e,t){this._map&&(t=this._map._getUIString("NavigationControl."+t),e.setAttribute("aria-label",t),e.firstElementChild&&e.firstElementChild.setAttribute("title",t))}},GeolocateControl:class extends se.Evented{constructor(e){super(),this.options=se.extend({geolocation:se.window.navigator.geolocation},Gi,e),se.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ln(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=l("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(t){const r=(e=!!this.options.geolocation)=>{this._supportsGeolocation=e,t(e)};void 0!==this._supportsGeolocation?t(this._supportsGeolocation):void 0!==se.window.navigator.permissions?se.window.navigator.permissions.query({name:"geolocation"}).then(e=>r("denied"!==e.state)).catch(()=>r()):r()}_isOutOfMapMaxBounds(e){var t=this._map.getMaxBounds(),e=e.coords;return!!t&&(e.longitude<t.getWest()||e.longitude>t.getEast()||e.latitude<t.getSouth()||e.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))this._setErrorState(),this.fire(new se.Event("outofmaxbounds",e)),this._updateMarker();else{if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new se.Event("geolocate",e))}this._finish()}}_updateCamera(e){var t=new se.LngLat(e.coords.longitude,e.coords.latitude),e=e.coords.accuracy,r=this._map.getBearing(),r=se.extend({bearing:r},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(e),r,{geolocateSource:!0})}_updateMarker(e){var t;e?(t=new se.LngLat(e.coords.longitude,e.coords.latitude),this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()):(this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove())}_updateCircleRadius(){var e=this._map.transform,e=se.mercatorZfromAltitude(1,e._center.lat)*e.worldSize,e=Math.ceil(2*this._accuracy*e);this._circleElement.style.width=e+"px",this._circleElement.style.height=e+"px"}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const se=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",se),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",se),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new se.Event("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=l("button","mapboxgl-ctrl-geolocate",this._container),l("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),!(this._geolocateButton.type="button")===e){se.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}else{const se=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",se),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",se)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=l("div","mapboxgl-user-location"),this._dotElement.appendChild(l("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(l("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Di({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=l("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Di({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new se.Event("trackuserlocationend")))})}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return se.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new se.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new se.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new se.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,1<this._numberOfWatches?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const t=()=>{se.window.addEventListener("ondeviceorientationabsolute"in se.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==se.window.DeviceMotionEvent&&"function"==typeof se.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(e=>{"granted"===e&&t()}).catch(console.error):t()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),se.window.removeEventListener("deviceorientation",this._onDeviceOrientation),se.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ai,ScaleControl:class{constructor(e){this.options=se.extend({},Wi,e),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),1}catch(e){}}()||(this._setScale=Zi.bind(this)),se.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,r=t._containerHeight/2,n=t._containerWidth/2-e/2,i=t.unproject([n,r]),o=t.unproject([n+e,r]),a=i.distanceTo(o);if("imperial"===this.options.unit){const t=3.2808*a;5280<t?this._setScale(e,t/5280,"mile"):this._setScale(e,t,"foot")}else"nautical"===this.options.unit?this._setScale(e,a/1852,"nautical-mile"):1e3<=a?this._setScale(e,a/1e3,"kilometer"):this._setScale(e,a,"meter")}_setScale(e,t,r){const n=qi(t),i=n/t;this._map._requestDomTask(()=>{this._container.style.width=e*i+"px",this._container.innerHTML="nautical-mile"!==r?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:r}).format(n):n+"&nbsp;nm"})}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=l("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof se.window.HTMLElement?this._container=e.container:se.warnOnce("Full screen control 'container' must be a DOM element.")),se.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in se.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in se.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=l("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",se.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,se.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!se.window.document.fullscreenEnabled&&!se.window.document.webkitFullscreenEnabled)}_setupUI(){var e=this._fullscreenButton=l("button","mapboxgl-ctrl-fullscreen",this._controlContainer);l("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),se.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){var e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(se.window.document.fullscreenElement||se.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?se.window.document.exitFullscreen?se.window.document.exitFullscreen():se.window.document.webkitCancelFullScreen&&se.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends se.Evented{constructor(e){super(),this.options=se.extend(Object.create(Oi),e),se.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(e&&e.className?e.className.trim().split(/\s+/):[])}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&e.on("preclick",this._onClose),this.options.closeOnMove&&e.on("move",this._onClose),e.on("remove",this.remove),this._update(),e._addPopup(this),this._focusFirstElement(),this._trackPointer?(e.on("mousemove",this._onMouseEvent),e.on("mouseup",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")):e.on("move",this._update),this.fire(new se.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);var e=this._map;return e&&(e.off("move",this._update),e.off("move",this._onClose),e.off("preclick",this._onClose),e.off("click",this._onClose),e.off("remove",this.remove),e.off("mousemove",this._onMouseEvent),e.off("mouseup",this._onMouseEvent),e.off("drag",this._onMouseEvent),e._canvasContainer&&e._canvasContainer.classList.remove("mapboxgl-track-pointer"),e._removePopup(this),this._map=void 0),this.fire(new se.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(e){this._lngLat=se.LngLat.convert(e),this._pos=null,this._trackPointer=!1,this._update();e=this._map;return e&&(e.on("move",this._update),e.off("mousemove",this._onMouseEvent),e._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();var e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(se.window.document.createTextNode(e))}setHTML(e){var t,r=se.window.document.createDocumentFragment(),n=se.window.document.createElement("body");for(n.innerHTML=e;t=n.firstChild;)r.appendChild(t);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=l("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const e=this._closeButton=l("button","mapboxgl-popup-close-button",t);e.type="button",e.setAttribute("aria-label","Close popup"),e.setAttribute("aria-hidden","true"),e.innerHTML="&#215;",e.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return t=!this._classList.delete(e)&&(this._classList.add(e),!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;var t=this._map,r=this._container,n=this._pos;if(!t||!r||!n)return"bottom";var i=r.offsetWidth,r=r.offsetHeight,o=n.x<i/2,i=n.x>t.transform.width-i/2;if(n.y+e<r)return o?"top-left":i?"top-right":"top";if(n.y>t.transform.height-r){if(o)return"bottom-left";if(i)return"bottom-right"}return o?"left":i?"right":"bottom"}_updateClassList(){var e,t=this._container;t&&((e=[...this._classList]).push("mapboxgl-popup"),this._anchor&&e.push("mapboxgl-popup-anchor-"+this._anchor),this._trackPointer&&e.push("mapboxgl-popup-track-pointer"),t.className=e.join(" "))}_update(t){const r=this._map,n=this._content;if(r&&(this._lngLat||this._trackPointer)&&n){let e=this._container;if(e||(e=this._container=l("div","mapboxgl-popup",r.getContainer()),this._tip=l("div","mapboxgl-popup-tip",e),e.appendChild(n)),this.options.maxWidth&&e.style.maxWidth!==this.options.maxWidth&&(e.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Pi(this._lngLat,this._pos,r.transform)),!this._trackPointer||t){const se=this._pos=this._trackPointer&&t?t:r.project(this._lngLat),n=Fi(this.options.offset),e=this._anchor=this._getAnchor(n.y),l=Fi(this.options.offset,e),i=se.add(l).round();r._requestDomTask(()=>{this._container&&e&&(this._container.style.transform=`${zi[e]} translate(${i.x}px,${i.y}px)`)})}if(!this._marker&&r._showingGlobe()){const t=se.isLngLatBehindGlobe(r.transform,this._lngLat)?0:1;this._setOpacity(t)}this._updateClassList()}}_focusFirstElement(){var e;this.options.focusAfterOpen&&this._container&&((e=this._container.querySelector(Ri))&&e.focus())}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity=""+e),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:Di,Style:p,LngLat:se.LngLat,LngLatBounds:se.LngLatBounds,Point:se.pointGeometry,MercatorCoordinate:se.MercatorCoordinate,FreeCameraOptions:En,Evented:se.Evented,config:se.config,prewarm:function(){c().acquire(at)},clearPrewarmedResources:function(){var e=s;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(at),s=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return se.config.ACCESS_TOKEN},set accessToken(e){se.config.ACCESS_TOKEN=e},get baseApiUrl(){return se.config.API_URL},set baseApiUrl(e){se.config.API_URL=e},get workerCount(){return n.workerCount},set workerCount(e){n.workerCount=e},get maxParallelImageRequests(){return se.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){se.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){se.clearTileCache(e)},workerUrl:"",workerClass:null,setNow:se.exported.setNow,restoreNow:se.exported.restoreNow};return Hi}),a}(),{}),Xi=(f.stringQs=function(e){return e.split("&").reduce(function(e,t){t=t.split("=");return 2===t.length&&(e[t[0]]=null===t[1]?"":decodeURIComponent(t[1])),e},{})},f.qsString=function(t,e){return Object.keys(t).sort().map(function(e){return encodeURIComponent(e)+"="+(""+t[e]).replace("&","%26")}).join("&")},{exports:{}});function ud(e){var t=0;if(e&&0<e.length){t+=Math.abs(cd(e[0]));for(var r=1;r<e.length;r++)t-=Math.abs(cd(e[r]))}return t}function cd(e){var t,r,n,i,o,a,s=0,l=e.length;if(2<l){for(a=0;a<l;a++)o=a===l-2?(n=l-2,i=l-1,0):a===l-1?(n=l-1,i=0,1):(i=(n=a)+1,a+2),t=e[n],r=e[i],s+=(hd(e[o][0])-hd(t[0]))*Math.sin(hd(r[1]));s=s*Wh*Wh/2}return s}function hd(e){return e*Math.PI/180}function fd(e,t){var r=Cf[e.geometry.type]-Cf[t.geometry.type];return 0==r&&e.geometry.type===hf?e.area-t.area:r}function dd(e){if(this._items={},this._nums={},this._length=e?e.length:0,e)for(var t=0,r=e.length;t<r;t++)this.add(e[t]),void 0!==e[t]&&("string"==typeof e[t]?this._items[e[t]]=t:this._nums[e[t]]=t)}function pd(e,t,r,n){var i,o;return null===r.map?[]:(e=e?(n=n,[[e.point.x-(n=void 0===n?0:n),e.point.y-n],[e.point.x+n,e.point.y+n]]):t,n={},r.options.styles&&(n.layers=r.options.styles.map(function(e){return e.id})),t=r.map.queryRenderedFeatures(e,n).filter(function(e){return-1!==Af.indexOf(e.properties.meta)}),i=new dd,o=[],t.forEach(function(e){var t=e.properties.id;i.has(t)||(i.add(t),o.push(e))}),o.map(function(e){return e.geometry.type===hf&&(e.area=Zh.geometry({type:cf,property:{},geometry:e.geometry})),e}).sort(fd).map(function(e){return delete e.area,e}))}function md(e,t){var e=If.click(e,null,t),r={mouse:"none"};return e[0]&&(r.mouse=e[0].properties.active===Sf?af:lf,r.feature=e[0].properties.meta),-1!==t.events.currentModeName().indexOf("draw")&&(r.mouse=of),t.ui.queueMapClasses(r),t.ui.updateMapClasses(),e[0]}function gd(e,t){var r=e.x-t.x,e=e.y-t.y;return Math.sqrt(r*r+e*e)}function yd(e,t,r){var n=null!=(r=void 0===r?{}:r).fineTolerance?r.fineTolerance:4,i=null!=r.grossTolerance?r.grossTolerance:12,r=null!=r.interval?r.interval:500,o=(e.point=e.point||t.point,e.time=e.time||t.time,gd(e.point,t.point));return o<n||o<i&&t.time-e.time<r}function vd(e,t,r){var n=null!=(r=void 0===r?{}:r).tolerance?r.tolerance:25,r=null!=r.interval?r.interval:250;return e.point=e.point||t.point,e.time=e.time||t.time,gd(e.point,t.point)<n&&t.time-e.time<r}function _d(e,t){return e(t={exports:{}},t.exports),t.exports}function C(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}function xd(e){return[].concat(e).filter(function(e){return void 0!==e})}function A(e){var t,r=this;this._features={},this._featureIds=new dd,this._selectedFeatureIds=new dd,this._selectedCoordinates=[],this._changedFeatureIds=new dd,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]},this.render=function(){t=t||requestAnimationFrame(function(){t=null,function(){var r=this;if(!r.ctx.map||void 0===r.ctx.map.getSource(rf))return a();var n=r.ctx.events.currentModeName(),t=(r.ctx.ui.queueMapClasses({mode:n}),[]),e=[],e=r.isDirty?r.getAllIds():(t=r.getChangedIds().filter(function(e){return void 0!==r.get(e)}),r.sources.hot.filter(function(e){return e.properties.id&&-1===t.indexOf(e.properties.id)&&void 0!==r.get(e.properties.id)}).map(function(e){return e.properties.id})),i=(r.sources.hot=[],r.sources.cold.length),i=(r.sources.cold=r.isDirty?[]:r.sources.cold.filter(function(e){e=e.properties.id||e.properties.parent;return-1===t.indexOf(e)}),i!==r.sources.cold.length||0<e.length);function o(e,t){e=r.get(e).internal(n);r.ctx.events.currentModeRender(e,function(e){r.sources[t].push(e)})}function a(){r.isDirty=!1,r.clearChangedIds()}t.forEach(function(e){return o(e,"hot")}),e.forEach(function(e){return o(e,"cold")}),i&&r.ctx.map.getSource(nf).setData({type:pf,features:r.sources.cold}),r.ctx.map.getSource(rf).setData({type:pf,features:r.sources.hot}),r._emitSelectionChange&&(r.ctx.map.fire(vf,{features:r.getSelected().map(function(e){return e.toGeoJSON()}),points:r.getSelectedCoordinates().map(function(e){return{type:cf,properties:{},geometry:{type:df,coordinates:e.coordinates}}})}),r._emitSelectionChange=!1),r._deletedFeaturesToEmit.length&&(e=r._deletedFeaturesToEmit.map(function(e){return e.toGeoJSON()}),r._deletedFeaturesToEmit=[],r.ctx.map.fire(gf,{features:e})),a(),r.ctx.map.fire(bf,{})}.call(r)})},this.isDirty=!1}function bd(t,e){var r=t._selectedCoordinates.filter(function(e){return t._selectedFeatureIds.has(e.feature_id)});t._selectedCoordinates.length===r.length||e.silent||(t._emitSelectionChange=!0),t._selectedCoordinates=r}function wd(t){return function(e){e=e.featureTarget;return!!e&&!!e.properties&&e.properties.meta===t}}function Ed(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===Sf&&e.featureTarget.properties.meta===wf}function Td(e){return e.featureTarget&&e.featureTarget.properties&&e.featureTarget.properties.active===Mf&&e.featureTarget.properties.meta===wf}function Sd(e){return void 0===e.featureTarget}function Md(e){e=e.featureTarget;return e&&e.properties&&e.properties.meta===Tf}function kd(e){return!!e.originalEvent&&!0===e.originalEvent.shiftKey}function Cd(e){return 27===e.keyCode}function Ad(e){return 13===e.keyCode}function Id(e,t){this.x=e,this.y=t}function Ld(e,t){var r=t.getBoundingClientRect();return new Wf(e.clientX-r.left-(t.clientLeft||0),e.clientY-r.top-(t.clientTop||0))}function Pd(e,t,r,n){return{type:cf,properties:{meta:Tf,parent:e,coord_path:r,active:n?Sf:Mf},geometry:{type:df,coordinates:t}}}function zd(r,u,n){void 0===u&&(u={}),void 0===n&&(n=null);var i,e=r.geometry,t=e.type,e=e.coordinates,c=r.properties&&r.properties.id,h=[];function o(e,a){var s="",l=null;e.forEach(function(e,t){var r,n,i=null!=a?a+"."+t:String(t),i=Pd(c,e,i,f(i)),o=(u.midpoints&&l&&(r=l.geometry.coordinates,n=i.geometry.coordinates,(n=85<r[1]||r[1]<-85||85<n[1]||n[1]<-85?null:(o=(r[0]+n[0])/2,r=(r[1]+n[1])/2,{type:cf,properties:{meta:Ef,parent:c,lng:o,lat:r,coord_path:i.properties.coord_path},geometry:{type:df,coordinates:[o,r]}}))&&h.push(n)),l=i,JSON.stringify(e));s!==o&&h.push(i),0===t&&(s=o)})}function f(e){return!!u.selectedPaths&&-1!==u.selectedPaths.indexOf(e)}return t===df?h.push(Pd(c,e,n,f(n))):t===hf?e.forEach(function(e,t){o(e,null!==n?n+"."+t:String(t))}):t===ff?o(e,n):0===t.indexOf("Multi")&&(i=t.replace("Multi",""),e.forEach(function(e,t){e={type:cf,properties:r.properties,geometry:{type:i,coordinates:e}};h=h.concat(zd(e,u,t))})),h}function Dd(t){switch(t&&t.type||null){case"FeatureCollection":return t.features=t.features.reduce(function(e,t){return e.concat(Dd(t))},[]),t;case"Feature":return t.geometry?Dd(t.geometry).map(function(e){e={type:"Feature",properties:JSON.parse(JSON.stringify(t.properties)),geometry:e};return void 0!==t.id&&(e.id=t.id),e}):[t];case"MultiPoint":return t.coordinates.map(function(e){return{type:"Point",coordinates:e}});case"MultiPolygon":return t.coordinates.map(function(e){return{type:"Polygon",coordinates:e}});case"MultiLineString":return t.coordinates.map(function(e){return{type:"LineString",coordinates:e}});case"GeometryCollection":return t.geometries.map(Dd).reduce(function(e,t){return e.concat(t)},[]);case"Point":case"Polygon":case"LineString":return[t]}}function Od(e){if(!(this instanceof Od))return new Od(e);this._bbox=e||[1/0,1/0,-1/0,-1/0],this._valid=!!e}function Rd(e){for(var t=Jf(),r=Xf(e),n=0;n<r.length;n++)t.include(r[n]);return t}function Fd(e,t){var i=-90,o=90,a=-90,s=90,l=270,u=-270,e=(e.forEach(function(e){var e=ed(e),t=e[1],r=e[3],n=e[0],e=e[2];i<t&&(i=t),r<o&&(o=r),a<r&&(a=r),t<s&&(s=t),n<l&&(l=n),u<e&&(u=e)}),t);return 85<i+e.lat&&(e.lat=85-i),90<a+e.lat&&(e.lat=90-a),o+e.lat<-85&&(e.lat=-85-o),s+e.lat<-90&&(e.lat=-90-s),l+e.lng<=-270&&(e.lng+=360*Math.ceil(Math.abs(e.lng)/360)),270<=u+e.lng&&(e.lng-=360*Math.ceil(Math.abs(e.lng)/360)),e}function Bd(e,t){var o=Fd(e.map(function(e){return e.toGeoJSON()}),t);e.forEach(function(e){function t(e){return e.map(function(e){return i(e)})}var r,n=e.getCoordinates(),i=function(e){return[e[0]+o.lng,e[1]+o.lat]};e.type===df?r=i(n):e.type===ff||"MultiPoint"===e.type?r=n.map(i):e.type===hf||"MultiLineString"===e.type?r=n.map(t):"MultiPolygon"===e.type&&(r=n.map(function(e){return e.map(t)})),e.incomingCoords(r)})}function Nd(e,t){return e.lngLat&&e.lngLat.lng===t[0]&&e.lngLat.lat===t[1]}function jd(e,t){return e.map(function(e){return e.source?e:Uf(e,{id:e.id+"."+t,source:"hot"===t?rf:nf})})}function Ud(e){ld(e,this)}Xi.exports=(Gh=function(e,o){function t(e,t){for(var r=a[e],n=r.length;n--;){var i=r[n];if(i.selector(t)){i.fn.call(s,t)||o.store.render(),o.ui.updateMapClasses();break}}}var a={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},s={on:function(e,t,r){if(void 0===a[e])throw new Error("Invalid event type: "+e);a[e].push({selector:t,fn:r})},render:function(e){o.store.featureChanged(e)}};return e.start.call(s),{render:e.render,stop:function(){e.stop&&e.stop()},trash:function(){e.trash&&(e.trash(),o.store.render())},combineFeatures:function(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures:function(){e.uncombineFeatures&&e.uncombineFeatures()},drag:function(e){t("drag",e)},click:function(e){t("click",e)},mousemove:function(e){t("mousemove",e)},mousedown:function(e){t("mousedown",e)},mouseup:function(e){t("mouseup",e)},mouseout:function(e){t("mouseout",e)},keydown:function(e){t("keydown",e)},keyup:function(e){t("keyup",e)},touchstart:function(e){t("touchstart",e)},touchmove:function(e){t("touchmove",e)},touchend:function(e){t("touchend",e)},tap:function(e){t("tap",e)}}},Wh=6378137,Zh={geometry:function e(t){var r,n=0;switch(t.type){case"Polygon":return ud(t.coordinates);case"MultiPolygon":for(r=0;r<t.coordinates.length;r++)n+=ud(t.coordinates[r]);return n;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(r=0;r<t.geometries.length;r++)n+=e(t.geometries[r]);return n}},ring:cd},qh="mapboxgl-ctrl",Hh="mapbox-gl-draw_ctrl-draw-btn",$h="mapbox-gl-draw_line",Xh="mapbox-gl-draw_polygon",Yh="mapbox-gl-draw_point",Jh="mapbox-gl-draw_trash",Kh="mapbox-gl-draw_combine",Qh="mapbox-gl-draw_uncombine",ef="mapboxgl-ctrl-group",tf="active",rf="mapbox-gl-draw-hot",nf="mapbox-gl-draw-cold",of="add",sf="drag",lf="pointer",uf={POLYGON:"polygon",LINE:"line_string",POINT:"point"},cf="Feature",hf="Polygon",ff="LineString",df="Point",pf="FeatureCollection",k={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},mf="draw.create",gf="draw.delete",yf="draw.update",vf="draw.selectionchange",_f="draw.modechange",xf="draw.actionable",bf="draw.render",af="move",wf="feature",Ef="midpoint",Tf="vertex",Sf="true",Mf="false",kf=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Cf={Point:0,LineString:1,Polygon:2},dd.prototype.add=function(e){return this.has(e)||(this._length++,"string"==typeof e?this._items[e]=this._length:this._nums[e]=this._length),this},dd.prototype.delete=function(e){return!1!==this.has(e)&&(this._length--,delete this._items[e],delete this._nums[e]),this},dd.prototype.has=function(e){return!("string"!=typeof e&&"number"!=typeof e||void 0===this._items[e]&&void 0===this._nums[e])},dd.prototype.values=function(){var t=this,r=[];return Object.keys(this._items).forEach(function(e){r.push({k:e,v:t._items[e]})}),Object.keys(this._nums).forEach(function(e){r.push({k:JSON.parse(e),v:t._nums[e]})}),r.sort(function(e,t){return e.v-t.v}).map(function(e){return e.k})},dd.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this},Af=[wf,Ef,Tf],If={click:function(e,t,r){return pd(e,t,r,r.options.clickBuffer)},touch:function(e,t,r){return pd(e,t,r,r.options.touchBuffer)}},Lf=_d(function(e){var s=e.exports=function(e,t){if(t=t||16,(e=void 0===e?128:e)<=0)return"0";for(var r=Math.log(Math.pow(2,e))/Math.log(t),n=2;r===1/0;n*=2)r=Math.log(Math.pow(2,e/n))/Math.log(t)*n;for(var i=r-Math.floor(r),o="",n=0;n<Math.floor(r);n++)o=Math.floor(Math.random()*t).toString(t)+o;i&&(i=Math.pow(t,i),o=Math.floor(Math.random()*i).toString(t)+o);i=parseInt(o,t);return i!==1/0&&i>=Math.pow(2,e)?s(e,t):o};s.rack=function(n,i,o){function r(e){var t=0;do{if(10<t++){if(!o)throw new Error("too many ID collisions, use more bits");n+=o}var r=s(n,i)}while(Object.hasOwnProperty.call(a,r));return a[r]=e,r}var a=r.hats={};return r.get=function(e){return r.hats[e]},r.set=function(e,t){return r.hats[e]=t,r},r.bits=n||128,r.base=i||16,r}}),(Pf=function(e,t){this.ctx=e,this.properties=t.properties||{},this.coordinates=t.geometry.coordinates,this.id=t.id||Lf(),this.type=t.geometry.type}).prototype.changed=function(){this.ctx.store.featureChanged(this.id)},Pf.prototype.incomingCoords=function(e){this.setCoordinates(e)},Pf.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},Pf.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},Pf.prototype.setProperty=function(e,t){this.properties[e]=t},Pf.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:cf,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},Pf.prototype.internal=function(e){var t={id:this.id,meta:wf,"meta:type":this.type,active:Mf,mode:e};if(this.ctx.options.userProperties)for(var r in this.properties)t["user_"+r]=this.properties[r];return{type:cf,properties:t,geometry:{coordinates:this.getCoordinates(),type:this.type}}},((zf=function(e,t){Pf.call(this,e,t)}).prototype=Object.create(Pf.prototype)).isValid=function(){return"number"==typeof this.coordinates[0]&&"number"==typeof this.coordinates[1]},zf.prototype.updateCoordinate=function(e,t,r){this.coordinates=3===arguments.length?[t,r]:[e,t],this.changed()},zf.prototype.getCoordinate=function(){return this.getCoordinates()},((Df=function(e,t){Pf.call(this,e,t)}).prototype=Object.create(Pf.prototype)).isValid=function(){return 1<this.coordinates.length},Df.prototype.addCoordinate=function(e,t,r){this.changed();e=parseInt(e,10);this.coordinates.splice(e,0,[t,r])},Df.prototype.getCoordinate=function(e){e=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[e]))},Df.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)},Df.prototype.updateCoordinate=function(e,t,r){e=parseInt(e,10);this.coordinates[e]=[t,r],this.changed()},((Of=function(e,t){Pf.call(this,e,t),this.coordinates=this.coordinates.map(function(e){return e.slice(0,-1)})}).prototype=Object.create(Pf.prototype)).isValid=function(){return 0!==this.coordinates.length&&this.coordinates.every(function(e){return 2<e.length})},Of.prototype.incomingCoords=function(e){this.coordinates=e.map(function(e){return e.slice(0,-1)}),this.changed()},Of.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},Of.prototype.addCoordinate=function(e,t,r){this.changed();e=e.split(".").map(function(e){return parseInt(e,10)});this.coordinates[e[0]].splice(e[1],0,[t,r])},Of.prototype.removeCoordinate=function(e){this.changed();var e=e.split(".").map(function(e){return parseInt(e,10)}),t=this.coordinates[e[0]];t&&(t.splice(e[1],1),t.length<3&&this.coordinates.splice(e[0],1))},Of.prototype.getCoordinate=function(e){var e=e.split(".").map(function(e){return parseInt(e,10)}),t=this.coordinates[e[0]];return JSON.parse(JSON.stringify(t[e[1]]))},Of.prototype.getCoordinates=function(){return this.coordinates.map(function(e){return e.concat([e[0]])})},Of.prototype.updateCoordinate=function(e,t,r){this.changed();var e=e.split("."),n=parseInt(e[0],10),e=parseInt(e[1],10);void 0===this.coordinates[n]&&(this.coordinates[n]=[]),this.coordinates[n][e]=[t,r]},Rf={MultiPoint:zf,MultiLineString:Df,MultiPolygon:Of},Ff=function(e,t,r,n,i){var r=r.split("."),o=parseInt(r[0],10),r=r[1]?r.slice(1).join("."):null;return e[o][t](r,n,i)},((Bf=function(e,t){if(Pf.call(this,e,t),delete this.coordinates,this.model=Rf[t.geometry.type],void 0===this.model)throw new TypeError(t.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(t.geometry.coordinates)}).prototype=Object.create(Pf.prototype))._coordinatesToFeatures=function(e){var t=this,r=this.model.bind(this);return e.map(function(e){return new r(t.ctx,{id:Lf(),type:cf,properties:{},geometry:{coordinates:e,type:t.type.replace("Multi","")}})})},Bf.prototype.isValid=function(){return this.features.every(function(e){return e.isValid()})},Bf.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()},Bf.prototype.getCoordinate=function(e){return Ff(this.features,"getCoordinate",e)},Bf.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(e){return e.type===hf?e.getCoordinates():e.coordinates})))},Bf.prototype.updateCoordinate=function(e,t,r){Ff(this.features,"updateCoordinate",e,t,r),this.changed()},Bf.prototype.addCoordinate=function(e,t,r){Ff(this.features,"addCoordinate",e,t,r),this.changed()},Bf.prototype.removeCoordinate=function(e){Ff(this.features,"removeCoordinate",e),this.changed()},Bf.prototype.getFeatures=function(){return this.features},C.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)},C.prototype.setSelectedCoordinates=function(e){var r=this;this._ctx.store.setSelectedCoordinates(e),e.reduce(function(e,t){return void 0===e[t.feature_id]&&(e[t.feature_id]=!0,r._ctx.store.get(t.feature_id).changed()),e},{})},C.prototype.getSelected=function(){return this._ctx.store.getSelected()},C.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},C.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)},C.prototype.getFeature=function(e){return this._ctx.store.get(e)},C.prototype.select=function(e){return this._ctx.store.select(e)},C.prototype.deselect=function(e){return this._ctx.store.deselect(e)},C.prototype.deleteFeature=function(e,t){return this._ctx.store.delete(e,t=void 0===t?{}:t)},C.prototype.addFeature=function(e){return this._ctx.store.add(e)},C.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},C.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},C.prototype.setActionableState=function(e){e={trash:(e=void 0===e?{}:e).trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(e)},C.prototype.changeMode=function(e,t,r){return this._ctx.events.changeMode(e,t=void 0===t?{}:t,r=void 0===r?{}:r)},C.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)},C.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)},C.prototype.featuresAt=function(e,t,r){if("click"!==(r=void 0===r?"click":r)&&"touch"!==r)throw new Error("invalid buffer type");return If[r](e,t,this._ctx)},C.prototype.newFeature=function(e){var t=e.geometry.type;return new(t===df?zf:t===ff?Df:t===hf?Of:Bf)(this._ctx,e)},C.prototype.isInstanceOf=function(e,t){if(e===df)return t instanceof zf;if(e===ff)return t instanceof Df;if(e===hf)return t instanceof Of;if("MultiFeature"===e)return t instanceof Bf;throw new Error("Unknown feature class: "+e)},C.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)},C.prototype.onSetup=function(){},C.prototype.onDrag=function(){},C.prototype.onClick=function(){},C.prototype.onMouseMove=function(){},C.prototype.onMouseDown=function(){},C.prototype.onMouseUp=function(){},C.prototype.onMouseOut=function(){},C.prototype.onKeyUp=function(){},C.prototype.onKeyDown=function(){},C.prototype.onTouchStart=function(){},C.prototype.onTouchMove=function(){},C.prototype.onTouchEnd=function(){},C.prototype.onTap=function(){},C.prototype.onStop=function(){},C.prototype.onTrash=function(){},C.prototype.onCombineFeature=function(){},C.prototype.onUncombineFeature=function(){},C.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")},Nf={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},jf=Object.keys(Nf),A.prototype.createRenderBatch=function(){var e=this,t=this.render,r=0;return this.render=function(){r++},function(){e.render=t,0<r&&e.render()}},A.prototype.setDirty=function(){return this.isDirty=!0,this},A.prototype.featureChanged=function(e){return this._changedFeatureIds.add(e),this},A.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},A.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},A.prototype.getAllIds=function(){return this._featureIds.values()},A.prototype.add=function(e){return this.featureChanged(e.id),this._features[e.id]=e,this._featureIds.add(e.id),this},A.prototype.delete=function(e,t){var r=this;return void 0===t&&(t={}),xd(e).forEach(function(e){r._featureIds.has(e)&&(r._featureIds.delete(e),r._selectedFeatureIds.delete(e),t.silent||-1===r._deletedFeaturesToEmit.indexOf(r._features[e])&&r._deletedFeaturesToEmit.push(r._features[e]),delete r._features[e],r.isDirty=!0)}),bd(this,t),this},A.prototype.get=function(e){return this._features[e]},A.prototype.getAll=function(){var t=this;return Object.keys(this._features).map(function(e){return t._features[e]})},A.prototype.select=function(e,t){var r=this;return void 0===t&&(t={}),xd(e).forEach(function(e){r._selectedFeatureIds.has(e)||(r._selectedFeatureIds.add(e),r._changedFeatureIds.add(e),t.silent||(r._emitSelectionChange=!0))}),this},A.prototype.deselect=function(e,t){var r=this;return void 0===t&&(t={}),xd(e).forEach(function(e){r._selectedFeatureIds.has(e)&&(r._selectedFeatureIds.delete(e),r._changedFeatureIds.add(e),t.silent||(r._emitSelectionChange=!0))}),bd(this,t),this},A.prototype.clearSelected=function(e){return void 0===e&&(e={}),this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this},A.prototype.setSelected=function(t,e){var r=this;return void 0===e&&(e={}),t=xd(t),this.deselect(this._selectedFeatureIds.values().filter(function(e){return-1===t.indexOf(e)}),{silent:e.silent}),this.select(t.filter(function(e){return!r._selectedFeatureIds.has(e)}),{silent:e.silent}),this},A.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this},A.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},A.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},A.prototype.getSelected=function(){var t=this;return this._selectedFeatureIds.values().map(function(e){return t.get(e)})},A.prototype.getSelectedCoordinates=function(){var t=this;return this._selectedCoordinates.map(function(e){return{coordinates:t.get(e.feature_id).getCoordinate(e.coord_path)}})},A.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)},A.prototype.setFeatureProperty=function(e,t,r){this.get(e).setProperty(t,r),this.featureChanged(e)},A.prototype.storeMapConfig=function(){var t=this;kf.forEach(function(e){t.ctx.map[e]&&(t._mapInitialConfig[e]=t.ctx.map[e].isEnabled())})},A.prototype.restoreMapConfig=function(){var t=this;Object.keys(this._mapInitialConfig).forEach(function(e){t._mapInitialConfig[e]?t.ctx.map[e].enable():t.ctx.map[e].disable()})},A.prototype.getInitialConfigValue=function(e){return void 0===this._mapInitialConfig[e]||this._mapInitialConfig[e]},Uf=function(){for(var e=arguments,t={},r=0;r<arguments.length;r++){var n,i=e[r];for(n in i)Vf.call(i,n)&&(t[n]=i[n])}return t},Vf=Object.prototype.hasOwnProperty,Gf=["mode","feature","mouse"],(Wf=Id).prototype={clone:function(){return new Id(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,e=e.y-this.y;return t*t+e*e},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,e=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=e,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),e=Math.sin(e),r=t*this.x-e*this.y,e=e*this.x+t*this.y;return this.x=r,this.y=e,this},_rotateAround:function(e,t){var r=Math.cos(e),e=Math.sin(e),n=t.x+r*(this.x-t.x)-e*(this.y-t.y),e=t.y+e*(this.x-t.x)+r*(this.y-t.y);return this.x=n,this.y=e,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Id.convert=function(e){return!(e instanceof Id)&&Array.isArray(e)?new Id(e[0],e[1]):e},Zf=function(e){setTimeout(function(){e.map&&e.map.doubleClickZoom&&e._ctx&&e._ctx.store&&e._ctx.store.getInitialConfigValue&&e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},qf=function(e){setTimeout(function(){e.map&&e.map.doubleClickZoom&&e.map.doubleClickZoom.disable()},0)},Hf=function(e){var t;return e&&e.type&&(t=$f[e.type])?"geometry"===t?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:e}]}:"feature"===t?{type:"FeatureCollection",features:[e]}:"featurecollection"===t?e:void 0:null},$f={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Xf=function(e){var t;return e?(e=Dd(Hf(e)),t=[],e.features.forEach(function(e){e.geometry&&(t=t.concat(function r(e){return Array.isArray(e)&&e.length&&"number"==typeof e[0]?[e]:e.reduce(function(e,t){return Array.isArray(t)&&Array.isArray(t[0])?e.concat(r(t)):(e.push(t),e)},[])}(e.geometry.coordinates)))}),t):[]},Yf=_d(function(e){var t=e.exports=function(e){return new i(e)};function i(e){this.value=e}function r(e,s,l){var u=[],c=[],h=!0;return function n(t){var e=l?f(t):t,i={},r=!0,o={node:e,node_:t,path:[].concat(u),parent:c[c.length-1],parents:c,key:u.slice(-1)[0],isRoot:0===u.length,level:u.length,circular:null,update:function(e,t){o.isRoot||(o.parent.node[o.key]=e),o.node=e,t&&(r=!1)},delete:function(e){delete o.parent.node[o.key],e&&(r=!1)},remove:function(e){p(o.parent.node)?o.parent.node.splice(o.key,1):delete o.parent.node[o.key],e&&(r=!1)},keys:null,before:function(e){i.before=e},after:function(e){i.after=e},pre:function(e){i.pre=e},post:function(e){i.post=e},stop:function(){h=!1},block:function(){r=!1}};return h&&(a(),void 0!==(e=s.call(o,o.node))&&o.update&&o.update(e),i.before&&i.before.call(o,o.node),r&&("object"!=typeof o.node||null===o.node||o.circular||(c.push(o),a(),m(o.keys,function(e,t){u.push(e),i.pre&&i.pre.call(o,o.node[e],e);var r=n(o.node[e]);l&&g.call(o.node,e)&&(o.node[e]=r.node),r.isLast=t==o.keys.length-1,r.isFirst=0==t,i.post&&i.post.call(o,r),u.pop()}),c.pop()),i.after&&i.after.call(o,o.node))),o;function a(){if("object"==typeof o.node&&null!==o.node){o.keys&&o.node_===o.node||(o.keys=d(o.node)),o.isLeaf=0==o.keys.length;for(var e=0;e<c.length;e++)if(c[e].node_===t){o.circular=c[e];break}}else o.isLeaf=!0,o.keys=null;o.notLeaf=!o.isLeaf,o.notRoot=!o.isRoot}}(e).node}function f(t){var e,r,n;return"object"==typeof t&&null!==t?(n=p(t)?[]:"[object Date]"===o(t)?new Date(t.getTime?t.getTime():t):"[object RegExp]"===o(t)?new RegExp(t):"[object Error]"===o(t)?{message:t.message}:"[object Boolean]"===o(t)?new Boolean(t):"[object Number]"===o(t)?new Number(t):"[object String]"===o(t)?new String(t):Object.create&&Object.getPrototypeOf?Object.create(Object.getPrototypeOf(t)):t.constructor===Object?{}:(e=t.constructor&&t.constructor.prototype||t.__proto__||{},(r=function(){}).prototype=e,new r),m(d(t),function(e){n[e]=t[e]}),n):t}i.prototype.get=function(e){for(var t=this.value,r=0;r<e.length;r++){var n=e[r];if(!t||!g.call(t,n)){t=void 0;break}t=t[n]}return t},i.prototype.has=function(e){for(var t=this.value,r=0;r<e.length;r++){var n=e[r];if(!t||!g.call(t,n))return!1;t=t[n]}return!0},i.prototype.set=function(e,t){for(var r=this.value,n=0;n<e.length-1;n++){var i=e[n];g.call(r,i)||(r[i]={}),r=r[i]}return r[e[n]]=t},i.prototype.map=function(e){return r(this.value,e,!0)},i.prototype.forEach=function(e){return this.value=r(this.value,e,!1),this.value},i.prototype.reduce=function(t,e){var r=1===arguments.length,n=r?this.value:e;return this.forEach(function(e){this.isRoot&&r||(n=t.call(this,n,e))}),n},i.prototype.paths=function(){var t=[];return this.forEach(function(e){t.push(this.path)}),t},i.prototype.nodes=function(){var t=[];return this.forEach(function(e){t.push(this.node)}),t},i.prototype.clone=function(){var i=[],o=[];return function t(r){for(var n,e=0;e<i.length;e++)if(i[e]===r)return o[e];return"object"==typeof r&&null!==r?(n=f(r),i.push(r),o.push(n),m(d(r),function(e){n[e]=t(r[e])}),i.pop(),o.pop(),n):r}(this.value)};var d=Object.keys||function(e){var t,r=[];for(t in e)r.push(t);return r};function o(e){return Object.prototype.toString.call(e)}var p=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},m=function(e,t){if(e.forEach)return e.forEach(t);for(var r=0;r<e.length;r++)t(e[r],r,e)},g=(m(d(i.prototype),function(n){t[n]=function(e){var t=[].slice.call(arguments,1),r=new i(e);return r[n].apply(r,t)}}),Object.hasOwnProperty||function(e,t){return t in e})}),(Jf=Od).prototype.include=function(e){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],e[0]),this._bbox[1]=Math.min(this._bbox[1],e[1]),this._bbox[2]=Math.max(this._bbox[2],e[0]),this._bbox[3]=Math.max(this._bbox[3],e[1]),this},Od.prototype.equals=function(e){e=e instanceof Od?e.bbox():e;return this._bbox[0]==e[0]&&this._bbox[1]==e[1]&&this._bbox[2]==e[2]&&this._bbox[3]==e[3]},Od.prototype.center=function(e){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},Od.prototype.union=function(e){return this._valid=!0,e=e instanceof Od?e.bbox():e,this._bbox[0]=Math.min(this._bbox[0],e[0]),this._bbox[1]=Math.min(this._bbox[1],e[1]),this._bbox[2]=Math.max(this._bbox[2],e[2]),this._bbox[3]=Math.max(this._bbox[3],e[3]),this},Od.prototype.bbox=function(){return this._valid?this._bbox:null},Od.prototype.contains=function(e){var t;return e?this._valid?(t=e[0],e=e[1],this._bbox[0]<=t&&this._bbox[1]<=e&&this._bbox[2]>=t&&this._bbox[3]>=e):null:this._fastContains()},Od.prototype.intersect=function(e){return this._valid?(e=e instanceof Od?e.bbox():e,!(this._bbox[0]>e[2]||this._bbox[2]<e[0]||this._bbox[3]<e[1]||this._bbox[1]>e[3])):null},Od.prototype._fastContains=function(){var e;return this._valid?(e="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]",new Function("ll",e)):new Function("return null;")},Od.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null},Kf={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Qf=Object.keys(Kf),(ed=function(e){return Rd(e).bbox()}).polygon=function(e){return Rd(e).polygon()},ed.bboxify=function(e){return Yf(e).map(function(t){t&&Qf.some(function(e){return!!t[e]&&-1!==Kf[e].indexOf(t.type)})&&(t.bbox=Rd(t).bbox(),this.update(t))})},(e={onSetup:function(e){var t=this,e={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(e.initiallySelectedFeatureIds.filter(function(e){return void 0!==t.getFeature(e)})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),e},fireUpdate:function(){this.map.fire(yf,{action:"move",features:this.getSelected().map(function(e){return e.toGeoJSON()})})},fireActionable:function(){var t,r=this,e=this.getSelected(),n=e.filter(function(e){return r.isInstanceOf("MultiFeature",e)}),i=!1,n=(1<e.length&&(i=!0,t=e[0].type.replace("Multi",""),e.forEach(function(e){e.type.replace("Multi","")!==t&&(i=!1)})),0<n.length),e=0<e.length;this.setActionableState({combineFeatures:i,uncombineFeatures:n,trash:e})},getUniqueIds:function(e){return e.length?e.map(function(e){return e.properties.id}).filter(function(e){return void 0!==e}).reduce(function(e,t){return e.add(t),e},new dd).values():[]},stopExtendedInteractions:function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1},onStop:function(){Zf(this)},onMouseMove:function(e){return this.stopExtendedInteractions(e),!0},onMouseOut:function(e){return!e.dragMoving||this.fireUpdate()}}).onTap=e.onClick=function(e,t){return Sd(t)?this.clickAnywhere(e,t):wd(Tf)(t)?this.clickOnVertex(e,t):t.featureTarget&&t.featureTarget.properties&&t.featureTarget.properties.meta===wf?this.clickOnFeature(e,t):void 0},e.clickAnywhere=function(e){var t=this,r=this.getSelectedIds();r.length&&(this.clearSelectedFeatures(),r.forEach(function(e){return t.doRender(e)})),Zf(this),this.stopExtendedInteractions(e)},e.clickOnVertex=function(e,t){this.changeMode(k.DIRECT_SELECT,{featureId:t.featureTarget.properties.parent,coordPath:t.featureTarget.properties.coord_path,startPos:t.lngLat}),this.updateUIClasses({mouse:af})},e.startOnActiveFeature=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(t.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},e.clickOnFeature=function(e,t){var r=this,e=(qf(this),this.stopExtendedInteractions(e),kd(t)),n=this.getSelectedIds(),t=t.featureTarget.properties.id,i=this.isSelected(t);if(!e&&i&&this.getFeature(t).type!==df)return this.changeMode(k.DIRECT_SELECT,{featureId:t});i&&e?(this.deselect(t),this.updateUIClasses({mouse:lf}),1===n.length&&Zf(this)):!i&&e?(this.select(t),this.updateUIClasses({mouse:af})):i||e||(n.forEach(function(e){return r.doRender(e)}),this.setSelected(t),this.updateUIClasses({mouse:af})),this.doRender(t)},e.onMouseDown=function(e,t){return Ed(t)?this.startOnActiveFeature(e,t):this.drawConfig.boxSelect&&t.originalEvent&&t.originalEvent.shiftKey&&0===t.originalEvent.button?this.startBoxSelect(e,t):void 0},e.startBoxSelect=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=Ld(t.originalEvent,this.map.getContainer()),e.canBoxSelect=!0},e.onTouchStart=function(e,t){if(Ed(t))return this.startOnActiveFeature(e,t)},e.onDrag=function(e,t){return e.canDragMove?this.dragMove(e,t):this.drawConfig.boxSelect&&e.canBoxSelect?this.whileBoxSelect(e,t):void 0},e.whileBoxSelect=function(e,t){e.boxSelecting=!0,this.updateUIClasses({mouse:of}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add("mapbox-gl-draw_boxselect"),this.map.getContainer().appendChild(e.boxSelectElement));var t=Ld(t.originalEvent,this.map.getContainer()),r=Math.min(e.boxSelectStartLocation.x,t.x),n=Math.max(e.boxSelectStartLocation.x,t.x),i=Math.min(e.boxSelectStartLocation.y,t.y),t=Math.max(e.boxSelectStartLocation.y,t.y),o="translate("+r+"px, "+i+"px)";e.boxSelectElement.style.transform=o,e.boxSelectElement.style.WebkitTransform=o,e.boxSelectElement.style.width=n-r+"px",e.boxSelectElement.style.height=t-i+"px"},e.dragMove=function(e,t){e.dragMoving=!0,t.originalEvent.stopPropagation();var r={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};Bd(this.getSelected(),r),e.dragMoveLocation=t.lngLat},e.onMouseUp=function(e,t){var r=this;e.dragMoving?this.fireUpdate():e.boxSelecting&&(t=[e.boxSelectStartLocation,Ld(t.originalEvent,this.map.getContainer())],t=this.featuresAt(null,t,"click"),(t=this.getUniqueIds(t).filter(function(e){return!r.isSelected(e)})).length&&(this.select(t),t.forEach(function(e){return r.doRender(e)}),this.updateUIClasses({mouse:af}))),this.stopExtendedInteractions(e)},e.toDisplayFeatures=function(e,t,r){t.properties.active=this.isSelected(t.properties.id)?Sf:Mf,r(t),this.fireActionable(),t.properties.active===Sf&&t.geometry.type!==df&&zd(t).forEach(r)},e.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},e.onCombineFeatures=function(){var e=this.getSelected();if(!(0===e.length||e.length<2)){for(var t,r=[],n=[],i=e[0].type.replace("Multi",""),o=0;o<e.length;o++){var a=e[o];if(a.type.replace("Multi","")!==i)return;a.type.includes("Multi")?a.getCoordinates().forEach(function(e){r.push(e)}):r.push(a.getCoordinates()),n.push(a.toGeoJSON())}1<n.length&&(t=this.newFeature({type:cf,properties:n[0].properties,geometry:{type:"Multi"+i,coordinates:r}}),this.addFeature(t),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([t.id]),this.map.fire("draw.combine",{createdFeatures:[t.toGeoJSON()],deletedFeatures:n})),this.fireActionable()}},e.onUncombineFeatures=function(){var r=this,n=this.getSelected();if(0!==n.length){for(var i=[],o=[],e=0;e<n.length;e++)!function(e){var t=n[e];r.isInstanceOf("MultiFeature",t)&&(t.getFeatures().forEach(function(e){r.addFeature(e),e.properties=t.properties,i.push(e.toGeoJSON()),r.select([e.id])}),r.deleteFeature(t.id,{silent:!0}),o.push(t.toGeoJSON()))}(e);1<i.length&&this.map.fire("draw.uncombine",{createdFeatures:i,deletedFeatures:o}),this.fireActionable()}},td=wd(Tf),rd=wd(Ef),(s={fireUpdate:function(){this.map.fire(yf,{action:"change_coordinates",features:this.getSelected().map(function(e){return e.toGeoJSON()})})},fireActionable:function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:0<e.selectedCoordPaths.length})},startDragging:function(e,t){this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},stopDragging:function(e){this.map.dragPan.enable(),e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null},onVertex:function(e,t){this.startDragging(e,t);var r=t.featureTarget.properties,n=e.selectedCoordPaths.indexOf(r.coord_path),t=(kd(t)||-1!==n?kd(t)&&-1===n&&e.selectedCoordPaths.push(r.coord_path):e.selectedCoordPaths=[r.coord_path],this.pathsToCoordinates(e.featureId,e.selectedCoordPaths));this.setSelectedCoordinates(t)},onMidpoint:function(e,t){this.startDragging(e,t);t=t.featureTarget.properties;e.feature.addCoordinate(t.coord_path,t.lng,t.lat),this.fireUpdate(),e.selectedCoordPaths=[t.coord_path]},pathsToCoordinates:function(t,e){return e.map(function(e){return{feature_id:t,coord_path:e}})},onFeature:function(e,t){0===e.selectedCoordPaths.length?this.startDragging(e,t):this.stopDragging(e)},dragFeature:function(e,t,r){Bd(this.getSelected(),r),e.dragMoveLocation=t.lngLat},dragVertex:function(t,e,r){for(var n=t.selectedCoordPaths.map(function(e){return t.feature.getCoordinate(e)}),i=Fd(n.map(function(e){return{type:cf,properties:{},geometry:{type:df,coordinates:e}}}),r),o=0;o<n.length;o++){var a=n[o];t.feature.updateCoordinate(t.selectedCoordPaths[o],a[0]+i.lng,a[1]+i.lat)}},clickNoTarget:function(){this.changeMode(k.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(k.SIMPLE_SELECT)},clickActiveFeature:function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()},onSetup:function(e){var t=e.featureId,r=this.getFeature(t);if(!r)throw new Error("You must provide a featureId to enter direct_select mode");if(r.type===df)throw new TypeError("direct_select mode doesn't handle point features");r={featureId:t,feature:r,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(t,r.selectedCoordPaths)),this.setSelected(t),qf(this),this.setActionableState({trash:!0}),r},onStop:function(){Zf(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(e,t,r){e.featureId===t.properties.id?(t.properties.active=Sf,r(t),zd(t,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(r)):(t.properties.active=Mf,r(t)),this.fireActionable(e)},onTrash:function(t){t.selectedCoordPaths.sort(function(e,t){return t.localeCompare(e,"en",{numeric:!0})}).forEach(function(e){return t.feature.removeCoordinate(e)}),this.fireUpdate(),t.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(t),!1===t.feature.isValid()&&(this.deleteFeature([t.featureId]),this.changeMode(k.SIMPLE_SELECT,{}))},onMouseMove:function(e,t){var r=Ed(t),t=td(t),n=0===e.selectedCoordPaths.length;return r&&n||t&&!n?this.updateUIClasses({mouse:af}):this.updateUIClasses({mouse:"none"}),this.stopDragging(e),!0},onMouseOut:function(e){return e.dragMoving&&this.fireUpdate(),!0}}).onTouchStart=s.onMouseDown=function(e,t){return td(t)?this.onVertex(e,t):Ed(t)?this.onFeature(e,t):rd(t)?this.onMidpoint(e,t):void 0},s.onDrag=function(e,t){var r;!0===e.canDragMove&&(e.dragMoving=!0,t.originalEvent.stopPropagation(),r={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat},0<e.selectedCoordPaths.length?this.dragVertex(e,t,r):this.dragFeature(e,t,r),e.dragMoveLocation=t.lngLat)},s.onClick=function(e,t){return Sd(t)?this.clickNoTarget(e,t):Ed(t)?this.clickActiveFeature(e,t):Td(t)?this.clickInactive(e,t):void this.stopDragging(e)},s.onTap=function(e,t){return Sd(t)?this.clickNoTarget(e,t):Ed(t)?this.clickActiveFeature(e,t):Td(t)?this.clickInactive(e,t):void 0},s.onTouchEnd=s.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)},(m={}).onSetup=function(){var e=this.newFeature({type:cf,properties:{},geometry:{type:df,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:of}),this.activateUIButton(uf.POINT),this.setActionableState({trash:!0}),{point:e}},m.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT)},m.onTap=m.onClick=function(e,t){this.updateUIClasses({mouse:af}),e.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat),this.map.fire(mf,{features:[e.point.toGeoJSON()]}),this.changeMode(k.SIMPLE_SELECT,{featureIds:[e.point.id]})},m.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})},m.toDisplayFeatures=function(e,t,r){e=t.properties.id===e.point.id;if(t.properties.active=e?Sf:Mf,!e)return r(t)},m.onTrash=m.stopDrawingAndRemove,m.onKeyUp=function(e,t){if(Cd(t)||Ad(t))return this.stopDrawingAndRemove(e,t)},(h={onSetup:function(){var e=this.newFeature({type:cf,properties:{},geometry:{type:hf,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),qf(this),this.updateUIClasses({mouse:of}),this.activateUIButton(uf.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}},clickAnywhere:function(e,t){if(0<e.currentVertexPosition&&Nd(t,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(k.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:of}),e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(k.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},onMouseMove:function(e,t){e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),Md(t)&&this.updateUIClasses({mouse:lf})}}).onTap=h.onClick=function(e,t){return Md(t)?this.clickOnVertex(e,t):this.clickAnywhere(e,t)},h.onKeyUp=function(e,t){Cd(t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT)):Ad(t)&&this.changeMode(k.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},h.onStop=function(e){this.updateUIClasses({mouse:"none"}),Zf(this),this.activateUIButton(),void 0!==this.getFeature(e.polygon.id)&&(e.polygon.removeCoordinate("0."+e.currentVertexPosition),e.polygon.isValid()?this.map.fire(mf,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT,{},{silent:!0})))},h.toDisplayFeatures=function(e,t,r){var n=t.properties.id===e.polygon.id;if(t.properties.active=n?Sf:Mf,!n)return r(t);if(0!==t.geometry.coordinates.length){var i,n=t.geometry.coordinates[0].length;if(!(n<3)){if(t.properties.meta=wf,r(Pd(e.polygon.id,t.geometry.coordinates[0][0],"0.0",!1)),3<n&&(i=t.geometry.coordinates[0].length-3,r(Pd(e.polygon.id,t.geometry.coordinates[0][i],"0."+i,!1))),n<=4){e=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(r({type:cf,properties:t.properties,geometry:{coordinates:e,type:ff}}),3===n)return}return r(t)}}},h.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT)},(a={onSetup:function(e){var t,r,n=(e=e||{}).featureId,i="forward";if(n){if(!(t=this.getFeature(n)))throw new Error("Could not find a feature with the provided featureId");n=e.from;if(!(n=(n=n&&"Feature"===n.type&&n.geometry&&"Point"===n.geometry.type?n.geometry:n)&&"Point"===n.type&&n.coordinates&&2===n.coordinates.length?n.coordinates:n)||!Array.isArray(n))throw new Error("Please use the `from` property to indicate which point to continue the line from");e=t.coordinates.length-1;if(t.coordinates[e][0]===n[0]&&t.coordinates[e][1]===n[1])t.addCoordinate.apply(t,[r=1+e].concat(t.coordinates[e]));else{if(t.coordinates[0][0]!==n[0]||t.coordinates[0][1]!==n[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");i="backwards",t.addCoordinate.apply(t,[r=0].concat(t.coordinates[0]))}}else t=this.newFeature({type:cf,properties:{},geometry:{type:ff,coordinates:[]}}),r=0,this.addFeature(t);return this.clearSelectedFeatures(),qf(this),this.updateUIClasses({mouse:of}),this.activateUIButton(uf.LINE),this.setActionableState({trash:!0}),{line:t,currentVertexPosition:r,direction:i}},clickAnywhere:function(e,t){if(0<e.currentVertexPosition&&Nd(t,e.line.coordinates[e.currentVertexPosition-1])||"backwards"===e.direction&&Nd(t,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(k.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:of}),e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),"forward"===e.direction?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(k.SIMPLE_SELECT,{featureIds:[e.line.id]})},onMouseMove:function(e,t){e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),Md(t)&&this.updateUIClasses({mouse:lf})}}).onTap=a.onClick=function(e,t){if(Md(t))return this.clickOnVertex(e,t);this.clickAnywhere(e,t)},a.onKeyUp=function(e,t){Ad(t)?this.changeMode(k.SIMPLE_SELECT,{featureIds:[e.line.id]}):Cd(t)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT))},a.onStop=function(e){Zf(this),this.activateUIButton(),void 0!==this.getFeature(e.line.id)&&(e.line.removeCoordinate(""+e.currentVertexPosition),e.line.isValid()?this.map.fire(mf,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT,{},{silent:!0})))},a.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(k.SIMPLE_SELECT)},a.toDisplayFeatures=function(e,t,r){var n=t.properties.id===e.line.id;if(t.properties.active=n?Sf:Mf,!n)return r(t);t.geometry.coordinates.length<2||(t.properties.meta=wf,r(Pd(e.line.id,t.geometry.coordinates["forward"===e.direction?t.geometry.coordinates.length-2:1],""+("forward"===e.direction?t.geometry.coordinates.length-2:1),!1)),r(t))},e={simple_select:e,direct_select:s,draw_point:m,draw_polygon:h,draw_line_string:a},nd={defaultMode:k.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}],modes:e,controls:{},userProperties:!1},od={point:!(id={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0}),line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1},ad=_d(function(e,t){var k="[object Arguments]",C="[object Map]",A="[object Object]",I="[object Set]",M=/^\[object .+?Constructor\]$/,F=/^(?:0|[1-9]\d*)$/,r={},n=(r["[object Float32Array]"]=r["[object Float64Array]"]=r["[object Int8Array]"]=r["[object Int16Array]"]=r["[object Int32Array]"]=r["[object Uint8Array]"]=r["[object Uint8ClampedArray]"]=r["[object Uint16Array]"]=r["[object Uint32Array]"]=!0,r[k]=r["[object Array]"]=r["[object ArrayBuffer]"]=r["[object Boolean]"]=r["[object DataView]"]=r["[object Date]"]=r["[object Error]"]=r["[object Function]"]=r[C]=r["[object Number]"]=r[A]=r["[object RegExp]"]=r[I]=r["[object String]"]=r["[object WeakMap]"]=!1,"object"==typeof Ht&&Ht&&Ht.Object===Object&&Ht),i="object"==typeof self&&self&&self.Object===Object&&self,i=n||i||Function("return this")(),t=t&&!t.nodeType&&t,o=t&&e&&!e.nodeType&&e,o=o&&o.exports===t,a=o&&n.process,t=function(){try{return a&&a.binding&&a.binding("util")}catch(e){}}(),n=t&&t.isTypedArray;function B(e){var r=-1,n=Array(e.size);return e.forEach(function(e,t){n[++r]=[t,e]}),n}function N(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}var s,l,t=Array.prototype,u=Function.prototype,c=Object.prototype,h=i["__core-js_shared__"],j=u.toString,L=c.hasOwnProperty,U=(u=/[^.]+$/.exec(h&&h.keys&&h.keys.IE_PROTO||""))?"Symbol(src)_1."+u:"",V=c.toString,G=RegExp("^"+j.call(L).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),h=o?i.Buffer:void 0,u=i.Symbol,W=i.Uint8Array,Z=c.propertyIsEnumerable,q=t.splice,f=u?u.toStringTag:void 0,H=Object.getOwnPropertySymbols,o=h?h.isBuffer:void 0,t=(s=Object.keys,l=Object,E(i,"DataView")),d=E(i,"Map"),h=E(i,"Promise"),p=E(i,"Set"),i=E(i,"WeakMap"),m=E(Object,"create"),$=T(t),X=T(d),Y=T(h),J=T(p),K=T(i),u=u?u.prototype:void 0,P=u?u.valueOf:void 0;function g(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function y(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function v(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function _(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new v;++t<r;)this.add(e[t])}function z(e){e=this.__data__=new y(e);this.size=e.size}function Q(e,t){var r,n,i,o=O(e),a=!o&&se(e),s=!o&&!a&&R(e),l=!o&&!a&&!s&&fe(e),u=o||a||s||l,c=u?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],h=c.length;for(r in e)!t&&!L.call(e,r)||u&&("length"==r||s&&("offset"==r||"parent"==r)||l&&("buffer"==r||"byteLength"==r||"byteOffset"==r)||(n=r,i=h,(i=null==i?9007199254740991:i)&&("number"==typeof n||F.test(n))&&-1<n&&n%1==0&&n<i))||c.push(r);return c}function x(e,t){for(var r=e.length;r--;)if(ae(e[r][0],t))return r;return-1}function b(e){{if(null==e)return void 0===e?"[object Undefined]":"[object Null]";if(f&&f in Object(e)){var t=e,r=L.call(t,f),n=t[f];try{var i=!(t[f]=void 0)}catch(t){}var o=V.call(t);return i&&(r?t[f]=n:delete t[f]),o}return V.call(e)}}function ee(e){return S(e)&&b(e)==k}function te(e,t,r,n,i){return e===t||(null==e||null==t||!S(e)&&!S(t)?e!=e&&t!=t:function(e,t,r,n,i,o){var a=O(e),s=O(t),l=a?"[object Array]":D(e),s=s?"[object Array]":D(t),u=(l=l==k?A:l)==A,c=(s=s==k?A:s)==A,s=l==s;if(s&&R(e)){if(!R(t))return!1;u=!(a=!0)}if(s&&!u)return o=o||new z,(a||fe(e)?ne:function(e,t,r,n,i,o){switch(l){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!i(new W(e),new W(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ae(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case C:var a=B;case I:a=a||N;if(e.size!=t.size&&!(1&r))return!1;var s=o.get(e);if(s)return s==t;r|=2,o.set(e,t);s=ne(a(e),a(t),r,n,i,o);return o.delete(e),s;case"[object Symbol]":if(P)return P.call(e)==P.call(t)}return!1})(e,t,r,n,i,o);if(!(1&r)){a=u&&L.call(e,"__wrapped__"),u=c&&L.call(t,"__wrapped__");if(a||u)return i(a?e.value():e,u?t.value():t,r,n,o=o||new z)}if(s){o=o||new z;var h=e,f=t,d=r,p=n,m=i,g=o,y=1&d,v=ie(h),_=v.length;if(_!=ie(f).length&&!y)return!1;for(var x=_;x--;){var b=v[x];if(!(y?b in f:L.call(f,b)))return!1}c=g.get(h);if(c&&g.get(f))return c==f;for(var w=!0,E=(g.set(h,f),g.set(f,h),y);++x<_;){var T,S=h[b=v[x]],M=f[b];if(!(void 0===(T=p?y?p(M,S,b,f,h,g):p(S,M,b,h,f,g):T)?S===M||m(S,M,d,p,g):T)){w=!1;break}E=E||"constructor"==b}return w&&!E&&(c=h.constructor)!=(a=f.constructor)&&"constructor"in h&&"constructor"in f&&!("function"==typeof c&&c instanceof c&&"function"==typeof a&&a instanceof a)&&(w=!1),g.delete(h),g.delete(f),w}return!1}(e,t,r,n,te,i))}function re(e){if(t=e&&e.constructor,e!==("function"==typeof t&&t.prototype||c))return s(l(e));var t,r,n=[];for(r in Object(e))L.call(e,r)&&"constructor"!=r&&n.push(r);return n}function ne(e,t,r,n,i,o){var a=1&r,s=e.length,l=t.length;if(s!=l&&!(a&&s<l))return!1;l=o.get(e);if(l&&o.get(t))return l==t;var u=-1,c=!0,h=2&r?new _:void 0;for(o.set(e,t),o.set(t,e);++u<s;){var f,d=e[u],p=t[u];if(void 0!==(f=n?a?n(p,d,u,t,e,o):n(d,p,u,e,t,o):f)){if(f)continue;c=!1;break}if(h){if(!function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return 1}(t,function(e,t){return!h.has(t)&&(d===e||i(d,e,r,n,o))&&h.push(t)})){c=!1;break}}else if(d!==p&&!i(d,p,r,n,o)){c=!1;break}}return o.delete(e),o.delete(t),c}function ie(e){var t=oe,r=de(e);if(O(e))return r;for(var n=r,i=t(e),o=-1,a=i.length,s=n.length;++o<a;)n[s+o]=i[o];return n}function w(e,t){var r,e=e.__data__;return("string"==(r=typeof t)||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==t:null===t)?e["string"==typeof t?"string":"hash"]:e.map}function E(e,t){e=null==e?void 0:e[t];return!ce(t=e)||U&&U in t||!(le(t)?G:M).test(T(t))?void 0:e}g.prototype.clear=function(){this.__data__=m?m(null):{},this.size=0},g.prototype.delete=function(e){e=this.has(e)&&delete this.__data__[e];return this.size-=e?1:0,e},g.prototype.get=function(e){var t,r=this.__data__;return m?"__lodash_hash_undefined__"===(t=r[e])?void 0:t:L.call(r,e)?r[e]:void 0},g.prototype.has=function(e){var t=this.__data__;return m?void 0!==t[e]:L.call(t,e)},g.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=m&&void 0===t?"__lodash_hash_undefined__":t,this},y.prototype.clear=function(){this.__data__=[],this.size=0},y.prototype.delete=function(e){var t=this.__data__,e=x(t,e);return!(e<0||(e==t.length-1?t.pop():q.call(t,e,1),--this.size,0))},y.prototype.get=function(e){var t=this.__data__,e=x(t,e);return e<0?void 0:t[e][1]},y.prototype.has=function(e){return-1<x(this.__data__,e)},y.prototype.set=function(e,t){var r=this.__data__,n=x(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this},v.prototype.clear=function(){this.size=0,this.__data__={hash:new g,map:new(d||y),string:new g}},v.prototype.delete=function(e){e=w(this,e).delete(e);return this.size-=e?1:0,e},v.prototype.get=function(e){return w(this,e).get(e)},v.prototype.has=function(e){return w(this,e).has(e)},v.prototype.set=function(e,t){var r=w(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this},_.prototype.add=_.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},_.prototype.has=function(e){return this.__data__.has(e)},z.prototype.clear=function(){this.__data__=new y,this.size=0},z.prototype.delete=function(e){var t=this.__data__,e=t.delete(e);return this.size=t.size,e},z.prototype.get=function(e){return this.__data__.get(e)},z.prototype.has=function(e){return this.__data__.has(e)},z.prototype.set=function(e,t){var r=this.__data__;if(r instanceof y){var n=r.__data__;if(!d||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new v(n)}return r.set(e,t),this.size=r.size,this};var oe=H?function(e){if(null==e)return[];e=Object(e);for(var t=H(e),r=-1,n=null==t?0:t.length,i=0,o=[];++r<n;){var a=t[r];Z.call(e,a)&&(o[i++]=a)}return o}:function(){return[]},D=b;function T(e){if(null!=e){try{return j.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function ae(e,t){return e===t||e!=e&&t!=t}(t&&"[object DataView]"!=D(new t(new ArrayBuffer(1)))||d&&D(new d)!=C||h&&"[object Promise]"!=D(h.resolve())||p&&D(new p)!=I||i&&"[object WeakMap]"!=D(new i))&&(D=function(e){var t=b(e),e=t==A?e.constructor:void 0,e=e?T(e):"";if(e)switch(e){case $:return"[object DataView]";case X:return C;case Y:return"[object Promise]";case J:return I;case K:return"[object WeakMap]"}return t});var se=ee(function(){return arguments}())?ee:function(e){return S(e)&&L.call(e,"callee")&&!Z.call(e,"callee")},O=Array.isArray,R=o||function(){return!1};function le(e){if(ce(e))return"[object Function]"==(e=b(e))||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}function ue(e){return"number"==typeof e&&-1<e&&e%1==0&&e<=9007199254740991}function ce(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function S(e){return null!=e&&"object"==typeof e}var he,fe=n?(he=n,function(e){return he(e)}):function(e){return S(e)&&ue(e.length)&&!!r[b(e)]};function de(e){return(null!=e&&ue(e.length)&&!le(e)?Q:re)(e)}e.exports=function(e,t){return te(e,t)}}),sd={Polygon:Of,LineString:Df,Point:zf,MultiPolygon:Bf,MultiLineString:Bf,MultiPoint:Bf},ld=function(e,t){var i,o,f,d,p,m,r={options:(n=Uf(r=void 0===(r=e)?{}:r),r.controls||(n.controls={}),!1===r.displayControlsDefault?n.controls=Uf(od,r.controls):n.controls=Uf(id,r.controls),(n=Uf(nd,n)).styles=jd(n.styles,"cold").concat(jd(n.styles,"hot")),e=n)},n=(i=r,(o=t).modes=k,o.getFeatureIdsAt=function(e){return If.click({point:e},null,i).map(function(e){return e.properties.id})},o.getSelectedIds=function(){return i.store.getSelectedIds()},o.getSelected=function(){return{type:pf,features:i.store.getSelectedIds().map(function(e){return i.store.get(e)}).map(function(e){return e.toGeoJSON()})}},o.getSelectedPoints=function(){return{type:pf,features:i.store.getSelectedCoordinates().map(function(e){return{type:cf,properties:{},geometry:{type:df,coordinates:e.coordinates}}})}},o.set=function(e){var t,r,n;if(void 0!==e.type&&e.type===pf&&Array.isArray(e.features))return t=i.store.createRenderBatch(),r=i.store.getAllIds().slice(),e=o.add(e),n=new dd(e),(r=r.filter(function(e){return!n.has(e)})).length&&o.delete(r),t(),e;throw new Error("Invalid FeatureCollection")},o.add=function(e){e=JSON.parse(JSON.stringify(Hf(e))).features.map(function(e){if(e.id=e.id||Lf(),null===e.geometry)throw new Error("Invalid geometry: null");if(void 0===i.store.get(e.id)||i.store.get(e.id).type!==e.geometry.type){var t=sd[e.geometry.type];if(void 0===t)throw new Error("Invalid geometry type: "+e.geometry.type+".");t=new t(i,e);i.store.add(t)}else{t=i.store.get(e.id);t.properties=e.properties,ad(t.getCoordinates(),e.geometry.coordinates)||t.incomingCoords(e.geometry.coordinates)}return e.id});return i.store.render(),e},o.get=function(e){e=i.store.get(e);if(e)return e.toGeoJSON()},o.getAll=function(){return{type:pf,features:i.store.getAll().map(function(e){return e.toGeoJSON()})}},o.delete=function(e){return i.store.delete(e,{silent:!0}),o.getMode()!==k.DIRECT_SELECT||i.store.getSelectedIds().length?i.store.render():i.events.changeMode(k.SIMPLE_SELECT,void 0,{silent:!0}),o},o.deleteAll=function(){return i.store.delete(i.store.getAllIds(),{silent:!0}),o.getMode()===k.DIRECT_SELECT?i.events.changeMode(k.SIMPLE_SELECT,void 0,{silent:!0}):i.store.render(),o},o.changeMode=function(e,t){return void 0===t&&(t={}),e===k.SIMPLE_SELECT&&o.getMode()===k.SIMPLE_SELECT?(r=t.featureIds||[],n=i.store.getSelectedIds(),r.length===n.length&&JSON.stringify(r.map(function(e){return e}).sort())===JSON.stringify(n.map(function(e){return e}).sort())||(i.store.setSelected(t.featureIds,{silent:!0}),i.store.render())):e===k.DIRECT_SELECT&&o.getMode()===k.DIRECT_SELECT&&t.featureId===i.store.getSelectedIds()[0]||i.events.changeMode(e,t,{silent:!0}),o;var r,n},o.getMode=function(){return i.events.getMode()},o.trash=function(){return i.events.trash({silent:!0}),o},o.combineFeatures=function(){return i.events.combineFeatures({silent:!0}),o},o.uncombineFeatures=function(){return i.events.uncombineFeatures({silent:!0}),o},o.setFeatureProperty=function(e,t,r){return i.store.setFeatureProperty(e,t,r),o},t=o,r.api=t,p=d=null,m={onRemove:function(){return f.map.off("load",m.connect),clearInterval(p),m.removeLayers(),f.store.restoreMapConfig(),f.ui.removeButtons(),f.events.removeEventListeners(),f.ui.clearMapClasses(),f.map=null,f.container=null,f.store=null,d&&d.parentNode&&d.parentNode.removeChild(d),d=null,this},connect:function(){f.map.off("load",m.connect),clearInterval(p),m.addLayers(),f.store.storeMapConfig(),f.events.addEventListeners()},onAdd:function(n){var i,r,o,a,s,l=n.fire;return n.fire=function(e,t){var r=arguments;return 1===l.length&&1!==arguments.length&&(r=[Uf({},{type:e},t)]),l.apply(n,r)},f.map=n,f.events=function(i){function t(e){return!(8===e||46===e||48<=e&&e<=57)}var o=Object.keys(i.options.modes).reduce(function(e,t){return e[t]=(s=i.options.modes[t],r=Object.keys(s),function(e,t){void 0===t&&(t={});var o={},a=r.reduce(function(e,t){return e[t]=s[t],e},new C(e));return{start:function(){var i=this;o=a.onSetup(t),jf.forEach(function(e){var t,r=Nf[e],n=function(){return!1};s[r]&&(n=function(){return!0}),i.on(e,n,(t=r,function(e){return a[t](o,e)}))})},stop:function(){a.onStop(o)},trash:function(){a.onTrash(o)},combineFeatures:function(){a.onCombineFeatures(o)},uncombineFeatures:function(){a.onUncombineFeatures(o)},render:function(e,t){a.toDisplayFeatures(o,e,t)}}}),e;var s,r},{}),r={},n={},a={},s=null,l=null;a.drag=function(e,t){t({point:e.point,time:(new Date).getTime()})?(i.ui.queueMapClasses({mouse:sf}),l.drag(e)):e.originalEvent.stopPropagation()},a.mousedrag=function(e){a.drag(e,function(e){return!yd(r,e)})},a.touchdrag=function(e){a.drag(e,function(e){return!vd(n,e)})},a.mousemove=function(e){if(1===(void 0!==e.originalEvent.buttons?e.originalEvent.buttons:e.originalEvent.which))return a.mousedrag(e);var t=md(e,i);e.featureTarget=t,l.mousemove(e)},a.mousedown=function(e){r={time:(new Date).getTime(),point:e.point};var t=md(e,i);e.featureTarget=t,l.mousedown(e)},a.mouseup=function(e){var t=md(e,i);e.featureTarget=t,yd(r,{point:e.point,time:(new Date).getTime()})?l.click(e):l.mouseup(e)},a.mouseout=function(e){l.mouseout(e)},a.touchstart=function(e){var t;e.originalEvent.preventDefault(),i.options.touchEnabled&&(n={time:(new Date).getTime(),point:e.point},t=If.touch(e,null,i)[0],e.featureTarget=t,l.touchstart(e))},a.touchmove=function(e){if(e.originalEvent.preventDefault(),i.options.touchEnabled)return l.touchmove(e),a.touchdrag(e)},a.touchend=function(e){var t;e.originalEvent.preventDefault(),i.options.touchEnabled&&(t=If.touch(e,null,i)[0],e.featureTarget=t,vd(n,{time:(new Date).getTime(),point:e.point})?l.tap(e):l.touchend(e))};function u(e,t,r){void 0===r&&(r={}),l.stop();var n=o[e];if(void 0===n)throw new Error(e+" is not valid");s=e;n=n(i,t);l=Gh(n,i),r.silent||i.map.fire(_f,{mode:e}),i.store.setDirty(),i.store.render()}a.keydown=function(e){"mapboxgl-canvas"===(e.srcElement||e.target).classList[0]&&(8!==e.keyCode&&46!==e.keyCode||!i.options.controls.trash?t(e.keyCode)?l.keydown(e):49===e.keyCode&&i.options.controls.point?u(k.DRAW_POINT):50===e.keyCode&&i.options.controls.line_string?u(k.DRAW_LINE_STRING):51===e.keyCode&&i.options.controls.polygon&&u(k.DRAW_POLYGON):(e.preventDefault(),l.trash()))},a.keyup=function(e){t(e.keyCode)&&l.keyup(e)},a.zoomend=function(){i.store.changeZoom()};var c={trash:!(a.data=function(e){var t,r,n;"style"===e.dataType&&(e=i.setup,t=i.map,r=i.options,n=i.store,r.styles.some(function(e){return t.getLayer(e.id)})||(e.addLayers(),n.setDirty(),n.render()))}),combineFeatures:!1,uncombineFeatures:!1};return{start:function(){s=i.options.defaultMode,l=Gh(o[s](i),i)},changeMode:u,actionable:function(t){var r=!1;Object.keys(t).forEach(function(e){if(void 0===c[e])throw new Error("Invalid action type");c[e]!==t[e]&&(r=!0),c[e]=t[e]}),r&&i.map.fire(xf,{actions:c})},currentModeName:function(){return s},currentModeRender:function(e,t){return l.render(e,t)},fire:function(e,t){a[e]&&a[e](t)},addEventListeners:function(){i.map.on("mousemove",a.mousemove),i.map.on("mousedown",a.mousedown),i.map.on("mouseup",a.mouseup),i.map.on("data",a.data),i.map.on("touchmove",a.touchmove),i.map.on("touchstart",a.touchstart),i.map.on("touchend",a.touchend),i.container.addEventListener("mouseout",a.mouseout),i.options.keybindings&&(i.container.addEventListener("keydown",a.keydown),i.container.addEventListener("keyup",a.keyup))},removeEventListeners:function(){i.map.off("mousemove",a.mousemove),i.map.off("mousedown",a.mousedown),i.map.off("mouseup",a.mouseup),i.map.off("data",a.data),i.map.off("touchmove",a.touchmove),i.map.off("touchstart",a.touchstart),i.map.off("touchend",a.touchend),i.container.removeEventListener("mouseout",a.mouseout),i.options.keybindings&&(i.container.removeEventListener("keydown",a.keydown),i.container.removeEventListener("keyup",a.keyup))},trash:function(e){l.trash(e)},combineFeatures:function(){l.combineFeatures()},uncombineFeatures:function(){l.uncombineFeatures()},getMode:function(){return s}}}(f),f.ui=(i=f,r={},a={mode:o=null,feature:null,mouse:null},s={mode:null,feature:null,mouse:null},{setActiveButton:h,queueMapClasses:e,updateMapClasses:t,clearMapClasses:function(){e({mode:null,feature:null,mouse:null}),t()},addButtons:function(){var e=i.options.controls,t=document.createElement("div");return t.className=ef+" "+qh,e&&(e[uf.LINE]&&(r[uf.LINE]=u(uf.LINE,{container:t,className:$h,title:"LineString tool "+(i.options.keybindings?"(l)":""),onActivate:function(){return i.events.changeMode(k.DRAW_LINE_STRING)},onDeactivate:function(){return i.events.trash()}})),e[uf.POLYGON]&&(r[uf.POLYGON]=u(uf.POLYGON,{container:t,className:Xh,title:"Polygon tool "+(i.options.keybindings?"(p)":""),onActivate:function(){return i.events.changeMode(k.DRAW_POLYGON)},onDeactivate:function(){return i.events.trash()}})),e[uf.POINT]&&(r[uf.POINT]=u(uf.POINT,{container:t,className:Yh,title:"Marker tool "+(i.options.keybindings?"(m)":""),onActivate:function(){return i.events.changeMode(k.DRAW_POINT)},onDeactivate:function(){return i.events.trash()}})),e.trash&&(r.trash=u("trash",{container:t,className:Jh,title:"Delete",onActivate:function(){i.events.trash()}})),e.combine_features&&(r.combine_features=u("combineFeatures",{container:t,className:Kh,title:"Combine",onActivate:function(){i.events.combineFeatures()}})),e.uncombine_features&&(r.uncombine_features=u("uncombineFeatures",{container:t,className:Qh,title:"Uncombine",onActivate:function(){i.events.uncombineFeatures()}}))),t},removeButtons:function(){Object.keys(r).forEach(function(e){var t=r[e];t.parentNode&&t.parentNode.removeChild(t),delete r[e]})}}),f.container=n.getContainer(),f.store=new A(f),d=f.ui.addButtons(),f.options.boxSelect&&(n.boxZoom.disable(),n.dragPan.disable(),n.dragPan.enable()),n.loaded()?m.connect():(n.on("load",m.connect),p=setInterval(function(){n.loaded()&&m.connect()},16)),f.events.start(),d;function e(e){s=Uf(s,e)}function t(){var e,t,r;i.container&&(t=[],r=[],Gf.forEach(function(e){s[e]!==a[e]&&(t.push(e+"-"+a[e]),null!==s[e]&&r.push(e+"-"+s[e]))}),0<t.length&&(e=i.container.classList).remove.apply(e,t),0<r.length&&(e=i.container.classList).add.apply(e,r),a=Uf(a,s))}function u(t,r){void 0===r&&(r={});var e=document.createElement("button");return e.className=Hh+" "+r.className,e.setAttribute("title",r.title),r.container.appendChild(e),e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),e.target===o?(c(),r.onDeactivate()):(h(t),r.onActivate())},!0),e}function c(){o&&(o.classList.remove(tf),o=null)}function h(e){c();var t=r[e];t&&"trash"!==e&&(t.classList.add(tf),o=t)}},addLayers:function(){f.map.addSource(nf,{data:{type:pf,features:[]},type:"geojson"}),f.map.addSource(rf,{data:{type:pf,features:[]},type:"geojson"}),f.options.styles.forEach(function(e){f.map.addLayer(e)}),f.store.setDirty(!0),f.store.render()},removeLayers:function(){f.options.styles.forEach(function(e){f.map.getLayer(e.id)&&f.map.removeLayer(e.id)}),f.map.getSource(nf)&&f.map.removeSource(nf),f.map.getSource(rf)&&f.map.removeSource(rf)}},(f=r).setup=m);return t.onAdd=n.onAdd,t.onRemove=n.onRemove,t.types=uf,t.options=e,t},Ud.modes=e,Ud);function Vd(){for(var e={},t=0;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Gd.call(n,r)&&(e[r]=n[r])}return e}var Gd=Object.prototype.hasOwnProperty;function Wd(e){return this.component=e,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,e.el.parentNode.insertBefore(this.wrapper,e.el.nextSibling),this}var Zd,d={exports:{}};Zd={},(d.exports=Zd).simpleFilter=function(t,e){return e.filter(function(e){return Zd.test(t,e)})},Zd.test=function(e,t){return null!==Zd.match(e,t)},Zd.match=function(e,t,r){var n,i=0,o=[],a=t.length,s=0,l=0,u=(r=r||{}).pre||"",c=r.post||"",h=r.caseSensitive&&t||t.toLowerCase();e=r.caseSensitive&&e||e.toLowerCase();for(var f=0;f<a;f++)n=t[f],h[f]===e[i]?(n=u+n+c,i+=1,l+=1+l):l=0,s+=l,o[o.length]=n;return i===e.length?(s=h===e?1/0:s,{rendered:o.join(""),score:s}):null},Zd.filter=function(o,e,a){return e&&0!==e.length?"string"!=typeof o?e:(a=a||{},e.reduce(function(e,t,r,n){var i=t,i=(a.extract&&(i=a.extract(t)),Zd.match(o,i,a));return null!=i&&(e[e.length]={string:i.rendered,score:i.score,index:r,original:t}),e},[]).sort(function(e,t){var r=t.score-e.score;return r||e.index-t.index})):[]};Wd.prototype.show=function(){this.element.style.display="block"},Wd.prototype.hide=function(){this.element.style.display="none"},Wd.prototype.add=function(e){this.items.push(e)},Wd.prototype.clear=function(){this.items=[],this.active=0},Wd.prototype.isEmpty=function(){return!this.items.length},Wd.prototype.isVisible=function(){return"block"===this.element.style.display},Wd.prototype.draw=function(){if(this.element.innerHTML="",0===this.items.length)this.hide();else{for(var e=0;e<this.items.length;e++)this.drawItem(this.items[e],this.active===e);this.show()}},Wd.prototype.drawItem=function(e,t){var r=document.createElement("li"),n=document.createElement("a");t&&(r.className+=" active"),n.innerHTML=e.string,r.appendChild(n),this.element.appendChild(r),r.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),r.addEventListener("mouseup",function(){this.handleMouseUp.call(this,e)}.bind(this))},Wd.prototype.handleMouseUp=function(e){this.selectingListItem=!1,this.component.value(e.original),this.clear(),this.draw()},Wd.prototype.move=function(e){this.active=e,this.draw()},Wd.prototype.previous=function(){this.move(0===this.active?this.items.length-1:this.active-1)},Wd.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},Wd.prototype.drawError=function(e){var t=document.createElement("li");t.innerHTML=e,this.element.appendChild(t),this.show()};function qd(e,t,r){return this.options=Hd({minLength:2,limit:5,filter:!0,hideOnBlur:!0},r=r||{}),this.el=e,this.data=t||[],this.list=new Yd(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(e){this.handleKeyUp(e.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(e){this.handleKeyDown(e)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(e){this.handlePaste(e)}.bind(this)),this.render=(this.options.render?this.options:this).render.bind(this),this.getItemValue=(this.options.getItemValue?this.options:this).getItemValue.bind(this),this}var Hd=Vd,Xd=d.exports,Yd=Wd;qd.prototype.handleKeyUp=function(e){40!==e&&38!==e&&27!==e&&13!==e&&9!==e&&this.handleInputChange(this.el.value)},qd.prototype.handleKeyDown=function(e){switch(e.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&e.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next()}},qd.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},qd.prototype.handlePaste=function(e){var t;e.clipboardData?this.handleInputChange(e.clipboardData.getData("Text")):(t=this,setTimeout(function(){t.handleInputChange(e.target.value)},100))},qd.prototype.handleInputChange=function(e){this.query=this.normalize(e),this.list.clear(),this.query.length<this.options.minLength?this.list.draw():this.getCandidates(function(e){for(var t=0;t<e.length&&(this.list.add(e[t]),t!==this.options.limit-1);t++);this.list.draw()}.bind(this))},qd.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},qd.prototype.update=function(e){this.data=e,this.handleKeyUp()},qd.prototype.clear=function(){this.data=[],this.list.clear()},qd.prototype.normalize=function(e){return e=e.toLowerCase()},qd.prototype.match=function(e,t){return-1<e.indexOf(t)},qd.prototype.value=function(e){this.selected=e,this.el.value=this.getItemValue(e),document.createEvent?((e=document.createEvent("HTMLEvents")).initEvent("change",!0,!1),this.el.dispatchEvent(e)):this.el.fireEvent("onchange")},qd.prototype.getCandidates=function(e){var t={pre:"<strong>",post:"</strong>",extract:function(e){return this.getItemValue(e)}.bind(this)},r=this.options.filter?(r=Xd.filter(this.query,this.data,t)).map(function(e){return{original:e.original,string:this.render(e.original,e.string)}}.bind(this)):this.data.map(function(e){return{original:e,string:this.render(e)}}.bind(this));e(r)},qd.prototype.getItemValue=function(e){return e},qd.prototype.render=function(e,t){if(t)return t;for(var r=e.original?this.getItemValue(e.original):this.getItemValue(e),n=this.normalize(r),i=n.lastIndexOf(this.query);-1<i;)var o=i+this.query.length,r=r.slice(0,i)+"<strong>"+r.slice(i,o)+"</strong>"+r.slice(o),i=n.slice(0,i).lastIndexOf(this.query);return r},qd.prototype.renderError=function(e){this.list.drawError(e)};function Jd(){return op.Date.now()}var g=qd,Kd=("undefined"!=typeof window&&(window.Suggestions=qd),NaN),Qd="[object Symbol]",ep=/^\s+|\s+$/g,tp=/^[-+]0x[0-9a-f]+$/i,rp=/^0b[01]+$/i,np=/^0o[0-7]+$/i,ip=parseInt,Dt="object"==typeof Ht&&Ht&&Ht.Object===Object&&Ht,p="object"==typeof self&&self&&self.Object===Object&&self,op=Dt||p||Function("return this")(),ap=Object.prototype.toString,sp=Math.max,lp=Math.min;function up(e){var t=typeof e;return e&&("object"==t||"function"==t)}function cp(e){if("number"==typeof e)return e;if("symbol"==typeof(r=e)||!!(t=r)&&"object"==typeof t&&ap.call(r)==Qd)return Kd;var t;if("string"!=typeof(e=up(e)?up(t="function"==typeof e.valueOf?e.valueOf():e)?t+"":t:e))return 0===e?e:+e;e=e.replace(ep,"");var r=rp.test(e);return r||np.test(e)?ip(e.slice(2),r?2:8):tp.test(e)?Kd:+e}function hp(n,r,e){var i,o,a,s,l,u,c=0,h=!1,f=!1,t=!0;if("function"!=typeof n)throw new TypeError("Expected a function");function d(e){var t=i,r=o;return i=o=void 0,c=e,s=n.apply(r,t)}function p(e){var t=e-u;return void 0===u||r<=t||t<0||f&&a<=e-c}function m(){var e,t=Jd();if(p(t))return g(t);l=setTimeout(m,(e=r-((t=t)-u),f?lp(e,a-(t-c)):e))}function g(e){return l=void 0,t&&i?d(e):(i=o=void 0,s)}function y(){var e=Jd(),t=p(e);if(i=arguments,o=this,u=e,t){if(void 0===l)return c=e=u,l=setTimeout(m,r),h?d(e):s;if(f)return l=setTimeout(m,r),d(u)}return void 0===l&&(l=setTimeout(m,r)),s}return r=cp(r)||0,up(e)&&(h=!!e.leading,f="maxWait"in e,a=f?sp(cp(e.maxWait)||0,r):a,t="trailing"in e?!!e.trailing:t),y.cancel=function(){void 0!==l&&clearTimeout(l),i=u=o=l=void(c=0)},y.flush=function(){return void 0===l?s:g(Jd())},y}function fp(){for(var e={},t=0;t<arguments.length;t++){var r,n=arguments[t];for(r in n)dp.call(n,r)&&(e[r]=n[r])}return e}var dp=Object.prototype.hasOwnProperty;function pp(){}function I(){I.init.call(this)}function mp(e){return void 0===e._maxListeners?I.defaultMaxListeners:e._maxListeners}function gp(e,t,r,n){var i,o;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');return(i=e._events)?(i.newListener&&(e.emit("newListener",t,r.listener||r),i=e._events),o=i[t]):(i=e._events=new pp,e._eventsCount=0),o?("function"==typeof o?o=i[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),o.warned||(n=mp(e))&&0<n&&o.length>n&&(o.warned=!0,(n=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",n.emitter=e,n.type=t,n.count=o.length,n=n,"function"==typeof console.warn?console.warn(n):console.log(n))):(o=i[t]=r,++e._eventsCount),e}function yp(e,t,r){var n=!1;function i(){e.removeListener(t,i),n||(n=!0,r.apply(e,arguments))}return i.listener=r,i}function vp(e){var t=this._events;if(t){t=t[e];if("function"==typeof t)return 1;if(t)return t.length}return 0}function _p(e,t){for(var r=new Array(t);t--;)r[t]=e[t];return r}pp.prototype=Object.create(null),(I.EventEmitter=I).usingDomains=!1,I.prototype.domain=void 0,I.prototype._events=void 0,I.prototype._maxListeners=void 0,I.defaultMaxListeners=10,I.init=function(){this.domain=null,I.usingDomains&&(void 0).active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new pp,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},I.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},I.prototype.getMaxListeners=function(){return mp(this)},I.prototype.emit=function(e){var t,r,n,i="error"===e,o=this._events;if(o)i=i&&null==o.error;else if(!i)return!1;if(a=this.domain,i){var a,i=arguments[1];if(a)return(i=i||new Error('Uncaught, unspecified "error" event')).domainEmitter=this,i.domain=a,i.domainThrown=!1,a.emit("error",i),!1;throw i instanceof Error?i:((a=new Error('Uncaught, unspecified "error" event. ('+i+")")).context=i,a)}if(!(t=o[e]))return!1;var s,l="function"==typeof t;switch(s=arguments.length){case 1:var u=t,c=l,h=this;if(c)u.call(h);else for(var f=u.length,O=_p(u,f),d=0;d<f;++d)O[d].call(h);break;case 2:var c=t,u=l,p=this,m=arguments[1];if(u)c.call(p,m);else for(var g=c.length,R=_p(c,g),y=0;y<g;++y)R[y].call(p,m);break;case 3:var v=t,_=l,x=this,b=arguments[1],w=arguments[2];if(_)v.call(x,b,w);else for(var E=v.length,F=_p(v,E),T=0;T<E;++T)F[T].call(x,b,w);break;case 4:var _=t,v=l,S=this,M=arguments[1],k=arguments[2],C=arguments[3];if(v)_.call(S,M,k,C);else for(var A=_.length,B=_p(_,A),I=0;I<A;++I)B[I].call(S,M,k,C);break;default:for(r=new Array(s-1),n=1;n<s;n++)r[n-1]=arguments[n];var L=t,N=l,P=this,z=r;if(N)L.apply(P,z);else for(var j=L.length,U=_p(L,j),D=0;D<j;++D)U[D].apply(P,z)}return!0},I.prototype.on=I.prototype.addListener=function(e,t){return gp(this,e,t,!1)},I.prototype.prependListener=function(e,t){return gp(this,e,t,!0)},I.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,yp(this,e,t)),this},I.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,yp(this,e,t)),this},I.prototype.removeListener=function(e,t){var r,n,i,o,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if((n=this._events)&&(r=n[e]))if(r===t||r.listener&&r.listener===t)0==--this._eventsCount?this._events=new pp:(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length;0<o--;)if(r[o]===t||r[o].listener&&r[o].listener===t){a=r[o].listener,i=o;break}if(i<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new pp,this;delete n[e]}else{for(var s=r,l=i,u=l+1,c=s.length;u<c;l+=1,u+=1)s[l]=s[u];s.pop()}n.removeListener&&this.emit("removeListener",e,a||t)}return this},I.prototype.off=function(e,t){return this.removeListener(e,t)},I.prototype.removeAllListeners=function(e){var t,r=this._events;if(r)if(r.removeListener){if(0===arguments.length){for(var n,i=Object.keys(r),o=0;o<i.length;++o)"removeListener"!==(n=i[o])&&this.removeAllListeners(n);this.removeAllListeners("removeListener"),this._events=new pp,this._eventsCount=0}else if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)for(;this.removeListener(e,t[t.length-1]),t[0];);}else 0===arguments.length?(this._events=new pp,this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=new pp:delete r[e]);return this},I.prototype.listeners=function(e){var t=this._events,e=t&&(t=t[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(t):[];return e},I.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):vp.call(e,t)},I.prototype.listenerCount=vp,I.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]};v=O(Object.freeze({__proto__:null,default:I,EventEmitter:I}));var xp=function(e){return e?e.split(/,\s*</).reduce(function(t,e){var r,n,i=(e=(e=e).match(/<?([^>]*)>(.*)/))&&(r=e[1],e=e[2].split(";"),n=null,e=e.reduce(function(e,t){t=(t=(t=t).match(/\s*(.+)\s*=\s*"?([^"]+)"?/))?{key:t[1],value:t[2]}:null;return t&&("rel"===t.key?n=n||t.value:e[t.key]=t.value),e},{}),n)?{url:r,rel:n,params:e}:null;return i&&i.rel.split(/\s+/).forEach(function(e){t[e]||(t[e]={url:i.url,params:i.params})}),t},{}):{}};function bp(e,t){this.request=e,this.headers=t.headers,this.rawBody=t.body,this.statusCode=t.statusCode;try{this.body=JSON.parse(t.body||"{}")}catch(e){this.body=t.body}this.links=xp(this.headers.link)}bp.prototype.hasNextPage=function(){return!!this.links.next},bp.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var l={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},wp=l;var Ep=bp,Tp=function(t){var r,e=t.type||wp.ERROR_HTTP;if(t.body)try{r=JSON.parse(t.body)}catch(e){r=t.body}else r=null;var n=t.message||null;n||("string"==typeof r?n=r:r&&"string"==typeof r.message?n=r.message:e===wp.ERROR_REQUEST_ABORTED&&(n="Request aborted")),this.message=n,this.type=e,this.statusCode=t.statusCode||null,this.request=t.request,this.body=r},Sp=l,Mp=function(e){var r={};return e&&e.trim().split(/[\r|\n]+/).forEach(function(e){t=(e=e).indexOf(":");var t,e={name:e.substring(0,t).trim().toLowerCase(),value:e.substring(t+1).trim()};r[e.name]=e.value}),r},kp={};function Cp(e){var t=e.total,e=e.loaded;return{total:t,transferred:e,percent:100*e/t}}function Ap(i,o){return new Promise(function(t,r){o.onprogress=function(e){i.emitter.emit(Sp.EVENT_PROGRESS_DOWNLOAD,Cp(e))};var e=i.file,n=(e&&(o.upload.onprogress=function(e){i.emitter.emit(Sp.EVENT_PROGRESS_UPLOAD,Cp(e))}),o.onerror=function(e){r(e)},o.onabort=function(){var e=new Tp({request:i,type:Sp.ERROR_REQUEST_ABORTED});r(e)},o.onload=function(){var e;delete kp[i.id],o.status<200||400<=o.status?(e=new Tp({request:i,body:o.response,statusCode:o.status}),r(e)):t(o)},i.body);"string"==typeof n?o.send(n):n?o.send(JSON.stringify(n)):e?o.send(e):o.send(),kp[i.id]=o}).then(function(e){return new Ep(i,{body:(e=e).response,headers:Mp(e.getAllResponseHeaders()),statusCode:e.status})})}function Ip(t,e){var e=t.url(e),r=new window.XMLHttpRequest;return r.open(t.method,e),Object.keys(t.headers).forEach(function(e){r.setRequestHeader(e,t.headers[e])}),r}u={browserAbort:function(e){var t=kp[e.id];t&&(t.abort(),delete kp[e.id])},sendRequestXhr:Ap,browserSend:function(t){return Promise.resolve().then(function(){var e=Ip(t,t.client.accessToken);return Ap(t,e)})},createRequestXhr:Ip},c={exports:{}},o=c,s=Ht;function Lp(e){throw new zp(e)}var Pp=c.exports,o=o.exports==Pp&&o,m="object"==typeof Ht&&Ht,zp=(m.global!==m&&m.window!==m||(s=m),function(e){this.message=e}),Dp=(zp.prototype=new Error,zp.prototype.name="InvalidCharacterError","ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Op=/[\t\n\f\r ]/g,Rp={encode:function(e){e=String(e),/[^\0-\xFF]/.test(e)&&Lp("The string to be encoded contains characters outside of the Latin1 range.");for(var t,r,n,i,o=e.length%3,a="",s=-1,l=e.length-o;++s<l;)t=e.charCodeAt(s)<<16,r=e.charCodeAt(++s)<<8,n=e.charCodeAt(++s),a+=Dp.charAt((i=t+r+n)>>18&63)+Dp.charAt(i>>12&63)+Dp.charAt(i>>6&63)+Dp.charAt(63&i);return 2==o?(t=e.charCodeAt(s)<<8,r=e.charCodeAt(++s),a+=Dp.charAt((i=t+r)>>10)+Dp.charAt(i>>4&63)+Dp.charAt(i<<2&63)+"="):1==o&&(i=e.charCodeAt(s),a+=Dp.charAt(i>>2)+Dp.charAt(i<<4&63)+"=="),a},decode:function(e){for(var t,r,n=(e=String(e).replace(Op,"")).length,i=((n=n%4==0?(e=e.replace(/==?$/,"")).length:n)%4!=1&&!/[^+a-zA-Z0-9/]/.test(e)||Lp("Invalid character: the string to be decoded is not correctly encoded."),0),o="",a=-1;++a<n;)r=Dp.indexOf(e.charAt(a)),t=i%4?64*t+r:r,i++%4&&(o+=String.fromCharCode(255&t>>(-2*i&6)));return o},version:"0.1.0"};if(Pp&&!Pp.nodeType)if(o)o.exports=Rp;else for(var Fp in Rp)Rp.hasOwnProperty(Fp)&&(Pp[Fp]=Rp[Fp]);else s.base64=Rp;var Bp=c.exports,Np={};function jp(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Up(e){if(Np[e])return Np[e];var t=e.split("."),r=t[0];if(t=t[1])return t={usage:r,user:(r=function(e){try{return JSON.parse(Bp.decode(e))}catch(e){throw new Error("Invalid token")}}(t)).u},jp(r,"a")&&(t.authorization=r.a),jp(r,"exp")&&(t.expires=1e3*r.exp),jp(r,"iat")&&(t.created=1e3*r.iat),jp(r,"scopes")&&(t.scopes=r.scopes),jp(r,"client")&&(t.client=r.client),jp(r,"ll")&&(t.lastLogin=r.ll),jp(r,"iu")&&(t.impersonator=r.iu),Np[e]=t;throw new Error("Invalid token")}function Vp(){for(var e={},t=0;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Gp.call(n,r)&&(e[r]=n[r])}return e}var Gp=Object.prototype.hasOwnProperty;var Wp,Zp,h={exports:{}};function qp(){}function Hp(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function $p(e,t,r,n,i){if("function"!=typeof r)throw new TypeError("The listener must be a function");r=new Hp(r,n||e,i),n=Zp?Zp+t:t;return e._events[n]?e._events[n].fn?e._events[n]=[e._events[n],r]:e._events[n].push(r):(e._events[n]=r,e._eventsCount++),e}function Xp(e,t){0==--e._eventsCount?e._events=new qp:delete e._events[t]}function Yp(){this._events=new qp,this._eventsCount=0}function Jp(e){return Array.isArray(e)?e.map(encodeURIComponent).join(","):encodeURIComponent(String(e))}function Kp(e,t,r){var n;return!1===r||null===r?e:(n=/\?/.test(e)?"&":"?",t=encodeURIComponent(t),void 0!==r&&""!==r&&!0!==r&&(t+="="+Jp(r)),e+n+t)}a=h,Wp=Object.prototype.hasOwnProperty,Zp="~",Object.create&&(qp.prototype=Object.create(null),(new qp).__proto__||(Zp=!1)),Yp.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)Wp.call(e,t)&&r.push(Zp?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},Yp.prototype.listeners=function(e){var e=Zp?Zp+e:e,t=this._events[e];if(!t)return[];if(t.fn)return[t.fn];for(var r=0,n=t.length,i=new Array(n);r<n;r++)i[r]=t[r].fn;return i},Yp.prototype.listenerCount=function(e){e=Zp?Zp+e:e,e=this._events[e];return e?e.fn?1:e.length:0},Yp.prototype.emit=function(e,t,r,n,i,o){var a=Zp?Zp+e:e;if(!this._events[a])return!1;var s,l=this._events[a],u=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),u){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,n),!0;case 5:return l.fn.call(l.context,t,r,n,i),!0;case 6:return l.fn.call(l.context,t,r,n,i,o),!0}for(f=1,s=new Array(u-1);f<u;f++)s[f-1]=arguments[f];l.fn.apply(l.context,s)}else for(var c,h=l.length,f=0;f<h;f++)switch(l[f].once&&this.removeListener(e,l[f].fn,void 0,!0),u){case 1:l[f].fn.call(l[f].context);break;case 2:l[f].fn.call(l[f].context,t);break;case 3:l[f].fn.call(l[f].context,t,r);break;case 4:l[f].fn.call(l[f].context,t,r,n);break;default:if(!s)for(c=1,s=new Array(u-1);c<u;c++)s[c-1]=arguments[c];l[f].fn.apply(l[f].context,s)}return!0},Yp.prototype.on=function(e,t,r){return $p(this,e,t,r,!1)},Yp.prototype.once=function(e,t,r){return $p(this,e,t,r,!0)},Yp.prototype.removeListener=function(e,t,r,n){e=Zp?Zp+e:e;if(this._events[e])if(t){var i=this._events[e];if(i.fn)i.fn!==t||n&&!i.once||r&&i.context!==r||Xp(this,e);else{for(var o=0,a=[],s=i.length;o<s;o++)(i[o].fn!==t||n&&!i[o].once||r&&i[o].context!==r)&&a.push(i[o]);a.length?this._events[e]=1===a.length?a[0]:a:Xp(this,e)}}else Xp(this,e);return this},Yp.prototype.removeAllListeners=function(e){return e?(e=Zp?Zp+e:e,this._events[e]&&Xp(this,e)):(this._events=new qp,this._eventsCount=0),this},Yp.prototype.off=Yp.prototype.removeListener,Yp.prototype.addListener=Yp.prototype.on,Yp.prefixed=Zp,a.exports=Yp.EventEmitter=Yp;var Qp=Up,em=Vp,tm=h.exports,rm={appendQueryObject:function(e,r){var n;return r?(n=e,Object.keys(r).forEach(function(e){var t=r[e];void 0!==t&&(Array.isArray(t)&&(t=t.filter(function(e){return null!=e}).join(",")),n=Kp(n,e,t))}),n):e},appendQueryParam:Kp,prependOrigin:function(e,t){var r;return!t||"http"===e.slice(0,4)?e:(r="/"===e[0]?"":"/",t.replace(/\/$/,"")+r+e)},interpolateRouteParams:function(e,n){return n?e.replace(/\/:([a-zA-Z0-9]+)/g,function(e,t){var r=n[t];if(void 0===r)throw new Error("Unspecified route parameter "+t);return"/"+Jp(r)}):e}},nm=l,im=1;function om(e,t){if(!e)throw new Error("MapiRequest requires a client");if(!t||!t.path||!t.method)throw new Error("MapiRequest requires an options object with path and method properties");var r={},n=(t.body&&(r["content-type"]="application/json"),em(r,t.headers)),r=Object.keys(n).reduce(function(e,t){return e[t.toLowerCase()]=n[t],e},{});this.id=im++,this._options=t,this.emitter=new tm,this.client=e,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=t.path,this.method=t.method,this.origin=t.origin||e.origin,this.query=t.query||{},this.params=t.params||{},this.body=t.body||null,this.file=t.file||null,this.encoding=t.encoding||"utf8",this.sendFileAs=t.sendFileAs||null,this.headers=r}om.prototype.url=function(e){var t=rm.prependOrigin(this.path,this.origin),r=(t=rm.appendQueryObject(t,this.query),this.params),e=null==e?this.client.accessToken:e;return e&&(t=rm.appendQueryParam(t,"access_token",e),e=Qp(e).user,r=em({ownerId:e},r)),t=rm.interpolateRouteParams(t,r)},om.prototype.send=function(){var t=this;if(t.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return t.sent=!0,t.client.sendRequest(t).then(function(e){return t.response=e,t.emitter.emit(nm.EVENT_RESPONSE,e),e},function(e){throw t.error=e,t.emitter.emit(nm.EVENT_ERROR,e),e})},om.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),this.response||this.error||this.aborted||(this.aborted=!0,this.client.abortRequest(this))},om.prototype.eachPage=function(r){var n=this;function t(t){r(null,t,function(){delete n._nextPageRequest;var e=t.nextPage();e&&o(n._nextPageRequest=e)})}function i(e){r(e,null,function(){})}function o(e){e.send().then(t,i)}o(this)},om.prototype.clone=function(){return this._extend()},om.prototype._extend=function(e){e=em(this._options,e);return new om(this.client,e)};var am=Up,sm=om,lm=l;function um(e){if(!e||!e.accessToken)throw new Error("Cannot create a client without an access token");am(e.accessToken),this.accessToken=e.accessToken,this.origin=e.origin||lm.API_ORIGIN}um.prototype.createRequest=function(e){return new sm(this,e)};var e=um,d=u,cm=e;function hm(e){cm.call(this,e)}((hm.prototype=Object.create(cm.prototype)).constructor=hm).prototype.sendRequest=d.browserSend,hm.prototype.abortRequest=d.browserAbort;function fm(e){return new hm(e)}var Dt=fm,dm=Object.prototype.toString,pm=Object.prototype.hasOwnProperty;var mm=function(e){return"[object Object]"===dm.call(e)&&(null===(e=Object.getPrototypeOf(e))||e===Object.getPrototypeOf({}))},gm=function(){for(var e={},t=0;t<arguments.length;t++){var r,n=arguments[t];for(r in n)pm.call(n,r)&&(e[r]=n[r])}return e},ym="\n  ",L={};function vm(i){var o=Array.isArray(i);return function(e){var t=_m(L.plainArray,e);if(t)return t;if(o&&e.length!==i.length)return"an array with "+i.length+" items";for(var r,n=0;n<e.length;n++)if(t=_m((r=n,o?i[r]:i),e[n]))return[n].concat(t)}}function _m(e,t){return(null!=t||e.hasOwnProperty("__required"))&&(e=e(t))?Array.isArray(e)?e:[e]:void 0}function xm(e,t){var r=e.length,n=e[r-1],e=e.slice(0,r-1);return 0===e.length&&(e=["value"]),t=gm(t,{path:e}),"function"==typeof n?n(t):bm(t,"must be "+function(e){if(!/^an? /.test(e)){if(/^[aeiou]/i.test(e))return"an "+e;if(/^[a-z]/i.test(e))return"a "+e}return e}(n)+".")}function bm(e,t){return(wm(e.path)?"Item at position ":"")+(e.path.join(".")+" "+t)}function wm(e){return"number"==typeof e[e.length-1]||"number"==typeof e[0]}L.assert=function(t,r){return r=r||{},function(e){var e=_m(t,e);if(e)throw e=xm(e,r),r.apiName&&(e=r.apiName+": "+e),new Error(e)}},L.shape=function(e){t=e;var t,o=Object.keys(t||{}).map(function(e){return{key:e,value:t[e]}});return function(e){var t,r=_m(L.plainObject,e);if(r)return r;for(var n=[],i=0;i<o.length;i++)t=o[i].key,(r=_m(o[i].value,e[t]))&&n.push([t].concat(r));return n.length<2?n[0]:function(t){n=n.map(function(e){return"- "+e[0]+": "+xm(e,t).split("\n").join(ym)});var e=t.path.join(".");return"The following properties"+("value"===e?"":" of "+e)+" have invalid values:"+ym+n.join(ym)}}},L.strictShape=function(n){var i=L.shape(n);return function(e){var t,r=i(e);return r||(0!==(t=Object.keys(e).reduce(function(e,t){return void 0===n[t]&&e.push(t),e},[])).length?function(){return"The following keys are invalid: "+t.join(", ")}:void 0)}},L.arrayOf=vm,L.tuple=function(){return vm(Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments))},L.required=function(t){function e(e){return null==e?function(e){return bm(e,wm(e.path)?"cannot be undefined/null.":"is required.")}:t.apply(this,arguments)}return e.__required=!0,e},L.oneOfType=function(){var n=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(t){var e,r=n.map(function(e){return _m(e,t)}).filter(Boolean);if(r.length===n.length)return r.every(function(e){return 1===e.length&&"string"==typeof e[0]})?(e=r.map(function(e){return e[0]})).length<2?e[0]:2!==e.length?e.slice(0,-1).join(", ")+", or "+e.slice(-1):e.join(" or "):r.reduce(function(e,t){return t.length>e.length?t:e})}},L.equal=function(t){return function(e){if(e!==t)return JSON.stringify(t)}},L.oneOf=function(){var e=(Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments)).map(function(e){return L.equal(e)});return L.oneOfType.apply(this,e)},L.range=function(e){var t=e[0],r=e[1];return function(e){if(_m(L.number,e)||e<t||r<e)return"number between "+t+" & "+r+" (inclusive)"}},L.any=function(){},L.boolean=function(e){if("boolean"!=typeof e)return"boolean"},L.number=function(e){if("number"!=typeof e)return"number"},L.plainArray=function(e){if(!Array.isArray(e))return"array"},L.plainObject=function(e){if(!mm(e))return"object"},L.string=function(e){if("string"!=typeof e)return"string"},L.func=function(e){if("function"!=typeof e)return"function"},L.validate=_m,L.processMessage=xm;var Em=L;p=Vp(Em,{file:function(e){return"undefined"!=typeof window?e instanceof Ht.Blob||e instanceof Ht.ArrayBuffer?void 0:"Blob or ArrayBuffer":"string"!=typeof e&&void 0===e.pipe?"Filename or Readable stream":void 0},date:function(e){if("boolean"==typeof e)return"date";try{var t=new Date(e);if(t.getTime&&isNaN(t.getTime()))return"date"}catch(e){return"date"}},coordinates:function(e){return Em.tuple(Em.number,Em.number)(e)},assertShape:function(e,t){return Em.assert(Em.strictShape(e),t)}});var Tm=function(r,n){return Object.keys(r).reduce(function(e,t){return e[t]=n(t,r[t]),e},{})};var Sm=e,Mm=fm;var km=Vp,P=p,Cm=function(r,n){var t="function"==typeof n?n:function(e,t){return-1!==n.indexOf(e)&&void 0!==t};return Object.keys(r).filter(function(e){return t(e,r[e])}).reduce(function(e,t){return e[t]=r[t],e},{})},Am=function(e){return Tm(e,function(e,t){return"boolean"==typeof t?JSON.stringify(t):t})},m=function(r){return function(e){var e=Sm.prototype.isPrototypeOf(e)?e:Mm(e),t=Object.create(r);return t.client=e,t}},o={},Im=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"],s=(o.forwardGeocode=function(e){P.assertShape({query:P.required(P.string),mode:P.oneOf("mapbox.places","mapbox.places-permanent"),countries:P.arrayOf(P.string),proximity:P.oneOf(P.coordinates,"ip"),types:P.arrayOf(P.oneOf(Im)),autocomplete:P.boolean,bbox:P.arrayOf(P.number),limit:P.number,language:P.arrayOf(P.string),routing:P.boolean,fuzzyMatch:P.boolean,worldview:P.string})(e),e.mode=e.mode||"mapbox.places";var t=Am(km({country:e.countries},Cm(e,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Cm(e,["mode","query"]),query:t})},o.reverseGeocode=function(e){P.assertShape({query:P.required(P.coordinates),mode:P.oneOf("mapbox.places","mapbox.places-permanent"),countries:P.arrayOf(P.string),types:P.arrayOf(P.oneOf(Im)),bbox:P.arrayOf(P.number),limit:P.number,language:P.arrayOf(P.string),reverseMode:P.oneOf("distance","score"),routing:P.boolean,worldview:P.string})(e),e.mode=e.mode||"mapbox.places";var t=Am(km({country:e.countries},Cm(e,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Cm(e,["mode","query"]),query:t})},m(o));let Lm=e=>crypto.getRandomValues(new Uint8Array(e)),Pm=(i,e,o)=>{let a=(2<<Math.log(i.length-1)/Math.LN2)-1,s=-~(1.6*a*e/i.length);return(t=e)=>{let r="";for(;;){var n=o(s);let e=s;for(;e--;)if((r+=i[n[e]&a]||"").length===t)return r}}};var zm=O(Object.freeze({__proto__:null,nanoid:(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((e,t)=>e+=(t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():62<t?"-":"_",""),customAlphabet:(e,t=21)=>Pm(e,t,Lm),customRandom:Pm,urlAlphabet:"useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",random:Lm})).nanoid;function Dm(e){this.origin=e.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=e.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=e,this.send=this.send.bind(this),this.countries=e.countries?e.countries.split(","):null,this.types=e.types?e.types.split(","):null,this.bbox=e.bbox||null,this.language=e.language?e.language.split(","):null,this.limit=e.limit?+e.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(e),this.eventQueue=new Array,this.flushInterval=e.flushInterval||1e3,this.maxQueueSize=e.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}Dm.prototype={select:function(e,t){var r=this.getSelectedIndex(e,t),t=this.getEventPayload("search.select",t);if(t.resultIndex=r,t.resultPlaceName=e.place_name,t.resultId=e.id,(r!==this.lastSentIndex||t.queryString!==this.lastSentInput)&&-1!=r&&(this.lastSentIndex=r,this.lastSentInput=t.queryString,t.queryString))return this.push(t)},start:function(e){e=this.getEventPayload("search.start",e);if(e.queryString)return this.push(e)},keyevent:function(e,t){if(e.key&&!e.metaKey&&-1===[9,27,37,39,13,38,40].indexOf(e.keyCode)){t=this.getEventPayload("search.keystroke",t);if(t.lastAction=e.key,t.queryString)return this.push(t)}},send:function(e,t){if(!this.enableEventLogging)return t?t():void 0;e=this.getRequestOptions(e);this.request(e,function(e){return e?this.handleError(e,t):t?t():void 0}.bind(this))},getRequestOptions:function(e){return Array.isArray(e)||(e=[e]),{method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}},getEventPayload:function(e,t){var r=t.options.proximity?"object"==typeof t.options.proximity?[t.options.proximity.longitude,t.options.proximity.latitude]:"ip"===t.options.proximity?[999,999]:t.options.proximity:null,n=t._map?t._map.getZoom():void 0,r={event:e,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:t.options.autocomplete,fuzzyMatch:t.options.fuzzyMatch,proximity:r,limit:t.options.limit,routing:t.options.routing,worldview:t.options.worldview,mapZoom:n,keyboardLocale:this.locale};return"search.select"!==e&&"search.select"!=e&&t._inputEl?r.queryString=t._inputEl.value:r.queryString=t.inputString,r},request:function(e,t){var r,n=new XMLHttpRequest;for(r in n.onreadystatechange=function(){if(4==this.readyState)return 204==this.status?t(null):t(this.statusText)},n.open(e.method,e.host+"/"+e.path,!0),e.headers){var i=e.headers[r];n.setRequestHeader(r,i)}n.send(e.body)},handleError:function(e,t){if(t)return t(e)},generateSessionID:function(){return zm()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(e,t){if(t._typeahead)return t=t._typeahead.data,e=e.id,t.map(function(e){return e.id}).indexOf(e)},shouldEnableLogging:function(e){return!1!==e.enableEventLogging&&((!e.origin||"https://api.mapbox.com"===e.origin)&&(!e.localGeocoder&&!e.filter))},flush:function(){0<this.eventQueue.length&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(e,t){this.eventQueue.push(e),(this.eventQueue.length>=this.maxQueueSize||t)&&this.flush()},remove:function(){this.flush()}};c=Dm,a={placeholder:{de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"}},h={exports:{}};function Om(){}function Rm(e){var t=e.address||"",r=e.text||"",n=e.place_name||"";const i={address:n.split(",")[0],houseNumber:t,street:r,placeName:n};return e.context.forEach(function(e){var t=e.id.split(".")[0];i[t]=e.text}),i}l=Ht,u=function(){var i="",t=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function o(e){return e.match(t)||[]}function a(e){return{language:(e=o(e))[1]||i,extlang:e[2]||i,script:e[3]||i,region:e[4]||i}}function s(e,t,r){Object.defineProperty(e,t,{value:r,enumerable:!0})}function e(t,e,r){function n(e){return o(e)[t]||i}s(n,"pattern",e),s(a,r,n)}return e(1,/^[a-zA-Z]{2,3}$/,"language"),e(2,/^[a-zA-Z]{3}$/,"extlang"),e(3,/^[a-zA-Z]{4}$/,"script"),e(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),s(a,"split",function(e){return o(e).filter(function(e,t){return e&&t})}),a},(d=h).exports?d.exports=u():l.subtag=u(),Om.prototype={isSupport:function(){return Boolean(window.navigator.geolocation)},getCurrentPosition:function(){const r={enableHighAccuracy:!0};return new Promise(function(e,t){window.navigator.geolocation.getCurrentPosition(e,t,r)})}};var Fm=g,Bm=hp,Nm=fp,jm=v.EventEmitter,Um={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}},Vm=Dt,Gm=s,Wm=c,Zm=a,qm=h.exports,Hm=Om,$m={transformFeatureToGeolocationText:function(e,t){const r=Rm(e);return e=["address","street","place","country"],"function"==typeof t?t(r):(-1===(t=e.indexOf(t))?e:e.slice(t)).reduce(function(e,t){return r[t]?(""!==e&&(e+=", "),e+r[t]):e},"")},getAddressInfo:Rm,REVERSE_GEOCODE_COORD_RGX:/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/};const Xm={FORWARD:0,LOCAL:1,REVERSE:2};function Ym(e){this._eventEmitter=new jm,this.options=Nm({},this.options,e),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new Hm}Ym.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(e){return e.place_name},render:function(e){e=e.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+e[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+e.splice(1,e.length).join(",")+"</div></div>"}},addTo:function(e){function t(e,t){if(!document.body.contains(t))throw new Error("Element provided to #addTo() exists, but is not in the DOM");e=e.onAdd();t.appendChild(e)}if(e._controlContainer)e.addControl(this);else if(e instanceof HTMLElement)t(this,e);else{if("string"!=typeof e)throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element");var r=document.querySelectorAll(e);if(0===r.length)throw new Error("Element ",e,"not found.");if(1<r.length)throw new Error("Geocoder can only be added to a single html element");t(this,r[0])}},onAdd:function(e){if(e&&"string"!=typeof e&&(this._map=e),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=Gm(Vm({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new Wm(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var e=this.container=document.createElement("div"),t=(e.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl",this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>')),r=(this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",Bm(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(e){this.eventManager.keyevent(e,this)}.bind(this)),document.createElement("div")),n=(r.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button",this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>')),t=(this._clearEl.appendChild(n),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),r.appendChild(this._clearEl),r.appendChild(this._loadingEl),e.appendChild(t),e.appendChild(this._inputEl),e.appendChild(r),this.options.enableGeolocation&&this.geolocation.isSupport()&&(this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button",n=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>'),this._geolocateEl.appendChild(n),r.appendChild(this._geolocateEl),this._showGeolocateButton()),this._typeahead=new Fm(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit})),i=(this.setRenderFunction(this.options.render),t.getItemValue=this.options.getItemValue,t.list.draw),o=this._footerNode=((n=document.createElement("div")).className="mapboxgl-ctrl-geocoder--powered-by",n.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',n);return t.list.draw=function(){i.call(this),o.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),o.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(o)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),e},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(e){this._hideLoadingIcon();const r={geometry:{type:"Point",coordinates:[e.coords.longitude,e.coords.latitude]}};this._handleMarker(r),this._fly(r),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(r),this._showClearButton(),this.fresh=!1;var t,e={limit:1,language:[this.options.language],query:r.geometry.coordinates,types:["address"]};this.options.localGeocoderOnly?(t=r.geometry.coordinates[0]+","+r.geometry.coordinates[1],this._setInputValue(t),this._eventEmitter.emit("result",{result:r})):this.geocoderService.reverseGeocode(e).send().then(function(e){var t,e=e.body.features[0];e?(t=$m.transformFeatureToGeolocationText(e,this.options.addressAccuracy),this._setInputValue(t),e.user_coordinates=r.geometry.coordinates,this._eventEmitter.emit("result",{result:e})):this._eventEmitter.emit("result",{result:{user_coordinates:r.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(e){1===e.code?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(e,t){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");return r.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+e),r.setAttribute("viewBox","0 0 18 18"),r.setAttribute("xml:space","preserve"),r.setAttribute("width",18),r.setAttribute("height",18),r.innerHTML=t,r},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(e){this._inputEl.value=e,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(e){e=(e.clipboardData||window.clipboardData).getData("text");e.length>=this.options.minLength&&this._geocode(e)},_onKeyDown:function(e){var t;return 27===e.keyCode&&this.options.clearAndBlurOnEsc?(this._clear(e),this._inputEl.blur()):((t=e.target&&e.target.shadowRoot?e.target.shadowRoot.activeElement:e.target)?t.value:"")?(this._hideGeolocateButton(),void(e.metaKey||-1!==[9,27,37,39,13,38,40].indexOf(e.keyCode)||t.value.length>=this.options.minLength&&this._geocode(t.value))):(this.fresh=!0,9!==e.keyCode&&this.clear(e),this._showGeolocateButton(),this._hideClearButton())},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(e){this.options.clearOnBlur&&this._clearOnBlur(e),this.options.collapsed&&this._collapse()},_onChange:function(){var e=this._typeahead.selected;e&&JSON.stringify(e)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(e),this.options.marker&&this._mapboxgl&&this._handleMarker(e),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(e),this._eventEmitter.emit("result",{result:e}),this.eventManager.select(e,this))},_fly:function(e){var t,r;e.properties&&Um[e.properties.short_code]?(t=Nm({},this.options.flyTo),this._map&&this._map.fitBounds(Um[e.properties.short_code].bbox,t)):e.bbox?(r=e.bbox,t=Nm({},this.options.flyTo),this._map&&this._map.fitBounds([[r[0],r[1]],[r[2],r[3]]],t)):(r={zoom:this.options.zoom},t=Nm({},r,this.options.flyTo),e.center?t.center=e.center:e.geometry&&e.geometry.type&&"Point"===e.geometry.type&&e.geometry.coordinates&&(t.center=e.geometry.coordinates),this._map&&this._map.flyTo(t))},_requestType:function(e,t){e=e.localGeocoderOnly?Xm.LOCAL:e.reverseGeocode&&$m.REVERSE_GEOCODE_COORD_RGX.test(t)?Xm.REVERSE:Xm.FORWARD;return e},_setupConfig:function(e,t){const i=/[\s,]+/;var o=this,r=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"].reduce(function(e,t){var r,n;return void 0!==o.options[t]&&null!==o.options[t]&&(-1<["countries","types","language"].indexOf(t)?e[t]=o.options[t].split(i):e[t]=o.options[t],r="number"==typeof o.options[t].longitude&&"number"==typeof o.options[t].latitude,"proximity"===t&&r&&(r=o.options[t].longitude,n=o.options[t].latitude,e[t]=[r,n])),e},{});switch(e){case Xm.REVERSE:var n=t.split(i).map(function(e){return parseFloat(e,10)});o.options.flipCoordinates||n.reverse(),r.types&&r.types[0],r=Nm(r,{query:n,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(e){e in r&&delete r[e]});break;case Xm.FORWARD:n=t.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(n)&&(t=t.replace(/,/g," ")),r=Nm(r,{query:t})}return r},_geocode:function(r){this.inputString=r,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:r});var e,t=this._requestType(this.options,r);const n=this._setupConfig(t,r);switch(t){case Xm.LOCAL:e=Promise.resolve();break;case Xm.FORWARD:e=this.geocoderService.forwardGeocode(n).send();break;case Xm.REVERSE:e=this.geocoderService.reverseGeocode(n).send()}var i=this.options.localGeocoder&&this.options.localGeocoder(r)||[],o=[],a=null;return e.catch(function(e){a=e}.bind(this)).then(function(e){this._hideLoadingIcon();var t={};return e?"200"==e.statusCode&&((t=e.body).request=e.request,t.headers=e.headers):t={type:"FeatureCollection",features:[]},t.config=n,this.fresh&&(this.eventManager.start(this),this.fresh=!1),t.features=t.features?i.concat(t.features):i,this.options.externalGeocoder?(o=this.options.externalGeocoder(r,t.features)||Promise.resolve([])).then(function(e){return t.features=t.features?e.concat(t.features):e,t},function(){return t}):t}.bind(this)).then(function(e){if(a)throw a;this.options.filter&&e.features.length&&(e.features=e.features.filter(this.options.filter)),e.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",e),this._typeahead.update(e.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",e))}.bind(this)).catch(function(e){this._hideLoadingIcon(),this._hideAttribution(),i.length&&this.options.localGeocoder||o.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(i)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:i}),this._eventEmitter.emit("error",{error:e})}.bind(this)),e},_clear:function(e){e&&e.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(e){this._clear(e),this._inputEl.focus()},_clearOnBlur:function(e){e.relatedTarget&&this._clear(e)},_onQueryResult:function(e){var e=e.body;e.features.length&&(e=e.features[0],this._typeahead.selected=e,this._inputEl.value=e.place_name,this._onChange())},_updateProximity:function(){var e;this._map&&this.options.trackProximity&&(9<this._map.getZoom()?(e=this._map.getCenter().wrap(),this.setProximity({longitude:e.lng,latitude:e.lat},!1)):this.setProximity(null,!1))},_collapse:function(){this._inputEl.value||this._inputEl===document.activeElement||this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(e){return this._geocode(e).then(this._onQueryResult),this},_renderError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>")},_renderLocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>")},_renderNoResults:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>")},_renderUserDeniedGeolocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>")},_renderMessage:function(e){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(e)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var e=this.options.language.split(",")[0],e=qm.language(e),e=Zm.placeholder[e];if(e)return e}return"Search"},setInput:function(e){return this._inputEl.value=e,this._typeahead.selected=null,this._typeahead.clear(),e.length>=this.options.minLength&&this._geocode(e),this},setProximity:function(e,t=!0){return this.options.proximity=e,t&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(e){return e&&"function"==typeof e&&(this._typeahead.render=e),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(e){var t=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=e||this.options.language||t,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(e){return this.options.zoom=e,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(e){return this.options.flyTo=e,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(e){return this.placeholder=e||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(e){return this.options.bbox=e,this},getCountries:function(){return this.options.countries},setCountries:function(e){return this.options.countries=e,this},getTypes:function(){return this.options.types},setTypes:function(e){return this.options.types=e,this},getMinLength:function(){return this.options.minLength},setMinLength:function(e){return this.options.minLength=e,this._typeahead&&(this._typeahead.options.minLength=e),this},getLimit:function(){return this.options.limit},setLimit:function(e){return this.options.limit=e,this._typeahead&&(this._typeahead.options.limit=e),this},getFilter:function(){return this.options.filter},setFilter:function(e){return this.options.filter=e,this},setOrigin:function(e){return this.options.origin=e,this.geocoderService=Gm(Vm({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(e){return this.options.accessToken=e,this.geocoderService=Gm(Vm({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(e){return this.options.autocomplete=e,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(e){return this.options.fuzzyMatch=e,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(e){return this.options.routing=e,this},getRouting:function(){return this.options.routing},setWorldview:function(e){return this.options.worldview=e,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(e){var t;if(this._map)return this._removeMarker(),t=Nm({},{color:"#4668F2"},this.options.marker),this.mapMarker=new this._mapboxgl.Marker(t),e.center?this.mapMarker.setLngLat(e.center).addTo(this._map):e.geometry&&e.geometry.type&&"Point"===e.geometry.type&&e.geometry.coordinates&&this.mapMarker.setLngLat(e.geometry.coordinates).addTo(this._map),this},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(e,t){return this._eventEmitter.on(e,t),this},off:function(e,t){return this._eventEmitter.removeListener(e,t),this.eventManager.remove(),this}};var e=Ym,p={},m={},o={},Jm=(Object.defineProperty(o,"__esModule",{value:!0}),B);o.getCoord=function(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&2<=e.length&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")},o.getCoords=function(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")},o.containsNumber=function e(t){if(1<t.length&&Jm.isNumber(t[0])&&Jm.isNumber(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return e(t[0]);throw new Error("coordinates must only contain numbers")},o.geojsonType=function(e,t,r){if(!t||!r)throw new Error("type and name required");if(!e||e.type!==t)throw new Error("Invalid input to "+r+": must be a "+t+", given "+e.type)},o.featureOf=function(e,t,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||"Feature"!==e.type||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==t)throw new Error("Invalid input to "+r+": must be a "+t+", given "+e.geometry.type)},o.collectionOf=function(e,t,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||"FeatureCollection"!==e.type)throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,i=e.features;n<i.length;n++){var o=i[n];if(!o||"Feature"!==o.type||!o.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!o.geometry||o.geometry.type!==t)throw new Error("Invalid input to "+r+": must be a "+t+", given "+o.geometry.type)}},o.getGeom=function(e){return"Feature"===e.type?e.geometry:e},o.getType=function(e,t){return"FeatureCollection"===e.type?"FeatureCollection":"GeometryCollection"===e.type?"GeometryCollection":("Feature"===e.type&&null!==e.geometry?e.geometry:e).type},Object.defineProperty(m,"__esModule",{value:!0});var Km=o,Qm=B;m.default=function(e,t,r){void 0===r&&(r={});var e=Km.getCoord(e),t=Km.getCoord(t),n=Qm.degreesToRadians(t[1]-e[1]),i=Qm.degreesToRadians(t[0]-e[0]),e=Qm.degreesToRadians(e[1]),t=Qm.degreesToRadians(t[1]),n=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(e)*Math.cos(t);return Qm.radiansToLength(2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n)),r.units)};var d=Ht&&Ht.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},eg=(Object.defineProperty(p,"__esModule",{value:!0}),d(m)),tg=r;p.default=function(e,r){return void 0===r&&(r={}),tg.segmentReduce(e,function(e,t){t=t.geometry.coordinates;return e+eg.default(t[0],t[1],r)},0)};l={exports:{}};u=Ht,g=function(){var g,o,l,u,e,s={},y={},t={currentLocale:"en",zeroFormat:null,nullFormat:null,defaultFormat:"0,0",scalePercentBy100:!0},c={currentLocale:t.currentLocale,zeroFormat:t.zeroFormat,nullFormat:t.nullFormat,defaultFormat:t.defaultFormat,scalePercentBy100:t.scalePercentBy100};function a(e,t){this._input=e,this._value=t}return(g=function(e){var t,r,n,i;if(g.isNumeral(e))t=e.value();else if(0===e||void 0===e)t=0;else if(null===e||o.isNaN(e))t=null;else if("string"==typeof e)if(c.zeroFormat&&e===c.zeroFormat)t=0;else if(c.nullFormat&&e===c.nullFormat||!e.replace(/[^0-9]+/g,"").length)t=null;else{for(r in s)if((i="function"==typeof s[r].regexps.unformat?s[r].regexps.unformat():s[r].regexps.unformat)&&e.match(i)){n=s[r].unformat;break}t=(n=n||g._.stringToNumber)(e)}else t=Number(e)||null;return new a(e,t)}).version="2.0.6",g.isNumeral=function(e){return e instanceof a},g._=o={numberToFormat:function(e,t,r){var n,i,o,a,s,l,u=y[g.options.currentLocale],c=!1,h=!1,f="",d="",p=!1;if(e=e||0,l=Math.abs(e),g._.includes(t,"(")?(c=!0,t=t.replace(/[\(|\)]/g,"")):(g._.includes(t,"+")||g._.includes(t,"-"))&&(a=g._.includes(t,"+")?t.indexOf("+"):e<0?t.indexOf("-"):-1,t=t.replace(/[\+|\-]/g,"")),g._.includes(t,"a")&&(i=!!(i=t.match(/a(k|m|b|t)?/))&&i[1],g._.includes(t," a")&&(f=" "),t=t.replace(new RegExp(f+"a[kmbt]?"),""),1e12<=l&&!i||"t"===i?(f+=u.abbreviations.trillion,e/=1e12):l<1e12&&1e9<=l&&!i||"b"===i?(f+=u.abbreviations.billion,e/=1e9):l<1e9&&1e6<=l&&!i||"m"===i?(f+=u.abbreviations.million,e/=1e6):(l<1e6&&1e3<=l&&!i||"k"===i)&&(f+=u.abbreviations.thousand,e/=1e3)),g._.includes(t,"[.]")&&(h=!0,t=t.replace("[.]",".")),o=e.toString().split(".")[0],l=t.split(".")[1],s=t.indexOf(","),n=(t.split(".")[0].split(",")[0].match(/0/g)||[]).length,l?(o=(d=g._.includes(l,"[")?(l=(l=l.replace("]","")).split("["),g._.toFixed(e,l[0].length+l[1].length,r,l[1].length)):g._.toFixed(e,l.length,r)).split(".")[0],d=g._.includes(d,".")?u.delimiters.decimal+d.split(".")[1]:"",h&&0===Number(d.slice(1))&&(d="")):o=g._.toFixed(e,0,r),f&&!i&&1e3<=Number(o)&&f!==u.abbreviations.trillion)switch(o=String(Number(o)/1e3),f){case u.abbreviations.thousand:f=u.abbreviations.million;break;case u.abbreviations.million:f=u.abbreviations.billion;break;case u.abbreviations.billion:f=u.abbreviations.trillion}if(g._.includes(o,"-")&&(o=o.slice(1),p=!0),o.length<n)for(var m=n-o.length;0<m;m--)o="0"+o;return-1<s&&(o=o.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+u.delimiters.thousands)),l=(o=0===t.indexOf(".")?"":o)+d+(f||""),c?l=(c&&p?"(":"")+l+(c&&p?")":""):0<=a?l=0===a?(p?"-":"+")+l:l+(p?"-":"+"):p&&(l="-"+l),l},stringToNumber:function(e){var t,r,n,i=y[c.currentLocale],o=e,a={thousand:3,million:6,billion:9,trillion:12};if(c.zeroFormat&&e===c.zeroFormat)r=0;else if(c.nullFormat&&e===c.nullFormat||!e.replace(/[^0-9]+/g,"").length)r=null;else{for(t in r=1,"."!==i.delimiters.decimal&&(e=e.replace(/\./g,"").replace(i.delimiters.decimal,".")),a)if(n=new RegExp("[^a-zA-Z]"+i.abbreviations[t]+"(?:\\)|(\\"+i.currency.symbol+")?(?:\\))?)?$"),o.match(n)){r*=Math.pow(10,a[t]);break}r*=(e.split("-").length+Math.min(e.split("(").length-1,e.split(")").length-1))%2?1:-1,e=e.replace(/[^0-9\.]+/g,""),r*=Number(e)}return r},isNaN:function(e){return"number"==typeof e&&isNaN(e)},includes:function(e,t){return-1!==e.indexOf(t)},insert:function(e,t,r){return e.slice(0,r)+t+e.slice(r)},reduce:function(e,t){if(null===this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof t)throw new TypeError(t+" is not a function");var r,n=Object(e),i=n.length>>>0,o=0;if(3===arguments.length)r=arguments[2];else{for(;o<i&&!(o in n);)o++;if(i<=o)throw new TypeError("Reduce of empty array with no initial value");r=n[o++]}for(;o<i;o++)o in n&&(r=t(r,n[o],o,n));return r},multiplier:function(e){e=e.toString().split(".");return e.length<2?1:Math.pow(10,e[1].length)},correctionFactor:function(){return Array.prototype.slice.call(arguments).reduce(function(e,t){t=o.multiplier(t);return t<e?e:t},1)},toFixed:function(e,t,r,n){var i=e.toString().split("."),o=t-(n||0),i=2===i.length?Math.min(Math.max(i[1].length,o),t):o,o=Math.pow(10,i),r=(r(e+"e+"+i)/o).toFixed(i);return t-i<n&&(e=new RegExp("\\.?0{1,"+(n-(t-i))+"}$"),r=r.replace(e,"")),r}},g.options=c,g.formats=s,g.locales=y,g.locale=function(e){return e&&(c.currentLocale=e.toLowerCase()),c.currentLocale},g.localeData=function(e){if(!e)return y[c.currentLocale];if(e=e.toLowerCase(),y[e])return y[e];throw new Error("Unknown locale : "+e)},g.reset=function(){for(var e in t)c[e]=t[e]},g.zeroFormat=function(e){c.zeroFormat="string"==typeof e?e:null},g.nullFormat=function(e){c.nullFormat="string"==typeof e?e:null},g.defaultFormat=function(e){c.defaultFormat="string"==typeof e?e:"0.0"},g.register=function(e,t,r){if(t=t.toLowerCase(),this[e+"s"][t])throw new TypeError(t+" "+e+" already registered.");return this[e+"s"][t]=r},g.validate=function(e,t){var r,n,i,o;if("string"!=typeof e&&(e+="",console.warn&&console.warn("Numeral.js: Value is not string. It has been co-erced to: ",e)),(e=e.trim()).match(/^\d+$/))return!0;if(""===e)return!1;try{i=g.localeData(t)}catch(e){i=g.localeData(g.locale())}return t=i.currency.symbol,n=i.abbreviations,r=i.delimiters.decimal,i="."===i.delimiters.thousands?"\\.":i.delimiters.thousands,(null===(o=e.match(/^[^\d]+/))||(e=e.substr(1),o[0]===t))&&((null===(o=e.match(/[^\d]+$/))||(e=e.slice(0,-1),o[0]===n.thousand||o[0]===n.million||o[0]===n.billion||o[0]===n.trillion))&&(t=new RegExp(i+"{2}"),!e.match(/[^\d.,]/g)&&(!(2<(o=e.split(r)).length)&&(o.length<2?!!o[0].match(/^\d+.*\d$/)&&!o[0].match(t):1===o[0].length?!!o[0].match(/^\d+$/)&&!o[0].match(t)&&!!o[1].match(/^\d+$/):!!o[0].match(/^\d+.*\d$/)&&!o[0].match(t)&&!!o[1].match(/^\d+$/)))))},g.fn=a.prototype={clone:function(){return g(this)},format:function(e,t){var r,n,i,o=this._value,a=e||c.defaultFormat;if(t=t||Math.round,0===o&&null!==c.zeroFormat)n=c.zeroFormat;else if(null===o&&null!==c.nullFormat)n=c.nullFormat;else{for(r in s)if(a.match(s[r].regexps.format)){i=s[r].format;break}n=(i=i||g._.numberToFormat)(o,a,t)}return n},value:function(){return this._value},input:function(){return this._input},set:function(e){return this._value=Number(e),this},add:function(e){var i=o.correctionFactor.call(null,this._value,e);return this._value=o.reduce([this._value,e],function(e,t,r,n){return e+Math.round(i*t)},0)/i,this},subtract:function(e){var i=o.correctionFactor.call(null,this._value,e);return this._value=o.reduce([e],function(e,t,r,n){return e-Math.round(i*t)},Math.round(this._value*i))/i,this},multiply:function(e){return this._value=o.reduce([this._value,e],function(e,t,r,n){var i=o.correctionFactor(e,t);return Math.round(e*i)*Math.round(t*i)/Math.round(i*i)},1),this},divide:function(e){return this._value=o.reduce([this._value,e],function(e,t,r,n){var i=o.correctionFactor(e,t);return Math.round(e*i)/Math.round(t*i)}),this},difference:function(e){return Math.abs(g(this._value).subtract(e).value())}},g.register("locale","en",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(e){var t=e%10;return 1==~~(e%100/10)?"th":1==t?"st":2==t?"nd":3==t?"rd":"th"},currency:{symbol:"$"}}),g.register("format","bps",{regexps:{format:/(BPS)/,unformat:/(BPS)/},format:function(e,t,r){var n=g._.includes(t," BPS")?" ":"";return e*=1e4,t=t.replace(/\s?BPS/,""),e=g._.numberToFormat(e,t,r),e=g._.includes(e,")")?((e=e.split("")).splice(-1,0,n+"BPS"),e.join("")):e+n+"BPS"},unformat:function(e){return+(1e-4*g._.stringToNumber(e)).toFixed(15)}}),u={base:1024,suffixes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},e="("+(e=(l={base:1e3,suffixes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]}).suffixes.concat(u.suffixes.filter(function(e){return l.suffixes.indexOf(e)<0})).join("|")).replace("B","B(?!PS)")+")",g.register("format","bytes",{regexps:{format:/([0\s]i?b)/,unformat:new RegExp(e)},format:function(e,t,r){var n,i,o,a=g._.includes(t,"ib")?u:l,s=g._.includes(t," b")||g._.includes(t," ib")?" ":"";for(t=t.replace(/\s?i?b/,""),n=0;n<=a.suffixes.length;n++)if(i=Math.pow(a.base,n),o=Math.pow(a.base,n+1),null===e||0===e||i<=e&&e<o){s+=a.suffixes[n],0<i&&(e/=i);break}return g._.numberToFormat(e,t,r)+s},unformat:function(e){var t,r,n=g._.stringToNumber(e);if(n){for(t=l.suffixes.length-1;0<=t;t--){if(g._.includes(e,l.suffixes[t])){r=Math.pow(l.base,t);break}if(g._.includes(e,u.suffixes[t])){r=Math.pow(u.base,t);break}}n*=r||1}return n}}),g.register("format","currency",{regexps:{format:/(\$)/},format:function(e,t,r){var n,i,o=g.locales[g.options.currentLocale],a={before:t.match(/^([\+|\-|\(|\s|\$]*)/)[0],after:t.match(/([\+|\-|\)|\s|\$]*)$/)[0]};for(t=t.replace(/\s?\$\s?/,""),n=g._.numberToFormat(e,t,r),0<=e?(a.before=a.before.replace(/[\-\(]/,""),a.after=a.after.replace(/[\-\)]/,"")):e<0&&!g._.includes(a.before,"-")&&!g._.includes(a.before,"(")&&(a.before="-"+a.before),i=0;i<a.before.length;i++)switch(a.before[i]){case"$":n=g._.insert(n,o.currency.symbol,i);break;case" ":n=g._.insert(n," ",i+o.currency.symbol.length-1)}for(i=a.after.length-1;0<=i;i--)switch(a.after[i]){case"$":n=i===a.after.length-1?n+o.currency.symbol:g._.insert(n,o.currency.symbol,-(a.after.length-(1+i)));break;case" ":n=i===a.after.length-1?n+" ":g._.insert(n," ",-(a.after.length-(1+i)+o.currency.symbol.length-1))}return n}}),g.register("format","exponential",{regexps:{format:/(e\+|e-)/,unformat:/(e\+|e-)/},format:function(e,t,r){e=("number"!=typeof e||g._.isNaN(e)?"0e+0":e.toExponential()).split("e");return t=t.replace(/e[\+|\-]{1}0/,""),g._.numberToFormat(Number(e[0]),t,r)+"e"+e[1]},unformat:function(e){var t=g._.includes(e,"e+")?e.split("e+"):e.split("e-"),r=Number(t[0]),t=Number(t[1]);return t=g._.includes(e,"e-")?-1*t:t,g._.reduce([r,Math.pow(10,t)],function(e,t,r,n){var i=g._.correctionFactor(e,t);return e*i*(t*i)/(i*i)},1)}}),g.register("format","ordinal",{regexps:{format:/(o)/},format:function(e,t,r){var n=g.locales[g.options.currentLocale],i=g._.includes(t," o")?" ":"";return t=t.replace(/\s?o/,""),i+=n.ordinal(e),g._.numberToFormat(e,t,r)+i}}),g.register("format","percentage",{regexps:{format:/(%)/,unformat:/(%)/},format:function(e,t,r){var n=g._.includes(t," %")?" ":"";return g.options.scalePercentBy100&&(e*=100),t=t.replace(/\s?\%/,""),e=g._.numberToFormat(e,t,r),e=g._.includes(e,")")?((e=e.split("")).splice(-1,0,n+"%"),e.join("")):e+n+"%"},unformat:function(e){e=g._.stringToNumber(e);return g.options.scalePercentBy100?.01*e:e}}),g.register("format","time",{regexps:{format:/(:)/,unformat:/(:)/},format:function(e,t,r){var n=Math.floor(e/60/60),i=Math.floor((e-60*n*60)/60),e=Math.round(e-60*n*60-60*i);return n+":"+(i<10?"0"+i:i)+":"+(e<10?"0"+e:e)},unformat:function(e){var e=e.split(":"),t=0;return 3===e.length?t=(t=(t+=60*Number(e[0])*60)+60*Number(e[1]))+Number(e[2]):2===e.length&&(t=(t+=60*Number(e[0]))+Number(e[1])),Number(t)}}),g},(v=l).exports?v.exports=g():u.numeral=g();const rg=p.default,ng=l.exports;Dt={getDisplayMeasurements:function(e){e=1e3*rg(e);let t="m",r="0,0",n,i="ft",o="0,0",a;return 1e3<=(n=e)&&(n=e/1e3,t="km",r="0.00"),5280<=(a=3.28084*e)&&(a/=5280,i="mi",o="0.00"),{metric:ng(n).format(r)+" "+t,standard:ng(a).format(o)+" "+i}}};const ig=Dt["getDisplayMeasurements"];s={...Xi.exports.modes.draw_line_string,toDisplayFeatures:function(e,t,r){var n=t.properties.id===e.line.id;if(t.properties.active=n?"true":"false",!n)return r(t);t.geometry.coordinates.length<2||(t.properties.meta="feature",r({type:"Feature",properties:{meta:"vertex",parent:e.line.id,coord_path:""+("forward"===e.direction?t.geometry.coordinates.length-2:1),active:"false"},geometry:{type:"Point",coordinates:t.geometry.coordinates["forward"===e.direction?t.geometry.coordinates.length-2:1]}}),r(t),r({type:"Feature",properties:{meta:"currentPosition",radius:(n=ig(t)).metric+`
`+n.standard,parent:e.line.id},geometry:{type:"Point",coordinates:t.geometry.coordinates[t.geometry.coordinates.length-1]}}))}};const og={enable:e=>{setTimeout(()=>{e.map&&e.map.doubleClickZoom&&e._ctx&&e._ctx.store&&e._ctx.store.getInitialConfigValue&&e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},disable(e){setTimeout(()=>{e.map&&e.map.doubleClickZoom&&e.map.doubleClickZoom.disable()},0)}};var c={onSetup:function(){var e=this.newFeature({type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),og.disable(this),this.updateUIClasses({mouse:"add"}),this.setActionableState({trash:!0}),{rectangle:e}},onTap:function(e,t){e.startPoint&&this.onMouseMove(e,t),this.onClick(e,t)},onClick:function(e,t){e.startPoint&&e.startPoint[0]!==t.lngLat.lng&&e.startPoint[1]!==t.lngLat.lat&&(this.updateUIClasses({mouse:"pointer"}),e.endPoint=[t.lngLat.lng,t.lngLat.lat],this.changeMode("simple_select",{featuresId:e.rectangle.id}));t=[t.lngLat.lng,t.lngLat.lat];e.startPoint=t},onMouseMove:function(e,t){e.startPoint&&(e.rectangle.updateCoordinate("0.0",e.startPoint[0],e.startPoint[1]),e.rectangle.updateCoordinate("0.1",t.lngLat.lng,e.startPoint[1]),e.rectangle.updateCoordinate("0.2",t.lngLat.lng,t.lngLat.lat),e.rectangle.updateCoordinate("0.3",e.startPoint[0],t.lngLat.lat),e.rectangle.updateCoordinate("0.4",e.startPoint[0],e.startPoint[1]))},onKeyUp:function(e,t){if(27===t.keyCode)return this.changeMode("simple_select")},onStop:function(e){og.enable(this),this.updateUIClasses({mouse:"none"}),this.activateUIButton(),void 0!==this.getFeature(e.rectangle.id)&&(e.rectangle.removeCoordinate("0.4"),e.rectangle.isValid()?this.map.fire("draw.create",{features:[e.rectangle.toGeoJSON()]}):(this.deleteFeature([e.rectangle.id],{silent:!0}),this.changeMode("simple_select",{},{silent:!0})))},toDisplayFeatures:function(e,t,r){var n=t.properties.id===e.rectangle.id;return t.properties.active=n?"true":"false",!n||e.startPoint?r(t):void 0},onTrash:function(e){this.deleteFeature([e.rectangle.id],{silent:!0}),this.changeMode("simple_select")}},a={},h={},ag=(Object.defineProperty(h,"__esModule",{value:!0}),B),sg=o;h.default=function(e,t,r,n){void 0===n&&(n={});var e=sg.getCoord(e),i=ag.degreesToRadians(e[0]),e=ag.degreesToRadians(e[1]),r=ag.degreesToRadians(r),t=ag.lengthToRadians(t,n.units),o=Math.asin(Math.sin(e)*Math.cos(t)+Math.cos(e)*Math.sin(t)*Math.cos(r)),i=i+Math.atan2(Math.sin(r)*Math.sin(t)*Math.cos(e),Math.cos(t)-Math.sin(e)*Math.sin(o)),r=ag.radiansToDegrees(i),t=ag.radiansToDegrees(o);return ag.point([r,t],n.properties)};var d=Ht&&Ht.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},lg=(Object.defineProperty(a,"__esModule",{value:!0}),d(h)),ug=B;a.default=function(e,t,r){for(var n=(r=void 0===r?{}:r).steps||64,i=r.properties||(!Array.isArray(e)&&"Feature"===e.type&&e.properties?e.properties:{}),o=[],a=0;a<n;a++)o.push(lg.default(e,t,-360*a/n,r).geometry.coordinates);return o.push(o[0]),ug.polygon([o],i)};const cg=a.default,hg=p.default,fg=Dt["getDisplayMeasurements"];function dg(e){var t=e.geometry.coordinates[0],e=hg(e);return cg(t,e)}m={...Xi.exports.modes.draw_line_string,clickAnywhere:function(e,t){return 1===e.currentVertexPosition?(e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat),this.changeMode("simple_select",{featureIds:[e.line.id]})):(e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),"forward"===e.direction?(e.currentVertexPosition+=1,e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat),null)},onStop:function(e){var t;this.activateUIButton(),void 0!==this.getFeature(e.line.id)&&(e.line.removeCoordinate("0"),e.line.isValid()?(t=dg(e.line.toGeoJSON()),this.map.fire("draw.create",{features:[t]})):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode("simple_select",{},{silent:!0})))},toDisplayFeatures:function(e,t,r){var n;return t.geometry.coordinates.length<2||(r({type:"Feature",properties:{active:"true"},geometry:{type:"Point",coordinates:t.geometry.coordinates[0]}}),t.properties.active="true",r(t),r({type:"Feature",properties:{meta:"currentPosition",radius:(n=fg(t)).metric+" "+n.standard,parent:e.line.id},geometry:{type:"Point",coordinates:t.geometry.coordinates[1]}}),(n=dg(t)).properties={active:"true"},r(n)),null}},v={...Xi.exports.modes.simple_select,onDrag:function(e,t){return e.canDragMove&&t.originalEvent.shiftKey?this.dragMove(e,t):this.drawConfig.boxSelect&&e.canBoxSelect?this.whileBoxSelect(e,t):void 0}},u={...Xi.exports.modes.direct_select,onDrag:function(e,t){var r;!0===e.canDragMove&&(e.dragMoving=!0,t.originalEvent.stopPropagation(),r={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat},0<e.selectedCoordPaths.length?this.dragVertex(e,t,r):t.originalEvent.shiftKey&&this.dragFeature(e,t,r),e.dragMoveLocation=t.lngLat)}};g=class{constructor(e){this.draw=e.draw,this.buttons=e.buttons||[],this.onAddOrig=e.draw.onAdd,this.onRemoveOrig=e.draw.onRemove}onAdd(e){const t=this;return t.map=e,t.elContainer=t.onAddOrig(e),t.buttons.forEach(e=>{t.addButton(e)}),t.elContainer}onRemove(e){const t=this;t.buttons.forEach(e=>{t.removeButton(e)}),t.onRemoveOrig(e)}addButton(e){const t=document.createElement("button");t.className="mapbox-gl-draw_ctrl-draw-btn",e.classes instanceof Array&&e.classes.forEach(e=>{t.classList.add(e)}),t.addEventListener(e.on,e.action),t.title=e.title,this.elContainer.appendChild(t),e.elButton=t}removeButton(e){e.elButton.removeEventListener(e.on,e.action),e.elButton.remove()}};var l={EditControl:class{onAdd(e){return this.map=e,this._container=document.createElement("div"),this._container.className="mapboxgl-ctrl-group mapboxgl-ctrl edit-control hidden",this._container.innerHTML=`
            <button class="mapbox-gl-draw_ctrl-draw-btn mapbox-gl-draw_edit" title="Edit geometries" style="background-image: url(img/edit.svg); background-size: 13px 13px;">
              
            </button>
          `,this._container}},SaveCancelControl:class{onAdd(e){return this.map=e,this._container=document.createElement("div"),this._container.className="save-cancel-control bg-white rounded pt-1 pb-2 px-2 mt-2 mr-2 float-right clear-both pointer-events-auto",this._container.style="display: none;",this._container.innerHTML=`
            <div class='font-bold mb-0.5'>Editing Geometries</div>
              <div class="flex">
                <button class='mapboxgl-draw-actions-btn mapboxgl-draw-actions-btn_save txt-xs bg-gray-500 hover:bg-gray-700 text-white font-bold py-0 px-2 rounded' title="Save changes.">
                  Save
                </button>
                <button class='mapboxgl-draw-actions-btn mapboxgl-draw-actions-btn_cancel ml-1 txt-xs bg-gray-500 hover:bg-gray-700 text-white font-bold py-0 px-2 rounded' title="Cancel editing, discards all changes.">
                  Cancel
                </button>
              </div>
          `,this._container}},TrashControl:class{onAdd(e){return this.map=e,this._container=document.createElement("div"),this._container.className="mapboxgl-ctrl-group mapboxgl-ctrl trash-control",this._container.style="display: none;",this._container.innerHTML=`
        <button class="mapbox-gl-draw_ctrl-draw-btn mapbox-gl-draw_trash" title="Delete">
        </button>
      `,this._container}}},o={},pg=(Object.defineProperty(o,"__esModule",{value:!0}),r),mg=6378137;function gg(e){var t=0;if(e&&0<e.length){t+=Math.abs(yg(e[0]));for(var r=1;r<e.length;r++)t-=Math.abs(yg(e[r]))}return t}function yg(e){var t,r,n,i,o,a,s=0,l=e.length;if(2<l){for(a=0;a<l;a++)o=a===l-2?(n=l-2,i=l-1,0):a===l-1?(n=l-1,i=0,1):(i=(n=a)+1,a+2),t=e[n],r=e[i],s+=(vg(e[o][0])-vg(t[0]))*Math.sin(vg(r[1]));s=s*mg*mg/2}return s}function vg(e){return e*Math.PI/180}o.default=function(e){return pg.geomReduce(e,function(e,t){return e+function(e){var t,r=0;switch(e.type){case"Polygon":return gg(e.coordinates);case"MultiPolygon":for(t=0;t<e.coordinates.length;t++)r+=gg(e.coordinates[t]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}(t)},0)};d=y.exports;class _g extends d.Marker{onClick(e){return this._handleClick=e,this}_onMapClick(e){var e=e.originalEvent.target,t=this._element;this._handleClick&&(e===t||t.contains(e))&&this._handleClick()}}const xg=y.exports,bg=oc,wg=p.default,Eg=o.default,Tg=function(s){return function(i,o){const a=d3.select(i.target._content);a.selectAll(".cancel").on("click",function(){i.target._onClose()}),a.selectAll("form").on("submit",function(){const r={},e=a.select("table.marker-properties");e.selectAll("tr").each(function(){var e,t;d3.select(this).selectAll("input")[0][0].value&&(r[d3.select(this).selectAll("input")[0][0].value]=(e=d3.select(this).selectAll("input")[0][1].value,(t=parseFloat(e)).toString()===e?t:e))});var t=s.data.get("map"),n=t.features[o];n.properties=r,s.data.set({map:t},"popup"),i.target._onClose()}),a.selectAll(".add").on("click",function(){var e=a.select("table.marker-properties tbody").append("tr");e.append("th").append("input").attr("type","text"),e.append("td").append("input").attr("type","text")}),a.selectAll(".add-simplestyle-properties-button").on("click",function(){a.selectAll(".add-simplestyle-properties-button").style("display","none");var e=s.data.get("map"),e=e.features[o],{properties:e,geometry:t}=e;{var r;"Point"!==t.type&&"MultiPoint"!==t.type||("marker-color"in e||((r=a.select("table.marker-properties tbody").insert("tr")).append("th").append("input").attr("type","text").attr("value","marker-color"),r.append("td").append("input").attr("type","color").attr("value","#7E7E7E")),"marker-size"in e||((r=a.select("table.marker-properties tbody").insert("tr")).append("th").append("input").attr("type","text").attr("value","marker-size"),(n=r.append("td")).append("input").attr("type","text").attr("value","medium").attr("list","marker-size"),(n=n.append("datalist").attr("id","marker-size")).append("option").attr("value","small"),n.append("option").attr("value","medium"),n.append("option").attr("value","large")))}{var n,i;"LineString"!==t.type&&"MultiLineString"!==t.type&&"Polygon"!==t.type&&"MultiPolygon"!==t.type||("stroke"in e||((n=a.select("table.marker-properties tbody").insert("tr")).append("th").append("input").attr("type","text").attr("value","stroke"),n.append("td").append("input").attr("type","color").attr("value","#555555")),"stroke-width"in e||((i=a.select("table.marker-properties tbody").insert("tr")).append("th").append("input").attr("type","text").attr("value","stroke-width"),i.append("td").append("input").attr("type","number").attr("min","0").attr("step","0.1").attr("value","2")),"stroke-opacity"in e||((i=a.select("table.marker-properties tbody").insert("tr")).append("th").append("input").attr("type","text").attr("value","stroke-opacity"),i.append("td").append("input").attr("type","number").attr("min","0").attr("max","1").attr("step","0.1").attr("value","1")))}"Polygon"!==t.type&&"MultiPolygon"!==t.type||("fill"in e||((t=a.select("table.marker-properties tbody").insert("tr")).append("th").append("input").attr("type","text").attr("value","fill"),t.append("td").append("input").attr("type","color").attr("value","#555555")),"fill-opacity"in e||((t=a.select("table.marker-properties tbody").insert("tr")).append("th").append("input").attr("type","text").attr("value","fill-opacity"),t.append("td").append("input").attr("type","number").attr("min","0").attr("max","1").attr("step","0.1").attr("value","0.5")))}),a.selectAll(".delete-invert").on("click",function(){var e=s.data.get("map");e.features.splice(o,1),s.data.set({map:e},"popup"),i.target._onClose()})}},Sg=_g,Mg=$r,{DEFAULT_DARK_FEATURE_COLOR:kg,DEFAULT_LIGHT_FEATURE_COLOR:Cg,DEFAULT_SATELLITE_FEATURE_COLOR:Ag}=i,Ig=[],Lg=e=>({...e,features:e.features.map((e,t)=>({...e,id:t}))}),Pg=(e,o,a)=>{Ig.forEach(e=>{e.remove()});const n=[],i=(e,t,r)=>{n.push({type:"Feature",id:r,geometry:e,properties:t})},s=(e,t,r)=>{"Point"===e.type&&i(e,t,r),"MultiPoint"===e.type&&e.coordinates.forEach(e=>{i({type:"Point",coordinates:e},t||{},r)}),"GeometryCollection"===e.type&&e.geometries.forEach(e=>{s(e,t,r)})};e.features.forEach((e,t)=>{var{geometry:e,properties:r}=e;s(e,r,t)}),0!==n.length&&n.map(e=>{let t=kg;var r=o.storage.get("style");switch(r){case"Satellite Streets":t=Ag;break;case"Dark":t=Cg;break;default:t=kg}var n=e.properties&&e.properties["marker-color"]||t;let i=1;e.properties&&e.properties["marker-size"]&&("small"===e.properties["marker-size"]&&(i=.6),"large"===e.properties["marker-size"]&&(i=1.2));n=new Sg({color:n,scale:i}).setLngLat(e.geometry.coordinates).onClick(()=>{zg({lngLat:e.geometry.coordinates,features:[e]},o,a)}).addTo(o.map);n.getElement().addEventListener("touchstart",()=>{zg({lngLat:e.geometry.coordinates,features:[e]},o,a)}),"Dark"===r&&d3.selectAll(".mapboxgl-marker svg circle").style("fill","#555","important"),Ig.push(n)})};function zg(t,r,n){var i=t.features[0]["id"];const o=r.data.get("map").features[i];o.id=i;var e=o.properties;let a="",s="",l={};for(const c in e){var u=bg(c);"object"==typeof e[c]?l[u]=bg(JSON.stringify(e[c])):l[u]=bg(e[c])}if(l){for(const h in l=Object.keys(l).length?l:{"":""})"marker-color"!==h&&"stroke"!==h&&"fill"!==h||!n?"marker-size"===h&&n?a+='<tr class="style-row"><th><input type="text" value="'+h+'"'+(n?"":" readonly")+' /></th><td><input type="text" list="marker-size" value="'+l[h]+'"'+(n?"":" readonly")+' /><datalist id="marker-size"><option value="small"><option value="medium"><option value="large"></datalist></td></tr>':"stroke-width"===h&&n?a+='<tr class="style-row"><th><input type="text" value="'+h+'"'+(n?"":" readonly")+' /></th><td><input type="number" min="0" step="0.1" value="'+l[h]+'"'+(n?"":" readonly")+" /></td></tr>":["stroke-opacity","fill-opacity"].includes(h)&&n?a+='<tr class="style-row"><th><input type="text" value="'+h+'"'+(n?"":" readonly")+' /></th><td><input type="number" min="0" max="1" step="0.1" value="'+l[h]+'"'+(n?"":" readonly")+" /></td></tr>":a+='<tr><th><input type="text" value="'+h+'"'+(n?"":" readonly")+' /></th><td><input type="text" value="'+l[h]+'"'+(n?"":" readonly")+" /></td></tr>":a+='<tr class="style-row"><th><input type="text" value="'+h+'"'+(n?"":" readonly")+' /></th><td><input type="color" value="'+l[h]+'"'+(n?"":" readonly")+" /></td></tr>";o&&o.geometry&&(s+='<table class="metadata">',"LineString"===o.geometry.type?(i=1e3*wg(o),s+="<tr><td>Meters</td><td>"+i.toFixed(2)+"</td></tr><tr><td>Kilometers</td><td>"+(i/1e3).toFixed(2)+"</td></tr><tr><td>Feet</td><td>"+(i/.3048).toFixed(2)+"</td></tr><tr><td>Yards</td><td>"+(i/.9144).toFixed(2)+"</td></tr><tr><td>Miles</td><td>"+(i/1609.34).toFixed(2)+"</td></tr>"):"Point"===o.geometry.type?s+="<tr><td>Latitude </td><td>"+o.geometry.coordinates[1].toFixed(4)+"</td></tr><tr><td>Longitude</td><td>"+o.geometry.coordinates[0].toFixed(4)+"</td></tr>":"Polygon"===o.geometry.type&&(s+="<tr><td>Sq. Meters</td><td>"+Eg(o.geometry).toFixed(2)+"</td></tr><tr><td>Sq. Kilometers</td><td>"+(Eg(o.geometry)/1e6).toFixed(2)+"</td></tr><tr><td>Sq. Feet</td><td>"+(Eg(o.geometry)/.092903).toFixed(2)+"</td></tr><tr><td>Acres</td><td>"+(Eg(o.geometry)/4046.86).toFixed(2)+"</td></tr><tr><td>Sq. Miles</td><td>"+(Eg(o.geometry)/2589990).toFixed(2)+"</td></tr>"),s+="</table>");let e=!0;"Point"!==o.geometry.type&&"MultiPoint"!==o.geometry.type||"marker-color"in l&&"marker-size"in l&&(e=!1),"LineString"!==o.geometry.type&&"MultiLineString"!==o.geometry.type||"stroke"in l&&"stroke-width"in l&&"stroke-opacity"in l&&(e=!1),"Polygon"!==o.geometry.type&&"MultiPolygon"!==o.geometry.type||(e=!0,"stroke"in l&&"stroke-width"in l&&"stroke-opacity"in l&&"fill"in l&&"fill-opacity"in l&&(e=!1));i='<form action="javascript:void(0);">'+('<div class="pad1 tabs-ui clearfix col12"><div class="tab col12"><input class="hide" type="radio" id="properties" name="tab-group" checked="true"><label class="keyline-top keyline-right tab-toggle pad0 pin-bottomleft z10 center col6" for="properties">Properties</label><div class="space-bottom1 col12 content"><table class="space-bottom0 marker-properties">'+a+"</table>"+(n?'<div class="add-row-button add fl col4"><span class="fa-solid fa-plus"></span> Add row</div>':"")+(n&&e?'<div class="add-simplestyle-properties-button fl text-right col8">Add simplestyle properties</div>':"")+'</div></div><div class="space-bottom2 tab col12"><input class="hide" type="radio" id="info" name="tab-group"><label class="keyline-top tab-toggle pad0 pin-bottomright z10 center col6" for="info">Info</label><div class="space-bottom1 col12 content"><div class="marker-info">'+s+" </div></div></div></div>")+(n?'<div class="clearfix col12 pad1 keyline-top"><div class="pill col6"><button class="save col6 major" type="submit">Save</button><button class="minor col6 cancel">Cancel</button></div><button class="col6 text-right pad0 delete-invert"><span class="fa-solid fa-trash"></span> Delete feature</button></div>':"")+"</form>";new xg.Popup({closeButton:!1,maxWidth:"251px",offset:{top:[0,10],"top-left":[0,10],"top-right":[0,10],bottom:[0,-40],"bottom-left":[0,-40],"bottom-right":[0,-40],left:[25,-20],right:[-25,-20]},className:"geojsonio-feature"}).setLngLat(t.lngLat).setHTML(i).on("open",e=>{Tg(r)(e,o.id)}).addTo(r.map)}}h={addIds:Lg,addMarkers:Pg,geojsonToLayer:function(e,t){var r,n=e.data.get("map");n&&(r=e.map.getSource("map-data"))&&(r.setData(Lg(n)),Pg(n,e,t),e.data.get("recovery")&&(Mg(e),e.data.set({recovery:!1})))},bindPopup:zg};const Dg=y.exports,Og=Uu,Rg=Xi.exports,Fg=e,Bg=s,Ng=c,jg=m,Ug=v,Vg=u,Gg=g,{EditControl:Wg,SaveCancelControl:Zg,TrashControl:qg}=l,{geojsonToLayer:Hg,bindPopup:$g}=h,Xg=t,{DEFAULT_STYLE:Yg,DEFAULT_PROJECTION:Jg,DEFAULT_DARK_FEATURE_COLOR:Kg,DEFAULT_LIGHT_FEATURE_COLOR:Qg,DEFAULT_SATELLITE_FEATURE_COLOR:ey}=i,ty=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}},{id:"gl-draw-symbol",type:"symbol",layout:{"text-line-height":1.1,"text-size":15,"text-font":["DIN Pro Medium","Arial Unicode MS Regular"],"text-anchor":"left","text-justify":"left","text-offset":[.8,.8],"text-field":["get","radius"],"text-max-width":7},paint:{"text-color":"hsl(0, 0%, 95%)","text-halo-color":"hsl(0, 5%, 0%)","text-halo-width":1,"text-halo-blur":1},filter:["==","meta","currentPosition"]}];let ry,ny=!1,iy=!1;const oy={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[0,0]}}]};function ay(){for(var e={},t=0;t<arguments.length;t++){var r,n=arguments[t];for(r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e}B={};B.load=function(e,t,r){t.user.signXHR(d3.json("https://api.github.com/gists/"+e)).on("load",function(e){r(null,e)}).on("error",function(e){r(e,null)}).get()},B.loadRaw=function(e,t,r){t.user.signXHR(d3.text(e)).on("load",function(e){r(null,e)}).on("error",function(e){r(e,null)}).get()};a={};a.save=function(a,s){const l=a.data.get("source"),u=a.data.get("meta"),c=a.data.get("newpath"),h=u&&u.name||"map.geojson",f=a.data.get("map");if(-1!==navigator.appVersion.indexOf("MSIE 9")||!window.XMLHttpRequest)return alert("Sorry, saving and sharing is not supported in IE9 and lower. Please use a modern browser to enjoy the full featureset of geojson.io");if(!localStorage.github_token)return alert("You need to log in with GitHub to commit changes");a.repo.details(function(e,t){let r,n="POST",i={};var o={};if(!e&&t.permissions.push){if(!(e=a.commitMessage||prompt("Commit message:")))return;r=l.url,n="PUT",i={message:e,branch:u.branch,content:btoa(encodeURIComponent(JSON.stringify(f,null,2)).replace(/%([0-9A-F]{2})/g,(e,t)=>String.fromCharCode("0x"+t)))},c&&(i.path=c,a.data.set({newpath:null})),l.sha&&(i.sha=l.sha)}else r=sy+"/gists",o[h]={content:JSON.stringify(f,null,2)},i={files:o};a.user.signXHR(d3.json(r)).on("load",e=>{s(null,e)}).on("error",e=>{let t;try{t=JSON.parse(e.responseText).message.replace(/(http:\/\/\S*)/g,'<a href="$&">$&</a>')}catch(e){t="Sorry, an error occurred."}s(t)}).send(n,JSON.stringify(i))})},a.load=function(e,t,r){t.user.signXHR(d3.json(function(e){return sy+"/repos/"+e.user+"/"+e.repo+"/contents/"+e.path+"?ref="+e.branch}(e))).on("load",function(e){r(null,e)}).on("error",function(e){r(e,null)}).get()},a.loadRaw=function(e,t,r,n){r.user.signXHR(d3.text(function(e,t){return sy+"/repos/"+e.user+"/"+e.repo+"/git/blobs/"+t}(e,t))).on("load",function(e){n(null,e)}).on("error",function(e){n(e,null)}).header("Accept","application/vnd.github.raw").get()};const sy="https://api.github.com";Dt={};let ly;try{ly=Er}catch(e){console.warn(e)}Dt.save=function(e,t){const r=e.data.get("path"),n=e.data.get("map"),i=JSON.stringify(n,null,2);ly.writeFile(r,i,()=>{t(null,{type:"local",path:r,content:n})})};const uy=qe.exports,cy=ay,hy={gist:B,github:a,local:Dt};function fy(){return{map:{type:"FeatureCollection",features:[]},dirty:!1,source:null,meta:null,type:"local",mapStyleLoaded:!1}}const dy=f,py=$r,my=Yr;const gy=f,yy=ay;const vy=f;const _y={GithubAPI:!1};function xy(e){"undefined"!=typeof console&&console&&console.log&&(console.log("%c⚛ geojson.io console api ⚛","font-family:monospace;font-size:20px;color:darkblue;"),console.log("%cfrom here, you can customize geojson.io to your liking by mucking around with the internals","font-family:monospace;font-size:14px;color:darkblue;"),console.log("%chere's what's available ↓","color:blue;"),console.log(""),console.log("%c- window.api.map: the mapboxgl map object","font-weight:bold;"),console.log("%O",e.map),console.log("%c- window.api.draw: the mapbox-gl-draw instance","font-weight:bold;"),console.log("%O",e.Draw),console.log(""),console.log("%c- window.api.data: the data model","font-weight:bold;"),console.log("%O",e.data),console.log(""),console.log("%cExample:","font-weight:bold;"),console.log(""),console.log("%c  window.api.map.flyTo({ center: [-78, 38], zoom: 5 });","color:green;"),console.log(""),console.log('%c  window.api.data.mergeFeatures([{ type: "Feature", properties: {}, geometry: { type: "Point", coordinates: [0, 0] } }]);',"color:green;"),window.api={map:e.map,draw:e.Draw,data:e.data},d3.rebind(window.api,e.dispatch,"on"))}var by,wy,Ey,r={exports:{}},d=r,Ty=Ht.window||Ht,D={},p=Ty.document,Sy="localStorage";if(D.disabled=!1,D.set=function(e,t){},D.get=function(e){},D.remove=function(e){},D.clear=function(){},D.transact=function(e,t,r){var n=D.get(e);null==r&&(r=t,t=null),r(n=void 0===n?t||{}:n),D.set(e,n)},D.getAll=function(){},D.forEach=function(){},D.serialize=function(e){return JSON.stringify(e)},D.deserialize=function(t){if("string"==typeof t)try{return JSON.parse(t)}catch(e){return t||void 0}},function(){try{return Sy in Ty&&Ty[Sy]}catch(e){}}())by=Ty[Sy],D.set=function(e,t){return void 0===t?D.remove(e):(by.setItem(e,D.serialize(t)),t)},D.get=function(e){return D.deserialize(by.getItem(e))},D.remove=function(e){by.removeItem(e)},D.clear=function(){by.clear()},D.getAll=function(){var r={};return D.forEach(function(e,t){r[e]=t}),r},D.forEach=function(e){for(var t=0;t<by.length;t++){var r=by.key(t);e(r,D.get(r))}};else if(p.documentElement.addBehavior){try{(Ey=new ActiveXObject("htmlfile")).open(),Ey.write('<script>document.w=window<\/script><iframe src="/favicon.ico"></iframe>'),Ey.close(),wy=Ey.w.frames[0].document,by=wy.createElement("div")}catch(e){by=p.createElement("div"),wy=p.body}function My(t){return function(){var e=Array.prototype.slice.call(arguments,0),e=(e.unshift(by),wy.appendChild(by),by.addBehavior("#default#userData"),by.load(Sy),t.apply(D,e));return wy.removeChild(by),e}}var ky=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");function Cy(e){return e.replace(ky,"___")}D.set=My(function(e,t,r){return t=Cy(t),void 0===r?D.remove(t):(e.setAttribute(t,D.serialize(r)),e.save(Sy),r)}),D.get=My(function(e,t){return t=Cy(t),D.deserialize(e.getAttribute(t))}),D.remove=My(function(e,t){t=Cy(t),e.removeAttribute(t),e.save(Sy)}),D.clear=My(function(e){var t=e.XMLDocument.documentElement.attributes;e.load(Sy);for(var r,n=0;r=t[n];n++)e.removeAttribute(r.name);e.save(Sy)}),D.getAll=function(e){var r={};return D.forEach(function(e,t){r[e]=t}),r},D.forEach=My(function(e,t){for(var r,n=e.XMLDocument.documentElement.attributes,i=0;r=n[i];++i)t(r.name,D.deserialize(e.getAttribute(r.name)))})}try{var Ay="__storejs__";D.set(Ay,Ay),D.get(Ay)!=Ay&&(D.disabled=!0),D.remove(Ay)}catch(e){D.disabled=!0}D.enabled=!D.disabled,d.exports?d.exports=D:Ty.store=D;const Iy=Vh,Ly=function(s,e){ry=!e;e=d3.keybinding("map").on("⌫",()=>{iy&&s.Draw.trash()}).on("m",()=>{iy||s.Draw.changeMode("draw_point")}).on("l",()=>{iy||s.Draw.changeMode("draw_line_string")}).on("p",()=>{iy||s.Draw.changeMode("draw_polygon")}).on("r",()=>{iy||s.Draw.changeMode("draw_rectangle")}).on("c",()=>{iy||s.Draw.changeMode("draw_circle")});function l(){s.data.hasFeatures()&&d3.select(".edit-control").style("display","block")}return d3.select(document).call(e),function(){Dg.accessToken="pk.eyJ1IjoiY2hlbmcta2F1c3QiLCJhIjoiY2xnMHN3NHZtMWVudDNocXlqOG91OTViYiJ9.LVNVeWVpFoSzEHA-2OCcFg",Dg.setRTLTextPlugin("https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js",null,!0);var e=s.storage.get("projection")||Jg;const t=s.storage.get("style")||Yg;var r=Xg.find(e=>e.title===t)["style"];if(s.map=new Dg.Map({container:"map",style:r,center:[20,0],zoom:2,projection:e,hash:"map"}),ry){s.map.addControl(new Fg({accessToken:Dg.accessToken,mapboxgl:Dg,marker:!0})),s.Draw=new Rg({displayControlsDefault:!1,modes:{...Rg.modes,simple_select:Ug,direct_select:Vg,draw_line_string:Bg,draw_rectangle:Ng,draw_circle:jg},controls:{},styles:ty});r=new Gg({draw:s.Draw,buttons:[{on:"click",action:()=>{ny=!0,s.Draw.changeMode("draw_point")},classes:["mapbox-gl-draw_ctrl-draw-btn","mapbox-gl-draw_point"],title:"Draw Point (m)"},{on:"click",action:()=>{ny=!0,s.Draw.changeMode("draw_line_string")},classes:["mapbox-gl-draw_ctrl-draw-btn","mapbox-gl-draw_line"],title:"Draw LineString (l)"},{on:"click",action:()=>{ny=!0,s.Draw.changeMode("draw_polygon")},classes:["mapbox-gl-draw_ctrl-draw-btn","mapbox-gl-draw_polygon"],title:"Draw Polygon (p)"},{on:"click",action:()=>{ny=!0,s.Draw.changeMode("draw_rectangle")},classes:["mapbox-gl-draw_ctrl-draw-btn","mapbox-gl-draw_rectangle"],title:"Draw Rectangular Polygon (r)"},{on:"click",action:()=>{ny=!0,s.Draw.changeMode("draw_circle")},classes:["mapbox-gl-draw_ctrl-draw-btn","mapbox-gl-draw_circle"],title:"Draw Circular Polygon (c)"}]}),e=(s.map.addControl(new Dg.NavigationControl),s.map.addControl(r,"top-right"),new Wg),r=(s.map.addControl(e,"top-right"),new Zg),e=(s.map.addControl(r,"top-right"),new qg);s.map.addControl(e,"top-right");d3.selectAll(".mapboxgl-draw-actions-btn").on("click",function(){var e;d3.select(this).classed("mapboxgl-draw-actions-btn_save")&&(e=s.Draw.getAll(),s.data.set({map:{...e,features:a(e.features)}},"map")),iy=!1,s.map.setLayoutProperty("map-data-fill","visibility","visible"),s.map.setLayoutProperty("map-data-fill-outline","visibility","visible"),s.map.setLayoutProperty("map-data-line","visibility","visible"),d3.selectAll(".mapboxgl-marker").style("display","block"),s.Draw.changeMode("simple_select"),s.Draw.deleteAll(),d3.select(".save-cancel-control").style("display","none"),d3.select(".trash-control").style("display","none"),l(),d3.select(".mapboxgl-ctrl-group:nth-child(3)").style("display","block")}),d3.select(".mapbox-gl-draw_trash").on("click",()=>{s.Draw.trash()}),d3.selectAll(".mapbox-gl-draw_edit").on("click",()=>{iy=!0,d3.select(".edit-control").style("display","none"),d3.select(".mapboxgl-ctrl-group:nth-child(3)").style("display","none"),d3.select(".save-cancel-control").style("display","block"),d3.select(".trash-control").style("display","block"),s.map.setLayoutProperty("map-data-fill","visibility","none"),s.map.setLayoutProperty("map-data-fill-outline","visibility","none"),s.map.setLayoutProperty("map-data-line","visibility","none"),d3.selectAll(".mapboxgl-marker").style("display","none");var e=s.Draw.add(s.data.get("map"));s.Draw.changeMode("simple_select",{featureIds:e})})}s.map.on("idle",()=>{if(s.data.get("mapStyleLoaded")&&!s.map.getSource("map-data")){var t=s.map.getStyle()["name"];let e=Kg;["Mapbox Dark"].includes(t)&&(e=Qg),["Mapbox Satellite Streets"].includes(t)&&(e=ey),["Mapbox Light","Mapbox Dark","osm"].includes(t)&&s.map.setFog({range:[.5,10],color:"#ffffff","high-color":"#245cdf","space-color":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"horizon-blend":["interpolate",["exponential",1.2],["zoom"],5,.02,7,.08],"star-intensity":["interpolate",["linear"],["zoom"],5,.35,6,0]}),s.map.addSource("map-data",{type:"geojson",data:oy}),s.map.addLayer({id:"map-data-fill",type:"fill",source:"map-data",paint:{"fill-color":["coalesce",["get","fill"],e],"fill-opacity":["coalesce",["get","fill-opacity"],.3]},filter:["==",["geometry-type"],"Polygon"]}),s.map.addLayer({id:"map-data-fill-outline",type:"line",source:"map-data",paint:{"line-color":["coalesce",["get","stroke"],e],"line-width":["coalesce",["get","stroke-width"],2],"line-opacity":["coalesce",["get","stroke-opacity"],1]},filter:["==",["geometry-type"],"Polygon"]}),s.map.addLayer({id:"map-data-line",type:"line",source:"map-data",paint:{"line-color":["coalesce",["get","stroke"],e],"line-width":["coalesce",["get","stroke-width"],2],"line-opacity":["coalesce",["get","stroke-opacity"],1]},filter:["==",["geometry-type"],"LineString"]}),Hg(s,ry),s.data.set({mapStyleLoaded:!1})}}),s.map.on("zoomend",()=>{s.map.getZoom()<6?d3.select(".projection-switch").style("opacity",1):d3.select(".projection-switch").style("opacity",0)});const n=()=>{"simple_select"===s.Draw.getMode()&&(s.map.getCanvas().style.cursor="pointer")},i=()=>{"simple_select"===s.Draw.getMode()&&s.map.getCanvas().style.removeProperty("cursor")},o=e=>{"CANVAS"!==e.originalEvent.target.nodeName||ny||$g(e,s,ry)};function a(e){return e.map(e=>(delete e.id,e))}s.map.on("load",()=>{s.data.set({mapStyleLoaded:!0}),s.map.on("mouseenter","map-data-fill",n),s.map.on("mouseleave","map-data-fill",i),s.map.on("mouseenter","map-data-line",n),s.map.on("mouseleave","map-data-line",i),s.map.on("click","map-data-fill",o),s.map.on("click","map-data-line",o),s.map.on("touchstart","map-data-fill",o),s.map.on("touchstart","map-data-line",o)}),s.map.on("draw.create",function(e){s.Draw.deleteAll(),function(e){let t=s.data.get("map");t.features=[...t.features,...e],t=Og(t),s.data.set({map:t},"map")}(a(e.features)),setTimeout(()=>{ny=!1},500)}),s.dispatch.on("change.map",({obj:e})=>{l(),e.map&&Hg(s,ry)})}},Py=function(o){const n=fy();function l(e){let t,r;for(t in e.files)if(r=e.files[t].content,-1!==t.indexOf(".geojson")&&r)return t;for(t in e.files)if(r=e.files[t].content,-1!==t.indexOf(".json")&&r)return t}const u={hasFeatures:function(){return!!(n.map&&n.map.features&&n.map.features.length)},set:function(e,t){for(const r in e)n[r]="object"==typeof e[r]?uy(e[r],!1):e[r];return!1!==e.dirty&&(u.dirty=!0),o.dispatch.change({obj:e,source:t}),u},clear:function(){u.set(fy())}};return u.mergeFeatures=function(e,t){return n.map.features=(n.map.features||[]).concat(e.map(function(t){var r=t.properties,n=Object.keys(r),i=n.length;for(let e=0;e<i;e++){var o=n[e],a=r[o];t.properties[o]=(o=a,a=void 0,(a=parseFloat(o)).toString()===o?a:o)}return t})),u.set({map:n.map},t)},u.get=function(e){return n[e]},u.all=function(){return uy(n,!1)},u.fetch=function(e,i){switch(e.id.split(":")[0]){case"gist":var t=e.id.split(":")[1].split("/")[1];hy.gist.load(t,o,(e,r)=>{if(e)return i(e,r);var t=l(r);if(void 0===t)return i(e,r);const n=r.files[t];if(!0!==n.truncated)return i(e,cy(r,{file:n.filename,content:JSON.parse(n.content)}));hy.gist.loadRaw(n.raw_url,o,(e,t)=>e?i(e):i(e,cy(r,{file:n.filename,content:JSON.parse(t)})))});break;case"github":{t=e.id.split("/");const n={user:t[0].split(":")[1],repo:t[1],branch:t[3],path:(t.slice(4)||[]).join("/")};hy.github.load(n,o,(e,r)=>e?i(e):hy.github.loadRaw(n,r.sha,o,(e,t)=>{try{return i(e,cy(r,{content:JSON.parse(t)}))}catch(e){return history.replaceState("",document.title,window.location.pathname),i(e)}}));break}}},u.parse=function(e){let t,r,n,i,o,a=(e.files&&(e.type="gist"),(e.length?e[e.length-1]:e).type);switch(a=e.commit?"commit":a){case"commit":u.set({source:e.content});break;case"local":u.set({type:"local",map:e.content,path:e.path});break;case"blob":t=e[0].login,r=e[1].name,n=e[2].name,i=e.slice(3).map(e=>e.path).join("/"),u.set({type:"github",source:e,meta:{login:t,repo:r,branch:n,name:e.path},path:i,route:"github:"+[t,r,"blob",n,i].join("/"),url:["https://github.com/",t,r,"blob",n,i].join("/")}),e.content&&u.set({map:e.content});break;case"file":o=e.html_url.split("/"),t=o[3],r=o[4],n=o[6],u.set({type:"github",source:e,meta:{login:t,repo:r,branch:n,name:e.name,sha:e.sha},map:e.content,path:e.path,route:"github:"+[t,r,"blob",n,e.path].join("/"),url:e.html_url});break;case"gist":t=e.owner&&e.owner.login||"anonymous",i=[t,e.id].join("/");var s=l(e);try{e.files[s].content&&u.set({map:JSON.parse(e.files[s].content)})}catch(e){console.error(e)}u.set({type:"gist",source:e,meta:{login:t,name:s},path:i,route:"gist:"+i,url:e.html_url})}},u},zy=function(i){function o(e,t){i.container.select(".map").classed("loading",!1);let r;if(e){try{r=e.message||JSON.parse(e.responseText).message.replace(/(http:\/\/\S*)/g,'<a href="$&">$&</a>')}catch(e){r="Sorry, an error occurred."}return my(i.container,r)}i.data.parse(t),dy.stringQs(location.hash.substring(1)).map&&2!==i.map.getZoom()&&JSON.stringify(i.map.getCenter())!==JSON.stringify({lng:20,lat:2})||py(i)}function a(e){d3.json(e).header("Accept","application/vnd.geo+json").on("load",function(e){i.data.set({map:e}),history.replaceState("",document.title,window.location.pathname),py(i)}).on("error",function(){return my(i.container,"Could not load external file. External files must be served with CORS and be valid GeoJSON.")}).get()}return function(e){if(e.id||e.data){var t=d3.event?dy.stringQs(d3.event.oldURL.split("#")[1]).id:i.data.get("route");if(e.data){var r=e.data.match(/^(data\:[\w\-]+\/[\w\-]+\,?)/);if(r)if("data:application/json,"===r[0]){var n=e.data.replace(r[0],"");try{i.data.set({map:JSON.parse(n)}),history.replaceState("",document.title,window.location.pathname),py(i)}catch(e){return void my(i.container,"Could not parse JSON")}}else"data:text/x-url,"===r[0]&&a(e.data.replace(r[0],""))}else e.id!==t&&(i.container.select(".map").classed("loading",!0),i.data.fetch(e,o))}}},Dy=function(i){const e={};function t(){var e,t=d3.event.oldURL.split("#")[1]||"",r=d3.event.newURL.split("#")[1]||"",n=gy.stringQs(t),r=gy.stringQs(r);0!==(e=t).indexOf("gist")&&0!==e.indexOf("github")&&isNaN(parseInt(e,10))?r.id!==n.id&&i.dispatch.route(r):(e=t,isNaN(parseInt(e,10))?(n=e.split(":"),location.hash="#id="+(0===n[1].indexOf("/")?[n[0],n[1].substring(1)].join(":"):e)):location.hash="#id=gist:/"+e)}function r(){var e=n(),t=(t=n(),yy(t,{id:i.data.get("route")}));t.id&&e.id!==t.id&&(location.hash="#"+gy.qsString(t))}function n(){return gy.stringQs(window.location.hash.substring(1))}return e.on=function(){return d3.select(window).on("hashchange.router",t),i.dispatch.on("change.route",r),i.dispatch.route(n()),e},e.off=function(){return d3.select(window).on("hashchange.router",null),e},e},Oy=function(e){d3.select(window).on("unload",function(){if("local"===e.data.get("type")&&e.data.hasFeatures())try{e.storage.set("recover",e.data.all())}catch(e){}else e.storage.remove("recover")}),e.dispatch.on("change",function(){"local"!==e.data.get("type")&&e.storage.remove("recover")});var t=vy.stringQs(location.hash.split("#")[1]||"");"#new"===location.hash||t.id||t.data||((t=e.storage.get("recover"))&&confirm("recover your map from the last time you edited?")?e.data.set({...t,recovery:!0}):e.storage.remove("recover"))},Ry=function(i){var e={};return e.details=function(t){var e=i.storage.get("github_repo_details"),r=i.data.get("meta"),n=r.login,r=r.repo;e&&e.login===n&&e.repo===r&&e.when>+new Date-36e5?t(null,e.data):(i.storage.remove("github_repo_details"),d3.json("https://api.github.com/repos/"+[n,r].join("/")).header("Authorization","token "+i.storage.get("github_token")).on("load",function(e){i.storage.set("github_repo_details",{when:+new Date,data:e}),i.storage.set("github_repo",e),t(null,e)}).on("error",function(e){i.storage.remove("github_repo_details"),t(new Error(e))}).get())},e},Fy=function(r){const n={};var e;return n.details=function(t){if(!r.storage.get("github_token"))return t(new Error("not logged in"));var e=r.storage.get("github_user_details");e&&e.when>+new Date-36e5?t(null,e.data):(r.storage.remove("github_user_details"),d3.json("https://api.github.com/user").header("Authorization","token "+r.storage.get("github_token")).on("load",function(e){r.storage.set("github_user_details",{when:+new Date,data:e}),r.storage.set("github_user",e),t(null,e)}).on("error",function(){n.logout(),r.storage.remove("github_user_details"),t(new Error("not logged in"))}).get())},n.signXHR=function(e){return n.token()?e.header("Authorization","token "+n.token()):e},n.authenticate=function(){window.location.href="https://github.com/login/oauth/authorize?client_id="+_y.client_id+"&scope=gist,repo"},n.token=function(){return r.storage.get("github_token")},n.logout=function(){r.storage.remove("github_token")},n.login=function(){r.storage.remove("github_token")},window.location.search&&0===window.location.search.indexOf("?code")&&(e=window.location.search.replace(/\?{0,1}code=([^\#\&]+).*$/g,"$1"),d3.select(".map").classed("loading",!0),d3.json(_y.gatekeeper_url+"/authenticate/"+e).on("load",e=>{d3.select(".map").classed("loading",!1),e.token&&(window.localStorage.github_token=e.token),-1!==window.location.href.indexOf("?code")&&(window.location.href=window.location.href.replace(/\?code=.*$/,""))}).on("error",()=>{d3.select(".map").classed("loading",!1),alert("Authentication with GitHub failed")}).get()),n},By=xy,Ny=r.exports;(o={}).dispatch=d3.dispatch("change","route"),o.storage=Ny,o.map=Ly(o),o.data=Py(o),o.dispatch.on("route",zy(o)),o.repo=Ry(o),o.router=Dy(o),o.user=Fy(o);y=o,e=Iy(y).write;d3.select(".geojsonio").call(e),y.recovery=Oy(y),y.router.on(),By(y)}();
//# sourceMappingURL=bundle.js.map
